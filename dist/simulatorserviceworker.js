function initSimulatorServiceWorker(){let t="@relprefix@".replace("---","").replace(/^\//,""),r=-1===t.indexOf("/"),i="makecode-sim;"+t+";@pxtRelId@";let l=["@simUrl@","/pxtsim.js","/sim.js"].map(e=>e.trim()).filter(e=>!!e&&0!==e.indexOf("@")),n=!(self.setSimulatorWorkerOptions=e=>{e&&Array.isArray(e.urls)&&l.push(...s(e.urls.map(e=>e.trim()).filter(e=>!!e)))});function s(e){var r,t=[];for(r of e)-1===t.indexOf(r)&&t.push(r);return t}self.addEventListener("install",e=>{if(r){n=!0;try{importScripts("@simworkerconfigUrl@")}catch(e){console.log("Failed to load target service worker config")}console.log("Installing service worker..."),e.waitUntil(caches.open(i).then(e=>(console.log("Opened cache"),e.addAll(s(l)))).then(()=>self.skipWaiting()))}else console.log("Skipping service worker install for unnamed endpoint")}),self.addEventListener("activate",e=>{r?(console.log("Activating service worker..."),e.waitUntil(caches.keys().then(e=>{e=e.filter(e=>{var r=(e=>3!==(e=e.split(";")).length?null:e[1])(e);return null===r||r===t&&e!==i});return Promise.all(e.map(e=>caches.delete(e)))}).then(()=>{if(n){n=!1;{let e=self;return e.clients.claim().then(()=>e.clients.matchAll()).then(e=>{e.forEach(e=>e.postMessage({type:"serviceworker",state:"activated",ref:t}))})}}return Promise.resolve()}))):console.log("Skipping service worker activate for unnamed endpoint")}),self.addEventListener("fetch",r=>{r.respondWith(caches.match(r.request).then(e=>e||fetch(r.request)))})}initSimulatorServiceWorker();