let worker=(e,S,t)=>class extends e{constructor(e,t){super(e,t),this.weightCache={},this.service=S.createLanguageService(this)}async getCompletionsAtPosition(t,r){var n=await super.getCompletionsAtPosition(t,r);if(n){n.entries=n.entries.filter(e=>!e.name.startsWith("_"));var a=this.service.getProgram(),t=a.getSourceFile(t),i=t.getFullText();let e=r-1;for(;0<e&&S.isIdentifierPart(i.charCodeAt(r),S.ScriptTarget.ES5);)e--;if(0<(e="."!==i.charAt(e)?-1:e)){var t=findInnerMostNodeAtPosition(t,e-1,S),a=a.getTypeChecker(),c=a.getTypeAtLocation(t),c=(null==c?void 0:c.symbol)||a.getSymbolAtLocation(t);if(c){let s=a.getFullyQualifiedName(c);if(!this.weightCache[s]){this.weightCache[s]={};var h,t=[],a=(c.members&&t.push(c.members),c.exports&&t.push(c.exports),parseCommentString(getComments(c,S)));let e=[];if(a.groups)try{var g=JSON.parse(a.groups);Array.isArray(e)&&!e.some(e=>"string"!=typeof e)&&(e=g)}catch(e){}let i={},o={};for(h of t)h.forEach(e=>{var t,r=parseCommentString(getComments(e,S));let n=0;"TD_ID"===r.shim||r.hidden||r.deprecated?this.weightCache[s][e.name]="hidden":(r.weight&&(n=parseInt(r.weight)),(t=r.advanced||!r.block?i:o)[r=r.block?r.group||"*":"ts-only"]||(t[r]=[]),t[r].push([e.name,n]))});var l,f=["*"].concat(e);for(l of Object.keys(i).concat(Object.keys(o)))-1===f.indexOf(l)&&f.push(l);var u,m,p=[];for(u of f)o[u]&&p.push(...o[u].sort((e,t)=>t[1]-e[1]).map(e=>e[0]));for(m of f)i[m]&&p.push(...i[m].sort((e,t)=>t[1]-e[1]).map(e=>e[0]));for(let e=0;e<p.length;e++)this.weightCache[s][p[e]]=weightToSortText(p.length-e)}n.entries=n.entries.filter(e=>"hidden"!==this.weightCache[s][e.name]);for(var o of n.entries){var d=this.weightCache[s][o.name]||weightToSortText(0);o.sortText=d+o.name}}}}return n}};function findInnerMostNodeAtPosition(e,t,r){for(var n of e.getChildren())if(!(n.kind>=r.SyntaxKind.FirstPunctuation&&n.kind<=r.SyntaxKind.LastPunctuation)){var i=n.getStart(),o=n.getEnd();if(i<=t&&t<o)return findInnerMostNodeAtPosition(n,t,r)}return e&&e.kind===r.SyntaxKind.SourceFile?null:e}function getComments(e,r){return e.getDeclarations()?e.getDeclarations().map(e=>{let t=e.getSourceFile();return t&&(e=r.getLeadingCommentRangesOfNode(e,t))?e.map(e=>t.text.slice(e.pos,e.end)).join("\n"):""}).join("\n"):""}function parseCommentString(e){let c={};if(e){let a=!0;for(;a;)a=!1,e=e.replace(/\/\/%[ \t]*([\w\.-]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,(e,t,r,n,i,o,s)=>{r=i?JSON.parse(i):r?i||o||s:"true";return c[t]=r,a=!0,"//% "})}return c}function weightToSortText(e){let t,r=(t=9999-(t="string"==typeof e?parseInt(e):e))+"";for(;r.length<4;)r="0"+r;return r}self.customTSWorkerFactory=worker;