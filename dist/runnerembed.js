!function s(o,n,r){function l(t,e){if(!n[t]){if(!o[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(a)return a(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=n[t]={exports:{}},o[t][0].call(i.exports,function(e){return l(o[t][1][e]||e)},i,i.exports,s,o,n,r)}return n[t].exports}for(var a="function"==typeof require&&require,e=0;e<r.length;e++)l(r[e]);return l}({1:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.BlockDragger=void 0;let l=e("blockly");class s extends l.dragging.Dragger{onDrag(e,t){super.onDrag(e,t);var i,s,o,t=document.getElementsByClassName("blocklyToolbox")[0],n=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],r=document.getElementById("blocklyTrashIcon");n&&r&&(i=n.getBoundingClientRect(),s=n.getBoundingClientRect(),o=e.clientX,o=Math.abs(o-(s.left+s.width/2)),(s=l.Gesture.inProgress())&&o<200||!s&&e.clientX-(i.left+i.width)<0?(r.style.opacity=""+(1-(s=o/200)),r.style.display="block",t&&(n.style.opacity=""+s,o<50)&&pxt.BrowserUtils.addClass(t,"blocklyToolboxDeleting")):(r.style.display="none",n.style.opacity="1",t&&pxt.BrowserUtils.removeClass(t,"blocklyToolboxDeleting")))}onDragEnd(e){super.onDragEnd(e);var e=document.getElementsByClassName("blocklyToolbox")[0],t=document.getElementsByClassName("blocklyTreeRoot")[0]||document.getElementsByClassName("blocklyFlyout")[0],i=document.getElementById("blocklyTrashIcon");i&&t&&(i.style.display="none",t.style.opacity="1",e)&&pxt.BrowserUtils.removeClass(e,"blocklyToolboxDeleting")}}i.BlockDragger=s},{blockly:175}],2:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.BreakpointIcon=void 0;let s=e("blockly");class o extends s.icons.Icon{constructor(e,t){super(e),this.onStateChange=t,this.isSet_=!1}getType(){return o.type}initView(e){super.initView(e),this.breakpointSvg||(this.breakpointSvg=s.utils.dom.createSvgElement("circle",{class:"blocklyBreakpointSymbol",stroke:"white","stroke-width":2,cx:7,cy:11.5,r:8},this.svgRoot),this.updateColor())}getSize(){return new s.utils.Size(25,25)}onClick(){this.isSet_=!this.isSet_,this.updateColor(),this.onStateChange(this.sourceBlock,this.isSet_)}isEnabled(){return this.isSet_}setEnabled(e){this.isSet_=e,this.updateColor()}updateColor(){this.breakpointSvg&&this.breakpointSvg.setAttribute("fill",this.isSet_?"#FF0000":"#CCCCCC")}}(i.BreakpointIcon=o).type=new s.icons.IconType("breakpoint")},{blockly:175}],3:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initFunctions=void 0;let d=e("blockly"),h=e("../help"),p=e("../plugins/functions"),u=e("../toolbox"),g=e("../fields"),m=e("../loader"),_=e("../importer"),b=e("../fields/field_imagenotext");function f(r,e){if(!e)return[];let t=[];pxt.appTarget.appTheme.hideFlyoutHeadings||(e=(0,u.createFlyoutHeadingLabel)(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions"),t.push(e));let i=lf("Make a Function..."),s=lf("New function name:");e=d.utils.xml.createElement("button");e.setAttribute("text",i),e.setAttribute("callbackKey","CREATE_FUNCTION");r.registerButtonCallback("CREATE_FUNCTION",function(e){let t=e=>{d.dialog.prompt(s,e,function(e){pxt.tickEvent("blocks.makeafunction"),(e=e&&(e=e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""))==i?null:e)&&(r.getVariableMap().getVariable(e)?d.dialog.alert(d.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",e.toLowerCase()),function(){t(e)}):d.Procedures.isNameUsed(e,r)?(e=>{var t=r.getTopBlocks(!0)[0];let i=10,s=10;t&&(o=t.getRelativeToSurfaceXY(),i=o.x+d.SNAP_RADIUS*(t.RTL?-1:1),s=o.y+2*d.SNAP_RADIUS);var t=d.utils.xml.createElement("xml"),o=d.utils.xml.createElement("block"),n=(o.setAttribute("type","procedures_defnoreturn"),o.setAttribute("x",String(i)),o.setAttribute("y",String(s)),d.utils.xml.createElement("field")),e=(n.setAttribute("name","NAME"),n.appendChild(document.createTextNode(e)),o.appendChild(n),t.appendChild(o),(0,_.domToWorkspaceNoEvents)(t,r)),n=(d.hideChaff(),r.getBlockById(e[0]));n.select(),r.centerOnBlock(n.id,!0)})(e):d.dialog.alert(d.Msg.PROCEDURE_ALREADY_EXISTS.replace("%1",e.toLowerCase()),function(){t(e)}))})};t("doSomething")}),t.push(e);var o=d.Procedures.allProcedures(r)[0],n="procedures_callnoreturn";for(let e=0;e<o.length;e++){var l=o[e][0],a=(o[e][1],d.utils.xml.createElement("block")),c=(a.setAttribute("type",n),a.setAttribute("gap","16"),a.setAttribute("colour",pxt.toolbox.getNamespaceColor("functions")),d.utils.xml.createElement("field"));c.textContent=l,c.setAttribute("name","NAME"),a.appendChild(c),t.push(a)}return t}i.initFunctions=function(){var e,t,i=d.Msg,s=(i.FUNCTION_CREATE_NEW=lf("Make a Function..."),i.FUNCTION_WARNING_DUPLICATE_ARG=lf("Functions cannot use the same argument name more than once."),i.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME=lf("Argument names must not be the same as the function name."),i.FUNCTION_WARNING_EMPTY_NAME=lf("Function and argument names cannot be empty."),i.FUNCTIONS_DEFAULT_FUNCTION_NAME=lf("doSomething"),i.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME=lf("bool"),i.FUNCTIONS_DEFAULT_STRING_ARG_NAME=lf("text"),i.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME=lf("num"),i.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME=lf("arg"),i.FUNCTION_FLYOUT_LABEL=lf("Your Functions"),i.FUNCTIONS_CREATE_CALL_OPTION=lf("Create 'call {0}'","%1"),i.FUNCTIONS_DEFNORETURN_TITLE=lf("function"),i.PROCEDURES_HUE=pxt.toolbox.getNamespaceColor("functions"),i.REPORTERS_HUE=pxt.toolbox.getNamespaceColor("variables"),"procedures_defnoreturn"),o=pxt.blocks.getBlockDefinition(s),s=(i.PROCEDURES_DEFNORETURN_TITLE=o.block.PROCEDURES_DEFNORETURN_TITLE,i.PROCEDURE_ALREADY_EXISTS=o.block.PROCEDURE_ALREADY_EXISTS,d.Blocks.procedures_defnoreturn.init=function(){var e=new d.FieldTextInput("",d.Procedures.rename);this.appendDummyInput().appendField(d.Msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.argumentVarModels_=[],this.hat="cap",this.setStatements_(!0),this.statementConnection_=null},(0,h.installBuiltinHelpInfo)(s),"procedures_callnoreturn");let n=pxt.blocks.getBlockDefinition(s),r=(i.PROCEDURES_CALLRETURN_TOOLTIP=o.tooltip.toString(),d.Blocks.procedures_callnoreturn={init:function(){var e=new g.FieldProcedure("");this.appendDummyInput("TOPROW").appendField(n.block.PROCEDURES_CALLNORETURN_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(pxt.toolbox.getNamespaceColor("functions")),this.arguments_=[],this.quarkConnections_={},this.quarkIds_=null},getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,t){d.Names.equals(e,this.getProcedureCall())&&this.setFieldValue(t,"NAME")},onchange:function(t){if(this.workspace&&!this.workspace.isFlyout&&!this.isInsertionMarker())if(t.type==d.Events.CREATE&&-1!=t.ids.indexOf(this.id)){var i,s,o=this.getProcedureCall();let e=d.Procedures.getDefinition(o,this.workspace);(e=!e||e.type==this.defType_&&JSON.stringify(e.arguments_)==JSON.stringify(this.arguments_)?e:null)||(d.Events.setGroup(t.group),o=d.utils.xml.createElement("xml"),(i=d.utils.xml.createElement("block")).setAttribute("type",this.defType_),s=(n=this.getRelativeToSurfaceXY()).x+d.SNAP_RADIUS*(this.RTL?-1:1),n=n.y+2*d.SNAP_RADIUS,i.setAttribute("x",s),i.setAttribute("y",n),(s=d.utils.xml.createElement("field")).setAttribute("name","NAME"),s.appendChild(document.createTextNode(this.getProcedureCall())),i.appendChild(s),o.appendChild(i),(0,_.domToWorkspaceNoEvents)(o,this.workspace),d.Events.setGroup(!1))}else{var n;t.type==d.Events.DELETE&&(n=this.getProcedureCall(),d.Procedures.getDefinition(n,this.workspace)||(d.Events.setGroup(t.group),this.dispose(!0,!1),d.Events.setGroup(!1)))}},mutationToDom:function(){var e=document.createElement("mutation");return e.setAttribute("name",this.getProcedureCall()),e},domToMutation:function(e){e=e.getAttribute("name");this.renameProcedure(this.getProcedureCall(),e)},customContextMenu:function(e){var t={enabled:!0};t.text=d.Msg.PROCEDURES_HIGHLIGHT_DEF;let i=this.getProcedureCall(),s=this.workspace;t.callback=function(){var e=d.Procedures.getDefinition(i,s);e&&e.select()},e.push(t)},defType_:"procedures_defnoreturn"},(0,h.installBuiltinHelpInfo)(s),"function_definition"),l=(o=pxt.blocks.getBlockDefinition(r),i.FUNCTIONS_EDIT_OPTION=o.block.FUNCTIONS_EDIT_OPTION,(0,h.installBuiltinHelpInfo)(r),s="function_call",o=pxt.blocks.getBlockDefinition(s),i.FUNCTIONS_CALL_TITLE=o.block.FUNCTIONS_CALL_TITLE,i.FUNCTIONS_GO_TO_DEFINITION_OPTION=o.block.FUNCTIONS_GO_TO_DEFINITION_OPTION,(0,h.installBuiltinHelpInfo)(s),(0,h.installBuiltinHelpInfo)("function_call_output"),"function_return"),a=(d.Blocks[l]={init:function(){{var l=this;let i=pxt.blocks.getBlockDefinition("function_return"),s="0_add_button",o="0_rem_button",n=(d.Extensions.apply("inline-svgs",l,!1),!0),r;function a(){var e,t=l.getInput("RETURN_VALUE");if(n){if(!t){for(;l.getInput("");)l.removeInput("");l.jsonInit({message0:i.block.message_with_value,args0:[{type:"input_value",name:"RETURN_VALUE",check:null}],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})}l.getInput(s)&&l.removeInput(s),l.getInput(o)||h(o,l.REMOVE_IMAGE_DATAURI,lf("Remove return value")),r&&((e=l.workspace.getBlockById(r))&&e.outputConnection&&!e.outputConnection.targetBlock()&&l.getInput("RETURN_VALUE").connection.connect(e.outputConnection),r=void 0)}else t&&((e=t.connection.targetBlock())&&(e.isShadow()&&e.setShadow(!1),t.connection.disconnect(),r=e.id),l.removeInput("RETURN_VALUE"),l.jsonInit({message0:i.block.message_no_value,args0:[],previousStatement:null,colour:pxt.toolbox.getNamespaceColor("functions")})),l.getInput(o)&&l.removeInput(o),l.getInput(s)||h(s,l.ADD_IMAGE_DATAURI,lf("Add return value"));l.setInputsInline(!0)}function c(){return d.Xml.domToText(l.mutationToDom())}function u(e,t){e!==t&&d.Events.fire(new d.Events.BlockChange(l,"mutation",null,e,t))}function h(e,t,i){l.appendDummyInput(e).appendField(new b.FieldImageNoText(t,24,24,i,()=>{var e=c(),t=(n=!n,c()),e=(u(e,t),a(),c());u(t,e)},!1))}a(),l.domToMutation=e=>{e.hasAttribute("last_connected_id")&&(r=e.getAttribute("last_connected_id")),n="true"!==e.getAttribute("no_return_value"),a()},l.mutationToDom=()=>{var e,t,i=document.createElement("mutation");return e=i,t=!!l.getInput("RETURN_VALUE"),e.setAttribute("no_return_value",t?"false":"true"),r&&i.setAttribute("last_connected_id",r),i}}},onchange:function(e){let t=this;var i,s;t.workspace&&!t.workspace.isFlyout&&(s=e.type===d.Events.BLOCK_CREATE&&-1!=e.ids.indexOf(t.id),i=e.type===d.Events.BLOCK_DRAG&&e.blocks.some(e=>e.id===t.id),s||i)&&(s=t.getRootBlock()).type!==l&&null==s.previousConnection&&s.type!==r&&(d.Events.setGroup(e.group),t.previousConnection.disconnect(),d.Events.setGroup(!1))}},(0,h.installBuiltinHelpInfo)(l),d.Procedures.flyoutCategory=f,{number:pxt.blocks.defaultIconForArgType("number"),boolean:pxt.blocks.defaultIconForArgType("boolean"),string:pxt.blocks.defaultIconForArgType("string"),Array:pxt.blocks.defaultIconForArgType("Array")}),c={};(i=pxt.appTarget.runtime&&pxt.appTarget.runtime.functionsOptions)&&i.extraFunctionEditorTypes&&i.extraFunctionEditorTypes.forEach(e=>{a[e.typeName]=e.icon||pxt.blocks.defaultIconForArgType(),e.defaultName&&(c[e.typeName]=e.defaultName)});for(e of Object.keys(a))p.FunctionManager.getInstance().setIconForType(e,a[e]);for(t of Object.keys(c))p.FunctionManager.getInstance().setArgumentNameForType(t,c[t]);d.Blocks.argument_reporter_custom&&(d.Blocks.argument_reporter_custom.domToMutation=function(e){e=e.getAttribute("typename");this.typeName_=e,(0,m.setOutputCheck)(this,e,m.cachedBlockInfo)});let u=d.Blocks.function_definition.makeCallOption;d.Blocks.function_definition.makeCallOption=function(){var e=u.call(this),t=this.getName();return e.text=pxt.Util.lf("Create 'call {0}'",t),e}}},{"../fields":70,"../fields/field_imagenotext":38,"../help":72,"../importer":73,"../loader":77,"../plugins/functions":111,"../toolbox":139,blockly:175}],4:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initLists=void 0;let l=e("blockly"),a=e("../help"),c=e("../constants");i.initLists=function(){let e=l.Msg;var t="lists_create_with",i=pxt.blocks.getBlockDefinition(t),i=(e.LISTS_CREATE_EMPTY_TITLE=i.block.LISTS_CREATE_EMPTY_TITLE,e.LISTS_CREATE_WITH_INPUT_WITH=i.block.LISTS_CREATE_WITH_INPUT_WITH,e.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD=i.block.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD,e.LISTS_CREATE_WITH_ITEM_TITLE=i.block.LISTS_CREATE_WITH_ITEM_TITLE,(0,a.installBuiltinHelpInfo)(t),"lists_length"),t=pxt.blocks.getBlockDefinition(i);e.LISTS_LENGTH_TITLE=t.block.LISTS_LENGTH_TITLE,l.Blocks[i].init=function(){this.jsonInit({message0:e.LISTS_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["Array"]}],output:"Number",outputShape:c.provider.SHAPES.ROUND})},(0,a.installBuiltinHelpInfo)(i);let s="lists_index_get",o=pxt.blocks.getBlockDefinition(s),n=(l.Blocks.lists_index_get={init:function(){this.jsonInit({message0:o.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"}],colour:pxt.toolbox.blockColors.arrays,outputShape:c.provider.SHAPES.ROUND,inputsInline:!0}),this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0),(0,a.setBuiltinHelpInfo)(this,s)}},"lists_index_set"),r=pxt.blocks.getBlockDefinition(n);l.Blocks[n]={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"input_value",name:"LIST",check:"Array"},{type:"input_value",name:"INDEX",check:"Number"},{type:"input_value",name:"VALUE",check:null}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.arrays,inputsInline:!0}),(0,a.setBuiltinHelpInfo)(this,n)}}}},{"../constants":18,"../help":72,blockly:175}],5:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initLogic=void 0;let o=e("blockly"),n=e("../help");i.initLogic=function(){var e=o.Msg,t="controls_if",i=(s=pxt.blocks.getBlockDefinition(t)).tooltip,s=(e.CONTROLS_IF_MSG_IF=s.block.CONTROLS_IF_MSG_IF,e.CONTROLS_IF_MSG_THEN=s.block.CONTROLS_IF_MSG_THEN,e.CONTROLS_IF_MSG_ELSE=s.block.CONTROLS_IF_MSG_ELSE,e.CONTROLS_IF_MSG_ELSEIF=s.block.CONTROLS_IF_MSG_ELSEIF,e.CONTROLS_IF_TOOLTIP_1=i.CONTROLS_IF_TOOLTIP_1,e.CONTROLS_IF_TOOLTIP_2=i.CONTROLS_IF_TOOLTIP_2,e.CONTROLS_IF_TOOLTIP_3=i.CONTROLS_IF_TOOLTIP_3,e.CONTROLS_IF_TOOLTIP_4=i.CONTROLS_IF_TOOLTIP_4,(0,n.installBuiltinHelpInfo)(t),"logic_compare"),i=pxt.blocks.getBlockDefinition(s).tooltip,t=(e.LOGIC_COMPARE_TOOLTIP_EQ=i.LOGIC_COMPARE_TOOLTIP_EQ,e.LOGIC_COMPARE_TOOLTIP_NEQ=i.LOGIC_COMPARE_TOOLTIP_NEQ,e.LOGIC_COMPARE_TOOLTIP_LT=i.LOGIC_COMPARE_TOOLTIP_LT,e.LOGIC_COMPARE_TOOLTIP_LTE=i.LOGIC_COMPARE_TOOLTIP_LTE,e.LOGIC_COMPARE_TOOLTIP_GT=i.LOGIC_COMPARE_TOOLTIP_GT,e.LOGIC_COMPARE_TOOLTIP_GTE=i.LOGIC_COMPARE_TOOLTIP_GTE,(0,n.installBuiltinHelpInfo)(s),"logic_operation"),s=(i=pxt.blocks.getBlockDefinition(t)).tooltip,i=(e.LOGIC_OPERATION_AND=i.block.LOGIC_OPERATION_AND,e.LOGIC_OPERATION_OR=i.block.LOGIC_OPERATION_OR,e.LOGIC_OPERATION_TOOLTIP_AND=s.LOGIC_OPERATION_TOOLTIP_AND,e.LOGIC_OPERATION_TOOLTIP_OR=s.LOGIC_OPERATION_TOOLTIP_OR,(0,n.installBuiltinHelpInfo)(t),"logic_negate"),s=pxt.blocks.getBlockDefinition(i),t=(e.LOGIC_NEGATE_TITLE=s.block.LOGIC_NEGATE_TITLE,(0,n.installBuiltinHelpInfo)(i),"logic_boolean"),s=pxt.blocks.getBlockDefinition(t);e.LOGIC_BOOLEAN_TRUE=s.block.LOGIC_BOOLEAN_TRUE,e.LOGIC_BOOLEAN_FALSE=s.block.LOGIC_BOOLEAN_FALSE,(0,n.installBuiltinHelpInfo)(t)}},{"../help":72,blockly:175}],6:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initLoops=void 0;let _=e("blockly"),b=e("../help"),f=e("../plugins/duplicateOnDrag");i.initLoops=function(){var e=_.Msg,t="controls_repeat_ext",i=pxt.blocks.getBlockDefinition(t);e.CONTROLS_REPEAT_TITLE=i.block.CONTROLS_REPEAT_TITLE,e.CONTROLS_REPEAT_INPUT_DO=i.block.CONTROLS_REPEAT_INPUT_DO,(0,b.installBuiltinHelpInfo)(t);let s="device_while",o=pxt.blocks.getBlockDefinition(s),n=(_.Blocks[s]={init:function(){this.jsonInit({message0:o.block.message0,args0:[{type:"input_value",name:"COND",check:"Boolean"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops")}),this.appendStatementInput("DO").appendField(o.block.appendField),(0,b.setBuiltinHelpInfo)(this,s)}},"pxt_controls_for"),r=pxt.blocks.getBlockDefinition(n),l=(_.Blocks[n]={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"input_value",name:"VAR",variable:r.block.variable,check:"Variable"},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(r.block.appendField);let e=this;(0,b.setHelpResources)(this,n,r.name,function(){return pxt.U.rlf(r.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")},r.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){var i=this.getField("VAR");_.Names.equals(e,i.getText())&&i.setValue(t)}},(0,f.setDuplicateOnDrag)(n,"VAR"),"controls_simple_for"),a=pxt.blocks.getBlockDefinition(l),c=(_.Blocks[l]={init:function(){this.jsonInit({message0:a.block.message0,args0:[{type:"field_variable",name:"VAR",variable:a.block.variable,variableTypes:[""]},{type:"input_value",name:"TO",check:"Number"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("loops"),inputsInline:!0}),this.appendStatementInput("DO").appendField(a.block.appendField);let e=this;(0,b.setHelpResources)(this,l,a.name,function(){return pxt.U.rlf(a.tooltip,e.getField("VAR").getText())},a.url,String(pxt.toolbox.getNamespaceColor("loops")))},getVars:function(){return[this.getField("VAR").getText()]},renameVar:function(e,t){var i=this.getField("VAR");_.Names.equals(e,i.getText())&&i.setValue(t)},customContextMenu:function(e){var t,i,s;this.isCollapsed()||null!=(t=null==(t=this.workspace)?void 0:t.options)&&t.readOnly||(t={enabled:!0},s=this.getField("VAR").getText(),t.text=lf("Create 'get {0}'",s),(i=_.utils.xml.createElement("field")).textContent=s,i.setAttribute("name","VAR"),(s=_.utils.xml.createElement("block")).setAttribute("type","variables_get"),s.appendChild(i),t.callback=_.ContextMenu.callbackFactory(this,s),e.push(t))}},pxt.blocks.getBlockDefinition(ts.pxtc.TS_BREAK_TYPE)),u=(_.Blocks[pxtc.TS_BREAK_TYPE]={init:function(){var e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:c.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,b.setHelpResources)(this,ts.pxtc.TS_BREAK_TYPE,c.name,c.tooltip,c.url,e,void 0,void 0,!1)}},pxt.blocks.getBlockDefinition(ts.pxtc.TS_CONTINUE_TYPE)),h=(_.Blocks[pxtc.TS_CONTINUE_TYPE]={init:function(){var e=pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:u.block.message0,inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,b.setHelpResources)(this,ts.pxtc.TS_CONTINUE_TYPE,u.name,u.tooltip,u.url,e,void 0,void 0,!1)}},"#cccccc"),d=(_.Blocks[pxtc.COLLAPSED_BLOCK]={init:function(){this.jsonInit({message0:"...",inputsInline:!0,previousStatement:null,nextStatement:null,colour:h}),(0,b.setHelpResources)(this,ts.pxtc.COLLAPSED_BLOCK,"...",lf("a few blocks"),void 0,h,void 0,void 0,!1)}},"pxt_controls_for_of"),p=pxt.blocks.getBlockDefinition(d),g=(_.Blocks[d]={init:function(){this.jsonInit({message0:p.block.message0,args0:[{type:"input_value",name:"VAR",variable:p.block.variable,check:"Variable"},{type:"input_value",name:"LIST",check:["Array","String"]}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(p.block.appendField);let e=this;(0,b.setHelpResources)(this,d,p.name,function(){return pxt.Util.rlf(p.tooltip,e.getInputTargetBlock("VAR")?e.getInputTargetBlock("VAR").getField("VAR").getText():"")},p.url,String(pxt.toolbox.getNamespaceColor("loops")))}},(0,f.setDuplicateOnDrag)(d,"VAR"),"controls_for_of"),m=pxt.blocks.getBlockDefinition(g);_.Blocks[g]={init:function(){this.jsonInit({message0:m.block.message0,args0:[{type:"field_variable",name:"VAR",variable:m.block.variable,variableTypes:[""]},{type:"input_value",name:"LIST",check:"Array"}],previousStatement:null,nextStatement:null,colour:pxt.toolbox.blockColors.loops,inputsInline:!0}),this.appendStatementInput("DO").appendField(m.block.appendField);let e=this;(0,b.setHelpResources)(this,g,m.name,function(){return pxt.Util.rlf(m.tooltip,e.getField("VAR").getText())},m.url,String(pxt.toolbox.getNamespaceColor("loops")))}}}},{"../help":72,"../plugins/duplicateOnDrag":91,blockly:175}],7:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initMathRoundBlock=i.initMathOpBlock=i.initMath=void 0;let c=e("blockly"),u=e("../help"),h=e("../constants"),r=e("../composableMutations"),l=e("../fields/field_dropdown");function d(){let e=pxt.blocks.MATH_FUNCTIONS.unary.concat(pxt.blocks.MATH_FUNCTIONS.binary).concat(pxt.blocks.MATH_FUNCTIONS.infix);var t="math_js_op";let i=pxt.blocks.getBlockDefinition(t);function o(e,t){e=e.appendValueInput("ARG"+(t?1:0));e.setCheck("Number"),t&&(e.connection.setShadowDom((()=>{var e;return s||((s=document.createElement("shadow")).setAttribute("type","math_number"),(e=document.createElement("field")).setAttribute("name","NUM"),e.textContent="0",s.appendChild(e)),s})()),e.connection.respawnShadow_())}function n(e,t){var i=!!e.getInput("ARG1");t?(i&&e.moveInputBefore("op_dropdown","ARG1"),e.moveInputBefore("ARG0","op_dropdown")):(i&&e.moveInputBefore("ARG0","ARG1"),e.moveInputBefore("op_dropdown","ARG0"))}c.Blocks[t]={init:function(){let s=this;s.setPreviousStatement(!1),s.setNextStatement(!1),s.setOutput(!0,"Number"),s.setOutputShape(h.provider.SHAPES.ROUND),s.setInputsInline(!0),s.appendDummyInput("op_dropdown").appendField(new l.FieldDropdown(e.map(e=>[i.block[e],e]),e=>{var t=s;return(e=>-1!==pxt.blocks.MATH_FUNCTIONS.unary.indexOf(e))(e)?t.removeInput("ARG1",!0):t.getInput("ARG1")||o(t,!0),n(t,(e=>-1!==pxt.blocks.MATH_FUNCTIONS.infix.indexOf(e))(e)),e}),"OP"),o(s,!1),(0,r.appendMutation)(s,{mutationToDom:e=>{let t;for(let e=0;e<s.inputList.length;e++){var i=s.inputList[e];if("op_dropdown"===i.name){t=!1;break}if("ARG0"===i.name){t=!0;break}}return e.setAttribute("op-type",(s.getInput("ARG1")?t?"infix":"binary":"unary").toString()),e},domToMutation:e=>{e.hasAttribute("op-type")&&("unary"!=(e=e.getAttribute("op-type"))&&o(s,!0),n(s,"infix"===e))}})}},(0,u.installHelpResources)(t,i.name,function(e){return i.tooltip[e.getFieldValue("OP")]},i.url,pxt.toolbox.getNamespaceColor(i.category))}i.initMath=function(e){let t="math_op2",i=pxt.blocks.getBlockDefinition(t),s=i.tooltip,o=(c.Blocks[t]={init:function(){this.jsonInit({message0:lf("%1 of %2 and %3"),args0:[{type:"field_dropdown",name:"op",options:[[lf("{id:op}min"),"min"],[lf("{id:op}max"),"max"]]},{type:"input_value",name:"x",check:"Number"},{type:"input_value",name:"y",check:"Number"}],inputsInline:!0,output:"Number",outputShape:h.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,u.setHelpResources)(this,t,i.name,function(e){return s[e.getFieldValue("op")]},i.url,pxt.toolbox.getNamespaceColor(i.category))},codeCard:(0,u.attachCardInfo)(e,"Math.min")},"math_op3"),n=pxt.blocks.getBlockDefinition(o);c.Blocks[o]={init:function(){this.jsonInit({message0:n.block.message0,args0:[{type:"input_value",name:"x",check:"Number"}],inputsInline:!0,output:"Number",outputShape:h.provider.SHAPES.ROUND,colour:pxt.toolbox.getNamespaceColor("math")}),(0,u.setBuiltinHelpInfo)(this,o)},codeCard:(0,u.attachCardInfo)(e,"Math.abs")},["math_number","math_integer","math_whole_number","math_number_minmax"].forEach(e=>{var t=pxt.blocks.getBlockDefinition(e);(0,u.installHelpResources)(e,t.name,t.tooltip,t.url,"#fff","#fff","#fff")});var e=c.Msg,r="math_arithmetic",l=pxt.blocks.getBlockDefinition(r);let a=l.tooltip;e.MATH_ADDITION_SYMBOL=l.block.MATH_ADDITION_SYMBOL,e.MATH_SUBTRACTION_SYMBOL=l.block.MATH_SUBTRACTION_SYMBOL,e.MATH_MULTIPLICATION_SYMBOL=l.block.MATH_MULTIPLICATION_SYMBOL,e.MATH_DIVISION_SYMBOL=l.block.MATH_DIVISION_SYMBOL,e.MATH_POWER_SYMBOL=l.block.MATH_POWER_SYMBOL,(0,u.installHelpResources)(r,l.name,function(e){return a[e.getFieldValue("OP")]},l.url,pxt.toolbox.getNamespaceColor(l.category)),r="math_modulo",l=pxt.blocks.getBlockDefinition(r),e.MATH_MODULO_TITLE=l.block.MATH_MODULO_TITLE,(0,u.installBuiltinHelpInfo)(r),d(),p()},i.initMathOpBlock=d;let s;function p(){let t=pxt.blocks.ROUNDING_FUNCTIONS;var e="math_js_round";let i=pxt.blocks.getBlockDefinition(e);c.Blocks[e]={init:function(){var e=this;e.setPreviousStatement(!1),e.setNextStatement(!1),e.setOutput(!0,"Number"),e.setOutputShape(h.provider.SHAPES.ROUND),e.setInputsInline(!0),e.appendDummyInput("round_dropdown").appendField(new l.FieldDropdown(t.map(e=>[i.block[e],e])),"OP");e.appendValueInput("ARG0").setCheck("Number")}},(0,u.installHelpResources)(e,i.name,function(e){return i.tooltip[e.getFieldValue("OP")]},i.url,pxt.toolbox.getNamespaceColor(i.category))}i.initMathRoundBlock=p},{"../composableMutations":17,"../constants":18,"../fields/field_dropdown":34,"../help":72,blockly:175}],8:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initOnStart=void 0;let s=e("blockly"),o=e("../fields"),r=e("../help");i.initOnStart=function(){let i=pxt.blocks.getBlockDefinition(ts.pxtc.ON_START_TYPE);if(s.Blocks[ts.pxtc.ON_START_TYPE]={init:function(){let e,t=null==(e=pxt.appTarget.runtime)?void 0:e.onStartColor;t=t&&pxt.toolbox.getAccessibleBackground(t),this.jsonInit({message0:i.block.message0,args0:[{type:"input_dummy"},{type:"input_statement",name:"HANDLER"}],colour:t||pxt.toolbox.getNamespaceColor("loops")}),(0,r.setHelpResources)(this,ts.pxtc.ON_START_TYPE,i.name,i.tooltip,i.url,t||pxt.toolbox.getNamespaceColor("loops"),void 0,void 0,!!pxt.appTarget.runtime&&pxt.appTarget.runtime.onStartUnDeletable)}},s.Blocks[pxtc.TS_STATEMENT_TYPE]={init:function(){let o=this;o.setColour("#717171"),o.setPreviousStatement(!0),o.setNextStatement(!0),o.setInputsInline(!1);let t,n;o.domToMutation=t=>{var i=parseInt(t.getAttribute("numlines"));o.declaredVariables=t.getAttribute("declaredvars"),n=[];for(let e=0;e<i;e++){var s=t.getAttribute("line"+e);n.push(s)}o.setPythonEnabled(!1)},o.mutationToDom=()=>{let i=document.createElement("mutation");return n&&(n.forEach((e,t)=>i.setAttribute("line"+t,e)),i.setAttribute("numlines",n.length.toString())),o.declaredVariables&&i.setAttribute("declaredvars",this.declaredVariables),i},o.setPythonEnabled=e=>{if(t!==e){for(;o.inputList.length;)o.removeInput(o.inputList[0].name);(t=e)?(o.appendDummyInput().appendField(pxt.Util.lf("<python code>"),"LINE0"),o.setTooltip(lf("A Python statement that could not be converted to blocks"))):(n.forEach((e,t)=>{o.appendDummyInput().appendField(e,"LINE"+t)}),o.setTooltip(lf("A JavaScript statement that could not be converted to blocks")))}},o.getLines=()=>n,o.setEditable(!1),(0,r.setHelpResources)(this,pxtc.TS_STATEMENT_TYPE,lf("JavaScript statement"),lf("A JavaScript statement that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},s.Blocks[pxtc.TS_OUTPUT_TYPE]={init:function(){let t=this;t.setColour("#717171"),t.setPreviousStatement(!1),t.setNextStatement(!1),t.setOutput(!0),t.setEditable(!1),t.appendDummyInput().appendField(new o.FieldTsExpression(""),"EXPRESSION"),t.setPythonEnabled=e=>{t.getField("EXPRESSION").setPythonEnabled(e),e?t.setTooltip(lf("A Python expression that could not be converted to blocks")):t.setTooltip(lf("A JavaScript expression that could not be converted to blocks"))},(0,r.setHelpResources)(t,pxtc.TS_OUTPUT_TYPE,lf("JavaScript expression"),lf("A JavaScript expression that could not be converted to blocks"),"/blocks/javascript-blocks","#717171")}},pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock){let t=pxt.appTarget.runtime.pauseUntilBlock,i=pxt.blocks.getBlockDefinition(ts.pxtc.PAUSE_UNTIL_TYPE);s.Blocks[pxtc.PAUSE_UNTIL_TYPE]={init:function(){var e=t.color||pxt.toolbox.getNamespaceColor("loops");this.jsonInit({message0:i.block.message0,args0:[{type:"input_value",name:"PREDICATE",check:"Boolean"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:e}),(0,r.setHelpResources)(this,ts.pxtc.PAUSE_UNTIL_TYPE,i.name,i.tooltip,i.url,e,void 0,void 0,!1)}}}}},{"../fields":70,"../help":72,blockly:175}],9:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initText=void 0;let s=e("blockly"),o=e("../help"),n=e("../constants");i.initText=function(){var e=pxt.blocks.getBlockDefinition("text"),e=((0,o.installHelpResources)("text",e.name,e.tooltip,e.url,"#fff","#fff","#fff"),"text_length"),t=pxt.blocks.getBlockDefinition(e);s.Msg.TEXT_LENGTH_TITLE=t.block.TEXT_LENGTH_TITLE,s.Blocks[e].init=function(){this.jsonInit({message0:s.Msg.TEXT_LENGTH_TITLE,args0:[{type:"input_value",name:"VALUE",check:["String"]}],output:"Number",outputShape:n.provider.SHAPES.ROUND})},(0,o.installBuiltinHelpInfo)(e),t="text_join",e=pxt.blocks.getBlockDefinition(t),s.Msg.TEXT_JOIN_TITLE_CREATEWITH=e.block.TEXT_JOIN_TITLE_CREATEWITH,(0,o.installBuiltinHelpInfo)(t)}},{"../constants":18,"../help":72,blockly:175}],10:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.initVariables=o.CREATE_VAR_BTN_ID=void 0;let a=e("blockly"),c=e("../toolbox"),l=e("../help");function u(e,t){let i=[];pxt.appTarget.appTheme.hideFlyoutHeadings||(s=(0,c.createFlyoutHeadingLabel)(lf("Variables"),pxt.toolbox.getNamespaceColor("variables"),pxt.toolbox.getNamespaceIcon("variables")),i.push(s));var s=document.createElement("button"),s=(s.setAttribute("text",lf("Make a Variable...")),s.setAttribute("callbackKey","CREATE_VARIABLE"),s.setAttribute("id",o.CREATE_VAR_BTN_ID),e.registerButtonCallback("CREATE_VARIABLE",function(e){a.Variables.createVariableButtonHandler(e.getTargetWorkspace())}),i.push(s),a.Variables.flyoutCategoryBlocks(e));return i=i.concat(s)}o.CREATE_VAR_BTN_ID="create-variable-btn",o.initVariables=function(){let e=lf("{id:var}item");a.Variables.flyoutCategory=u,a.Variables.flyoutCategoryBlocks=function(e){var t=e.getVariableMap().getVariablesOfType(""),i=[];if(0<t.length){var s,o,n,r,e=t[t.length-1];t.sort(a.Variables.compareByName);for(let e=0;e<t.length;e++){var l=t[e];a.Blocks.variables_get&&((l=(0,c.mkVariableFieldBlock)("variables_get",l.getId(),l.getType(),l.getName(),!1)).setAttribute("gap","8"),i.push(l))}i[i.length-1].setAttribute("gap","24"),(a.Blocks.variables_change||a.Blocks.variables_set)&&i.unshift((0,c.createFlyoutGroupLabel)(lf("Your Variables"))),a.Blocks.variables_change&&(n=a.Blocks.variables_get?20:8,(r=(0,c.mkVariableFieldBlock)("variables_change",e.getId(),e.getType(),e.getName(),!1)).setAttribute("gap",n+""),(n=a.utils.xml.createElement("value")).setAttribute("name","VALUE"),(s=a.utils.xml.createElement("shadow")).setAttribute("type","math_number"),n.appendChild(s),(o=a.utils.xml.createElement("field")).setAttribute("name","NUM"),o.appendChild(document.createTextNode("1")),s.appendChild(o),r.appendChild(n),i.unshift(r)),a.Blocks.variables_set&&(s=a.Blocks.variables_change?8:24,(o=(0,c.mkVariableFieldBlock)("variables_set",e.getId(),e.getType(),e.getName(),!1)).setAttribute("gap",s+""),(n=a.utils.xml.createElement("value")).setAttribute("name","VALUE"),(r=a.utils.xml.createElement("shadow")).setAttribute("type","math_number"),n.appendChild(r),(e=a.utils.xml.createElement("field")).setAttribute("name","NUM"),e.appendChild(document.createTextNode("0")),r.appendChild(e),o.appendChild(n),i.unshift(o))}return i};var t=a.Msg;let i="variables_get";var s=pxt.blocks.getBlockDefinition(i);t.VARIABLES_GET_CREATE_SET=s.block.VARIABLES_GET_CREATE_SET,a.Blocks[i]={init:function(){this.jsonInit({type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}",variableTypes:[""]}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]}),(0,l.setBuiltinHelpInfo)(this,i)}},(0,l.installBuiltinHelpInfo)("variables_get_reporter"),t.RENAME_VARIABLE=lf("Rename variable..."),t.DELETE_VARIABLE=lf('Delete the "%1" variable'),t.DELETE_VARIABLE_CONFIRMATION=lf('Delete %1 uses of the "%2" variable?'),t.NEW_VARIABLE_DROPDOWN=lf("New variable...");let o="variables_set",n=(s=pxt.blocks.getBlockDefinition(o),t.VARIABLES_SET=s.block.VARIABLES_SET,t.VARIABLES_DEFAULT_NAME=e,t.VARIABLES_SET_CREATE_GET=lf("Create 'get %1'"),a.Blocks[o]={init:function(){this.jsonInit({type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}",variableTypes:[""]},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}),(0,l.setBuiltinHelpInfo)(this,o)}},"variables_change"),r=pxt.blocks.getBlockDefinition(n);a.Blocks[n]={init:function(){this.jsonInit({message0:r.block.message0,args0:[{type:"field_variable",name:"VAR",variable:e,variableTypes:[""]},{type:"input_value",name:"VALUE",check:"Number"}],inputsInline:!0,previousStatement:null,nextStatement:null,colour:pxt.toolbox.getNamespaceColor("variables")}),(0,l.setBuiltinHelpInfo)(this,n)},customContextMenu:function(e){var t,i,s;null!=(t=null==(t=this.workspace)?void 0:t.options)&&t.readOnly||this.isInFlyout||(t={enabled:0<this.workspace.remainingCapacity()},s=this.getField("VAR").getText(),t.text=lf("Create 'get {0}'",s),(i=a.utils.xml.createElement("field")).textContent=s,i.setAttribute("name","VAR"),(s=a.utils.xml.createElement("block")).setAttribute("type","variables_get"),s.appendChild(i),t.callback=a.ContextMenu.callbackFactory(this,s),e.push(t))}},t.NEW_VARIABLE_TITLE=lf("New variable name:"),t.RENAME_VARIABLE_TITLE=lf("Rename all '%1' variables to:")}},{"../help":72,"../toolbox":139,blockly:175}],11:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.renderCodeCard=void 0;let l=e("./render");i.renderCodeCard=function(t,i={}){var s=!!(n=t.url?/^[^:]+:\/\//.test(t.url)?t.url:"/"+t.url.replace(/^\.?\/?/,""):t.youTubeId?"https://youtu.be/"+t.youTubeId:void 0),o=(e,t,i="div",s="")=>{i=document.createElement(i);return t&&(i.className=t),e&&e.appendChild(i),s&&i.appendChild(document.createTextNode(s+"")),i},e=o(null,"ui "+(t.style||"card")+" "+(t.color||"")+(s?" link":""),s?"a":"div"),s=(i.role&&e.setAttribute("role",i.role),"option"===i.role&&e.setAttribute("aria-selected","true"),s&&((s=e).href=n,/^https?:\/\//.test(n))&&(s.target="_blank"),!i.hideHeader&&t.header&&(n=o(e,"ui content "+(t.responsive?" tall desktop only":"")),t.header)&&o(n,"description","span",t.header),(i.shortName?t.shortName:"")||t.name),n=o(e,"ui image"+(t.responsive?" tall landscape only":""));if(t.label&&((i=document.createElement("label")).className=`ui ${t.labelClass||"orange right ribbon"} label`,i.textContent=t.label,n.appendChild(i)),t.blocksXml&&((i=(0,l.render)(t.blocksXml))?((r=o(n,"")).setAttribute("style","width:100%; min-height:10em"),r.appendChild(i)):(pxt.error("failed to render blocks"),pxt.debug(t.blocksXml))),t.typeScript&&((r=document.createElement("pre")).appendChild(document.createTextNode(t.typeScript)),n.appendChild(r)),(i=t.imageUrl||(t.youTubeId?`https://img.youtube.com/vi/${t.youTubeId}/0.jpg`:void 0))&&((r=document.createElement("div")).className="ui imagewrapper",(i=document.createElement("div")).className="ui cardimage",i.style.backgroundImage=`url("${t.imageUrl}")`,i.title=s,i.setAttribute("role","presentation"),r.appendChild(i),n.appendChild(r)),"file"==t.cardType&&(i=o(e,"ui fileimage"),n.appendChild(i)),s||t.description){var r=o(e,"ui content");if(s&&(e.setAttribute("aria-label",s),o(r,"header","div",s)),t.description){n=o(r,"ui description"),i=/((?:\.{1,3})|[\!\?â€¦])/.exec(t.description);let e=t.description+".";i&&(s=i[1],e=t.description.split(s)[0]+s),n.appendChild(document.createTextNode(e))}}return t.time&&(r=o(e,"meta"),t.time)&&o(r,"date","span").appendChild(document.createTextNode(pxt.Util.timeSince(t.time))),t.extracontent&&o(e,"extra content","div").appendChild(document.createTextNode(t.extracontent)),e}},{"./render":137}],12:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.workerOpAsync=s.compileExpression=s.AUTO_DISABLED_REASON=s.callKey=s.compileAsync=s.compileBlockAsync=s.PXT_WARNING_ID=void 0;let h=e("blockly"),A=e("./environment"),x=e("./typeChecker"),R=e("./util"),u=e("../toolbox"),O=e("../legacyMutations"),d=e("./variables"),p=e("../fields");function g(e,t){var i;return e.type===ts.pxtc.ON_START_TYPE?0:(i=t.stdCallTable[e.type],t=m(0,e),e=1+ts.pxtc.Util.codalHash16(t),i&&i.attrs.afterOnStart?e:-e)}function m(e,t){return t.type==ts.pxtc.ON_START_TYPE?JSON.stringify({name:ts.pxtc.ON_START_TYPE}):t.type==ts.pxtc.FUNCTION_DEFINITION_TYPE?JSON.stringify({type:"function",name:t.getFieldValue("function_name")}):JSON.stringify(function e(t){let i=[];let s=[];for(var o of t.inputList){for(var n of o.fieldRow)n.name&&i.push(n.getText());o.type===h.inputs.inputTypes.VALUE&&(o.connection.targetBlock()?s.push(e(o.connection.targetBlock())):s.push(null))}return{type:t.type,fields:i,inputs:s}}(t)).replace(/"id"\s*:\s*"[^"]+"/g,"")}function _(e,t){var i;e.setDisabledReason(!t,s.AUTO_DISABLED_REASON);for(i of e.getDescendants(!1))i.setDisabledReason(!t,s.AUTO_DISABLED_REASON)}function b(e){e.setDisabledReason(!1,s.AUTO_DISABLED_REASON),e.setDisabledReason(!1,h.constants.MANUALLY_DISABLED),e.setDisabledReason(!1,"ORPHANED_BLOCK")}function f(e,t){if(t.isInsertionMarker())return[];let i;var s,o,n,r,l,a,c,u,h,d,p,g,m,_,b,f,T,E=[];switch(e.stats[t.type]=(e.stats[t.type]||0)+1,M(t,E),t.type){case"controls_if":i=((i,s,o)=>{var e,n=[];for(let t=0;t<=s.elseifCount_;++t){var r=N(i,(0,R.getInputTargetBlock)(i,s,"IF"+t),o),l=$(i,(0,R.getInputTargetBlock)(i,s,"DO"+t));let e=pxt.blocks.mkText("if (");0<t&&((e=pxt.blocks.mkText("else if (")).glueToBlock=pxt.blocks.GlueMode.WithSpace),(0,R.append)(n,[e,r,pxt.blocks.mkText(")"),l])}return s.elseCount_&&((e=pxt.blocks.mkText("else")).glueToBlock=pxt.blocks.GlueMode.WithSpace,(0,R.append)(n,[e,$(i,(0,R.getInputTargetBlock)(i,s,"ELSE"))])),n})(e,t,E);break;case"pxt_controls_for":case"controls_for":case"controls_simple_for":i=(d=e,p=t,g=E,m=(0,R.getInputTargetBlock)(d,p,"TO"),_=(0,R.getInputTargetBlock)(d,p,"DO"),b=(0,R.getInputTargetBlock)(d,p,"BY"),f=(0,R.getInputTargetBlock)(d,p,"FROM"),T=!b||b.type.match(/^math_number/)&&1==F(b),p=(0,x.lookup)(d,p,(0,R.getLoopVariableField)(d,p).getField("VAR").getText()),[pxt.blocks.mkText("for (let "+p.escapedName+" = "),f?N(d,f,g):pxt.blocks.mkText("0"),pxt.blocks.mkText("; "),pxt.blocks.mkInfix(pxt.blocks.mkText(p.escapedName),"<=",N(d,m,g)),pxt.blocks.mkText("; "),T?pxt.blocks.mkText(p.escapedName+"++"):pxt.blocks.mkInfix(pxt.blocks.mkText(p.escapedName),"+=",N(d,b,g)),pxt.blocks.mkText(")"),$(d,_)]);break;case"pxt_controls_for_of":case"controls_for_of":i=((e,t,i)=>{let s=(0,R.getInputTargetBlock)(e,t,"LIST"),o=(0,R.getInputTargetBlock)(e,t,"DO"),n;return n=s&&"placeholder"!==s.type?N(e,s,i):pxt.blocks.mkText("[0]"),i=(0,x.lookup)(e,t,(0,R.getLoopVariableField)(e,t).getField("VAR").getText()),[pxt.blocks.mkText("for (let "+i.escapedName+" of "),n,pxt.blocks.mkText(")"),$(e,o)]})(e,t,E);break;case"variables_set":i=[((t,e,i)=>{let s=(0,R.getInputTargetBlock)(t,e,"VALUE"),o=(0,x.lookup)(t,e,e.getField("VAR").getText()),n=t.idToScope[e.id],r=n.declaredVars[o.name]===o&&!o.firstReference&&!o.alreadyDeclared,l=(r&&(0,R.forEachChildExpression)(e,e=>{"variables_get"===e.type&&(0,x.lookup)(t,e,e.getField("VAR").getText())===o&&(r=!1)},!0),N(t,s,i)),a=o.escapedName+" = ";var c;return o.isAssigned=!0,r?(o.alreadyDeclared=A.BlockDeclarationType.Assigned,i=(0,x.getConcreteType)(o.type),a=`let ${o.escapedName} = `,i&&(c=(0,x.getConcreteType)((0,x.returnType)(t,s)),i.type!==c.type)&&(a=`let ${o.escapedName}: ${i.type} = `)):o.firstReference||(o.firstReference=e),pxt.blocks.mkStmt(pxt.blocks.mkText(a),l)})(e,t,E)];break;case"variables_change":i=[(f=e,m=t,T=E,p=(0,R.getInputTargetBlock)(f,m,"VALUE"),m=(0,x.lookup)(f,m,m.getField("VAR").getText()),f=N(f,p,T),p=pxt.blocks.mkText(m.escapedName),pxt.blocks.mkStmt(pxt.blocks.mkInfix(p,"+=",f)))];break;case"controls_repeat_ext":i=((t,i,e)=>{let s=N(t,(0,R.getInputTargetBlock)(t,i,"TIMES"),e),o=$(t,(0,R.getInputTargetBlock)(t,i,"DO")),n="index";for(let e=2;!(e=>!(0,x.lookup)(t,i,e))(n);e++)n="index"+e;return[pxt.blocks.mkText("for (let "+n+" = 0; "),pxt.blocks.mkInfix(pxt.blocks.mkText(n),"<",s),pxt.blocks.mkText("; "+n+"++)"),o]})(e,t,E);break;case"device_while":i=((e,t,i)=>(i=N(e,(0,R.getInputTargetBlock)(e,t,"COND"),i),e=$(e,(0,R.getInputTargetBlock)(e,t,"DO")),[pxt.blocks.mkText("while ("),i,pxt.blocks.mkText(")"),e]))(e,t,E);break;case"procedures_defnoreturn":i=(b=e,g=t,d=(0,R.escapeVarName)(g.getFieldValue("NAME"),b,!0),g=(0,R.getInputTargetBlock)(b,g,"STACK"),[pxt.blocks.mkText("function "+d+"() "),$(b,g)]);break;case"function_definition":i=(l=e,a=t,_=(0,R.escapeVarName)(a.getField("function_name").getText(),l,!0),c=(0,R.getInputTargetBlock)(l,a,"STACK"),u=a.getArguments().map(e=>{var t;return"Array"==e.type?(t=(0,x.lookup)(l,a,e.name),t=null!=(t=(0,x.getConcreteType)(t.type))&&t.type&&"Array"!==t.type?t.type:"any[]",(0,R.escapeVarName)(e.name,l)+": "+t):(0,R.escapeVarName)(e.name,l)+": "+e.type}),h=(0,x.isFunctionRecursive)(l,a,!1),[pxt.blocks.mkText(`function ${_} (${u.join(", ")})`+(h?": any":"")),$(l,c)]);break;case"procedures_callnoreturn":i=[((e,t)=>(t=(0,R.escapeVarName)(t.getFieldValue("NAME"),e,!0),pxt.blocks.mkStmt(pxt.blocks.mkText(t+"()"))))(e,t)];break;case"function_call":i=[D(e,t,E,!0)];break;case pxtc.TS_RETURN_STATEMENT_TYPE:i=[((e,t,i)=>(t=(0,R.getInputTargetBlock)(e,t,"RETURN_VALUE"))&&"placeholder"!=t.type?pxt.blocks.mkStmt(pxt.blocks.mkText("return "),N(e,t,i)):pxt.blocks.mkStmt(pxt.blocks.mkText("return")))(e,t,E)];break;case ts.pxtc.ON_START_TYPE:i=((e,t)=>(t=(0,R.getInputTargetBlock)(e,t,"HANDLER"),e=$(e,t),pxt.appTarget.compile&&pxt.appTarget.compile.onStartText&&e&&e.children&&e.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText(`// ${pxtc.ON_START_COMMENT}
`))),e))(e,t).children;break;case pxtc.TS_STATEMENT_TYPE:i=t.getLines().map(e=>pxt.blocks.mkText(e+"\n"));break;case pxtc.PAUSE_UNTIL_TYPE:i=(u=e,h=t,c=E,r=pxt.appTarget.runtime&&pxt.appTarget.runtime.pauseUntilBlock,pxt.U.assert(!!r,"target has block enabled"),v=r.namespace,r=r.callName||"pauseUntil",u=B(u,h,{definitionName:"PREDICATE",actualName:"PREDICATE"},c),h=[pxt.blocks.mkGroup([pxt.blocks.mkText("() => "),u])],v?[pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(v,r,h,!1))]:[pxt.blocks.mkStmt(pxt.blocks.H.mkCall(r,h,!1,!1))]);break;case pxtc.TS_DEBUGGER_TYPE:i="1"!=t.getFieldValue("ON_OFF")?[]:[pxt.blocks.mkText("debugger;\n")];break;case pxtc.TS_BREAK_TYPE:i=[pxt.blocks.mkText("break;\n")];break;case pxtc.TS_CONTINUE_TYPE:i=[pxt.blocks.mkText("continue;\n")];break;default:var v=e.stdCallTable[t.type];i=v?[(o=t,n=E,(r=(s=e).stdCallTable[o.type]).imageLiteral?pxt.blocks.mkStmt(L(0,o,r.imageLiteral,r.imageLiteralColumns,r.imageLiteralRows,r.namespace,r.f,(0,R.visibleParams)(r,(0,R.countOptionals)(o,r)).map(e=>B(s,o,e,n)))):r.hasHandler?((t,i,s,o,n,r)=>{var e,o=o.map(e=>B(t,i,e,r)),l=(0,R.getInputTargetBlock)(t,i,"HANDLER"),l=$(t,l);pxt.appTarget.compile&&pxt.appTarget.compile.emptyEventHandlerComments&&0===l.children.length&&l.children.unshift(pxt.blocks.mkStmt(pxt.blocks.mkText("// "+pxtc.HANDLER_COMMENT)));let a,c=((0,R.isMutatingBlock)(i)&&i.mutation.getMutationType()===O.MutatorTypes.ObjectDestructuringMutator?a=i.mutation.compileMutation(t,r):s.comp.handlerArgs.length&&(e=(0,x.getEscapedCBParameters)(i,s,t),a=pxt.blocks.mkText(`function (${e.join(", ")})`)),n),u=s.f;s.attrs.blockAliasFor&&(e=t.blocksInfo.apis.byQName[s.attrs.blockAliasFor])&&(u=e.name,c=e.namespace);{var[n,o,l,s,h,d=!1]=[c,u,o,l,a,s.isExtensionMethod];s.noFinalNewline=!0;let e;return e=h?pxt.blocks.mkGroup([h,s]):pxt.blocks.mkGroup([pxt.blocks.mkText("function ()"),s]),d?pxt.blocks.mkStmt(pxt.blocks.H.extensionCall(o,l.concat([e]),!1)):n?pxt.blocks.mkStmt(pxt.blocks.H.namespaceCall(n,o,l.concat([e]),!1)):pxt.blocks.mkStmt(pxt.blocks.H.mkCall(o,l.concat([e]),!1))}})(s,o,r,((e,t)=>(0,R.visibleParams)(e,(0,R.countOptionals)(t,e)).filter(e=>!!e.definitionName))(r,o),r.namespace,n):pxt.blocks.mkStmt(P(s,o,r,n)))]:[pxt.blocks.mkStmt(N(e,t,E))]}var y=i[i.length-1];if(y&&!y.id&&(y.id=t.id),E.length){var k,I,C=i,S=[];for(k of E)for(var w of k.split("\n"))S.push(pxt.blocks.mkText("// "+w)),S.push(pxt.blocks.mkNewLine());for(I of S.reverse())C.unshift(I)}return i.forEach(e=>{!(e.type===pxt.blocks.NT.Block||e.type===pxt.blocks.NT.Prefix&&pxt.Util.startsWith(e.op,"//"))||t.type==pxtc.ON_START_TYPE&&e.id||(e.id=t.id)}),i}function N(t,i,s){pxt.U.assert(null!=i),t.stats[i.type]=(t.stats[i.type]||0)+1,M(i,s);let o;var e,n,r,l,a,c,u,h,d,p,g,m,_;if("placeholder"!=i.type&&i.isEnabled&&i.isEnabled())switch(i.type){case"math_number":case"math_integer":case"math_whole_number":case"math_number_minmax":o=C(0,i);break;case"math_op2":o=(d=t,g=s,m=(p=i).getFieldValue("op"),_=N(d,(0,R.getInputTargetBlock)(d,p,"x"),g),d=N(d,(0,R.getInputTargetBlock)(d,p,"y"),g),pxt.blocks.H.mathCall(m,[_,d]));break;case"math_op3":o=((e,t,i)=>(e=N(e,(0,R.getInputTargetBlock)(e,t,"x"),i),pxt.blocks.H.mathCall("abs",[e])))(t,i,s);break;case"math_arithmetic":case"logic_compare":case"logic_operation":o=((e,t,i)=>{let s=t.getFieldValue("OP"),o=(0,R.getInputTargetBlock)(e,t,"A"),n=(0,R.getInputTargetBlock)(e,t,"B"),r=[N(e,o,i),N(e,n,i)];if(-1!==["LT","LTE","GT","GTE","EQ","NEQ"].indexOf(s)&&I(e,o)&&I(e,n)&&pxt.blocks.flattenNode([r[0]]).output!==pxt.blocks.flattenNode([r[1]]).output&&(r=r.map(e=>pxt.blocks.H.mkParenthesizedExpression(pxt.blocks.mkGroup([e,pxt.blocks.mkText(" as any")])))),t=(0,x.returnType)(e,o),(0,x.isStringType)(t)){if("EQ"==s)return pxt.blocks.H.mkSimpleCall("==",r);if("NEQ"==s)return pxt.blocks.H.mkSimpleCall("!=",r)}else if((0,x.isBooleanType)(t))return pxt.blocks.H.mkSimpleCall(y[s],r);return pxt.U.assert(s in y),pxt.blocks.H.mkSimpleCall(y[s],r)})(t,i,s);break;case"math_modulo":o=(p=t,g=i,m=s,_=(0,R.getInputTargetBlock)(p,g,"DIVIDEND"),g=(0,R.getInputTargetBlock)(p,g,"DIVISOR"),_=[N(p,_,m),N(p,g,m)],pxt.blocks.H.mkSimpleCall("%",_));break;case"logic_boolean":o=pxt.blocks.H.mkBooleanLiteral("TRUE"==i.getFieldValue("BOOL"));break;case"logic_negate":o=((e,t,i)=>(e=N(e,(0,R.getInputTargetBlock)(e,t,"BOOL"),i),pxt.blocks.mkPrefix("!",[pxt.blocks.H.mkParenthesizedExpression(e)])))(t,i,s);break;case"variables_get":case"variables_get_reporter":o=((e,t)=>{let i=t.getField("VAR").getText(),s=(0,x.lookup)(e,t,i);return s?(s.firstReference||(s.firstReference=t),pxt.U.assert(null!=s&&null!=s.type),pxt.blocks.mkText(s.escapedName)):pxt.blocks.mkText(i)})(t,i);break;case"text":o=pxt.blocks.H.mkStringLiteral(i.getFieldValue("TEXT"));break;case"text_join":o=((e,t,i)=>{let s,o=0;for(;;){var n=(0,R.getInputTargetBlock)(e,t,"ADD"+o);if(o++,!n){if(o<t.inputList.length)continue;break}var r=N(e,n,i);s=s?pxt.blocks.H.mkSimpleCall("+",[s,r]):0===n.type.indexOf("text")?r:pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),r])}return s||pxt.blocks.H.mkStringLiteral("")})(t,i,s);break;case"lists_create_with":o=(c=t,u=s,h=(d=i).inputList.map(e=>e.connection&&e.connection.targetBlock()?N(c,e.connection.targetBlock(),u):void 0).filter(e=>!!e),pxt.blocks.H.mkArrayLiteral(h,!d.getInputsInline()));break;case"lists_index_get":o=(h=t,r=i,l=s,a=(0,R.getInputTargetBlock)(h,r,"LIST"),a=N(h,a,l),h=N(h,(0,R.getInputTargetBlock)(h,r,"INDEX"),l),r=pxt.blocks.mkGroup([a,pxt.blocks.mkText("["),h,pxt.blocks.mkText("]")]));break;case"lists_index_set":o=(l=t,a=i,r=s,e=(0,R.getInputTargetBlock)(l,a,"LIST"),b=N(l,e,r),n=N(l,(0,R.getInputTargetBlock)(l,a,"INDEX"),r),l=N(l,(0,R.getInputTargetBlock)(l,a,"VALUE"),r),a=pxt.blocks.mkGroup([b,pxt.blocks.mkText("["),n,pxt.blocks.mkText("] = "),l]),"lists_create_with"===e.type?T(a):a);break;case"math_js_op":case"math_js_round":o=((e,t,i)=>{var s=t.getFieldValue("OP"),o=[N(e,(0,R.getInputTargetBlock)(e,t,"ARG0"),i)];return t.getInput("ARG1")&&o.push(N(e,(0,R.getInputTargetBlock)(e,t,"ARG1"),i)),pxt.blocks.H.mathCall(s,o)})(t,i,s);break;case pxtc.TS_OUTPUT_TYPE:o=pxt.blocks.mkText(i.getFieldValue("EXPRESSION").trim());break;case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":o=((e,t)=>(t=(0,R.escapeVarName)(t.getFieldValue("VALUE"),e),pxt.blocks.mkText(t)))(t,i);break;case"function_call_output":o=D(t,i,s,!1);break;default:var b=t.stdCallTable[i.type];o=b?b.imageLiteral?L(0,i,b.imageLiteral,b.imageLiteralColumns,b.imageLiteralRows,b.namespace,b.f,(0,R.visibleParams)(b,(0,R.countOptionals)(i,b)).map(e=>B(t,i,e,s))):P(t,i,b,s):(pxt.reportError("blocks","unable to compile expression",{details:i.type}),(0,x.defaultValueForType)((0,x.returnType)(t,i)))}else if("Array"===(0,x.find)((0,x.returnType)(t,i)).type){let e="lists_index_get"===i.getParent().type;e||(f=t.stdCallTable[i.getParent().type],e=f&&f.isExpression);var f=pxt.blocks.mkText("[0]");o=e?f:T(f)}else o=(0,x.defaultValueForType)((0,x.returnType)(t,i));return o.id=i.id,o}function $(t,e){let i=[];for(var s=e;e;)e.isEnabled()&&(0,R.append)(i,f(t,e)),e=e.getNextBlock();return s&&t.blockDeclarations[s.id]&&t.blockDeclarations[s.id].filter(e=>!e.alreadyDeclared).forEach(e=>{i.unshift(E(e,t.blocksInfo)),e.alreadyDeclared=A.BlockDeclarationType.Implicit}),pxt.blocks.mkBlock(i)}function T(e){var t=pxt.blocks.mkStmt(pxt.blocks.mkText(";"));return t.glueToBlock=pxt.blocks.GlueMode.NoSpace,pxt.blocks.mkGroup([t,e])}function L(e,t,i,s,o,n,r,l){l=void 0===l?[]:l;let a="\n",c=(o=o||5,s=(s||5)*i,t.getFieldValue("LEDS"));c=c.replace(/[ `\n]+/g,"");for(let t=0;t<o;++t){for(let e=0;e<s;++e)0<e&&(a+=" "),a+="#"===c[t*s+e]?"#":".";a+="\n"}i=pxt.blocks.H.mkStringLiteral(a);return i.canIndentInside=!0,pxt.blocks.H.namespaceCall(n,r,[i].concat(l),!1)}function o(e,t,i){let s=pxt.blocks.flattenNode(t);return n("format",{format:{input:s.output,pos:1}}).then(()=>({source:s.output,sourceMap:s.sourceMap,stats:e.stats,diagnostics:i||[]}))}function M(e,t){var i=null==(i=e.getCommentText)?void 0:i.call(e);i&&t.push(i)}function E(e,t){var i=(0,x.getConcreteType)(e.type);let s,o="";if("null"==(s="Array"===i.type?pxt.blocks.mkText("[]"):(0,x.defaultValueForType)(i)).op||"[]"==s.op){let e=i.type;"Array"!==e&&"null[]"!==e||(e="number[]");i=t.apis.byQName[e];i&&i.attributes.autoCreate?s=pxt.blocks.mkText(i.attributes.autoCreate+"()"):o=": "+e}return pxt.blocks.mkStmt(pxt.blocks.mkText("let "+e.escapedName+o+" = "),s)}function v(e,t,i,s,o){e=n(e,o.x,o.x+o.width)||n(o.x,e,e+i),i=n(t,o.y,o.y+o.height)||n(o.y,t,t+s);return e&&i;function n(e,t,i){return t<=e&&e<=i}}s.PXT_WARNING_ID="WARNING_MESSAGE",s.compileBlockAsync=function(e,t){var i=e.workspace,t=(0,A.mkEnv)(i,t),i=((0,x.infer)(i&&i.getAllBlocks(!1),t,i),f(t,e));return t.placeholders={},o(t,i)},s.compileAsync=function(e,t,i={}){var[e,t]=((n,r,l)=>{try{let e=r.getAllBlocks(!1),t=(pxt.react.getTilemapProject&&pxt.react.getTilemapProject().removeInactiveBlockAssets(e.map(e=>e.id)),r.getTopBlocks(!0)),i=(t=t.sort((e,t)=>g(e,n)-g(t,n)),((i,e,t)=>{var s=h.Events.isEnabled();s&&h.Events.disable(),e.forEach(b);let o={};function n(e,t){o[e]?_(t,!1):(_(t,!0),o[e]=t)}t.forEach(t=>{var e=i.stdCallTable[t.type];if(t.type==ts.pxtc.ON_START_TYPE)n(ts.pxtc.ON_START_TYPE,t);else if(!((0,R.isFunctionDefinition)(t)||e&&e.attrs.blockAllowMultiple&&!e.attrs.handlerStatement&&!e.attrs.forceStatement))if(e&&e.hasHandler&&!e.attrs.handlerStatement&&!e.attrs.forceStatement)n(e.attrs.blockHandlerKey||m(0,t),t);else{let e=t;for(;e;)_(t,!1),e=e.getNextBlock()}}),s&&h.Events.enable()})(n,e,t),e=e.filter(e=>e.isEnabled()),t=t.filter(e=>e.isEnabled()),(0,d.trackAllVariables)(t,n),(0,x.infer)(e,n,r),[]);var a=r.getTopComments(!0);let s=((e,t)=>{if(!e.length||e.some(e=>!e.rendered))return{orphans:t,idToComments:{}};var i,s=e.map(e=>{var t=e.getBoundingRectangle(),i=e.getHeightWidth();return{id:e.id,x:t.left,y:t.top,width:i.width,height:i.height}}),o={orphans:[],idToComments:{}};for(i of t){var n,r=i.getBoundingRectangle(),l=i.getSize(),a=r.left,c=r.top;let e;for(n of s)(v(a,c,l.width,l.height,n)||!e&&v(a-20,c-20,l.width+40,l.height+40,n))&&(e=n);(e?(o.idToComments[e.id]||(o.idToComments[e.id]=[]),o.idToComments[e.id]):o.orphans).push(i)}return o})(t,a),o=(s.orphans.forEach(e=>(0,R.append)(i,k(e).children)),t.forEach(e=>{s.idToComments[e.id]&&s.idToComments[e.id].forEach(e=>{(0,R.append)(i,k(e).children)}),e.type==ts.pxtc.ON_START_TYPE?(0,R.append)(i,f(n,e)):(e=pxt.blocks.mkBlock(f(n,e))).type==pxt.blocks.NT.Block?(0,R.append)(i,e.children):i.push(e)}),[]);n.enums.forEach(l=>{var e=r.getVariableMap().getVariablesOfType(l.name);if(e&&e.length){e=e.map(e=>{var t=/^(\d+)([^0-9].*)$/.exec(e.getName());return t?[t[2],parseInt(t[1])]:[e.getName(),-1]});e.sort((e,t)=>e[1]-t[1]);let n=[],r=-1;e.forEach(([e,t],i)=>{let s;var o;l.isBitMask?0<=(o=Math.log2(t))&&Math.floor(o)===o&&(s=pxt.blocks.H.mkAssign(pxt.blocks.mkText(e),pxt.blocks.H.mkSimpleCall("<<",[pxt.blocks.H.mkNumberLiteral(1),pxt.blocks.H.mkNumberLiteral(o)]))):l.isHash&&(o=ts.pxtc.Util.codalHash16(e.toLowerCase()),s=pxt.blocks.H.mkAssign(pxt.blocks.mkText(e),pxt.blocks.H.mkNumberLiteral(o))),s=s||(t===r+1?pxt.blocks.mkText(e):pxt.blocks.H.mkAssign(pxt.blocks.mkText(e),pxt.blocks.H.mkNumberLiteral(t))),n.push(s),r=t});e=pxt.blocks.mkCommaSep(n,!0);e.glueToBlock=pxt.blocks.GlueMode.NoSpace,o.push(pxt.blocks.mkGroup([pxt.blocks.mkText("enum "+l.name),pxt.blocks.mkBlock([e])]))}}),n.kinds.forEach(t=>{var e=r.getVariableMap().getVariablesOfType("KIND_"+t.name);e&&e.length&&(e=e.map(e=>e.getName()).filter(e=>-1===t.initialMembers.indexOf(e))).length&&o.push(pxt.blocks.mkGroup([pxt.blocks.mkText("namespace "+t.name),pxt.blocks.mkBlock(e.map(e=>pxt.blocks.mkStmt(pxt.blocks.mkText(`export const ${e} = ${t.name}.${t.createFunctionName}()`))))]))});var c=n.allVariables.filter(e=>!e.alreadyDeclared).map(e=>E(e,l));return n.allVariables.filter(e=>e.alreadyDeclared===A.BlockDeclarationType.Implicit&&!e.isAssigned).forEach(e=>{var t=(0,x.getConcreteType)(e.type);"string"===t.type||"number"===t.type||"boolean"===t.type||(0,u.isArrayType)(t.type)||n.diagnostics.push({blockId:e.firstReference&&e.firstReference.id,message:lf("Variable '{0}' is never assigned",e.name)})}),[o.concat(c.concat(i)),n.diagnostics]}catch(e){var t=e.block;if(!t)throw e;t.setWarningText(e+"",s.PXT_WARNING_ID),n.errors.push(t)}finally{n.placeholders={}}return[null,null]})(i=(0,A.mkEnv)(e,t,i),e,t);return o(i,e,t)},s.callKey=m,s.AUTO_DISABLED_REASON="pxt_automatic_disabled",s.compileExpression=N;let y={ADD:"+",MINUS:"-",MULTIPLY:"*",DIVIDE:"/",LT:"<",LTE:"<=",GT:">",GTE:">=",AND:"&&",OR:"||",EQ:"==",NEQ:"!=",POWER:"**"};function D(t,i,s,e){var o=(0,R.escapeVarName)(i.getField("function_name").getText(),t,!0),n=!i.getInputsInline(),r=i.getArguments().map(e=>({actualName:e.name,definitionName:e.id})).map(e=>B(t,i,e,s)),o=pxt.blocks.H.stdCall(o,r,n);return e?pxt.blocks.mkStmt(o):o}function B(e,t,i,s,o=!1){var n=t.getFieldValue(i.definitionName);if(null==n)return(0,x.attachPlaceholderIf)(e,t,i.definitionName),r=(0,R.getInputTargetBlock)(e,t,i.definitionName),o&&"lists_create_with"===r.type?T(N(e,r,s)):i.shadowOptions&&i.shadowOptions.toString&&!(0,x.isStringType)((0,x.returnType)(e,r))?pxt.blocks.H.mkSimpleCall("+",[pxt.blocks.H.mkStringLiteral(""),pxt.blocks.H.mkParenthesizedExpression(N(e,r,s))]):N(e,r,s);o=t.getField(i.definitionName);if(o instanceof h.FieldTextInput||o instanceof p.FieldTextInput)return pxt.blocks.H.mkStringLiteral(n);if(o instanceof p.FieldTilemap&&!o.isGreyBlock){var r=pxt.react.getTilemapProject(),s=o.getValue();if(s.startsWith("tilemap`"))return pxt.blocks.mkText(s);if(e.options.emitTilemapLiterals)try{var l,a=pxt.sprite.decodeTilemap(s,"typescript",r);if(a)return[l]=r.createNewTilemapFromData(a),pxt.blocks.mkText(`tilemap\`${l}\``)}catch(e){}}t=e.blocksInfo.apis.byQName[i.type];if(t&&t.attributes.emitAsConstant)for(var c of Object.keys(e.blocksInfo.apis.byQName)){var u=e.blocksInfo.apis.byQName[c];if(u&&u.attributes&&u.attributes.enumIdentity===n)return pxt.blocks.mkText(c)}o=pxt.blocks.mkText(n);return o.canIndentInside="string"==typeof n&&0<=n.indexOf("\n"),o}function P(i,s,o,n){let t;if((0,R.isMutatingBlock)(s)&&s.mutation.getMutationType()===O.MutatorTypes.RestParameterMutator)t=s.mutation.compileMutation(i,n).children;else{if("ENUM_GET"===o.attrs.shim)return l=o.attrs.enumName,a=s.getFieldValue("MEMBER").replace(/^\d+/,""),pxt.blocks.H.mkPropertyAccess(a,pxt.blocks.mkText(l));if("KIND_GET"===o.attrs.shim)return a=i.kinds.filter(e=>e.blockId===o.attrs.blockId)[0],pxt.blocks.H.mkPropertyAccess(s.getFieldValue("MEMBER"),pxt.blocks.mkText(a.name));t=(0,R.visibleParams)(o,(0,R.countOptionals)(s,o)).map((e,t)=>B(i,s,e,n,o.isExtensionMethod&&0===t&&!o.isExpression))}let e=o.namespace,r=o.f;o.attrs.blockAliasFor&&(l=i.blocksInfo.apis.byQName[o.attrs.blockAliasFor])&&(r=l.name,e=l.namespace);var l,a=!s.getInputsInline();if(o.isIdentity)return t[0];if(o.property)return pxt.blocks.H.mkPropertyAccess(r,t[0]);if("@get@"==r)return pxt.blocks.H.mkPropertyAccess(t[1].op.replace(/.*\./,""),t[0]);if("@set@"==r)return pxt.blocks.H.mkAssign(pxt.blocks.H.mkPropertyAccess(t[1].op.replace(/.*\./,"").replace(/@set/,""),t[0]),t[2]);if("@change@"==r)return pxt.blocks.H.mkSimpleCall("+=",[pxt.blocks.H.mkPropertyAccess(t[1].op.replace(/.*\./,"").replace(/@set/,""),t[0]),t[2]]);if(o.isExtensionMethod){if(o.attrs.defaultInstance){let e;(e=(0,R.isMutatingBlock)(s)&&s.mutation.getMutationType()===O.MutatorTypes.DefaultInstanceMutator?s.mutation.compileMutation(i,n):e)?t.unshift(e):t.unshift(pxt.blocks.mkText(o.attrs.defaultInstance))}return pxt.blocks.H.extensionCall(r,t,a)}return e?pxt.blocks.H.namespaceCall(e,r,t,a):pxt.blocks.H.stdCall(r,t,a)}function k(e){e=e.getText();return pxt.blocks.H.mkMultiComment(e.trim())}function I(e,t){return function t(i,s){if(!s)return!1;if("math_number"===s.type||"math_integer"===s.type||"math_number_minmax"===s.type||"math_whole_number"===s.type)return!0;let e=i.stdCallTable[s.type];if(!e)return!1;let o=e.comp;if("TD_ID"===e.attrs.shim&&1===o.parameters.length){let e=s.getFieldValue(o.parameters[0].definitionName);return e?!isNaN(parseInt(e)):t(i,(0,R.getInputTargetBlock)(i,s,o.parameters[0].definitionName))}return!1}(e,t)||"logic_boolean"===t.type||"text"===t.type}function F(e){var t=e.getFieldValue("math_number_minmax"===e.type?"SLIDER":"NUM"),t=parseFloat(t);if(i=t,e=e,isFinite(i)&&!isNaN(i))return t;var i=lf("Number entered is either too large or too small"),t=e;throw(i=new Error(i)).block=t,i}function C(e,t){return pxt.blocks.H.mkNumberLiteral(F(t))}function n(e,t){return pxt.worker.getWorker(pxt.webConfig.workerjs).opAsync(e,t)}s.workerOpAsync=n},{"../fields":70,"../legacyMutations":76,"../toolbox":139,"./environment":13,"./typeChecker":14,"./util":15,"./variables":16,blockly:175}],13:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.mkEnv=i.emptyEnv=i.BlockDeclarationType=i.Point=void 0;let o=e("./util");function n(e,t){return{workspace:e,options:t,stdCallTable:{},userFunctionReturnValues:{},diagnostics:[],errors:[],renames:{oldToNew:{},takenNames:{},oldToNewFunctions:{}},stats:{},enums:[],kinds:[],idToScope:{},blockDeclarations:{},allVariables:[],blocksInfo:null,placeholders:{}}}i.Point=class{constructor(e,t,i,s,o){this.link=e,this.type=t,this.parentType=i,this.childType=s,this.isArrayType=o}},(e=i.BlockDeclarationType||(i.BlockDeclarationType={}))[e.None=0]="None",e[e.Argument=1]="Argument",e[e.Assigned=2]="Assigned",e[e.Implicit=3]="Implicit",i.emptyEnv=n,i.mkEnv=function(e,t,i={}){let s=n(e,i);return(s.blocksInfo=t)&&(Object.keys(t.apis.byQName).forEach(e=>{e=t.apis.byQName[e];!e.pkg||6!==e.kind&&3!==e.kind&&5!==e.kind&&4!==e.kind||(s.renames.takenNames[e.qName]=!0)}),t.enumsByName&&Object.keys(t.enumsByName).forEach(e=>s.enums.push(t.enumsByName[e])),t.kindsByName&&Object.keys(t.kindsByName).forEach(e=>s.kinds.push(t.kindsByName[e])),t.blocks.forEach(e=>{var t,i;s.stdCallTable[e.attributes.blockId]?pxt.reportError("blocks","function already defined",{details:e.attributes.blockId,qualifiedName:e.qName,packageName:e.pkg}):(s.renames.takenNames[e.namespace]=!0,i=!!(t=pxt.blocks.compileInfo(e)).thisParameter,s.stdCallTable[e.attributes.blockId]={namespace:e.namespace,f:e.name,comp:t,attrs:e.attributes,isExtensionMethod:i,isExpression:e.retType&&"void"!==e.retType,imageLiteral:e.attributes.imageLiteral||e.attributes.gridLiteral,imageLiteralColumns:e.attributes.imageLiteralColumns,imageLiteralRows:e.attributes.imageLiteralRows,hasHandler:pxt.blocks.hasHandler(e),property:!e.parameters,isIdentity:"TD_ID"==e.attributes.shim})}),e.getTopBlocks(!1).filter(o.isFunctionDefinition).forEach(e=>{e="procedures_defnoreturn"===e.type?e.getFieldValue("NAME"):e.getField("function_name").getText();(0,o.escapeVarName)(e,s,!0)})),s}},{"./util":15}],14:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isBooleanType=i.isStringType=i.defaultValueForType=i.getEscapedCBParameters=i.isFunctionRecursive=i.getDeclaredVariables=i.lookup=i.getConcreteType=i.attachPlaceholderIf=i.returnType=i.find=i.mkPoint=i.infer=void 0;let s=e("./environment"),g=e("./util"),a=e("../plugins/functions"),m=e("./compiler"),c=e("../loader");function _(e,t){var i,s=v(e),o=v(t);A(null==s.link&&null==o.link),s!=o&&(n(s)?l(e.type,t.type):n(o)?(l(e.type,t.type),e.type=null,s.link=e.link=o,s.isArrayType=o.isArrayType):(s.childType&&o.childType?(i=s.childType,s.childType=null,_(i,o.childType)):s.childType&&!o.childType&&(o.childType=s.childType),s.parentType&&o.parentType?(i=s.parentType,s.parentType=null,_(i,o.parentType)):!s.parentType||o.parentType||o.type||(o.parentType=s.parentType),i=l(s.type,o.type),e.link=o,s.link=o,s.isArrayType=o.isArrayType,e.type=null,t.type=i))}function b(e,t,i,s){I(e,t,i);try{_(y(e,(0,g.getInputTargetBlock)(e,t,i)),s)}catch(e){}}function u(e,t=!1){return new s.Point(null,e,null,null,t)}i.infer=function(e,h,t){function d(e){var t=null==(t=null==(t=e.connection)?void 0:t.getCheck())?void 0:t[0];return e.name?t||"T":void 0}function p(e,t){var i=e.inputList.filter(e=>"T"===d(e));if(i.length){var s,i=(0,g.getInputTargetBlock)(h,e,i[0].name);if(i)return C(i=(s=y(h,i)).type?E(y(h,i).type+"[]"):E(null),s),b(h,e,t,i),!0}return!1}e&&e.filter(e=>e.isEnabled()).forEach(l=>{try{switch(l.type){case"math_op2":b(h,l,"x",E(f.type)),b(h,l,"y",E(f.type));break;case"math_op3":b(h,l,"x",E(f.type));break;case"math_arithmetic":case"logic_compare":switch(l.getFieldValue("OP")){case"ADD":case"MINUS":case"MULTIPLY":case"DIVIDE":case"LT":case"LTE":case"GT":case"GTE":case"POWER":b(h,l,"A",E(f.type)),b(h,l,"B",E(f.type));break;case"AND":case"OR":I(h,l,"A",T.type),I(h,l,"B",T.type);break;case"EQ":case"NEQ":I(h,l,"A"),I(h,l,"B");var e=y(h,(0,g.getInputTargetBlock)(h,l,"A")),t=y(h,(0,g.getInputTargetBlock)(h,l,"B"));try{_(e,t)}catch(e){}}break;case"logic_operation":I(h,l,"A",T.type),I(h,l,"B",T.type);break;case"logic_negate":I(h,l,"BOOL",T.type);break;case"controls_if":for(let e=0;e<=l.elseifCount_;++e)I(h,l,"IF"+e,T.type);break;case"pxt_controls_for":case"controls_simple_for":b(h,l,"TO",E(f.type));break;case"pxt_controls_for_of":case"controls_for_of":var i=(0,g.getInputTargetBlock)(h,l,"LIST");i&&"placeholder"!==i.type?C(y(h,i),w(h,l,(0,g.getLoopVariableField)(h,l).getField("VAR").getText()).type):h.diagnostics.push({blockId:l.id,message:lf("The 'for of' block must have a list input")});break;case"variables_set":case"variables_change":var s=w(h,l,l.getField("VAR").getText()).type,o=(I(h,l,"VALUE"),(0,g.getInputTargetBlock)(h,l,"VALUE"));if(o){a=h;var n=null!=(u=null==(u=(c=o).outputConnection)?void 0:u.getCheck())&&u.length&&"Array"!==u[0]&&"T"!==u[0]?u.map(e=>E(e)):[y(a,c)];let t=v(s);if(t.type&&n.slice(1).some(e=>e.type===t.type))s.link=v(n[0]);else try{_(s,n[0])}catch(e){}}break;case"controls_repeat_ext":b(h,l,"TIMES",E(f.type));break;case"device_while":I(h,l,"COND",T.type);break;case"lists_index_get":b(h,l,"LIST",E("Array")),b(h,l,"INDEX",E(f.type)),C(y(h,(0,g.getInputTargetBlock)(h,l,"LIST")),y(h,l));break;case"lists_index_set":b(h,l,"LIST",E("Array")),I(h,l,"VALUE"),p(l,"LIST"),b(h,l,"INDEX",E(f.type));break;case"function_definition":k(h,l.getField("function_name").getText());break;case"function_call":case"function_call_output":l.getArguments().forEach(e=>{b(h,l,e.id,E(e.type))});break;case pxtc.TS_RETURN_STATEMENT_TYPE:I(h,l,"RETURN_VALUE");break;case pxtc.PAUSE_UNTIL_TYPE:b(h,l,"PREDICATE",T);break;default:if(l.type in h.stdCallTable){let r=h.stdCallTable[l.type];"ENUM_GET"!==r.attrs.shim&&"KIND_GET"!==r.attrs.shim&&(0,g.visibleParams)(r,(0,g.countOptionals)(l,r)).forEach((t,e)=>{var i,e=r.isExtensionMethod&&0===e;if(t.definitionName&&!l.getFieldValue(t.definitionName)){var s=l.inputList.find(e=>e.name==t.definitionName),o=null==(i=null==s?void 0:s.connection)?void 0:i.getCheck();if(o){if(e&&"Array"===d(s))if(p(l,t.definitionName))return;for(let e=0;e<o.length;e++)try{var n=o[e];b(h,l,t.definitionName,E(n));break}catch(e){}}}})}}}catch(e){var r=e.block||l;r.setWarningText(e+"",m.PXT_WARNING_ID),h.errors.push(r)}var a,c,u}),h.allVariables.forEach(e=>{null==S(e.type).type&&(e.isFunctionParameter?e.type.isArrayType&&(e.type.type="any[]"):_(e.type,E(e.type.isArrayType?"number[]":f.type)))})};let f=(i.mkPoint=u)("number"),T=u("boolean"),o=u("string"),r=u("void");function E(e){if(!e)return u(e);switch(e.toLowerCase()){case"number":return f;case"boolean":return T;case"string":return o;case"void":return r;default:return u(e)}}function v(e){return e.link?v(e.link):e}function n(e){return e===f||e===T||e===o||e===r}function y(i,s){var e;if(A(null!=s),"placeholder"==(o=s).type||o.type===pxtc.TS_OUTPUT_TYPE)return s.p||(s.p=u(null)),v(s.p);if("variables_get"==s.type)return v(w(i,s,s.getField("VAR").getText()).type);if("function_call_output"==s.type)return o=i,e=(e=s).getField("function_name").getText(),k(o,e);if(!s.outputConnection)return E(r.type);var o=(null==(e=null==(o=s.outputConnection)?void 0:o.getCheck())?void 0:e[0])||"T";if("Array"===o){var n=s.outputConnection.getCheck();if(1<n.length)return E(n[1]);let e;if("lists_create_with"==s.type){if(s.inputList&&s.inputList.length)for(var t of s.inputList)if(t.connection&&t.connection.targetBlock()){t=v(y(i,t.connection.targetBlock()));if(t){if(t.parentType)return t.parentType;C(e=t.type?E(t.type+"[]"):u(null),t);break}}}else"argument_reporter_array"==s.type&&(e=e||w(i,s,s.getFieldValue("VALUE")).type);return e&&(e.isArrayType=!0),e||u(null,!0)}if("T"!==o)return E(o);{let t=i.stdCallTable[s.type];var n="lists_index_get"===s.type;if(n||t&&t.comp.thisParameter){let e;if((e=n?s.inputList.find(e=>"LIST"===e.name):s.inputList.find(e=>e.name===t.comp.thisParameter.definitionName)).connection&&e.connection.targetBlock())return(o=y(i,e.connection.targetBlock())).childType||(n=h(o.type)&&"Array"!==o.type?u(o.type.substr(0,o.type.length-2)):u(null),C(o,n),n)}return u(null)}}function k(i,s){if(!i.userFunctionReturnValues[s]){var o=(0,a.getDefinition)(s,i.workspace);let t=u("void");if(d(i,o,!0))t=u("any");else{var e,n=[];for(e of o.getDescendants(!1))"function_return"===e.type&&(I(i,e,"RETURN_VALUE"),n.push(y(i,(0,g.getInputTargetBlock)(i,e,"RETURN_VALUE"))));if(n.length)try{var r,l=u(null);for(r of n)_(l,r);t=l}catch(e){i.diagnostics.push({blockId:o.id,message:pxt.Util.lf("Function '{0}' has an invalid return type",s)}),t=u("any")}}i.userFunctionReturnValues[s]=t}return i.userFunctionReturnValues[s]}function l(e,t){if(null==e||"Array"===e&&h(t))return t;if(null==t||"Array"===t&&h(e))return e;if(e==t)return e;throw new Error("cannot mix "+e+" with "+t)}function h(e){return e&&(-1!==e.indexOf("[]")||"Array"==e)}function I(e,t,i,s){var o,n=t.getInputTargetBlock(i);n?n.type!==pxtc.TS_OUTPUT_TYPE||n.p||(n.p=u(null)):(e.placeholders[t.id]||(e.placeholders[t.id]={}),e.placeholders[t.id][i]||(e.placeholders[t.id][i]=(n=e,o=t,{type:"placeholder",p:u(s||null),workspace:n.workspace,parentBlock_:o,getParent:()=>o})))}function C(e,t){e=v(e),t=v(t);e.childType?_(e.childType,t):e.type||(e.childType=t),t.parentType?_(t.parentType,e):t.type||(t.parentType=e),h(e.type)&&(e.isArrayType=!0)}function S(e,t=[]){e=v(e);if(-1===t.indexOf(e)&&(t.push(e),!e.type||"Array"===e.type)){if(e.parentType){var i=S(e.parentType,t);if(i.type&&"Array"!==i.type)return h(i.type)?e.type=i.type.substr(0,i.type.length-2):e.type=i.type,e}if(e.childType){i=S(e.childType,t);if(i.type)e.type=i.type+"[]"}}return e}function w(e,t,i){return function e(t,i){return i&&i.declaredVars[t]?i.declaredVars[t]:i&&i.parent?e(t,i.parent):null}(i,e.idToScope[t.id])}function d(o,e,n){let r=(0,g.getFunctionName)(e),l={};return function t(e){let i;i=n?e.getDescendants(!1).filter(e=>"function_return"==e.type).map(e=>(0,g.getInputTargetBlock)(o,e,"RETURN_VALUE")).filter(e=>e&&"function_call_output"===e.type):e.getDescendants(!1).filter(e=>"function_call_output"==e.type);for(var s of i){let e=(0,g.getFunctionName)(s);if(e===r)return!0;if(!l[e]&&(l[e]=!0,t((0,a.getDefinition)(e,s.workspace))))return!0}return!1}(e)}function p(i,s,o){var n=[];if(s.attrs.draggableParameters)for(let t=0;t<s.comp.handlerArgs.length;t++){var r=s.comp.handlerArgs[t];let e;var l=(0,g.getInputTargetBlock)(o,i,c.DRAGGABLE_PARAM_INPUT_PREFIX+r.name);if(null==(e="reporter"===s.attrs.draggableParameters?l&&l.getFieldValue("VALUE"):l&&l.getField("VAR").getText()))break;n.push({name:e,type:u(r.type)})}else for(let e=0;e<s.comp.handlerArgs.length;e++){var t=s.comp.handlerArgs[e],a=i.getField("HANDLER_"+t.name),a=a&&a.getText();if(null===a)break;n.push({name:a,type:u(t.type)})}return n}function A(e){if(!e)throw new Error("Assertion failure")}i.find=v,i.returnType=y,i.attachPlaceholderIf=I,i.getConcreteType=S,i.lookup=w,i.getDeclaredVariables=function(e,t){switch(e.type){case"pxt_controls_for":case"controls_simple_for":return[{name:(0,g.getLoopVariableField)(t,e).getField("VAR").getText(),type:f}];case"pxt_controls_for_of":case"controls_for_of":return[{name:(0,g.getLoopVariableField)(t,e).getField("VAR").getText(),type:u(null)}];case"function_definition":return e.getArguments().filter(e=>"Array"===e.type).map(e=>{var t=u(null);return t.isArrayType=!0,{name:e.name,type:t,isFunctionParameter:!0}})}if((0,g.isMutatingBlock)(e)){let t=e.mutation.getDeclaredVariables();if(t)return Object.keys(t).map(e=>({name:e,type:u(t[e])}))}var i=t.stdCallTable[e.type];return i&&i.comp.handlerArgs.length?p(e,i,t):[]},i.isFunctionRecursive=d,i.getEscapedCBParameters=function(t,e,i){return p(t,e,i).map(e=>w(i,t,e.name).escapedName)},i.defaultValueForType=function(e){if(null==e.type&&(_(e,E(f.type)),e=v(e)),h(e.type)||e.isArrayType)return pxt.blocks.mkText("[]");switch(e.type){case"boolean":return pxt.blocks.H.mkBooleanLiteral(!1);case"number":return pxt.blocks.H.mkNumberLiteral(0);case"string":return pxt.blocks.H.mkStringLiteral("");default:return pxt.blocks.mkText("null")}},i.isStringType=function(e){return e===o},i.isBooleanType=function(e){return e===T}},{"../loader":77,"../plugins/functions":111,"./compiler":12,"./environment":13,"./util":15}],15:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isFunctionDefinition=i.append=i.escapeVarName=i.isMutatingBlock=i.getInputTargetBlock=i.countOptionals=i.visibleParams=i.getFunctionName=i.getLoopVariableField=i.printScope=i.forEachStatementInput=i.forEachChildExpression=void 0;let o=e("blockly");function n(t){let i="";for(let e=0;e<t;e++)i+="    ";return i}function s(e,t,i){var s=t.getInputTargetBlock(i);return s||(null==(s=e.placeholders[t.id])?void 0:s[i])}i.forEachChildExpression=function t(e,i,s=!1){e.inputList.filter(e=>e.type===o.inputs.inputTypes.VALUE).forEach(e=>{e.connection&&e.connection.targetBlock()&&(i(e.connection.targetBlock()),s)&&t(e.connection.targetBlock(),i,s)})},i.forEachStatementInput=function(e,t){e.inputList.filter(e=>e.type===o.inputs.inputTypes.STATEMENT).forEach(e=>{e.connection&&e.connection.targetBlock()&&t(e.connection.targetBlock())})},i.printScope=function t(i,s=0){var e=Object.keys(i.declaredVars).map(e=>`${e}(${i.declaredVars[e].id})`).join(",");i.referencedVars.join(", ");pxt.log(n(s)+"SCOPE: "+(i.firstStatement?i.firstStatement.type:"TOP-LEVEL")),e.length&&pxt.log(n(s)+"DECS: "+e),i.children.forEach(e=>t(e,s+1))},i.getLoopVariableField=function(e,t){return"pxt_controls_for"==t.type||"pxt_controls_for_of"==t.type?s(e,t,"VAR"):t},i.getFunctionName=function(e){return e.getField("function_name").getText()},i.visibleParams=function({comp:e},t){let i=[];return e.thisParameter&&i.push(e.thisParameter),e.parameters.forEach(e=>{e.isOptional&&0<t?(i.push(e),--t):e.isOptional||i.push(e)}),i},i.countOptionals=function(e,t){if(t.attrs.compileHiddenArguments)return t.comp.parameters.reduce((e,t)=>(t.isOptional&&e++,e),0);if(e.mutationToDom){t=e.mutationToDom();if(t.hasAttribute("_expanded"))return e=parseInt(t.getAttribute("_expanded")),isNaN(e)?0:Math.max(e,0)}return 0},i.getInputTargetBlock=s,i.isMutatingBlock=function(e){return!!e.mutation},i.escapeVarName=function(e,t,i=!1){if(!e)return"_";if(i){if(t.renames.oldToNewFunctions[e])return t.renames.oldToNewFunctions[e]}else if(t.renames.oldToNew[e])return t.renames.oldToNew[e];let s=ts.pxtc.escapeIdentifier(e);if(t.renames.takenNames[s]){let e=2;for(;t.renames.takenNames[s+e];)e++;s+=e}return i?(t.renames.oldToNewFunctions[e]=s,t.renames.takenNames[s]=!0):t.renames.oldToNew[e]=s,s},i.append=function(e,t){e.push.apply(e,t)},i.isFunctionDefinition=function(e){return"procedures_defnoreturn"===e.type||"function_definition"===e.type}},{blockly:175}],16:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.trackAllVariables=void 0;let a=e("blockly"),c=e("./environment"),u=e("./typeChecker"),h=e("./util");function d(e,t){if(-1!==e.referencedVars.indexOf(t))return!0;for(var i of e.children)if(d(i,t))return!0;return!1}function p(e,t){if(-1!==e.assignedVars.indexOf(t))return!0;for(var i of e.children)if(p(i,t))return!0;return!1}i.trackAllVariables=function(e,t){let n=1,i;return e.forEach(e=>{e.type===ts.pxtc.ON_START_TYPE&&(e=e.getInputTargetBlock("HANDLER"))&&r(e,i={firstStatement:e,declaredVars:{},referencedVars:[],children:[],assignedVars:[]},t)}),i=i||{firstStatement:null,declaredVars:{},referencedVars:[],children:[],assignedVars:[]},e.forEach(e=>{e.type!==ts.pxtc.ON_START_TYPE&&r(e,i,t)}),Object.keys(i.declaredVars).forEach(e=>{var t=i.declaredVars[e];delete i.declaredVars[e],(function e(t,i){let s;if(-1!==t.referencedVars.indexOf(i))return t;for(var o of t.children)if(d(o,i)){if(p(o,i))return t;if(s)return t;s=o}return s?e(s,i):void 0}(i,t.id)||i).declaredVars[e]=t}),function t(i,s){let o=Object.keys(i.declaredVars);if(o.length){let e=o.map(e=>i.declaredVars[e]);i.firstStatement&&(s.blockDeclarations[i.firstStatement.id]=e.concat(s.blockDeclarations[i.firstStatement.id]||[])),e.forEach(e=>s.allVariables.push(e))}i.children.forEach(e=>t(e,s))}(i,t),function t(s,o){for(var i of Object.keys(s.declaredVars)){let e=s.declaredVars[i];e.escapedName||(e.escapedName=n(i))}s.children.forEach(e=>t(e,o));function n(t){if(!t)return"_";let i=ts.pxtc.escapeIdentifier(t);if(o.renames.takenNames[i]||r(i,s,t)){let e=2;for(;o.renames.takenNames[i+e]||r(i+e,s,t);)e++;i+=e}return i}function r(t,i,s){if(i){for(var o of Object.keys(i.declaredVars)){let e=i.declaredVars[o];if((s!==e.name||e.name!==e.escapedName)&&e.escapedName===t)return!0}return r(t,i.parent,s)}return!1}}(i,t),i;function r(e,t,s){if(s.idToScope[e.id]=t,"variables_get"===e.type?(o=l(e.getField("VAR").getText(),t),t.referencedVars.push(o.id)):"variables_set"===e.type||"variables_change"===e.type?(o=l(e.getField("VAR").getText(),t),t.assignedVars.push(o.id),t.referencedVars.push(o.id)):e.type===pxtc.TS_STATEMENT_TYPE&&(o=e.declaredVariables)&&o.split(",").forEach(e=>{l(e,t).alreadyDeclared=c.BlockDeclarationType.Argument}),e.inputList.some(e=>e.type===a.inputs.inputTypes.STATEMENT)){var o=(0,u.getDeclaredVariables)(e,s).map(e=>Object.assign(Object.assign({},e),{id:n++}));let i=t;o.length&&(i={parent:t,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]},o.forEach(e=>{e.alreadyDeclared=c.BlockDeclarationType.Assigned,i.declaredVars[e.name]=e}),s.idToScope[e.id]=i),t!==i&&t.children.push(i),(0,h.forEachChildExpression)(e,e=>{r(e,i,s)}),(0,h.forEachStatementInput)(e,e=>{var t={parent:i,firstStatement:e,declaredVars:{},referencedVars:[],assignedVars:[],children:[]};i.children.push(t),r(e,t,s)})}else(0,h.forEachChildExpression)(e,e=>{r(e,t,s)});e.nextConnection&&e.nextConnection.targetBlock()&&r(e.nextConnection.targetBlock(),t,s)}function l(e,t){return t.declaredVars[e]||(t.parent?l(e,t.parent):(t.declaredVars[e]={name:e,type:(0,u.mkPoint)(null),id:n++},t.declaredVars[e]))}}},{"./environment":13,"./typeChecker":14,"./util":15,blockly:175}],17:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initVariableReporterArgs=i.initExpandableBlock=i.initVariableArgsBlock=i.appendMutation=void 0;let x=e("blockly"),R=e("./toolbox"),O=e("./constants"),u=e("./fields"),p=e("./loader"),N=e("./fields/field_imagenotext"),g=e("./plugins/duplicateOnDrag");function $(e,t){let i=e.mutationToDom,s=e.domToMutation;e.mutationToDom=()=>{var e=i?i():document.createElement("mutation");return t.mutationToDom(e)},e.domToMutation=e=>{s&&s(e),t.domToMutation(e)}}i.appendMutation=$,i.initVariableArgsBlock=function(n,r){let l=0,a=0,c=n.appendDummyInput(),o=()=>{if(l!==a){if(l>a){var t=l-a;for(let e=0;e<t;e++){var i=r[a+e],i=(c.insertFieldAt(c.fieldRow.length-1,new u.FieldArgumentVariable(i.name),"HANDLER_"+i.name),n);null!=i&&i.initSvg&&i.initSvg()}}else{var s=a-l;for(let e=0;e<s;e++){var o=r[a-e-1];c.removeField("HANDLER_"+o.name)}}l>=r.length?c.removeField("_HANDLER_ADD"):a>=r.length&&e(),a=l}};function e(){c.appendField(new N.FieldImageNoText(n.ADD_IMAGE_DATAURI,24,24,lf("Add argument"),()=>{l=Math.min(l+1,r.length),o()},!1),"_HANDLER_ADD")}x.Extensions.apply("inline-svgs",n,!1),e(),$(n,{mutationToDom:t=>{t.setAttribute("numArgs",l.toString());for(let e=0;e<l;e++){var i=n.getField("HANDLER_"+r[e].name),i=i&&i.getText();t.setAttribute("arg"+e,i)}return t},domToMutation:t=>{var e=parseInt(t.getAttribute("numargs"));l=Math.min(isNaN(e)?0:e,r.length),o();for(let e=0;e<l;e++){var i=t.getAttribute("arg"+e),s="HANDLER_"+r[e].name;n.getField(s)&&(0,p.setVarFieldValue)(n,s,i)}}})},i.initExpandableBlock=function(s,r,l,a,e,t){let i="0_add_button",o="0_rem_button",n="0_add_rem_button",c="_expanded",u="_input_init",h=l.parameters.map(e=>e.name),d=l.parameters.length,p=e?d:1,g="variable"===s.blocksById[r.type].attributes.inlineInputMode,m=s.blocksById[r.type].attributes.inlineInputModeLimit||4;var e=s.blocksById[r.type].attributes.compileHiddenArguments,_=s.blocksById[r.type].attributes.expandableArgumentBreaks;let b,f=(_&&(b=_.split(/[;,]/).map(e=>parseInt(e))),new L(r)),T=(f.setEventsEnabled(!1),f.setValue(c,0),f.setValue(u,!1),f.setEventsEnabled(!0),x.Extensions.apply("inline-svgs",r,!1),!1),E=!0;if($(r,{mutationToDom:e=>(e.setAttribute(c,f.getString(c)),e.setAttribute(u,f.getString(u)),e),domToMutation:e=>{f.setEventsEnabled(!1),e.hasAttribute(u)&&"true"==e.getAttribute(u)&&!f.getBoolean(u)&&f.setValue(u,!0),C(),e.hasAttribute(c)&&(e=parseInt(e.getAttribute(c)),isNaN(e)||(e=e-(f.getNumber(c)||0),f.getBoolean(u)?r.rendered||r.isInsertionMarker()?y(e,!0,r.isInsertionMarker()):(f.setValue(c,S(e)),I()):y(e,!0))),f.setEventsEnabled(!0)}}),C(),e){let t=0;for(let e=0;e<r.inputList.length;e++){var v=r.inputList[e];!pxt.Util.startsWith(v.name,O.optionalInputWithFieldPrefix)&&-1===h.indexOf(v.name)||(!v.connection||v.connection.isConnected()||r.isInsertionMarker()||A(v,a.definitionNameToParam[l.parameters[t].name]),++t)}}function y(e,i=!1,t=!1){e=S(e);if(t||i||e!==f.getNumber(c)){f.setValue(c,e);var s=e;if(f.getBoolean(u)||!(0<s)||(C(),r.rendered)){let t=0;for(let e=0;e<r.inputList.length;e++){var o,n=r.inputList[e];pxt.Util.startsWith(n.name,O.optionalDummyInputPrefix)?w(n,t<s||s===d):!pxt.Util.startsWith(n.name,O.optionalInputWithFieldPrefix)&&-1===h.indexOf(n.name)||(w(n,o=t<s),o&&n.connection&&!n.connection.isConnected()&&!r.isInsertionMarker()&&A(n,a.definitionNameToParam[l.parameters[t].name]),++t)}I(),g&&r.setInputsInline(s<m),i||r.queueRender()}}}function k(e,t,i,s){r.appendDummyInput(e).appendField(new N.FieldImageNoText(t,24,24,i,()=>y(s),!1))}function I(){var e,t;T||(e=(t=f.getNumber(c))!==d,t=0!==t,r.inputList.some(e=>e.name===i)&&r.removeInput(i,!0),r.inputList.some(e=>e.name===o)&&r.removeInput(o,!0),r.inputList.some(e=>e.name===n)&&r.removeInput(n,!0),e&&t?r.appendDummyInput(n).appendField(new N.FieldImageNoText(r.REMOVE_IMAGE_DATAURI,24,24,lf("Hide optional arguments"),()=>y(-1*p),!1)).appendField(new N.FieldImageNoText(r.ADD_IMAGE_DATAURI,24,24,lf("Reveal optional arguments"),()=>y(p),!1)):e?k(i,r.ADD_IMAGE_DATAURI,lf("Reveal optional arguments"),p):t&&k(o,r.REMOVE_IMAGE_DATAURI,lf("Hide optional arguments"),-1*p))}function C(){f.setValue(u,!0),t(),I()}function S(e){var t=Math.min(Math.max(f.getNumber(c)+e,0),d);if(b){if(0<=e){if(0===t)return 0;for(var i of b)if(i>=t)return i;return d}for(let e=0;e<b.length;e++)if(b[e]>=t)return 0<e?b[e-1]:0;return b[b.length-1]}return t}function w(e,t){e.setVisible(t)}function A(t,e){let i=(0,R.createShadowValue)(s,e);"value"===i.tagName.toLowerCase()&&(i=i.firstElementChild),x.Events.disable();try{let e;r.initialized?e=x.Xml.domToBlock(i,r.workspace):(e=x.Xml.domToBlockInternal(i,r.workspace),setTimeout(()=>{e.isInsertionMarker()&&(x.Events.disable(),e.dispose(),x.Events.enable())})),e&&t.connection.connect(e.outputConnection)}catch(e){}x.Events.enable()}r.mixin({updateBeforeRender:()=>{T||E&&(E=!1,y(0,void 0,T=!0),T=!1)}})},i.initVariableReporterArgs=function(r,l,a){let c="0_add_button",u="numargs",h=new L(r),e=(h.setEventsEnabled(!1),h.setValue(u,0),h.setEventsEnabled(!0),x.Extensions.apply("inline-svgs",r,!1),()=>{for(var e of l){var t,i,s,o=r.getInput(p.DRAGGABLE_PARAM_INPUT_PREFIX+e.name);if(!o)break;o.connection.targetConnection||(x.Events.disable(),s=pxt.blocks.reporterTypeForArgType(e.type),(t=document.createElement("block")).setAttribute("type",s),(i=document.createElement("field")).setAttribute("name","VALUE"),i.textContent=e.name,t.appendChild(i),"argument_reporter_custom"===s&&((i=document.createElement("mutation")).setAttribute("type",e.type),t.appendChild(i)),s=x.Xml.domToBlock(t,r.workspace),o.connection.connect(s.outputConnection),!r.isInsertionMarker()&&s instanceof x.BlockSvg&&(s.initSvg(),s.queueRender()),x.Events.enable())}}),d=()=>{var t=r.inputList.filter(e=>e.name.startsWith(p.DRAGGABLE_PARAM_INPUT_PREFIX)).length,i=r.inputList.some(e=>e.name===c);if(t<h.getNumber(u))for(let e=t;e<h.getNumber(u);e++){var s,o=l[e];o&&((s=r.appendValueInput(p.DRAGGABLE_PARAM_INPUT_PREFIX+o.name)).setCheck((0,p.getBlocklyCheckForType)(o.type,a)),(0,g.setDuplicateOnDrag)(r.type,s.name),i?r.moveInputBefore(s.name,c):r.moveInputBefore(s.name,"HANDLER"))}else if(t>h.getNumber(u))for(let e=t-1;e>=h.getNumber(u);e--){var n=l[e];n&&((n=r.getInput(p.DRAGGABLE_PARAM_INPUT_PREFIX+n.name)).connection.targetConnection&&(x.Events.disable(),n.connection.targetBlock().dispose(),x.Events.enable()),r.removeInput(n.name,!0))}h.getNumber(u)<l.length?i||(r.appendDummyInput(c).appendField(new N.FieldImageNoText(r.ADD_IMAGE_DATAURI,24,24,lf("Add argument"),()=>{h.setValue(u,h.getNumber(u)+1),d()},!1)),r.moveInputBefore(c,"HANDLER")):i&&r.removeInput(c,!0),setTimeout(e)};d(),$(r,{mutationToDom:e=>(e.setAttribute(u,h.getString(u)),e),domToMutation:e=>{h.setEventsEnabled(!1),e.hasAttribute(u)&&(e=parseInt(e.getAttribute(u)),isNaN(e)||(h.setValue(u,e),d())),h.setEventsEnabled(!0)}})};class L{constructor(e,t){this.block=e,this.fireEvents=!0,this.state=t||{}}setValue(e,s){if(this.fireEvents&&this.block.mutationToDom){let t=this.block.mutationToDom(),i=(this.state[e]=s.toString(),this.block.mutationToDom());Object.keys(this.state).forEach(e=>{t.getAttribute(e)!==this.state[e]&&i.setAttribute(e,this.state[e])});var o=x.Xml.domToText(t),n=x.Xml.domToText(i);o!=n&&x.Events.fire(new x.Events.BlockChange(this.block,"mutation",null,o,n))}else this.state[e]=s.toString()}getNumber(e){return parseInt(this.state[e])}getBoolean(e){return"false"!=this.state[e]}getString(e){return this.state[e]}setEventsEnabled(e){this.fireEvents=e}}},{"./constants":18,"./fields":70,"./fields/field_imagenotext":38,"./loader":77,"./plugins/duplicateOnDrag":91,"./toolbox":139,blockly:175}],18:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.optionalInputWithFieldPrefix=i.optionalDummyInputPrefix=i.provider=void 0;e=e("blockly");i.provider=new e.zelos.ConstantProvider,i.optionalDummyInputPrefix="0_optional_dummy",i.optionalInputWithFieldPrefix="0_optional_field"},{blockly:175}],19:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.registerBlockitems=i.BlockContextWeight=void 0;let s=e("blockly"),o=e("../external");var n;(e=n=i.BlockContextWeight||(i.BlockContextWeight={}))[e.Duplicate=10]="Duplicate",e[e.Copy=15]="Copy",e[e.AddComment=20]="AddComment",e[e.ExpandCollapse=30]="ExpandCollapse",e[e.DeleteBlock=40]="DeleteBlock",e[e.Help=50]="Help",i.registerBlockitems=function(){s.ContextMenuRegistry.registry.unregister("blockDuplicate"),s.ContextMenuRegistry.registry.unregister("blockCollapseExpand"),s.ContextMenuRegistry.registry.unregister("blockHelp"),s.ContextMenuRegistry.registry.unregister("blockInline"),e={displayText(){return lf("Duplicate")},preconditionFn(e){e=e.block;return!e.isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden"},callback(t){if(t.block){let e=!1;t.block.duplicateOnDrag_&&(t.block.duplicateOnDrag_=!1,e=!0);var i=t.block.toCopyData();e&&(t.block.duplicateOnDrag_=!0),i&&s.clipboard.paste(i,t.block.workspace)}},scopeType:s.ContextMenuRegistry.ScopeType.BLOCK,id:"blockDuplicate",weight:n.Duplicate},s.ContextMenuRegistry.registry.register(e),e={displayText(e){return e.block.isCollapsed()?pxt.U.lf("Expand Block"):pxt.U.lf("Collapse Block")},preconditionFn(e){let t=e.block;return t.workspace.getTopBlocks(!1).some(e=>e===t)&&0<t.statementInputCount&&!t.previousConnection&&!t.isInFlyout&&t.isMovable()&&t.workspace.options.collapse?"enabled":"hidden"},callback(e){e.block&&(pxt.tickEvent("blocks.context.expandCollapseBlock",void 0,{interactiveConsent:!0}),e.block.setCollapsed(!e.block.isCollapsed()))},scopeType:s.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtExpandCollapseBlock",weight:n.ExpandCollapse},s.ContextMenuRegistry.registry.register(e),e={displayText(){return pxt.U.lf("Help")},preconditionFn(e){e=e.block;return("function"==typeof e.helpUrl?e.helpUrl():e.helpUrl)?"enabled":"hidden"},callback(e){e.block&&(e="function"==typeof(e=e.block).helpUrl?e.helpUrl():e.helpUrl)&&(0,o.openHelpUrl)(e)},scopeType:s.ContextMenuRegistry.ScopeType.BLOCK,id:"pxtHelpBlock",weight:n.Help},s.ContextMenuRegistry.registry.register(e);var e=s.ContextMenuRegistry.registry.getItem("blockDelete");e&&(e.weight=n.DeleteBlock),(e=s.ContextMenuRegistry.registry.getItem("blockComment"))&&(e.weight=n.AddComment)}},{"../external":25,blockly:175}],20:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setupWorkspaceContextMenu=i.initContextMenu=void 0;let s=e("blockly"),o=e("./workspaceItems"),n=e("../external"),r=e("./blockItems"),l=!1;i.initContextMenu=function(){var e=s.Msg;e.DUPLICATE_BLOCK=lf("{id:block}Duplicate"),e.DUPLICATE_COMMENT=lf("Duplicate Comment"),e.REMOVE_COMMENT=lf("Remove Comment"),e.ADD_COMMENT=lf("Add Comment"),e.EXTERNAL_INPUTS=lf("External Inputs"),e.INLINE_INPUTS=lf("Inline Inputs"),e.EXPAND_BLOCK=lf("Expand Block"),e.COLLAPSE_BLOCK=lf("Collapse Block"),e.ENABLE_BLOCK=lf("Enable Block"),e.DISABLE_BLOCK=lf("Disable Block"),e.DELETE_BLOCK=lf("Delete Block"),e.DELETE_X_BLOCKS=lf("Delete Blocks"),e.DELETE_ALL_BLOCKS=lf("Delete All Blocks"),e.HELP=lf("Help"),l||(l=!0,(0,o.registerWorkspaceItems)(),(0,r.registerBlockitems)())},i.setupWorkspaceContextMenu=function(i){try{s.ContextMenuItems.registerCommentOptions()}catch(e){}i.configureContextMenu=(e,t)=>{(0,n.onWorkspaceContextMenu)(i,e)}}},{"../external":25,"./blockItems":19,"./workspaceItems":22,blockly:175}],21:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./contextMenu"),i)},{"./contextMenu":20}],22:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.registerWorkspaceItems=i.WorkspaceContextWeight=void 0;let r=e("blockly"),o=e("../layout"),s=e("../external");var l;(e=l=i.WorkspaceContextWeight||(i.WorkspaceContextWeight={}))[e.Paste=10]="Paste",e[e.DeleteAll=20]="DeleteAll",e[e.FormatCode=30]="FormatCode",e[e.CollapseBlocks=40]="CollapseBlocks",e[e.ExpandBlocks=50]="ExpandBlocks",e[e.Snapshot=60]="Snapshot",e[e.Find=70]="Find",i.registerWorkspaceItems=function(){var e;e={displayText(){return pxt.U.lf("Format Code")},preconditionFn(e){return e.workspace.options.readOnly?"hidden":"enabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.format",void 0,{interactiveConsent:!0}),(0,o.flow)(e.workspace,{useViewWidth:!0}))},scopeType:r.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtFormatCode",weight:l.FormatCode},r.ContextMenuRegistry.registry.register(e),e={displayText(){return pxt.U.lf("Snapshot")},preconditionFn(e){var t;return(0,o.screenshotEnabled)()?(t=(e=e.workspace).getTopBlocks(!1),e=e.getTopComments(!1),0===t.length&&0===e.length?"disabled":"enabled"):"hidden"},callback(s){s.workspace&&(pxt.tickEvent("blocks.context.screenshot",void 0,{interactiveConsent:!0}),(async()=>{let e,t,i=await(0,o.screenshotAsync)(s.workspace,null,null==(e=pxt.appTarget.appTheme)?void 0:e.embedBlocksInSnapshot);pxt.BrowserUtils.isSafari()&&(i=await(0,o.screenshotAsync)(s.workspace,null,null==(t=pxt.appTarget.appTheme)?void 0:t.embedBlocksInSnapshot)),pxt.BrowserUtils.isSafari()&&(i=i.replace(/^data:image\/[^;]/,"data:application/octet-stream")),pxt.BrowserUtils.browserDownloadDataUri(i,`${pxt.appTarget.nickname||pxt.appTarget.id}-${lf("screenshot")}.png`)})())},scopeType:r.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtSnapshotCode",weight:l.Snapshot},r.ContextMenuRegistry.registry.register(e),e={displayText(){return pxt.U.lf("Collapse Blocks")},preconditionFn(e){e=e.workspace;return e.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":e.getTopBlocks(!1).some(e=>e.isEnabled()&&!e.isCollapsed())?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.collapse",void 0,{interactiveConsent:!0}),(0,o.setCollapsedAll)(e.workspace,!0))},scopeType:r.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtCollapseBlocks",weight:l.CollapseBlocks},r.ContextMenuRegistry.registry.register(e),e={displayText(){return pxt.U.lf("Expand Blocks")},preconditionFn(e){e=e.workspace;return e.options.readOnly||!pxt.appTarget.appTheme.blocksCollapsing?"hidden":e.getTopBlocks(!1).some(e=>e.isEnabled()&&e.isCollapsed())?"enabled":"disabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.expand",void 0,{interactiveConsent:!0}),(0,o.setCollapsedAll)(e.workspace,!1))},scopeType:r.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtExpandBlocks",weight:l.ExpandBlocks},r.ContextMenuRegistry.registry.register(e);{let n=e=>{let i=[],s=e=>{if(e.isDeletable())i.push(...e.getDescendants(!1));else for(var t of e.getChildren(!1))s(t)};for(var t of e.getTopBlocks())s(t);return i},e={displayText(e){return 1<n(e.workspace).filter(e=>!e.isShadow()).length?pxt.U.lf("Delete All Blocks"):pxt.U.lf("Delete Block")},preconditionFn(e){return e.workspace.options.readOnly?"hidden":0===n(e.workspace).filter(e=>!e.isShadow()).length?"disabled":"enabled"},callback(e){if(e.workspace){let t=n(e.workspace);e=t.filter(e=>!e.isShadow()).length;let i=10,s=r.utils.idGenerator.genUid(),o=()=>{var e=t.shift();e&&(e.isDeadOrDying()?o():(r.Events.setGroup(s),e.dispose(!1,!0),r.Events.setGroup(!1),setTimeout(o,i)))};pxt.tickEvent("blocks.context.delete",void 0,{interactiveConsent:!0}),e<2?o():r.dialog.confirm(lf("Delete all {0} blocks?",e),e=>{e&&o()})}},scopeType:r.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtDeleteAllBlocks",weight:l.DeleteAll};r.ContextMenuRegistry.registry.register(e)}e={displayText(){return pxt.U.lf("Findâ€¦")},preconditionFn(e){return e.workspace.options.readOnly||!pxt.appTarget.appTheme.workspaceSearch?"hidden":"enabled"},callback(e){e.workspace&&(pxt.tickEvent("blocks.context.find",void 0,{interactiveConsent:!0}),(0,s.openWorkspaceSearch)())},scopeType:r.ContextMenuRegistry.ScopeType.WORKSPACE,id:"pxtWorkspaceFind",weight:l.Find},r.ContextMenuRegistry.registry.register(e),r.ContextMenuRegistry.registry.unregister("workspaceDelete"),r.ContextMenuRegistry.registry.unregister("expandWorkspace"),r.ContextMenuRegistry.registry.unregister("collapseWorkspace"),r.ContextMenuRegistry.registry.unregister("cleanWorkspace"),r.ContextMenuRegistry.registry.unregister("redoWorkspace"),r.ContextMenuRegistry.registry.unregister("undoWorkspace")}},{"../external":25,"../layout":75,blockly:175}],23:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.initAccessibleBlocksCopyPasteContextMenu=i.initCopyPaste=void 0;let o=e("blockly"),n=e("./external"),s=e("./contextMenu/blockItems"),r=e("./contextMenu/workspaceItems"),l=e("./plugins/duplicateOnDrag"),a,c,u;i.initCopyPaste=function(e){var t;a||!(0,n.getCopyPasteHandlers)()||(t=o.ShortcutRegistry.registry.getRegistry(),a=Object.assign({},t[o.ShortcutItems.names.COPY]),c=Object.assign({},t[o.ShortcutItems.names.CUT]),u=Object.assign({},t[o.ShortcutItems.names.PASTE]),o.ShortcutRegistry.registry.unregister(o.ShortcutItems.names.COPY),o.ShortcutRegistry.registry.unregister(o.ShortcutItems.names.CUT),o.ShortcutRegistry.registry.unregister(o.ShortcutItems.names.PASTE),t={name:o.ShortcutItems.names.COPY,preconditionFn(e,t){return g(e,t,a.preconditionFn)},callback:d,keyCodes:a.keyCodes},o.ShortcutRegistry.registry.register(t),t={name:o.ShortcutItems.names.CUT,preconditionFn(e,t){return g(e,t,c.preconditionFn)},callback(e,t,i,s){var o=null==(o=(0,n.getCopyPasteHandlers)())?void 0:o.cut;return o?o(e,t,i,s):c.callback(e,t,i,s)},keyCodes:c.keyCodes},o.ShortcutRegistry.registry.register(t),t={name:o.ShortcutItems.names.PASTE,preconditionFn(e,t){return!e.isReadOnly()&&!e.isDragging()&&!o.getFocusManager().ephemeralFocusTaken()},callback:p,keyCodes:u.keyCodes},o.ShortcutRegistry.registry.register(t),e)||(t={displayText:()=>lf("Copy"),preconditionFn:e=>{var t=e.block;return!t.isInFlyout&&t.isMovable()&&t.isEditable()?(t=(0,n.getCopyPasteHandlers)())?t.copyPrecondition(e):"enabled":"hidden"},callback:function(e,t){var i=e.block;i&&(i.select(),d(i.workspace,t,void 0,e))},scopeType:o.ContextMenuRegistry.ScopeType.BLOCK,weight:s.BlockContextWeight.Copy,id:"makecode-copy-block"},e={displayText:()=>lf("Copy"),preconditionFn:e=>{var t=e.comment;return t.isMovable()&&t.isEditable()?(t=(0,n.getCopyPasteHandlers)())?t.copyPrecondition(e):"enabled":"hidden"},callback:function(e,t){var i=e.comment;i&&(i.select(),d(i.workspace,t,void 0,e))},scopeType:o.ContextMenuRegistry.ScopeType.COMMENT,weight:s.BlockContextWeight.Copy,id:"makecode-copy-comment"},o.ContextMenuRegistry.registry.register(t),o.ContextMenuRegistry.registry.register(e),t={displayText:()=>lf("Paste"),preconditionFn:h,callback:function(e,t){var i=e.workspace;i&&p(i,t,void 0,e)},scopeType:o.ContextMenuRegistry.ScopeType.WORKSPACE,weight:r.WorkspaceContextWeight.Paste,id:"makecode-paste"},o.ContextMenuRegistry.registry.register(t))},i.initAccessibleBlocksCopyPasteContextMenu=function(){var e=o.ContextMenuRegistry.registry.getItem("blockPasteFromContextMenu");if("separator"in e)throw new Error(`RegistryItem ${e.id} is not of type ActionRegistryItem`);if(e=Object.assign(Object.assign({},e),{preconditionFn:h}),o.ContextMenuRegistry.registry.unregister("blockPasteFromContextMenu"),o.ContextMenuRegistry.registry.register(e),"separator"in(e=o.ContextMenuRegistry.registry.getItem("blockCutFromContextMenu")))throw new Error(`RegistryItem ${e.id} is not of type ActionRegistryItem`);e=Object.assign(Object.assign({},e),{preconditionFn:e=>{var t,i=e.focusedNode;return i&&o.isCopyable(i)&&(t=i.workspace,!i.workspace.isFlyout)&&t instanceof o.WorkspaceSvg&&c.preconditionFn(t,e)?"enabled":"hidden"}}),o.ContextMenuRegistry.registry.unregister("blockCutFromContextMenu"),o.ContextMenuRegistry.registry.register(e)};let h=e=>{var t;return pxt.shell.isReadOnly()||null!=(t=e.workspace)&&t.options.readOnly?"hidden":(t=(0,n.getCopyPasteHandlers)())?t.pastePrecondition(e):"enabled"},d=(e,t,i,s)=>{var o=null==(o=(0,n.getCopyPasteHandlers)())?void 0:o.copy;return o?o(e,t,i,s):a.callback(e,t,i,s)},p=(e,t,i,s)=>{var o=null==(o=(0,n.getCopyPasteHandlers)())?void 0:o.paste;return o?o(e,t,i,s):u.callback(e,t,i,s)};function g(e,t,i){var s=o.getFocusManager().getFocusedNode(),i=(s instanceof o.BlockSvg&&(0,l.shouldDuplicateOnDrag)(s)&&s.setDeletable(!0),i(e,t));return(0,l.updateDuplicateOnDragState)(s),i}},{"./contextMenu/blockItems":19,"./contextMenu/workspaceItems":22,"./external":25,"./plugins/duplicateOnDrag":91,blockly:175}],24:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.decompiledDiffAsync=i.mergeXml=i.diffXml=i.needsDecompiledDiff=void 0;let w=e("blockly"),A=e("./importer"),x=e("./render");i.needsDecompiledDiff=function(e,t){if(!e||!t)return!1;let i={};if(e.replace(/id="([^"]+)"/g,(e,t)=>(i[t]=!0,"")),!Object.keys(i).length)return!1;let s=0,o=0;return t.replace(/id="([^"]+)"/g,(e,t)=>(s++,i[t]&&o++,"")),0<s&&0==o},i.diffXml=function(e,t,i){return o((0,A.loadWorkspaceXml)(e,!0),(0,A.loadWorkspaceXml)(t,!0),i)};let R="#d0d0d0";function o(p,g,m){try{w.Events.disable();{var _=p;var b=g;var f=m;pxt.tickEvent("blocks.diff",{started:1}),f=f||{};let o=O();if(!_)return{ws:void 0,message:lf("All blocks are new."),added:0,deleted:0,modified:1};if(!b)return{ws:void 0,message:lf("The current blocks seem corrupted."),added:0,deleted:0,modified:1};let s=pxt.Util.toDictionary(_.getTopBlocks(!1),e=>$(e,!0)),e=(b.getTopBlocks(!1).forEach(e=>{var t=$(e,!0),i=_.getBlockById(e.id)||s[t];i&&t==$(i,!0)&&(o("fast unmodified top ",e.id),e.dispose(!1),i.dispose(!1))}),_.getAllBlocks(!1).filter(e=>e.isEnabled())),t=_.getTopBlocks(!1).filter(e=>e.isEnabled()),i=b.getAllBlocks(!1).filter(e=>e.isEnabled());if(o("blocks",i.map(e=>e.toDevString())),o(i),0==e.length&&0==i.length)return pxt.tickEvent("blocks.diff",{moves:1}),{ws:void 0,message:lf("Some blocks were moved or changed."),added:0,deleted:0,modified:1};let n=t.filter(e=>!b.getBlockById(e.id)),r=e.filter(e=>!b.getBlockById(e.id)),l=i.filter(e=>!_.getBlockById(e.id)),a=(0,x.initRenderingWorkspace)(),c=(0,A.saveWorkspaceXml)(b,!0),u=((0,A.domToWorkspaceNoEvents)(w.utils.xml.textToDom(c),a),a.getAllBlocks(!1).filter(e=>!e.isEnabled()).forEach(e=>{o("disabled ",e.toDevString()),e.dispose(!1)}),pxt.Util.toDictionary(a.getAllBlocks(!1),e=>e.id)),h=(o("todo blocks",u),S("start"),f.hideDeletedTopBlocks||(n.forEach(e=>{o("deleted top "+e.toDevString()),C(e);e=k(e);C(e),e.setDisabledReason(!0,N)}),S("deleted top")),l.map(e=>a.getBlockById(e.id)).filter(e=>!!e).forEach(e=>{o("added "+e.toDevString()),C(e)}),S("added"),{}),d=(f.hideDeletedBlocks||((T=r.filter(e=>!(u[e.id]||y(e)||e.outputConnection&&e.outputConnection.isConnected()))).forEach(e=>{var t=k(e);h[e.id]=t.id,o(`deleted block ${e.toDevString()}->`+t.toDevString())}),T.forEach(e=>{o(`stitching ${e.toDevString()}->`+h[e.id]);var t=a.getBlockById(h[e.id]),i=(t.setDisabledReason(!0,N),v(t),C(t),e.getPreviousBlock());i&&(i=a.getBlockById(h[i.id])||a.getBlockById(i.id),o(`previous ${e.id}->${t.toDevString()}: `+i.toDevString()),i)&&(i.nextConnection?t.previousConnection.connect(i.nextConnection):(i=i.inputList.slice().reverse().find(e=>e.connection&&e.connection.type==w.NEXT_STATEMENT))&&t.previousConnection.connect(i.connection)),(i=e.getNextBlock())&&(i=a.getBlockById(h[i.id])||a.getBlockById(i.id))&&(o(`next ${e.id}->${t.toDevString()}: `+i.toDevString()),t.nextConnection.connect(i.previousConnection))})),0);if(pxt.Util.values(u).filter(e=>{var t,i,s=_.getBlockById(e.id);return!!s&&!((t=e.getPreviousBlock())&&!u[t.id]||(e=e.getNextBlock())&&!u[e.id]||!(i=s.getPreviousBlock())&&!t||!!i==!!t&&i.id==t.id&&(!(i=s.getNextBlock())&&!e||!!i==!!e&&i.id==e.id))}).forEach(e=>{o("moved "+e.toDevString()),delete u[e.id],v(e),d++}),S("moved"),pxt.Util.values(u).filter(e=>{var t,i,s=_.getBlockById(e.id);return!!s&&(t=$(s),i=$(e),t!=i)&&(o("old "+s.toDevString(),t),o("new "+e.toDevString(),i),!0)}).forEach(e=>{o("changed "+e.toDevString()),delete u[e.id],v(e),d++}),S("changed"),a.getTopBlocks(!1).forEach(e=>{e.getDescendants(!1).find(e=>y(e))||(o("unmodified top "+e.toDevString()),delete u[e.id],e.dispose(!1))}),S("cleaned"),pxt.Util.values(u).filter(e=>!!a.getBlockById(e.id)).forEach(e=>{!function t(e){e.setColour(R);I(e);f.statementsOnly&&(e.inputList||[]).map(e=>e.type==w.inputs.inputTypes.VALUE&&e.connection&&e.connection.targetBlock()).filter(e=>!!e).forEach(e=>t(e))}(e)}),S("unmodified"),!a.getAllBlocks(!1).length)return pxt.tickEvent("blocks.diff",{missed:1}),{ws:a,message:lf("Some blocks were changed."),deleted:r.length,added:l.length,modified:d};a.resize(),w.svgResize(a);var T=(0,x.renderWorkspace)(f.renderOptions||{emPixels:20,layout:4,aspectRatio:.5,useViewWidth:!0}),E={ws:a,svg:T,deleted:r.length,added:l.length,modified:d};return pxt.tickEvent("blocks.diff",{deleted:E.deleted,added:E.added,modified:E.modified}),E;function v(e){e.__pxt_used=!0}function y(e){return!!e.__pxt_used}function k(e){e=w.Xml.blockToDom(e,!1),e=w.Xml.domToBlock(e,a);return e.nextConnection&&e.nextConnection.targetConnection&&e.nextConnection.disconnect(),e.previousConnection&&e.previousConnection.targetConnection&&e.previousConnection.disconnect(),e}function I(e){e.inputList.forEach(e=>e.fieldRow.forEach(e=>{e.init()}))}function C(e){e.getDescendants(!1).forEach(e=>{delete u[e.id],v(e)})}function S(e){o(e+":",pxt.Util.values(u).map(e=>e.toDevString()))}return}}catch(e){return pxt.reportException(e),{ws:void 0,message:lf("Oops, we could not diff those blocks."),error:e,deleted:0,added:0,modified:0}}finally{w.Events.enable()}}function O(){return pxt.options.debug||window&&/diffdbg=1/.test(window.location.href)?pxt.log:e=>{}}let N="disabled_for_diff";function $(e,t){e=w.Xml.blockToDom(e,!0);return s(e),function e(t,i){if(!t)return;i(t);for(var s of pxt.Util.toArray(t.children))e(s,i)}(e,e=>{s(e),t||"next"!=e.localName&&"statement"!=e.localName&&"shadow"!=e.localName||e.remove()}),w.Xml.domToText(e)}function s(e){e.removeAttribute("id"),e.removeAttribute("x"),e.removeAttribute("y"),e.removeAttribute("deletable"),e.removeAttribute("editable"),e.removeAttribute("movable")}function g(s,o){if(o){let t,i;for(let e=0;e<s.length;++e){var n=s[e];n.startPos<=o.start&&n.endPos>=o.start+o.length&&(!t||i>n.endPos-n.startPos)&&(t=n,i=n.endPos-n.startPos)}return t?t.id:void 0}}i.mergeXml=function(e,t,i){return e==t?i:i==t?e:void 0},i.decompiledDiffAsync=function(e,l,t,a,i={}){let c=O();var s=l.outfiles[pxt.MAIN_BLOCKS];let u=a.outfiles[pxt.MAIN_BLOCKS],h=(c(s),c(u),e=pxt.diff.computeFormattedDiff(e,t,{ignoreWhitespace:!0,full:!0}),c(e),{}),d=0,p=0;return e.forEach((e,t)=>{var i=e[0],s=e.substr(2);let o=s.length;switch(i){case"-":d+=o+1;break;case"+":p+=o+1;break;default:var n,r=/^\s+/.exec(s),r=(r&&(r=r[0].length,d+=r,p+=r,o-=r),g(a.blockSourceMap,{start:p,length:o}));r&&!h[r]&&(n=g(l.blockSourceMap,{start:d,length:o}))&&(c(e),c(`id ${d}:${s.length}>${n} ==> ${p}:${s.length}>`+r),h[r]=n,u=u.replace(r,n)),d+=o+1,p+=o+1}}),t=(0,A.loadWorkspaceXml)(s,!0),e=(0,A.loadWorkspaceXml)(u,!0),i.statementsOnly=!0,o(t,e,i)}},{"./importer":73,"./render":137,blockly:175}],25:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getCopyPasteHandlers=i.setCopyPaste=i.openWorkspaceSearch=i.setOpenWorkspaceSearch=i.prompt=i.setPrompt=i.setOnWorkspaceContextMenu=i.onWorkspaceContextMenu=i.setOpenHelpUrl=i.openHelpUrl=i.setExtensionBlocklyPatch=i.extensionBlocklyPatch=i.setPromptTranslateBlock=i.promptTranslateBlock=void 0;let o=e("blockly"),s;i.promptTranslateBlock=function(e,t){s&&s(e,t)},i.setPromptTranslateBlock=function(e){s=e};let n;i.extensionBlocklyPatch=function(e,t){n&&n(e,t)},i.setExtensionBlocklyPatch=function(e){n=e};let r;i.openHelpUrl=function(e){r?r(e):window.open(e)},i.setOpenHelpUrl=function(e){r=e};let l;i.onWorkspaceContextMenu=function(e,t){l&&l(e,t)},i.setOnWorkspaceContextMenu=function(e){l=e};let a;i.setPrompt=function(e,t){t&&o.dialog.setPrompt(e),a=e},i.prompt=function(e,t,i,s){a?a(e,t,i,s):o.dialog.prompt(e,t,i)};let c;i.setOpenWorkspaceSearch=function(e){c=e},i.openWorkspaceSearch=function(){c&&c()};let u,h,d,p,g;i.setCopyPaste=function(e,t,i,s,o){u=e,h=t,d=i,p=s,g=o},i.getCopyPasteHandlers=function(){return u?{copy:u,cut:h,paste:d,copyPrecondition:p,pastePrecondition:g}:null}},{blockly:175}],26:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.createFieldEditor=i.registerFieldEditor=i.initFieldEditors=void 0;let s=e("./field_animation"),o=e("./field_tilemap"),n=e("./field_textinput"),r=e("./field_sprite"),l=e("./field_gridpicker"),a=e("./field_colour"),c=e("./field_images"),u=e("./field_textdropdown"),h=e("./field_numberdropdown"),d=e("./field_imagedropdown"),p=e("./field_note"),g=e("./field_melodySandbox"),m=e("./field_toggle"),_=e("./field_toggle_downup"),b=e("./field_toggle_highlow"),f=e("./field_toggle_onoff"),T=e("./field_toggle_updown"),E=e("./field_toggle_winlose"),v=e("./field_toggle_yesno"),y=e("./field_protractor"),k=e("./field_position"),I=e("./field_speed"),C=e("./field_tileset"),S=e("./field_turnratio"),w=e("./field_musiceditor"),A=e("./field_sound_effect"),x=e("./field_autocomplete"),R=e("./field_colorwheel"),O=e("./field_scopedvalueselector"),N={};function $(e,t,i){null==N[e]&&(N[e]={field:t,validator:i})}i.initFieldEditors=function(){var e;$("text",n.FieldTextInput),$("note",p.FieldNote),$("gridpicker",l.FieldGridPicker),$("textdropdown",u.FieldTextDropdown),$("numberdropdown",h.FieldNumberDropdown),$("imagedropdown",d.FieldImageDropdown),$("colorwheel",R.FieldColorWheel),$("toggle",m.FieldToggle),$("toggleonoff",f.FieldToggleOnOff),$("toggleyesno",v.FieldToggleYesNo),$("toggleupdown",T.FieldToggleUpDown),$("toggledownup",_.FieldToggleDownUp),$("togglehighlow",b.FieldToggleHighLow),$("togglewinlose",E.FieldToggleWinLose),$("colornumber",a.FieldColorNumber),$("images",c.FieldImages),$("sprite",r.FieldSpriteEditor),$("animation",s.FieldAnimationEditor),$("tilemap",o.FieldTilemap),$("tileset",C.FieldTileset),$("speed",I.FieldSpeed),$("turnratio",S.FieldTurnRatio),$("protractor",y.FieldProtractor),$("position",k.FieldPosition),$("melody",g.FieldCustomMelody),$("soundeffect",A.FieldSoundEffect),$("autocomplete",x.FieldAutoComplete),$("scopedvalueselector",O.FieldScopedValueSelector),null!=(e=pxt.appTarget.appTheme)&&e.songEditor&&$("musiceditor",w.FieldMusicEditor)},i.registerFieldEditor=$,i.createFieldEditor=function(e,t,i){return null==N[e]?(pxt.error(`Field editor ${e} not registered`),null):(i=i||{},pxt.Util.assert(null==i.lightMode,"lightMode is a reserved parameter for custom fields"),i.lightMode=pxt.options.light,new(e=N[e]).field(t,i,e.validator))}},{"./field_animation":27,"./field_autocomplete":30,"./field_colorwheel":32,"./field_colour":33,"./field_gridpicker":36,"./field_imagedropdown":37,"./field_images":39,"./field_melodySandbox":43,"./field_musiceditor":44,"./field_note":45,"./field_numberdropdown":46,"./field_position":47,"./field_protractor":49,"./field_scopedvalueselector":50,"./field_sound_effect":51,"./field_speed":52,"./field_sprite":53,"./field_textdropdown":55,"./field_textinput":56,"./field_tilemap":57,"./field_tileset":58,"./field_toggle":59,"./field_toggle_downup":60,"./field_toggle_highlow":61,"./field_toggle_onoff":62,"./field_toggle_updown":63,"./field_toggle_winlose":64,"./field_toggle_yesno":65,"./field_turnratio":67}],27:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAnimationEditor=void 0;var s=pxt.svgUtil,o=e("./field_asset");let n=e("./field_utils");class r extends o.FieldAssetEditor{constructor(){super(...arguments),this.onMouseEnter=()=>{if(!this.animateRef&&this.asset){var t=this.getParentInterval()||this.asset.interval;let e=0;this.animateRef=setInterval(()=>{this.preview&&this.frames[e]&&this.preview.src(this.frames[e]),e=(e+1)%this.frames.length},50<t?t:50)}},this.onMouseLeave=()=>{this.animateRef&&clearInterval(this.animateRef),this.animateRef=void 0,this.preview&&this.frames[0]&&this.preview.src(this.frames[0])}}initView(){this.sourceBlock_.getSvgRoot().addEventListener("mouseenter",this.onMouseEnter),this.sourceBlock_.getSvgRoot().addEventListener("mouseleave",this.onMouseLeave)}showEditor_(){this.asset&&(this.asset.interval=this.getParentInterval()||this.asset.interval),super.showEditor_()}render_(){super.render_(),this.size_.height=42,this.size_.width=80}getAssetType(){return"animation"}createNewAsset(e){var t,i=pxt.react.getTilemapProject();if(e){var s=pxt.lookupProjectAssetByTSReference(e,i);if(s)return s;s=e,t=this.params.taggedTemplate;s=-1===s.indexOf("[")?null:(s=s.replace(/[\[\]]/gm,"")).split(",").map(e=>pxt.sprite.imageLiteralToBitmap(e,t).data()).filter(e=>e.height&&e.width);if(s&&s.length){let e=this.temporaryAssetId(),t={internalID:-1,id:e,type:"animation",frames:s,interval:this.getParentInterval(),meta:{}};return t}s=i.lookupAssetByName("animation",e.trim());if(s)return s}let o=this.temporaryAssetId();i=new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight).data();let n={internalID:-1,id:o,type:"animation",frames:[i],interval:500,meta:{}};return n}onEditorClose(e){this.setParentInterval(e.interval)}getValueText(){return this.asset?this.isTemporaryAsset()?"["+this.asset.frames.map(e=>pxt.sprite.bitmapToImageLiteral(pxt.sprite.Bitmap.fromData(e),"typescript",this.params.taggedTemplate)).join(",")+"]":pxt.getTSReferenceForAsset(this.asset):this.valueText||"[]"}redrawPreview(){var e;this.fieldGroup_&&(pxsim.U.clear(this.fieldGroup_),e=(new s.Rect).at(35,1).size(40,40).corner(4).setClass("blocklyAnimationField"),this.fieldGroup_.appendChild(e.el),e=new s.Text("ï€ˆ").at(5,26).setClass("semanticIcon"),this.fieldGroup_.appendChild(e.el),this.asset)&&(this.frames=this.asset.frames.map(e=>(0,n.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e),32,this.lightMode)),this.preview=(new s.Image).src(this.frames[0]).at(39,5).size(32,32),this.fieldGroup_.appendChild(this.preview.el))}getParentIntervalBlock(){var e,t=this.sourceBlock_;if(t.getParent())for(e of t.getParent().inputList)if("frameInterval"===e.name)return e.connection.targetBlock()}setParentInterval(e){var t,i=this.getParentIntervalBlock();i&&(t=l(i))&&i.setFieldValue(String(e),t)}getParentInterval(){var e=this.getParentIntervalBlock();if(e){var t=l(e);if(t)return Number(e.getFieldValue(t))}return 100}parseFieldOptions(e){return i={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1},(e=e)&&(i.lightMode=e.lightMode,e.filter&&(i.filter=e.filter),i.initWidth=t(e.initWidth,i.initWidth),i.initHeight=t(e.initHeight,i.initHeight),i.taggedTemplate=e.taggedTemplate),i;function t(e,t){e=parseInt(e);return isNaN(e)?t:e}var i}}function l(e){var t;return"math_number_minmax"===e.type?"SLIDER":"math_number"===(t=e.type)||"math_integer"===t||"math_whole_number"===t?"NUM":"timePicker"===e.type?"ms":null}i.FieldAnimationEditor=r},{"./field_asset":29,"./field_utils":69}],28:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldArgumentVariable=void 0;let s=e("blockly");class o extends s.FieldVariable{constructor(e){super(e),this.menuGenerator_=this.generateMenu}generateMenu(){return s.FieldVariable.dropdownCreate.call(this).filter(e=>e[1]!=s.DELETE_VARIABLE_ID)}}i.FieldArgumentVariable=o},{blockly:175}],29:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.BlocklyTilemapChange=i.FieldAssetEditor=void 0;let u=e("blockly");var s=pxt.svgUtil,o=e("./field_base");let h=e("./field_utils");class n extends o.FieldBase{constructor(e,t,i){super(e,t,i),this.pendingEdit=!1,this.isEmpty=!1,this.assetChangeListener=()=>{var e;this.pendingEdit||((e=this.getBlockData())&&(this.asset=pxt.react.getTilemapProject().lookupAsset(this.getAssetType(),e)),this.redrawPreview())},this.lightMode=t.lightMode,this.params=this.parseFieldOptions(t),this.blocksInfo=t.blocksInfo}onInit(){this.redrawPreview()}onValueChanged(e){return this.parseValueText(e),this.redrawPreview(),this.getValueText()}saveState(e){return this.asset&&!this.isTemporaryAsset()?(0,h.getAssetSaveState)(this.asset):super.saveState(e)}loadState(e){"string"==typeof e?super.loadState(e):(e=(0,h.loadAssetFromSaveState)(e),super.loadState(pxt.getTSReferenceForAsset(e)),this.asset=e,this.setBlockData(this.asset.id))}showEditor_(){if(!this.isGreyBlock){var t=Object.assign({},this.params);t.blocksInfo=this.blocksInfo;let e;switch(this.asset.type){case"tile":case"image":e="image-editor",t.temporaryAssets=(0,h.getTemporaryAssets)(this.sourceBlock_.workspace,"image");break;case"animation":e="animation-editor",t.temporaryAssets=(0,h.getTemporaryAssets)(this.sourceBlock_.workspace,"image").concat((0,h.getTemporaryAssets)(this.sourceBlock_.workspace,"animation"));break;case"tilemap":e="tilemap-editor";var i,s=pxt.react.getTilemapProject();pxt.sprite.addMissingTilemapTilesAndReferences(s,this.asset);for(i of(0,h.getTilesReferencedByTilesets)(this.sourceBlock_.workspace))-1===this.asset.data.projectReferences.indexOf(i.id)&&this.asset.data.projectReferences.push(i.id);break;case"song":e="music-editor",t.temporaryAssets=(0,h.getTemporaryAssets)(this.sourceBlock_.workspace,"song"),(0,h.setMelodyEditorOpen)(this.sourceBlock_,!0)}this.isFullscreen()?this.showEditorFullscreen(e,t):this.showEditorInWidgetDiv(e,t)}}getFieldDescription(){var e;return(null==(e=null==(e=this.asset)?void 0:e.meta)?void 0:e.displayName)||this.getAssetType().toString()}showEditorFullscreen(e,t){let i=pxt.react.getFieldEditorView(e,this.asset,t);this.undoRedoState&&i.restorePersistentData(this.undoRedoState),pxt.react.getTilemapProject().pushUndo(),i.onHide(()=>{this.onFieldEditorHide(i)}),i.show()}showEditorInWidgetDiv(e,t){let i,s={getScaledBBox:()=>i},o=(u.WidgetDiv.show(s,this.sourceBlock_.RTL,()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),n.hide(),o.classList.remove("sound-effect-editor-widget"),o.style.transform="",o.style.position="",o.style.left="",o.style.top="",o.style.width="",o.style.height="",o.style.opacity="",o.style.transition="",o.style.alignItems="",this.onFieldEditorHide(n)}),u.WidgetDiv.getDiv()),n=pxt.react.getFieldEditorView(e,this.asset,t,o);var e=this.sourceBlock_,t=e.getBoundingRectangle(),r=(0,h.workspaceToScreenCoordinates)(e.workspace,new u.utils.Coordinate(t.right,t.top));var l=r.x-400,r=r.y+60-20,l=(o.style.opacity="0",o.classList.add("sound-effect-editor-widget"),o.style.position="absolute",o.style.left=l+"px",o.style.top=r+"px",o.style.width="50rem",o.style.height="34.25rem",o.style.display="flex",o.style.alignItems="center",o.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",o.style.borderRadius="",n.onHide(()=>{u.WidgetDiv.hideIfOwner(s)}),n.show(),o.getBoundingClientRect()),r=e.workspace.getInjectionDiv().getBoundingClientRect(),a=(l.height>r.height?(o.style.height="",o.style.top="calc(1rem - 20px)",o.style.bottom="calc(1rem + 20px)"):(l.bottom>r.bottom||l.top<r.top)&&(o.style.top=r.top+r.height/2-l.height/2-20+"px"),e.workspace.getToolbox().getWidth()),c=r.left+a,t=(l.width>r.width-a?(o.style.width="",o.style.left="1rem",o.style.right="1rem"):l.left+l.width>=r.right?(e=(0,h.workspaceToScreenCoordinates)(e.workspace,new u.utils.Coordinate(t.left,t.top))).x-l.width-20>c?o.style.left=e.x-l.width-20+"px":o.style.left=c+(r.width-a)/2-l.width/2+"px":l.left<r.left&&(o.style.left=c+"px"),o.getBoundingClientRect());i=new u.utils.Rect(t.top,t.bottom,t.left,t.right),requestAnimationFrame(()=>{o.style.opacity="1",o.style.transform="translateY(20px)"})}onFieldEditorHide(e){var t,i,s,o,n=e.getResult(),r=pxt.react.getTilemapProject();"song"===this.asset.type&&(0,h.setMelodyEditorOpen)(this.sourceBlock_,!1),n&&(t=this.getValue(),pxt.assetEquals(this.asset,n)||(n=pxt.patchTemporaryAsset(this.asset,n,r),i=l(this.asset)?null:this.asset.id,s=l(n)?null:n.id,this.pendingEdit=!0,null!=(o=n.meta)&&o.displayName&&this.disposeOfTemporaryAsset(),this.asset=n,o=r.revision(),this.onEditorClose(this.asset),this.updateAssetListener(),this.updateAssetMeta(),this.redrawPreview(),this.undoRedoState=e.getPersistentData(),this.sourceBlock_&&u.Events.isEnabled()&&(n=new a(this.sourceBlock_,"field",this.name,t,this.getValue(),o,r.revision()),i!==s&&(n.oldAssetId=i,n.newAssetId=s),u.Events.fire(n)),this.pendingEdit=!1))}render_(){this.isGreyBlock&&!this.textElement_&&this.createTextElement_(),super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=50)}getDisplayText_(){var e;return this.isGreyBlock?(e=pxt.Util.htmlUnescape(this.valueText)).substr(0,e.indexOf("("))+"(...)":""}updateEditable(){var e;this.isGreyBlock&&this.fieldGroup_?(e=this.fieldGroup_,u.utils.dom.removeClass(e,"blocklyNonEditableText"),u.utils.dom.removeClass(e,"blocklyEditableText"),e.style.cursor=""):super.updateEditable()}getValue(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.getValueText()}onDispose(){var e;null!=(e=this.sourceBlock_)&&e.workspace&&!this.sourceBlock_.workspace.rendered&&this.disposeOfTemporaryAsset(),pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener)}disposeOfTemporaryAsset(){this.isTemporaryAsset()&&(pxt.react.getTilemapProject().removeAsset(this.asset),this.setBlockData(null),this.asset=void 0)}clearTemporaryAssetData(){this.isTemporaryAsset()&&this.setBlockData(null)}isTemporaryAsset(){return l(this.asset)}getAsset(){return this.asset}updateAsset(e){this.asset=e,this.setValue(this.getValue())}onEditorClose(e){}redrawPreview(){if(this.fieldGroup_)if(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock)this.createTextElement_(),this.render_(),this.updateEditable();else{var t=(new s.Rect).at(5,1).size(40,40).setClass("blocklySpriteField").stroke("#898989",1).corner(4);if(this.fieldGroup_.appendChild(t.el),this.asset){let e;switch(this.asset.type){case"image":case"tile":e=(0,h.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.bitmap),32,this.lightMode);break;case"animation":e=(0,h.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.asset.frames[0]),32,this.lightMode);break;case"tilemap":e=(0,h.tilemapToImageURI)(this.asset.data,32,this.lightMode);break;case"song":e=(0,h.songToDataURI)(this.asset.song,60,20,this.lightMode)}e&&(t=(new s.Image).src(e).at(9,5).size(32,32),this.fieldGroup_.appendChild(t.el))}}}parseValueText(e){var t,i;e=pxt.Util.htmlUnescape(e),this.sourceBlock_&&(t=pxt.react.getTilemapProject(),i=this.getBlockData(),!(i=t.lookupAsset(this.getAssetType(),i))||e&&this.isEmpty?(this.setBlockData(null),this.asset&&this.sourceBlock_&&this.asset.meta.blockIDs&&(this.asset.meta.blockIDs=this.asset.meta.blockIDs.filter(e=>e!==this.sourceBlock_.id),this.isTemporaryAsset()||t.updateAsset(this.asset)),this.isEmpty=!e,this.asset=this.createNewAsset(e)):this.asset=i,this.updateAssetMeta(),this.updateAssetListener())}parseFieldOptions(e){var t={initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};return e&&(e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight),t.lightMode=e.lightMode),t;function i(e,t){e=parseInt(e);return isNaN(e)?t:e}}updateAssetMeta(){var e;this.asset&&(this.asset.meta||(this.asset.meta={}),this.asset.meta.blockIDs||(this.asset.meta.blockIDs=[]),this.sourceBlock_&&(-1===this.asset.meta.blockIDs.indexOf(this.sourceBlock_.id)&&((e=this.asset.meta.blockIDs).length&&this.isTemporaryAsset()&&e.some(e=>this.sourceBlock_.workspace.getBlockById(e))&&(this.asset=pxt.cloneAsset(this.asset),this.asset.meta.blockIDs=[]),this.asset.meta.blockIDs.push(this.sourceBlock_.id)),this.setBlockData(this.isTemporaryAsset()?null:this.asset.id)),this.isTemporaryAsset()?this.asset.meta.temporaryInfo={blockId:this.sourceBlock_.id,fieldName:this.name}:pxt.react.getTilemapProject().updateAsset(this.asset))}updateAssetListener(){pxt.react.getTilemapProject().removeChangeListener(this.getAssetType(),this.assetChangeListener),this.asset&&!this.isTemporaryAsset()&&pxt.react.getTilemapProject().addChangeListener(this.asset,this.assetChangeListener)}isFullscreen(){return!0}temporaryAssetId(){return this.sourceBlock_.id+"_"+this.name}}function l(e){return e&&!e.meta.displayName}i.FieldAssetEditor=n;class a extends u.Events.BlockChange{constructor(e,t,i,s,o,n,r){super(e,t,i,s,o),this.oldRevision=n,this.newRevision=r,this.fieldName=i}isNull(){return this.oldRevision===this.newRevision&&super.isNull()}run(e){(this.newAssetId||this.oldAssetId)&&(t=this.getEventWorkspace_().getBlockById(this.blockId),e?(0,h.setBlockDataForField)(t,this.fieldName,this.newAssetId):(0,h.setBlockDataForField)(t,this.fieldName,this.oldAssetId)),e?pxt.react.getTilemapProject().redo():pxt.react.getTilemapProject().undo(),super.run(e);var t=this.getEventWorkspace_(),e=new a(t.getBlockById(this.blockId),"tilemap-revision","revision",null,pxt.react.getTilemapProject().revision(),0,0);e.recordUndo=!1,u.Events.fire(e)}}i.BlocklyTilemapChange=a},{"./field_base":31,"./field_utils":69,blockly:175}],30:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAutoComplete=void 0;let s=e("blockly"),o=e("./field_utils");var n=e("./field_textdropdown");let r=e("../plugins/text");class l extends n.FieldTextDropdown{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.key=t.key,this.isTextValid_=!0}isOptionListDynamic(){return!0}getDisplayText_(){return this.parsedValue||""}getFieldDescription(){return this.getDisplayText_()}doValueUpdate_(e){this.isDirty_=!0,null!==e&&(/['"`].*['"`]/.test(e)?this.parsedValue=JSON.parse(e):this.parsedValue=e,this.value_=this.parsedValue)}getValue(){return this.parsedValue||""}getOptions(){var e=null==(e=this.sourceBlock_)?void 0:e.workspace;if(!e)return[];var i=[];for(let t of(0,o.getAllFields)(e,e=>e instanceof l&&e.getKey()===this.key).map(e=>e.ref.getDisplayText_()))t.trim()&&!i.some(e=>e[0]===t)&&i.push([t,t]);return i.sort((e,t)=>e[0].localeCompare(t[0])),i}showDropdown_(){this.getOptions().length&&super.showDropdown_()}getKey(){return this.key||(this.sourceBlock_?this.sourceBlock_.type:void 0)}initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(){super.updateSize_();var e=Math.max(this.size_.width,1);let t=this.positionLeft(e+3);this.textElement_.setAttribute("x",t.toString()),t+=this.positionRight(t+e+3),this.size_.width=e+t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return t=(this.sourceBlock_.RTL?this.quoteRightX_=r.FieldString.quotePadding:this.quoteRightX_=e+r.FieldString.quotePadding,this.quoteWidth_+r.FieldString.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return t=(this.sourceBlock_.RTL?this.quoteLeftX_=e+this.quoteWidth_+2*r.FieldString.quotePadding:this.quoteLeftX_=0,this.quoteWidth_+r.FieldString.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}createSVGArrow(){}}i.FieldAutoComplete=l},{"../plugins/text":134,"./field_textdropdown":55,"./field_utils":69,blockly:175}],31:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldBase=void 0;var s=e("blockly");let o=e("./field_utils");class n extends s.Field{constructor(e,t,i){super(e,i),this.SERIALIZABLE=!0,this.options=t,e&&!this.valueText&&(this.valueText=e)}static enqueueInit(e){n.pendingInit.push(e),this.pendingTimeout||(n.pendingTimeout=setTimeout(()=>n.flushInitQueue()))}static flushInitQueue(){for(var e of n.pendingInit)e.onLoadedIntoWorkspace();n.pendingTimeout=void 0,n.pendingInit=[]}init(){super.init(),this.onInit(),n.enqueueInit(this)}dispose(){this.onDispose()}getValue(){return this.valueText}doValueUpdate_(e){null!==e&&(this.valueText=this.loaded?this.onValueChanged(e):e)}getDisplayText_(){return this.valueText}onLoadedIntoWorkspace(){this.loaded||(this.loaded=!0,this.valueText=this.onValueChanged(this.valueText))}getFieldDescription(){return this.getDisplayText_()}getAnchorDimensions(){var e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=n.CHECKMARK_OVERHANG:e.left-=n.CHECKMARK_OVERHANG,e}isInitialized(){return!!this.fieldGroup_}getBlockData(){return(0,o.getBlockDataForField)(this.sourceBlock_,this.name)}setBlockData(e){(0,o.setBlockDataForField)(this.sourceBlock_,this.name,e)}getSiblingBlock(e,t=!1){t=t?this.sourceBlock_.getParent():this.sourceBlock_;if(t&&t.inputList)for(var i of t.inputList)if(i.name===e)return i.connection.targetBlock()}getSiblingField(e,t=!1){t=t?this.sourceBlock_.getParent():this.sourceBlock_;if(t)return t.getField(e)}}(i.FieldBase=n).CHECKMARK_OVERHANG=25,n.pendingInit=[]},{"./field_utils":69,blockly:175}],32:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldColorWheel=void 0;e=e("../plugins/math");class s extends e.FieldSlider{constructor(e,t,i){super(String(e),"0","255","1","10","Color",i),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.channel&&(this.channel_=this.params.channel)}setBackground_(e){var t=this.createColourStops_().join(",");e.style.background=`linear-gradient(left, ${t})`,this.params.sliderWidth&&(e.style.width=this.params.sliderWidth+"px")}setReadout_(e,t){var t=this.colorWheel(parseInt(t),this.channel_),i=document.createElement("span");i.className="blocklyColorReadout",i.style.backgroundColor=""+t,pxsim.U.clear(e),e.appendChild(i)}createColourStops_(){var t=[];for(let e=0;e<=255;e+=20)t.push(this.colorWheel(e,this.channel_));return t}colorWheel(e,t){return"hsvfast"==t?this.hsvFast(e,255,255):(e=255-e)<85?this.hex(3*e,255,255-3*e):e<170?this.hex(255,255-3*(e-=85),3*e):this.hex(255-3*(e-=170),3*e,255)}hsvFast(e,t,i){let s=e%255>>0;s<0&&(s+=255);var e=i*(255-t)/255>>0,t=i-e,i=(s=192*s/255>>0)/64>>0,o=s%64>>0,n=(o*t/63.75>>0)+e,o=((63-o)*t/63.75>>0)+e;let r,l,a;return a=i?1==i?(r=e,l=o,n):(r=n,l=e,o):(r=o,l=n,e),this.hex(r,l,a)}hex(e,t,i){return"#"+this.componentToHex(255&e)+this.componentToHex(255&t)+this.componentToHex(255&i)}componentToHex(e){e=e.toString(16);return 1==e.length?"0"+e:e}}i.FieldColorWheel=s},{"../plugins/math":119}],33:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldColorNumber=void 0;var s=e("@blockly/field-grid-dropdown");let o=e("blockly/core");class n extends s.FieldGridDropdown{constructor(e,t,i){let s,o,n;var r,l,a,c=null!=(s=t.valueMode)?s:"rgb",u="#dedede";t.colours?0<(o=JSON.parse(t.colours)).lastIndexOf(o[0])&&(o[0]=u):pxt.appTarget.runtime&&pxt.appTarget.runtime.palette&&((o=pxt.Util.clone(pxt.appTarget.runtime.palette))[0]=u,pxt.appTarget.runtime.paletteNames)&&((n=pxt.Util.clone(pxt.appTarget.runtime.paletteNames))[0]=lf("transparent")),super((r=c,l=o,a=n,l.map(e=>h(e,r,l)).map((e,t)=>{var i=document.createElement("div");return i.className="blocklyColourSwatch",i.style.backgroundColor=l[t],a&&t<a.length&&(i.title=a[t]),[i,e]})),i,{primaryColour:"white",borderColour:"#dadce0",columns:t.columns?parseInt(t.columns):7}),this.isFieldCustom_=!0,this.isDirty_=!1,this.allColoursCSSFormat_=o,this.valueMode_=c,this.setValue(e)}trimOptions(e){return{options:e}}initView(){var e=this.getConstants();if(!e)throw Error("Constants not found");this.size_=new o.utils.Size(e.FIELD_COLOUR_DEFAULT_WIDTH,e.FIELD_COLOUR_DEFAULT_HEIGHT),this.createBorderRect_(),this.getBorderRect().style.fillOpacity="1",this.getBorderRect().setAttribute("stroke","#fff"),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}showEditor_(e){super.showEditor_(e),o.DropDownDiv.getContentDiv().classList.add("blocklyFieldColour"),o.DropDownDiv.repositionForWindowResize()}isFullBlockField(){var e;if(this.getSourceBlock())return e=this.getConstants(),this.blockIsSimpleReporter()&&Boolean(null==e?void 0:e.FIELD_COLOUR_FULL_BLOCK);throw new o.UnattachedFieldError}blockIsSimpleReporter(){var e,t=this.getSourceBlock();if(!t)throw new o.UnattachedFieldError;if(!t.outputConnection)return!1;for(e of t.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}applyColour(){var e=this.getSourceBlock();if(!e)throw new o.UnattachedFieldError;if(this.fieldGroup_){var t=this.borderRect_;if(!t)throw new Error("The border rect has not been initialized");this.isFullBlockField()?(t.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getCSSValue()),e.pathObject.svgPath.setAttribute("stroke","#fff")):(t.style.display="block",t.style.fill=this.getCSSValue())}}getSize(){var e;return null!=(e=this.getConstants())&&e.FIELD_COLOUR_FULL_BLOCK&&(this.render_(),this.isDirty_=!1),super.getSize()}render_(){this.updateSize_();var e=this.getSourceBlock();if(!e)throw new o.UnattachedFieldError;e.applyColour()}updateSize_(i){var s=this.getConstants();if(s){let e,t;t=this.isFullBlockField()?(e=2*(null!=i?i:0),s.FIELD_TEXT_HEIGHT):(e=s.FIELD_COLOUR_DEFAULT_WIDTH,s.FIELD_COLOUR_DEFAULT_HEIGHT),this.size_.height=t,this.size_.width=e,this.positionBorderRect_()}}doClassValidation_(e){return this.allColoursCSSFormat_?"string"!=typeof e?null:h(r(e,this.allColoursCSSFormat_),this.valueMode_,this.allColoursCSSFormat_):e}getText(){let e=this.getCSSValue();return e=/^#(.)\1(.)\2(.)\3$/.test(e)?"#"+e[1]+e[3]+e[5]:e}getFieldDescription(){var e=this.getCSSValue();return e?lf("color ${0}",e):lf("color")}getCSSValue(){return r(this.getValue(),this.allColoursCSSFormat_)}}function h(t,e,i){switch(e){case"hex":return`"${t}"`;case"rgb":return-1<t.indexOf("#")?"0x"+t.replace(/^#/,""):t;case"index":if(!t)return"-1";for(let e=0;e<i.length;e++)if(t.toUpperCase()===i[e].toUpperCase())return e+""}return t}function r(e,t){if(e){var i=/Colors\.([a-zA-Z]+)/.exec(e),s=/(0x|#)([0-9a-fA-F]+)/.exec(e);if(i)switch(i[1].toLocaleLowerCase()){case"red":return"#FF0000";case"orange":return"#FF7F00";case"yellow":return"#FFFF00";case"green":return"#00FF00";case"blue":return"#0000FF";case"indigo":return"#4B0082";case"violet":return"#8A2BE2";case"purple":return"#A033E5";case"pink":return"#FF007F";case"white":return"#FFFFFF";case"black":return"#000000";default:return e}else if(s){var o=s[2];if(3===o.length){let t="#";for(let e=0;e<o.length;e++){var n=o.charAt(e);t+=n+n}return t}if(6===o.length)return"#"+o}i=parseInt(e);return isNaN(i)||null==t[i]?t[0]:t[i]}return e}i.FieldColorNumber=n,o.Css.register(`
.blocklyColourSwatch {
    width: 22px;
    height: 22px;
}

.blocklyFieldColour.blocklyFieldGridContainer {
    padding: 0px;
}

.blocklyFieldColour .blocklyFieldGrid {
    grid-gap: 0px;
    row-gap: 0px;
    outline: none;
}

.blocklyFieldColour .blocklyFieldGrid .blocklyFieldGridItem {
    padding: 0;
    border: none;
    margin: 2px;
}

.blocklyFieldColour .blocklyFieldGrid .blocklyFieldGridItem .blocklyColourSwatch {
    border: 2px solid rgba(0,0,0,.1);
    border-radius: 4px;
}

.blocklyFieldColour .blocklyFieldGridItem:focus .blocklyColourSwatch {
    box-shadow: 2px 2px 7px 2px rgba(0,0,0,.3);
    border-color: #eee;
    border-width: 1px;
}

.blocklyFieldColour .blocklyFieldGrid .blocklyFieldGridItemSelected .blocklyColourSwatch {
    outline: 1px solid #000;
    border-color: #eee;
    border-width: 1px;
}
`)},{"@blockly/field-grid-dropdown":169,"blockly/core":174}],34:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldDropdown=void 0;let s=e("blockly"),o=e("../plugins/newVariableField/fieldDropdownMixin");class n extends s.FieldDropdown{constructor(){super(...arguments),this.svgRootBinding=null,this.fieldRootBinding=null}initView(){super.initView(),this.fieldGroup_&&this.fieldGroup_.classList.add("pxtFieldDropdown"),this.shouldAddBorderRect_()||(this.createBorderRect_(),this.clickTargetRect=this.borderRect_,this.clickTargetRect.setAttribute("stroke-opacity","0"),this.clickTargetRect.setAttribute("fill-opacity","0"),this.borderRect_=void 0)}shouldAddBorderRect_(){if("variables_get"===this.sourceBlock_.type)return!1;for(var e of this.sourceBlock_.inputList)for(var t of e.fieldRow)if(t!==this&&t.EDITABLE)return!0;return!this.sourceBlock_.getInputsInline()||super.shouldAddBorderRect_()}bindEvents_(){this.shouldAddBorderRect_()?super.bindEvents_():(this.svgRootBinding=s.browserEvents.conditionalBind(this.sourceBlock_.getSvgRoot(),"pointerdown",this,e=>{this.sourceBlock_.icons.length||this.onMouseDown_(e)},!1),this.fieldRootBinding=s.browserEvents.conditionalBind(this.getSvgRoot(),"pointerdown",this,e=>{this.sourceBlock_.icons.length&&this.onMouseDown_(e)},!1))}dispose(){super.dispose(),this.svgRootBinding&&(s.browserEvents.unbind(this.svgRootBinding),s.browserEvents.unbind(this.fieldRootBinding))}positionBorderRect_(){super.positionBorderRect_(),this.clickTargetRect&&(this.clickTargetRect.setAttribute("width",String(this.size_.width)),this.clickTargetRect.setAttribute("height",String(this.size_.height)),this.clickTargetRect.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.clickTargetRect.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}showEditor_(e){o.showEditorMixin.call(this,e)}}i.FieldDropdown=n,s.Css.register(`
.pxtFieldDropdown.blocklyActiveFocus > .blocklyFieldRect, .pxtFieldDropdown.blocklyPassiveFocus > .blocklyFieldRect {
    stroke-opacity: 1;
}
`)},{"../plugins/newVariableField/fieldDropdownMixin":121,blockly:175}],35:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldDropdownGrid=void 0;let n=e("blockly");e=e("./field_dropdown");class s extends e.FieldDropdown{constructor(){super(...arguments),this.isFieldCustom_=!0,this.gridItems=[],this.keyDownBinding=null,this.pointerMoveBinding=null}setFocusedItem(e,t){this.lastUserInputAction="keymove",this.setFocusedItem_(e),e.setAttribute("aria-activedescendant",":"+this.activeDescendantIndex),t.preventDefault(),t.stopPropagation()}setOpeningPointerCoords(e){var t;e&&({pageX:e,pageY:t}=e,void 0!==e)&&void 0!==t&&(this.openingPointerCoords={x:e,y:t})}addKeyDownHandler(i){let s=pxt.Util.isUserLanguageRtl()?"ArrowLeft":"ArrowRight",o=pxt.Util.isUserLanguageRtl()?"ArrowRight":"ArrowLeft";this.keyDownBinding=n.browserEvents.bind(i,"keydown",this,e=>{if(void 0===this.activeDescendantIndex){if("ArrowDown"===e.code||e.code===s||"Home"===e.code)return this.activeDescendantIndex=0,this.setFocusedItem(i,e);if("ArrowUp"===e.code||e.code===o||"End"===e.code)return this.activeDescendantIndex=this.gridItems.length-1,this.setFocusedItem(i,e)}var t=pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey;switch(e.code){case"ArrowUp":0<=this.activeDescendantIndex-this.columns_&&(this.activeDescendantIndex-=this.columns_);break;case"ArrowDown":this.activeDescendantIndex+this.columns_<this.gridItems.length&&(this.activeDescendantIndex+=this.columns_);break;case s:this.activeDescendantIndex<this.gridItems.length-1&&this.activeDescendantIndex++;break;case o:0!==this.activeDescendantIndex&&this.activeDescendantIndex--;break;case"Home":if(t)this.activeDescendantIndex=0;else for(;this.activeDescendantIndex%this.columns_!=0;)this.activeDescendantIndex--;break;case"End":if(t)this.activeDescendantIndex=this.gridItems.length-1;else for(;this.activeDescendantIndex%this.columns_!=this.columns_-1&&this.activeDescendantIndex<this.gridItems.length-1;)this.activeDescendantIndex++;break;case"Enter":case"Space":return this.buttonClickAndClose_(this.gridItems[this.activeDescendantIndex].getAttribute("data-value")),e.preventDefault(),void e.stopPropagation();default:return}this.setFocusedItem(i,e)})}addPointerListener(e){this.pointerMoveBinding=n.browserEvents.bind(e,"pointermove",this,()=>{this.lastUserInputAction="pointermove"})}pointerMoveTriggeredByUser(){return this.openingPointerCoords&&!this.lastUserInputAction||"pointermove"===this.lastUserInputAction}pointerOutTriggeredByUser(){return"pointermove"===this.lastUserInputAction}disposeGrid(){this.keyDownBinding&&n.browserEvents.unbind(this.keyDownBinding),this.pointerMoveBinding&&n.browserEvents.unbind(this.pointerMoveBinding),this.keyDownBinding=null,this.pointerMoveBinding=null,this.openingPointerCoords=void 0,this.lastUserInputAction=void 0,this.activeDescendantIndex=void 0,this.gridItems=[]}}i.FieldDropdownGrid=s},{"./field_dropdown":34,blockly:175}],36:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldGridPicker=void 0;let h=e("blockly"),o=e("./field_utils"),s=e("./field_base");e=e("./field_dropdowngrid");class d extends e.FieldDropdownGrid{constructor(e,t,i){super(t.data),this.tabKeyBind=null,this.buttonClick_=e=>{null!==e&&(this.setValue(e),this.closeModal_)&&(this.close(),this.closeModal_=!1)},this.buttonClickAndClose_=e=>{this.closeModal_=!0,this.buttonClick_(e)},this.columns_=parseInt(t.columns)||4,this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||void 0,this.backgroundColour_=(0,o.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1);var s={xOffset:parseInt(t.tooltipsXOffset)||15,yOffset:parseInt(t.tooltipsYOffset)||-10};this.tooltipConfig_=s,this.hasSearchBar_=!!t.hasSearchBar||!1}setFocusedItem_(e){this.gridItems.forEach(e=>e.classList.remove("gridpicker-option-focused","gridpicker-menuitem-highlight"));var t=this.gridItems[this.activeDescendantIndex],i=(t.classList.add("gridpicker-option-focused"),h.utils.style.scrollIntoContainerView(t,this.scrollContainer),t.getBoundingClientRect());this.gridTooltip_&&(t=t.title||t.alt,this.gridTooltip_.textContent=t,this.gridTooltip_.style.visibility=t?"visible":"hidden",this.gridTooltip_.style.display=t?"":"none",this.gridTooltip_.style.top=i.bottom+5+"px",this.gridTooltip_.style.left=i.left+"px"),this.addKeyboardNavigableClass()}dispose(){super.dispose(),this.disposeGrid(),this.disposeTooltip(),this.disposeIntersectionObserver()}createTooltip_(){this.gridTooltip_||(this.gridTooltip_=document.createElement("div"),this.gridTooltip_.className="blocklyGridPickerTooltip",this.gridTooltip_.style.position="absolute",this.gridTooltip_.style.display="none",this.gridTooltip_.style.visibility="hidden",document.body.appendChild(this.gridTooltip_))}populateTableContainer(t,i,e){this.gridItems=[],this.activeDescendantIndex=0,pxsim.U.removeChildren(i),0==t.length&&(this.firstItem_=void 0);for(let e=0;e<t.length/this.columns_;e++){var s=this.populateRow(e,t,i);i.appendChild(s)}}populateRow(e,t,l){var i=this.columns_,a=document.createElement("div");a.className="blocklyGridPickerRow";for(let r=i*e;r<Math.min(i*e+i,t.length);r++){let i=t[r][0],s=t[r][1],o=document.createElement("div");o.className="gridpicker-menuitem gridpicker-option",o.setAttribute("id",":"+r),o.setAttribute("role","gridcell"),o.setAttribute("aria-selected","false"),o.style.userSelect="none",o.title=i.alt||i,o.setAttribute("data-value",s);var c,u=document.createElement("div");u.setAttribute("class","gridpicker-menuitem-content"),u.title=i.alt||i,u.setAttribute("data-value",s);let n="object"==typeof i,e=this.backgroundColour_;if(s==this.getValue()&&(o.setAttribute("aria-selected","true"),this.activeDescendantIndex=r,pxt.BrowserUtils.addClass(o,"gridpicker-option-selected "+(this.openingPointerCoords?"":"gridpicker-option-focused")),e=this.sourceBlock_.getColourTertiary(),this.selectedItemDom=o,n)&&!this.shouldShowTooltips()&&this.updateSelectedBar_(i,s),o.style.backgroundColor=e,o.style.borderColor=this.borderColour_,n?((c=new Image(i.width,i.height)).setAttribute("draggable","false"),"IntersectionObserver"in window?(c.src=d.DEFAULT_IMG,c.setAttribute("data-src",i.src),this.observer.observe(c)):c.src=i.src,c.alt=i.alt||"",c.setAttribute("data-value",s),u.appendChild(c)):u.textContent=i,this.shouldShowTooltips()){h.browserEvents.conditionalBind(o,"click",this,()=>this.buttonClickAndClose_(s));let t=this.sourceBlock_.RTL?-this.tooltipConfig_.xOffset:this.tooltipConfig_.xOffset,i=this.tooltipConfig_.yOffset;h.browserEvents.bind(o,"pointermove",this,e=>{this.pointerMoveTriggeredByUser()&&(this.gridItems.forEach(e=>e.classList.remove("gridpicker-option-focused")),this.activeDescendantIndex=r,n&&(this.gridTooltip_.style.top=e.clientY+i+"px",this.gridTooltip_.style.left=e.clientX+t+"px",e=(e=document.elementFromPoint(e.clientX,e.clientY)).title||e.alt,this.gridTooltip_.textContent=e,this.gridTooltip_.style.visibility=e?"visible":"hidden",this.gridTooltip_.style.display=e?"":"none"),pxt.BrowserUtils.addClass(o,"gridpicker-menuitem-highlight"),l.setAttribute("aria-activedescendant",o.id))}),h.browserEvents.bind(o,"pointerout",this,e=>{this.pointerOutTriggeredByUser()&&(this.gridItems.forEach(e=>e.classList.remove("gridpicker-option-focused")),n&&(this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"),pxt.BrowserUtils.removeClass(o,"gridpicker-menuitem-highlight"),l.removeAttribute("aria-activedescendant"),this.activeDescendantIndex=void 0)})}else n?(this.selectedBar_.style.display="",h.browserEvents.conditionalBind(o,"click",this,e=>{if(this.closeModal_)this.buttonClick_(s);else{var t=l.getElementsByClassName("gridpicker-menuitem-highlight");for(let e=0;e<t.length;e++)pxt.BrowserUtils.removeClass(t[e],"gridpicker-menuitem-highlight");pxt.BrowserUtils.addClass(o,"gridpicker-menuitem-highlight"),this.updateSelectedBar_(i,s)}})):(h.browserEvents.conditionalBind(o,"click",this,()=>this.buttonClickAndClose_(s)),h.browserEvents.conditionalBind(o,"mouseup",this,()=>this.buttonClickAndClose_(s)));o.appendChild(u),this.gridItems.push(o),a.appendChild(o),0==r&&(this.firstItem_=o)}return a}doClassValidation_(e){return e}getFieldDescription(){return this.getValue()}close(){this.disposeTooltip(),this.disposeGrid(),h.WidgetDiv.hideIfOwner(this),h.Events.setGroup(!1),this.tabKeyBind&&h.browserEvents.unbind(this.tabKeyBind)}highlightFirstItem(e){var i=e.childNodes;if(i.length&&i[0].childNodes){for(let t=0;t<i.length;++t){var s=i[t].childNodes.length;for(let e=0;e<s;++e){var o=i[t].childNodes[e];pxt.BrowserUtils.removeClass(o,"gridpicker-menuitem-highlight"),pxt.BrowserUtils.removeClass(o,"gridpicker-option-selected")}}i[0].childNodes[0].className+=" gridpicker-menuitem-highlight"}}highlightAndScrollSelected(e,t){this.selectedItemDom&&h.utils.style.scrollIntoContainerView(this.selectedItemDom,t,!0)}showEditor_(e){this.setOpeningPointerCoords(e),h.WidgetDiv.show(this,this.sourceBlock_.RTL,()=>{this.onClose_()}),this.setupIntersectionObserver_(),this.createTooltip_();var t=document.createElement("div");this.positionMenu_(t),t.focus(),e||this.addKeyboardNavigableClass()}positionMenu_(t){var e,i=h.utils.svgMath.getViewportBBox(),s=this.getAnchorDimensions_(),{paddingContainer:o,scrollContainer:n}=this.createWidget_(t),o=(this.scrollContainer=n,{width:o.offsetWidth,height:o.offsetHeight}),r=window.outerHeight||window.innerHeight;this.width_&&(e=window.outerWidth||window.innerWidth,this.width_>e&&(this.width_=e),t.style.width=this.width_+"px");let l=0;if(this.hasSearchBar_&&(l+=50),this.selectedBar_&&(l+=50),this.maxRows_){let e=t.children[0].offsetHeight*(this.maxRows_+.3);r<e+l&&(e=r-l),o.height>e&&(n.style.overflowY="auto",n.style.height=e+"px",o.height=e)}o.height+=l,h.WidgetDiv.positionWithAnchor(i,s,o,this.sourceBlock_.RTL),this.highlightAndScrollSelected(t,n)}shouldShowTooltips(){return!pxt.BrowserUtils.isMobile()}getAnchorDimensions_(){var e=this.getScaledBBox();return this.sourceBlock_.RTL?e.right+=s.FieldBase.CHECKMARK_OVERHANG:e.left-=s.FieldBase.CHECKMARK_OVERHANG,e}createWidget_(e){var t,i,s=h.WidgetDiv.getDiv(),o=this.getOptions(),n=(e.setAttribute("role","grid"),e.setAttribute("tabindex","0"),this.addPointerListener(s),this.addKeyDownHandler(e),document.createElement("div")),r=document.createElement("div");r.style.border="solid 1px "+this.borderColour_,e.style.backgroundColor=this.backgroundColour_,n.style.backgroundColor=this.backgroundColour_,r.style.backgroundColor=this.backgroundColour_,e.className="blocklyGridPickerMenu",n.className="blocklyGridPickerScroller",r.className="blocklyGridPickerPadder",r.appendChild(n),n.appendChild(e),s.appendChild(r);let l;this.hasSearchBar_&&({searchBarDiv:t,searchBar:i}=this.createSearchBar_(e,n,o),r.insertBefore(t,r.childNodes[0]),l=i);let a;return this.shouldShowTooltips()||({selectedBar:t,cancelButton:i}=this.createSelectedBar_(),this.selectedBar_=t,a=i,r.appendChild(this.selectedBar_)),this.populateTableContainer(o,e,n),(this.hasSearchBar_||this.selectedBar_)&&(this.firstFocusableElement=l||e,this.lastFocusableElement=a||e,this.tabKeyBind=h.browserEvents.bind(s,"keydown",this,this.handleTabKey.bind(this))),{paddingContainer:r,scrollContainer:n}}createSearchBar_(s,o,n){var e=document.createElement("div"),t=(e.setAttribute("class","ui fluid icon input"),document.createElement("i"));t.setAttribute("class","search icon");let r=document.createElement("input");return r.setAttribute("type","search"),r.setAttribute("id","search-bar"),r.setAttribute("class","blocklyGridPickerSearchBar"),r.setAttribute("placeholder",pxt.Util.lf("Search")),r.setAttribute("tabindex","0"),r.addEventListener("click",()=>{r.focus(),r.setSelectionRange(0,r.value.length)}),r.addEventListener("keyup",pxt.Util.debounce(e=>{if("Tab"!==e.code){e=r.value;let i=new RegExp(e,"i");var t=n.filter(e=>{var t=e[0].alt,e=e[1];return t?i.test(t):i.test(e)});this.populateTableContainer(t,s,o),e?this.highlightFirstItem(s):this.highlightAndScrollSelected(s,o),this.gridTooltip_.style.visibility="hidden",this.gridTooltip_.style.display="none"}},300,!1)),r.addEventListener("keyup",e=>{13==e.which&&(e=s.childNodes[0])&&(e=e.childNodes[0])&&(this.closeModal_=!0,e.click())}),e.appendChild(r),e.appendChild(t),{searchBarDiv:e,searchBar:r}}createSelectedBar_(){var e=document.createElement("div"),t=(e.setAttribute("class","blocklyGridPickerSelectedBar"),e.style.display="none",document.createElement("div")),i=document.createElement("div"),i=(i.className="blocklyGridPickerSelectedImage",t.appendChild(i),this.selectedImg_=document.createElement("img"),this.selectedImg_.setAttribute("width","30px"),this.selectedImg_.setAttribute("height","30px"),this.selectedImg_.setAttribute("draggable","false"),this.selectedImg_.style.display="none",this.selectedImg_.src=d.DEFAULT_IMG,i.appendChild(this.selectedImg_),this.selectedBarText_=document.createElement("span"),this.selectedBarText_.className="blocklyGridPickerTooltip",t.appendChild(this.selectedBarText_),document.createElement("div")),s=document.createElement("div"),o=(s.className="ui buttons mini",i.appendChild(s),document.createElement("button")),n=(o.className="ui button icon green",document.createElement("i")),n=(n.className="icon check",o.appendChild(n),h.browserEvents.conditionalBind(o,"click",this,()=>{this.setValue(this.selectedBarValue_),this.close()}),document.createElement("button")),r=(n.className="ui button icon red",document.createElement("i"));return r.className="icon cancel",n.appendChild(r),h.browserEvents.conditionalBind(n,"click",this,()=>{this.close()}),s.appendChild(o),s.appendChild(n),e.appendChild(t),e.appendChild(i),{selectedBar:e,cancelButton:n}}updateSelectedBar_(e,t){e.src&&(this.selectedImg_.src=e.src,this.selectedImg_.style.display=""),this.selectedImg_.alt=e.alt||e,this.selectedBarText_.textContent=e.alt||e,this.selectedBarValue_=t}setupIntersectionObserver_(){if("IntersectionObserver"in window){this.disposeIntersectionObserver();let t=e=>{var t=e.getAttribute("data-src");t&&(e.src=t,e.removeAttribute("data-src"))};this.observer=new IntersectionObserver(e=>{e.forEach(e=>{0<e.intersectionRatio&&(this.observer.unobserve(e.target),t(e.target))})},{rootMargin:"20px 0px",threshold:.01})}}disposeIntersectionObserver(){this.observer&&(this.observer=null)}disposeTooltip(){this.gridTooltip_&&(pxsim.U.remove(this.gridTooltip_),this.gridTooltip_=null)}onClose_(){this.disposeTooltip(),this.disposeGrid()}handleTabKey(e){"Tab"===e.code&&(this.addKeyboardNavigableClass(),document.activeElement!==this.lastFocusableElement||e.shiftKey?document.activeElement===this.firstFocusableElement&&e.shiftKey&&(this.lastFocusableElement.focus(),e.preventDefault()):(this.firstFocusableElement.focus(),e.preventDefault()))}addKeyboardNavigableClass(){this.scrollContainer&&this.scrollContainer.classList.add("keyboardNavigable")}}(i.FieldGridPicker=d).DEFAULT_IMG="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",h.Css.register(`
.blocklyGridPickerTooltip {
    z-index: 995;
}

.blocklyGridPickerPadder {
    outline: none;
    box-shadow: 0px 0px 8px 1px rgba(0, 0, 0, .3)
}

.blocklyWidgetDiv .blocklyGridPickerRow {
    display: table-row;
}

.blocklyWidgetDiv .blocklyGridPickerMenu {
    display: table;
    outline: none;
    border-spacing: 7px;
}

.blocklyGridPickerScroller {
    outline: none;
    padding: 4px;
    border-radius: 4px;
    position: relative;
    -webkit-overflow-scrolling: touch;
}

.blocklyGridPickerScroller.keyboardNavigable:has(:focus-visible) {
    outline: 4px solid var(--pxt-focus-border);
}

.blocklyGridPickerPadder {
    border-radius: 4px;
    outline: none;
    position: relative;
}

.blocklyGridPickerPadder .ui.input i.search.icon {
    margin-top: -0.2rem;
}

.blocklyWidgetDiv .blocklyGridPickerMenu .gridpicker-menuitem {
    background: white;
    cursor: pointer;
    min-width: unset;
}

.blocklyWidgetDiv .blocklyGridPickerMenu .gridpicker-menuitem-highlight, .blocklyWidgetDiv .blocklyGridPickerMenu .gridpicker-menuitem-hover {
    background: #d6e9f8;
    box-shadow: 0px 0px 0px 4px rgba(255, 255, 255, 0.2);
}

.blocklyWidgetDiv .blocklyGridPickerMenu .gridpicker-option {
    border: solid 1px black;
    border-radius: 4px;
    color: #fff;
    font-size: 12pt;
    font-weight: bold;
    display: table-cell;
    padding: 8px;
    text-align: center;
    vertical-align: top;
    -webkit-user-select: none;
    -moz-user-select: -moz-none;
    -ms-user-select: none;
        user-select: none;
}

.blocklyWidgetDiv .blocklyGridPickerMenu .gridpicker-menuitem-content {
    color: #fff;
    font-size: 13px;
    font-family: var(--pxt-page-font);
}

.blocklyWidgetDiv .blocklyGridPickerMenu .floatLeft {
    float: left;
}

.blocklyWidgetDiv .blocklyGridPickerMenu .gridpicker-option.gridpicker-option-selected {
    position: relative;
}

.blocklyWidgetDiv .blocklyGridPickerMenu .gridpicker-menuitem .gridpicker-menuitem-checkbox {
    display: none;
}

.blocklyWidgetDiv .blocklyGridPickerMenu:focus .blocklyGridPickerRow .gridpicker-menuitem.gridpicker-option-focused {
    outline: 3px solid var(--pxt-focus-border);
}

.blocklyGridPickerTooltip {
    z-index: 995;
}

.blocklyGridPickerSelectedBar {
    display: flex;
    padding-top: 5px;
    justify-content: space-between;
}

.blocklyGridPickerSelectedImage {
    padding: 3px;
    display: inline-block;
    vertical-align: middle;
}

.ui.input input.blocklyGridPickerSearchBar {
    background: none;
    border: none;
    color: white;
}

.ui.input input.blocklyGridPickerSearchBar::placeholder {
    color: white;
}

.ui.input input.blocklyGridPickerSearchBar::-webkit-input-placeholder {
    color: white;
}

.ui.input input.blocklyGridPickerSearchBar::-moz-placeholder {
    color: white;
}

.ui.input input.blocklyGridPickerSearchBar:-ms-input-placeholder {
    color: white;
}

.ui.input input.blocklyGridPickerSearchBar:-moz-placeholder {
    color: white;
}
`)},{"./field_base":31,"./field_dropdowngrid":35,"./field_utils":69,blockly:175}],37:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldImageDropdown=void 0;let _=e("blockly"),b=e("./field_utils");e=e("./field_dropdowngrid");class s extends e.FieldDropdownGrid{constructor(e,t,i){super(t.data),this.buttonClickAndClose_=e=>{e&&(this.setValue(e),_.DropDownDiv.hide())},this.columns_=parseInt(t.columns),this.maxRows_=parseInt(t.maxRows)||0,this.width_=parseInt(t.width)||300,this.backgroundColour_=(0,b.parseColour)(t.colour),this.borderColour_=pxt.toolbox.fadeColor(this.backgroundColour_,.4,!1)}setFocusedItem_(e){this.gridItems.forEach(e=>e.setAttribute("class","blocklyDropDownButton"));var t=this.gridItems[this.activeDescendantIndex],i=t.parentElement,t=(t.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonFocus"),i.getBoundingClientRect()),e=e.parentElement.getBoundingClientRect();t.bottom>e.bottom?i.scrollIntoView({block:"end"}):t.top<e.top&&i.scrollIntoView({block:"start"})}createRow(){var e=document.createElement("div");return e.setAttribute("role","row"),e}showEditor_(t){if(this.setOpeningPointerCoords(t),!_.DropDownDiv.hideIfOwner(this)){_.DropDownDiv.hideWithoutAnimation(),(0,b.clearDropDownDiv)();t=_.DropDownDiv.getContentDiv();let o=document.createElement("div");o.setAttribute("role","grid"),o.setAttribute("tabindex","0"),o.classList.add("blocklyMenu","blocklyDropdownMenu"),this.addPointerListener(t),this.addKeyDownHandler(o);var l=[];let s={height:0,width:0,items:[]};var e,a=this.getOptions(),c=this.columns_?this.width_/this.columns_-8:0;for(let i=0;i<a.length;i++){var u=a[i][0];let e=u.width,t=u.height;"placeholder"!=u.type&&this.columns_&&(e=c,t=c),s.height&&s.width+e+8>this.width_?(l.push(s),s={width:e+8,height:t+8,items:[a[i]]}):(s.width+=e+8,s.height=Math.max(s.height,t+8),s.items.push(a[i]))}l.push(s);let n,r=0;for(e of l){var h,d=this.createRow();d.style.width=e.width+"px",d.style.height=e.height+"px",o.appendChild(d);for(h of e.items){let i=r;var p=h[0];let s=h[1];if("placeholder"==p.type){var g=document.createElement("span");g.setAttribute("class","blocklyDropDownPlaceholder"),g.style.width=p.width+"px",g.style.height=e.height+"px",d.appendChild(g)}else{g=document.createElement("div");g.setAttribute("class","blocklyDropDownButtonContainer");let e=document.createElement("div"),t=(e.setAttribute("id",":"+i),e.setAttribute("role","gridcell"),e.setAttribute("aria-selected","false"),e.classList.add("blocklyDropDownButton"),e.title=p.alt,e.style.width=(c||p.width)+"px",e.style.height=(c||p.height)+"px",this.backgroundColour_);s==this.getValue()&&(t=this.sourceBlock_.getColourTertiary(),e.setAttribute("aria-selected","true"),this.activeDescendantIndex=i,o.setAttribute("aria-activedescendant",e.id),e.setAttribute("class","blocklyDropDownButton "+(this.openingPointerCoords?"blocklyDropDownButtonHover":"blocklyDropDownButtonFocus")),n=g),e.style.backgroundColor=t,e.style.borderColor=this.borderColour_,_.browserEvents.bind(e,"click",this,()=>this.buttonClickAndClose_(s)),_.browserEvents.bind(e,"pointermove",this,()=>{this.pointerMoveTriggeredByUser()&&(this.gridItems.forEach(e=>e.setAttribute("class","blocklyDropDownButton")),this.activeDescendantIndex=i,e.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),o.setAttribute("aria-activedescendant",e.id))}),_.browserEvents.bind(e,"pointerout",this,()=>{this.pointerOutTriggeredByUser()&&(e.setAttribute("class","blocklyDropDownButton"),o.removeAttribute("aria-activedescendant"),this.activeDescendantIndex=void 0)});var m=document.createElement("img");m.src=p.src,e.setAttribute("data-value",s),m.setAttribute("data-value",s),e.appendChild(m),this.gridItems.push(e),g.appendChild(e),d.append(g),r++}}}if(t.appendChild(o),this.maxRows_){var i=f(l);let e=f(l.slice(0,this.maxRows_));l.length>this.maxRows_&&(e+=.4*l[this.maxRows_].height),t.style.maxHeight=e+"px",t.style.height=i+"px"}pxt.BrowserUtils.isFirefox()&&(t.style.paddingRight="20px"),_.DropDownDiv.setColour(this.backgroundColour_,this.borderColour_),_.DropDownDiv.showPositionedByField(this,this.onHide_.bind(this)),o.focus(),n&&n.scrollIntoView({block:"end"});i=this.sourceBlock_;this.savedPrimary_=null==i?void 0:i.getColour(),null!=i&&i.isShadow()?i.setColour(i.getColourTertiary()):this.borderRect_&&this.borderRect_.setAttribute("fill",i.getColourTertiary())}}doValueUpdate_(e){this.selectedOption_=void 0,super.doValueUpdate_(e)}getFieldDescription(){return lf("image")}onHide_(){this.disposeGrid();var e=_.DropDownDiv.getContentDiv(),e=(e.removeAttribute("role"),e.removeAttribute("aria-activedescendant"),e.style.width="",e.style.paddingRight="",e.style.maxHeight="",this.sourceBlock_);null!=e&&e.isShadow()?this.sourceBlock_.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}}function f(e){return e.reduce((e,t)=>e+t.height,0)}i.FieldImageDropdown=s,_.Css.register(`
.blocklyDropDownButtonContainer,
.blocklyDropDownButton {
    display: inline-block;
    float: left;
    border-radius: 4px;
    text-align: center;
    margin: 0;
}

.blocklyDropDownButtonContainer {
    padding: 4px;
}

.blocklyDropDownButton {
    border: 1px solid;
    transition: box-shadow .1s;
    cursor: pointer;
    outline: none;
}

.blocklyDropDownButtonHover {
    box-shadow: 0px 0px 0px 4px rgba(255, 255, 255, 0.2);
}

.blocklyDropDownButtonFocus {
    box-shadow: 0px 0px 0px 4px rgb(255, 255, 255);
}

.blocklyDropDownButton:active {
    box-shadow: 0px 0px 0px 6px rgba(255, 255, 255, 0.2);
}

.blocklyDropDownButton > img {
    width: 80%;
    height: 80%;
    position: relative;
    top: 50%;
    transform: translateY(-50%);
}
`)},{"./field_dropdowngrid":35,"./field_utils":69,blockly:175}],38:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldImageNoText=void 0;let s=e("blockly");class o extends s.FieldImage{constructor(e,t,i,s,o,n,r){super(e,t,i,s,o,n,r),this.isFieldCustom_=!0}getFieldDescription(){}showEditor_(){super.showEditor_(),this.getSourceBlock()instanceof s.BlockSvg&&s.getFocusManager().focusNode(this.getSourceBlock())}}i.FieldImageNoText=o},{blockly:175}],39:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldImages=void 0;let u=e("blockly");var s=e("./field_imagedropdown");let h=e("./field_utils");class o extends s.FieldImageDropdown{constructor(e,t,i){super(e,t,i),this.shouldSort_=t.sort,this.addLabel_=!!t.addLabel}showEditor_(e){if(this.setOpeningPointerCoords(e),!u.DropDownDiv.hideIfOwner(this)){var r=this.sourceBlock_,e=(u.DropDownDiv.hideWithoutAnimation(),(0,h.clearDropDownDiv)(),u.DropDownDiv.getContentDiv());let o=document.createElement("div");o.setAttribute("role","grid"),o.setAttribute("tabindex","0"),o.setAttribute("class","blocklyMenu blocklyImageMenu"),this.addPointerListener(e),this.addKeyDownHandler(o);var t=this.getOptions();this.shouldSort_&&t.sort();let n=this.createRow();for(let s=0;s<t.length;s++){var l=t[s][0];let i=t[s][1];if("placeholder"==l.type){var a=document.createElement("span");a.setAttribute("class","blocklyDropDownPlaceholder"),a.style.width=l.width+"px",a.style.height=l.height+"px",o.appendChild(a)}else{a=document.createElement("div");a.setAttribute("class","blocklyDropDownButtonContainer");let e=document.createElement("div"),t=(e.setAttribute("id",":"+s),e.setAttribute("role","gridcell"),e.setAttribute("aria-selected","false"),e.setAttribute("class","blocklyDropDownButton"),e.title=l.alt,this.columns_?e.style.width=this.width_/this.columns_-8+"px":(e.style.width=l.width+"px",e.style.height=l.height+"px"),r.getColour());i==this.getValue()&&(t=r.getColourTertiary(),e.setAttribute("aria-selected","true"),this.activeDescendantIndex=s,o.setAttribute("aria-activedescendant",e.id),e.setAttribute("class","blocklyDropDownButton "+(this.openingPointerCoords?"blocklyDropDownButtonHover":"blocklyDropDownButtonFocus"))),e.style.backgroundColor=t,e.style.borderColor=r.getColourTertiary(),u.browserEvents.bind(e,"click",this,()=>this.buttonClickAndClose_(i)),u.browserEvents.bind(e,"pointermove",this,()=>{this.pointerMoveTriggeredByUser()&&(this.gridItems.forEach(e=>e.setAttribute("class","blocklyDropDownButton")),this.activeDescendantIndex=s,e.setAttribute("class","blocklyDropDownButton blocklyDropDownButtonHover"),o.setAttribute("aria-activedescendant",e.id))}),u.browserEvents.bind(e,"pointerout",this,()=>{this.pointerOutTriggeredByUser()&&(e.setAttribute("class","blocklyDropDownButton"),o.removeAttribute("aria-activedescendant"),this.activeDescendantIndex=void 0)});var c=document.createElement("img");c.src=l.src,e.setAttribute("data-value",i),c.setAttribute("data-value",i),e.appendChild(c),this.addLabel_&&((c=this.createTextNode_(l.alt)).setAttribute("data-value",i),e.appendChild(c)),this.gridItems.push(e),a.appendChild(e),n.append(a),n.childElementCount===this.columns_&&(o.appendChild(n),n=this.createRow())}}n.childElementCount&&o.appendChild(n),o.style.width=this.width_+"px",e.appendChild(o),u.DropDownDiv.setColour(r.getColour(),r.getColourTertiary()),u.DropDownDiv.showPositionedByField(this,this.onHideCallback.bind(this)),o.focus(),this.savedPrimary_=null==r?void 0:r.getColour(),null!=r&&r.isShadow()?r.setColour(r.style.colourTertiary):this.borderRect_&&this.borderRect_.setAttribute("fill",r.style.colourTertiary)}}onHideCallback(){this.disposeGrid();var e=u.DropDownDiv.getContentDiv(),e=(e.removeAttribute("role"),e.removeAttribute("aria-activedescendant"),this.sourceBlock_);null!=e&&e.isShadow()?e.setColour(this.savedPrimary_):this.borderRect_&&this.borderRect_.setAttribute("fill",this.savedPrimary_)}createTextNode_(e){var t=document.createElement("span");return t.setAttribute("class","blocklyDropdownTextLabel"),t.textContent=e,t}}i.FieldImages=o,u.Css.register(`
.blocklyImageMenu .blocklyDropDownButton > img {
    top: unset;
    transform: unset;
    margin-top: 4px;
}
.blocklyImageMenu .blocklyDropdownTextLabel {
    line-height: 1.15;
    margin-top: 2px;
}
`)},{"./field_imagedropdown":37,"./field_utils":69,blockly:175}],40:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldKind=void 0;let c=e("blockly"),n=e("./field_utils"),s=e("../external");e=e("./field_dropdown");class r extends e.FieldDropdown{constructor(e){var i;super((i=e,function(){let t=[];var e=this.getSourceBlock();return null!=e&&e.workspace&&!e.isInFlyout?e.workspace.getVariableMap().getVariablesOfType(d(i.name)).forEach(e=>{t.push([e.getName(),e.getName()])}):i.initialMembers.forEach(e=>t.push([e,e])),t.push([lf("Add a new {0}...",i.memberName),"CREATE"]),t.push([void 0,"SEPARATOR"]),t.push([lf("Rename {0}...",i.memberName),"RENAME"]),t.push([lf("Delete {0}...",i.memberName),"DELETE"]),t})),this.opts=e}initView(){super.initView()}onItemSelected_(e,t){var i=t.getValue();if("CREATE"===i)l(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),e=>e&&this.setValue(e));else if("RENAME"===i){let i=this.sourceBlock_.workspace;var o=i.getVariableMap().getVariable(this.value_,d(this.opts.name));let s=o.getName();-1!==this.opts.initialMembers.indexOf(s)?c.dialog.alert(lf("The built-in {0} '{1}' cannot be renamed. Try creating a new kind instead!",this.opts.memberName,s)):a(i,Object.assign(Object.assign({},this.opts),{toRename:o}),lf("Rename '{0}':",s),e=>{var t;for(t of(0,n.getAllFields)(i,e=>e instanceof r&&e.getValue()===s&&e.opts.name===this.opts.name))t.ref.setValue(e)})}else if("DELETE"===i){let s=this.sourceBlock_.workspace,o=s.getVariableMap().getVariable(this.value_,d(this.opts.name)),t=o.getName();if(-1!==this.opts.initialMembers.indexOf(t))c.dialog.alert(lf("The built-in {0} '{1}' cannot be deleted.",this.opts.memberName,t));else{let i=(0,n.getAllFields)(s,e=>e instanceof r&&e.getValue()===t&&e.opts.name===this.opts.name);1<i.length?c.dialog.confirm(lf('Delete {0} uses of the "{1}" {2}?',i.length,t,this.opts.memberName),e=>{if(e){c.Events.setGroup(!0);for(var t of i)t.block.dispose(!0);s.getVariableMap().deleteVariable(o),this.setValue(this.opts.initialMembers[0]),c.Events.setGroup(!1)}}):(s.getVariableMap().deleteVariable(o),this.setValue(this.opts.initialMembers[0]))}}else super.onItemSelected_(e,t)}doClassValidation_(t){var e;return null!=(e=this.opts)&&e.initialMembers&&!this.opts.initialMembers.find(e=>e==t)&&this.getOptions(),super.doClassValidation_(t)}getOptions(e){return this.initVariables(),super.getOptions(e)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){let t=this.sourceBlock_.workspace,i=h(t,this.opts.name);this.opts.initialMembers.forEach(e=>{-1===i.indexOf(e)&&o(t,this.opts,e)}),"CREATE"!==this.getValue()&&"RENAME"!==this.getValue()&&"DELETE"!==this.getValue()||this.opts.initialMembers.length&&this.setValue(this.opts.initialMembers[0])}}}function u(o,n,r,l,a){(0,s.prompt)(r,null,i=>{if(i){let t=!1;if(pxtc.isIdentifierStart(i.charCodeAt(0),2)){t=!0;for(let e=1;e<i.length;e++)pxtc.isIdentifierPart(i.charCodeAt(e),2)||(t=!1)}if(t)if(pxt.blocks.isReservedWord(i)||"CREATE"===i||"RENAME"===i||"DELETE"===i)c.dialog.alert(lf("'{0}' is a reserved word and cannot be used.",i),()=>u(o,n,r,l,a));else{var s=h(o,n.name);for(let e=0;e<s.length;e++)if(s[e]===i)return void c.dialog.alert(lf("A {0} named '{1}' already exists.",n.memberName,i),()=>u(o,n,r,l,a));i===n.createFunctionName&&c.dialog.alert(lf("'{0}' is a reserved name.",n.createFunctionName),()=>u(o,n,r,l,a)),l(i)}else c.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),()=>u(o,n,r,l,a))}},{placeholder:n.promptHint})}function l(t,i,e,s){u(t,i,e,e=>{s(o(t,i,e))},l)}function a(t,i,e,s){u(t,i,e,e=>{t.getVariableMap().renameVariable(i.toRename,e),s(e)},a)}function h(e,t){e=e.getVariableMap().getVariablesOfType(d(t));return e&&e.length?e.map(e=>e.getName()):[]}function o(e,t,i){return c.Variables.getOrCreateVariablePackage(e,null,i,d(t.name)),i}function d(e){return"KIND_"+e}i.FieldKind=r},{"../external":25,"./field_dropdown":34,"./field_utils":69,blockly:175}],41:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldLedMatrix=void 0;let n=e("blockly");var r,s,e=e("./field_matrix");let l=/^.*[\.#].*$/;(s=r=r||{})[s.None=0]="None",s[s.Number=1]="Number",s[s.Letter=2]="Letter";class a extends e.FieldMatrix{constructor(e,t,i){super(e,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.onColor="#FFFFFF",this.scale=1,this.numMatrixCols=5,this.numMatrixRows=5,this.yAxisLabel=r.None,this.xAxisLabel=r.None,this.cellState=[],this.clearSelectionOnBlur=!0,this.forceFocusVisible=!0,this.dontHandleMouseEvent_=e=>{e.stopPropagation(),e.preventDefault()},this.clearLedDragHandler=e=>{let t=this.sourceBlock_.getSvgRoot();pxsim.pointerEvents.down.forEach(e=>t.removeEventListener(e,this.dontHandleMouseEvent_)),t.removeEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.removeEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.removeEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),n.Touch.clearTouchIdentifier(),this.matrixSvg.removeEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),e.stopPropagation(),e.preventDefault()},this.toggleCell=(e,t,i)=>{this.cellState[e][t]=null!=i?i:this.currentDragState_,this.updateValue()},this.handleRootMouseMoveListener=i=>{if(this.sourceBlock_.isEditable()){let e,t;t=(i.changedTouches&&1==i.changedTouches.length?(e=i.changedTouches[0].clientX,i.changedTouches[0]):(e=i.clientX,i)).clientY;var s,i=document.elementFromPoint(e,t);i&&(s=i.getAttribute("data-x"),i=i.getAttribute("data-y"),null!=s)&&null!=i&&this.toggleCell(parseInt(s),parseInt(i))}},this.params=t,void 0!==this.params.rows&&(e=parseInt(this.params.rows),isNaN(e)||(this.numMatrixRows=e)),void 0!==this.params.columns&&(i=parseInt(this.params.columns),isNaN(i)||(this.numMatrixCols=i)),void 0!==this.params.onColor&&(this.onColor=this.params.onColor),void 0!==this.params.offColor&&(this.offColor=this.params.offColor),void 0!==this.params.scale?this.scale=Math.max(.6,Math.min(2,Number(this.params.scale))):15<Math.max(this.numMatrixCols,this.numMatrixRows)?this.scale=.85:10<Math.max(this.numMatrixCols,this.numMatrixRows)&&(this.scale=.9),this.size_.height=this.scale*Number(this.numMatrixRows)*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN+this.getXAxisHeight(),this.size_.width=this.scale*Number(this.numMatrixCols)*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_HORIZONTAL_MARGIN+this.getYAxisWidth()}getCellToggled(e,t){return this.cellState[e][t]}useTwoToneFocusIndicator(e,t){return this.getCellToggled(e,t)}showEditor_(){this.selected=[0,0];var e=this.matrixSvg.getBoundingClientRect();let t=n.WidgetDiv.getDiv();t.append(this.matrixSvg),this.addKeyboardFocusHandlers(),t.style.left=e.left+"px",t.style.top=e.top+"px",t.style.transform=`scale(${n.getMainWorkspace().getScale()})`,t.style.transformOrigin="0 0",n.WidgetDiv.show(this,this.sourceBlock_.RTL,()=>{this.removeKeyboardFocusHandlers(),this.clearCellSelection(),this.fieldGroup_.append(this.matrixSvg),t.style.left="",t.style.top="",t.style.transform="",t.style.transformOrigin=""}),this.matrixSvg.focus(),this.focusCell(0,0)}initMatrix(){if(!this.sourceBlock_.isInsertionMarker()){this.matrixSvg=pxsim.svg.parseString(`<svg xmlns="http://www.w3.org/2000/svg" id="field-matrix" class="blocklyMatrix" tabindex="-1" role="grid" width="${this.size_.width}" height="${this.size_.height}"/>`),this.matrixSvg.ariaLabel=lf("LED grid");var e=n.getMainWorkspace();this.matrixSvg.style.boxShadow=`rgba(255, 255, 255, 0.3) 0 0 0 ${4*e.getAbsoluteScale()}px`,this.matrixSvg.style.transition="box-shadow 0.25s",this.matrixSvg.style.borderRadius=4*e.getAbsoluteScale()+"px";for(let t=0;t<this.numMatrixCols;t++){this.cellState.push([]);for(let e=0;e<this.numMatrixRows;e++)this.cellState[t].push(!1)}if(this.restoreStateFromString(),this.createMatrixDisplay({cellWidth:a.CELL_WIDTH,cellHeight:a.CELL_WIDTH,cellLabel:lf("LED"),cellHorizontalMargin:a.CELL_HORIZONTAL_MARGIN,cellVerticalMargin:a.CELL_VERTICAL_MARGIN,cornerRadius:a.CELL_CORNER_RADIUS,cellFill:this.offColor,padLeft:this.getYAxisWidth(),scale:this.scale}),this.updateValue(),this.xAxisLabel!==r.None){var e=this.scale*this.numMatrixRows*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+2*a.CELL_VERTICAL_MARGIN+a.BOTTOM_MARGIN,t=pxsim.svg.child(this.matrixSvg,"g",{transform:`translate(0 ${e})`});for(let e=0;e<this.numMatrixCols;e++){var i=this.getYAxisWidth()+this.scale*e*(a.CELL_WIDTH+a.CELL_HORIZONTAL_MARGIN)+a.CELL_WIDTH/2+a.CELL_HORIZONTAL_MARGIN/2;pxsim.svg.child(t,"text",{x:i,class:"blocklyText"}).textContent=this.getLabel(e,this.xAxisLabel)}}if(this.yAxisLabel!==r.None){var s=pxsim.svg.child(this.matrixSvg,"g",{});for(let e=0;e<this.numMatrixRows;e++){var o=this.scale*e*(a.CELL_WIDTH+a.CELL_VERTICAL_MARGIN)+a.CELL_WIDTH/2+2*a.CELL_VERTICAL_MARGIN;pxsim.svg.child(s,"text",{x:0,y:o,class:"blocklyText"}).textContent=this.getLabel(e,this.yAxisLabel)}}e=n.utils.dom.createSvgElement("rect",{x:0,y:0,fill:"none",width:this.size_.width,height:this.size_.height},null);this.matrixSvg.append(e),this.fieldGroup_.classList.add("blocklyFieldLedMatrixGroup"),this.fieldGroup_.append(this.matrixSvg),this.attachEventHandlersToMatrix()}}getLabel(e,t){return t!==r.Letter?(e+1).toString():String.fromCharCode(e+65)}updateEditable(){var e=this.fieldGroup_;this.EDITABLE&&e&&(this.sourceBlock_.isEditable()?this.fieldGroup_.setAttribute("cursor","pointer"):this.fieldGroup_.removeAttribute("cursor"),super.updateEditable())}attachPointerEventHandlersToCell(i,s,t){pxsim.pointerEvents.down.forEach(e=>t.addEventListener(e,e=>{if(this.sourceBlock_.isEditable()){let t=this.sourceBlock_.getSvgRoot();this.currentDragState_=!this.cellState[i][s],n.hideChaff(),n.common.setSelected(this.sourceBlock_),this.toggleCell(i,s),pxsim.pointerEvents.down.forEach(e=>t.addEventListener(e,this.dontHandleMouseEvent_)),t.addEventListener(pxsim.pointerEvents.move,this.dontHandleMouseEvent_),document.addEventListener(pxsim.pointerEvents.up,this.clearLedDragHandler),document.addEventListener(pxsim.pointerEvents.leave,this.clearLedDragHandler),this.matrixSvg.addEventListener(pxsim.pointerEvents.move,this.handleRootMouseMoveListener),e.stopPropagation(),e.preventDefault(),this.returnEphemeralFocus()}},!1))}getColor(e,t){return this.cellState[e][t]?this.onColor:this.offColor||a.DEFAULT_OFF_COLOR}getOpacity(e,t){var i=this.offColor?"1.0":"0.2";return this.cellState[e][t]?"1.0":i}updateCell(e,t){var i=this.cells[e][t];i.setAttribute("fill",this.getColor(e,t)),i.setAttribute("fill-opacity",this.getOpacity(e,t)),i.setAttribute("class","blocklyLed"+(this.cellState[e][t]?"On":"Off")),i.setAttribute("aria-checked",this.cellState[e][t].toString())}setValue(e,t=!0){var i=e!==this.value_;if(super.setValue(String(e),i),this.matrixSvg){t&&this.restoreStateFromString();for(let t=0;t<this.numMatrixCols;t++)for(let e=0;e<this.numMatrixRows;e++)this.updateCell(t,e)}}render_(){this.visible_?this.matrixSvg||this.initMatrix():this.markDirty()}getValue(){e=this.value_;var e,t=(t=(e=(e||"").trim()).charAt(0))!==e.charAt(e.length-1)||-1===o.indexOf(t)?e:e.substr(1,e.length-2).trim();return`\`
${a.TAB}${t}
${a.TAB}\``}getFieldDescription(){return lf("{0}x{1} LED Grid",this.numMatrixCols,this.numMatrixRows)}restoreStateFromString(){var s,e=this.value_;if(e){var o=e.split("\n").filter(e=>l.test(e));for(let i=0;i<o.length&&i<this.numMatrixRows;i++){let t=0;var n=o[i];for(let e=0;e<n.length&&t<this.numMatrixCols;e++)"."===(s=n[e])||"_"===s||"0"===s?(this.cellState[t][i]=!1,t++):"#"!==(s=n[e])&&"*"!==s&&"1"!==s||(this.cellState[t][i]=!0,t++)}}}updateValue(){let i="";for(let t=0;t<this.numMatrixRows;t++){for(let e=0;e<this.numMatrixCols;e++)i+=(this.cellState[e][t]?"#":".")+" ";i+="\n"+a.TAB}this.setValue(i,!1)}getYAxisWidth(){return this.yAxisLabel===r.None?0:a.Y_AXIS_WIDTH}getXAxisHeight(){return this.xAxisLabel===r.None?0:a.X_AXIS_HEIGHT}}(i.FieldLedMatrix=a).CELL_WIDTH=25,a.CELL_HORIZONTAL_MARGIN=7,a.CELL_VERTICAL_MARGIN=5,a.CELL_CORNER_RADIUS=5,a.BOTTOM_MARGIN=9,a.Y_AXIS_WIDTH=9,a.X_AXIS_HEIGHT=10,a.TAB="        ",a.DEFAULT_OFF_COLOR="#000000";let o=["'",'"',"`"];n.Css.register(`
.pxt-renderer.classic-theme .blocklyDraggable:not(.blocklyDisabled) .blocklyFieldLedMatrixGroup.blocklyEditableField:not(.blocklyEditing):hover>rect {
    stroke: none;
}
.pxt-renderer.classic-theme .blocklyDraggable:not(.blocklyDisabled) .blocklyFieldLedMatrixGroup.blocklyActiveFocus.blocklyEditableField:not(.blocklyEditing):hover>rect {
    stroke: var(--blockly-active-node-color);
    stroke-width: var(--blockly-selection-width);
}
.pxt-renderer.classic-theme .blocklyDraggable:not(.blocklyDisabled) .blocklyFieldLedMatrixGroup.blocklyPassiveFocus.blocklyEditableField:not(.blocklyEditing):hover>rect {
    stroke: var(--blockly-active-node-color);
    stroke-dasharray: 5px 3px;
    stroke-width: var(--blockly-selection-width);
}
.blocklyFieldLedMatrixGroup > .blocklyFieldRect {
    fill: none !important;
}`)},{"./field_matrix":42,blockly:175}],42:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldMatrix=void 0;let s=e("blockly");class o extends s.Field{constructor(){super(...arguments),this.cells=[],this.keyDownBinding=null,this.blurBinding=null,this.selected=void 0,this.forceFocusVisible=!1,this.returnEphemeralFocusFn=void 0,this.getCellId=(e,t)=>this.sourceBlock_.id+`:${e}-`+t}createMatrixDisplay({cellWidth:i,cellHeight:s,cellLabel:o,cellHorizontalMargin:n,cellVerticalMargin:r,cornerRadius:l=0,cellFill:a,cellStroke:c,padLeft:u=0,scale:h=1}){for(let e=0;e<this.numMatrixCols;e++)this.cells.push([]);for(let t=0;t<this.numMatrixRows;t++){var d=pxsim.svg.child(this.matrixSvg,"g",{role:"row"});for(let e=0;e<this.numMatrixCols;e++){var p=h*e*(i+n)+n+u,g=h*t*(s+r)+r,p=pxsim.svg.child(d,"g",{transform:`translate(${p} ${g})`,role:"gridcell"}),g={id:this.getCellId(e,t),"aria-label":o,role:"switch","aria-checked":"false",width:h*i,height:h*s,fill:null!=a?a:"none",stroke:c,"data-x":e,"data-y":t,rx:Math.max(2,h*l)},p=pxsim.svg.child(p,"rect",g);this.cells[e][t]=p}}}handleArrowUp(e,t){this.selected=[e,t-1]}handleArrowDown(e,t){this.selected=[e,t+1]}handleArrowLeft(e,t){0!==e?this.selected=[e-1,t]:0!==t&&(this.selected=[this.numMatrixCols-1,t-1])}handleArrowRight(e,t){e!==this.cells.length-1?this.selected=[e+1,t]:t!==this.numMatrixRows-1&&(this.selected=[0,t+1])}addKeyDownHandler(){this.keyDownBinding=s.browserEvents.bind(this.matrixSvg,"keydown",this,e=>{if(this.selected){var[t,i]=this.selected,s=pxt.BrowserUtils.isMac()?e.metaKey:e.ctrlKey;switch(e.code){case"ArrowUp":0!==i&&this.handleArrowUp(t,i);break;case"ArrowDown":i!==this.cells[0].length-1&&this.handleArrowDown(t,i);break;case"ArrowLeft":this.handleArrowLeft(t,i);break;case"ArrowRight":this.handleArrowRight(t,i);break;case"Home":this.selected=s?[0,0]:[0,i];break;case"End":this.selected=s?[this.numMatrixCols-1,this.numMatrixRows-1]:[this.numMatrixCols-1,i];break;case"Enter":case"Space":this.toggleCell(t,i,!this.getCellToggled(t,i));break;case"Escape":return this.sourceBlock_.workspace.markFocused(),void this.returnEphemeralFocus();default:return}var[o,n]=this.selected;this.focusCell(o,n),e.preventDefault(),e.stopPropagation()}})}addBlurHandler(){this.blurBinding=s.browserEvents.bind(this.matrixSvg,"blur",this,e=>{this.clearSelectionOnBlur?(this.removeKeyboardFocusHandlers(),this.clearCellSelection()):this.clearFocusIndicator()})}focusCell(e,t){this.setCellSelection(e,t),this.setFocusIndicator(this.cells[e][t],this.useTwoToneFocusIndicator(e,t))}setCellSelection(e,t){this.matrixSvg.setAttribute("aria-activedescendant",this.getCellId(e,t))}clearCellSelection(){this.selected&&(this.clearFocusIndicator(),this.selected=void 0),this.matrixSvg.removeAttribute("aria-activedescendant")}setFocusIndicator(e,t){var i,s;this.clearFocusIndicator(),(this.matrixSvg.matches(":focus-visible")||this.forceFocusVisible)&&(i=e.parentNode,s=parseInt(e.getAttribute("width")),e=parseInt(e.getAttribute("rx")),pxsim.svg.child(i,"rect",{transform:"translate(-2, -2)",width:s+4,height:s+4,rx:Math.max(2,e)+"px",stroke:"#fff","stroke-width":4,fill:"none"}),t)&&pxsim.svg.child(i,"rect",{transform:"translate(-1, -1)",width:s+2,height:s+2,rx:Math.max(2,e)+"px",stroke:"#000","stroke-width":2,fill:"none"})}clearFocusIndicator(){this.cells.forEach(e=>e.forEach(e=>{for(;e.nextElementSibling;)e.nextElementSibling.remove()}))}addKeyboardFocusHandlers(){this.sourceBlock_.isInFlyout||(this.addKeyDownHandler(),this.addBlurHandler())}attachEventHandlersToMatrix(){if(!this.sourceBlock_.isInFlyout)for(let t=0;t<this.numMatrixCols;++t)for(let e=0;e<this.numMatrixRows;++e)this.attachPointerEventHandlersToCell(t,e,this.cells[t][e])}returnEphemeralFocus(){var e;this.returnEphemeralFocusFn&&(e=this.returnEphemeralFocusFn,this.returnEphemeralFocusFn=void 0,e())}removeKeyboardFocusHandlers(){this.keyDownBinding&&(s.browserEvents.unbind(this.keyDownBinding),this.keyDownBinding=void 0),this.blurBinding&&(s.browserEvents.unbind(this.blurBinding),this.blurBinding=void 0)}}i.FieldMatrix=o,s.Css.register(`
    .blocklyMatrix:focus-visible {
        outline: none;
    }
`)},{blockly:175}],43:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0}),s.FieldCustomMelody=s.TOTAL_WIDTH=s.HEADER_HEIGHT=void 0;let i=e("blockly");var o=pxt.svgUtil;let n=e("./field_utils");e=e("./field_matrix");s.HEADER_HEIGHT=50,s.TOTAL_WIDTH=300;class r extends e.FieldMatrix{constructor(e,t,i){super(e,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.soundingKeys=0,this.numMatrixRows=8,this.numMatrixCols=8,this.tempo=120,this.isPlaying=!1,this.timeouts=[],this.clearSelectionOnBlur=!1,this.matrixFocusBind=null,this.tabKeyBind=null,this.params=t,this.createMelodyIfDoesntExist()}init(){super.init(),this.onInit()}showEditor_(e){e=!e;i.DropDownDiv.hideWithoutAnimation(),(0,n.clearDropDownDiv)(),i.DropDownDiv.setColour(this.getDropdownBackgroundColour(),this.getDropdownBorderColour());let t=i.DropDownDiv.getContentDiv();pxt.BrowserUtils.addClass(t,"melody-content-div"),pxt.BrowserUtils.addClass(t.parentElement,"melody-editor-dropdown"),this.gallery=new pxtmelody.MelodyGallery,this.renderEditor(t),this.addKeyboardFocusHandlers(),this.attachEventHandlersToMatrix(),this.matrixFocusBind=i.browserEvents.bind(this.matrixSvg,"focus",this,this.handleMatrixFocus.bind(this)),this.tabKeyBind=i.browserEvents.bind(t,"keydown",this,this.handleTabKey.bind(this)),this.prevString=this.getValue(),(0,n.setMelodyEditorOpen)(this.sourceBlock_,!0),i.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,()=>{this.onEditorClose(),pxt.BrowserUtils.removeClass(t,"melody-content-div"),pxt.BrowserUtils.removeClass(t.parentElement,"melody-editor-dropdown"),(0,n.setMelodyEditorOpen)(this.sourceBlock_,!1)}),e&&this.toggle.getRootElement().focus()}getValue(){return this.stringRep=this.getTypeScriptValue(),this.stringRep}doValueUpdate_(e){null==e||""==e||'""'==e||this.stringRep&&this.stringRep===e||(this.stringRep=e,this.parseTypeScriptValue(e),super.doValueUpdate_(this.getValue()))}getText_(){return this.invalidString?pxt.Util.lf("Invalid Input"):this.getValue()}getFieldDescription(){var e;return(null==(e=null==(e=this.melody.getStringRepresentation())?void 0:e.replace(/-/g,""))?void 0:e.trim())||lf("empty")}onInit(){this.render_(),this.createMelodyIfDoesntExist(),this.invalidString||(this.fieldGroup_||(this.fieldGroup_=i.utils.dom.createSvgElement("g",{},null)),this.visible_||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.updateFieldLabel())}render_(){super.render_(),this.invalidString||(this.size_.width=r.MUSIC_ICON_WIDTH+(r.COLOR_BLOCK_WIDTH+r.COLOR_BLOCK_SPACING)*this.numMatrixCols),this.size_.height=34,this.sourceBlock_.setColour("#ffffff")}renderEditor(e){var t=this.getDropdownBackgroundColour(),i=this.getDropdownBorderColour();this.topDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.topDiv,"melody-top-bar-div"),this.root=new o.SVG(this.topDiv).id("melody-editor-header-controls"),this.toggle=new a(this.root,{leftText:lf("Editor"),rightText:lf("Gallery"),baseColor:t}),this.toggle.onStateChange(e=>{e?this.hideGallery():this.showGallery()}),this.firstFocusableElement=this.toggle.getRootElement(),this.toggle.layout(),this.toggle.translate((s.TOTAL_WIDTH-this.toggle.width())/2,l),e.appendChild(this.topDiv),e.appendChild(this.gallery.getElement()),this.editorDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.editorDiv,"melody-editor-div"),this.editorDiv.style.setProperty("background-color",i),this.gridDiv=this.createGridDisplay(),this.editorDiv.appendChild(this.gridDiv),this.bottomDiv=document.createElement("div"),pxt.BrowserUtils.addClass(this.bottomDiv,"melody-bottom-bar-div"),this.doneButton=document.createElement("button"),pxt.BrowserUtils.addClass(this.doneButton,"melody-confirm-button"),this.doneButton.innerText=lf("Done"),this.doneButton.addEventListener("click",()=>this.onDone()),this.doneButton.style.setProperty("background-color",t),this.lastFocusableElement=this.doneButton,this.playButton=document.createElement("button"),this.playButton.id="melody-play-button",this.playButton.addEventListener("click",()=>this.togglePlay()),this.playIcon=document.createElement("i"),this.playIcon.id="melody-play-icon",pxt.BrowserUtils.addClass(this.playIcon,"play icon"),this.playButton.appendChild(this.playIcon),this.tempoInput=document.createElement("input"),pxt.BrowserUtils.addClass(this.tempoInput,"ui input"),this.tempoInput.type="number",this.tempoInput.title=lf("tempo"),this.tempoInput.id="melody-tempo-input",this.tempoInput.addEventListener("input",()=>this.setTempo(+this.tempoInput.value)),this.syncTempoField(!0),this.bottomDiv.appendChild(this.tempoInput),this.bottomDiv.appendChild(this.playButton),this.bottomDiv.appendChild(this.doneButton),this.editorDiv.appendChild(this.bottomDiv),e.appendChild(this.editorDiv)}onEditorClose(){this.stopMelody(),this.gallery&&this.gallery.stopMelody(),this.matrixFocusBind&&(i.browserEvents.unbind(this.matrixFocusBind),this.matrixFocusBind=void 0),this.tabKeyBind&&(i.browserEvents.unbind(this.tabKeyBind),this.tabKeyBind=void 0),this.clearCellSelection(),this.removeKeyboardFocusHandlers(),this.clearDomReferences(),this.sourceBlock_&&i.Events.isEnabled()&&this.getValue()!==this.prevString&&i.Events.fire(new i.Events.BlockChange(this.sourceBlock_,"field",this.name,this.prevString,this.getValue())),this.prevString=void 0}onDone(){i.DropDownDiv.hideIfOwner(this)}clearDomReferences(){this.topDiv=null,this.editorDiv=null,this.gridDiv=null,this.bottomDiv=null,this.doneButton=null,this.playButton=null,this.playIcon=null,this.tempoInput=null,this.matrixSvg=null,this.cells=[],this.toggle=null,this.root=null,this.firstFocusableElement=null,this.lastFocusableElement=null,this.gallery.clearDomReferences()}getTypeScriptValue(){return this.invalidString||(this.melody?'"'+this.melody.getStringRepresentation()+'"':"")}parseTypeScriptValue(e){var t=e;try{e=(e=e.slice(1,-1)).trim(),this.createMelodyIfDoesntExist();var i,s=e.split(" ");s.forEach(e=>{if(!this.isValidNote(e))throw new Error(lf("Invalid note '{0}'. Notes can be C D E F G A B C5",e))}),this.melody.resetMelody();for(let e=0;e<s.length;e++)"-"!=s[e]&&(i=pxtmelody.noteToRow(s[e]),this.melody.updateMelody(i,e));this.updateFieldLabel()}catch(e){pxt.log(e),this.invalidString=t}}isValidNote(e){switch(e){case"C":case"D":case"E":case"F":case"G":case"A":case"B":case"C5":case"-":return!0}return!1}getPreviewWidth(){return this.updateSize_(),this.size_.width}getPreviewHeight(){var e;return(null==(e=this.getConstants())?void 0:e.FIELD_BORDER_RECT_HEIGHT)||16}getDropdownBackgroundColour(){var e=this.sourceBlock_.getParent();return e?e.getColour():"#3D3D3D"}getDropdownBorderColour(){var e=this.sourceBlock_.getParent();return e?e.getColourTertiary():"#2A2A2A"}updateFieldLabel(){if(this.fieldGroup_){pxsim.U.clear(this.fieldGroup_);var e=c("ï€").appendClass("melody-editor-field-icon").at(6,15),t=(this.fieldGroup_.appendChild(e.el),this.melody.getStringRepresentation().trim().split(" "));for(let e=0;e<t.length;e++){var i=pxtmelody.getColorClass(pxtmelody.noteToRow(t[e])),s=(new o.Rect).at((r.COLOR_BLOCK_WIDTH+r.COLOR_BLOCK_SPACING)*e+r.COLOR_BLOCK_X,r.COLOR_BLOCK_Y).size(r.COLOR_BLOCK_WIDTH,r.COLOR_BLOCK_HEIGHT).stroke("#898989",1).fill((e=>{switch(e){case 0:return"#A80000";case 1:return"#D83B01";case 2:return"#FFB900";case 3:return"#107C10";case 4:return"#008272";case 5:return"#0078D7";case 6:return"#5C2D91";case 7:return"#B4009E"}return"#DCDCDC"})(pxtmelody.noteToRow(t[e]))).corners(3,2);pxt.BrowserUtils.addClass(s.el,i),this.fieldGroup_.appendChild(s.el)}}}setTempo(e){(isNaN(e)||e<=0)&&this.tempoInput?this.tempoInput.value=this.tempo+"":this.tempo!=e&&(this.tempo=e,this.melody&&this.melody.setTempo(this.tempo),this.tempoInput&&(this.tempoInput.value=this.tempo+""),this.syncTempoField(!1))}syncTempoField(e){var t=this.sourceBlock_.getParent();if(t)for(var i of t.inputList)if("tempo"===i.name||"bpm"===i.name){i=i.connection.targetBlock();i&&(e?i.getFieldValue("SLIDER")?(this.tempoInput.value=i.getFieldValue("SLIDER"),this.tempo=+this.tempoInput.value):this.tempoInput.value=this.tempo+"":("math_number_minmax"===i.type?i.setFieldValue(this.tempoInput.value,"SLIDER"):i.setFieldValue(this.tempoInput.value,"NUM"),this.tempoInput.focus()));break}}getDuration(){return 6e4/this.tempo}createMelodyIfDoesntExist(){return!this.melody&&(this.melody=new pxtmelody.MelodyArray,!0)}toggleCell(e,t){this.invalidString=null,this.melody.updateMelody(t,e),this.melody.getValue(t,e)&&!this.isPlaying&&this.playNote(t,e),this.updateGrid(),this.updateFieldLabel()}getCellToggled(e,t){return this.melody.getValue(t,e)}useTwoToneFocusIndicator(e,t){return!0}updateGrid(){for(let t=0;t<this.numMatrixRows;t++){var i=pxtmelody.getColorClass(t);for(let e=0;e<this.numMatrixCols;e++){var s=this.cells[e][t];this.melody.getValue(t,e)?(pxt.BrowserUtils.removeClass(s,"melody-default"),pxt.BrowserUtils.addClass(s,i)):(pxt.BrowserUtils.addClass(s,"melody-default"),pxt.BrowserUtils.removeClass(s,i))}}}playNote(e,t){let i=++this.soundingKeys;this.isPlaying?(this.timeouts.push(setTimeout(()=>{this.playToneCore(e)},t*this.getDuration())),this.timeouts.push(setTimeout(()=>{pxt.AudioContextManager.stop()},(t+1)*this.getDuration()))):(this.playToneCore(e),this.timeouts.push(setTimeout(()=>{this.soundingKeys==i&&pxt.AudioContextManager.stop()},this.getDuration())))}queueToneForColumn(t,e,i){let s=setTimeout(()=>{++this.soundingKeys,pxt.AudioContextManager.stop();for(let e=0;e<this.numMatrixRows;e++)this.melody.getValue(e,t)&&this.playToneCore(e);this.highlightColumn(t,!0),this.timeouts=this.timeouts.filter(e=>e!==s)},e),o=setTimeout(()=>{this.timeouts=this.timeouts.filter(e=>e!==o),this.highlightColumn(t,!1)},e+i);this.timeouts.push(s),this.timeouts.push(o)}playToneCore(e){let t=0;switch(e){case 0:t=523;break;case 1:t=494;break;case 2:t=440;break;case 3:t=392;break;case 4:t=349;break;case 5:t=330;break;case 6:t=294;break;case 7:t=262}pxt.AudioContextManager.tone(t)}highlightColumn(e,t){this.cells[e].forEach(e=>{t?pxt.BrowserUtils.addClass(e,"playing"):pxt.BrowserUtils.removeClass(e,"playing")})}createGridDisplay(){return r.VIEWBOX_WIDTH=(r.CELL_WIDTH+r.CELL_HORIZONTAL_MARGIN)*this.numMatrixCols+r.CELL_HORIZONTAL_MARGIN,pxt.BrowserUtils.isEdge()&&(r.VIEWBOX_WIDTH+=37),r.VIEWBOX_HEIGHT=(r.CELL_WIDTH+r.CELL_VERTICAL_MARGIN)*this.numMatrixRows+r.CELL_VERTICAL_MARGIN,this.matrixSvg=pxsim.svg.parseString(`<svg xmlns="http://www.w3.org/2000/svg" class="melody-grid-div blocklyMatrix" role="grid" viewBox="0 0 ${r.VIEWBOX_WIDTH} ${r.VIEWBOX_HEIGHT}" tabindex="0" />`),this.matrixSvg.ariaLabel=lf("Melody grid"),this.createMatrixDisplay({cellWidth:r.CELL_WIDTH,cellHeight:r.CELL_WIDTH,cellLabel:lf("Note"),cellStroke:"white",cellHorizontalMargin:r.CELL_HORIZONTAL_MARGIN,cellVerticalMargin:r.CELL_VERTICAL_MARGIN,cornerRadius:r.CELL_CORNER_RADIUS}),this.updateGrid(),this.matrixSvg}handleMatrixFocus(e){this.selected||(t=null!=(t=this.getMelodyNote(0))?t:0,this.selected=[0,t]);var[t,i]=this.selected;this.focusCell(t,i)}handleTabKey(e){"Tab"===e.code&&(document.activeElement!==this.lastFocusableElement||e.shiftKey?document.activeElement===this.firstFocusableElement&&e.shiftKey&&(this.lastFocusableElement.focus(),e.preventDefault()):(this.firstFocusableElement.focus(),e.preventDefault()))}attachPointerEventHandlersToCell(t,i,s){pxsim.pointerEvents.down.forEach(e=>s.addEventListener(e,e=>{this.toggleCell(t,i),this.clearFocusIndicator(),e.stopPropagation(),e.preventDefault()},!1))}handleArrowUp(e,t){var i=void 0!==this.getMelodyNote(e);this.selected=[e,t-1],i&&this.toggleCell(this.selected[0],this.selected[1])}handleArrowDown(e,t){var i=void 0!==this.getMelodyNote(e);this.selected=[e,t+1],i&&this.toggleCell(this.selected[0],this.selected[1])}handleArrowLeft(e,t){var e=(e+this.numMatrixCols-1)%this.numMatrixCols,i=null!=(i=this.getMelodyNote(e))?i:t;this.selected=[e,i]}handleArrowRight(e,t){var e=(e+this.numMatrixCols+1)%this.numMatrixCols,i=null!=(i=this.getMelodyNote(e))?i:t;this.selected=[e,i]}getMelodyNote(t){for(let e=0;e<this.numMatrixRows;++e)if(this.melody.getValue(e,t))return e}togglePlay(){this.isPlaying?this.stopMelody():(this.isPlaying=!0,this.playMelody()),this.updatePlayButton()}updatePlayButton(){this.isPlaying?(pxt.BrowserUtils.removeClass(this.playIcon,"play icon"),pxt.BrowserUtils.addClass(this.playIcon,"stop icon")):(pxt.BrowserUtils.removeClass(this.playIcon,"stop icon"),pxt.BrowserUtils.addClass(this.playIcon,"play icon"))}playMelody(){if(this.isPlaying){for(let e=0;e<this.numMatrixCols;e++)this.queueToneForColumn(e,e*this.getDuration(),this.getDuration());this.timeouts.push(setTimeout(()=>this.playMelody(),this.numMatrixCols*this.getDuration()))}else this.stopMelody()}stopMelody(){if(this.isPlaying){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop(),this.isPlaying=!1,this.cells.forEach(e=>e.forEach(e=>pxt.BrowserUtils.removeClass(e,"playing")))}}showGallery(){this.stopMelody(),this.updatePlayButton(),this.gallery.show(e=>{e&&(this.melody.parseNotes(e),this.toggle.toggle(),this.toggle.getRootElement().focus(),this.updateFieldLabel(),this.updateGrid())}),this.lastFocusableElement=this.gallery.getLastFocusableElement()}hideGallery(){this.gallery.hide(),this.lastFocusableElement=this.doneButton}isFullBlockField(){return!0}}(s.FieldCustomMelody=r).CELL_WIDTH=25,r.CELL_HORIZONTAL_MARGIN=5,r.CELL_VERTICAL_MARGIN=7,r.CELL_CORNER_RADIUS=5,r.COLOR_BLOCK_WIDTH=10,r.COLOR_BLOCK_HEIGHT=20,r.COLOR_BLOCK_X=20,r.COLOR_BLOCK_Y=5,r.COLOR_BLOCK_SPACING=2,r.MUSIC_ICON_WIDTH=20;let l=6;class a{constructor(e,t){this.props=(e=>(e.baseColor||(e.baseColor="#e95153"),e.backgroundColor||(e.backgroundColor="rgba(52,73,94,.2)"),e.borderColor||(e.borderColor="rgba(52,73,94,.4)"),e.selectedTextColor||(e.selectedTextColor=e.baseColor),e.unselectedTextColor||(e.unselectedTextColor="hsla(0,0%,100%,.9)"),e.switchColor||(e.switchColor="#ffffff"),e))(t),this.root=e.group(),this.buildDom(),this.isLeft=!0}buildDom(){this.root.style().content(`
        .toggle-left {
            transform: translateX(0px);
            animation: mvleft 0.2s 0s ease;
        }

        .toggle-right {
            transform: translateX(100px);
            animation: mvright 0.2s 0s ease;
        }

        @keyframes mvright {
            0% {
                transform: translateX(0px);
            }
            100% {
                transform: translateX(100px);
            }
        }

        @keyframes mvleft {
            0% {
                transform: translateX(100px);
            }
            100% {
                transform: translateX(0px);
            }
        }
        `),this.root.def().create("clipPath","sprite-editor-toggle-border").clipPathUnits(!0).draw("rect").at(0,0).corners(.02,.1).size(1,1),this.root.draw("rect").size(200,40).fill(this.props.baseColor).stroke(this.props.borderColor,4).corners(4,4).clipPath("url(#sprite-editor-toggle-border)"),this.root.draw("rect").at(2,2).size(196,36).fill(this.props.backgroundColor).corners(4,4),this.switch=this.root.draw("rect").at(2,2).size(98,36).fill(this.props.switchColor).corners(4,4),this.leftElement=this.root.group(),this.leftText=c(this.props.leftText).appendClass("sprite-editor-text").fill(this.props.selectedTextColor),this.leftElement.appendChild(this.leftText),this.rightElement=this.root.group(),this.rightText=c(this.props.rightText).appendClass("sprite-editor-text").fill(this.props.unselectedTextColor),this.rightElement.appendChild(this.rightText),this.root.onClick(()=>this.toggle()),this.root.el.tabIndex=0,this.root.el.classList.add("melody-editor-toggle-buttons"),this.root.el.addEventListener("keydown",e=>{["Space","ArrowLeft","ArrowRight","Enter"].includes(e.code)&&(this.toggle(),e.preventDefault())})}toggle(e=!1){this.isLeft?(this.switch.removeClass("toggle-left"),this.switch.appendClass("toggle-right"),this.leftText.fill(this.props.unselectedTextColor),this.rightText.fill(this.props.selectedTextColor)):(this.switch.removeClass("toggle-right"),this.switch.appendClass("toggle-left"),this.leftText.fill(this.props.selectedTextColor),this.rightText.fill(this.props.unselectedTextColor)),this.isLeft=!this.isLeft,!e&&this.changeHandler&&this.changeHandler(this.isLeft)}onStateChange(e){this.changeHandler=e}layout(){this.leftText.moveTo(51,20),this.rightText.moveTo(149,20)}translate(e,t){this.root.translate(e,t)}height(){return 40}width(){return 200}getRootElement(){return this.root.el}}function c(e){return new o.Text(e).anchor("middle").setAttribute("dominant-baseline","middle").setAttribute("dy",pxt.BrowserUtils.isIE()||pxt.BrowserUtils.isEdge()?"0.3em":"0.1em")}},{"./field_matrix":42,"./field_utils":69,blockly:175}],44:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldMusicEditor=void 0;var s=pxt.svgUtil,o=e("./field_asset");let n=e("./field_utils");class r extends o.FieldAssetEditor{getAssetType(){return"song"}createNewAsset(e){var t=pxt.react.getTilemapProject();if(e){var i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i}if(this.getBlockData())return t.lookupAsset("song",this.getBlockData());let s;if(e?(i=/^\s*hex\s*`([a-fA-F0-9]+)`\s*(?:;?)\s*$/.exec(e))&&(s=pxt.assets.music.decodeSongFromHex(i[1])):s=pxt.assets.music.getEmptySong(2),s)return pxt.assets.music.inflateSong(s),{internalID:-1,id:this.temporaryAssetId(),type:"song",meta:{},song:s};this.isGreyBlock=!0,this.valueText=e}render_(){super.render_(),this.isGreyBlock||(this.size_.height=42,this.size_.width=18+this.previewWidth())}getValueText(){return this.asset&&!this.isTemporaryAsset()?pxt.getTSReferenceForAsset(this.asset):this.asset?`hex\`${pxt.assets.music.encodeSongToHex(this.asset.song)}\``:this.valueText||""}parseFieldOptions(e){return{}}redrawPreview(){var e,t;this.fieldGroup_&&(pxsim.U.clear(this.fieldGroup_),this.isGreyBlock?super.redrawPreview():(e=18+this.previewWidth(),t=(new s.Rect).at(5,1).size(8+this.previewWidth(),40).setClass("blocklySpriteField").stroke("#898989",1).corner(4),this.fieldGroup_.appendChild(t.el),this.asset&&(t=(0,n.songToDataURI)(this.asset.song,this.previewWidth(),32,this.lightMode))&&(t=(new s.Image).src(t).at(9,5).size(this.previewWidth(),32),this.fieldGroup_.appendChild(t.el)),(null==(t=this.size_)?void 0:t.width)!=e&&this.forceRerender()))}previewWidth(){return 32*(this.asset?this.asset.song.measures:2)}}i.FieldMusicEditor=r},{"./field_asset":29,"./field_utils":69}],45:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldNote=void 0;let u=e("blockly"),h=e("./field_utils");var s;(e=s=s||{})[e.C=262]="C",e[e.CSharp=277]="CSharp",e[e.D=294]="D",e[e.Eb=311]="Eb",e[e.E=330]="E",e[e.F=349]="F",e[e.FSharp=370]="FSharp",e[e.G=392]="G",e[e.GSharp=415]="GSharp",e[e.A=440]="A",e[e.Bb=466]="Bb",e[e.B=494]="B",e[e.C3=131]="C3",e[e.CSharp3=139]="CSharp3",e[e.D3=147]="D3",e[e.Eb3=156]="Eb3",e[e.E3=165]="E3",e[e.F3=175]="F3",e[e.FSharp3=185]="FSharp3",e[e.G3=196]="G3",e[e.GSharp3=208]="GSharp3",e[e.A3=220]="A3",e[e.Bb3=233]="Bb3",e[e.B3=247]="B3",e[e.C4=262]="C4",e[e.CSharp4=277]="CSharp4",e[e.D4=294]="D4",e[e.Eb4=311]="Eb4",e[e.E4=330]="E4",e[e.F4=349]="F4",e[e.FSharp4=370]="FSharp4",e[e.G4=392]="G4",e[e.GSharp4=415]="GSharp4",e[e.A4=440]="A4",e[e.Bb4=466]="Bb4",e[e.B4=494]="B4",e[e.C5=523]="C5",e[e.CSharp5=555]="CSharp5",e[e.D5=587]="D5",e[e.Eb5=622]="Eb5",e[e.E5=659]="E5",e[e.F5=698]="F5",e[e.FSharp5=740]="FSharp5",e[e.G5=784]="G5",e[e.GSharp5=831]="GSharp5",e[e.A5=880]="A5",e[e.Bb5=932]="Bb5",e[e.B5=988]="B5",e[e.C6=1047]="C6",e[e.CSharp6=1109]="CSharp6",e[e.D6=1175]="D6",e[e.Eb6=1245]="Eb6",e[e.E6=1319]="E6",e[e.F6=1397]="F6",e[e.FSharp6=1480]="FSharp6",e[e.G6=1568]="G6",e[e.GSharp6=1568]="GSharp6",e[e.A6=1760]="A6",e[e.Bb6=1865]="Bb6",e[e.B6=1976]="B6",e[e.C7=2093]="C7";class d extends u.FieldNumber{constructor(e,t,i){super(null,0,null,null,i),this.isFieldCustom_=!0,this.SERIALIZABLE=!0,this.isTextValid_=!0,this.nKeys_=36,this.minNote_=28,this.maxNote_=63,this.eps=2,this.keyHandler=e=>{var t,i="string"==typeof this.value_?parseFloat(this.value_):this.value_;"ArrowUp"!==e.code&&"ArrowDown"!==e.code||({keyAbove:i,keyBelow:t}=this.getNeighboringKeys(i),i="ArrowUp"===e.code?i:t,t=this.getKeyFreq(i),this.setValue(t),this.playKey(this.piano[i-this.minNote_],t),this.noteLabel.textContent=this.getKeyName(i),e.stopPropagation(),e.preventDefault())},this.setSpellcheck(!1),this.prepareNotes(),this.isExpanded=!1,this.currentPage=0,this.totalPlayCount=0,t.editorColour&&(this.primaryColour=(0,h.parseColour)(t.editorColour),this.borderColour=u.utils.colour.blend("#000000",this.primaryColour,.2));i=parseInt(t.eps),!Number.isNaN(i)&&0<=i&&(this.eps=i),i=parseInt(t.minNote)||this.minNote_,t=parseInt(t.maxNote)||this.maxNote_;28<=i&&t<=75&&i<t&&(this.minNote_=i,this.maxNote_=t,this.nKeys_=this.maxNote_-this.minNote_+1),this.setValue(e)}doClassValidation_(e){var t=/^Note\.(.+)$/.exec(e),t=t&&1<t.length?t[1]:null;return null===(e=s[t]||String(parseFloat(e||"0")))||(t=parseFloat(e||"0"),isNaN(t))||t<0?null:(e=Math.floor(t)!=t,Number(t.toFixed(e?2:0)))}getValue(){return this.value_+""}doValueUpdate_(e){isNaN(Number(e))||Number(e)<0||(this.sourceBlock_&&u.Events.isEnabled()&&this.value_!=e&&u.Events.fire(new u.Events.BlockChange(this.sourceBlock_,"field",this.name,this.value_,e)),this.value_=e,this.refreshText())}getText(){return this.isExpanded?""+this.value_:this.getNoteString()}getFieldDescription(){return this.getNoteString()||lf("note")}getNoteString(){var t=+this.value_;for(let e=0;e<this.nKeys_;e++)if(Math.abs(this.getKeyFreq(e+this.minNote_)-t)<this.eps)return this.getKeyName(e+this.minNote_);let e=t.toString();return isNaN(t)||(e+=" Hz"),e}refreshText(){this.forceRerender()}onFinishEditing_(e){this.refreshText()}onHide(){this.isExpanded=!1,this.refreshText()}widgetDispose_(){this.htmlInput_.removeEventListener("keydown",this.keyHandler),super.widgetDispose_()}showEditor_(e){this.isExpanded=!0,this.updateColor(),u.DropDownDiv.hideWithoutAnimation(),(0,h.clearDropDownDiv)();var t=pxt.BrowserUtils.isMobile()||pxt.BrowserUtils.isIOS(),e=(super.showEditor_(e,t),this.refreshText(),u.Events.setGroup(!0),this.piano=[],this.currentSelectedKey=void 0,this.nKeys_-this.nKeys_/d.notesPerOctave*d.blackKeysPerOctave),i=d.notesPerOctave-d.blackKeysPerOctave;let s=d.keyWidth*e,o=d.keyHeight+d.labelHeight;var n=window.innerWidth<s,r=(n&&(s=i*d.keyWidth,o=d.keyHeight+d.labelHeight+d.prevNextHeight),p("blocklyPianoDiv",`width: ${s}px;
            height: ${o}px;`));u.DropDownDiv.getContentDiv().appendChild(r),this.noteLabel=p("blocklyNoteLabel",`top: ${d.keyHeight}px;
            width: ${s}px;
            background-color: ${this.primaryColour};
            border-color: ${this.primaryColour};`),r.appendChild(this.noteLabel),this.noteLabel.textContent="-";let l=0;for(let t=0;t<this.nKeys_;t++){var a=Math.floor(t/d.notesPerOctave);let e=this.getPosition(t+this.minNote_);n&&t>=d.notesPerOctave&&(e-=i*a*d.keyWidth);var c=this.getKeyDiv(t+this.minNote_,e);this.piano.push(c),r.appendChild(c),Math.abs(this.getKeyFreq(t+this.minNote_)-Number(this.getValue()))<this.eps&&(pxt.BrowserUtils.addClass(c,"selected"),this.currentSelectedKey=c,l=a)}n&&(this.setPage(l),r.appendChild(this.getNextPrevDiv(!0,s)),r.appendChild(this.getNextPrevDiv(!1,s))),u.DropDownDiv.setColour(this.primaryColour,this.borderColour),u.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,()=>this.onHide(),void 0,!1),this.htmlInput_.addEventListener("keydown",this.keyHandler)}playKey(e,t){let i=++this.totalPlayCount;this.currentSelectedKey!==e&&(this.currentSelectedKey&&pxt.BrowserUtils.removeClass(this.currentSelectedKey,"selected"),pxt.BrowserUtils.addClass(e,"selected"),this.setValue(t)),this.currentSelectedKey=e,this.htmlInput_.value=this.getText(),pxt.AudioContextManager.tone(t),setTimeout(()=>{this.totalPlayCount==i&&pxt.AudioContextManager.stop()},300)}dispose(){u.DropDownDiv.hideIfOwner(this),super.dispose()}updateColor(){var e,t=this.sourceBlock_.getParent();t&&(this.sourceBlock_.isShadow()||1===(e=this.sourceBlock_).inputList.length&&1===e.inputList[0].fieldRow.length)?(this.primaryColour=t.getColour(),this.borderColour=t.getColourTertiary()):(this.primaryColour="#3D3D3D",this.borderColour="#2A2A2A")}setPage(e){var t=this.nKeys_/d.notesPerOctave,i=(e=Math.max(Math.min(e,t-1),0),this.noteLabel.textContent="Octave #"+(e+1),e*d.notesPerOctave);for(let e=0;e<this.piano.length;++e){var s=e>=i&&e<i+d.notesPerOctave;this.piano[e].style.display=s?"block":"none"}this.currentPage=e}getNextPrevDiv(t,e){var i=t?0:e/2;let s=p("blocklyNotePrevNext",`top: ${d.keyHeight+d.labelHeight}px;
            left: ${i}px;
            width: ${Math.ceil(e/2)}px;
            ${t?"border-left-color":"border-right-color"}: ${this.primaryColour};
            background-color: ${this.primaryColour};
            border-bottom-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach(e=>{u.browserEvents.conditionalBind(s,e,this,()=>this.setPage(t?this.currentPage-1:this.currentPage+1),!0)}),s.textContent=t?"<":">",s}getKeyDiv(t,e){let i=p("blocklyNote "+(this.isWhite(t)?"":"black"),`width: ${this.getKeyWidth(t)}px;
            height: ${this.getKeyHeight(t)}px;
            left: ${e}px;
            border-color: ${this.primaryColour};`);return pxt.BrowserUtils.pointerEvents.down.forEach(e=>{u.browserEvents.conditionalBind(i,e,this,()=>this.playKey(i,this.getKeyFreq(t)),!0)}),u.browserEvents.conditionalBind(i,"mouseover",this,e=>{this.noteLabel.textContent=this.getKeyName(t),e.buttons&&this.playKey(i,this.getKeyFreq(t))},!0),i}isWhite(e){switch((e+=8)%12){case 1:case 3:case 6:case 8:case 10:return!1;default:return!0}}whiteKeysBefore(e){switch((e+=8)%12){case 0:return 0;case 1:case 2:return 1;case 3:case 4:return 2;case 5:return 3;case 6:case 7:return 4;case 8:case 9:return 5;case 10:case 11:return 6}return-1}getKeyWidth(e){return this.isWhite(e)?d.keyWidth:d.keyWidth/2}getKeyHeight(e){return this.isWhite(e)?d.keyHeight:d.keyHeight/2}getNeighboringKeys(t){let i,s;for(let e=this.minNote_;e<=this.maxNote_;++e){if(this.getKeyFreq(e)+this.eps>t){s=e;break}i=e}return i?s&&s!==this.maxNote_?(t<this.getKeyFreq(i)+this.eps?s=i:t>this.getKeyFreq(s)-this.eps&&(i=s),{keyAbove:i+1,keyBelow:s-1}):{keyAbove:this.maxNote_,keyBelow:t-this.eps<this.getKeyFreq(this.maxNote_)?this.maxNote_-1:this.maxNote_}:{keyAbove:t+this.eps>this.getKeyFreq(this.minNote_)?this.minNote_+1:this.minNote_,keyBelow:this.minNote_}}getKeyFreq(e){return this.getKeyNoteData(e).freq}getKeyName(e){e=this.getKeyNoteData(e);let t=e.prefixedName;return this.nKeys_<=d.notesPerOctave?t=e.name:28<=this.minNote_&&this.maxNote_<=63&&(t=e.altPrefixedName||t),t}getKeyNoteData(e){return d.Notes[e]}getPosition(e){if(e===this.minNote_)return 0;var t,i=d.keyWidth/4,s=Math.floor((this.minNote_+8)/d.notesPerOctave),o=Math.floor((e+8)/d.notesPerOctave);let n=this.whiteKeysBefore(this.minNote_)*d.keyWidth;return this.isWhite(this.minNote_)||(n-=i),s<o?(o=(t=7*d.keyWidth)-n+(o-s-1)*t,this.whiteKeysBefore(e)*d.keyWidth+o-(this.isWhite(e)?0:i)):this.whiteKeysBefore(e)*d.keyWidth-n-(this.isWhite(e)?0:i)}prepareNotes(){d.Notes||(d.Notes={28:{name:lf("{id:note}C"),prefixedName:lf("Low C"),freq:131},29:{name:lf("C#"),prefixedName:lf("Low C#"),freq:139},30:{name:lf("{id:note}D"),prefixedName:lf("Low D"),freq:147},31:{name:lf("D#"),prefixedName:lf("Low D#"),freq:156},32:{name:lf("{id:note}E"),prefixedName:lf("Low E"),freq:165},33:{name:lf("{id:note}F"),prefixedName:lf("Low F"),freq:175},34:{name:lf("F#"),prefixedName:lf("Low F#"),freq:185},35:{name:lf("{id:note}G"),prefixedName:lf("Low G"),freq:196},36:{name:lf("G#"),prefixedName:lf("Low G#"),freq:208},37:{name:lf("{id:note}A"),prefixedName:lf("Low A"),freq:220},38:{name:lf("A#"),prefixedName:lf("Low A#"),freq:233},39:{name:lf("{id:note}B"),prefixedName:lf("Low B"),freq:247},40:{name:lf("{id:note}C"),prefixedName:lf("Middle C"),freq:262},41:{name:lf("C#"),prefixedName:lf("Middle C#"),freq:277},42:{name:lf("{id:note}D"),prefixedName:lf("Middle D"),freq:294},43:{name:lf("D#"),prefixedName:lf("Middle D#"),freq:311},44:{name:lf("{id:note}E"),prefixedName:lf("Middle E"),freq:330},45:{name:lf("{id:note}F"),prefixedName:lf("Middle F"),freq:349},46:{name:lf("F#"),prefixedName:lf("Middle F#"),freq:370},47:{name:lf("{id:note}G"),prefixedName:lf("Middle G"),freq:392},48:{name:lf("G#"),prefixedName:lf("Middle G#"),freq:415},49:{name:lf("{id:note}A"),prefixedName:lf("Middle A"),freq:440},50:{name:lf("A#"),prefixedName:lf("Middle A#"),freq:466},51:{name:lf("{id:note}B"),prefixedName:lf("Middle B"),freq:494},52:{name:lf("{id:note}C"),prefixedName:lf("Tenor C"),altPrefixedName:lf("High C"),freq:523},53:{name:lf("C#"),prefixedName:lf("Tenor C#"),altPrefixedName:lf("High C#"),freq:554},54:{name:lf("{id:note}D"),prefixedName:lf("Tenor D"),altPrefixedName:lf("High D"),freq:587},55:{name:lf("D#"),prefixedName:lf("Tenor D#"),altPrefixedName:lf("High D#"),freq:622},56:{name:lf("{id:note}E"),prefixedName:lf("Tenor E"),altPrefixedName:lf("High E"),freq:659},57:{name:lf("{id:note}F"),prefixedName:lf("Tenor F"),altPrefixedName:lf("High F"),freq:698},58:{name:lf("F#"),prefixedName:lf("Tenor F#"),altPrefixedName:lf("High F#"),freq:740},59:{name:lf("{id:note}G"),prefixedName:lf("Tenor G"),altPrefixedName:lf("High G"),freq:784},60:{name:lf("G#"),prefixedName:lf("Tenor G#"),altPrefixedName:lf("High G#"),freq:831},61:{name:lf("{id:note}A"),prefixedName:lf("Tenor A"),altPrefixedName:lf("High A"),freq:880},62:{name:lf("A#"),prefixedName:lf("Tenor A#"),altPrefixedName:lf("High A#"),freq:932},63:{name:lf("{id:note}B"),prefixedName:lf("Tenor B"),altPrefixedName:lf("High B"),freq:988},64:{name:lf("{id:note}C"),prefixedName:lf("High C"),freq:1046},65:{name:lf("C#"),prefixedName:lf("High C#"),freq:1109},66:{name:lf("{id:note}D"),prefixedName:lf("High D"),freq:1175},67:{name:lf("D#"),prefixedName:lf("High D#"),freq:1245},68:{name:lf("{id:note}E"),prefixedName:lf("High E"),freq:1319},69:{name:lf("{id:note}F"),prefixedName:lf("High F"),freq:1397},70:{name:lf("F#"),prefixedName:lf("High F#"),freq:1478},71:{name:lf("{id:note}G"),prefixedName:lf("High G"),freq:1568},72:{name:lf("G#"),prefixedName:lf("High G#"),freq:1661},73:{name:lf("{id:note}A"),prefixedName:lf("High A"),freq:1760},74:{name:lf("A#"),prefixedName:lf("High A#"),freq:1865},75:{name:lf("{id:note}B"),prefixedName:lf("High B"),freq:1976}})}}function p(e,t){var i=document.createElement("div");return pxt.BrowserUtils.addClass(i,e),i.setAttribute("style",t.replace(/\s+/g," ")),i}(i.FieldNote=d).keyWidth=22,d.keyHeight=90,d.labelHeight=24,d.prevNextHeight=20,d.notesPerOctave=12,d.blackKeysPerOctave=5},{"./field_utils":69,blockly:175}],46:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldNumberDropdown=void 0;e=e("./field_textdropdown");class s extends e.BaseFieldTextDropdown{constructor(e,t,i,s,o,n){super(e+"",t,n),this.setConstraints(i,s,o)}setConstraints(e,t,i){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(i),this.setValue(this.getValue())}getValue(){return Number(super.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);var i=(t=-1!==t.indexOf("e")?this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}):t).indexOf(".");this.decimalPlaces=-1===i?e?0:null:t.length-i-1}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=""+e).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);return isNaN(t)?null:(void 0!==this.min_&&(t=Math.max(t,this.min_)),void 0!==this.max_&&(t=Math.min(t,this.max_)),this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_),(t=null!==this.decimalPlaces?Number(t.toFixed(this.decimalPlaces)):t)+"")}}class o extends s{constructor(e,t,i){super(e,(t=>{let i;if(t.values){var s,o=[],n=t.values.split(",");let e=!1;for(s of n){var r=parseFloat(s);if(Number.isNaN(r)){e=!0;break}o.push([s,r])}e||(i=o)}else if(t.data)try{var l=JSON.parse(t.data);if(Array.isArray(l)&&l.length){if((e=>{for(var t of e)if("number"!=typeof t)return;return 1})(l))return l.map(e=>[""+e,e]);{let e=!1;for(var a of l)if(!Array.isArray(a)||"string"!=typeof a[0]||"number"!=typeof a[1]){e=!0;break}e||(i=l)}}}catch(e){}return i||(pxt.warn("Could not parse numberdropdown data field"),[])})(t),t.min,t.max,t.precision,i),this.isFieldCustom_=!0}getOptions(){let e;return this.menuGenerator_&&("string"==typeof this.menuGenerator_&&(this.menuGenerator_=JSON.parse(this.menuGenerator_)),e=this.menuGenerator_.map(e=>"object"==typeof e?[pxt.Util.rlf(e[0]),e[1]]:[String(e),String(e)])),e}}i.FieldNumberDropdown=o},{"./field_textdropdown":55}],47:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldPosition=void 0;let u=e("blockly");e=e("../plugins/math");class s extends e.FieldSlider{constructor(e,t,i){super(e,"0","100","1","1","Value",i),this.isFieldCustom_=!0,this.params=t,this.params.screenHeight||(this.params.screenHeight=120),this.params.screenWidth||(this.params.screenWidth=160),this.params.xInputName||(this.params.xInputName="x"),this.params.yInputName||(this.params.yInputName="y"),this.params.min&&(this.min_=parseInt(this.params.min)),this.params.max&&(this.max_=parseInt(this.params.max))}showEditor_(e){this.getFieldByName(this.params.xInputName)===this&&(this.max_=this.params.screenWidth,this.labelText_=this.params.xInputName);var t=this.getFieldByName(this.params.yInputName);t===this&&(this.max_=this.params.screenHeight,this.labelText_=this.params.yInputName),super.showEditor_(e),this.renderScreenPicker()}doValueUpdate_(e){super.doValueUpdate_(e),this.resetCrosshair&&this.resetCrosshair()}renderScreenPicker(){var e=u.DropDownDiv.getContentDiv();this.selectorDiv_=document.createElement("div"),this.selectorDiv_.className="blocklyCanvasOverlayOuter",e.appendChild(this.selectorDiv_);let s=document.createElement("div"),o=(s.className="blocklyCanvasOverlayDiv",this.selectorDiv_.appendChild(s),document.createElement("div")),n=(o.className="cross-x",s.appendChild(o),document.createElement("div")),r=(n.className="cross-y",s.appendChild(n),document.createElement("div")),l=(r.className="label",s.appendChild(r),1.5*this.params.screenWidth),a=1.5*this.params.screenHeight;s.style.height=a+"px",s.style.width=l+"px";var e=e.getElementsByClassName("goog-slider-horizontal")[0];e&&(e.style.width=l+"px",e=Number(this.getValue()),!isNaN(e))&&e>this.getMin()&&(this.setValue(e-1+""),this.setValue(e+""));let c=(e,t)=>{e=Math.round(Math.max(0,Math.min(l,e))),t=Math.round(Math.max(0,Math.min(a,t))),o.style.top=t+"px",n.style.left=e+"px",e=Math.round(Math.max(0,Math.min(this.params.screenWidth,e/l*this.params.screenWidth))),t=Math.round(Math.max(0,Math.min(this.params.screenHeight,t/a*this.params.screenHeight))),isNaN(e)?r.textContent=this.params.yInputName+"="+t:isNaN(t)?r.textContent=this.params.xInputName+"="+e:r.textContent=`${this.params.xInputName}=${e} ${this.params.yInputName}=`+t;var i=r.getBoundingClientRect();e>this.params.screenWidth/2?r.style.left=e*(l/this.params.screenWidth)-i.width-8+"px":r.style.left=e*(l/this.params.screenWidth)+4+"px",t>this.params.screenHeight/2?r.style.top=t*(a/this.params.screenHeight)-i.height-6+"px":r.style.top=t*(a/this.params.screenHeight)+"px"};this.resetCrosshair=()=>{var{currentX:e,currentY:t}=this.getXY();c(e/this.params.screenWidth*l,t/this.params.screenHeight*a)},this.resetCrosshair(),u.browserEvents.bind(this.selectorDiv_,"mousemove",this,e=>{var t=s.getBoundingClientRect(),i=e.clientX-t.left,e=e.clientY-t.top;c(i,e)}),u.browserEvents.bind(this.selectorDiv_,"mouseleave",this,this.resetCrosshair),u.browserEvents.bind(this.selectorDiv_,"click",this,e=>{var t=s.getBoundingClientRect(),i=e.clientX-t.left,e=e.clientY-t.top,t=Math.round(i/l*this.params.screenWidth),i=Math.round(e/a*this.params.screenHeight);this.close(),this.setXY(t,i)})}resizeHandler(){this.close()}setXY(e,t){var i=this.getFieldByName(this.params.xInputName),i=(i&&"number"==typeof i.getValue()&&i.setValue(String(e)),this.getFieldByName(this.params.yInputName));i&&"number"==typeof i.getValue()&&i.setValue(String(t))}getFieldByName(t){var i=this.sourceBlock_.getParent();if(i)for(let e=0;e<i.inputList.length;e++){var s=i.inputList[e];if(s.name===t)return this.getTargetField(s)}}getXY(){let e,t;var i=this.getFieldByName(this.params.xInputName),i=(i&&(e=i.getValue()),this.getFieldByName(this.params.yInputName));return i&&(t=i.getValue()),{currentX:parseInt(e),currentY:parseInt(t)}}getTargetField(e){var e=e.connection.targetBlock();return(e=e&&e.inputList[0])?e.fieldRow[0]:null}widgetDispose_(){super.widgetDispose_(),this.close(!0)}close(e){e||(u.WidgetDiv.hideIfOwner(this),u.DropDownDiv.hideIfOwner(this)),window.removeEventListener("resize",this.resizeHandler),this.resetCrosshair=void 0,this.selectorDiv_&&(u.utils.dom.removeNode(this.selectorDiv_),this.selectorDiv_=void 0)}}i.FieldPosition=s},{"../plugins/math":119,blockly:175}],48:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldProcedure=void 0;e=e("./field_dropdown");class s extends e.FieldDropdown{constructor(e,t){super(function(){var t=[];if(this.sourceBlock_&&this.sourceBlock_.workspace){var i,s=this.sourceBlock_.workspace.getAllBlocks(!1);for(let e=0;e<s.length;e++)s[e].getProcedureDef&&(i=s[e].getProcedureDef(),t.push(i[0]))}var e=this.getValue(),o=(e&&-1==t.indexOf(e)&&t.push(e),t.sort((e,t)=>{e=e.toLowerCase(),t=t.toLowerCase();return e===t?0:t<e?1:-1}),t.length||t.push("Temp"),this.rawValue&&-1===t.indexOf(this.rawValue)&&t.push(this.rawValue),[]);for(let e=0;e<t.length;e++)o[e]=[t[e],t[e]];return o},t),this.setValue(e||"")}getOptions(e){return this.menuGenerator_()}doClassValidation_(e){return void 0===e?null:e}doValueUpdate_(e){this.rawValue=e,super.doValueUpdate_(e)}init(){this.fieldGroup_||super.init.call(this)}setSourceBlock(e){pxt.Util.assert(!e.isShadow(),"Procedure fields are not allowed to exist on shadow blocks."),super.setSourceBlock.call(this,e)}}i.FieldProcedure=s},{"./field_dropdown":34}],49:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldProtractor=void 0;e=e("../plugins/math");class s extends e.FieldSlider{constructor(e,t,i){super(String(e),"0","180","1","15",lf("Angle"),i),this.isFieldCustom_=!0,this.params=t}createLabelDom_(e){var t=document.createElement("div"),i=(this.circleSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.circleSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.circleSVG),pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.circleSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.circleSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"}),document.createElement("span"));return i.setAttribute("class","blocklyFieldSliderReadout"),[t,i]}setReadout(e){this.updateAngle("string"==typeof e?parseFloat(e):e),this.reporter&&(this.reporter.textContent=e+"Â°")}updateAngle(e){this.circleBar&&(e=(180-(e=Math.max(0,Math.min(180,e))))/180*Math.PI*90,this.circleBar.setAttribute("stroke-dashoffset",""+e))}}i.FieldProtractor=s},{"../plugins/math":119}],50:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldScopedValueSelector=void 0;let s=e("blockly"),o=e("./field_utils");class n extends s.FieldLabel{constructor(e,t){super(e),this.isFieldCustom_=!0,this.types=[],this.dragging=!1,this.onDragEvent=t=>{if(t.blocks.find(e=>e.id===this.sourceBlock_.id))if(this.dragging=t.isStart,t.isStart)this.forceRerender();else{var i=[];{let e=null==(t=this.sourceBlock_.getParent())?void 0:t.getParent();for(;e;)i.push(e),e=e.getParent()}let s=pxt.getBundledApiInfo();var e;this.scopedValue=null;for(e of i)if("variables_set"===e.type){var o=e.inputList.find(e=>"VALUE"===e.name);if(o){o=o.fieldRow;if(o){o=o.find(e=>"VAR"===e.name);if(o){o=o.getVariable();if(o)return this.setValue(o.getName())}}}}else{o=(e=>{var t,i=e.codeCard;if(!i||!i.name)return null;for(t of Object.values(s))if(t.apis.byQName[i.name])return t.apis.byQName[i.name]})(e);if(o)for(var n of o.parameters)if(n.handlerParameters)for(var r of n.handlerParameters)if(this.types.includes(r.type))return this.setValue(r.name)}this.setValue(this.defl)}},this.onWorkspaceChange=e=>this.sourceBlock_&&this.sourceBlock_.workspace&&!this.sourceBlock_.disposed&&e.type===s.Events.BLOCK_DRAG?this.onDragEvent(e):void 0,this.defl=t.defl,t.types?this.types=t.types.split(","):t.type&&(this.types=[t.type]),this.types=this.types.map(e=>e.trim().replace(/['"]+/g,""))}init(){super.init(),this.sourceBlock_&&(this.scopedValue=(0,o.getBlockDataForField)(this.sourceBlock_,"scopedValue"),this.sourceBlock_.workspace.addChangeListener(this.onWorkspaceChange))}dispose(){this.sourceBlock_&&this.sourceBlock_.workspace.removeChangeListener(this.onWorkspaceChange),super.dispose()}getValue(){var e;return null!=(e=this.sourceBlock_)&&e.isInFlyout?lf("(dynamic)"):this.dragging?lf("what will it be?"):(this.sourceBlock_&&!this.scopedValue&&(this.scopedValue=(0,o.getBlockDataForField)(this.sourceBlock_,"scopedValue")),this.scopedValue||this.defl||lf("unknown"))}setValue(e,t){this.scopedValue=e||this.defl||lf("unknown"),this.sourceBlock_&&(0,o.setBlockDataForField)(this.sourceBlock_,"scopedValue",this.scopedValue||""),super.setValue(this.scopedValue,t),this.forceRerender()}getFieldDescription(){return this.scopedValue||this.defl||lf("value")}}i.FieldScopedValueSelector=n},{"./field_utils":69,blockly:175}],51:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSoundEffect=void 0;let u=e("blockly");var o=pxt.svgUtil,s=e("./field_base");let h=e("./field_utils");class n extends s.FieldBase{constructor(){super(...arguments),this.registeredChangeListener=!1,this.onWorkspaceChange=e=>{e.type!==u.Events.CHANGE||!(e=this.sourceBlock_.workspace.getBlockById(e.blockId))||e!==this.sourceBlock_&&e.getParent()!==this.sourceBlock_||this.redrawPreview()}}onInit(){this.options||(this.options={}),this.options.durationInputName||(this.options.durationInputName="duration"),this.options.startFrequencyInputName||(this.options.startFrequencyInputName="startFrequency"),this.options.endFrequencyInputName||(this.options.endFrequencyInputName="endFrequency"),this.options.startVolumeInputName||(this.options.startVolumeInputName="startVolume"),this.options.endVolumeInputName||(this.options.endVolumeInputName="endVolume"),this.options.waveFieldName||(this.options.waveFieldName="waveShape"),this.options.interpolationFieldName||(this.options.interpolationFieldName="interpolation"),this.options.effectFieldName||(this.options.effectFieldName="effect"),this.options.useMixerSynthesizer||(this.options.useMixerSynthesizer=!1),this.redrawPreview(),this.sourceBlock_.workspace&&(this.workspace=this.sourceBlock_.workspace,this.sourceBlock_.isShadow()||this.sourceBlock_.isInsertionMarker()||(this.registeredChangeListener=!0,this.workspace.addChangeListener(this.onWorkspaceChange)))}onDispose(){this.workspace&&this.registeredChangeListener&&(this.workspace.removeChangeListener(this.onWorkspaceChange),this.registeredChangeListener=!1)}onValueChanged(e){return e}redrawPreview(){if(this.fieldGroup_){if(this.drawnSound){var e=this.readCurrentSound();if(e.startFrequency===this.drawnSound.startFrequency&&e.endFrequency===this.drawnSound.endFrequency&&e.startVolume===this.drawnSound.startVolume&&e.endVolume===this.drawnSound.endVolume&&e.wave===this.drawnSound.wave&&e.interpolation===this.drawnSound.interpolation)return}pxsim.U.clear(this.fieldGroup_);var e=(new o.Rect).at(5,4).size(160,40).setClass("blocklyFieldRect blocklySpriteField").stroke("#fff",1).fill("#dedede").corner(20),t="preview-clip-"+pxt.U.guidGen(),i=(new o.ClipPath).id(t).clipPathUnits(!1),s=(new o.Rect).size(115,40).fill("#FFF").at(0,0),s=(i.appendChild(s),this.drawnSound=this.readCurrentSound(),(new o.Path).stroke("grey",2).fill("none").setD(pxt.assets.renderSoundPath(this.drawnSound,120,32)).clipPath("url('#"+t+"')")),t=(new o.Group).translate(35,7),i=(t.appendChild(i),t.appendChild(s),new o.Text("ï€").appendClass("melody-editor-field-icon").setAttribute("alignment-baseline","middle").anchor("middle").at(20,24));this.fieldGroup_.appendChild(e.el),this.fieldGroup_.appendChild(i.el),this.fieldGroup_.appendChild(t.el)}}showEditor_(e){e=!e;let t=this.readCurrentSound();u.Events.disable();let i,s={getScaledBBox:()=>i},o=(u.WidgetDiv.show(s,this.sourceBlock_.RTL,()=>{document.activeElement&&"INPUT"===document.activeElement.tagName&&document.activeElement.blur(),r.hide(),o.classList.remove("sound-effect-editor-widget"),o.style.transform="",o.style.position="",o.style.left="",o.style.top="",o.style.width="",o.style.height="",o.style.opacity="",o.style.transition="",o.style.alignItems="",u.Events.enable(),u.Events.setGroup(!0),this.fireNumberInputUpdate(this.options.durationInputName,t.duration),this.fireNumberInputUpdate(this.options.startFrequencyInputName,t.startFrequency),this.fireNumberInputUpdate(this.options.endFrequencyInputName,t.endFrequency),this.fireNumberInputUpdate(this.options.startVolumeInputName,t.startVolume),this.fireNumberInputUpdate(this.options.endVolumeInputName,t.endVolume),this.fireFieldDropdownUpdate(this.options.waveFieldName,d[t.wave]),this.fireFieldDropdownUpdate(this.options.interpolationFieldName,g[t.interpolation]),this.fireFieldDropdownUpdate(this.options.effectFieldName,p[t.effect]),u.Events.setGroup(!1),this.mostRecentValue&&this.setBlockData(JSON.stringify(this.mostRecentValue))}),u.WidgetDiv.getDiv());var n={onClose:()=>{u.WidgetDiv.hideIfOwner(s),r.hide()},onSoundChange:e=>{this.mostRecentValue=e,this.updateSiblingBlocks(e),this.redrawPreview()},initialSound:t,useMixerSynthesizer:(e=>{if(!e)return!1;if("string"==typeof e)switch(e.toLowerCase().trim()){case"1":case"yes":case"y":case"on":case"true":return!0;default:return!1}return!!e})(this.options.useMixerSynthesizer)};let r=pxt.react.getFieldEditorView("soundeffect-editor",t,n,o,e);var n=this.sourceBlock_,e=n.getBoundingRectangle(),l=(0,h.workspaceToScreenCoordinates)(n.workspace,new u.utils.Coordinate(e.right,e.top));var a=l.x+20,l=l.y-20,a=(o.style.opacity="0",o.classList.add("sound-effect-editor-widget"),o.style.position="absolute",o.style.left=a+"px",o.style.top=l+"px",o.style.width="30rem",o.style.height="40rem",o.style.display="flex",o.style.alignItems="center",o.style.transition="transform 0.25s ease 0s, opacity 0.25s ease 0s",o.style.borderRadius="",r.onHide(()=>{}),r.show(),o.getBoundingClientRect()),l=n.workspace.getInjectionDiv().getBoundingClientRect(),c=(a.height>l.height?(o.style.height="",o.style.top="calc(1rem - 20px)",o.style.bottom="calc(1rem + 20px)"):(a.bottom>l.bottom||a.top<l.top)&&(o.style.top=l.top+l.height/2-a.height/2-20+"px"),n.workspace.getToolbox().getWidth()),n=(a.width>l.width-c?(o.style.width="",o.style.left="1rem",o.style.right="1rem"):a.left+a.width>=l.right&&(n=(0,h.workspaceToScreenCoordinates)(n.workspace,new u.utils.Coordinate(e.left,e.top)),e=l.left+c,n.x-a.width-20>e?o.style.left=n.x-a.width-20+"px":o.style.left=e+(l.width-c)/2-a.width/2+"px"),o.getBoundingClientRect());i=new u.utils.Rect(n.top,n.bottom,n.left,n.right),requestAnimationFrame(()=>{o.style.opacity="1",o.style.transform="translateY(20px)"})}render_(){super.render_(),this.size_.height=48,this.size_.width=165}getFieldDescription(){return lf("sound effect")}updateSiblingBlocks(e){this.setNumberInputValue(this.options.durationInputName,e.duration),this.setNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),this.setNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),this.setNumberInputValue(this.options.startVolumeInputName,e.startVolume),this.setNumberInputValue(this.options.endVolumeInputName,e.endVolume),this.setFieldDropdownValue(this.options.waveFieldName,d[e.wave]),this.setFieldDropdownValue(this.options.interpolationFieldName,g[e.interpolation]),this.setFieldDropdownValue(this.options.effectFieldName,p[e.effect])}setNumberInputValue(e,t){e=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);e&&("math_number"===e.type||"math_integer"===e.type||"math_whole_number"===e.type?e.setFieldValue(Math.round(t),"NUM"):"math_number_minmax"===e.type&&e.setFieldValue(Math.round(t),"SLIDER"))}getNumberInputValue(e,t){e=this.getSiblingBlock(e)||this.getSiblingBlock(e,!0);return e?"math_number"===e.type||"math_integer"===e.type||"math_whole_number"===e.type?parseInt(e.getFieldValue("NUM")+""):"math_number_minmax"===e.type?parseInt(e.getFieldValue("SLIDER")+""):t:t}fireNumberInputUpdate(t,i){var s=this.getSiblingBlock(t)||this.getSiblingBlock(t,!0);if(s){let e;"math_number"===s.type||"math_integer"===s.type||"math_whole_number"===s.type?e="NUM":"math_number_minmax"===s.type&&(e="SLIDER"),e&&u.Events.fire(new u.Events.BlockChange(s,"field",e,i,this.getNumberInputValue(t,i)))}}setFieldDropdownValue(e,t){e=this.getSiblingField(e)||this.getSiblingField(e,!0);e&&e.setValue(t)}getFieldDropdownValue(e){e=this.getSiblingField(e)||this.getSiblingField(e,!0);if(e)return e.getValue()}fireFieldDropdownUpdate(e,t){var i=this.getSiblingField(e)||this.getSiblingField(e,!0);i&&u.Events.fire(new u.Events.BlockChange(i.getSourceBlock(),"field",i.name,t,this.getFieldDropdownValue(e)))}readCurrentSound(){var e=this.readBlockDataSound();return{duration:this.getNumberInputValue(this.options.durationInputName,e.duration),startFrequency:this.getNumberInputValue(this.options.startFrequencyInputName,e.startFrequency),endFrequency:this.getNumberInputValue(this.options.endFrequencyInputName,e.endFrequency),startVolume:this.getNumberInputValue(this.options.startVolumeInputName,e.startVolume),endVolume:this.getNumberInputValue(this.options.endVolumeInputName,e.endVolume),wave:r(d,this.getFieldDropdownValue(this.options.waveFieldName))||e.wave,interpolation:r(g,this.getFieldDropdownValue(this.options.interpolationFieldName))||e.interpolation,effect:r(p,this.getFieldDropdownValue(this.options.effectFieldName))||e.effect}}readBlockDataSound(){var e=this.getBlockData();let t;try{t=JSON.parse(e)}catch(e){t={duration:1e3,startFrequency:100,endFrequency:4800,startVolume:100,endVolume:0,wave:"sine",interpolation:"linear",effect:"none"}}return t}}i.FieldSoundEffect=n;let d={sine:"WaveShape.Sine",square:"WaveShape.Square",sawtooth:"WaveShape.Sawtooth",triangle:"WaveShape.Triangle",noise:"WaveShape.Noise"},p={none:"SoundExpressionEffect.None",vibrato:"SoundExpressionEffect.Vibrato",tremolo:"SoundExpressionEffect.Tremolo",warble:"SoundExpressionEffect.Warble"},g={linear:"InterpolationCurve.Linear",curve:"InterpolationCurve.Curve",logarithmic:"InterpolationCurve.Logarithmic"};function r(t,i){return Object.keys(t).find(e=>t[e]===i)}},{"./field_base":31,"./field_utils":69,blockly:175}],52:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSpeed=void 0;e=e("../plugins/math");class s extends e.FieldSlider{constructor(e,t,i){super(String(e),"-100","100","1","10","Speed",i),this.isFieldCustom_=!0,this.params=t,this.params.min&&(this.min_=parseFloat(this.params.min)),this.params.max&&(this.max_=parseFloat(this.params.max)),this.params.label&&(this.labelText_=this.params.label),this.params.format||(this.params.format="{0}%")}createLabelDom_(e){var t=document.createElement("div"),i=(this.speedSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),pxsim.svg.hydrate(this.speedSVG,{viewBox:"0 0 200 100",width:"170"}),t.appendChild(this.speedSVG),pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#a8aaa8","stroke-width":"1rem"}),this.circleBar=pxsim.svg.child(this.speedSVG,"circle",{"stroke-dasharray":"565.48","stroke-dashoffset":"0",cx:100,cy:100,r:"90",style:"fill:transparent; transition: stroke-dashoffset 0.1s linear;",stroke:"#f12a21","stroke-width":"1rem"}),this.reporter=pxsim.svg.child(this.speedSVG,"text",{x:100,y:80,"text-anchor":"middle","dominant-baseline":"middle",style:`font-size: ${Math.max(14,50-5*(this.params.format.length-4))}px`,class:"sim-text inverted number"}),document.createElement("span"));return i.setAttribute("class","blocklyFieldSliderReadout"),[t,i]}setReadout(e){this.updateSpeed("string"==typeof e?parseFloat(e):e),this.params&&this.reporter&&(this.reporter.textContent=ts.pxtc.U.rlf(this.params.format,e))}updateSpeed(e){var t;this.circleBar&&(t=this.sign(e),e=Math.abs(e)/100*50+50,-1==t&&(e=50-e),t=180*Math.PI,this.circleBar.setAttribute("stroke-dashoffset",""+(100-e)/100*t))}sign(e){return e?e<0?-1:1:0}}i.FieldSpeed=s},{"../plugins/math":119}],53:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSpriteEditor=void 0;e=e("./field_asset");class s extends e.FieldAssetEditor{getAssetType(){return"image"}createNewAsset(e){var t=pxt.react.getTilemapProject();if(e){var i=pxt.lookupProjectAssetByTSReference(e,t);if(i)return i}if(this.getBlockData())return t.lookupAsset("image",this.getBlockData());i=e?pxt.sprite.imageLiteralToBitmap(e,this.params.taggedTemplate):new pxt.sprite.Bitmap(this.params.initWidth,this.params.initHeight);let s;if(!i){if(!(s=o(e)))return this.isGreyBlock=!0,void(this.valueText=e);this.qName=e}return s=s||i.data(),{internalID:-1,id:this.temporaryAssetId(),type:"image",jresData:pxt.sprite.base64EncodeBitmap(s),meta:{},bitmap:s}}getValueText(){if(!this.asset)return this.valueText||"";if(this.asset&&!this.isTemporaryAsset())return pxt.getTSReferenceForAsset(this.asset);if(this.qName){var e=o(this.qName);if(e&&pxt.sprite.bitmapEquals(e,this.asset.bitmap))return this.qName}return pxt.sprite.bitmapToImageLiteral(this.asset&&pxt.sprite.Bitmap.fromData(this.asset.bitmap),"typescript",this.params.taggedTemplate)}parseFieldOptions(e){var t={initColor:1,initWidth:16,initHeight:16,disableResize:!1,lightMode:!1};if(e){if(t.lightMode=e.lightMode,e.sizes){var i=e.sizes.split(";"),s=[];for(let e=0;e<i.length;e++){var o=i[e].split(",");if(2===o.length){let e=parseInt(o[0]),t=parseInt(o[1]);isNaN(e)||isNaN(t)||(o=pxt.appTarget.runtime&&pxt.appTarget.runtime.screenSize,e<0&&o&&(e=o.width),t<0&&o&&(t=o.height),s.push([e,t]))}}0<s.length&&(t.initWidth=s[0][0],t.initHeight=s[0][1])}e.filter&&(t.filter=e.filter),e.disableResize&&(t.disableResize="true"===e.disableResize.toLowerCase()||"1"===e.disableResize),t.initColor=n(e.initColor,t.initColor),t.initWidth=n(e.initWidth,t.initWidth),t.initHeight=n(e.initHeight,t.initHeight),t.taggedTemplate=e.taggedTemplate}return t;function n(e,t){e=parseInt(e);return isNaN(e)?t:e}}}function o(t){var e=pxt.react.getTilemapProject().getGalleryAssets("image").filter(e=>e.id===t),e=e.length&&e[0];if(e)return e.bitmap}i.FieldSpriteEditor=s},{"./field_asset":29}],54:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldStyledLabel=void 0;e=e("blockly");class s extends e.FieldLabel{constructor(e,t,i){super(e,(e=>{if(e){if(e.bold&&e.italics)return"blocklyBoldItalicizedText";if(e.bold)return"blocklyBoldText";if(e.italics)return"blocklyItalicizedText"}})(t)),this.isFieldCustom_=!0}getFieldDescription(){return this.getText()}}i.FieldStyledLabel=s},{blockly:175}],55:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTextDropdown=i.BaseFieldTextDropdown=void 0;let l=e("blockly"),a=e("./field_utils");class s extends l.FieldTextInput{constructor(e,t,i){super(e,i),this.menuGenerator_=t,this.selectedMenuItem=null,this.menu_=null,this.svgArrow=null,this.generatedOptions=null,this.menuItems=[],this.lastHighlightedMenuElement=null}initView(){super.initView(),this.createSVGArrow()}inputKeydownListener(e){"ArrowDown"===e.key&&(e.preventDefault(),this.menu_.focus(),this.selectedMenuItem?this.menu_.setHighlighted(this.selectedMenuItem):this.menu_.setHighlighted(this.menuItems[0]))}dropdownKeydownListener(e){var t=this.menu_.getElement().querySelector(".blocklyMenuItemHighlight");"ArrowUp"!==e.key||t!==this.lastHighlightedMenuElement&&this.lastHighlightedMenuElement||(e.preventDefault(),this.selectedMenuItem=null,this.menu_.setHighlighted(null),this.htmlInput_.focus()),this.lastHighlightedMenuElement=t}showEditor_(e,t){super.showEditor_(e,!0),this.dropDownOpen_||this.showDropdown_(),l.Touch.clearTouchIdentifier(),this.inputKeydownHandler=this.inputKeydownListener.bind(this),this.htmlInput_.addEventListener("keydown",this.inputKeydownHandler),t||this.htmlInput_.focus()}doValueUpdate_(e){1<(null==e?void 0:e.length)&&e.charAt(0)===e.charAt(e.length-1)&&("'"===e.charAt(0)||'"'===e.charAt(0))&&(e=e.slice(1,e.length-1)),super.doValueUpdate_(e)}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");if(Array.isArray(this.menuGenerator_))return this.menuGenerator_;if(!e||!this.generatedOptions){var i=this.generatedOptions;if(!Array.isArray(i))throw TypeError("FieldDropdown options must be an array.");if(!i.length)throw TypeError("FieldDropdown options must not be an empty array.");let t=!1;for(let e=0;e<i.length;e++){var s=i[e];Array.isArray(s)?"string"!=typeof s[1]?(t=!0,pxt.error("Invalid option["+e+"]: Each FieldDropdown option id must be a string. Found "+s[1]+" in: ",s)):s[0]&&"string"!=typeof s[0]&&!(0,a.isImageProperties)(s[0])&&(t=!0,pxt.error("Invalid option["+e+"]: Each FieldDropdown option must have a string label or image description. Found"+s[0]+" in: ",s)):(t=!0,pxt.error("Invalid option["+e+"]: Each FieldDropdown option must be an array. Found: ",s))}if(t)throw TypeError("Found invalid FieldDropdown options.")}return this.generatedOptions}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}getFieldDescription(){return this.getText()}dropdownDispose_(){l.WidgetDiv.getDiv().removeEventListener("keydown",this.inputKeydownHandler),this.menu_.getElement().removeEventListener("keydown",this.dropdownKeydownHandler),this.dropDownOpen_=!1,this.menu_&&this.menu_.dispose(),this.menu_=null,this.selectedMenuItem=null,this.menuItems=[],this.applyColour()}dropdownCreate(){var s=this.getSourceBlock();if(!s)throw new l.UnattachedFieldError;var o=new l.Menu,n=(o.setRole(l.utils.aria.Role.LISTBOX),this.menu_=o,this.getOptions(!1));this.selectedMenuItem=null;for(let i=0;i<n.length;i++){let[e,t]=n[i];var r=(r=void 0,a.isImageProperties)(e)?((r=new Image(e.width,e.height)).src=e.src,r.alt=e.alt,r):e,r=new l.MenuItem(r,t);r.setRole(l.utils.aria.Role.OPTION),r.setRightToLeft(s.RTL),r.setCheckable(!0),o.addChild(r),r.setChecked(t===this.value_),t===this.value_&&(this.selectedMenuItem=r),r.onAction(this.handleMenuActionEvent,this),this.menuItems.push(r)}}showDropdown_(e){var t=this.getSourceBlock();if(!t)throw new l.UnattachedFieldError;this.dropdownCreate(),e&&"number"==typeof e.clientX?this.menu_.openingCoords=new l.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,(0,a.clearDropDownDiv)();var e=this.menu_.render(l.DropDownDiv.getContentDiv()),e=(l.utils.dom.addClass(e,"blocklyDropdownMenu"),t.getParent()),i=(e||t).getColour(),e=(e||t).style.colourTertiary;l.DropDownDiv.setColour(i,e),this.dropDownOpen_=!0,l.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this),void 0,!1),this.dropdownKeydownHandler=this.dropdownKeydownListener.bind(this),this.menu_.getElement().addEventListener("keydown",this.dropdownKeydownHandler),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),l.utils.style.scrollIntoContainerView(this.selectedMenuItem.getElement(),l.DropDownDiv.getContentDiv(),!0)),this.applyColour()}updateSize_(e){super.updateSize_(e);var t,e=this.positionSVGArrow(this.size_.width,this.size_.height/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2);this.sourceBlock_.RTL&&this.textElement_&&(t=this.getConstants(),t=l.utils.dom.getFastTextWidth(this.textElement_,t.FIELD_TEXT_FONTSIZE,t.FIELD_TEXT_FONTWEIGHT,t.FIELD_TEXT_FONTFAMILY),this.positionTextElement_(-e,t)),this.size_.width+=e}positionSVGArrow(e,t){if(!this.svgArrow)return 0;var i,s,o,n=this.getSourceBlock();if(n)return i=!!this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,s=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE,n=n.RTL?i/2:e+s,this.svgArrow.setAttribute("transform","translate("+n+","+t+")"),o+s;throw new l.UnattachedFieldError}createSVGArrow(){this.svgArrow=l.utils.dom.createSvgElement("image",{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(l.utils.dom.XLINK_NS,"xlink:href",o.DROPDOWN_SVG_DATAURI)}handleMenuActionEvent(e){l.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue()),l.WidgetDiv.hideIfOwner(this)}}(i.BaseFieldTextDropdown=s).DROPDOWN_SVG_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiM1NzVFNzUiLz48L3N2Zz4K";class o extends s{constructor(e,t,i){super(e,(e=>{if(e.values)return e.values.split(",").map(e=>[e,e]);if(e.data){let t;try{var i=JSON.parse(e.data);if(Array.isArray(i)&&i.length)if(n(i))t=i.map(e=>[e,e]);else{let e=!1;for(var s of i)if(!Array.isArray(s)||2!==s.length||!n(s)){e=!0;break}e||(t=i)}}catch(e){}if(t)return t;pxt.warn("Could not parse textdropdown data field")}return[]})(t),i),this.isFieldCustom_=!0}}function n(e){for(var t of e)if("string"!=typeof t)return;return 1}i.FieldTextDropdown=o},{"./field_utils":69,blockly:175}],56:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTextInput=void 0;e=e("blockly");class s extends e.FieldTextInput{constructor(e,t,i){super(e,i),this.isFieldCustom_=!0}getFieldDescription(){return this.getValue()}}i.FieldTextInput=s},{blockly:175}],57:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTilemap=void 0;e=e("./field_asset");class s extends e.FieldAssetEditor{getInitText(){return this.initText}getTileset(){var e;return null==(e=this.asset)?void 0:e.data.tileset}getAssetType(){return"tilemap"}createNewAsset(t=""){t=t&&t.replace(/&#96;/g,"`");var i=pxt.react.getTilemapProject(),s=pxt.lookupProjectAssetByTSReference(t,i);if(s)return s;if(null==(s=this.sourceBlock_)||!s.isInFlyout){var o,s=pxt.sprite.decodeTilemap(t,"typescript",i)||i.blankTilemap(this.params.tileWidth,this.params.initWidth,this.params.initHeight);let e;return(o=s)&&o.tilemap&&o.tilemap.width&&o.tilemap.height&&!(!o.layers||o.layers.width!==o.tilemap.width||o.layers.height!==o.tilemap.height||!o.tileset)?(this.initText=t,this.isGreyBlock=!1,[o]=i.createNewTilemapFromData(s),e=i.getTilemap(o)):t.trim()&&(this.isGreyBlock=!0,this.valueText=t),e}}onEditorClose(e){pxt.sprite.updateTilemapReferencesFromResult(pxt.react.getTilemapProject(),e)}getValueText(){return this.isGreyBlock?pxt.Util.htmlUnescape(this.valueText):this.asset?pxt.getTSReferenceForAsset(this.asset):this.initText?this.getInitText():this.valueText||""}parseFieldOptions(e){var t={initWidth:16,initHeight:16,disableResize:!1,tileWidth:16,lightMode:!1};if(e){if(t.lightMode=e.lightMode,e.filter&&(t.filter=e.filter),e.tileWidth)if("number"==typeof e.tileWidth)switch(e.tileWidth){case 4:t.tileWidth=4;break;case 8:t.tileWidth=8;break;case 16:t.tileWidth=16;break;case 32:t.tileWidth=32}else switch(e.tileWidth.trim().toLowerCase()){case"4":case"four":t.tileWidth=4;break;case"8":case"eight":t.tileWidth=8;break;case"16":case"sixteen":t.tileWidth=16;break;case"32":case"thirtytwo":t.tileWidth=32}t.initWidth=i(e.initWidth,t.initWidth),t.initHeight=i(e.initHeight,t.initHeight)}return t;function i(e,t){e=parseInt(e);return isNaN(e)?t:e}}}i.FieldTilemap=s},{"./field_asset":29}],58:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTileset=void 0;var s=e("./field_images");let r=e("./field_utils");class l extends s.FieldImages{constructor(e,t,i){super(e,t,i),this.isFieldCustom_=!0,this.menuGenerator_=()=>{var e;return null!=(e=this.sourceBlock_)&&e.workspace&&(0,r.needsTilemapUpgrade)(null==(e=this.sourceBlock_)?void 0:e.workspace)?[o()]:l.getReferencedTiles(this.sourceBlock_.workspace)},this.assetChangeListener=()=>{this.doValueUpdate_(this.getValue()),this.forceRerender()},this.blocksInfo=t.blocksInfo}static getReferencedTiles(e){var t=pxt.react.getTilemapProject();if(t.revision()!==l.cachedRevision||e.id!=l.cachedWorkspaceId){l.cachedRevision=t.revision(),l.cachedWorkspaceId=e.id;var s,o=(0,r.getAllReferencedTiles)(e);for(s of[16,4,8,32]){var n=t.getProjectTiles(s,16===s);if(n)for(let t of n.tiles)o.find(e=>e.id===t.id)||o.push(t)}let i={};o.sort((e,t)=>e.id===t.id?0:e.bitmap.width!==t.bitmap.width?e.bitmap.width-t.bitmap.width:e.isProjectTile!==t.isProjectTile?e.isProjectTile?-1:1:(i[e.id]||(i[e.id]=c(e.id)))-(i[t.id]||(i[t.id]=c(t.id))));l.referencedTiles=o.map(e=>{return[{src:c((t=e).id)<=2?a(t.bitmap.width):(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(t.bitmap),32,!1),width:32,height:32,alt:u(e)},e.id,e];var t})}return l.referencedTiles}initView(){super.initView(),this.sourceBlock_&&this.sourceBlock_.isInFlyout&&this.setValue(this.getOptions()[0][1])}getValue(){var e=pxt.react.getTilemapProject();if(this.selectedOption_)return t=this.selectedOption_[2],(t=e.lookupAsset(t.type,t.id))?pxt.getTSReferenceForAsset(t):super.getValue();var t=super.getValue();if("string"==typeof t){if(-1!==t.indexOf(".")){e=e.lookupAsset("tile",t);if(e)return pxt.getTSReferenceForAsset(e)}if(-1===t.indexOf("`"))return`img\`${t}\``}return t}getText(){var e=this.getValue();return"string"==typeof e&&-1!==e.indexOf("`")?e:super.getText()}render_(){var e;this.value_&&this.selectedOption_&&this.selectedOption_[1]!==this.value_&&(e=pxt.react.getTilemapProject().resolveTile(this.value_),l.cachedRevision=-1,e)&&(this.selectedOption_=[{src:(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(e.bitmap),32,!1),width:32,height:32,alt:u(e)},this.value_,e]),super.render_()}doValueUpdate_(e){let t=!1;var i=this.getOptions(!0);if(e){var s,o=pxt.parseAssetTSReference(e);e=(e=o?o.name:e).trim();for(s of i)if(e===s[2].id||e===s[2].meta.displayName||e===pxt.getShortIDForAsset(s[2]))return this.selectedOption_=s,this.value_=this.getValue(),this.updateAssetListener(),super.doValueUpdate_(s[1]),void(t=!0);t||super.doValueUpdate_(e),this.selectedOption_=null,this.updateAssetListener()}}doClassValidation_(t){if(this.getOptions(!0).some(([,e])=>e===t))return t;if(t){var i=pxt.react.getTilemapProject(),s=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(t);let e;if(e=s?i.lookupAssetByName("tile",s[1]):t.startsWith(pxt.sprite.TILE_NAMESPACE)?i.lookupAsset("tile",t.trim()):i.lookupAssetByName("tile",t.trim()))return this.localTile=e,pxt.getTSReferenceForAsset(e,!1)}return this.sourceBlock_&&pxt.warn(`Trying to set tile reference to nonexistent tile. Block type: ${this.sourceBlock_.type}, Field name: ${this.name}, Value: `+t),null}getOptions(e){var t;return"function"!=typeof this.menuGenerator_?(this.transparent=o(),t=[this.transparent],this.localTile&&t.push([{src:(0,r.bitmapToImageURI)(pxt.sprite.Bitmap.fromData(this.localTile.bitmap),32,!1),width:32,height:32,alt:u(this.localTile)},this.localTile.id,this.localTile]),t):this.menuGenerator_.call(this)}dispose(){super.dispose(),pxt.react.getTilemapProject().removeChangeListener("tile",this.assetChangeListener)}updateAssetListener(){var e=pxt.react.getTilemapProject();e.removeChangeListener("tile",this.assetChangeListener),this.selectedOption_&&e.addChangeListener(this.selectedOption_[2],this.assetChangeListener)}saveState(e){let t,i=this.localTile||(null==(t=this.selectedOption_)?void 0:t[2]);var s,o,n=pxt.react.getTilemapProject();return i||(s=this.getValue(),o=pxt.parseAssetTSReference(s),i=(i=o?n.lookupAssetByName("tile",o.name):i)||n.lookupAsset("tile",s)),null!=i&&i.isProjectTile?(0,r.getAssetSaveState)(i):super.saveState(e)}loadState(e){"string"==typeof e?super.loadState(e):(e=(0,r.loadAssetFromSaveState)(e),this.localTile=e,super.loadState(pxt.getTSReferenceForAsset(e)))}getFieldDescription(){return lf("tile")}}function o(){var e=pxt.react.getTilemapProject().getTransparency(16);return[{src:a(16),width:32,height:32,alt:pxt.U.lf("transparency")},e.id,e]}function a(i){var e=document.createElement("canvas"),s=e.getContext("2d");e.width=i,e.height=i,s.fillStyle="#aeaeae",s.fillRect(0,0,i,i),s.fillStyle="#dedede";for(let t=0;t<i;t+=4)for(let e=0;e<i;e+=4)t+e>>2&1&&s.fillRect(t,e,4,4);return e.toDataURL()}function c(e){switch(e){case"myTiles.transparency16":return 1;case"myTiles.transparency4":case"myTiles.transparency8":case"myTiles.transparency32":return 2;default:if(e.startsWith("myTiles.tile")){var t=parseInt(e.slice(12));if(!Number.isNaN(t))return t+2}return 9999999999}}function u(e){return e.meta.displayName||pxt.getShortIDForAsset(e)}i.FieldTileset=l},{"./field_images":39,"./field_utils":69}],59:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggle=i.BaseFieldToggle=void 0;let s=e("blockly"),a=e("../constants");class o extends s.FieldNumber{constructor(e,t,i,s,o){super(e,void 0,void 0,void 0,o),this.trueText=i,this.falseText=s,this.isFieldCustom_=!0,this.CURSOR="pointer",this.params=t,this.setValue(e),this.type_=t.type}initView(){if(this.fieldGroup_){this.clickTarget_=this.sourceBlock_.getSvgRoot(),!this.sourceBlock_.isShadow()&&this.sourceBlock_.inputList&&1<this.sourceBlock_.inputList.length&&(this.borderRect_=s.utils.dom.createSvgElement("rect",{rx:this.getConstants().CORNER_RADIUS,ry:this.getConstants().CORNER_RADIUS,x:0,y:0,width:this.size_.width,height:this.size_.height,fill:this.sourceBlock_.getColour(),stroke:this.sourceBlock_.getColourTertiary()},null),this.fieldGroup_.insertBefore(this.borderRect_,this.textElement_));var e=this.getSize();switch(this.checkElement_=s.utils.dom.createSvgElement("g",{class:"blocklyToggle "+(this.state_?"blocklyToggleOn":"blocklyToggleOff"),transform:`translate(8, ${e.height/2})`},this.fieldGroup_),this.getOutputShape()){case a.provider.SHAPES.HEXAGONAL:this.toggleThumb_=s.utils.dom.createSvgElement("polygon",{class:"blocklyToggleRect",points:"-7,-14 -21,0 -7,14 7,14 21,0 7,-14",cursor:"pointer"},this.checkElement_);break;case a.provider.SHAPES.ROUND:this.toggleThumb_=s.utils.dom.createSvgElement("rect",{class:"blocklyToggleCircle",x:-6,y:-14,height:28,width:28,rx:14,ry:14,cursor:"pointer"},this.checkElement_);break;case a.provider.SHAPES.SQUARE:this.toggleThumb_=s.utils.dom.createSvgElement("rect",{class:"blocklyToggleRect",x:-6,y:-14,height:28,width:28,rx:3,ry:3,cursor:"pointer"},this.checkElement_)}var t=this.sourceBlock_.RTL?-e.width/2:e.width/2;this.textElement_=s.utils.dom.createSvgElement("text",{class:"blocklyText",x:t,dy:"0.6ex",y:e.height/2},this.fieldGroup_),this.updateEditable(),this.switchToggle(this.state_),this.setValue(this.getValue()),this.markDirty()}}getDisplayText_(){return this.state_?this.getTrueText():this.getFalseText()}getTrueText(){return this.trueText}getFalseText(){return this.falseText}getFieldDescription(){return this.getDisplayText_()}updateSize_(){switch(this.getOutputShape()){case a.provider.SHAPES.ROUND:this.size_.width=2*this.getInnerWidth()-7;break;case a.provider.SHAPES.HEXAGONAL:this.size_.width=2*this.getInnerWidth()+8-Math.floor(this.getInnerWidth()/2);break;case a.provider.SHAPES.SQUARE:this.size_.width=9+2*this.getInnerWidth()}}getInnerWidth(){return 10*this.getMaxLength()}getMaxLength(){return Math.max(this.getTrueText().length,this.getFalseText().length)}getOutputShape(){return this.sourceBlock_.isShadow()?this.sourceBlock_.getOutputShape():a.provider.SHAPES.SQUARE}doClassValidation_(e){return"boolean"==typeof this.fromVal(e)?e:"false"}applyColour(){var e=this.sourceBlock_.getColourTertiary();this.borderRect_?this.borderRect_.setAttribute("stroke",e):this.sourceBlock_.pathObject.svgPath.setAttribute("fill",e)}getValue(){return this.toVal(this.state_)}doValueUpdate_(e){e=this.fromVal(e);this.state_!==e&&(this.sourceBlock_&&s.Events.isEnabled()&&s.Events.fire(new s.Events.BlockChange(this.sourceBlock_,"field",this.name,this.state_,e)),this.state_=e,this.switchToggle(this.state_),this.isDirty_=!0)}switchToggle(o){if(this.checkElement_){this.updateSize_();var n=this.getSize(),r=this.getInnerWidth(),l=(o?(pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOff")):(pxt.BrowserUtils.removeClass(this.checkElement_,"blocklyToggleOn"),pxt.BrowserUtils.addClass(this.checkElement_,"blocklyToggleOff")),this.getOutputShape());let e=0,t=0,i=0,s=0;switch(l){case a.provider.SHAPES.HEXAGONAL:e=n.width/2,t=e/2,i=-t,s=t-r,this.toggleThumb_.setAttribute("points",`0,-14 -14,0 0,14 ${e},14 ${e+14},0 ${e},-14`);break;case a.provider.SHAPES.ROUND:case a.provider.SHAPES.SQUARE:e=5+r,t=e/2,this.toggleThumb_.setAttribute("width",""+e),this.toggleThumb_.setAttribute("x","-"+t),i=s=l==a.provider.SHAPES.SQUARE?2:-6}this.checkElement_.setAttribute("transform",`translate(${o?s+r+t:t+i}, ${n.height/2})`)}}render_(){if(this.visible_&&this.textElement_){for(;this.textElement_.firstChild;)this.textElement_.firstChild.remove();var e=document.createTextNode(this.getDisplayText_()),e=(this.textElement_.appendChild(e),pxt.BrowserUtils.addClass(this.textElement_,"blocklyToggleText"),this.updateSize_(),this.size_.width),t=this.state_?e+e/8:e/2;this.textElement_.setAttribute("x",""+(t-e/2))}this.borderRect_&&(this.borderRect_.setAttribute("width",""+this.size_.width),this.borderRect_.setAttribute("height",""+this.size_.height))}showEditor_(){var e=!this.state_;null!==e&&this.setValue(this.toVal(e))}toVal(e){return"number"==this.type_?String(e?"1":"0"):String(e?"true":"false")}fromVal(e){return"string"==typeof e?"1"==e||"TRUE"==e.toUpperCase():!!e}}i.BaseFieldToggle=o;class n extends o{constructor(e,t,i){super(e,t,lf("True"),lf("False"),i)}}i.FieldToggle=n},{"../constants":18,blockly:175}],60:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleDownUp=void 0;e=e("./field_toggle");class s extends e.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("DOWN"),lf("UP"),i)}}i.FieldToggleDownUp=s},{"./field_toggle":59}],61:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleHighLow=void 0;e=e("./field_toggle");class s extends e.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("HIGH"),lf("LOW"),i)}}i.FieldToggleHighLow=s},{"./field_toggle":59}],62:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleOnOff=void 0;e=e("./field_toggle");class s extends e.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("ON"),lf("OFF"),i)}}i.FieldToggleOnOff=s},{"./field_toggle":59}],63:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleUpDown=void 0;e=e("./field_toggle");class s extends e.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("UP"),lf("DOWN"),i)}}i.FieldToggleUpDown=s},{"./field_toggle":59}],64:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleWinLose=void 0;e=e("./field_toggle");class s extends e.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("WIN"),lf("LOSE"),i)}}i.FieldToggleWinLose=s},{"./field_toggle":59}],65:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldToggleYesNo=void 0;e=e("./field_toggle");class s extends e.BaseFieldToggle{constructor(e,t,i){super(e,t,lf("Yes"),lf("No"),i)}}i.FieldToggleYesNo=s},{"./field_toggle":59}],66:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTsExpression=void 0;e=e("blockly");class s extends e.FieldTextInput{constructor(){super(...arguments),this.isFieldCustom_=!0,this.pythonMode=!1}updateEditable(){var e=this.fieldGroup_,t=this.getSourceBlock();this.EDITABLE&&e&&t&&(this.enabled_&&t.isEditable()?(pxt.BrowserUtils.addClass(e,"blocklyEditableText"),pxt.BrowserUtils.removeClass(e,"blocklyGreyExpressionBlockText")):(pxt.BrowserUtils.addClass(e,"blocklyGreyExpressionBlockText"),pxt.BrowserUtils.removeClass(e,"blocklyEditableText")))}setPythonEnabled(e){e!==this.pythonMode&&(this.pythonMode=e,this.forceRerender())}getText(){return this.pythonMode?pxt.Util.lf("<python code>"):this.getValue()}getFieldDescription(){return this.pythonMode?pxt.Util.lf("<python code>"):pxt.Util.lf("<typescript code>")}applyColour(){var e;this.sourceBlock_&&null!=(e=this.getConstants())&&e.FULL_BLOCK_FIELDS&&this.borderRect_&&(this.borderRect_.setAttribute("stroke",this.sourceBlock_.style.colourPrimary),this.borderRect_.setAttribute("fill",this.sourceBlock_.style.colourPrimary))}}i.FieldTsExpression=s},{blockly:175}],67:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldTurnRatio=void 0;let o=e("blockly");e=e("../plugins/math");class u extends e.FieldSlider{constructor(e,t,i){super(String(e),"-200","200","1","10","TurnRatio",i),this.isFieldCustom_=!0,this.params=t,this.sliderColor_="#a8aaa8"}createLabelDom_(e){var t=document.createElement("div"),i=o.utils.dom.createSvgElement("svg",{xmlns:"http://www.w3.org/2000/svg","xmlns:html":"http://www.w3.org/1999/xhtml","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",height:u.HALF+u.HANDLE_RADIUS+10+"px",width:2*u.HALF+"px"},t),s=o.utils.dom.createSvgElement("defs",{},i),s=o.utils.dom.createSvgElement("marker",{id:"head",orient:"auto",markerWidth:"2",markerHeight:"4",refX:"0.1",refY:"1.5"},s),s=(o.utils.dom.createSvgElement("path",{d:"M0,0 V3 L1.5,1.5 Z",fill:"#f12a21"},s),this.reporter_=pxsim.svg.child(i,"text",{x:u.HALF,y:96,"text-anchor":"middle","dominant-baseline":"middle",style:"font-size: 50px",class:"sim-text inverted number"}),this.path_=o.utils.dom.createSvgElement("path",{x1:u.HALF,y1:u.HALF,"marker-end":"url(#head)",style:"fill: none; stroke: #f12a21; stroke-width: 10"},i),this.updateGraph_(),document.createElement("span"));return s.setAttribute("class","blocklyFieldSliderReadout"),[t,s]}updateGraph_(){if(this.path_){var t=Math.min(Math.max(Number(this.getValue())||0,-200),200),i=t/100,s=Math.max(-1,Math.min(1,i)),o=Math.max(s)*Math.PI/2,n=u.RADIUS-6;let e=u.HALF;var r=u.HALF-22,i=(1<Math.abs(i)&&(e-=(i-(0<i?1:-1))*n/2),.2+.5*Math.abs(s)),s=n*i,l=n*Math.sin(Math.PI/2-o),a=n*Math.cos(Math.PI/2-o),c=l-n*i*Math.cos(2*o),n=a-n*i*Math.sin(2*o),i=`M ${e} ${r} C ${e} ${r-s} ${e+n} ${r-c} ${e+a} `+(r-l);this.path_.setAttribute("d",i),this.reporter_.textContent=""+t}}setReadout(e){this.updateGraph_()}}(i.FieldTurnRatio=u).HALF=80,u.HANDLE_RADIUS=30,u.RADIUS=u.HALF-u.HANDLE_RADIUS-1},{"../plugins/math":119,blockly:175}],68:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getNextValue=i.FieldUserEnum=void 0;let u=e("blockly"),s=e("../external");e=e("./field_dropdown");class o extends e.FieldDropdown{constructor(e){var t;super((t=e,function(){let i=[];return this.sourceBlock_&&this.sourceBlock_.workspace?this.sourceBlock_.workspace.getVariableMap().getVariablesOfType(t.name).forEach(e=>{var t=e.getName().replace(/^\d+/,"");i.push([t,e.getName()])}):t.initialMembers.forEach(e=>i.push([e,e])),i.push([lf("Add a new {0}...",t.memberName),"CREATE"]),i})),this.opts=e}init(){super.init(),this.initVariables()}onItemSelected_(e,t){"CREATE"===t.getValue()?function n(r,l,a,c){(0,s.prompt)(a,null,o=>{if(o){let t=!1;if(pxtc.isIdentifierStart(o.charCodeAt(0),2)){t=!0;for(let e=1;e<o.length;e++)pxtc.isIdentifierPart(o.charCodeAt(e),2)||(t=!1)}if(t){let s=h(r,l.name);for(let i=0;i<s.length;i++){let[e,t]=s[i];if(e===o)return void u.dialog.alert(lf("A {0} named '{1}' already exists.",l.memberName,o),()=>n(r,l,a,c))}c(d(r,l,o))}else u.dialog.alert(lf("Names must start with a letter and can only contain letters, numbers, '$', and '_'."),()=>n(r,l,a,c))}},{placeholder:l.promptHint})}(this.sourceBlock_.workspace,this.opts,lf("New {0}:",this.opts.memberName),e=>e&&this.setValue(e)):super.onItemSelected_(e,t)}doClassValidation_(t){var e;return null!=(e=this.opts)&&e.initialMembers&&!this.opts.initialMembers.find(e=>e==t)&&this.getOptions(),super.doClassValidation_(t)}initVariables(){if(this.sourceBlock_&&this.sourceBlock_.workspace){let e=this.sourceBlock_.workspace,i=h(e,this.opts.name);var t;this.opts.initialMembers.forEach(t=>{i.some(([e])=>e===t)||d(e,this.opts,t)}),"CREATE"===this.getValue()&&(t=((e,t,i)=>{var s=e.getVariableMap().getVariablesOfType(t);if(s&&s.length)for(let e=0;e<s.length;e++){var[o]=n(s[e]);if(o===i)return s[e].getName()}})(e,this.opts.name,this.opts.initialMembers[0]))&&this.setValue(t)}}}function n(e){var t=/^(\d+)([^0-9].*)$/.exec(e.getName());return t?[t[2],parseInt(t[1])]:[e.getName(),-1]}function h(e,t){e=e.getVariableMap().getVariablesOfType(t);return e&&e.length?e.map(n):[]}function r(e,t){var i=e.map(([,e])=>e);if(t.isBitMask){for(let e=0;e<i.length;e++){var s=1<<e;if(i.indexOf(s)<0)return s}return 1<<i.length}if(t.isHash)return 0;var o=t.firstValue||0;for(let e=0;e<i.length;e++)if(i.indexOf(o+e)<0)return o+e;return o+i.length}function d(e,t,i){i=r(h(e,t.name),t)+i;return u.Variables.getOrCreateVariablePackage(e,null,i,t.name),i}i.FieldUserEnum=o,i.getNextValue=r},{"../external":25,"./field_dropdown":34,blockly:175}],69:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isImageProperties=i.clearDropDownDiv=i.deleteBlockDataForField=i.getBlockDataForField=i.setBlockDataForField=i.setBlockData=i.getBlockData=i.workspaceToScreenCoordinates=i.setMelodyEditorOpen=i.FieldEditorOpenEvent=i.FIELD_EDITOR_OPEN_EVENT_TYPE=i.loadAssetFromSaveState=i.getAssetSaveState=i.getTemporaryAssets=i.getTilesReferencedByTilesets=i.getAllReferencedTiles=i.getAllFields=i.updateTilemapXml=i.needsTilemapUpgrade=i.getAllBlocksWithTilesets=i.getAllBlocksWithTilemaps=i.songToDataURI=i.tilemapToImageURI=i.bitmapToImageURI=i.parseColour=i.svg=void 0;let s=e("blockly"),o=e("./field_tilemap"),n=e("./field_animation"),r=e("./field_musiceditor"),l=e("./field_sprite"),a=e("./field_tileset"),c;function p(e){return u(e,e=>e instanceof o.FieldTilemap&&!e.isGreyBlock)}function g(e){return u(e,e=>e instanceof a.FieldTileset)}function u(e,o){let n=[];return e.getTopBlocks(!1).forEach(e=>function e(t){for(var i of t.inputList){for(var s of i.fieldRow)o(s)&&n.push({block:t,field:s.name,ref:s});i.connection&&i.connection.targetBlock()&&e(i.connection.targetBlock())}t.nextConnection&&t.nextConnection.targetBlock()&&e(t.nextConnection.targetBlock())}(e)),n}(e=c=i.svg||(i.svg={})).hasClass=function(e,t){return pxt.BrowserUtils.containsClass(e,t)},e.addClass=function(e,t){pxt.BrowserUtils.addClass(e,t)},e.removeClass=function(e,t){pxt.BrowserUtils.removeClass(e,t)},i.parseColour=function(e){var t=Number(e);return isNaN(t)?"string"==typeof e&&e.match(/^#[0-9a-fA-F]{6}$/)?e:"#000":s.utils.colour.hueToHex(t)},i.bitmapToImageURI=function(i,e,s){var o=pxt.appTarget.runtime.palette.slice(1),t=document.createElement("canvas"),n=(t.width=e,t.height=e,Math.min(e/i.width,e/i.height)),r=Math.max(Math.floor(e*(1-i.width/i.height)/2),0),l=Math.max(Math.floor(e*(1-i.height/i.width)/2),0);let a;s?((a=t.getContext("2d",{alpha:!1})).fillStyle="#dedede",a.fillRect(0,0,e,e)):a=t.getContext("2d");for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++){var c=i.get(t,e);c?(a.fillStyle=o[c-1],a.fillRect(r+t*n,l+e*n,n,n)):s&&(a.fillStyle="#dedede",a.fillRect(r+t*n,l+e*n,n,n))}return t.toDataURL()},i.tilemapToImageURI=function(i,e,s){var o=pxt.appTarget.runtime.palette.slice(),t=document.createElement("canvas"),n=(t.width=e,t.height=e,Math.min(e/i.tilemap.width,e/i.tilemap.height)),r=Math.max(Math.floor(e*(1-i.tilemap.width/i.tilemap.height)/2),0),l=Math.max(Math.floor(e*(1-i.tilemap.height/i.tilemap.width)/2),0);let a;s?((a=t.getContext("2d",{alpha:!1})).fillStyle="#dedede",a.fillRect(0,0,e,e)):a=t.getContext("2d");var c=[];for(let t=0;t<i.tilemap.width;t++)for(let e=0;e<i.tilemap.height;e++){var u,h=i.tilemap.get(t,e);h?(c[h]||(u=i.tileset.tiles[h],c[h]=u?pxt.sprite.computeAverageColor(pxt.sprite.Bitmap.fromData(u.bitmap),o):"#dedede"),a.fillStyle=c[h],a.fillRect(r+t*n,l+e*n,n,n)):s&&(a.fillStyle="#dedede",a.fillRect(r+t*n,l+e*n,n,n))}return t.toDataURL()},i.songToDataURI=function(e,t,i,s,o){var n=pxt.appTarget.runtime.palette.slice(),r=document.createElement("canvas");r.width=t,r.height=i;let l;s?((l=r.getContext("2d",{alpha:!1})).fillStyle="#dedede",l.fillRect(0,0,t,i)):l=r.getContext("2d");var a,c=[5,11,5,4,2,6,14,2,5,1],u=(o=o||e.measures,Math.max(Math.floor(t/(e.beatsPerMeasure*o*2)),1)),h=Math.floor(t/u),d=Math.max(Math.floor(i/12),1),p=Math.floor(i/d);for(a of e.tracks)for(var g of a.notes){var m,_=Math.floor(g.startTick/(e.ticksPerBeat/2));if(h<_)break;for(m of g.notes){var b=12-m.note%12;p<b||(l.fillStyle=n[c[a.id||e.tracks.indexOf(a)]],l.fillRect(_*u,b*d,u,d))}}return r.toDataURL()},i.getAllBlocksWithTilemaps=p,i.getAllBlocksWithTilesets=g,i.needsTilemapUpgrade=function(e){return!!e.getVariableMap().getVariablesOfType(pxt.sprite.BLOCKLY_TILESET_TYPE).map(e=>pxt.sprite.legacy.blocklyVariableToTile(e.getName())).length},i.updateTilemapXml=function(e,s){let t=!1,o={};for(var i of e.children)if("variables"===i.tagName.toLowerCase()){var n,r,l,a,c=[];for(n of i.children)n.getAttribute("type")===pxt.sprite.BLOCKLY_TILESET_TYPE&&(t=!0,l=n.textContent,(l=pxt.sprite.legacy.blocklyVariableToTile(l)).qualifiedName||(r="myTiles.tile"+l.projectId,l=s.createNewTile(l.data,r),o[r]=l),c.push(n));for(a of c)a.remove()}if(t)for(var u of e.getElementsByTagName("field")){var h=u.textContent,d=h.trim();if(o[d])u.textContent=pxt.getTSReferenceForAsset(o[d]);else if(d.startsWith("tiles.createTilemap(")){d=pxt.sprite.legacy.decodeTilemap(h,"typescript");let i=[];var h=new pxt.sprite.TilemapData(d.tilemap,{tileWidth:d.tileset.tileWidth,tiles:d.tileset.tiles.map((e,t)=>null!=e.projectId?o["myTiles.tile"+e.projectId]:(i[t]||(i[t]=s.resolveTile(e.qualifiedName)),i[t]))},d.layers),[d]=s.createNewTilemapFromData(h),h=s.lookupAsset("tilemap",d);u.textContent=pxt.getTSReferenceForAsset(h)}}},i.getAllFields=u,i.getAllReferencedTiles=function(e,t){let i,s={};var o,n,r,l=p(e),a=pxt.react.getTilemapProject();for(o of l)if(o.block.id!==t)for(var c of(null==(i=o.ref.getTileset())?void 0:i.tiles)||[])s[c.id]=a.lookupAsset("tile",c.id);for(n of a.getAssets("tilemap"))for(var u of n.data.tileset.tiles)s[u.id]=a.lookupAsset("tile",u.id);for(r of g(e)){var h=r.ref.getValue(),d=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(h);d?(d=a.lookupAssetByName("tile",d[1]))&&!s[d.id]&&(s[d.id]=d):s[h]||(s[h]=a.resolveTile(h))}return Object.keys(s).map(e=>s[e]).filter(e=>!!e)},i.getTilesReferencedByTilesets=function(e){let t={};var i,s=pxt.react.getTilemapProject();for(i of g(e)){var o=i.ref.getValue(),n=/^\s*assets\s*\.\s*tile\s*`([^`]*)`\s*$/.exec(o);n?(n=s.lookupAssetByName("tile",n[1]))&&!t[n.id]&&(t[n.id]=n):t[o]||(t[o]=s.resolveTile(o))}return Object.keys(t).map(e=>t[e]).filter(e=>!!e)},i.getTemporaryAssets=function(e,t){switch(t){case"image":return u(e,e=>e instanceof l.FieldSpriteEditor&&e.isTemporaryAsset()).map(e=>e.ref.getAsset());case"animation":return u(e,e=>e instanceof n.FieldAnimationEditor&&e.isTemporaryAsset()).map(e=>e.ref.getAsset());case"song":return u(e,e=>e instanceof r.FieldMusicEditor&&e.isTemporaryAsset()).map(e=>e.ref.getAsset());default:return[]}},i.getAssetSaveState=function(e){var t={version:1,assetType:e.type,assetId:e.id,jres:{}},i=pxt.react.getTilemapProject();if("tilemap"===e.type){var s,o=i.getProjectTilesetJRes();for(s of Object.keys(o))if("*"!==s){var n=o[s];if(n.mimeType===pxt.TILEMAP_MIME_TYPE)n.id!==e.id&&delete o[s];else{let t=_(o["*"].namespace)+s;e.data.tileset.tiles.some(e=>e.id===t)||delete o[s]}}t.jres=o}else{var i="tile"===e.type?i.getProjectTilesetJRes():i.getProjectAssetsJRes(),[i,r]=(t.jres["*"]=i["*"],b(i,e.id));t.jres[i]=r}return t},i.loadAssetFromSaveState=function(e){let t=e.assetId;e.jres=(e=>{var t,i,s=e["*"],o={"*":s};for(t of Object.keys(e))"*"!==t&&(i=e[t],o[t]="string"==typeof i?{id:void 0,data:i,mimeType:s.mimeType}:i);return o})(e.jres);var i=pxt.react.getTilemapProject();if(n=i.lookupAsset(e.assetType,e.assetId)){var s=new pxt.TilemapProject,s=(s.loadGallerySnapshot(i.saveGallerySnapshot()),"tilemap"===e.assetType||"tile"===e.assetType?s.loadTilemapJRes(e.jres):s.loadAssetsJRes(e.jres),s.lookupAsset(e.assetType,e.assetId));if(pxt.assetEquals(s,n,!0))return n;n=i.lookupAssetByValue(s.type,s);if(n)return n;t=i.generateNewID(e.assetType);var o,[s,n]=b(e.jres,e.assetId);delete e.jres[s],"tilemap"===e.assetType?(n.id=t,e.jres[t]=n):([s,o]=t.split("."),_(s)!==_(e.jres["*"].namespace)&&(n.namespace=_(s)),n.id=t,e.jres[o]=n)}return"tilemap"===e.assetType||"tile"===e.assetType?i.loadTilemapJRes(e.jres,!0):i.loadAssetsJRes(e.jres),i.lookupAsset(e.assetType,t)},i.FIELD_EDITOR_OPEN_EVENT_TYPE="field_editor_open";class h extends s.Events.UiBase{constructor(e,t){super(e.workspace.id),this.type=i.FIELD_EDITOR_OPEN_EVENT_TYPE,this.blockId=e.id,this.isOpen=t}}function d(e){return e.data?/^(?:\d+;?)+$/.test(e.data)?{commentRefs:e.data.split(";"),fieldData:{}}:JSON.parse(e.data):{commentRefs:[],fieldData:{}}}function m(e,t){e.data=JSON.stringify(t)}function _(e){return e.endsWith(".")?e:e+"."}function b(t,i){var s,o=t["*"].namespace;for(s of Object.keys(t))if("*"!==s){var n=t[s];let e;if((e=n.id?n.namespace?_(n.namespace)+n.id:n.id:n.namespace?_(n.namespace)+s:_(o)+s)===i)return[s,t[s]]}}i.FieldEditorOpenEvent=h,i.setMelodyEditorOpen=function(e,t){s.Events.fire(new h(e,t))},i.workspaceToScreenCoordinates=function(e,t){var t=t.scale(e.scale),i=e.getOriginOffsetInPixels(),t=s.utils.Coordinate.sum(t,i),i=e.getInjectionDiv().getBoundingClientRect();return new s.utils.Coordinate(t.x+i.left,t.y+i.top)},i.getBlockData=d,i.setBlockData=m,i.setBlockDataForField=function(e,t,i){var s=d(e);s.fieldData[t]=i,m(e,s)},i.getBlockDataForField=function(e,t){return d(e).fieldData[t]},i.deleteBlockDataForField=function(e,t){var i=d(e);delete i.fieldData[t],m(e,i)},i.clearDropDownDiv=function(){s.DropDownDiv.clearContent(),s.DropDownDiv.getContentDiv().style.height=""},i.isImageProperties=function(e){return e&&"object"==typeof e&&"src"in e&&"string"==typeof e.src&&"alt"in e&&"string"==typeof e.alt&&"width"in e&&"number"==typeof e.width&&"height"in e&&"number"==typeof e.height}},{"./field_animation":27,"./field_musiceditor":44,"./field_sprite":53,"./field_tilemap":57,"./field_tileset":58,blockly:175}],70:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./field_utils"),i),o(e("./fieldEditorRegistry"),i),o(e("./field_animation"),i),o(e("./field_argumentvariable"),i),o(e("./field_kind"),i),o(e("./field_asset"),i),o(e("./field_ledmatrix"),i),o(e("./field_styledlabel"),i),o(e("./field_base"),i),o(e("./field_tsexpression"),i),o(e("./field_textinput"),i),o(e("./field_tilemap"),i),o(e("./field_userenum"),i),o(e("./field_procedure"),i),o(e("./field_sprite"),i),o(e("./field_imagedropdown"),i),o(e("./field_protractor"),i),o(e("./field_toggle_highlow"),i),o(e("./field_images"),i),o(e("./field_sound_effect"),i),o(e("./field_toggle_onoff"),i),o(e("./field_speed"),i),o(e("./field_toggle_updown"),i),o(e("./field_toggle_winlose"),i),o(e("./field_autocomplete"),i),o(e("./field_melodySandbox"),i),o(e("./field_toggle_yesno"),i),o(e("./field_musiceditor"),i),o(e("./field_textdropdown"),i),o(e("./field_note"),i),o(e("./field_turnratio"),i),o(e("./field_colorwheel"),i),o(e("./field_numberdropdown"),i),o(e("./field_colour"),i),o(e("./field_position"),i),o(e("./field_tileset"),i),o(e("./field_gridpicker"),i),o(e("./field_toggle"),i)},{"./fieldEditorRegistry":26,"./field_animation":27,"./field_argumentvariable":28,"./field_asset":29,"./field_autocomplete":30,"./field_base":31,"./field_colorwheel":32,"./field_colour":33,"./field_gridpicker":36,"./field_imagedropdown":37,"./field_images":39,"./field_kind":40,"./field_ledmatrix":41,"./field_melodySandbox":43,"./field_musiceditor":44,"./field_note":45,"./field_numberdropdown":46,"./field_position":47,"./field_procedure":48,"./field_protractor":49,"./field_sound_effect":51,"./field_speed":52,"./field_sprite":53,"./field_styledlabel":54,"./field_textdropdown":55,"./field_textinput":56,"./field_tilemap":57,"./field_tileset":58,"./field_toggle":59,"./field_toggle_highlow":61,"./field_toggle_onoff":62,"./field_toggle_updown":63,"./field_toggle_winlose":64,"./field_toggle_yesno":65,"./field_tsexpression":66,"./field_turnratio":67,"./field_userenum":68,"./field_utils":69}],71:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getBlockText=void 0;let r=e("blockly");i.getBlockText=function e(t){var i,s,o=[];for(i of t.inputList)if(i.isVisible()){if(0<i.fieldRow.length)for(var n of i.fieldRow)n.isVisible()&&(n=n.getFieldDescription?n.getFieldDescription():n.getText())&&o.push(n);i.connection&&i.connection.targetBlock()&&i.connection.type===r.INPUT_VALUE&&(s=e(i.connection.targetBlock()))&&o.push(`[${s}]`)}return o.join(" ")}},{blockly:175}],72:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.attachCardInfo=i.mkCard=i.installHelpResources=i.setHelpResources=i.installBuiltinHelpInfo=i.setBuiltinHelpInfo=void 0;let c=e("blockly"),u=e("./xml"),h=e("./external"),s=e("./toolbox"),d=e("./plugins/duplicateOnDrag");function p(i,s,e,t,o,n,r,l,a){!t||"string"!=typeof t&&"function"!=typeof t||i.setTooltip(t),o&&i.setHelpUrl(o),n&&i.setColour(n),a&&i.setDeletable(!1),(0,d.setDuplicateOnDragStrategy)(i);n=document.getElementById("blocklyToolboxDefinition"),a=n?(0,u.getFirstChildWithAttr)(n,"block","type",s):void 0;i.codeCard={header:e,name:e,software:1,description:"function"==typeof t?t(i):t,blocksXml:a?'<xml xmlns="http://www.w3.org/1999/xhtml">'+((0,u.cleanOuterHTML)(a)||`<block type="${s}"></block>`)+"</xml>":void 0,url:o},pxt.Util.isTranslationMode()&&(i.customContextMenu=e=>{let t=pxt.blocks.getBlockDefinition(i.type);t&&t.translationIds&&e.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,h.promptTranslateBlock)(s,t.translationIds)}})})}function o(e,t,i,s,o,n,r){var l=c.Blocks[e];let a=l.init;a&&(l.init=function(){a.call(this),p(this,e,t,i,s,o)})}function n(e,t){return{name:e.namespace+"."+e.name,shortName:e.name,description:e.attributes.jsDoc,url:e.attributes.help?"reference/"+e.attributes.help.replace(/^\//,""):void 0,blocksXml:`<xml xmlns="http://www.w3.org/1999/xhtml">${(0,u.cleanOuterHTML)(t)}</xml>`}}i.setBuiltinHelpInfo=function(e,t){var i=pxt.blocks.getBlockDefinition(t);p(e,t,i.name,i.tooltip,i.url,pxt.toolbox.getNamespaceColor(i.category))},i.installBuiltinHelpInfo=function(e){var t=pxt.blocks.getBlockDefinition(e);o(e,t.name,t.tooltip,t.url,pxt.toolbox.getNamespaceColor(t.category))},i.setHelpResources=p,i.installHelpResources=o,i.mkCard=n,i.attachCardInfo=function(e,t){var i;if(t=e.apis.byQName[t])return i=pxt.blocks.compileInfo(t),n(t,(0,s.createToolboxBlock)(e,t,i))}},{"./external":25,"./plugins/duplicateOnDrag":91,"./toolbox":139,"./xml":141,blockly:175}],73:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.validateAllReferencedBlocksExist=i.patchShadows=i.patchCommentIds=i.importXml=i.loadWorkspaceXml=i.loadBlocksXml=i.getFirstChildWithAttr=i.getChildrenWithAttr=i.getBlocksWithType=i.getDirectChildren=i.saveBlocksXml=i.workspaceToDom=i.saveWorkspaceXml=i.clearWithoutEvents=i.domToWorkspaceNoEvents=void 0;let _=e("blockly"),b=e("./loader"),f=e("./external"),l=e("./fields");function o(e,t,i){pxt.tickEvent("blocks.domtow");let s=[];k(e),I(e,!1),pxt.react.getTilemapProject&&(0,l.updateTilemapXml)(e,pxt.react.getTilemapProject());try{_.Events.disable(),s=_.Xml.domToWorkspace(e,t),l.FieldBase.flushInitQueue();for(var o of t.getAllBlocks())o.afterWorkspaceLoad&&o.afterWorkspaceLoad.call(o);r=i,(n=t).getAllBlocks(!1).filter(e=>!!e.getCommentText()).forEach(t=>{var i,s=t.getCommentText();if(/@hide/.test(s)&&null!=r&&r.applyHideMetaComment)t.dispose(!0);else{let e=s;/@highlight/.test(e)&&(e=e.replace(/@highlight/g,"").trim(),null!=(i=n.highlightBlock))&&i.call(n,t.id,!0),/@collapsed/.test(e)&&!t.getParent()&&(e=e.replace(/@collapsed/g,"").trim(),t.setCollapsed(!0)),s===(e=e.replace(/@validate-\S+/g,"").trim())||null!=r&&r.keepMetaComments||t.setCommentText(e||null)}})}catch(e){pxt.reportException(e)}finally{_.Events.enable()}var n,r;return s.filter(e=>!!t.getBlockById(e))}function s(e,t){var i,t=_.Xml.workspaceToDom(e,t),e=_.Xml.variablesToDom(e.getVariableMap().getAllVariables());for(i of T(t,"variables"))i.remove();return n(t.getElementsByTagName("block")),n(t.getElementsByTagName("shadow")),n(t.getElementsByTagName("comment")),t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e),t}function n(t){for(let e=0;e<t.length;e++){var i=t.item(e);i.hasAttribute("editable")&&i.removeAttribute("editable"),i.hasAttribute("movable")&&i.removeAttribute("movable")}}function T(t,i){var s=[];for(let e=0;e<t.childNodes.length;e++){var o=t.childNodes.item(e);o.tagName===i&&s.push(o)}return s}function E(e,t){return v(e,"block","type",t).concat(v(e,"shadow","type",t))}function v(e,t,i,s){return pxt.Util.toArray(e.getElementsByTagName(t)).filter(e=>e.getAttribute(i)===s)}function y(e,t,i,s){e=v(e,t,i,s);return e.length?e[0]:void 0}function k(e){var t,i;for(t of T(e,"comment"))t.hasAttribute("id")||t.setAttribute("id",_.utils.idGenerator.genUid());for(i of e.querySelectorAll("comment:not([h])"))i.setAttribute("h","80"),i.setAttribute("w","160")}function r(e){var t;if(2!==e.parentElement.childElementCount)return t=a(e),e.parentElement.appendChild(t),e.remove(),t;e.remove()}function a(e){var t,i,s=_.utils.xml.createElement("block");for(t of e.getAttributeNames())s.setAttribute(t,e.getAttribute(t));for(i of e.childNodes)s.appendChild(i.cloneNode(!0));return s}function I(t,e){if("shadow"===t.tagName)if("xml"===(null==(i=t.parentElement)?void 0:i.tagName)){pxt.warn(`Shadow block of type '${t.getAttribute("type")}' found at top level. Converting to non-shadow block`),pxt.tickEvent("blocks.import.topLevelShadow",{blockId:t.getAttribute("type")});var i=a(t),i=(t.parentElement.insertBefore(i,t),t.remove(),T(t=i,"mutation")[0]);null!=i&&i.hasAttribute("dupliacteondrag")&&i.removeAttribute("dupliacteondrag")}else{i=t.getAttribute("type");let e=!1;switch(i){case"variables_get_reporter":case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":e=!0}if(e){if(!(t=r(t)))return;let e=T(t,"mutation")[0];e?e.setAttribute("duplicateondrag","true"):((e=_.utils.xml.createElement("mutation")).setAttribute("duplicateondrag","true"),t.appendChild(e))}else"variables_get"!==i&&!function e(t){for(var i of t.children)if("block"===i.tagName.toLowerCase()||e(i))return!0;return!1}(t)||(t=r(t))}if(t)for(var s of t.children)I(s,e||"shadow"===t.tagName)}i.domToWorkspaceNoEvents=o,i.clearWithoutEvents=function(e){if(pxt.tickEvent("blocks.clear"),e)try{_.Events.disable(),e.clear(),e.clearUndo()}finally{_.Events.enable()}},i.saveWorkspaceXml=function(e,t){return e=s(e,!t),_.Xml.domToText(e)},i.workspaceToDom=s,i.saveBlocksXml=function(e,t){return e.getTopBlocks(!1).map(e=>_.Xml.domToText(_.Xml.blockToDom(e,!t)))},i.getDirectChildren=T,i.getBlocksWithType=E,i.getChildrenWithAttr=v,i.getFirstChildWithAttr=y,i.loadBlocksXml=function(e,t){var i,t=_.utils.xml.textToDom(t),t=_.Xml.domToBlock(t,e);e.getMetrics&&(e=e.getMetrics(),i=t.getHeightWidth(),t.moveBy(e.viewLeft+e.viewWidth/2-i.width/2,e.viewTop+e.viewHeight/2-i.height/2))},i.loadWorkspaceXml=function(e,t=!1,i){var s=new _.Workspace;try{return o(_.utils.xml.textToDom(e),s,i),s}catch(e){return t||pxt.reportException(e),null}},i.importXml=function(e,i,o,t=!1){try{(0,b.initializeAndInject)(o);let s=(new DOMParser).parseFromString(i,"application/xml");var n=pxt.patching.computePatches(e),r=(n&&(n.filter(e=>"blockId"==e.type).forEach(i=>Object.keys(i.map).forEach(t=>{E(s,t).forEach(e=>{e.setAttribute("type",i.map[t]),pxt.debug(`patched block ${t} -> `+i.map[t])})})),n.filter(e=>"blockValue"==e.type).forEach(i=>Object.keys(i.map).forEach(t=>{var e=t.split("."),e=e[0];E(s,e).reduce((e,t)=>e.concat(T(t,"value")),[]).forEach(e=>{e.setAttribute("name",i.map[t]),pxt.debug(`patched block value ${t} -> `+i.map[t])})})),n.filter(e=>"userenum"==e.type).forEach(i=>Object.keys(i.map).forEach(t=>{v(s,"variable","type",t).forEach(e=>{e.setAttribute("type",i.map[t]),pxt.debug(`patched enum variable type ${t} -> `+i.map[t])})}))),T(s.children.item(0),"shadow"));for(let i of r){let t=s.createElement("block");i.getAttributeNames().forEach(e=>t.setAttribute(e,i.getAttribute(e)));for(let e=0;e<i.childNodes.length;e++)t.appendChild(i.childNodes.item(e));i.replaceWith(t)}I(s.documentElement,!1),k(s.documentElement);let t={};Object.keys(o.apis.byQName).forEach(e=>{e=o.apis.byQName[e];7==e.kind&&(t[e.namespace+"."+(e.attributes.blockImportId||e.attributes.block||e.attributes.blockId||e.name)]=e.namespace+"."+e.name)});var l=s.getElementsByTagName("block");for(let e=0;e<l.length;++e)((o,n,r)=>{let e,t=r.getAttribute("type"),i=_.Blocks[t],l=(0,b.blockSymbol)(t);if(l&&i){let s=pxt.blocks.compileInfo(l);null!=(e=l.parameters)&&e.forEach((e,t)=>{var i=o.apis.byQName[e.type];i&&6==i.kind&&(e=y(r,"field","name",s.actualNameToParam[e.name].definitionName))&&(i=n[i.name+"."+e.textContent])&&(e.textContent=i)})}})(o,t,l[e]);{var a=s.documentElement;var c=o;var u=E(a,ts.pxtc.ON_START_TYPE);let i=u.length?u[0]:void 0;if(i)i.removeAttribute("deletable");else{var h=[],d=c.blocksById;let e=a.firstElementChild,t=void 0;for(;e;){var p=e.nextElementSibling,g=e.getAttribute("type");e.getAttribute("disabled")||e.getElementsByTagName("statement").length||!(b.buildinBlockStatements[g]||d[g]&&"void"==d[g].retType&&!(0,b.hasArrowFunction)(d[g]))||(t=(t?((g=a.ownerDocument.createElement("next")).appendChild(e),t.appendChild(g)):((t=a.ownerDocument.createElement("statement")).setAttribute("name","HANDLER"),i||((i=a.ownerDocument.createElement("block")).setAttribute("type",ts.pxtc.ON_START_TYPE),h.push(i)),i.appendChild(t),t.appendChild(e)),e.removeAttribute("x"),e.removeAttribute("y"),e)),e=p}h.forEach(e=>a.appendChild(e))}}return m=s.documentElement,pxt.U.toArray(m.querySelectorAll("block[type=procedures_defnoreturn]")).forEach(e=>{e.setAttribute("type","function_definition"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")}),pxt.U.toArray(m.querySelectorAll("block[type=procedures_callnoreturn]")).forEach(e=>{e.setAttribute("type","function_call"),e.querySelector("field[name=NAME]").setAttribute("name","function_name")}),(0,f.extensionBlocklyPatch)(e,s.documentElement),(new XMLSerializer).serializeToString(s)}catch(e){return t||pxt.reportException(e),i}var m},i.patchCommentIds=k,i.patchShadows=I,i.validateAllReferencedBlocksExist=function(e){pxt.U.assert(!(null==_||!_.Blocks),"Called validateAllReferencedBlocksExist before initializing Blockly");var t=(e=_.utils.xml.textToDom(e)).querySelectorAll("block");for(let e=0;e<t.length;e++)if(!_.Blocks[t.item(e).getAttribute("type")])return!1;var i=e.querySelectorAll("shadow");for(let e=0;e<i.length;e++)if(!_.Blocks[i.item(e).getAttribute("type")])return!1;return!0}},{"./external":25,"./fields":70,"./loader":77,blockly:175}],74:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)},n=(Object.defineProperty(i,"__esModule",{value:!0}),i.external=i.contextMenu=void 0,o(e("./plugins/arrays"),i),o(e("./plugins/functions"),i),o(e("./plugins/logic"),i),o(e("./plugins/math"),i),o(e("./plugins/text"),i),o(e("./plugins/renderer"),i),o(e("./plugins/flyout"),i),o(e("./plugins/newVariableField"),i),o(e("./plugins/comments"),i),o(e("./compiler/compiler"),i),o(e("./compiler/environment"),i),o(e("./loader"),i),o(e("./layout"),i),o(e("./render"),i),o(e("./toolbox"),i),o(e("./fields"),i),o(e("./sourceMap"),i),o(e("./importer"),i),o(e("./diff"),i),o(e("./legacyMutations"),i),o(e("./blockDragger"),i),o(e("./workspaceSearch"),i),o(e("./monkeyPatches"),i),o(e("./getBlockText"),i),e("./contextMenu")),n=(i.contextMenu=n,e("./external"));i.external=n,o(e("./breakpointIcon"),i)},{"./blockDragger":1,"./breakpointIcon":2,"./compiler/compiler":12,"./compiler/environment":13,"./contextMenu":21,"./diff":24,"./external":25,"./fields":70,"./getBlockText":71,"./importer":73,"./layout":75,"./legacyMutations":76,"./loader":77,"./monkeyPatches":81,"./plugins/arrays":83,"./plugins/comments":86,"./plugins/flyout":97,"./plugins/functions":111,"./plugins/logic":117,"./plugins/math":119,"./plugins/newVariableField":123,"./plugins/renderer":129,"./plugins/text":134,"./render":137,"./sourceMap":138,"./toolbox":139,"./workspaceSearch":140}],75:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.documentToSvg=i.blocklyToSvgAsync=i.cleanUpBlocklySvg=i.serializeSvgString=i.serializeNode=i.toSvgAsync=i.toPngAsync=i.screenshotAsync=i.screenshotEnabled=i.flow=i.setCollapsedAll=i.verticalAlign=i.splitSvg=i.patchBlocksFromOldWorkspace=void 0;let I=e("blockly"),C=e("./compiler/environment"),T=e("./fields"),S=e("./compiler/compiler"),n=e("./importer");function w(e){return(e=e.replace(/\n/g,"")).trim()}i.patchBlocksFromOldWorkspace=function(l,a,c){c=(0,n.loadWorkspaceXml)(c,!0);{var u,h=l,d=a;l=c;let e,t,i=d.getTopBlocks(!1).filter(e=>e.isEnabled()),s=l.getTopBlocks(!1),o,n=d.getTopComments(!1),r=l.getTopComments(!1);for(b of i){var p=b.getRelativeToSurfaceXY();if(p&&0!=p.x&&0!=p.y){if(!e){e=(0,C.mkEnv)(d,h),t={};for(var g of s){var m=(0,S.callKey)(e,g),_=t[m]||[];_.push(g),t[m]=_}}var b=(0,S.callKey)(e,b),b=(t[b]||[]).shift();b&&((b=b.getRelativeToSurfaceXY()).x=p.x,b.y=p.y)}}for(u of n){var f=u.getRelativeToSurfaceXY();if(f&&0!=f.x&&0!=f.y){if(!o){o={};for(var T of r){var E=w(T.getText()),v=o[E]||[];v.push(T),o[E]=v}}var y,k=w(u.getText()),k=(o[k]||[]).shift();k&&(y=u.getSize(),k.setText(u.getText()),k.setSize(y),(u=k.getRelativeToSurfaceXY()).x=f.x,u.y=f.y)}}}var e,l=(0,n.workspaceToDom)(a,!0),t=(0,n.workspaceToDom)(c,!0);for(e of l.childNodes)pxt.BrowserUtils.isElement(e)&&"block"===e.localName&&"true"===e.getAttribute("disabled")&&t.appendChild(t.ownerDocument.importNode(e,!0));return I.Xml.domToText(t)},i.splitSvg=function(u,e,h=18){var t=e.getTopComments(!0),i=e.getTopBlocks(!0);if(t.length+i.length<2)return u;let d=document.createElement("div");function o(e,t,i,s,o,n,r){var l=u.cloneNode(!0),a=l.querySelector("g.blocklyWorkspace > g."+e),t=l.querySelector("g.blocklyWorkspace > g."+t),e=pxt.Util.toArray(a.querySelectorAll(`g.blocklyWorkspace > g.${e} > `+(r?"."+r:"g[transform]")));let c=e.splice(i,1)[0];c?(e.filter(e=>e!=c).forEach(e=>{e.parentNode.removeChild(e)}),a.removeAttribute("transform"),t.parentNode.removeChild(t),c.setAttribute("transform",`translate(${o.x}, ${o.y})`),r=s.width/h+"em",i=s.height/h+"em",l.setAttribute("viewBox",`0 0 ${s.width} `+s.height),l.style.width=r,l.style.height=i,l.setAttribute("width",r),l.setAttribute("height",i),l.setAttribute("aria-label",n),d.appendChild(l)):pxt.log("missing block, did block failed to load?")}return d.className="blocks-svg-list "+e.getInjectionDiv().className,t.forEach((e,t)=>o("blocklyBubbleCanvas","blocklyBlockCanvas",t,e.getSize(),{x:0,y:0},lf("blockly comment"),"blocklyComment")),i.forEach((e,t)=>{var i=e.getHeightWidth(),s={x:0,y:0},e=(e.hat&&(i.height+=h,s.y+=h),e.toString());o("blocklyBlockCanvas","blocklyBubbleCanvas",t,i,s,e+" blocks")}),d},i.verticalAlign=function(e,i){let s=0;e.getTopComments(!0).forEach(e=>{e.moveBy(0,s),s=(s+=e.getSize().height)+i}),e.getTopBlocks(!0).forEach((e,t)=>{e.hat&&(s+=i),e.moveBy(0,s),s=(s+=e.getHeightWidth().height)+i})},i.setCollapsedAll=function(e,t){e.getTopBlocks(!1).filter(e=>e.isEnabled()).forEach(e=>e.setCollapsed(t))};let E=20,v=20;function s(e,t,i){let s,o=(i&&(s={target:pxt.appTarget.id,versions:pxt.appTarget.versions,xml:(0,n.saveBlocksXml)(e).map(e=>pxt.Util.htmlEscape(e))}),0|t||4);return r(e,o).then(e=>e?pxt.BrowserUtils.encodeToPngAsync(e.xml,{width:e.width,height:e.height,pixelDensity:o,text:i?JSON.stringify(s,null,2):null}):Promise.resolve(void 0)).catch(e=>{pxt.reportException(e)})}i.flow=function(e,t){if(t){if(t.useViewWidth){var i=e.getMetrics();if(i.viewHeight>i.viewWidth)return l(e.getTopComments(!0),e.getTopBlocks(!0),void 0,i.viewWidth),void e.scroll(E,v)}l(e.getTopComments(!0),e.getTopBlocks(!0),t.ratio)}else l(e.getTopComments(!0),e.getTopBlocks(!0));e.scroll(E,v)},i.screenshotEnabled=function(){return pxt.BrowserUtils.hasFileAccess()&&!pxt.BrowserUtils.isIE()},i.screenshotAsync=s,i.toPngAsync=s;let y="http://www.w3.org/1999/xlink",c=12e7;function r(e,t){if(!e)return Promise.resolve(void 0);var i,s,o,n=e.getBlocksBoundingBox(),r=e.getParentSvg().cloneNode(!0);u(r);for(i of e.getAllBlocks())i.hasIcon(I.icons.IconType.COMMENT)&&(s=(o=i.getIcon(I.icons.IconType.COMMENT)).getBubbleLocation())&&(o=o.getBubbleSize(),n.left=Math.min(s.x,n.left),n.top=Math.min(s.y,n.top),n.right=Math.max(s.x+o.width,n.right),n.bottom=Math.max(s.y+o.height,n.bottom));--n.left,--n.top,n.right+=1,n.bottom+=1;var e=n.right-n.left,l=n.bottom-n.top;let a=1;t=e*l*Math.pow(t,2);return t>c&&(a=Math.sqrt(c/t)),h(r,n.left,n.top,e,l,a)}function k(e){return o((new XMLSerializer).serializeToString(e))}function o(e){return e.replace(new RegExp("&nbsp;","g"),"&#160;")}function u(e){pxt.BrowserUtils.removeClass(e,"blocklySvg"),pxt.BrowserUtils.addClass(e,"blocklyPreview pxt-renderer classic-theme"),pxt.U.toArray(e.querySelectorAll(".blocklyMainBackground,.blocklyScrollbarBackground")).forEach(e=>{e&&e.parentNode.removeChild(e)}),pxt.U.toArray(e.querySelectorAll(".blocklyConnectionIndicator,.blocklyInputConnectionIndicator")).forEach(e=>{e&&e.parentNode.removeChild(e)}),e.removeAttribute("width"),e.removeAttribute("height"),pxt.U.toArray(e.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach(e=>e.removeAttribute("transform")),e.querySelectorAll("[tabindex]").forEach(e=>{e.removeAttribute("tabindex")});let i=new DOMParser;return pxt.U.toArray(e.querySelectorAll(".blocklyTextarea")).forEach(e=>{var t=i.parseFromString("<!doctype html><body>"+pxt.docs.html2Quote(e.value),"text/html");e.textContent=t.body.textContent}),e}async function h(e,t,i,s,o,n){if(e.childNodes[0]){e.removeAttribute("width"),e.removeAttribute("height"),e.removeAttribute("transform");var r,l=Math.round(s*(n||1)),n=Math.round(o*(n||1)),e=k(e).replace(/^\s*<svg[^>]+>/i,"").replace(/<\/svg>\s*$/i,""),t=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="${y}" width="${l}" height="${n}" viewBox="${t} ${i} ${s} ${o}" class="pxt-renderer classic-theme injectionDiv">${e}</svg>`,i=(new DOMParser).parseFromString(t,"image/svg+xml"),s=i.createElementNS("http://www.w3.org/1999/xhtml","style"),o=pxt.Util.isUserLanguageRtl(),e=document.getElementById(`style-${o?"rtl":""}blockly.css`).href,t=pxt.Util.toArray(document.head.getElementsByTagName("link")).filter(e=>pxt.Util.endsWith(e.getAttribute("href"),"semantic.css"))[0].href,o=await Promise.all([pxt.BrowserUtils.loadAjaxAsync(e),pxt.BrowserUtils.loadAjaxAsync(t)]),e=pxt.Util.toArray(document.head.querySelectorAll("style")).filter(e=>/\.blocklySvg/.test(e.innerText))[0],t=(o.unshift((null==(t=document.getElementById("blockly-common-style"))?void 0:t.innerText)||""),o.unshift((null==(t=document.getElementById("blockly-renderer-style-pxt-classic"))?void 0:t.innerText)||""),(e?e.innerText:"")+"\n\n"+o.map(e=>e+"\n\n")),e=(s.appendChild(i.createCDATASection(t)),i.documentElement.insertBefore(s,i.documentElement.firstElementChild),i);x=x||{};var a,c,o=(e=pxt.Util.toArray(e.getElementsByTagName("image"))).filter(e=>{e=e.getAttributeNS(y,"href");return e&&!/^data:/.test(e)});for(a of o){var u=a.getAttributeNS(y,"href");let t=x[u];if(!t)try{var h=await pxt.BrowserUtils.loadImageAsync(a.getAttributeNS(y,"href")),d=document.createElement("canvas"),p=d.getContext("2d"),g=h.width,m=h.height;d.width=g,d.height=m,p.drawImage(h,0,0,g,m,0,0,d.width,d.height),t=d.toDataURL("image/png"),x[u]=t}catch(e){pxt.debug("svg render: failed to load "+u),t=""}a.setAttributeNS(y,"href",u)}for(c of o=e.filter(e=>{e=e.getAttribute("href");return(null==e?void 0:e.endsWith(".svg"))&&(e.startsWith("/")||e.startsWith(pxt.webConfig.cdnUrl))})){var _=c.getAttribute("href");let e=24,t=24,i=(c.hasAttribute("width")&&c.hasAttribute("height")?(e=parseInt(c.getAttribute("width").replace(/[^0-9]/g,"")),t=parseInt(c.getAttribute("height").replace(/[^0-9]/g,""))):c.classList.contains("blocklyResizeHandle")&&(e=12,t=12),x[_]);i=i||await pxt.BrowserUtils.encodeToPngAsync(_,{width:e,height:t,pixelDensity:2}),x[_]=i,c.setAttribute("href",i)}await 0;s=i;if(R=R||{},pxt.BrowserUtils.isEdge())for(r of pxt.Util.toArray(s.getElementsByTagName("image")).filter(e=>/^data:image\/svg\+xml/.test(e.getAttributeNS(y,"href")))){var b=r.getAttributeNS(y,"href"),f=parseInt(r.getAttribute("width").replace(/[^0-9]/g,"")),T=parseInt(r.getAttribute("height").replace(/[^0-9]/g,""));let e=R[b];e||(e=await pxt.BrowserUtils.encodeToPngAsync(b,{width:f,height:T,pixelDensity:2}),pxt.log("HREF: "+e)),R[b]=e,r.setAttributeNS(y,"href",e)}return await 0,{width:l,height:n,svg:k(i).replace('<style xmlns="http://www.w3.org/1999/xhtml">',"<style>"),xml:A(i),css:t}}}function A(e){e=(new XMLSerializer).serializeToString(e);return"data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(unescape(encodeURIComponent(e)))}i.toSvgAsync=r,i.serializeNode=k,i.serializeSvgString=o,i.cleanUpBlocklySvg=u,i.blocklyToSvgAsync=h,i.documentToSvg=A;let x;let R;function l(e,t,i=1.62,s){let n=[],r={};e.forEach(e=>{var t=e.data;null!=t&&(r[t]=e)});let l,o=(t.sort((e,t)=>e.isEnabled()===t.isEnabled()?e.type===t.type?0:"function_definition"===e.type?1:"function_definition"===t.type?-1:e.type.localeCompare(t.type):e.isEnabled()?-1:1),t.forEach(e=>{var t=(0,T.getBlockData)(e).commentRefs;if(t.length){var i=[];for(let e=0;e<t.length;e++){var s=r[t[e]];s&&(i.push(O(s)),delete r[t[e]])}if(i.length)return void n.push({value:e,width:-1,height:-1,children:i})}var o=O(e);!l&&e.isEnabled()&&e.type===pxtc.ON_START_TYPE?l=o:n.push(o)}),l&&n.unshift(l),Object.keys(r).sort((e,t)=>e.length===t.length?t<e?-1:1:e.length>t.length?-1:1).forEach(e=>{r[e]&&n.push(O(r[e]))}),e.forEach(e=>{null==e.data&&n.push(O(e))}),0);for(let e=0;e<n.length;e++){var a=n[e];if(a.children){var c=a.value.getHeightWidth(),u=(a.x=0,a.y=0,c.width+13);let t=0;for(let e=0;e<a.children.length;e++){var h=a.children[e];h.x=u,h.y=t,t+=h.height+13,a.width=Math.max(a.width,u+h.width)}a.height=Math.max(t-13,c.height)}o+=(a.height+13)*(a.width+13)}let d,p=(d=s>E?s-E:Math.sqrt(o)*i,E),g=v,m=0;for(let e=0;e<n.length;e++){var _=n[e];if(_.children){f(_,p+_.x,g+_.y);for(let e=0;e<_.children.length;e++){var b=_.children[e];f(b,p+b.x,g+b.y)}}else f(_,p,g);p+=_.width+45,m=Math.max(m,g+_.height+45),p>d&&(p=E,g=m)}function f(e,t,i){var s=e.value.getBoundingRectangle();e.value.moveBy(t-s.left,i-s.top)}}function O(e){var t=e instanceof I.BlockSvg?e.getHeightWidth():e.getSize();return{value:e,height:t.height,width:t.width}}},{"./compiler/compiler":12,"./compiler/environment":13,"./fields":70,"./importer":73,blockly:175}],76:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.mutateToolboxBlock=i.addMutation=i.MutatorTypes=void 0;let s=e("blockly"),o=e("./compiler/util"),n=e("./compiler/compiler"),r=e("./loader"),l=e("./plugins/newVariableField/fieldVariable");var a;(e=a=i.MutatorTypes||(i.MutatorTypes={})).ObjectDestructuringMutator="objectdestructuring",e.RestParameterMutator="restparameter",e.DefaultInstanceMutator="defaultinstance",i.addMutation=function(e,t,i){let s;switch(i){case a.ObjectDestructuringMutator:if(!t.parameters||t.parameters.length<1)pxt.error("Destructuring mutations require at least one parameter");else{let e=!1;for(var o of t.parameters)if(-1!==o.type.indexOf("=>")){if(!o.properties||0===o.properties.length)return void pxt.error("Destructuring mutations only supported for functions with an event parameter that has multiple properties");e=!0}if(!e)return void pxt.error("Destructuring mutations must have an event parameter")}s=new u(e,t);break;case a.RestParameterMutator:s=new h(e,t);break;case a.DefaultInstanceMutator:s=new d(e,t);break;default:return void pxt.warn("Ignoring unknown mutation type: "+i)}e.mutationToDom=s.mutationToDom.bind(s),e.domToMutation=s.domToMutation.bind(s),e.compose=s.compose.bind(s),e.decompose=s.decompose.bind(s),e.mutation=s},i.mutateToolboxBlock=function(e,t,i){var s=document.createElement("mutation");switch(t){case a.ObjectDestructuringMutator:s.setAttribute(u.propertiesAttributeName,i);break;case a.RestParameterMutator:s.setAttribute(h.countAttributeName,i);break;case a.DefaultInstanceMutator:s.setAttribute(d.attributeName,i);default:return void pxt.warn("Ignoring unknown mutation type: "+t)}e.appendChild(s)};class c{constructor(e,t){this.info=t,this.block=e,this.topBlockType=this.block.type+"_mutator";t=this.getSubBlockNames(),this.initializeMutatorTopBlock(),this.initializeMutatorSubBlocks(t),t=t.map(e=>e.type);this.block.setMutator(new s.icons.MutatorIcon(t,e))}compose(e){e=e.getDescendants(!1).map(e=>({type:e.type,name:e.inputList[0].name}));e.shift(),this.updateBlock(e)}decompose(i){var e,t=i.newBlock(this.topBlockType);t.initSvg();for(e of t.inputList)if(e.name===c.mutatorStatmentInput){let t=e.connection;this.getVisibleBlockTypes().forEach(e=>{e=i.newBlock(e);e.initSvg(),t.connect(e.previousConnection),t=e.nextConnection});break}return t}compileMutation(e,t){}getDeclaredVariables(){}isDeclaredByMutation(e){return!1}initializeMutatorSubBlock(e,t,i){e.appendDummyInput(t).appendField(t),e.setColour(i),e.setNextStatement(!0),e.setPreviousStatement(!0)}initializeMutatorTopBlock(){let e=this.info.attributes.mutateText,t=this.block.getColour();s.Blocks[this.topBlockType]=s.Blocks[this.topBlockType]||{init:function(){this.appendDummyInput().appendField(e),this.setColour(t),this.appendStatementInput(c.mutatorStatmentInput)}}}initializeMutatorSubBlocks(e){let t=this.block.getColour(),i=this.initializeMutatorSubBlock.bind(this);e.forEach(e=>{s.Blocks[e.type]=s.Blocks[e.type]||{init:function(){i(this,e.name,t)}}})}}c.mutatorStatmentInput="PROPERTIES",c.mutatedVariableInputName="properties";class u extends c{constructor(e,t){super(e,t),this.currentlyVisible=[],this.parameterRenames={},this.prefix=this.info.attributes.mutatePrefix,this.block.appendDummyInput(c.mutatedVariableInputName),this.block.appendStatementInput("HANDLER").setCheck("null")}getMutationType(){return a.ObjectDestructuringMutator}compileMutation(s,e){var t;if(this.info.attributes.mutatePropertyEnum||this.parameters.length)return t=`function ({ ${this.parameters.map(e=>{var t=this.block.getField(e),t=t&&t.getText(),i=(0,o.escapeVarName)(e,s);return t!==e?(this.parameterRenames[e]=t,e+": "+(0,o.escapeVarName)(t,s)):i}).join(", ")} })`,this.info.attributes.mutatePropertyEnum?pxt.blocks.mkText(` [${this.parameters.map(e=>this.info.attributes.mutatePropertyEnum+"."+e).join(", ")}],`+t):pxt.blocks.mkText(t)}getDeclaredVariables(){let t={};return this.parameters.forEach(e=>{t[this.getVarFieldValue(e)]=this.parameterTypes[e]}),t}isDeclaredByMutation(t){return this.parameters.some(e=>this.getVarFieldValue(e)===t)}mutationToDom(){var e,t=document.createElement("mutation"),i=this.parameters.map(e=>{var t=this.getVarFieldValue(e);return t!==e&&(this.parameterRenames[e]=pxt.Util.htmlEscape(t)),pxt.Util.htmlEscape(e)}).join(",");for(e in t.setAttribute(u.propertiesAttributeName,i),this.parameterRenames)e===this.parameterRenames[e]&&delete this.parameterRenames[e];return t.setAttribute(u.renameAttributeName,JSON.stringify(this.parameterRenames)),t}domToMutation(e){var t=e.getAttribute(u.propertiesAttributeName);if(t){t=t.split(",");let i=[];if(void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),t.forEach(e=>{let t=e.split(":");this.info.parameters[this.paramIndex].properties.some(e=>e.name===t[0])&&i.push({property:t[0],newName:t[1]})}),this.parameterRenames=void 0,e.hasAttribute(u.renameAttributeName))try{this.parameterRenames=JSON.parse(e.getAttribute(u.renameAttributeName))}catch(e){pxt.warn("Ignoring invalid rename map in saved block mutation")}this.parameterRenames=this.parameterRenames||{},this.parameters=[],i.forEach(e=>{this.parameters.push(e.property),e.newName&&e.newName!==e.property&&(this.parameterRenames[e.property]=e.newName)}),this.updateVisibleProperties(),i.filter(e=>!!e.newName).forEach(e=>this.setVarFieldValue(e.property,e.newName))}}getVarFieldValue(e){e=this.block.getField(e);return e&&e.getText()}setVarFieldValue(e,t){this.block.getField(e);this.block.getField(e)&&(0,r.setVarFieldValue)(this.block,e,t)}updateBlock(e){this.parameters=[],e.forEach(e=>{-1===this.parameters.indexOf(e.name)&&this.parameters.push(e.name)}),this.updateVisibleProperties()}getSubBlockNames(){return this.parameters=[],this.parameterTypes={},void 0===this.paramIndex&&(this.paramIndex=this.getParameterIndex()),this.info.parameters[this.paramIndex].properties.map(e=>(this.parameterTypes[e.name]=e.type,{type:this.propertyId(e.name),name:e.name}))}getVisibleBlockTypes(){return this.currentlyVisible.map(e=>this.propertyId(e))}updateVisibleProperties(){if(!pxt.Util.listsEqual(this.currentlyVisible,this.parameters)){let i=this.block.inputList.find(e=>e.name===c.mutatedVariableInputName);this.prefix&&0===this.currentlyVisible.length&&i.appendField(this.prefix,u.prefixLabel),this.currentlyVisible.forEach(e=>{var t;-1===this.parameters.indexOf(e)&&((t=this.getVarFieldValue(e))!==e&&(this.parameterRenames[e]=t),i.removeField(e))}),this.parameters.forEach(e=>{var t;-1===this.currentlyVisible.indexOf(e)&&(t=this.parameterRenames[e]||e,i.appendField(new l.FieldVariable(t),e))}),this.prefix&&0===this.parameters.length&&i.removeField(u.prefixLabel),this.currentlyVisible=this.parameters}}propertyId(e){return this.block.type+"_"+e}getParameterIndex(){for(let e=0;e<this.info.parameters.length;e++)if(-1!==this.info.parameters[e].type.indexOf("=>"))return e}}u.propertiesAttributeName="callbackproperties",u.renameAttributeName="renamemap",u.prefixLabel="0prefix_label_";class h extends c{constructor(){super(...arguments),this.count=0}getMutationType(){return a.RestParameterMutator}compileMutation(t,i){let s=[];return this.forEachInput(e=>s.push((0,n.compileExpression)(t,e,i))),pxt.blocks.mkGroup(s)}mutationToDom(){var e=document.createElement("mutation");return e.setAttribute(h.countAttributeName,this.count.toString()),e}domToMutation(e){e=e.getAttribute(h.countAttributeName);if(e){try{this.count=parseInt(e)}catch(e){return}for(let e=0;e<this.count;e++)this.addNumberField(!1,e)}}updateBlock(e){if(e){var t=Math.abs(this.count-e.length);if(this.count<e.length)for(let e=0;e<t;e++)this.addNumberField(!0,this.count);else if(this.count>e.length)for(let e=0;e<t;e++)this.removeNumberField()}}getSubBlockNames(){return[{name:"Value",type:h.entryTypeName}]}getVisibleBlockTypes(){let e=[];return this.forEachInput(()=>e.push(h.entryTypeName)),e}addNumberField(e,t){t=this.block.appendValueInput(h.valueInputPrefix+t).setCheck("Number");e&&((e=this.block.workspace.newBlock("math_number")).initSvg(),e.setShadow(!0),t.connection.connect(e.outputConnection),this.block.workspace.render(),this.count++)}removeNumberField(){0<this.count&&this.block.removeInput(h.valueInputPrefix+(this.count-1)),this.count--}forEachInput(t){for(let e=0;e<this.count;e++)t(this.block.getInputTargetBlock(h.valueInputPrefix+e),e)}}h.countAttributeName="count",h.entryTypeName="entry",h.valueInputPrefix="value_input_";class d extends c{constructor(){super(...arguments),this.showing=!1}getMutationType(){return a.DefaultInstanceMutator}compileMutation(e,t){if(this.showing){var i=this.block.getInputTargetBlock(d.instanceInputName);if(i)return(0,n.compileExpression)(e,i,t)}}mutationToDom(){var e=document.createElement("mutation");return e.setAttribute(d.attributeName,this.showing?"true":"false"),e}domToMutation(e){e=e.getAttribute(d.attributeName);e?this.updateShape("true"===e):this.updateShape(!1)}updateBlock(e){this.updateShape(!(!e||!e.length))}getSubBlockNames(){return[{name:"Instance",type:d.instanceSubBlockType}]}getVisibleBlockTypes(){var e=[];return this.showing&&e.push(d.instanceSubBlockType),e}updateShape(e){this.showing!==e&&(e&&!this.block.getInputTargetBlock(d.instanceInputName)?this.block.appendValueInput(d.instanceInputName):this.block.removeInput(d.instanceInputName),this.showing=e)}}d.attributeName="showing",d.instanceInputName="__instance__",d.instanceSubBlockType="instance"},{"./compiler/compiler":12,"./compiler/util":15,"./loader":77,"./plugins/newVariableField/fieldVariable":122,blockly:175}],77:[function(e,E,C){Object.defineProperty(C,"__esModule",{value:!0}),C.setVarFieldValue=C.generateIcons=C.getFixedInstanceDropdownValues=C.setOutputCheck=C.getBlocklyCheckForType=C.initAccessibleBlocksContextMenuItems=C.initialize=C.initializeAndInject=C.cleanBlocks=C.hasArrowFunction=C.injectBlocks=C.blockSymbol=C.cachedBlockInfo=C.buildinBlockStatements=C.builtinBlocks=C.isTupleType=C.DRAGGABLE_PARAM_INPUT_PREFIX=C.initCopyPaste=void 0;let S=e("blockly"),w=e("./constants"),T=e("./composableMutations"),A=e("./legacyMutations"),t=e("./builtins/math"),x=e("./fields"),i=e("./builtins/functions"),s=e("./builtins/lists"),o=e("./builtins/logic"),n=e("./builtins/loops"),r=e("./builtins/text"),l=e("./toolbox"),c=e("./help"),R=e("./fields"),O=e("./fields"),N=e("./fields"),$=e("./fields"),u=e("./external"),a=e("./builtins/variables"),h=e("./builtins/misc"),v=e("./contextMenu"),y=e("./codecardRenderer"),H=e("./fields/field_dropdown"),L=e("./plugins/duplicateOnDrag"),d=e("./copyPaste");var k=e("./copyPaste");Object.defineProperty(C,"initCopyPaste",{enumerable:!0,get:function(){return k.initCopyPaste}});let G=e("./plugins/newVariableField/fieldVariable"),I=e("./plugins/functions"),V=e("./plugins/functions/utils"),W=e("./compiler/util"),z=e("./compiler/compiler");C.DRAGGABLE_PARAM_INPUT_PREFIX="HANDLER_DRAG_PARAM_",C.isTupleType=function(e){if(e=/^\[(.+)\]$/.exec(e))return e[1].split(/,\s*/)};let p;function g(){return p||(p={},Object.keys(S.Blocks).forEach(e=>p[e]={block:S.Blocks[e]})),p}C.builtinBlocks=g,C.buildinBlockStatements={controls_if:!0,controls_for:!0,pxt_controls_for:!0,controls_simple_for:!0,controls_repeat_ext:!0,pxt_controls_for_of:!0,controls_for_of:!0,variables_set:!0,variables_change:!0,device_while:!0};let m={};function _(a){return C.cachedBlockInfo=a,(0,L.setDraggableShadowBlocks)(a.blocks.filter(e=>e.attributes.duplicateShadowOnDrag).map(e=>e.attributes.blockId)),(0,I.setArgumentReporterLocalizeFunction)((s,o)=>{{var n=a,r=s;let e,t=void 0,i=(s=o).getLocalizationName();i&&(l=pxt.U.rlf(i),t=l!==i?l:pxtc.getBlockTranslationsCacheKey(i));var l=(0,V.getArgumentReporterParent)(s,s);if(l&&!(0,W.isFunctionDefinition)(l)){s=n.blocksById[l.type];if(s){n=pxt.blocks.compileInfo(s),s=null==(e=n.handlerArgs)?void 0:e.find(e=>e.name===r.getValue());if(s)return pxtc.getBlockTranslationsCacheKey(s.localizationKey)}}return t}}),a.blocks.map(e=>{var t,i=pxt.blocks.compileInfo(e),s=(0,l.createToolboxBlock)(a,e,i,!1,2);return e.attributes.blockBuiltin?(pxt.Util.assert(!!g()[e.attributes.blockId]),(t=g()[e.attributes.blockId]).symbol=e,t.block.codeCard=(0,c.mkCard)(e,s)):((_,b,f,e)=>{let t=b.attributes.blockId;if(g()[t])return pxt.reportError("blocks","trying to override builtin block",{details:t});var i=JSON.stringify(b);if(!m[t]||m[t].hash!=i){if(S.Blocks[b.attributes.blockId])return pxt.error("duplicate block definition: "+t);i={hash:i,fn:b,block:{codeCard:(0,c.mkCard)(b,e),init:function(){{var a=this,y=_,k=b,I=f,c,u;let e,t,i=(k.attributes.blockNamespace||k.namespace).split(".")[0],E=1==k.kind||2==k.kind,s=("boolean"!=typeof k.isInstance||null!=(e=k.attributes)&&e.defaultInstance||(E=k.isInstance),y.apis.byQName[i]),v=k.attributes.blockNamespace&&s&&s.attributes.color||k.attributes.color||s&&s.attributes.color||pxt.toolbox.getNamespaceColor(i)||255,o=pxt.blocks.getHelpUrl(k),n=(o&&a.setHelpUrl(o),(0,L.setDuplicateOnDragStrategy)(a),a.setColour("string"==typeof v?pxt.toolbox.getAccessibleBackground(v):v),w.provider.SHAPES.ROUND),r=("boolean"==k.retType&&(n=w.provider.SHAPES.HEXAGONAL),a.setOutputShape(n),k.attributes.undeletable&&a.setDeletable(!1),m(k.attributes._def),!1),l=!1;if(k.attributes.mutate)(0,A.addMutation)(a,k,k.attributes.mutate);else if(k.attributes.defaultInstance)(0,A.addMutation)(a,k,A.MutatorTypes.DefaultInstanceMutator);else if(k.attributes._expandedDef&&"disabled"!==k.attributes.expandableArgumentMode){var h="toggle"===k.attributes.expandableArgumentMode;(0,T.initExpandableBlock)(y,a,k.attributes._expandedDef,I,h,()=>m(k.attributes._expandedDef,!0))}else if(I.handlerArgs.length)if(r=!0,k.attributes.optionalVariableArgs)"reporter"===k.attributes.draggableParameters?l=!0:(0,T.initVariableArgsBlock)(a,I.handlerArgs);else if(k.attributes.draggableParameters)I.handlerArgs.filter(e=>!e.inBlockDef).forEach(e=>{var t=a.appendValueInput(C.DRAGGABLE_PARAM_INPUT_PREFIX+e.name);"reporter"==k.attributes.draggableParameters?t.setCheck(D(e.type,y)):t.setCheck("Variable")}),I.handlerArgs.forEach(e=>{(0,L.setDuplicateOnDrag)(a.type,C.DRAGGABLE_PARAM_INPUT_PREFIX+e.name)});else{let t=a.appendDummyInput();I.handlerArgs.filter(e=>!e.inBlockDef).forEach(e=>{t.appendField(new G.FieldVariable(e.name),"HANDLER_"+e.name)})}(0,T.appendMutation)(a,{mutationToDom:t=>(a.inputList.forEach(e=>{e.fieldRow.forEach(e=>{e.isFieldCustom_&&e.saveOptions&&(e=e.saveOptions())&&t.setAttribute("customfield",JSON.stringify(e))})}),t),domToMutation:i=>{a.inputList.forEach(e=>{e.fieldRow.forEach(e=>{var t;e.isFieldCustom_&&e.restoreOptions&&(t=JSON.parse(i.getAttribute("customfield")))&&e.restoreOptions(t)})})}}),(h=k.attributes.imageLiteral||k.attributes.gridLiteral)&&(d=(k.attributes.imageLiteralColumns||5)*h,p=k.attributes.imageLiteralRows||5,g=k.attributes.imageLiteralScale,c=k.attributes.gridLiteralOnColor,u=k.attributes.gridLiteralOffColor,a.appendDummyInput().appendField(new R.FieldLedMatrix("",{columns:d,rows:p,scale:g,onColor:c,offColor:u}),"LEDS")),"external"===k.attributes.inlineInputMode?a.setInputsInline(!1):"inline"===k.attributes.inlineInputMode?a.setInputsInline(!0):a.setInputsInline(!k.parameters||k.parameters.length<4&&!h),((d=null==(t=k.parameters)?void 0:t.find(e=>pxtc.parameterTypeIsArrowFunction(e)))||r)&&(a.appendStatementInput("HANDLER").setCheck(null),a.setInputsInline(!0));var d,p=M(k),g=!!k.attributes.handlerStatement||!!k.attributes.forceStatement||"void"===k.retType&&!p;function m(e,s=!1){let o=0,f=!s&&!!I.thisParameter;e=(e=>{let t=[],i=[];return e.parts.forEach(e=>{switch(e.kind){case"break":s();break;case"param":i.push(e),s();break;case"image":case"label":i.push(e)}}),s(),t;function s(){i.length&&(t.push(i),i=[])}})(e);let T=new pxt.ImageConverter;if("ENUM_GET"!==k.attributes.shim&&"KIND_GET"!==k.attributes.shim||!(1<I.parameters.length||I.thisParameter)){let i=t=>{var e;return null==(e=a.inputList)?void 0:e.some(e=>e.name===t)};e.forEach(e=>{let g=[],m,_,b=!1;e.forEach(e=>{if("param"!==e.kind){var t=(e=>{if("image"===e.kind){var t=e.uri,i=P[t];if(i)return new S.FieldImage(i,40,40,"",null,pxt.Util.isUserLanguageRtl());pxt.log("missing jres icon "+t)}else{var s=(e=>{if(" "===e)return"";if(1<e.length){var t=" "==e.charAt(0),i=" "==e.charAt(e.length-1);if(t||i)return e.substring(t?1:0,i?e.length-1:e.length)}return e})(e.text);if(s)return e.cssClass?new S.FieldLabel(s,e.cssClass):e.style.length?new O.FieldStyledLabel(s,{bold:-1!==e.style.indexOf("bold"),italics:-1!==e.style.indexOf("italics"),blocksInfo:void 0}):new S.FieldLabel(s,void 0)}})(e);t&&g.push({field:t})}else if("ENUM_GET"===k.attributes.shim)pxt.Util.assert(!!k.attributes.enumName,"Trying to create an ENUM_GET block without a valid enum name"),g.push({name:"MEMBER",field:new N.FieldUserEnum(y.enumsByName[k.attributes.enumName])});else if("KIND_GET"===k.attributes.shim)g.push({name:"MEMBER",field:new x.FieldKind(y.kindsByName[k.attributes.kindNamespace||k.attributes.blockNamespace||k.namespace])});else{let s=((i,e,t=!1)=>{if(i.ref){var s="this"===i.name?e.thisParameter:e.actualNameToParam[i.name];if(!s){let t;if(e.handlerArgs.forEach(e=>{e.name===i.name&&(t=e)}),t)return t}return s}return t?e.thisParameter:e.definitionNameToParam[i.name]})(e,I,f);if(f=!1,s)if(s.definitionName){var t=pxt.Util.lookup(y.apis.byQName,s.type),i=(b=!0,s.definitionName),o=s.actualName,n=t&&6==t.kind,r=t&&!!t.attributes.fixedInstances&&!s.shadowBlockId,l=!!k.attributes.constantShim,a="@combined@"==s.type,c=s.fieldEditor,u=i.charAt(0).toUpperCase()+i.slice(1),h=s.type;if(n||r||l||a){let e;0==(e=n?(l=y.apis,p=s.type,pxt.Util.values(l.byQName).filter(e=>e.namespace===p&&!e.attributes.blockHidden)):r?U(y.apis,t.qName):a?k.combinedProperties.map(e=>pxt.Util.lookup(y.apis.byQName,e)):(n=y.apis,d=k.qName,pxt.Util.values(n.byQName).filter(e=>e.attributes.blockIdentity===d))).length&&pxt.error(`no instances of ${t.qName} found`);l=e.map(e=>{let t=e.attributes.block||e.attributes.blockId||e.name;var i=e.attributes.blockCombine;return e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=T.convert(e.attributes.jresURL)),i&&(t=t.replace(/@set/,"")),[e.attributes.iconURL||e.attributes.blockImage?{src:e.attributes.iconURL||pxt.Util.pathJoin(pxt.webConfig.commitCdnUrl,`blocks/${e.namespace.toLowerCase()}/${e.name.toLowerCase()}.png`),alt:t,width:36,height:36,value:e.name}:t,e.namespace+"."+e.name]});if(s.defaultValue){let i=-1;l.some((e,t)=>e[1]===s.defaultValue&&(i=t,!0)),-1<i&&(r=l.splice(i,1)[0],l.unshift(r))}c?(a=k.attributes.paramDefl[o]||"",n={data:l,colour:v,label:u,type:h,blocksInfo:y},pxt.Util.jsonMergeFrom(n,k.attributes.paramFieldEditorOptions&&k.attributes.paramFieldEditorOptions[o]||{}),g.push(F((0,$.createFieldEditor)(c,a,n),i))):g.push(F(new H.FieldDropdown(l),i))}else c?(t=k.attributes.paramDefl[s.actualName]||"",r={colour:v,label:u,type:h,blocksInfo:y},pxt.Util.jsonMergeFrom(r,k.attributes.paramFieldEditorOptions&&k.attributes.paramFieldEditorOptions[s.actualName]||{}),g.push(F((0,$.createFieldEditor)(c,t,r),s.definitionName))):(m=i,E&&"this"===e.name?_=s.type:"number"==s.type&&s.shadowBlockId&&"value"==s.shadowBlockId?(m=void 0,g.push(F(new S.FieldNumber("0"),i))):_="string"==s.type&&s.shadowOptions&&s.shadowOptions.toString?null:D(s.type,y))}else m=C.DRAGGABLE_PARAM_INPUT_PREFIX+s.name,_="reporter"===k.attributes.draggableParameters?D(s.type,y):"Variable";else pxt.error("block "+k.attributes.blockId+": unknown parameter "+e.name+(e.ref?` (${e.ref})`:""))}var d,p});let t;if(m){if(i(m))return;(t=a.appendValueInput(m)).setAlign(S.inputs.Align.LEFT)}else if(s){e=b?w.optionalInputWithFieldPrefix:w.optionalDummyInputPrefix;if(m=e+o++,i(m))return;t=a.appendDummyInput(m)}else t=a.appendDummyInput();_&&t.setCheck(_),g.forEach(e=>t.appendField(e.field,e.name))}),T.logTime()}else pxt.warn(`Enum blocks may only have 1 parameter but ${k.attributes.blockId} has `+I.parameters.length)}g||B(a,k.retType,y),a.setPreviousStatement(g),a.setNextStatement(g),l&&(0,T.initVariableReporterArgs)(a,I.handlerArgs,y),a.setTooltip(/^__/.test(k.namespace)?"":k.attributes.jsDoc)}}}};pxt.Util.isTranslationMode()&&(i.block.customContextMenu=e=>{b.attributes.translationId&&e.push({enabled:!0,text:lf("Translate this block"),callback:function(){(0,u.promptTranslateBlock)(t,[b.attributes.translationId])}})}),m[t]=i,S.Blocks[t]=i.block}})(a,e,i,s),e})}function M(e){return!(null==(e=e.parameters)||!e.some(e=>pxtc.parameterTypeIsArrowFunction(e)))}C.blockSymbol=function(e){return(e=m[e])?e.fn:void 0},C.injectBlocks=_,C.hasArrowFunction=M,C.cleanBlocks=function(){for(var e in pxt.debug("removing all custom blocks"),m)e=m[e].fn,delete S.Blocks[e.attributes.blockId],delete m[e.attributes.blockId]},C.initializeAndInject=function(e){f(e),(0,v.initContextMenu)(),(0,d.initCopyPaste)(!1),_(e)};let b=!(C.initialize=function(e){f(e);{P={};let i=e.apis.jres;i&&Object.keys(i).forEach(e=>{var t=i[e];t&&t.icon&&(P[e]=t.icon)})}});function f(e){if(!b){b=!0,(0,$.initFieldEditors)(),(0,h.initOnStart)(),(0,t.initMath)(e),(0,a.initVariables)(),(0,i.initFunctions)(),(0,s.initLists)(),(0,n.initLoops)(),(0,o.initLogic)(),(0,r.initText)(),S.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="";{let n=e=>{var t;if(null!=(t=e.hasDisabledReason)&&t.call(e,z.AUTO_DISABLED_REASON))return lf("This block is disabled and will not run. Attach this block to an event to enable it.");let i=e.tooltip;for(;"function"==typeof i;)i=i(e);return i};S.Tooltip.setCustomTooltip((t,e)=>{if(e.codeCard){var i=(0,y.renderCodeCard)({header:n(e)});t.appendChild(i)}else{var i=n(e),s=(i=S.utils.string.wrap(i,S.Tooltip.LIMIT)).split("\n");for(let e=0;e<s.length;e++){var o=document.createElement("div");o.appendChild(document.createTextNode(s[e])),t.appendChild(o)}}})}pxt.BrowserUtils.isSafari()&&pxt.BrowserUtils.isIOS()&&document.addEventListener("pointerup",e=>{setTimeout(()=>{S.Touch.checkTouchIdentifier(e)&&S.Touch.clearTouchIdentifier()})})}}function D(e,t){var i,s=e.split(/\s*\|\s*/),o=[];for(i of s)switch(i){case"number":o.push("Number");break;case"string":o.push("String");break;case"boolean":o.push("Boolean");break;case"T":case"any":return null;case"void":return;default:if((0,l.isArrayType)(i)){if(1<s.length)return null;o.push("Array")}var n=t.apis.byQName[i];n&&n.extendsTypes&&0<n.extendsTypes.length?o.push(...n.extendsTypes):o.push(i)}return o}function B(e,t,i){t=D(t,i);!t&&null!==t||e.setOutput(!0,t)}C.initAccessibleBlocksContextMenuItems=function(){(0,d.initAccessibleBlocksCopyPasteContextMenu)()},C.getBlocklyCheckForType=D,C.setOutputCheck=B;let P={};function F(e,t){return{field:e,name:t}}function U(s,o){return pxt.Util.values(s.byQName).filter(e=>{return 4===e.kind&&e.attributes.fixedInstance&&(t=s,(e=e.retType)==(i=o)||!(!(t=t.byQName[e])||!t.extendsTypes)&&0<=t.extendsTypes.indexOf(i));var t,i}).sort((e,t)=>(t.attributes.weight||50)-(e.attributes.weight||50))}C.getFixedInstanceDropdownValues=U,C.generateIcons=function(e){let t=new pxt.ImageConverter;e.forEach(e=>{e.attributes.jresURL&&!e.attributes.iconURL&&pxt.Util.startsWith(e.attributes.jresURL,"data:image/x-mkcd-f")&&(e.attributes.iconURL=t.convert(e.attributes.jresURL))})},C.setVarFieldValue=function(e,t,i){var s=e.getField(t),o=e.workspace.getVariableMap().getAllVariables();let n=!1;if(o&&o.length)for(let e=0;e<o.length;e++){var r=o[e];r.getName()===i&&(s.setValue(r.getId()),n=!0)}n||(s.initModel(),(t=s.getVariable()).setName(i),s.setValue(t.getId()))}},{"./builtins/functions":3,"./builtins/lists":4,"./builtins/logic":5,"./builtins/loops":6,"./builtins/math":7,"./builtins/misc":8,"./builtins/text":9,"./builtins/variables":10,"./codecardRenderer":11,"./compiler/compiler":12,"./compiler/util":15,"./composableMutations":17,"./constants":18,"./contextMenu":21,"./copyPaste":23,"./external":25,"./fields":70,"./fields/field_dropdown":34,"./help":72,"./legacyMutations":76,"./plugins/duplicateOnDrag":91,"./plugins/functions":111,"./plugins/functions/utils":114,"./plugins/newVariableField/fieldVariable":122,"./toolbox":139,blockly:175}],78:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.monkeyPatchBlockSvg=void 0;let o=e("blockly"),n=e("../fields/field_imagenotext"),r=e("../plugins/renderer/constants");i.monkeyPatchBlockSvg=function(){let s=o.BlockSvg.prototype.setCollapsed;o.BlockSvg.prototype.setCollapsed=function(e){var t,i;e!==this.isCollapsed()&&(s.call(this,e),this.isCollapsed())&&(t=this.getInput(o.constants.COLLAPSED_INPUT_NAME),i=r.ConstantProvider.EXPAND_IMAGE_DATAURI)&&t.appendField(new n.FieldImageNoText(i,24,24,"",()=>{this.setCollapsed(!1)},!1))}}},{"../fields/field_imagenotext":38,"../plugins/renderer/constants":126,blockly:175}],79:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.monkeyPatchGesture=void 0;let s=e("blockly");i.monkeyPatchGesture=function(){if(pxt.BrowserUtils.isAndroid()&&pxt.BrowserUtils.isInGame()){let t=s.Gesture.prototype.doStart,i=(s.Gesture.prototype.doStart=function(e){this.id?(e.stopPropagation(),e.preventDefault()):(this.id=e.pointerId,t.call(this,e))},s.Gesture.prototype.bindMouseEvents=function(e){this.boundEvents_||(this.boundEvents_=[]);let i=e=>{var t=new PointerEvent(e.type,Object.assign(Object.assign({},e),{clientX:e.clientX,clientY:e.clientY,pointerId:this.id}));return t.stopPropagation=()=>e.stopPropagation(),t.stopImmediatePropagation=()=>e.stopImmediatePropagation(),t.preventDefault=()=>e.preventDefault(),t};var t=t=>e=>{if("pointerup"===e.type)e=i(e);else if(e.pointerId!==this.id)return;try{t.call(this,e)}catch(e){pxt.error("Uncaught error while executing gesture handler",e),this.cancel(),this.dispose()}};this.boundEvents_.push(s.browserEvents.conditionalBind(document,"pointerdown",null,t(this.handleStart),!0)),this.boundEvents_.push(s.browserEvents.conditionalBind(document,"pointermove",null,t(this.handleMove),!0)),this.boundEvents_.push(s.browserEvents.conditionalBind(document,"pointerup",null,t(this.handleUp),!0)),e.preventDefault(),e.stopPropagation()},s.Gesture.prototype.dispose);s.Gesture.prototype.dispose=function(){if(i.call(this),this.boundEvents_){for(var e of this.boundEvents_)s.browserEvents.unbind(e);this.boundEvents_.length=0}}}}},{blockly:175}],80:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.monkeyPatchGrid=void 0;let o=e("blockly");i.monkeyPatchGrid=function(){let e,t,l=null==(e=pxt.appTarget.appTheme.blocklyOptions)?void 0:e.grid;if(null!=(t=null==l?void 0:l.image)&&t.path){let n=[],r=(o.Grid.createDom=function(e,t,i,s){e="blocklyGridPattern"+e,i=o.utils.dom.createSvgElement(o.utils.Svg.PATTERN,{id:e,patternUnits:"userSpaceOnUse",width:l.image.width,height:l.image.height},i);return n.push(e),o.utils.dom.createSvgElement(o.utils.Svg.IMAGE,{width:l.image.width,height:l.image.height,opacity:l.image.opacity},i).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l.image.path),s&&s.style.setProperty("--blocklyGridPattern",`url(#${i.id})`),i},o.Grid.prototype.update);o.Grid.prototype.update=function(e){r.call(this,e);var t,i,s=[];for(t of n){var o=document.getElementById(t);o?(o.setAttribute("width",l.image.width),o.setAttribute("height",l.image.height),o.setAttribute("patternTransform","scale("+e+")")):s.push(t)}for(i of s)n.splice(n.indexOf(i),1)}}}},{blockly:175}],81:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.applyMonkeyPatches=void 0;let s=e("./blockSvg"),o=e("./gesture"),n=e("./grid");i.applyMonkeyPatches=function(){(0,s.monkeyPatchBlockSvg)(),(0,n.monkeyPatchGrid)(),(0,o.monkeyPatchGesture)()}},{"./blockSvg":78,"./gesture":79,"./grid":80}],82:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let m=e("blockly"),_=e("../functions/constants"),s=e("../../fields/field_imagenotext");m.Blocks.lists_create_with=Object.assign(Object.assign({},{valueConnections_:[],horizontalAfter_:3,itemCount_:3,mutationToDom:function(){var e=m.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),this.horizontalAfter_&&e.setAttribute("horizontalafter",this.horizontalAfter_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10);e=e.getAttribute("horizontalafter");e&&(this.horizontalAfter_=parseInt(e,10)),this.updateShape_()},storeConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreConnections_:function(){var t;for(let e=0;e<this.itemCount_;e++)null!=(t=this.valueConnections_[e])&&t.reconnect(this,"ADD"+e)},addItem_:function(){this.storeConnections_();if(this.update_(()=>{this.itemCount_++}),this.restoreConnections_(),1<this.itemCount_){var e=this.getInput("ADD0");if(e&&e.connection.targetConnection){var t=this.getInput("ADD"+(this.itemCount_-1)),i=e.connection.getShadowDom(),s=i&&i.getAttribute("type");if(s){var o=g("shadow",s),n=d(i,"value");for(let e=0;e<n.length;e++){var r=n[e],l=r.getAttribute("name"),r=d(r,"shadow")[0];p(o,l,r&&r.getAttribute("type"))}t.connection.setShadowDom(o)}var i=e.connection.targetConnection,a=i&&i.getSourceBlock(),e=a&&a.type;if(e&&e!==s){var c=g("block",e);if(a)if(e===_.FUNCTION_CALL_OUTPUT_BLOCK_TYPE){i=m.utils.xml.createElement("mutation");i.setAttribute("name",a.getName()),c.appendChild(i)}else if(a.inputList)for(let e=0;e<a.inputList.length;e++){var u=a.inputList[e],h=u.connection&&u.connection.getShadowDom(),h=h&&h.getAttribute("type");p(c,u.name,h)}s=m.Xml.domToBlock(c,this.workspace);t.connection.connect(s.outputConnection)}else t.connection.setShadowDom(t.connection.getShadowDom())}}function d(t,i){var s=[];if(t&&t.children)for(let e=0;e<t.children.length;e++){var o=t.children[e];o.tagName===i&&s.push(o)}return s}function p(e,t,i){var s;t&&i&&((s=m.utils.xml.createElement("value")).setAttribute("name",t),s.appendChild(g("shadow",i)),e.appendChild(s))}function g(e,t){e=m.utils.xml.createElement(e);return e.setAttribute("type",t),e.setAttribute("id",m.utils.idGenerator.genUid()),e}},removeItem_:function(){this.storeConnections_();this.update_(()=>{this.itemCount_--}),this.restoreConnections_()},update_:function(e){m.Events.setGroup(!0);let t=this;var i=t.mutationToDom(),i=i&&m.Xml.domToText(i);e&&e.call(this),this.updateShape_(),t instanceof m.BlockSvg&&t.initSvg();let s=m.Events.getGroup();e=t.mutationToDom(),e=e&&m.Xml.domToText(e);i!=e&&(m.Events.fire(new m.Events.BlockChange(t,"mutation",null,i,e)),setTimeout(function(){m.Events.setGroup(s),t.bumpNeighbours(),m.Events.setGroup(!1)},m.config.bumpDelay)),t.rendered&&t instanceof m.BlockSvg&&t.queueRender(),m.Events.setGroup(!1)},updateShape_:function(){var e=()=>{this.removeItem_()};this.itemCount_?(this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(m.Msg.LISTS_CREATE_WITH_INPUT_WITH)):(this.getInput("TITLE")&&this.removeInput("TITLE"),this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(m.Msg.LISTS_CREATE_EMPTY_TITLE));let t=0;for(t=0;t<this.itemCount_;t++)this.getInput("ADD"+t)||this.appendValueInput("ADD"+t);for(;this.getInput("ADD"+t);)this.removeInput("ADD"+t),t++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");var i=this.appendDummyInput("BUTTONS"),e=(0<this.itemCount_&&i.appendField(new s.FieldImageNoText(this.REMOVE_IMAGE_DATAURI,24,24,"*",e,!1)),i.appendField(new s.FieldImageNoText(this.ADD_IMAGE_DATAURI,24,24,"*",()=>{this.addItem_()},!1)),this.itemCount_<=this.horizontalAfter_);this.setInputsInline(e),this.workspace instanceof m.WorkspaceSvg&&(i=this.workspace.getRenderer(),this.setOutputShape(e?i.getConstants().SHAPES.ROUND:i.getConstants().SHAPES.SQUARE))}}),{init:function(){var e;m.Extensions.apply("inline-svgs",this,!1),this.setHelpUrl(m.Msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.updateShape_(),this.setOutput(!0,"Array"),this.workspace instanceof m.WorkspaceSvg&&(e=this.workspace.getRenderer(),this.setOutputShape(e.getConstants().SHAPES.ROUND)),this.setInputsInline(!0),this.setTooltip(m.Msg.LISTS_CREATE_WITH_TOOLTIP)}})},{"../../fields/field_imagenotext":38,"../functions/constants":105,blockly:175}],83:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./createList"),i)},{"./createList":82}],84:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.CommentIcon=void 0;let s=e("blockly"),o=e("./textinput_bubble"),n=e("../../fields"),r=s.Events,l="~commentOffsetX",a="~commentOffsetY";class c extends s.icons.Icon{constructor(e){super(e),this.sourceBlock=e,this.textInputBubble=null,this.text="",this.bubbleSize=new s.utils.Size(160,80),this.bubbleVisiblity=!1}getType(){return c.TYPE}initView(e){this.svgRoot||(super.initView(e),s.utils.dom.createSvgElement(s.utils.Svg.PATH,{class:"blocklyIconShape",d:"m 2,2 0,9.2211 3.0026599,0 1.6008929,1.5989 1.8138195,-1.5989 6.6046683,0 0,-9.2211 -13.0220406,0 z",style:"fill: #fff;"},this.svgRoot),s.utils.dom.createSvgElement("rect",{class:"blocklyIconSymbol",x:"4",y:"8",height:"1",width:"6",style:"fill: #575E75;"},this.svgRoot),s.utils.dom.createSvgElement(s.utils.Svg.RECT,{class:"blocklyIconSymbol",x:"4",y:"6",height:"1",width:"6",style:"fill: #575E75;"},this.svgRoot),s.utils.dom.createSvgElement("rect",{class:"blocklyIconSymbol",x:"4",y:"4",height:"1",width:"8",style:"fill: #575E75;"},this.svgRoot),s.utils.dom.addClass(this.svgRoot,"blockly-icon-comment"))}dispose(){var e;super.dispose(),null!=(e=this.textInputBubble)&&e.dispose()}getWeight(){return c.WEIGHT}getSize(){return new s.utils.Size(17,17)}applyColour(){super.applyColour();var e,t=this.sourceBlock.style.colourPrimary,i=this.sourceBlock.style.colourTertiary;null!=(e=this.textInputBubble)&&e.setColour(t,i)}async updateEditable(){super.updateEditable(),this.bubbleIsVisible()&&(await this.setBubbleVisible(!1),await this.setBubbleVisible(!0))}onLocationChange(e){super.onLocationChange(e);var t,e=this.getAnchorLocation();null!=(t=this.textInputBubble)&&t.setAnchorLocation(e)}setText(e){this.text||e||this.clearSavedOffsetData();var t=this.text;r.fire(new(r.get(r.BLOCK_CHANGE))(this.sourceBlock,"comment",null,t,e)),this.text=e,null!=(t=this.textInputBubble)&&t.setText(this.text)}getText(){return this.text}setBubbleSize(e){this.bubbleSize=e,null!=(e=this.textInputBubble)&&e.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(e){var t;this.text=null!=(t=e.text)?t:"",this.bubbleSize=new s.utils.Size(null!=(t=e.width)?t:160,null!=(t=e.height)?t:80),this.bubbleVisiblity=null!=(t=e.pinned)&&t,this.setBubbleVisible(this.bubbleVisiblity)}setBubbleLocation(e){}getBubbleLocation(){var e;return!this.bubbleIsVisible()||null==(e=this.textInputBubble)?void 0:e.getRelativeToSurfaceXY()}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){var e;this.textInputBubble&&(e=this.textInputBubble.getText(),this.text!==e)&&(r.fire(new(r.get(r.BLOCK_CHANGE))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}onPositionChange(){var e;this.textInputBubble&&(e=this.textInputBubble.getPositionRelativeToAnchor(),(0,n.setBlockDataForField)(this.sourceBlock,l,e.x+""),(0,n.setBlockDataForField)(this.sourceBlock,a,e.y+""))}bubbleIsVisible(){return this.bubbleVisiblity}async setBubbleVisible(e){this.bubbleVisiblity===e||e&&this.textInputBubble||(e||this.textInputBubble)&&(this.bubbleVisiblity=e,!this.sourceBlock.rendered||this.sourceBlock.isInFlyout||this.sourceBlock.isInsertionMarker()||(await s.renderManagement.finishQueuedRenders(),!this.sourceBlock.rendered)||this.sourceBlock.isInFlyout||this.sourceBlock.isInsertionMarker()||(e?(this.sourceBlock.isEditable()?this.showEditableBubble():this.showNonEditableBubble(),this.applyColour()):this.hideBubble(),this.sourceBlock.isEditable()&&r.fire(new(r.get(r.BUBBLE_OPEN))(this.sourceBlock,e,"comment"))))}getBubble(){return this.textInputBubble}showEditableBubble(){var e=this.getSavedOffsetData();this.textInputBubble=new o.TextInputBubble(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.addTextChangeListener(()=>this.onTextChange()),this.textInputBubble.addSizeChangeListener(()=>this.onSizeChange()),this.textInputBubble.addPositionChangeListener(()=>this.onPositionChange()),this.textInputBubble.setDeleteHandler(()=>{this.setBubbleVisible(!1),this.sourceBlock.setCommentText(null),this.clearSavedOffsetData()}),this.textInputBubble.setCollapseHandler(()=>{this.setBubbleVisible(!1)}),e&&this.textInputBubble.setPositionRelativeToAnchor(e.x,e.y),s.getFocusManager().focusNode(this.textInputBubble)}showNonEditableBubble(){var e=this.getSavedOffsetData();this.textInputBubble=new o.TextInputBubble(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect(),!0),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.textInputBubble.setCollapseHandler(()=>{this.setBubbleVisible(!1)}),e&&this.textInputBubble.setPositionRelativeToAnchor(e.x,e.y),s.getFocusManager().focusNode(this.textInputBubble)}hideBubble(){var e;null!=(e=this.textInputBubble)&&e.dispose(),this.textInputBubble=null,s.getFocusManager().focusNode(this.getSourceBlock())}getAnchorLocation(){return s.utils.Coordinate.sum(this.workspaceLocation,new s.utils.Coordinate(8.5,8.5))}getBubbleOwnerRect(){var e=this.sourceBlock.getSvgRoot().getBBox();return new s.utils.Rect(e.y,e.y+e.height,e.x,e.x+e.width)}getSavedOffsetData(){var e=(0,n.getBlockDataForField)(this.sourceBlock,l),t=(0,n.getBlockDataForField)(this.sourceBlock,a);return e&&t?new s.utils.Coordinate(parseFloat(e),parseFloat(t)):new s.utils.Coordinate(16,16)}clearSavedOffsetData(){(0,n.deleteBlockDataForField)(this.sourceBlock,l),(0,n.deleteBlockDataForField)(this.sourceBlock,a)}}(i.CommentIcon=c).TYPE=s.icons.IconType.COMMENT,c.WEIGHT=3,s.icons.registry.unregister(c.TYPE.toString()),s.icons.registry.register(c.TYPE,c)},{"../../fields":70,"./textinput_bubble":87,blockly:175}],85:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Bubble=void 0;let a=e("blockly");var o=a.utils.dom;class n{constructor(e,t,i,s){this.workspace=e,this.anchor=t,this.ownerRect=i,this.size=new a.utils.Size(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeTop=0,this.relativeLeft=0,this.dragStrategy=new a.dragging.BubbleDragStrategy(this,this.workspace),this.id=a.utils.idGenerator.getNextUniqueId(),this.svgRoot=o.createSvgElement(a.utils.Svg.G,{class:"blocklyBubble"},e.getBubbleCanvas());t=o.createSvgElement(a.utils.Svg.G,{},this.svgRoot);this.tail=o.createSvgElement(a.utils.Svg.LINE,{"stroke-width":"3","stroke-linecap":"round"},t),this.background=o.createSvgElement(a.utils.Svg.RECT,{class:"blocklyDraggable","stroke-width":"3",x:0,y:0},t),this.contentContainer=o.createSvgElement(a.utils.Svg.G,{},this.svgRoot),this.topBar=o.createSvgElement(a.utils.Svg.RECT,{class:"blocklyCommentTopbarBackground",x:n.BORDER_WIDTH,y:n.BORDER_WIDTH},t),this.deleteIcon=o.createSvgElement(a.utils.Svg.IMAGE,{class:"blocklyDeleteIcon",href:e.options.pathToMedia+"delete-icon.svg"},t),this.collapseIcon=o.createSvgElement(a.utils.Svg.IMAGE,{class:"blocklyFoldoutIcon",href:e.options.pathToMedia+"foldout-icon.svg"},t),this.focusableElement=null!=s?s:this.svgRoot,this.focusableElement.setAttribute("id",this.id),a.browserEvents.conditionalBind(this.background,"pointerdown",this,this.onMouseDown),a.browserEvents.conditionalBind(this.topBar,"pointerdown",this,this.onMouseDown),a.browserEvents.conditionalBind(this.collapseIcon,"pointerdown",this,this.onCollapseDown),a.browserEvents.conditionalBind(this.deleteIcon,"pointerdown",this,this.onDeleteDown)}dispose(){this.disposed||(o.removeNode(this.svgRoot),this.disposed=!0,this.isDragDelete&&this.deleteHandler&&this.deleteHandler())}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getPositionRelativeToAnchor(){return new a.utils.Coordinate(this.relativeLeft,this.relativeTop)}getSize(){return this.size}setSize(e,t=!1){var i=this.topBar.getBBox(),s=this.deleteIcon.getBBox(),o=this.collapseIcon.getBBox();e.width=Math.max(e.width,n.MIN_SIZE),e.height=Math.max(e.height,n.MIN_SIZE),this.size=e,this.background.setAttribute("width",""+e.width),this.background.setAttribute("height",""+e.height),this.topBar.setAttribute("width",""+(e.width-n.DOUBLE_BORDER)),this.updateDeleteIconPosition(e,i,s),this.updateFoldoutIconPosition(i,o),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e,t){this.colour=e,this.tail.setAttribute("stroke",t||e),this.background.setAttribute("fill",t||e),this.background.setAttribute("stroke",t||e),this.svgRoot.setAttribute("style","--commentBorderColour: "+e)}onMouseDown(e){var t;null!=(t=this.workspace.getGesture(e))&&t.handleBubbleStart(e,this),a.common.setSelected(this),a.getFocusManager().focusNode(this)}positionRelativeToAnchor(){let e=this.anchor.x;this.workspace.RTL?e-=this.relativeLeft+this.size.width:e+=this.relativeLeft;var t=this.relativeTop+this.anchor.y;this.moveTo(e,t)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new a.utils.Rect(0,0,0,0)){var t=this.workspace.getMetricsManager().getViewMetrics(!0),i=this.getOptimalRelativeLeft(t),s=this.getOptimalRelativeTop(t),o={x:i,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},n={x:-this.size.width-30,y:s},s={x:e.getWidth(),y:s},i={x:i,y:e.getHeight()},r=e.getWidth()<e.getHeight()?s:i,e=e.getWidth()<e.getHeight()?i:s,i=this.getOverlap(o,t),s=this.getOverlap(n,t),l=this.getOverlap(r,t),t=this.getOverlap(e,t),t=Math.max(i,s,l,t);i===t?(this.relativeLeft=o.x,this.relativeTop=o.y):s===t?(this.relativeLeft=n.x,this.relativeTop=n.y):l===t?(this.relativeLeft=r.x,this.relativeTop=r.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,t){var e={x:this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x,y:e.y+this.anchor.y},i={x:e.x+this.size.width,y:e.y+this.size.height},s={x:t.left,y:t.top},t={x:t.left+t.width,y:t.top+t.height},o=Math.min(i.x,t.x)-Math.max(e.x,s.x),i=Math.min(i.y,t.y)-Math.max(e.y,s.y);return Math.max(0,Math.min(1,o*i/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;var i,s;return this.size.width>e.width||(e=this.getWorkspaceViewRect(e),this.workspace.RTL?(i=this.anchor.x-t)-this.size.width<e.left?t=-(e.left-this.anchor.x+this.size.width):i>e.right&&(t=-(e.right-this.anchor.x)):(s=(i=t+this.anchor.x)+this.size.width,i<e.left?t=e.left-this.anchor.x:s>e.right&&(t=e.right-this.anchor.x-this.size.width))),t}getOptimalRelativeTop(e){let t=-this.size.height/4;var i,s;return this.size.height>e.height||(i=(s=this.anchor.y+t)+this.size.height,s<(s=this.getWorkspaceViewRect(e)).top?t=s.top-this.anchor.y:i>s.bottom&&(t=s.bottom-this.anchor.y-this.size.height)),t}getWorkspaceViewRect(e){var t=e.top,i=e.top+e.height;let s=e.left,o=e.left+e.width;return i-=this.getScrollbarThickness(),this.workspace.RTL?s-=this.getScrollbarThickness():o-=this.getScrollbarThickness(),new a.utils.Rect(t,i,s,o)}getScrollbarThickness(){return a.Scrollbar.scrollbarThickness/this.workspace.scale}renderTail(){var e=this.size.width/2,t=this.size.height/2,i=-this.relativeLeft,s=-this.relativeTop,o=Math.atan2(t-s,e-i);i+=n.ANCHOR_RADIUS*Math.cos(o),s+=n.ANCHOR_RADIUS*Math.sin(o),this.tail.setAttribute("x1",e+""),this.tail.setAttribute("y1",t+""),this.tail.setAttribute("x2",i+""),this.tail.setAttribute("y2",s+"")}bringToFront(){var e=null==(e=this.svgRoot)?void 0:e.parentNode;return!(!this.svgRoot||(null==e?void 0:e.lastChild)===this.svgRoot||(null!=e&&e.appendChild(this.svgRoot),0))}getRelativeToSurfaceXY(){return new a.utils.Coordinate(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.workspace.RTL?this.relativeLeft=this.anchor.x-e.x-this.size.width:this.relativeLeft=e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){(this.isDragDelete=e)?o.addClass(this.getSvgRoot(),"blocklyDraggingDelete"):o.removeClass(this.getSvgRoot(),"blocklyDraggingDelete")}isDeletable(){return!1}showContextMenu(e){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){a.common.fireSelectedEvent(this)}unselect(){a.common.fireSelectedEvent(null)}getFocusableElement(){return this.focusableElement}getFocusableTree(){return this.workspace}onNodeFocus(){this.select(),this.bringToFront()}onNodeBlur(){this.unselect()}canBeFocused(){return!0}contentTop(){var e=this.topBar.getBBox();return n.BORDER_WIDTH+e.height}setDeleteHandler(e){this.deleteHandler=e}setCollapseHandler(e){this.collapseHandler=e}onDeleteDown(e){a.browserEvents.isRightButton(e)||this.deleteHandler&&(e.preventDefault(),this.deleteHandler()),e.stopPropagation()}onCollapseDown(e){a.browserEvents.isRightButton(e)||this.collapseHandler&&(e.preventDefault(),this.collapseHandler()),e.stopPropagation()}updateDeleteIconPosition(e,t,i){t=this.calcDeleteMargin(t,i);this.deleteIcon.setAttribute("y",""+t),this.deleteIcon.setAttribute("x",""+(e.width-i.width-t))}updateFoldoutIconPosition(e,t){e=this.calcFoldoutMargin(e,t);this.collapseIcon.setAttribute("y",""+e),this.collapseIcon.setAttribute("x",""+e)}calcDeleteMargin(e,t){return(e.height-t.height)/2+n.BORDER_WIDTH}calcFoldoutMargin(e,t){return(e.height-t.height)/2+n.BORDER_WIDTH}}(e=i.Bubble=n).BORDER_WIDTH=0,n.DOUBLE_BORDER=2*e.BORDER_WIDTH,n.MIN_SIZE=e.DOUBLE_BORDER,n.ANCHOR_RADIUS=8,a.Css.register(`
.blocklyBubble .blocklyDeleteIcon, .blocklyBubble .blocklyFoldoutIcon {
    filter: grayscale(100%) brightness(100000);
}

.blocklyBubble .blocklyTextarea.blocklyText {
    color: #575E75;
}
`)},{blockly:175}],86:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./blockComment"),i)},{"./blockComment":84}],87:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.TextInputBubble=void 0;let o=e("./bubble.js"),n=e("blockly");var r=n.utils.dom,l=n.browserEvents;class a extends o.Bubble{constructor(e,t,i,s){super(e,t,i,a.createTextArea()),this.workspace=e,this.anchor=t,this.ownerRect=i,this.readOnly=s,this.resizePointerUpListener=null,this.resizePointerMoveListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.positionChangeListeners=[],this.text="",this.DEFAULT_SIZE=new n.utils.Size(160+o.Bubble.DOUBLE_BORDER,80+o.Bubble.DOUBLE_BORDER),this.MIN_SIZE=new n.utils.Size(45+o.Bubble.DOUBLE_BORDER,20+o.Bubble.DOUBLE_BORDER),r.addClass(this.svgRoot,"blocklyTextInputBubble"),this.textArea=this.getFocusableElement(),this.inputRoot=this.createEditor(this.contentContainer,this.textArea),this.resizeGroup=this.createResizeHandle(this.svgRoot,e),this.setSize(this.DEFAULT_SIZE,!0),s&&(this.deleteIcon.style.display="none"),l.conditionalBind(this.textArea,"keydown",this,this.onKeyDown)}getText(){return this.text}moveTo(e,t){super.moveTo(e,t),this.onPositionChange()}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}addPositionChangeListener(e){this.positionChangeListeners.push(e)}static createTextArea(){var e=document.createElementNS(r.HTML_NS,"textarea");return e.className="blocklyTextarea blocklyText",e}createEditor(e,t){let i=r.createSvgElement(n.utils.Svg.FOREIGNOBJECT,{x:o.Bubble.BORDER_WIDTH,y:this.contentTop()},e);setTimeout(()=>{i.setAttribute("y",this.contentTop()+"")});e=document.createElementNS(r.HTML_NS,"body");return e.setAttribute("xmlns",r.HTML_NS),e.className="blocklyMinimalBody",t.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),e.appendChild(t),i.appendChild(e),this.bindTextAreaEvents(t),i}bindTextAreaEvents(e){l.conditionalBind(e,"wheel",this,e=>{e.stopPropagation()}),l.conditionalBind(e,"pointerdown",this,e=>{e.stopPropagation(),n.Touch.clearTouchIdentifier()}),l.conditionalBind(e,"change",this,this.onTextChange)}createResizeHandle(e,t){t=r.createSvgElement(n.utils.Svg.IMAGE,{class:"blocklyResizeHandle",href:t.options.pathToMedia+"resize-handle.svg"},e);return l.conditionalBind(t,"pointerdown",this,this.onResizePointerDown),t}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height+this.contentTop());var i=e.width-o.Bubble.DOUBLE_BORDER,s=e.height-this.contentTop()-o.Bubble.BORDER_WIDTH,s=(this.inputRoot.setAttribute("width",""+i),this.inputRoot.setAttribute("height",""+s),this.textArea.style.width="100%",this.textArea.style.height="100%",this.resizeGroup.getBBox());this.workspace.RTL?this.resizeGroup.setAttribute("transform",`translate(${o.Bubble.BORDER_WIDTH}, ${e.height-o.Bubble.BORDER_WIDTH-s.height}) scale(-1 1)`):this.resizeGroup.setAttribute("transform",`translate(${i-s.width}, ${e.height-o.Bubble.BORDER_WIDTH-s.height})`),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}isDeletable(){return!this.readOnly}onResizePointerDown(e){this.bringToFront(),l.isRightButton(e)||(this.workspace.startDrag(e,new n.utils.Coordinate(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=l.conditionalBind(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=l.conditionalBind(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){n.Touch.clearTouchIdentifier(),this.resizePointerUpListener&&(l.unbind(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(l.unbind(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=this.workspace.moveDrag(e);this.setSize(new n.utils.Size(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onTextChange(){this.text=this.textArea.value;for(var e of this.textChangeListeners)e()}onSizeChange(){for(var e of this.sizeChangeListeners)e()}onPositionChange(){for(var e of this.positionChangeListeners)e()}onKeyDown(e){"Escape"===e.key&&(this.collapseHandler(),e.stopPropagation())}}i.TextInputBubble=a,n.Css.register(`
.blocklyTextInputBubble .blocklyTextarea {
  background-color: var(--commentFillColour);
  border: 0;
  display: block;
  margin: 0;
  outline: 0;
  padding: 3px;
  resize: none;
  text-overflow: hidden;
}
`)},{"./bubble.js":85,blockly:175}],88:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.DuplicateOnDragConnectionChecker=void 0;let r=e("blockly"),o=e("./duplicateOnDrag"),n=e("../functions/utils"),l=[];l[r.ConnectionType.INPUT_VALUE]=r.ConnectionType.OUTPUT_VALUE,l[r.ConnectionType.OUTPUT_VALUE]=r.ConnectionType.INPUT_VALUE,l[r.ConnectionType.NEXT_STATEMENT]=r.ConnectionType.PREVIOUS_STATEMENT,l[r.ConnectionType.PREVIOUS_STATEMENT]=r.ConnectionType.NEXT_STATEMENT;class s extends r.ConnectionChecker{doDragChecks(e,t,i){var s;return!!super.doDragChecks(e,t,i)&&!((s=t.targetBlock())&&(0,o.shouldDuplicateOnDrag)(s)&&(!s.isShadow()||!(0,o.isAllowlistedShadow)(s))||!(0,n.doArgumentReporterDragChecks)(e,t,i))}doSafetyChecks(e,t){if(!e||!t)return r.Connection.REASON_TARGET_NULL;let i,s,o,n;return e.isSuperior()?(i=e.getSourceBlock(),s=t.getSourceBlock(),o=e,n=t):(s=e.getSourceBlock(),i=t.getSourceBlock(),n=e,o=t),i===s?r.Connection.REASON_SELF_CONNECTION:n.type!==l[o.type]?r.Connection.REASON_WRONG_TYPE:i.workspace!==s.workspace?r.Connection.REASON_DIFFERENT_WORKSPACES:n.type===r.ConnectionType.OUTPUT_VALUE&&s.previousConnection&&s.previousConnection.isConnected()||n.type===r.ConnectionType.PREVIOUS_STATEMENT&&s.outputConnection&&s.outputConnection.isConnected()?r.Connection.REASON_PREVIOUS_AND_OUTPUT:r.Connection.CAN_CONNECT}}i.DuplicateOnDragConnectionChecker=s},{"../functions/utils":114,"./duplicateOnDrag":90,blockly:175}],89:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setDuplicateOnDragStrategy=i.DuplicateOnDragStrategy=void 0;let u=e("blockly"),h=e("./duplicateOnDrag");var s=u.Events,o=u.utils.Coordinate,n=u.utils.dom;class r{constructor(e){this.block=e,this.startParentConn=null,this.startChildConn=null,this.startLoc=null,this.connectionCandidate=null,this.connectionPreviewer=null,this.dragging=!1,this.originalEventGroup="",this.dragOffset=new o(0,0),this.workspace=e.workspace}isMovable(){var e;return this.block.isShadow()?null!=(e=null==(e=this.block.getParent())?void 0:e.isMovable())&&e:this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.options.readOnly&&!this.block.isInFlyout}startDrag(e){var t;this.block.isShadow()&&!(0,h.isAllowlistedShadow)(this.block)?this.startDraggingShadow(e):(this.dragging=!0,s.getGroup()||s.setGroup(!0),this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY(),t=u.registry.getClassFromOptions(u.registry.Type.CONNECTION_PREVIEWER,this.workspace.options),this.connectionPreviewer=new t(this.block),n.startTextWidthCache(),this.workspace.setResizesEnabled(!1),u.blockAnimations.disconnectUiStop(),t=!!e&&(e.altKey||e.ctrlKey||e.metaKey),this.shouldDisconnect(t)&&this.disconnectBlock(t),this.block.setDragging(!0),null!=(e=this.workspace.getLayerManager())&&e.moveToDragLayer(this.block))}startDraggingShadow(e){var t=this.block.getParent();if(!t)throw new Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=o.difference(t.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),t.startDrag(e)}shouldDisconnect(e){return!!(this.block.getParent()||e&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(e){let t,i,s,o,n,r,l;var a=this.block.isShadow();if(a&&this.block.setShadow(!1),(0,h.shouldDuplicateOnDrag)(this.block)){var c=this.block.outputConnection;if(null==c||!c.targetConnection)return;l=u.Xml.blockToDom(this.block,!0),a||(n=u.Xml.domToBlock(l,this.block.workspace)),r=c.targetConnection}this.startParentConn=null!=(i=null==(t=this.block.outputConnection)?void 0:t.targetConnection)?i:null==(s=this.block.previousConnection)?void 0:s.targetConnection,e&&(this.startChildConn=null==(o=this.block.nextConnection)?void 0:o.targetConnection),r&&a&&r.setShadowDom(l),this.block.unplug(e),u.blockAnimations.disconnectUiEffect(this.block),(0,h.updateDuplicateOnDragState)(this.block),r&&n&&r.connect(n.outputConnection)}fireDragStartEvent(){var e=new(s.get(s.BLOCK_DRAG))(this.block,!0,this.block.getDescendants(!1));s.fire(e)}fireDragEndEvent(){var e=new(s.get(s.BLOCK_DRAG))(this.block,!1,this.block.getDescendants(!1));s.fire(e)}fireMoveEvent(){var e;this.block.isDeadOrDying()||((e=new(s.get(s.BLOCK_MOVE))(this.block)).setReason(["drag"]),e.oldCoordinate=this.startLoc,e.recordNew(),s.fire(e))}drag(e){var t;this.block.isShadow()?null!=(t=this.block.getParent())&&t.drag(o.sum(e,this.dragOffset)):(this.block.moveDuringDrag(e),this.updateConnectionPreview(this.block,o.difference(e,this.startLoc)))}updateConnectionPreview(e,t){var i,s=this.connectionCandidate,o=this.getConnectionCandidate(e,t);o?(t=s&&this.currCandidateIsBetter(s,t,o)?s:o,{local:s,neighbour:o}=this.connectionCandidate=t,t=s.type===u.ConnectionType.OUTPUT_VALUE||s.type===u.ConnectionType.PREVIOUS_STATEMENT,i=o.isConnected()&&!o.targetBlock().isInsertionMarker(),t&&i&&!this.orphanCanConnectAtEnd(e,o.targetBlock(),s.type)?this.connectionPreviewer.previewReplacement(s,o,o.targetBlock()):this.connectionPreviewer.previewConnection(s,o)):(this.connectionPreviewer.hidePreview(),this.connectionCandidate=null)}orphanCanConnectAtEnd(e,t,i){i=i===u.ConnectionType.OUTPUT_VALUE?t.outputConnection:t.previousConnection;return!!u.Connection.getConnectionForOrphanedConnection(e,i)}currCandidateIsBetter(e,t,i){var{local:e,neighbour:s}=e,e=new o(e.x,e.y),s=new o(s.x,s.y),e=o.distance(o.sum(e,t),s);return i.distance>e-u.config.currentConnectionPreference}getConnectionCandidate(e,t){var i,e=this.getLocalConnections(e);let s=this.connectionCandidate?u.config.connectingSnapRadius:u.config.snapRadius,o=null;for(i of e){var{connection:n,radius:r}=i.closest(s,t);n&&(o={local:i,neighbour:n,distance:r},s=r)}return o}getLocalConnections(e){var t=e.getConnections_(!1),i=e.lastConnectionInStack(!0);return i&&i!==e.nextConnection&&t.push(i),t}endDrag(e){var t;this.block.isShadow()?null!=(t=this.block.getParent())&&t.endDrag(e):(this.originalEventGroup=s.getGroup(),this.fireDragEndEvent(),this.fireMoveEvent(),n.stopTextWidthCache(),u.blockAnimations.disconnectUiStop(),this.connectionPreviewer.hidePreview(),!this.block.isDeadOrDying()&&this.dragging&&(null!=(t=this.workspace.getLayerManager())&&t.moveOffDragLayer(this.block,u.layers.BLOCK),this.block.setDragging(!1)),this.connectionCandidate?(this.applyConnections(this.connectionCandidate),this.disposeStep()):this.block.queueRender().then(()=>this.disposeStep()))}disposeStep(){var e=s.getGroup();s.setGroup(this.originalEventGroup),this.block.snapToGrid(),this.connectionPreviewer.dispose(),this.workspace.setResizesEnabled(!0),s.setGroup(e)}applyConnections(e){var{local:e,neighbour:t}=e;e.connect(t);let i=e.isSuperior()?t:e,s=this.block.getRootBlock();u.renderManagement.finishQueuedRenders().then(()=>{u.blockAnimations.connectionUiEffect(i.getSourceBlock()),setTimeout(()=>{s.bringToFront()},0)})}revertDrag(){var e;if(this.block.isShadow())null!=(e=this.block.getParent())&&e.revertDrag();else{if(null!=(e=this.startChildConn)&&e.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case u.ConnectionType.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case u.ConnectionType.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else this.block.moveTo(this.startLoc,["drag"]),null!=(e=this.workspace.getLayerManager())&&e.moveOffDragLayer(this.block,50),u.bumpObjects.bumpIntoBounds(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block);this.startChildConn=null,this.startParentConn=null,this.connectionPreviewer.hidePreview(),this.connectionCandidate=null,this.block.setDragging(!1),this.dragging=!1}}}i.DuplicateOnDragStrategy=r,i.setDuplicateOnDragStrategy=function(e){var t;null!=(t=e.setDragStrategy)&&t.call(e,new r(e))}},{"./duplicateOnDrag":90,blockly:175}],90:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.updateDuplicateOnDragState=i.shouldDuplicateOnDrag=i.isAllowlistedShadow=i.setDuplicateOnDrag=i.setDraggableShadowBlocks=void 0;let s,n;function r(e){return!(!s||-1===s.indexOf(e.type))}function o(e){var i,s,o;if(e.isShadow()&&r(e))return!0;if(n){let t=null==(i=e.outputConnection)?void 0:i.targetBlock();if(t)for(o of n.filter(e=>e.parentBlockType===t.type))if(o&&(!o.childBlockType||o.childBlockType===e.type)){if(!o.inputName)return!0;if((null==(s=e.outputConnection.targetConnection.getParentInput())?void 0:s.name)===o.inputName)return!0}}return!1}i.setDraggableShadowBlocks=function(e){s=e},i.setDuplicateOnDrag=function(t,i,s){(n=n||[]).some(e=>e.parentBlockType===t&&e.inputName===i&&e.childBlockType===s)||n.push({parentBlockType:t,inputName:i,childBlockType:s})},i.isAllowlistedShadow=r,i.shouldDuplicateOnDrag=o,i.updateDuplicateOnDragState=function(t){setTimeout(()=>{var e=o(t);t.pathObject&&t.pathObject.setHasDottedOutlineOnHover(e),t.setDeletable(!e)})}},{}],91:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./duplicateOnDrag"),i),o(e("./variablesGetReporter"),i),o(e("./connectionChecker"),i),o(e("./dragStrategy"),i)},{"./connectionChecker":88,"./dragStrategy":89,"./duplicateOnDrag":90,"./variablesGetReporter":92}],92:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let s=e("blockly"),o=e("./duplicateOnDrag");s.Blocks.variables_get_reporter={init:function(){this.jsonInit({type:"variables_get_reporter",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}",variableTypes:[""]}],output:null,colour:"%{BKY_VARIABLES_HUE}",outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableReporter"]}),(0,o.updateDuplicateOnDragState)(this)}}},{"./duplicateOnDrag":90,blockly:175}],93:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MultiFlyoutRecyclableBlockInflater=o.HIDDEN_CLASS_NAME=void 0;let n=e("blockly");o.HIDDEN_CLASS_NAME="pxtFlyoutHidden";class i extends n.BlockFlyoutInflater{constructor(){super(...arguments),this.keyToBlock=new Map,this.blockToKey=new Map}static register(){n.registry.register(n.registry.Type.FLYOUT_INFLATER,"block",i,!0)}isBlockRecycleable(e){switch(e.type){case"variables_get":case"variables_set":case"variables_change":return!1}return!0}createBlock(e,t){var i=(e=>e.blockxml?"string"==typeof e.blockxml?e.blockxml:n.Xml.domToText(e.blockxml):e.type)(e);if(!i)return super.createBlock(e,t);let s;return this.keyToBlock.has(i)&&(s=this.keyToBlock.get(i),this.keyToBlock.delete(i)),s=null!=s?s:super.createBlock(e,t),this.blockToKey.set(s,i),s.removeClass(o.HIDDEN_CLASS_NAME),s.setDisabledReason(!1,o.HIDDEN_CLASS_NAME),s}disposeItem(e){var t=e.getElement();if(t instanceof n.BlockSvg&&this.blockToKey.has(t)){if(this.isBlockRecycleable(t))return void this.recycleBlock(t);this.blockToKey.delete(t)}super.disposeItem(e)}clearCache(){this.blockToKey=new Map,this.keyToBlock=new Map}recycleBlock(e){var t=e.getRelativeToSurfaceXY(),t=(e.moveBy(-t.x,-t.y),e.addClass(o.HIDDEN_CLASS_NAME),e.setDisabledReason(!0,o.HIDDEN_CLASS_NAME),this.blockToKey.get(e));this.keyToBlock.set(t,e),this.removeListeners(e.id)}}o.MultiFlyoutRecyclableBlockInflater=i,n.Css.register(`
.${o.HIDDEN_CLASS_NAME} {
    display: none;
}
`)},{blockly:175}],94:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ButtonFlyoutInflater=void 0;let s=e("blockly"),o=e("./flyoutButton");class n extends s.ButtonFlyoutInflater{static register(){s.registry.register(s.registry.Type.FLYOUT_INFLATER,"button",n,!0)}load(e,t){t=new o.FlyoutButton(t.getWorkspace(),t.targetWorkspace,e,!1);return e.id&&t.getSvgRoot().setAttribute("id",e.id),t.show(),new s.FlyoutItem(t,"button")}}i.ButtonFlyoutInflater=n},{"./flyoutButton":96,blockly:175}],95:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.CachingFlyout=void 0;var s=e("blockly");let o=e("./blockInflater");class n extends s.VerticalFlyout{constructor(){super(...arguments),this.forceOpen=!1}clearBlockCache(){var e=this.getInflaterForType("block");e instanceof o.MultiFlyoutRecyclableBlockInflater&&e.clearCache()}getFlyoutElement(){return this.svgGroup_}setForceOpen(e){this.forceOpen=e}}i.CachingFlyout=n},{"./blockInflater":93,blockly:175}],96:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FlyoutButton=void 0;let h=e("blockly"),d={"ïŠ‡":"usb","ï¨":"accessible-icon","ï…°":"adn","ï†§":"pied-piper-pp","ï†¶":"steam","ïŠ”":"bluetooth-b","ï‡":"rebel","ï„¶":"maxcdn","ï†ª":"joomla","ïˆ“":"sellsy","ïˆŽ":"connectdevelop","ï„“":"github-alt"};class s extends h.FlyoutButton{constructor(e,t,i,s){super(e,t,i,s);var o=this.getSvgRoot();if(s){var e=i,t=(e["web-class"]&&o.classList.add(e["web-class"]),e["web-icon"]),s=e["web-icon-class"],i=e["web-icon-color"];if(t||s){var n=Object.keys(d).includes(t)?"brandIcon":"",r=h.utils.dom.createSvgElement("text",{class:"blocklyFlyoutLabelIcon"+(s?" "+s:"")+(n?" "+n:""),x:0,y:0,"text-anchor":"start"},o),s=(t&&(r.textContent=t),i&&r.setAttribute("style","fill: "+i),this.getTargetWorkspace()),l=(r.setAttribute("dominant-baseline","central"),r.setAttribute("dy","0"),r.setAttribute("x",(s.RTL?this.width+h.FlyoutButton.TEXT_MARGIN_X:0)+""),r.setAttribute("y",this.height/2+h.FlyoutButton.TEXT_MARGIN_Y+""),h.utils.dom.getTextWidth(r)+2*h.FlyoutButton.TEXT_MARGIN_X),a=(this.width+=l,o.getElementsByClassName("blocklyFlyoutLabelBackground").item(0));a.setAttribute("width",String(this.width));for(let e=0;e<o.children.length;e++){var c,u=o.children.item(e);u!==r&&u!==a&&(c=Number(u.getAttribute("x")),u.setAttribute("x",c+l+""))}}var n=e["web-line"],t=e["web-line-width"];n&&((i=h.utils.dom.createSvgElement("line",{class:"blocklyFlyoutLine","stroke-dasharray":n,"text-anchor":"middle"},o)).setAttribute("x1","0"),i.setAttribute("x2",null!=t?t:this.width+""),i.setAttribute("y1",this.height+10+""),i.setAttribute("y2",this.height+10+""))}else s=this.height,this.width+=2*(17.5-h.FlyoutButton.TEXT_MARGIN_X),this.height+=2*(14-h.FlyoutButton.TEXT_MARGIN_Y),e=o.getElementsByClassName("blocklyFlyoutButtonShadow").item(0),n=o.getElementsByClassName("blocklyFlyoutButtonBackground").item(0),t=o.getElementsByTagName("text").item(0),e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),n.setAttribute("width",String(this.width)),n.setAttribute("height",String(this.height)),t.setAttribute("x",String(this.width/2)),t.setAttribute("y",String(parseFloat(t.getAttribute("y"))-s/2+this.height/2))}isDisposed(){return null===this.getSvgRoot().parentNode}}i.FlyoutButton=s},{blockly:175}],97:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),i.registerFlyoutInflaters=i.MultiFlyoutRecyclableBlockInflater=i.LabelFlyoutInflater=i.ButtonFlyoutInflater=void 0;let n=e("./buttonFlyoutInflater"),r=(Object.defineProperty(i,"ButtonFlyoutInflater",{enumerable:!0,get:function(){return n.ButtonFlyoutInflater}}),e("./labelFlyoutInflater")),l=(Object.defineProperty(i,"LabelFlyoutInflater",{enumerable:!0,get:function(){return r.LabelFlyoutInflater}}),e("./blockInflater"));Object.defineProperty(i,"MultiFlyoutRecyclableBlockInflater",{enumerable:!0,get:function(){return l.MultiFlyoutRecyclableBlockInflater}}),o(e("./cachingFlyout"),i),i.registerFlyoutInflaters=function(){n.ButtonFlyoutInflater.register(),r.LabelFlyoutInflater.register(),l.MultiFlyoutRecyclableBlockInflater.register()}},{"./blockInflater":93,"./buttonFlyoutInflater":94,"./cachingFlyout":95,"./labelFlyoutInflater":98}],98:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.LabelFlyoutInflater=void 0;let s=e("blockly"),o=e("./flyoutButton");class n extends s.LabelFlyoutInflater{static register(){s.registry.register(s.registry.Type.FLYOUT_INFLATER,"label",n,!0)}load(e,t){t=new o.FlyoutButton(t.getWorkspace(),t.targetWorkspace,e,!0);return t.show(),new s.FlyoutItem(t,"label")}}i.LabelFlyoutInflater=n},{"./flyoutButton":96,blockly:175}],99:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let s=e("blockly");i=e("../constants"),e={typeName_:"",getTypeName(){return this.typeName_},removeFieldCallback(e){var t=this.getParent();null!=t&&t.removeFieldCallback&&t.removeFieldCallback(e)}};s.Blocks[i.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"bool"}],extensions:["output_boolean","text_field_color"]}),this.typeName_="boolean"}}),s.Blocks[i.ARGUMENT_EDITOR_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"text"}],extensions:["output_string","text_field_color"]}),this.typeName_="string"}}),s.Blocks[i.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"num"}],extensions:["output_number","text_field_color"]}),this.typeName_="number"}}),s.Blocks[i.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"list"}],extensions:["output_array","text_field_color"]}),this.typeName_="Array"}}),s.Blocks[i.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_editor",name:"TEXT",text:"arg"}],outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,extensions:["text_field_color"]}),this.typeName_="any"},mutationToDom(){var e=s.utils.xml.createElement("mutation");return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_)}})},{"../constants":105,blockly:175}],100:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.LOCALIZATION_NAME_MUTATION_KEY=void 0;let s=e("blockly");var o=e("../constants");let n=e("../msg"),r=e("../../duplicateOnDrag"),l=(i.LOCALIZATION_NAME_MUTATION_KEY="localizationname",{typeName_:"",localizationName_:"",getTypeName(){return this.typeName_},getLocalizationName(){return this.localizationName_||this.getFieldValue("VALUE")},mutationToDom(){var e=s.utils.xml.createElement("mutation");return this.localizationName_&&e.setAttribute(i.LOCALIZATION_NAME_MUTATION_KEY,this.localizationName_),e},domToMutation(e){e.hasAttribute(i.LOCALIZATION_NAME_MUTATION_KEY)&&(this.localizationName_=e.getAttribute(i.LOCALIZATION_NAME_MUTATION_KEY))}});function a(e){(0,r.setDuplicateOnDragStrategy)(e),(0,r.updateDuplicateOnDragState)(e)}s.Blocks[o.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_reporter",name:"VALUE",text:""}],colour:s.Msg[n.MsgKey.REPORTERS_HUE],extensions:["output_boolean"]}),this.typeName_="boolean",a(this)}}),s.Blocks[o.ARGUMENT_REPORTER_STRING_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_reporter",name:"VALUE",text:""}],colour:s.Msg[n.MsgKey.REPORTERS_HUE],extensions:["output_string"]}),this.typeName_="string",a(this)}}),s.Blocks[o.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_reporter",name:"VALUE",text:""}],colour:s.Msg[n.MsgKey.REPORTERS_HUE],extensions:["output_number"]}),this.typeName_="number",a(this)}}),s.Blocks[o.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_reporter",name:"VALUE",text:""}],colour:s.Msg[n.MsgKey.REPORTERS_HUE],extensions:["output_array"]}),this.typeName_="Array",a(this)}}),s.Blocks[o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE]=Object.assign(Object.assign({},l),{init:function(){this.jsonInit({message0:" %1",args0:[{type:"field_argument_reporter",name:"VALUE",text:""}],colour:s.Msg[n.MsgKey.REPORTERS_HUE],inputsInline:!0,outputShape:(new s.zelos.ConstantProvider).SHAPES.ROUND,output:null}),this.typeName_="",a(this)},mutationToDom(){var e=l.mutationToDom.call(this);return e.setAttribute("typename",this.typeName_),e},domToMutation(e){this.typeName_=e.getAttribute("typename"),this.setOutput(!0,this.typeName_),l.domToMutation.call(this,e)}})},{"../../duplicateOnDrag":91,"../constants":105,"../msg":112,blockly:175}],101:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let r=e("blockly");i=e("../commonFunctionMixin");let n=e("../constants"),l=e("../utils"),s=e("../msg");e=Object.assign(Object.assign({},i.COMMON_FUNCTION_MIXIN),{populateArgument_:function(t,i,s){let o=null,n=null;i&&t.id in i&&(e=i[t.id],o=e.block,n=e.shadow);var e=null==o?void 0:o.workspace.connectionChecker;r.Events.disable();try{if(o&&!o.isDisposed()&&i&&(null==e?void 0:e.canConnectWithReason(null==o?void 0:o.outputConnection,s.connection,!1))===r.Connection.CAN_CONNECT){o.outputConnection.connect(s.connection);let e;"variables_get"!==(e=o.isShadow()?r.Xml.blockToDom(o):n||this.buildShadowDom_(t.type)).getAttribute("type")&&s.connection.setShadowDom(e),delete i[s.name]}else this.attachShadow_(s,t.type)}finally{r.Events.enable()}},afterWorkspaceLoad:function(){var e,t;for(e of this.inputList)e.type===r.inputs.inputTypes.VALUE&&((t=null==(t=e.connection)?void 0:t.targetBlock())&&t.isShadow()&&t.getVarModels().length&&t.setShadow(!1),t=e.connection&&e.getShadowDom(),(0,l.isVariableBlockType)(null==t?void 0:t.getAttribute("type")))&&e.setShadowDom(null)},addFunctionLabel_:function(e){this.appendDummyInput("function_name").appendField(new r.FieldLabel(e,"functionNameText"),"function_name")},updateFunctionLabel_:function(e){this.getField("function_name").setValue(e)},attachShadow_(e,t){var t=(0,l.getShadowBlockInfoFromType_)(t,this.workspace),i=t[0],s=t[1],t=t[2];r.Events.disable();let o=null;try{(o=this.workspace.newBlock(i)).setFieldValue(t,s),o.setShadow("variables_get"!==i),!this.isInsertionMarker()&&o instanceof r.BlockSvg&&(o.initSvg(),o.queueRender())}finally{r.Events.enable()}o&&(o.setShadow(!0),o.outputConnection.connect(e.connection))},buildShadowDom_(e){var t=r.utils.xml.createElement("shadow"),e=(0,l.getShadowBlockInfoFromType_)(e,this.workspace),i=e[0],s=e[1],e=e[2],o="variables_get"===i,i=(t.setAttribute("type",i),r.utils.xml.createElement("field"));return i.textContent=e,o&&(i.setAttribute("id",e),o=this.workspace.getVariableMap().getVariableById(e),i.textContent=o?o.getName():""),i.setAttribute("name",s),t.appendChild(i),t},onchange(e){var t,i,s,o;this.workspace&&!this.workspace.isFlyout&&(e.type==r.Events.BLOCK_CREATE&&-1!=(null==(o=e.ids)?void 0:o.indexOf(this.id))?(o=this.getName(),(o=(0,l.getDefinition)(o,this.workspace))?(i=o.getArguments().slice(),t=this.arguments_.slice(),JSON.stringify(t)!==JSON.stringify(i)&&(0,l.mutateCallersAndDefinition)(o.getName(),this.workspace,o.mutationToDom()),this.functionId_=o.functionId_):(r.Events.setGroup(e.group),t=r.utils.xml.createElement("xml"),(i=r.utils.xml.createElement("block")).setAttribute("type",n.FUNCTION_DEFINITION_BLOCK_TYPE),s=(o=this.getRelativeToSurfaceXY()).x+r.config.snapRadius*(this.RTL?-1:1),o=o.y+2*r.config.snapRadius,i.setAttribute("x",s+""),i.setAttribute("y",o+""),s=this.mutationToDom(),i.appendChild(s),t.appendChild(i),r.Xml.domToWorkspace(t,this.workspace),r.Events.setGroup(!1))):e.type==r.Events.BLOCK_DELETE&&(o=this.getName(),(0,l.getDefinition)(o,this.workspace)||(r.Events.setGroup(e.group),this.dispose(!0),r.Events.setGroup(!1))))},serializeChangedInputs(e){var t,i,s,o=[],n=(0,l.getArgMap)(e,!0);for(t of this.arguments_)n[t.id]||((s=(i=this.getInput(t.id).connection).targetBlock()).isShadow()?o.push({inputName:t.id,connectedShadow:i.getShadowState(!0)}):o.push({inputName:t.id,connectedBlock:s.id}));return o}});r.Blocks[n.FUNCTION_CALL_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!0),this.setNextStatement(!0),this.setColour(r.Msg[s.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(r.Msg[s.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(r.Msg[s.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}}),r.Blocks[n.FUNCTION_CALL_OUTPUT_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({extensions:["function_contextmenu_edit"]}),this.name_="",this.arguments_=[],this.functionId_="",this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0,null),this.setOutputShape((new r.zelos.ConstantProvider).SHAPES.ROUND),this.setColour(r.Msg[s.MsgKey.PROCEDURES_HUE]),this.setHelpUrl(r.Msg[s.MsgKey.PROCEDURES_CALLNORETURN_HELPURL]),this.setTooltip(r.Msg[s.MsgKey.FUNCTION_CALL_TOOLTIP]),this.setInputsInline(!0)}})},{"../commonFunctionMixin":104,"../constants":105,"../msg":112,"../utils":114,blockly:175}],102:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.newFunctionMutation=void 0;let n=e("blockly");var s=e("../commonFunctionMixin");let o=e("../constants"),r=e("../utils"),l=e("../fields/fieldAutocapitalizeTextInput"),a=e("../functionManager"),c=e("../msg");e=Object.assign(Object.assign({},s.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){e=this.createArgumentEditor_(e.type,e.name);i.connection.connect(e.outputConnection)},addFunctionLabel_:function(e){e=new l.FieldAutocapitalizeTextInput(e||"",void 0,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(e,"function_name")},updateFunctionLabel_:function(e){n.Events.disable(),this.getField("function_name").setValue(e),n.Events.enable()},createArgumentEditor_:function(t,i){n.Events.disable();let s;try{let e="";switch(t){case"boolean":e=o.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE;break;case"number":e=o.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE;break;case"string":e=o.ARGUMENT_EDITOR_STRING_BLOCK_TYPE;break;case"Array":e=o.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE;break;default:e=o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE}(s=e==o.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE?(0,r.createCustomArgumentEditor)(t,this.workspace):this.workspace.newBlock(e)).setFieldValue(i,"TEXT"),s.setShadow(!0),!this.isInsertionMarker()&&s instanceof n.BlockSvg&&(s.initSvg(),s.queueRender())}finally{n.Events.enable()}return s},async focusLastEditorAsync_(){var e,t;await n.renderManagement.finishQueuedRenders(),0<this.inputList.length&&((t=this.inputList[this.inputList.length-2]).type==n.inputs.inputTypes.DUMMY?((e=this.workspace)instanceof n.WorkspaceSvg&&e.centerOnBlock(this.id,!0),t.fieldRow[0].showEditor()):t.type==n.inputs.inputTypes.VALUE&&((t=(e=t.connection.targetBlock()).workspace)instanceof n.WorkspaceSvg&&t.centerOnBlock(e.id,!0),e.getField("TEXT").showEditor()))},removeFieldCallback(t){let i=null;for(let e=0;e<this.inputList.length&&!i;e++){var s=this.inputList[e];if(s.connection){var o=s.connection.targetBlock();o&&o.getField(t.name)===t&&(i=s.name)}else for(let e=0;e<s.fieldRow.length;e++)s.fieldRow[e]==t&&(i=s.name)}i&&(n.WidgetDiv.hide(),this.removeInput(i),this.updateFunctionSignature(),this.updateDisplay_())},addParam_(e,t){n.WidgetDiv.hide();t=(0,r.findUniqueParamName)(t,this.arguments_.map(e=>e.name));this.arguments_.push({id:n.utils.idGenerator.genUid(),name:t,type:e}),this.updateDisplay_(),this.focusLastEditorAsync_()},addBooleanExternal(){this.addParam_("boolean",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME])},addStringExternal(){this.addParam_("string",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_STRING_ARG_NAME])},addNumberExternal(){this.addParam_("number",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME])},addArrayExternal(){this.addParam_("Array",n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME])},addCustomExternal(e){this.addParam_(e,a.FunctionManager.getInstance().getArgumentNameForType(e))},updateFunctionSignature(){this.arguments_=[];for(let e=1;e<this.inputList.length;e++){var t=this.inputList[e];switch(t.type){case n.inputs.inputTypes.STATEMENT:break;case n.inputs.inputTypes.DUMMY:this.name_=t.fieldRow[0].getValue()||t.fieldRow[0].getText();break;case n.inputs.inputTypes.VALUE:var i=t.connection.targetBlock();this.arguments_.push({id:t.name,name:i.getFieldValue("TEXT"),type:i.getTypeName()});break;default:pxt.warn("Unexpected input type on a function mutator root: "+t.type)}}}});i.newFunctionMutation=function(e){var e=(0,r.findLegalName)(n.Msg[c.MsgKey.FUNCTIONS_DEFAULT_FUNCTION_NAME],e),t=n.utils.xml.createElement("mutation");return t.setAttribute("name",e),t.setAttribute("functionid",n.utils.idGenerator.genUid()),t},n.Blocks[o.FUNCTION_DECLARATION_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(n.Msg[c.MsgKey.PROCEDURES_HUE]),this.setStatements_(!0),this.setDeletable(!1),this.setMovable(!1),this.contextMenu=!1,this.setInputsInline(!0)}})},{"../commonFunctionMixin":104,"../constants":105,"../fields/fieldAutocapitalizeTextInput":109,"../functionManager":110,"../msg":112,"../utils":114,blockly:175}],103:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let s=e("blockly");i=e("../commonFunctionMixin");let o=e("../constants"),n=e("../utils"),r=e("../fields/fieldAutocapitalizeTextInput"),l=e("../msg"),a=e("../functionManager"),c=e("../svgs");var u=e("../../duplicateOnDrag");let h=e("../../../fields/field_imagenotext");e=Object.assign(Object.assign({},i.COMMON_FUNCTION_MIXIN),{populateArgument_:function(e,t,i){let s=null;var o;null!=t&&t[e.id]&&(o=t[e.id],s=o.block);let n;t&&s&&!s.isDisposed()?((n=s).setFieldValue(e.name,"VALUE"),delete t[i.name]):n=this.createArgumentReporter_(e),i.connection.connect(n.outputConnection)},afterWorkspaceLoad:function(){for(let t of this.inputList)if(t.type===s.inputs.inputTypes.VALUE){var i=this.arguments_.find(e=>e.id===t.name);if(i){let e=t.connection.targetBlock();e||(this.populateArgument_(i,null,t),e=t.connection.targetBlock()),e.setFieldValue(i.name,"VALUE"),e.isShadow()&&e.setShadow(!1),t.setShadowDom(null)}}},addFunctionLabel_:function(e){e=new r.FieldAutocapitalizeTextInput(e||"",n.rename,{spellcheck:!1,disableAutocapitalize:!0});this.appendDummyInput("function_name").appendField(e,"function_name")},updateFunctionLabel_:function(e){s.Events.disable(),this.getField("function_name").setValue(e),s.Events.enable()},createArgumentReporter_:function(e){let t="";switch(e.type){case"boolean":t=o.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE;break;case"number":t=o.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE;break;case"string":t=o.ARGUMENT_REPORTER_STRING_BLOCK_TYPE;break;case"Array":t=o.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE;break;default:t=o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}s.Events.disable();let i;try{(i=t==o.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE?(0,n.createCustomArgumentReporter)(e.type,this.workspace):this.workspace.newBlock(t)).setFieldValue(e.name,"VALUE"),i.setShadow(!0),!this.isInsertionMarker()&&i instanceof s.BlockSvg&&(i.initSvg(),i.queueRender())}finally{s.Events.enable()}return i},customContextMenu:function(e){var t;this.isInFlyout||null!=(t=null==(t=this.workspace)?void 0:t.options)&&t.readOnly||(e.push(this.makeEditOption()),e.push(this.makeCallOption()))},makeEditOption:function(){var e;return{enabled:!(null!=(e=null==(e=this.workspace)?void 0:e.options)&&e.readOnly),text:s.Msg.FUNCTIONS_EDIT_OPTION,callback:()=>{var e,t=this;t.type!=o.FUNCTION_CALL_BLOCK_TYPE&&t.type!=o.FUNCTION_CALL_OUTPUT_BLOCK_TYPE||(e=t.workspace,t=(0,n.getDefinition)(t.getName(),e)),s.hideChaff(),s.getSelected()&&s.getSelected().unselect(),a.FunctionManager.getInstance().editFunctionExternal(t.mutationToDom(),e=>{e&&((0,n.mutateCallersAndDefinition)(t.getName(),t.workspace,e),t.updateDisplay_()),setTimeout(()=>{t.afterWorkspaceLoad&&t.afterWorkspaceLoad()})})}}},makeCallOption:function(){var e=this.getName(),t=s.utils.xml.createElement("mutation"),i=(t.setAttribute("name",e),s.utils.xml.createElement("block"));return i.appendChild(t),i.setAttribute("type",o.FUNCTION_CALL_BLOCK_TYPE),{enabled:0<this.workspace.remainingCapacity()&&!(null!=(t=null==(t=this.workspace)?void 0:t.options)&&t.readOnly),text:s.Msg.FUNCTIONS_CREATE_CALL_OPTION.replace("%1",e),callback:s.ContextMenu.callbackFactory(this,i)}}});s.Blocks[o.FUNCTION_DEFINITION_BLOCK_TYPE]=Object.assign(Object.assign({},e),{init:function(){var e;this.jsonInit({style:{hat:"cap"}}),this.name_="",this.arguments_=[],this.functionId_="",this.createAllInputs_(),this.setColour(s.Msg[l.MsgKey.PROCEDURES_HUE]),this.setTooltip(s.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_TOOLTIP]),this.setHelpUrl(s.Msg[l.MsgKey.PROCEDURES_DEFNORETURN_HELPURL]),this.setStatements_(!0),this.setInputsInline(!0),this.workspace.options.collapse&&(e=c.COLLAPSE_IMAGE_DATAURI,this.appendDummyInput("function_collapse").appendField(new h.FieldImageNoText(e,24,24,"",()=>{this.setCollapsed(!0)},!1)))}}),(0,u.setDuplicateOnDrag)(o.FUNCTION_DEFINITION_BLOCK_TYPE)},{"../../../fields/field_imagenotext":38,"../../duplicateOnDrag":91,"../commonFunctionMixin":104,"../constants":105,"../fields/fieldAutocapitalizeTextInput":109,"../functionManager":110,"../msg":112,"../svgs":113,"../utils":114,blockly:175}],104:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.COMMON_FUNCTION_MIXIN=void 0;let n=e("blockly"),r=e("./constants"),l=e("./utils"),s=e("./msg");i.COMMON_FUNCTION_MIXIN={name_:"",functionId_:"",arguments_:[],mutationToDom:function(){this.ensureIds_();let i=n.utils.xml.createElement("mutation");return i.setAttribute("name",this.name_),i.setAttribute("functionid",this.functionId_),this.arguments_.forEach(function(e){var t=n.utils.xml.createElement("arg");t.setAttribute("name",e.name),t.setAttribute("id",e.id),t.setAttribute("type",e.type),i.appendChild(t)}),i},domToMutation:function(t){var i=[];for(let e=0;e<t.childNodes.length;++e){var s=t.childNodes[e];"arg"==s.nodeName.toLowerCase()&&i.push({id:s.getAttribute("id"),name:s.getAttribute("name"),type:s.getAttribute("type")})}this.arguments_=i,this.name_=t.getAttribute("name"),this.restoreSavedFunctionId(t.getAttribute("functionid"))},saveExtraState:function(){return{name:this.name_,functionid:this.functionId_,arguments:this.arguments_.slice()}},loadExtraState:function(e){this.arguments_=e.arguments.slice(),this.name_=e.name,this.restoreSavedFunctionId(e.functionid)},restoreSavedFunctionId:function(e){(0,l.idsInUse)(this.workspace).indexOf(e)<0&&(this.functionId_=e),this.ensureIds_();let t=null;this instanceof n.BlockSvg&&(t=this.getHeightWidth()),this.type!==r.FUNCTION_DEFINITION_BLOCK_TYPE||t&&!t.height&&!t.width?this.updateDisplay_():!this.getFieldValue("function_name")&&this.name_&&(this.setFieldValue(this.name_,"function_name"),this.updateDisplay_())},getName:function(){return this.name_},getFunctionId:function(){return this.functionId_},getArguments:function(){return this.arguments_},removeValueInputs_:function(){var i=[];for(let e=0,t;t=this.inputList[e];e++)t.type==n.inputs.inputTypes.VALUE?t.dispose():i.push(t);this.inputList=i},createAllInputs_:function(){let t=!1,i=!1;if(this.inputList.forEach(function(e){"function_title"==e.name?t=!0:"function_name"==e.name&&(i=!0)}),!t){let e="";switch(this.type){case r.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case r.FUNCTION_CALL_BLOCK_TYPE:e=n.Msg[s.MsgKey.FUNCTIONS_CALL_TITLE];break;case r.FUNCTION_DEFINITION_BLOCK_TYPE:case r.FUNCTION_DECLARATION_BLOCK_TYPE:e=n.Msg[s.MsgKey.FUNCTIONS_DEFNORETURN_TITLE]}this.appendDummyInput("function_title").appendField(e,"function_title")}i?this.updateFunctionLabel_(this.getName()):this.addFunctionLabel_(this.getName()),this.updateArgumentInputs_()},updateArgumentInputs_(){var i,e;for(let t of this.inputList)t.type!==n.inputs.inputTypes.VALUE||this.arguments_.some(e=>e.id===t.name)||(this.type===r.FUNCTION_DEFINITION_BLOCK_TYPE&&(e=t.connection.targetBlock())&&e.dispose(),this.removeInput(t.name));let s=this.inputList.findIndex(e=>e.type===n.inputs.inputTypes.VALUE);-1===s&&(s=this.inputList.length);for(let t of this.arguments_){let e=this.inputList.find(e=>e.name===t.id);var o=!e;o&&(e=this.appendValueInput(t.id)),this.inputList.indexOf(e)!==s&&this.moveInputBefore(e.name,null==(i=this.inputList[s+1])?void 0:i.name),(0,l.isCustomType)(t.type)?e.setCheck(t.type):e.setCheck(t.type.charAt(0).toUpperCase()+t.type.slice(1)),!this.isInsertionMarker()&&o&&this.populateArgument_(t,void 0,e),s++}this.inputList.some(e=>"function_collapse"===e.name)&&this.moveInputBefore("function_collapse",null),this.hasStatements_&&this.moveInputBefore("STACK",null)},updateDisplay_:function(){var e=this.rendered;this.createAllInputs_(),e&&!this.isInsertionMarker()&&this instanceof n.BlockSvg&&(this.initSvg(),this.queueRender())},setStatements_:function(e){this.hasStatements_!==e&&(e?this.appendStatementInput("STACK"):this.removeInput("STACK",!0),this.hasStatements_=e)},ensureIds_:function(){switch(this.type){case r.FUNCTION_DEFINITION_BLOCK_TYPE:this.functionId_&&"null"!=this.functionId_||(this.functionId_=n.utils.idGenerator.genUid());for(let e=0;e<this.arguments_.length;++e)this.arguments_[e].id||(this.arguments_[e].id=n.utils.idGenerator.genUid());break;case r.FUNCTION_CALL_OUTPUT_BLOCK_TYPE:case r.FUNCTION_CALL_BLOCK_TYPE:var e=(0,l.getDefinition)(this.name_,this.workspace);if(e){this.functionId_=e.getFunctionId();var i=e.getArguments();for(let t=0;t<this.arguments_.length;++t)for(let e=0;e<i.length;++e)if(i[e].name==this.arguments_[t].name){this.arguments_[t].id=i[e].id;break}}}}}},{"./constants":105,"./msg":112,"./utils":114,blockly:175}],105:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE=i.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE=i.ARGUMENT_EDITOR_STRING_BLOCK_TYPE=i.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE=i.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE=i.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE=i.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE=i.ARGUMENT_REPORTER_STRING_BLOCK_TYPE=i.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE=i.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE=i.FUNCTION_CALL_OUTPUT_BLOCK_TYPE=i.FUNCTION_CALL_BLOCK_TYPE=i.FUNCTION_DECLARATION_BLOCK_TYPE=i.FUNCTION_DEFINITION_BLOCK_TYPE=void 0,i.FUNCTION_DEFINITION_BLOCK_TYPE="function_definition",i.FUNCTION_DECLARATION_BLOCK_TYPE="function_declaration",i.FUNCTION_CALL_BLOCK_TYPE="function_call",i.FUNCTION_CALL_OUTPUT_BLOCK_TYPE="function_call_output",i.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE="argument_reporter_boolean",i.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE="argument_reporter_number",i.ARGUMENT_REPORTER_STRING_BLOCK_TYPE="argument_reporter_string",i.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE="argument_reporter_array",i.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE="argument_reporter_custom",i.ARGUMENT_EDITOR_BOOLEAN_BLOCK_TYPE="argument_editor_boolean",i.ARGUMENT_EDITOR_NUMBER_BLOCK_TYPE="argument_editor_number",i.ARGUMENT_EDITOR_STRING_BLOCK_TYPE="argument_editor_string",i.ARGUMENT_EDITOR_ARRAY_BLOCK_TYPE="argument_editor_array",i.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE="argument_editor_custom"},{}],106:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let s=e("blockly"),o=e("./utils"),n=e("./msg"),r=e("./svgs"),l=new s.zelos.ConstantProvider;i={customContextMenu:function(e){if(!this.isCollapsed()){var t={text:s.Msg.RENAME_VARIABLE,enabled:!this.workspace.options.readOnly,callback:()=>{var e=this.workspace,t=this.getField("VAR").getVariable();s.Variables.renameVariable(e,t)}};if(e.unshift(t),!this.isInFlyout)for(let t of this.workspace.getVariableMap().getVariablesOfType("")){var i={enabled:!this.workspace.options.readOnly,text:t.getName(),callback:()=>{var e=this.getField("VAR");e||pxt.log("Tried to get a variable field on the wrong type of block."),e.setValue(t.getId())}};e.unshift(i)}}}};s.Extensions.registerMixin("function_contextmenu_edit",{customContextMenu:function(e){var t={enabled:!(null!=(t=null==(t=this.workspace)?void 0:t.options)&&t.readOnly),text:s.Msg[n.MsgKey.FUNCTIONS_GO_TO_DEFINITION_OPTION],callback:()=>{var e=this.getField("function_name").getText(),e=(0,o.getDefinition)(e,this.workspace);e&&this.workspace instanceof s.WorkspaceSvg&&this.workspace.centerOnBlock(e.id,!0)}};e.push(t)}}),s.Extensions.registerMixin("contextMenu_variableReporter",i),s.Extensions.register("output_number",function(){this.setInputsInline(!0),this.setOutputShape(l.SHAPES.ROUND),this.setOutput(!0,"Number")}),s.Extensions.register("output_string",function(){this.setInputsInline(!0),this.setOutputShape(l.SHAPES.ROUND),this.setOutput(!0,"String")}),s.Extensions.register("output_boolean",function(){this.setInputsInline(!0),this.setOutputShape(l.SHAPES.HEXAGONAL),this.setOutput(!0,"Boolean")}),s.Extensions.register("output_array",function(){this.setInputsInline(!0),this.setOutputShape(l.SHAPES.ROUND),this.setOutput(!0,"Array")}),s.Extensions.register("text_field_color",function(){var e;this.workspace instanceof s.WorkspaceSvg?(e=this.workspace.getRenderer().getConstants(),this.setColour(e.FIELD_BORDER_RECT_COLOUR)):this.setColour("#fff")}),s.Extensions.register("inline-svgs",function(){this.ADD_IMAGE_DATAURI=r.ADD_IMAGE_DATAURI,this.REMOVE_IMAGE_DATAURI=r.REMOVE_IMAGE_DATAURI})},{"./msg":112,"./svgs":113,"./utils":114,blockly:175}],107:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldArgumentEditor=void 0;let o=e("blockly"),s=e("../functionManager");class n extends o.FieldTextInput{constructor(e,t,i){super(e,t,i)}showEditor(e){super.showEditor(e);var t,e=o.WidgetDiv.getDiv(),i=(e.className+=" argumentEditorInput",document.createElement("img")),i=(i.setAttribute("class","argumentEditorRemoveIcon"),i.setAttribute("src",n.REMOVE_ARG_URI),this.removeButtonMouseWrapper_=o.browserEvents.conditionalBind(i,"mousedown",this,this.removeCallback),e.appendChild(i),null==(i=this.sourceBlock_)?void 0:i.getTypeName());i&&null!=(t=this.sourceBlock_)&&t.workspace&&(t=s.FunctionManager.getInstance().getIconForType(i))&&(i=t+" icon argumentEditorTypeIcon",(t=document.createElement("i")).className=i,e.appendChild(t))}removeCallback(){var t,i=null==(i=this.sourceBlock_)?void 0:i.getParent();if(i){let e;for(var s of i.inputList)if((null==(t=s.connection)?void 0:t.targetBlock())===this.sourceBlock_){e=s.name;break}e&&(o.WidgetDiv.hide(),i.removeInput(e))}}}(i.FieldArgumentEditor=n).REMOVE_ARG_URI="data:image/svg+xml;charset=UTF-8,%3c?xml version='1.0' encoding='UTF-8' standalone='no'?%3e%3csvg width='20px' height='20px' viewBox='0 0 20 20' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3c!-- Generator: Sketch 48.1 (47250) - http://www.bohemiancoding.com/sketch --%3e%3ctitle%3edelete-argument v2%3c/title%3e%3cdesc%3eCreated with Sketch.%3c/desc%3e%3cdefs%3e%3c/defs%3e%3cg id='Page-1' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3e%3cg id='delete-argument-v2' stroke='%23FF661A'%3e%3cg id='Group' transform='translate(3.000000, 2.500000)'%3e%3cpath d='M1,3 L13,3 L11.8900496,14.0995037 C11.8389294,14.6107055 11.4087639,15 10.8950124,15 L3.10498756,15 C2.59123611,15 2.16107055,14.6107055 2.10995037,14.0995037 L1,3 Z' id='Rectangle' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M7,11 L7,6' id='Line' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M9.5,11 L9.5,6' id='Line-Copy' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3cpath d='M4.5,11 L4.5,6' id='Line-Copy-2' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'%3e%3c/path%3e%3crect id='Rectangle-2' fill='%23FF661A' x='0' y='2.5' width='14' height='1' rx='0.5'%3e%3c/rect%3e%3cpath d='M6,0 L8,0 C8.55228475,-1.01453063e-16 9,0.44771525 9,1 L9,3 L5,3 L5,1 C5,0.44771525 5.44771525,1.01453063e-16 6,0 Z' id='Rectangle-3' stroke-width='1.5'%3e%3c/path%3e%3c/g%3e%3c/g%3e%3c/g%3e%3c/svg%3e",o.fieldRegistry.register("field_argument_editor",n),o.Css.register(`

.argumentEditorInput {
    overflow: visible;
}

.functioneditor i.argumentEditorTypeIcon {
    color: var(--pxt-target-foreground1);
    position: absolute;
    width: 24px;
    height: 24px;
    top: 40px;
    left: 50%;
    margin-left: -12px;
}

.argumentEditorRemoveIcon {
    position: absolute;
    width: 24px;
    height: 24px;
    top: -40px;
    left: 50%;
    margin-left: -12px;
    cursor: pointer;
}

`)},{"../functionManager":110,blockly:175}],108:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setArgumentReporterLocalizeFunction=i.FieldArgumentReporter=void 0;var s=e("blockly");let o=e("../utils"),n;class r extends s.FieldLabelSerializable{getDisplayText_(){var e=this.getSourceBlock();if(e&&(0,o.isFunctionArgumentReporter)(e)&&n){e=n(this,e);if(e)return e}return super.getDisplayText_()}}i.FieldArgumentReporter=r,i.setArgumentReporterLocalizeFunction=function(e){n=e},s.registry.register(s.registry.Type.FIELD,"field_argument_reporter",r)},{"../utils":114,blockly:175}],109:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldAutocapitalizeTextInput=void 0;e=e("blockly");class s extends e.FieldTextInput{constructor(e,t,i){super(e,t,i),this.disableAutocapitalize=!1}setAutocapitalize(e){this.disableAutocapitalize=!e,this.htmlInput_&&(this.disableAutocapitalize?this.htmlInput_.setAttribute("autocapitalize","none"):this.htmlInput_.removeAttribute("autocapitalize"))}configure_(e){super.configure_(e),void 0!==e.disableAutocapitalize&&(this.disableAutocapitalize=e.disableAutocapitalize)}widgetCreate_(){var e=super.widgetCreate_();return this.disableAutocapitalize&&e.setAttribute("autocapitalize","none"),e}}i.FieldAutocapitalizeTextInput=s,e.fieldRegistry.register("field_autocapitalize_text_input",s)},{blockly:175}],110:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FunctionManager=void 0;let s=e("blockly"),o=e("./msg");class n{constructor(){this.typeIcons={},this.typeArgumentNames={}}static getInstance(){return n.instance}getIconForType(e){return this.typeIcons[e]}setIconForType(e,t){this.typeIcons[e]=t}setArgumentNameForType(e,t){this.typeArgumentNames[e]=t}getArgumentNameForType(e){return this.typeArgumentNames[e]||s.Msg[o.MsgKey.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME]}setEditFunctionExternal(e){this._editFunctionExternal=e}editFunctionExternal(e,t){this._editFunctionExternal?this._editFunctionExternal(e,t):pxt.warn("External function editor must be overriden: Blockly.Functions.editFunctionExternalHandler",e,t)}}(i.FunctionManager=n).instance=new n},{"./msg":112,blockly:175}],111:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)},n=(Object.defineProperty(i,"__esModule",{value:!0}),i.validateFunctionExternal=i.getAllFunctionDefinitionBlocks=i.getDefinition=i.flyoutCategory=void 0,o(e("./msg"),i),o(e("./extensions"),i),o(e("./fields/fieldArgumentEditor"),i),o(e("./fields/fieldArgumentReporter"),i),o(e("./fields/fieldAutocapitalizeTextInput"),i),o(e("./blocks/argumentEditorBlocks"),i),o(e("./blocks/argumentReporterBlocks"),i),o(e("./blocks/functionDeclarationBlock"),i),o(e("./blocks/functionDefinitionBlock"),i),o(e("./blocks/functionCallBlocks"),i),o(e("./functionManager"),i),e("./utils"));Object.defineProperty(i,"flyoutCategory",{enumerable:!0,get:function(){return n.flyoutCategory}}),Object.defineProperty(i,"getDefinition",{enumerable:!0,get:function(){return n.getDefinition}}),Object.defineProperty(i,"getAllFunctionDefinitionBlocks",{enumerable:!0,get:function(){return n.getAllFunctionDefinitionBlocks}}),Object.defineProperty(i,"validateFunctionExternal",{enumerable:!0,get:function(){return n.validateFunctionExternal}})},{"./blocks/argumentEditorBlocks":99,"./blocks/argumentReporterBlocks":100,"./blocks/functionCallBlocks":101,"./blocks/functionDeclarationBlock":102,"./blocks/functionDefinitionBlock":103,"./extensions":106,"./fields/fieldArgumentEditor":107,"./fields/fieldArgumentReporter":108,"./fields/fieldAutocapitalizeTextInput":109,"./functionManager":110,"./msg":112,"./utils":114}],112:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.MsgKey=void 0;let s=e("blockly"),o;function n(e,t){s.Msg[e]||(s.Msg[e]=t)}(e=o=i.MsgKey||(i.MsgKey={})).REPORTERS_HUE="REPORTERS_HUE",e.FUNCTIONS_CALL_TITLE="FUNCTIONS_CALL_TITLE",e.FUNCTIONS_DEFNORETURN_TITLE="FUNCTIONS_DEFNORETURN_TITLE",e.FUNCTIONS_GO_TO_DEFINITION_OPTION="FUNCTIONS_GO_TO_DEFINITION_OPTION",e.FUNCTION_CALL_TOOLTIP="FUNCTION_CALL_TOOLTIP",e.PROCEDURES_HUE="PROCEDURES_HUE",e.PROCEDURES_CALLNORETURN_HELPURL="PROCEDURES_CALLNORETURN_HELPURL",e.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME="FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME",e.FUNCTIONS_DEFAULT_STRING_ARG_NAME="FUNCTIONS_DEFAULT_STRING_ARG_NAME",e.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME="FUNCTIONS_DEFAULT_NUMBER_ARG_NAME",e.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME="FUNCTIONS_DEFAULT_ARRAY_ARG_NAME",e.PROCEDURES_DEFNORETURN_TOOLTIP="PROCEDURES_DEFNORETURN_TOOLTIP",e.PROCEDURES_DEFNORETURN_HELPURL="PROCEDURES_DEFNORETURN_HELPURL",e.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME="FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME",e.FUNCTIONS_DEFAULT_FUNCTION_NAME="FUNCTIONS_DEFAULT_FUNCTION_NAME",e.FUNCTION_CREATE_NEW="FUNCTION_CREATE_NEW",e.FUNCTION_FLYOUT_LABEL="FUNCTION_FLYOUT_LABEL",e.FUNCTIONS_EDIT_OPTION="FUNCTIONS_EDIT_OPTION",e.FUNCTIONS_CREATE_CALL_OPTION="FUNCTIONS_CREATE_CALL_OPTION",n(o.REPORTERS_HUE,"#A80000"),n(o.FUNCTIONS_CALL_TITLE,"call"),n(o.FUNCTIONS_DEFNORETURN_TITLE,"function"),n(o.FUNCTIONS_GO_TO_DEFINITION_OPTION,"Go to Definition"),n(o.FUNCTIONS_DEFAULT_BOOLEAN_ARG_NAME,"bool"),n(o.FUNCTIONS_DEFAULT_STRING_ARG_NAME,"text"),n(o.FUNCTIONS_DEFAULT_NUMBER_ARG_NAME,"num"),n(o.FUNCTIONS_DEFAULT_ARRAY_ARG_NAME,"array"),n(o.FUNCTIONS_DEFAULT_CUSTOM_ARG_NAME,"value"),n(o.FUNCTIONS_DEFAULT_FUNCTION_NAME,"doSomething"),n(o.FUNCTION_CREATE_NEW,"Make a Function"),n(o.FUNCTION_FLYOUT_LABEL,"Your Functions"),n(o.FUNCTIONS_EDIT_OPTION,"Edit Function"),n(o.FUNCTIONS_CREATE_CALL_OPTION,"Create 'call %1'")},{blockly:175}],113:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.REMOVE_IMAGE_DATAURI=i.ADD_IMAGE_DATAURI=i.COLLAPSE_IMAGE_DATAURI=void 0,i.COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",i.ADD_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJhZGQuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjQ4MjEiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NjkiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjEyLjkxNTI1NCIKICAgICBpbmtzY2FwZTpjeT0iMTYuMDY3Nzk2IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0icmVwZWF0IiAvPjxzdHlsZQogICAgIHR5cGU9InRleHQvY3NzIgogICAgIGlkPSJzdHlsZTMiPgoJLnN0MHtmaWxsOiNDRjhCMTc7fQoJLnN0MXtmaWxsOiNGRkZGRkY7fQo8L3N0eWxlPjx0aXRsZQogICAgIGlkPSJ0aXRsZTUiPnJlcGVhdDwvdGl0bGU+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMiCiAgICAgd2lkdGg9IjQuMDUwMDAwMiIKICAgICBoZWlnaHQ9IjEyLjM5NzA1IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSItMTguMTk4NTI2IgogICAgIHJ4PSIwLjgxIgogICAgIHJ5PSIwLjgxIgogICAgIHRyYW5zZm9ybT0ic2NhbGUoMSwtMSkiIC8+PHJlY3QKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MTtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MC4wNzg0MzEzNyIKICAgICBpZD0icmVjdDQxNDMtMSIKICAgICB3aWR0aD0iNC4wNTAwMDAyIgogICAgIGhlaWdodD0iMTIuMzk3MTE5IgogICAgIHg9IjkuOTc1MDAwNCIKICAgICB5PSI1LjgwMTQ0MDciCiAgICAgcng9IjAuODEiCiAgICAgcnk9IjAuODEiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwxLDEsMCwwLDApIiAvPjxjaXJjbGUKICAgICBzdHlsZT0ib3BhY2l0eToxO2ZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpzcXVhcmU7c3Ryb2tlLWxpbmVqb2luOnJvdW5kO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1kYXNob2Zmc2V0OjA7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICBpZD0icGF0aDQxMzYiCiAgICAgY3g9IjEyIgogICAgIGN5PSIxMiIKICAgICByPSIxMC41MDMxOTEiIC8+PC9zdmc+",i.REMOVE_IMAGE_DATAURI="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMS4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4KCjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgdmVyc2lvbj0iMS4xIgogICBpZD0icmVwZWF0IgogICB4PSIwcHgiCiAgIHk9IjBweCIKICAgdmlld0JveD0iMCAwIDI0IDI0IgogICBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAyNCAyNDsiCiAgIHhtbDpzcGFjZT0icHJlc2VydmUiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTEgcjEzNzI1IgogICBzb2RpcG9kaTpkb2NuYW1lPSJyZW1vdmUuc3ZnIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGExNSI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+cmVwZWF0PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczEzIiAvPjxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZjFhZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTY4MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5NTAiCiAgICAgaWQ9Im5hbWVkdmlldzExIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTp6b29tPSIxOS42NjY2NjciCiAgICAgaW5rc2NhcGU6Y3g9IjAuMDUwODQ3NTIxIgogICAgIGlua3NjYXBlOmN5PSI5Ljk2NjEwMTciCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJyZXBlYXQiIC8+PHN0eWxlCiAgICAgdHlwZT0idGV4dC9jc3MiCiAgICAgaWQ9InN0eWxlMyI+Cgkuc3Qwe2ZpbGw6I0NGOEIxNzt9Cgkuc3Qxe2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+PHRpdGxlCiAgICAgaWQ9InRpdGxlNSI+cmVwZWF0PC90aXRsZT48cmVjdAogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDojZmZmZmZmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDoxO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eTowLjA3ODQzMTM3IgogICAgIGlkPSJyZWN0NDE0My0xIgogICAgIHdpZHRoPSI0LjA1MDAwMDIiCiAgICAgaGVpZ2h0PSIxMi4zOTcxMTkiCiAgICAgeD0iOS45NzUwMDA0IgogICAgIHk9IjUuODAxNDQwNyIKICAgICByeD0iMC44MSIKICAgICByeT0iMC44MSIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLDEsMSwwLDAsMCkiIC8+PGNpcmNsZQogICAgIHN0eWxlPSJvcGFjaXR5OjE7ZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MDtzdHJva2Utb3BhY2l0eToxIgogICAgIGlkPSJwYXRoNDEzNiIKICAgICBjeD0iMTIiCiAgICAgY3k9IjEyIgogICAgIHI9IjEwLjUwMzE5MSIgLz48L3N2Zz4="},{}],114:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isVariableBlockType=i.validateFunctionExternal=i.flyoutCategory=i.getShadowBlockInfoFromType_=i.findUniqueParamName=i.getArgumentReporterParent=i.doArgumentReporterDragChecks=i.isFunctionArgumentReporter=i.getArgMap=i.mutateCallersAndDefinition=i.idsInUse=i.findLegalName=i.createCustomArgumentEditor=i.createCustomArgumentReporter=i.isCustomType=i.getAllFunctionDefinitionBlocks=i.getDefinition=i.rename=void 0;let g=e("blockly"),m=e("./constants"),h=e("./functionManager"),d=e("./msg"),p=e("./blocks/functionDeclarationBlock"),r=e("../../compiler/util"),l=e("../../loader");function _(e,t){for(var i of t.getTopBlocks(!1))if(i.type===m.FUNCTION_DEFINITION_BLOCK_TYPE)if(i.getName()===e)return i;return null}function b(e){return e.getTopBlocks(!1).filter(e=>e.type===m.FUNCTION_DEFINITION_BLOCK_TYPE)}function s(e,t,i){i=i.newBlock(e),e=g.utils.xml.createElement("mutation");return e.setAttribute("typename",t),i.domToMutation(e),i}function n(e,t,i){if(null==i||!i.isInFlyout)for(var s=a(t,i);s[e];)e=o(e);return e}function a(e,i,s){let o={};return e.getVariableMap().getAllVariables().forEach(function(e){o[e.getName()]=!0}),e.getAllBlocks(!1).forEach(function(e){var t=e;t==i||s&&t.getFunctionId&&t.getFunctionId()==s||(t.type==m.FUNCTION_DEFINITION_BLOCK_TYPE?o[t.getName()]=!0:"procedures_defreturn"!=e.type&&e.type)}),o}function o(e){var t=e.match(/^(.*?)(\d+)$/);return t?e=t[1]+(parseInt(t[2],10)+1):e+="2",e}function c(e,t,i){var s=_(e,t);if(s){var o,n,r,l,a,c=s.mutationToDom(),u=f(c,!1),h=f(i,!0),d=[];for(o of s.getDescendants(!1))T(o)&&((n=E(o,o))&&n!==s||(n=o.getFieldValue("VALUE"))!==(r=h[u[n]])&&(l=o.outputConnection.targetBlock().id,a=o.outputConnection.targetConnection.getParentInput().name,d.push({id:o.id,type:o.type,oldName:n,newName:r,targetBlockId:l,targetInputName:a})));var p=((e,t)=>{var i,s,o=[];for(i of t.getAllBlocks(!1))i.type!==m.FUNCTION_CALL_BLOCK_TYPE&&i.type!==m.FUNCTION_CALL_OUTPUT_BLOCK_TYPE||(s=i).getName()===e&&o.push(s);return o})(e,s.workspace).map(e=>({id:e.id,oldMutation:g.utils.xml.domToText(e.mutationToDom()),shadows:e.serializeChangedInputs(i)})),p=new v(s.id,p,g.Xml.domToText(c),g.Xml.domToText(i),d);p.workspaceId=t.id,p.run(!0),g.Events.fire(p)}else pxt.warn("Attempted to change function "+e+", but no definition block was found on the workspace")}function f(t,i){var s={};for(let e=0;e<t.childNodes.length;++e){var o=t.childNodes[e],n=i?o.getAttribute("id"):o.getAttribute("name"),o=i?o.getAttribute("name"):o.getAttribute("id");s[n]=o}return s}function T(e){return e.type==m.ARGUMENT_REPORTER_BOOLEAN_BLOCK_TYPE||e.type==m.ARGUMENT_REPORTER_NUMBER_BLOCK_TYPE||e.type==m.ARGUMENT_REPORTER_STRING_BLOCK_TYPE||e.type==m.ARGUMENT_REPORTER_ARRAY_BLOCK_TYPE||e.type==m.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE}function E(e,t){pxt.U.assert(T(e));let i=e.getFieldValue("VALUE"),s=e.getTypeName();for(;t.getSurroundParent();)for(var o of(t=t.getSurroundParent()).inputList)if(o.connection&&o.name.startsWith(l.DRAGGABLE_PARAM_INPUT_PREFIX)){var n=o.name.slice(l.DRAGGABLE_PARAM_INPUT_PREFIX.length);if(n===i){let e=s;return"string"!==e&&"number"!==e&&"boolean"!==e||(e=e.charAt(0).toUpperCase()+e.slice(1)),-1!==o.connection.getCheck().indexOf(e)?t:void 0}}if(!t.isEnabled())return t;if((0,r.isFunctionDefinition)(t)&&t.getArguments().some(e=>e.name===i&&e.type===s))return t}i.rename=function(e){e=e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"");var t,i=this.sourceBlock_,s=n(e,i.workspace,i),o=this.getValue();return e?s?o?(o!=e&&o!=s&&(i.name_=s,t=i.mutationToDom(),c(i.name_=o,i.workspace,t)),s):i.name_=s:e:o},i.getDefinition=_,i.getAllFunctionDefinitionBlocks=b,i.isCustomType=function(e){return!("boolean"==e||"string"==e||"number"==e)},i.createCustomArgumentReporter=function(e,t){return s(m.ARGUMENT_REPORTER_CUSTOM_BLOCK_TYPE,e,t)},i.createCustomArgumentEditor=function(e,t){return s(m.ARGUMENT_EDITOR_CUSTOM_BLOCK_TYPE,e,t)},i.findLegalName=n,i.idsInUse=function(e){let t=[];return e.getAllBlocks(!1).forEach(function(e){e.type==m.FUNCTION_DEFINITION_BLOCK_TYPE&&t.push(e.getFunctionId())}),t},i.mutateCallersAndDefinition=c,i.getArgMap=f,i.isFunctionArgumentReporter=T,i.doArgumentReporterDragChecks=function(e,t,i){return!T(e=e.getSourceBlock())||!(t=t.getSourceBlock())||!!E(e,t)},i.getArgumentReporterParent=E,i.findUniqueParamName=function(e,t){for(;i=e,(s=t)&&-1!=s.indexOf(i);)e=o(e);var i,s;return e},i.getShadowBlockInfoFromType_=function(e,t){let i="",s="",o="";switch(e){case"boolean":i="logic_boolean",s="BOOL",o="TRUE";break;case"number":i="math_number",s="NUM",o="1";break;case"string":i="text",s="TEXT",o="abc";break;case"Array":i="variables_get",s="VAR",o=g.Variables.getOrCreateVariablePackage(t,null,"list","").getId();break;default:i="variables_get",s="VAR",o=g.Variables.getOrCreateVariablePackage(t,null,h.FunctionManager.getInstance().getArgumentNameForType(e),"").getId()}return[i,s,o]},i.flyoutCategory=function(t){var e,i=[],s=document.createElement("button"),o=g.Msg[d.MsgKey.FUNCTION_CREATE_NEW],n="CREATE_FUNCTION";s.setAttribute("text",o),s.setAttribute("callbackKey",n),t.registerButtonCallback(n,()=>{var e=t;g.hideChaff(),g.getSelected()&&g.getSelected().unselect(),h.FunctionManager.getInstance().editFunctionExternal((0,p.newFunctionMutation)(e),(s=>function(t){if(t){var i,t='<xml><block type="'+m.FUNCTION_DEFINITION_BLOCK_TYPE+'">'+g.Xml.domToText(t)+"</block></xml>",t=g.utils.xml.textToDom(t);g.Events.setGroup(!0);let e=g.Xml.domToBlock(t.firstChild,s);e.updateDisplay_(),s.getMetrics&&(t=s.getMetrics(),i=e.getHeightWidth(),e.moveBy(t.viewLeft+t.viewWidth/2-i.width/2,t.viewTop+t.viewHeight/2-i.height/2),e.scheduleSnapAndBump()),s.centerOnBlock(e.id,!0),g.Events.setGroup(!1),setTimeout(()=>{e.afterWorkspaceLoad&&e.afterWorkspaceLoad()})}})(e))}),i.push(s);for(e of b(t)){var r=e.getName(),l=e.getArguments(),a=g.utils.xml.createElement("block"),c=(a.setAttribute("type","function_call"),a.setAttribute("gap","16"),g.utils.xml.createElement("mutation"));c.setAttribute("name",r),a.appendChild(c);for(let e=0;e<l.length;e++){var u=g.utils.xml.createElement("arg");u.setAttribute("name",l[e].name),u.setAttribute("type",l[e].type),u.setAttribute("id",l[e].id),c.appendChild(u)}i.push(a)}return i},i.validateFunctionExternal=function(t,e){var i=t.getAttribute("name");if(!i)return g.dialog.alert(g.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;var s={};for(let e=0;e<t.childNodes.length;++e){var o=t.childNodes[e].getAttribute("name");if(!o)return g.dialog.alert(g.Msg.FUNCTION_WARNING_EMPTY_NAME),!1;if(s[o])return g.dialog.alert(g.Msg.FUNCTION_WARNING_DUPLICATE_ARG),!1;s[o]=!0}return s[i]?(g.dialog.alert(g.Msg.FUNCTION_WARNING_ARG_NAME_IS_FUNCTION_NAME),!1):!a(e,null,t.getAttribute("functionid"))[i]||(g.dialog.alert(g.Msg.VARIABLE_ALREADY_EXISTS.replace("%1",i)),!1)},i.isVariableBlockType=function(e){switch(e){case"argument_reporter_boolean":case"argument_reporter_number":case"argument_reporter_string":case"argument_reporter_array":case"argument_reporter_custom":case"variables_get_reporter":case"variables_get":return!0}return!1};class v extends g.Events.Abstract{constructor(e,t,i,s,o){super(),this.definition=e,this.callers=t,this.oldMutation=i,this.newMutation=s,this.descendantChanges=o,this.type="pxt_mutate_function"}static fromJson(e,t,i){t=i=super.fromJson(e,t,i||new v(e.definition,e.callers,e.oldMutation,e.newMutation,e.descendantChanges));return t.definition=e.definition,t.callers=e.callers,t.oldMutation=e.oldMutation,t.newMutation=e.newMutation,t.descendantChanges=e.descendantChanges,i}toJson(){return{type:this.type,group:this.group,definition:this.definition,callers:this.callers,oldMutation:this.oldMutation,newMutation:this.newMutation,descendantChanges:this.descendantChanges}}run(e){var t,i,s,o,n,r=this.getEventWorkspace_(),l=g.utils.xml.textToDom(e?this.newMutation:this.oldMutation),a=r.getBlockById(this.definition);g.Events.disable(),a.domToMutation(l),a.updateArgumentInputs_(),a.afterWorkspaceLoad();for(t of this.callers){var c,u=r.getBlockById(t.id);if(e)u.domToMutation(l);else{u.domToMutation(g.utils.xml.textToDom(t.oldMutation));for(var h of t.shadows)h.connectedBlock?(c=r.getBlockById(h.connectedBlock),u.getInput(h.inputName).connection.connect(c.outputConnection)):u.getInput(h.inputName).connection.setShadowState(h.connectedShadow)}}for(i of this.descendantChanges)i.newName?r.getBlockById(i.id).setFieldValue(e?i.newName:i.oldName,"VALUE"):e?(s=r.getBlockById(i.id))&&s.dispose():((s=r.newBlock(i.type,i.id)).setFieldValue(i.oldName,"VALUE"),s.initSvg(),(n=(o=r.getBlockById(i.targetBlockId).getInput(i.targetInputName).connection).targetBlock())&&!n.isShadow()&&n.dispose(),o.connect(s.outputConnection));g.Events.enable()}}},{"../../compiler/util":15,"../../loader":77,"./blocks/functionDeclarationBlock":102,"./constants":105,"./functionManager":110,"./msg":112,blockly:175}],115:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});i=e("blockly");i.Extensions.unregister("logic_compare"),i.Extensions.register("logic_compare",function(){})},{blockly:175}],116:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let r=e("blockly"),l=e("../../fields/field_imagenotext");r.Blocks.controls_if=Object.assign(Object.assign({},{elseifCount_:0,elseCount_:0,valueConnections_:[],statementConnections_:[],elseStatementConnection_:null,mutationToDom:function(){var e;return this.elseifCount_||this.elseCount_?(e=r.utils.xml.createElement("mutation"),this.elseifCount_&&e.setAttribute("elseif",this.elseifCount_+""),this.elseCount_&&e.setAttribute("else","1"),e):null},domToMutation:function(e){e&&(this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_())},storeConnections_:function(t){t=t||0,this.valueConnections_=[null],this.statementConnections_=[null],this.elseStatementConnection_=null;for(let e=1;e<=this.elseifCount_;e++)t!=e&&(this.valueConnections_.push(this.getInput("IF"+e).connection.targetConnection),this.statementConnections_.push(this.getInput("DO"+e).connection.targetConnection));this.getInput("ELSE")&&(this.elseStatementConnection_=this.getInput("ELSE").connection.targetConnection)},restoreConnections_:function(){var t,e;for(let e=1;e<=this.elseifCount_;e++)this.reconnectValueConnection_(e,this.valueConnections_),null!=(t=this.statementConnections_[e])&&t.reconnect(this,"DO"+e);this.getInput("ELSE")&&null!=(e=this.elseStatementConnection_)&&e.reconnect(this,"ELSE")},addElse_:function(){this.update_(()=>{this.elseCount_++})},removeElse_:function(){this.update_(()=>{this.elseCount_--})},addElseIf_:function(){this.update_(()=>{this.elseifCount_++})},removeElseIf_:function(e){this.update_(()=>{this.elseifCount_--},e)},update_:function(e,t){r.Events.setGroup(!0),this.storeConnections_(t);let i=this;t=i.mutationToDom(),t=t&&r.Xml.domToText(t);e&&e.call(this),this.updateShape_(),i instanceof r.BlockSvg&&i.initSvg();let s=r.Events.getGroup();e=i.mutationToDom(),e=e&&r.Xml.domToText(e);t!=e&&(r.Events.fire(new r.Events.BlockChange(i,"mutation",null,t,e)),setTimeout(function(){r.Events.setGroup(s),i.bumpNeighbours(),r.Events.setGroup(!1)},r.config.bumpDelay)),i.rendered&&i instanceof r.BlockSvg&&i.queueRender(),this.restoreConnections_(),r.Events.setGroup(!1)},updateShape_:function(){this.getInput("ELSE")&&(this.removeInput("ELSE"),this.removeInput("ELSETITLE"),this.removeInput("ELSEBUTTONS"));let e=1;for(;this.getInput("IF"+e);)this.removeInput("IF"+e),this.removeInput("IFTITLE"+e),this.removeInput("IFBUTTONS"+e),this.removeInput("DO"+e),e++;for(let e=1;e<=this.elseifCount_;e++){var t=(e=>function(){o.removeElseIf_(e)})(e);this.appendValueInput("IF"+e).setCheck("Boolean").appendField(r.Msg.CONTROLS_IF_MSG_ELSEIF).setShadowDom((s=i=void 0,(i=document.createElement("shadow")).setAttribute("type","logic_boolean"),(s=document.createElement("field")).setAttribute("name","BOOL"),s.textContent="FALSE",i.appendChild(s),i)),this.appendDummyInput("IFTITLE"+e).appendField(r.Msg.CONTROLS_IF_MSG_THEN),this.appendDummyInput("IFBUTTONS"+e).appendField(new l.FieldImageNoText(this.REMOVE_IMAGE_DATAURI,24,24,"*",t,!1)).setAlign(r.inputs.Align.RIGHT),this.appendStatementInput("DO"+e)}var i,s;this.elseCount_&&(this.appendDummyInput("ELSETITLE").appendField(r.Msg.CONTROLS_IF_MSG_ELSE),this.appendDummyInput("ELSEBUTTONS").setAlign(r.inputs.Align.RIGHT).appendField(new l.FieldImageNoText(this.REMOVE_IMAGE_DATAURI,24,24,"*",this.removeElse_.bind(this),!1)),this.appendStatementInput("ELSE")),this.getInput("ADDBUTTON")&&this.removeInput("ADDBUTTON");let o=this;function n(){0==o.elseCount_?o.addElse_():(o.elseifCount_||(o.elseifCount_=0),o.addElseIf_())}this.appendDummyInput("ADDBUTTON").appendField(new l.FieldImageNoText(this.ADD_IMAGE_DATAURI,24,24,"*",n,!1))},rebuildShape_:function(){var e=[null],t=[null];let i=null,s=(this.getInput("ELSE")&&(i=this.getInput("ELSE").connection.targetConnection),1);for(;this.getInput("IF"+s);){var o=this.getInput("IF"+s),n=this.getInput("DO"+s);e.push(o.connection.targetConnection),t.push(n.connection.targetConnection),s++}this.updateShape_(),this.reconnectChildBlocks_(e,t,i)},reconnectChildBlocks_:function(t,i,e){var s;for(let e=1;e<=this.elseifCount_;e++)this.reconnectValueConnection_(e,t),null!=(s=i[e])&&s.reconnect(this,"DO"+e);null!=e&&e.reconnect(this,"ELSE")},reconnectValueConnection_:function(e,t){var i=null==(i=this.getInput("IF"+e))?void 0:i.connection.targetBlock();t[e]&&(t[e].reconnect(this,"IF"+e),i)&&!i.getParent()&&i.dispose()}}),{init(){var e;r.Extensions.apply("inline-svgs",this,!1),this.elseifCount_=0,this.elseCount_=0,this.setHelpUrl(r.Msg.CONTROLS_IF_HELPURL),this.appendValueInput("IF0").setCheck("Boolean").appendField(r.Msg.CONTROLS_IF_MSG_IF),this.appendDummyInput("THEN0").appendField(r.Msg.CONTROLS_IF_MSG_THEN),this.appendStatementInput("DO0"),this.workspace instanceof r.WorkspaceSvg&&(e=this.workspace.getRenderer(),this.setOutputShape(e.getConstants().SHAPES.HEXAGONAL)),this.updateShape_(),this.setInputsInline(!0),this.setColour(r.Msg.LOGIC_HUE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(()=>this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?r.Msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?r.Msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?r.Msg.CONTROLS_IF_TOOLTIP_4:"":r.Msg.CONTROLS_IF_TOOLTIP_1)}})},{"../../fields/field_imagenotext":38,blockly:175}],117:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./extensions"),i),o(e("./ifElse"),i)},{"./extensions":115,"./ifElse":116}],118:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldSlider=void 0;let o=e("blockly");class s extends o.FieldNumber{constructor(e,t,i,s,o,n,r,l){super(e,t,i,s,r,l),this.keyboardControlActive=!1,"string"==typeof o?this.step_=parseFloat(o):"number"==typeof o&&(this.step_=o),this.labelText_=n}hasMin(){return this.getMin()>-1/0}hasMax(){return this.getMax()<1/0}getStep(){return this.step_}getLabel(){return this.labelText_}setLabel(e){this.labelText_=e}setOptions(e,t,i,s){this.setConstraints(e,t,s),this.step_=parseFloat(i)||void 0}getFieldDescription(){return this.getValue()+""}doClassValidation_(e){if(null===e)return null;e=(e=(e=(e=""+e).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity");let t=Number(e||0);if(isNaN(t))return null;this.precision_&&isFinite(t)&&(t=Math.round(t/this.precision_)*this.precision_);let i=String(this.precision_);e=(i=-1!==i.indexOf("e")?this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}):i).indexOf(".");let s;return s=-1===e?this.precision_?0:null:i.length-e-1,t=null!==s?Number(t.toFixed(s)):t}widgetDispose_(){this.removeEventListeners(),super.widgetDispose_()}addEventListeners(){this.inputKeydownHandler=this.inputKeydownListener.bind(this),this.htmlInput_.addEventListener("keydown",this.inputKeydownHandler),this.sliderKeydownHandler=this.sliderKeydownListener.bind(this),this.slider_.addEventListener("keydown",this.sliderKeydownHandler),this.sliderBlurHandler=this.sliderBlurListener.bind(this),this.slider_.addEventListener("blur",this.sliderBlurHandler),this.sliderPointerdownHandler=this.sliderPointerdownListener.bind(this),this.slider_.addEventListener("pointerdown",this.sliderPointerdownHandler)}removeEventListeners(){this.htmlInput_.removeEventListener("keydown",this.inputKeydownHandler),this.slider_.removeEventListener("keydown",this.sliderKeydownHandler),this.slider_.removeEventListener("blur",this.sliderBlurHandler),this.slider_.removeEventListener("pointerdown",this.sliderPointerdownHandler)}inputKeydownListener(e){"ArrowDown"===e.key&&(e.preventDefault(),this.keyboardControlActive=!0,this.slider_.focus())}sliderPointerdownListener(e){this.keyboardControlActive=!1}sliderKeydownListener(e){switch(e.key){case"ArrowUp":e.preventDefault(),this.htmlInput_.focus();break;case"Enter":case" ":e.preventDefault(),e.stopPropagation(),o.hideChaff()}}sliderBlurListener(e){this.keyboardControlActive=!1}showEditor_(e,t){super.showEditor_(e,!0),o.DropDownDiv.hideWithoutAnimation(),o.DropDownDiv.clearContent(),o.DropDownDiv.getContentDiv().style.height="";e=o.DropDownDiv.getContentDiv();e.setAttribute("role","menu"),e.setAttribute("aria-haspopup","true"),this.addSlider_(e),o.DropDownDiv.setColour("#ffffff","#dddddd"),o.DropDownDiv.showPositionedByBlock(this,this.sourceBlock_,void 0,void 0,!1),this.addEventListeners(),t||this.htmlInput_.focus()}addSlider_(e){var t;this.labelText_&&(t=this.createLabelDom_(this.labelText_),e.appendChild(t[0]),this.readout_=t[1],this.setReadout(this.value_)),this.slider_=this.createSlider(),e.appendChild(this.slider_);let s=()=>{pxt.BrowserUtils.isFirefox()||this.keyboardControlActive||this.htmlInput_.focus()};o.browserEvents.bind(this.slider_,"input",this,e=>{var t,i=parseFloat(this.slider_.value)||0;null!==i&&(this.setValue(i),t=this.htmlInput_)&&(t.value=i+"",s())}),o.browserEvents.bind(this.slider_,"focus",this,e=>{s()})}setValue(e,t){super.setValue(e,t),this.updateDom(),this.slider_&&(this.slider_.value=this.getValue()+"")}createSlider(){var e=document.createElement("input");e.setAttribute("class","blocklyFieldSlider"),e.type="range",e.min=this.getMin()+"",e.max=this.getMax()+"",e.value=this.getValue()+"";let t;return this.sourceBlock_ instanceof o.BlockSvg&&("#ffffff"===this.sourceBlock_.getColour()?this.sourceBlock_.getParent()&&(t=this.sourceBlock_.getParent().getColourTertiary()):t=this.sourceBlock_.getColourTertiary()),t&&e.setAttribute("style","--blocklyFieldSliderBackgroundColor: "+t),Number.isNaN(this.step_)||(e.step=this.step_+""),e}updateDom(){this.setReadout(this.getValue())}setReadout(e){this.readout_&&(this.readout_.innerText=e+"")}createLabelDom_(e){var t=document.createElement("div"),i=(t.setAttribute("class","blocklyFieldSliderLabel"),document.createElement("span")),s=(i.setAttribute("class","blocklyFieldSliderReadout"),document.createElement("span"));return s.setAttribute("class","blocklyFieldSliderLabelText"),s.innerText=e,t.appendChild(s),t.appendChild(i),[t,i]}}i.FieldSlider=s,o.fieldRegistry.register("field_slider",s),o.Css.register(`
:root {
    --blocklyFieldSliderBackgroundColor: #547AB2;
}
.blocklyFieldSliderLabel {
    font-family: "Helvetica Neue", "Segoe UI", Helvetica, sans-serif;
    font-size: 0.65rem;
    color: $colour_toolboxText;
    margin: 8px;
}
.blocklyFieldSliderLabelText {
    font-weight: bold;
}
.blocklyFieldSliderReadout {
    margin-left: 10px;
}

input[type=range].blocklyFieldSlider {
    -webkit-appearance: none;
    width: 100%;
}
input[type=range].blocklyFieldSlider:focus {
    outline: none;
}
input[type=range].blocklyFieldSlider::-webkit-slider-runnable-track {
    -webkit-appearance: none;
    margin: 8px;
    height: 22px;
    width: 150px;
    outline: none;
    border-radius: 11px;
    margin-bottom: 20px;
    background: var(--blocklyFieldSliderBackgroundColor);
}
input[type=range].blocklyFieldSlider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 26px;
    height: 26px;
    margin-top: -1px;
    background-color: white;
    border-radius: 100%;
    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);
    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);
    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);
    cursor: pointer;
}
input[type=range].blocklyFieldSlider:focus-visible::-webkit-slider-thumb {
    outline: 2px solid white; 
    outline-offset: 3px;
    -webkit-box-shadow: 0 0 0 3px var(--pxt-focus-border);
    -moz-box-shadow: 0 0 0 3px var(--pxt-focus-border);
    box-shadow: 0 0 0 3px var(--pxt-focus-border);
}
input[type=range].blocklyFieldSlider::-moz-range-track {
    margin: 8px;
    height: 22px;
    width: 95%;
    outline: none;
    border-radius: 11px;
    margin-bottom: 20px;
    background: #547AB2;
}
input[type=range].blocklyFieldSlider::-moz-range-thumb {
    width: 26px;
    height: 26px;
    margin-top: -1px;
    background-color: white;
    border-radius: 100%;
    -webkit-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);
    -moz-box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);
    box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.15);
    cursor: pointer;
}
`)},{blockly:175}],119:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./fieldSlider"),i),o(e("./numberBlocks"),i)},{"./fieldSlider":118,"./numberBlocks":120}],120:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let s=e("blockly");i=new s.zelos.ConstantProvider,s.defineBlocksWithJsonArray([{type:"math_integer",message0:"%1",args0:[{type:"field_number",name:"NUM",precision:1}],output:"Number",outputShape:i.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_whole_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0,precision:1}],output:"Number",outputShape:i.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_positive_number",message0:"%1",args0:[{type:"field_number",name:"NUM",min:0}],output:"Number",outputShape:i.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_number_minmax",message0:"%1",args0:[{type:"field_slider",name:"SLIDER",value:0,step:1,labelText:"Number"}],output:"Number",outputShape:i.SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",mutator:"math_number_minmax_mutator",extensions:["parent_tooltip_when_inline"]}]),e={mutationToDom:function(){var e=this.inputList[0].fieldRow[0],t=s.utils.xml.createElement("mutation");return e.hasMin()&&t.setAttribute("min",e.getMin()+""),e.hasMax()&&t.setAttribute("max",e.getMax()+""),null!=e.getLabel()&&t.setAttribute("label",e.getLabel()),null!=e.getStep()&&t.setAttribute("step",e.getStep()+""),null!=e.getPrecision()&&t.setAttribute("precision",e.getPrecision()+""),t},domToMutation:function(e){var t=this.inputList[0].fieldRow[0],i=e.getAttribute("min"),s=e.getAttribute("max"),o=e.getAttribute("step"),n=e.getAttribute("label"),e=e.getAttribute("precision");t.setLabel(n),t.setOptions(i,s,o,e)}};s.Extensions.registerMutator("math_number_minmax_mutator",e)},{blockly:175}],121:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.showEditorMixin=void 0;let u=e("blockly"),h=e("../../fields");i.showEditorMixin=function(e){var s=this.getSourceBlock();if(!s)throw new u.UnattachedFieldError;var o=new u.Menu,n=(o.setRole(u.utils.aria.Role.LISTBOX),this.menu_=o,this.getOptions(!1));let r=null;var l,a,c=e=>{u.DropDownDiv.hideIfOwner(this,!0),this.onItemSelected_(this.menu_,e)};for(let i=0;i<n.length;i++){let[e,t]=n[i];"SEPARATOR"===t?(a=new d(""),o.addChild(a)):(l=(a=void 0,h.isImageProperties)(e)?((a=new Image(e.width,e.height)).src=e.src,a.alt=e.alt||"",a):e,(l=new u.MenuItem(l,t)).setRole(u.utils.aria.Role.OPTION),l.setRightToLeft(s.RTL),l.setCheckable(!0),o.addChild(l),l.setChecked(t===this.value_),l.onAction(c,this),t===this.value_&&(r=l))}e&&"number"==typeof e.clientX?this.menu_.openingCoords=new u.utils.Coordinate(e.clientX,e.clientY):this.menu_.openingCoords=null,u.DropDownDiv.clearContent(),u.DropDownDiv.getContentDiv().style.height="";var t,e=this.menu_.render(u.DropDownDiv.getContentDiv());u.utils.dom.addClass(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(e=s.getColour(),t=this.sourceBlock_.style.colourTertiary,u.DropDownDiv.setColour(e,t)),u.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),u.DropDownDiv.getContentDiv().style.height=this.menu_.getSize().height+"px",this.menu_.focus(),r&&this.menu_.setHighlighted(r),this.applyColour()};class d extends u.MenuItem{createDom(){var e=document.createElement("div");return e.id=u.utils.idGenerator.getNextUniqueId(),(this.element_=e).className="blockly-menuseparator",e.setAttribute("role","separator"),e}getElement(){return this.element_}getId(){return this.element_.id}isEnabled(){return!1}}u.Css.register(`
.blockly-menuseparator {
    border-top: 1px solid rgba(0, 0, 0, 0.2);
    margin: 4px 0;
    padding: 0;
}
`)},{"../../fields":70,blockly:175}],122:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldVariable=void 0;let s=e("blockly"),o=e("./fieldDropdownMixin");class n extends s.FieldVariable{constructor(e,t,i,s,o){super(e,t,i,s,o),this.svgRootBinding=null,this.fieldRootBinding=null,this.menuGenerator_=n.dropdownCreate}static dropdownCreate(){var e=s.FieldVariable.dropdownCreate.call(this),t=e.findIndex(e=>"RENAME_VARIABLE_ID"===e[1]);return e.splice(t,0,[s.Msg.NEW_VARIABLE_DROPDOWN,n.CREATE_VARIABLE_ID],[void 0,"SEPARATOR"]),e}onItemSelected_(e,t){if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&t.getValue()===n.CREATE_VARIABLE_ID)return void s.Variables.createVariableButtonHandler(this.sourceBlock_.workspace,e=>{e=this.sourceBlock_.workspace.getVariableMap().getVariable(e);e&&this.setValue(e.getId())});super.onItemSelected_(e,t)}initView(){super.initView(),this.shouldAddBorderRect_()||(this.createBorderRect_(),this.clickTargetRect=this.borderRect_,this.clickTargetRect.setAttribute("stroke-opacity","0"),this.clickTargetRect.setAttribute("fill-opacity","0"),this.borderRect_=void 0)}shouldAddBorderRect_(){if("variables_get"===this.sourceBlock_.type)return!1;for(var e of this.sourceBlock_.inputList)for(var t of e.fieldRow)if(t!==this&&t.EDITABLE)return!0;return!this.sourceBlock_.getInputsInline()||super.shouldAddBorderRect_()}bindEvents_(){this.shouldAddBorderRect_()?super.bindEvents_():(this.svgRootBinding=s.browserEvents.conditionalBind(this.sourceBlock_.getSvgRoot(),"pointerdown",this,e=>{this.sourceBlock_.icons.length||this.onMouseDown_(e)},!1),this.fieldRootBinding=s.browserEvents.conditionalBind(this.getSvgRoot(),"pointerdown",this,e=>{this.sourceBlock_.icons.length&&this.onMouseDown_(e)},!1))}dispose(){super.dispose(),this.svgRootBinding&&(s.browserEvents.unbind(this.svgRootBinding),s.browserEvents.unbind(this.fieldRootBinding))}positionBorderRect_(){super.positionBorderRect_(),this.clickTargetRect&&(this.clickTargetRect.setAttribute("width",String(this.size_.width)),this.clickTargetRect.setAttribute("height",String(this.size_.height)),this.clickTargetRect.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.clickTargetRect.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}showEditor_(e){o.showEditorMixin.call(this,e)}getValue(){var e,t=super.getValue();if(null!=(e=this.sourceBlock_)&&e.isInFlyout&&(null==(e=this.sourceBlock_.workspace)?void 0:e.getPotentialVariableMap()).getVariableById(t))return"potential_"+t;return t}}(i.FieldVariable=n).CREATE_VARIABLE_ID="CREATE_VARIABLE",s.fieldRegistry.unregister("field_variable"),s.fieldRegistry.register("field_variable",n)},{"./fieldDropdownMixin":121,blockly:175}],123:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./fieldVariable"),i)},{"./fieldVariable":122}],124:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isCollapsedInputRow=i.CollapsedInputRow=void 0;let s=e("blockly");class o extends s.blockRendering.InputRow{constructor(e){super(e),this.type|=s.blockRendering.Types.INPUT_ROW|s.blockRendering.Types.getType("COLLAPSED_INPUT_ROW")}measure(){this.width=this.minWidth,this.height=this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT}}i.CollapsedInputRow=o,i.isCollapsedInputRow=function(e){return!!(e.type&s.blockRendering.Types.getType("COLLAPSED_INPUT_ROW"))}},{blockly:175}],125:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ConnectionPreviewer=void 0;let l=e("blockly");class a extends l.InsertionMarkerPreviewer{previewConnection(e,t){super.previewConnection(e,t),t.type!==l.ConnectionType.INPUT_VALUE&&t.type!==l.ConnectionType.OUTPUT_VALUE||this.showDraggedIndicatorWithLine(e,t)}previewReplacement(e,t,i){super.previewReplacement(e,t,i),this.showDraggedIndicatorWithLine(e,t)}showDraggedIndicatorWithLine(e,t){this.connectionLine||(this.connectionLine=l.utils.dom.createSvgElement("line",{class:"blocklyConnectionLine",x1:0,y1:0,x2:0,y2:0},e.sourceBlock_.getSvgRoot()),this.draggedConnectionIndicator=this.createConnectionIndicator(e.sourceBlock_.getSvgRoot(),e),i=t.sourceBlock_.getSvgRoot().querySelector(":scope>.blocklyConnectionIndicatorParent"),this.staticConnectionIndicator=this.createConnectionIndicator(i,t)),this.staticConnectionIndicator.parentElement.appendChild(this.staticConnectionIndicator);var i=a.CONNECTION_INDICATOR_RADIUS,s=e.getOffsetInBlock(),e=l.utils.Coordinate.sum(e.sourceBlock_.getRelativeToSurfaceXY(),s),t=l.utils.Coordinate.sum(t.sourceBlock_.getRelativeToSurfaceXY(),t.getOffsetInBlock()),o=t.x-e.x,t=t.y-e.y,e=Math.atan2(t,o),n=Math.sqrt(o*o+t*t),r=l.Gesture.inProgress();n<2*i+1||!r?l.utils.dom.addClass(this.connectionLine,"hidden"):r&&(l.utils.dom.removeClass(this.connectionLine,"hidden"),this.connectionLine.setAttribute("x1",String(s.x+Math.cos(e)*i)),this.connectionLine.setAttribute("y1",String(s.y+Math.sin(e)*i)),this.connectionLine.setAttribute("x2",String(s.x+o-Math.cos(e)*i)),this.connectionLine.setAttribute("y2",String(s.y+t-Math.sin(e)*i)))}hidePreview(){super.hidePreview(),this.connectionLine&&(this.connectionLine.remove(),this.connectionLine=null,this.draggedConnectionIndicator.remove(),this.draggedConnectionIndicator=null,this.staticConnectionIndicator.remove(),this.staticConnectionIndicator=null,this.staticConnection=null)}createConnectionIndicator(e,t){e=l.utils.dom.createSvgElement("g",{class:"blocklyInputConnectionIndicator"},e),l.utils.dom.createSvgElement("circle",{r:a.CONNECTION_INDICATOR_RADIUS},e),t=t.getOffsetInBlock();return e.setAttribute("transform","translate("+t.x+","+t.y+")"),e}}(i.ConnectionPreviewer=a).CONNECTION_INDICATOR_RADIUS=9},{blockly:175}],126:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.ConstantProvider=void 0;let o=e("blockly");class s extends o.zelos.ConstantProvider{constructor(){super(...arguments),this.FIELD_TEXT_FONTFAMILY='"Consolas", "Monaco", "Menlo", "Ubuntu Mono", "source-code-pro", monospace',this.FIELD_TEXT_FONTWEIGHT="600",this.HIGHLIGHT_GLOW_COLOUR="#FFF200",this.ERROR_HIGHLIGHT_GLOW_COLOR="#FF0000",this.HIGHLIGHT_GLOW_SIZE=1.1,this.ELLIPSES_RADIUS=6,this.ELLIPSES_SPACING=8,this.ellipses=this.makeEllipses()}createDom(e,t,i,s){super.createDom(e,t,i,s);t=o.utils.dom.createSvgElement(o.utils.Svg.DEFS,{},e);this.highlightOutlineFilter=this.createHighlight(t,"blocklyHighlightedGlowFilter",this.HIGHLIGHT_GLOW_COLOUR),this.highlightOutlineFilterId=this.highlightOutlineFilter.id,this.errorOutlineFilter=this.createHighlight(t,"blocklyErrorHighlightedGlowFilter",this.ERROR_HIGHLIGHT_GLOW_COLOR),this.errorOutlineFilterId=this.errorOutlineFilter.id,this.embossFilterOverride=this.createOutline(t,"blocklyBubbleEmbossGlowFilter"),this.embossFilterId=this.embossFilterOverride.id}dispose(){super.dispose(),this.highlightOutlineFilter&&o.utils.dom.removeNode(this.highlightOutlineFilter)}makeEllipses(){var t=this.ELLIPSES_RADIUS,i=this.ELLIPSES_SPACING;let s="";for(let e=0;e<3;e++)s+=o.utils.svgPaths.moveBy(i,0)+o.utils.svgPaths.arc("a","180 1,1",t,o.utils.svgPaths.point(2*t,0));for(let e=0;e<3;e++)s+=o.utils.svgPaths.arc("a","180 1,1",t,o.utils.svgPaths.point(2*-t,0))+o.utils.svgPaths.moveBy(-i,0);return s}getCSS_(e){return super.getCSS_(e).concat([e+" .blocklyConnectionIndicator, "+e+" .blocklyInputConnectionIndicator {","fill: #ff0000;","stroke: #ffff00;","stroke-width: 3px;","}",e+" .blocklyConnectionIndicator {","display: none;","}",e+" .blocklyBlockDragSurface > g > .blocklyDraggable > .blocklyConnectionIndicator {","display: block;","}",e+" .blocklyConnectionLine {","stroke: #ffff00;","stroke-width: 4px;","}",e+" .blocklyConnectionLine.hidden {","display: none;","}",e+" .blocklyFlyoutHeading .blocklyFlyoutLabelText {font-size: 1.5rem;","}"])}createHighlight(e,t,i){t=o.utils.dom.createSvgElement(o.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.HIGHLIGHT_GLOW_SIZE},t),e=o.utils.dom.createSvgElement(o.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},t);return o.utils.dom.createSvgElement(o.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEFLOOD,{"flood-color":i,"flood-opacity":1,result:"outColor"},t),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),t}createOutline(e,t){t=o.utils.dom.createSvgElement(o.utils.Svg.FILTER,{id:t+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:.92},t),e=o.utils.dom.createSvgElement(o.utils.Svg.FECOMPONENTTRANSFER,{result:"outBlur"},t),o.utils.dom.createSvgElement(o.utils.Svg.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},e),o.utils.dom.createSvgElement(o.utils.Svg.FEFLOOD,{"flood-color":"#000000","flood-opacity":.5,result:"outColor"},t),o.utils.dom.createSvgElement(o.utils.Svg.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),e=o.utils.dom.createSvgElement("feMerge",{},t);return o.utils.dom.createSvgElement("feMergeNode",{in:"outBlur"},e),o.utils.dom.createSvgElement("feMergeNode",{in:"outGlow"},e),o.utils.dom.createSvgElement("feMergeNode",{in:"SourceGraphic"},e),t}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case o.ConnectionType.INPUT_VALUE:case o.ConnectionType.OUTPUT_VALUE:return t&&t.includes("Boolean")?this.HEXAGONAL:(t&&t.includes("Number")||t&&t.includes("String"),this.ROUNDED);case o.ConnectionType.PREVIOUS_STATEMENT:case o.ConnectionType.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}}(i.ConstantProvider=s).COLLAPSE_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.354)'%3E%3Cpath d='m1611 367.42q0 53-37 90l-651 651q-38 38-91 38-54 0-90-38l-651-651q-38-36-38-90 0-53 38-91l74-75q39-37 91-37 53 0 90 37l486 486 486-486q37-37 90-37 52 0 91 37l75 75q37 39 37 91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A",s.EXPAND_IMAGE_DATAURI="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg enable-background='new 0 0 24 24' version='1.1' viewBox='0 0 24 24' xml:space='preserve' xmlns='http://www.w3.org/2000/svg'%3E%3Cstyle type='text/css'%3E .st0%7Bfill:%23CF8B17;%7D .st1%7Bfill:%23FFFFFF;%7D%0A%3C/style%3E%3Ctitle%3Erepeat%3C/title%3E%3Ccircle cx='12' cy='12' r='10.503' fill='none' stroke='%23fff' stroke-linecap='square' stroke-linejoin='round' stroke-width='2'/%3E%3Cg transform='matrix(.0086269 0 0 -.0086269 4.8224 17.654)'%3E%3Cpath d='m1611 832q0-53-37-90l-651-651q-38-38-91-38-54 0-90 38l-651 651q-38 36-38 90 0 53 38 91l74 75q39 37 91 37 53 0 90-37l486-486 486 486q37 37 90 37 52 0 91-37l75-75q37-39 37-91z' fill='%23fff'/%3E%3C/g%3E%3C/svg%3E%0A"},{blockly:175}],127:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),e("blockly").Css.register(`
.blocklyDropdownMenu .blocklyMenuItemCheckbox {
    filter: contrast(0) brightness(100);
}

.blocklyVerticalMarker {
    fill: none;
}
`)},{blockly:175}],128:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Drawer=void 0;let r=e("blockly"),s=e("./collapsedInputRow");class o extends r.zelos.Drawer{drawCollapsedStack_(e){var t=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.constants_.INSIDE_CORNERS.width,i=this.constants_.STATEMENT_INPUT_PADDING_LEFT+2*this.constants_.INSIDE_CORNERS.width+r.utils.svgPaths.lineOnAxis("h",-this.constants_.INSIDE_CORNERS.width)+this.constants_.INSIDE_CORNERS.pathTop,s=e.height-2*this.constants_.INSIDE_CORNERS.height,o=this.constants_.INSIDE_CORNERS.pathBottom+r.utils.svgPaths.lineOnAxis("h",this.constants_.INSIDE_CORNERS.width),n=this.constants_.ellipses;this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.bottomRight+r.utils.svgPaths.lineOnAxis("H",t)+i+r.utils.svgPaths.lineOnAxis("v",s/2)+n+r.utils.svgPaths.lineOnAxis("v",s/2)+o+r.utils.svgPaths.lineOnAxis("H",e.xPos+e.width-this.constants_.OUTSIDE_CORNERS.rightHeight)+this.constants_.OUTSIDE_CORNERS.topRight}drawOutline_(){if(this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection)this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_();else{this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){var t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):(0,s.isCollapsedInputRow)(t)?this.drawCollapsedStack_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}}drawLeft_(){if(super.drawLeft_(),this.info_.rows.find(function(e){return(0,s.isCollapsedInputRow)(e)})){let e=this.info_.startY;r.blockRendering.Types.isLeftRoundedCorner(this.info_.topRow.elements[0])&&(e+=this.constants_.OUTSIDE_CORNERS.rightHeight),this.outlinePath_=this.outlinePath_.slice(0,-1),this.outlinePath_+=r.utils.svgPaths.lineOnAxis("V",e)}}}i.Drawer=o},{"./collapsedInputRow":124,blockly:175}],129:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./renderer"),i),o(e("./connectionPreviewer"),i),o(e("./css"),i)},{"./connectionPreviewer":125,"./css":127,"./renderer":132}],130:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.RenderInfo=void 0;let n=e("blockly"),s=e("./collapsedInputRow");class o extends n.zelos.RenderInfo{measure(){if(this.block_)for(var e of this.block_.inputList)e.init();super.measure()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let s=new n.blockRendering.InputRow(this.constants_);this.inputRows.push(s);var i=this.block_.getIcons();for(let e=0,t;t=i[e];e++){var o=new n.blockRendering.Icon(this.constants_,t);this.isCollapsed&&!t.isShownWhenCollapsed()||s.elements.push(o)}let t=void 0;for(let e=0,i;i=this.block_.inputList[e];e++)if(i.isVisible()){this.shouldStartNewRow_(i,t)&&(this.rows.push(s),s=new n.blockRendering.InputRow(this.constants_),this.inputRows.push(s));for(let e=0,t;t=i.fieldRow[e];e++)s.elements.push(new n.blockRendering.Field(this.constants_,t,i));this.addInput_(i,s),t=i}this.isCollapsed&&(this.block_.inputList.find(function(e){return e.type==n.inputs.inputTypes.STATEMENT})?s=this.addCollapsedRow_(s):(s.hasJaggedEdge=!0,s.elements.push(new n.blockRendering.JaggedEdge(this.constants_)))),(s.elements.length||s.hasDummyInput)&&this.rows.push(s),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection;var e=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof n.inputs.StatementInput||this.rows.some(e=>(0,s.isCollapsedInputRow)(e)),e=(this.bottomRow.minHeight=e?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)),e=(e?this.bottomRow.elements.push(new n.blockRendering.SquareCorner(this.constants_)):this.bottomRow.elements.push(new n.blockRendering.RoundCorner(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new n.blockRendering.NextConnection(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_));e?this.bottomRow.elements.push(new n.blockRendering.SquareCorner(this.constants_,"right")):this.bottomRow.elements.push(new n.blockRendering.RoundCorner(this.constants_,"right"))}addCollapsedRow_(e){this.rows.push(e);e=new s.CollapsedInputRow(this.constants_);return e.hasDummyInput=!0,e}}i.RenderInfo=o},{"./collapsedInputRow":124,blockly:175}],131:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.PathObject=void 0;let n=e("blockly"),s="blockly-dotted-outline-on-hover";class o extends n.zelos.PathObject{constructor(){super(...arguments),this.connectionPointIndicators=new WeakMap}setPath(e){super.setPath(e),this.svgPathHighlighted&&this.svgPathHighlighted.setAttribute("d",e)}updateHighlighted(e){e?this.svgPathHighlighted||(e=this.constants,e=this.hasError?e.errorOutlineFilterId:e.highlightOutlineFilterId,this.svgPathHighlighted=this.svgPath.cloneNode(!0),this.svgPathHighlighted.classList.add("pxtRendererHighlight"),this.svgPathHighlighted.setAttribute("fill","none"),this.svgPathHighlighted.setAttribute("filter","url(#"+e+")"),this.svgRoot.appendChild(this.svgPathHighlighted)):this.svgPathHighlighted&&(this.svgRoot.removeChild(this.svgPathHighlighted),this.svgPathHighlighted=null)}updateSelected(e){e&&this.svgPath.classList.remove("hover"),super.updateSelected(e)}addConnectionHighlight(e,t,i,s){e=super.addConnectionHighlight(e,t,i,s);return this.staticConnectionIndicatorParentGroup?this.svgRoot.appendChild(this.staticConnectionIndicatorParentGroup):this.staticConnectionIndicatorParentGroup=n.utils.dom.createSvgElement("g",{class:"blocklyConnectionIndicatorParent"},this.svgRoot),e}removeConnectionHighlight(e){var t;null!=(t=this.staticConnectionIndicatorParentGroup)&&t.remove(),super.removeConnectionHighlight(e)}applyColour(t){if(super.applyColour(t),t.outputConnection){let e=!1;var i,s,o=t.getParent();o&&(t.isShadow()?(s=o.style.colourTertiary,(.2126*(i=n.utils.colour.hexToRgb(s))[0]+.7152*i[1]+.0722*i[2])/255<.15&&(this.svgPath.setAttribute("stroke",n.utils.colour.blend("#ffffff",s,.3)),e=!0)):(i=o.style.colourPrimary)===(s=t.style.colourPrimary)&&(o=n.utils.colour.blend("#0000000",s,.6),s=n.utils.colour.blend("#ffffff",s,.6),pxt.contrastRatio(o,i)>pxt.contrastRatio(s,i)?this.svgPath.setAttribute("stroke",o):this.svgPath.setAttribute("stroke",s),e=!0)),e||this.svgPath.setAttribute("stroke",t.style.colourTertiary)}}setHasDottedOutlineOnHover(e){(this.hasDottedOutlineOnHover=e)?(this.svgPath.classList.add(s),this.mouseOverData||(this.mouseOverData=n.browserEvents.bind(this.svgRoot,"mouseover",this,()=>{this.svgPath.classList.add("hover")}),this.mouseLeaveData=n.browserEvents.bind(this.svgRoot,"mouseleave",this,()=>{this.svgPath.classList.remove("hover")}))):(this.svgPath.classList.remove(s),this.mouseOverData&&(n.browserEvents.unbind(this.mouseOverData),n.browserEvents.unbind(this.mouseLeaveData),this.mouseOverData=void 0,this.mouseLeaveData=void 0),this.svgPath.classList.remove(s))}setHasError(e){this.hasError=e}isHighlighted(){return!!this.svgPathHighlighted}}(i.PathObject=o).CONNECTION_INDICATOR_RADIUS=9,n.Css.register(`
.blockly-dotted-outline-on-hover {
    transition: stroke .4s;
}
.blockly-dotted-outline-on-hover.hover {
    stroke-dasharray: 2;
    stroke: white;
    stroke-width: 2;
}
.blocklyDisabledPattern>.blocklyPath.pxtRendererHighlight {
    fill: none;
}
`)},{blockly:175}],132:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Renderer=void 0;var s=e("blockly");let o=e("./pathObject"),n=e("./constants"),r=e("./info"),l=e("./drawer");class a extends s.zelos.Renderer{makePathObject(e,t){return new o.PathObject(e,t,this.getConstants())}makeConstants_(){return new n.ConstantProvider}makeRenderInfo_(e){return new r.RenderInfo(this,e)}makeDrawer_(e,t){return new l.Drawer(e,t)}render(e){e.updateBeforeRender&&e.updateBeforeRender(),super.render(e)}}i.Renderer=a,s.blockRendering.register("pxt",a)},{"./constants":126,"./drawer":128,"./info":130,"./pathObject":131,blockly:175}],133:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.FieldString=void 0;let s=e("blockly");class o extends s.FieldTextInput{initView(){this.quoteSize_=16,this.quoteWidth_=8,this.quoteLeftX_=0,this.quoteRightX_=0,this.quoteY_=10,this.quoteLeft_&&this.quoteLeft_.parentNode.removeChild(this.quoteLeft_),this.quoteLeft_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),super.initView(),this.quoteRight_&&this.quoteRight_.parentNode.removeChild(this.quoteRight_),this.quoteRight_=s.utils.dom.createSvgElement("text",{"font-size":this.quoteSize_+"px",class:"field-text-quote"},this.fieldGroup_),this.quoteLeft_.appendChild(document.createTextNode('"')),this.quoteRight_.appendChild(document.createTextNode('"'))}updateSize_(e){super.updateSize_(e);var e=this.value_?this.size_.width:1,t=this.positionLeft(e+3);this.textElement_.setAttribute("x",t+""),t+=this.positionRight(t+e+3),this.size_.width=e+t}positionLeft(e){if(!this.quoteLeft_)return 0;let t=0;return t=(this.sourceBlock_.RTL?this.quoteLeftX_=e+this.quoteWidth_+2*o.quotePadding:this.quoteLeftX_=0,this.quoteWidth_+o.quotePadding),this.quoteLeft_.setAttribute("transform","translate("+this.quoteLeftX_+","+this.quoteY_+")"),t}positionRight(e){if(!this.quoteRight_)return 0;let t=0;return t=(this.sourceBlock_.RTL?this.quoteRightX_=o.quotePadding:this.quoteRightX_=e+o.quotePadding,this.quoteWidth_+o.quotePadding),this.quoteRight_.setAttribute("transform","translate("+this.quoteRightX_+","+this.quoteY_+")"),t}}(i.FieldString=o).quotePadding=0,s.Css.register(`
.field-text-quote {
    fill: #a31515 !important;
}
`),s.fieldRegistry.register("field_string",o)},{blockly:175}],134:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./fieldString"),i),o(e("./text"),i),o(e("./join"),i)},{"./fieldString":133,"./join":135,"./text":136}],135:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});let o=e("blockly"),n=e("../../fields/field_imagenotext");o.Extensions.registerMutator("pxt_text_join_mutator",{itemCount_:0,valueConnections_:[],mutationToDom:function(){var e=o.utils.xml.createElement("mutation");return e.setAttribute("items",this.itemCount_+""),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},storeValueConnections_:function(){this.valueConnections_=[];for(let e=0;e<this.itemCount_;e++)this.valueConnections_.push(this.getInput("ADD"+e).connection.targetConnection)},restoreValueConnections_:function(){var t;for(let e=0;e<this.itemCount_;e++)null!=(t=this.valueConnections_[e])&&t.reconnect(this,"ADD"+e)},addItem_:function(){this.storeValueConnections_();var e,t,i;this.update_(()=>{this.itemCount_++}),this.restoreValueConnections_(),1<this.itemCount_&&(i=this.getInput("ADD0"))&&i.connection.targetConnection&&(e=this.getInput("ADD"+(this.itemCount_-1)),i=i.connection.getShadowDom())&&(t=o.utils.xml.createElement("shadow"),i=i.getAttribute("type"),t.setAttribute("type",i),t)&&(t.setAttribute("id",o.utils.idGenerator.genUid()),e.connection.setShadowDom(t))},removeItem_:function(){this.storeValueConnections_();this.update_(()=>{this.itemCount_--}),this.restoreValueConnections_()},update_:function(e){o.Events.setGroup(!0);let t=this;var i=t.mutationToDom(),i=i&&o.Xml.domToText(i);e&&e.call(this),this.updateShape_(),t instanceof o.BlockSvg&&t.initSvg();let s=o.Events.getGroup();e=t.mutationToDom(),e=e&&o.Xml.domToText(e);i!=e&&(o.Events.fire(new o.Events.BlockChange(t,"mutation",null,i,e)),setTimeout(function(){o.Events.setGroup(s),t.bumpNeighbours(),o.Events.setGroup(!1)},o.config.bumpDelay)),t.rendered&&t instanceof o.BlockSvg&&t.queueRender(),o.Events.setGroup(!1)},updateShape_:function(){let e=this;this.getInput("EMPTY")&&this.removeInput("EMPTY"),this.getInput("TITLE")||this.appendDummyInput("TITLE").appendField(o.Msg.TEXT_JOIN_TITLE_CREATEWITH);let t;for(t=0;t<this.itemCount_;t++)this.getInput("ADD"+t)||this.appendValueInput("ADD"+t).setAlign(o.inputs.Align.LEFT);for(;this.getInput("ADD"+t);)this.removeInput("ADD"+t),t++;this.getInput("BUTTONS")&&this.removeInput("BUTTONS");var i,s=this.appendDummyInput("BUTTONS"),s=(1<this.itemCount_&&s.appendField(new n.FieldImageNoText(this.REMOVE_IMAGE_DATAURI,24,24,"*",function(){e.removeItem_()},!1)),s.appendField(new n.FieldImageNoText(this.ADD_IMAGE_DATAURI,24,24,"*",function(){e.addItem_()},!1)),this.itemCount_<=4);this.setInputsInline(s),this.workspace instanceof o.WorkspaceSvg&&(i=this.workspace.getRenderer(),this.setOutputShape(s?i.getConstants().SHAPES.ROUND:i.getConstants().SHAPES.SQUARE))}},function(){o.Extensions.apply("inline-svgs",this,!1),this.itemCount_=2,this.updateShape_()}),o.defineBlocksWithJsonArray([{type:"text_join",message0:"",output:"String",outputShape:(new o.zelos.ConstantProvider).SHAPES.ROUND,style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"pxt_text_join_mutator"}])},{"../../fields/field_imagenotext":38,blockly:175}],136:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});i=e("blockly");i.defineBlocksWithJsonArray([{type:"text",message0:"%1",args0:[{type:"field_string",name:"TEXT",text:""}],output:"String",outputShape:(new i.zelos.ConstantProvider).SHAPES.ROUND,style:"field_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["parent_tooltip_when_inline"]}])},{blockly:175}],137:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.blocksMetrics=i.render=i.renderWorkspace=i.cleanRenderingWorkspace=i.initRenderingWorkspace=void 0;let o=e("blockly"),s=e("./layout"),n=e("./importer"),r,l;function a(){return r||((l=document.createElement("div")).style.position="absolute",l.style.top="0",l.style.left="0",l.style.width="1px",l.style.height="1px",document.body.appendChild(l),r=o.inject(l,{move:{scrollbars:!1},readOnly:!0,sounds:!1,media:pxt.webConfig.commitCdnUrl+"blockly/media/",rtl:pxt.Util.isUserLanguageRtl(),renderer:"pxt"})),(0,n.clearWithoutEvents)(r),r}function c(){r&&r.dispose(),r=void 0}function u(e={emPixels:18,layout:1}){switch(e.splitSvg?1:e.layout||4){case 1:(0,s.verticalAlign)(r,e.emPixels||18);break;case 4:(0,s.flow)(r,{ratio:e.aspectRatio,useViewWidth:e.useViewWidth});break;case 3:r.cleanUp_&&r.cleanUp_()}let t=r.getMetrics();var i=l.querySelectorAll("svg")[0].cloneNode(!0);return(0,s.cleanUpBlocklySvg)(i),pxt.U.toArray(i.querySelectorAll(".blocklyBlockCanvas,.blocklyBubbleCanvas")).forEach(e=>e.setAttribute("transform",`translate(${-t.contentLeft}, ${-t.contentTop}) scale(1)`)),i.setAttribute("viewBox",`0 0 ${t.contentWidth} `+t.contentHeight),e.emPixels&&(i.style.width=t.contentWidth/e.emPixels+"em",i.style.height=t.contentHeight/e.emPixels+"em"),e.splitSvg?(0,s.splitSvg)(i,r,e.emPixels):i}i.initRenderingWorkspace=a,i.cleanRenderingWorkspace=c,i.renderWorkspace=u,i.render=function(e,t={emPixels:18,layout:1}){a();try{var i=e||'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',s=o.utils.xml.textToDom(i);return(0,n.domToWorkspaceNoEvents)(s,r,{applyHideMetaComment:!0}),u(t)}catch(e){pxt.reportException(e)}finally{c()}},i.blocksMetrics=function(e){if(!(e=e.getTopBlocks(!1)).length)return{width:0,height:0};let t=void 0;return e.forEach(e=>{e=e.getBoundingRectangle();t?(t.l=Math.min(t.l,e.left),t.r=Math.max(t.r,e.right),t.t=Math.min(t.t,e.top),t.b=Math.min(t.b,e.bottom)):t={l:e.left,r:e.right,t:e.top,b:e.bottom}}),{width:t.r-t.l,height:t.b-t.t}}},{"./importer":73,"./layout":75,blockly:175}],138:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.findBlockIdByLine=i.findBlockIdByPosition=void 0,i.findBlockIdByPosition=function(s,o){if(o){let t,i;for(let e=0;e<s.length;++e){var n=s[e];n.startPos<=o.start&&n.endPos>=o.start+o.length&&(!t||i>n.endPos-n.startPos)&&(t=n,i=n.endPos-n.startPos)}return t?t.id:void 0}},i.findBlockIdByLine=function(s,o){if(o){let t,i;for(let e=0;e<s.length;++e){var n=s[e];n.startLine<=o.start&&n.endLine>o.start+o.length&&(!t||i>n.endLine-n.startLine)&&(t=n,i=n.endLine-n.startLine)}return t?t.id:void 0}}},{}],139:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.createFunctionsFlyoutCategory=i.mkReturnStatementBlock=i.mkVariableFieldBlock=i.mkFieldBlock=i.mkPredicateBlock=i.createToolboxBlock=i.createFlyoutGap=i.createFlyoutButton=i.createFlyoutGroupLabel=i.createFlyoutHeadingLabel=i.createShadowValue=i.isArrayType=void 0;let n=e("blockly"),g=e("./plugins/functions"),m=e("./loader"),_=/^(string|number|boolean)$/,b={string:{field:"TEXT",block:"text",defaultValue:""},number:{field:"NUM",block:"math_number",defaultValue:"0"},boolean:{field:"BOOL",block:"logic_boolean",defaultValue:"false"},Array:{field:"VAR",block:"variables_get",defaultValue:"list"}};function f(e){e=/^(?:Array<(.+)>)|(?:(.+)\[\])|(?:\[.+\])$/.exec(e);if(e)return e[1]||e[2]}function T(e,i,s,o,t,n=0){o=o||i.defaultValue,!(s=s||i.shadowBlockId)&&i.range&&(s="math_number_minmax");let r;if(r=o&&'"'==o.slice(0,1)?JSON.parse(o):o,"number"==i.type&&"value"==s)return(l=document.createElement("field")).setAttribute("name",i.definitionName),l.appendChild(document.createTextNode("0")),l;if(i.fieldEditor)return i.defaultValue?((l=document.createElement("field")).setAttribute("name",i.definitionName),l.appendChild(document.createTextNode(i.defaultValue)),l):void 0;var l=pxt.Util.lookup(e.apis.byQName,i.type),a=6==(null==l?void 0:l.kind),l=l&&!!l.attributes.fixedInstances&&!i.shadowBlockId,c="@combined@"==i.type;if(!s&&(a||l||c))return o?((a=document.createElement("field")).setAttribute("name",i.definitionName),a.appendChild(document.createTextNode(o)),a):void 0;l="variables_get"==s,c="text"==s,o=document.createElement("value"),o.setAttribute("name",i.definitionName),a="lists_create_with"!==s&&s?void 0:f(i.type);let u=document.createElement(!l&&!a||t?"shadow":"block");o.appendChild(u);var h=b[a||i.type];if(u.setAttribute("type",s||(a?"lists_create_with":h&&h.block||i.type)),u.setAttribute("colour","#fff"),a){if(h&&!s){let e;switch(a){case"number":e=["0","1"];break;case"string":e=["a","b","c"];break;case"boolean":e=["FALSE","FALSE","FALSE"]}return E(u,h.block,h.field,e),o}if(s&&r)return E(u,r),o}if(!h||s&&h.block!==s&&"math_number_minmax"!==s)r&&((t=document.createElement("field")).textContent=r,l?(t.setAttribute("name","VAR"),u.appendChild(t)):c?(t.setAttribute("name","TEXT"),u.appendChild(t)):s?(a=e.blocksById[s])&&a.attributes._def&&a.attributes._def.parameters.length&&(l=a.attributes._def.parameters[0],t.setAttribute("name",l.name),u.appendChild(t)):(t.setAttribute("name",i.definitionName),u.appendChild(t)));else{c=document.createElement("field");u.appendChild(c);let e;switch(s){case"variables_get":e="VAR";break;case"math_number_minmax":e="SLIDER";break;default:e=h.field}c.setAttribute("name",e);let t;t="boolean"==i.type?document.createTextNode((r||h.defaultValue).toUpperCase()):document.createTextNode(r||h.defaultValue),c.appendChild(t)}let d;if(i.range&&((d=document.createElement("mutation")).setAttribute("min",i.range.min.toString()),d.setAttribute("max",i.range.max.toString()),d.setAttribute("label",i.actualName.charAt(0).toUpperCase()+i.actualName.slice(1)),i.fieldOptions)&&(i.fieldOptions.step&&d.setAttribute("step",i.fieldOptions.step),i.fieldOptions.color&&d.setAttribute("color",i.fieldOptions.color),i.fieldOptions.precision)&&d.setAttribute("precision",i.fieldOptions.precision),i.fieldOptions&&(d=d||document.createElement("mutation")).setAttribute("customfield",JSON.stringify(i.fieldOptions)),d&&u.appendChild(d),n)for(let t of pxt.Util.toArray(o.getElementsByTagName("shadow")))if(!t.innerHTML){var p=e.blocks.find(e=>e.attributes.blockId===t.getAttribute("type"));if(p)for(var g=v(e,p,pxt.blocks.compileInfo(p),!0,n-1);g.firstChild;)t.appendChild(g.firstChild.cloneNode(!0)),g.firstChild.remove()}return o}function E(t,i,s,o){var n=o?o.length:2,e=document.createElement("mutation");e.setAttribute("items",""+n),e.setAttribute("horizontalafter",""+n),t.appendChild(e);for(let e=0;e<n;e++){var r,l=document.createElement("value"),a=(l.setAttribute("name","ADD"+e),document.createElement("shadow"));a.setAttribute("type",i),s&&((r=document.createElement("field")).setAttribute("name",s),o&&r.appendChild(document.createTextNode(o[e])),a.appendChild(r)),l.appendChild(a),t.appendChild(l)}}function l(e,t,i,s){e=o(e,pxt.toolbox.convertColor(t),i,s);return e.setAttribute("web-class","blocklyFlyoutHeading"),e}function a(e,t,i,s){e=o(e,void 0,t);return e.setAttribute("web-class","blocklyFlyoutGroup"),e.setAttribute("web-line","1.5"),i&&e.setAttribute("web-line-width",i),s&&(e.setAttribute("web-help-button","true"),e.setAttribute("callbackKey",s)),e}function o(e,t,i,s){var o=n.utils.xml.createElement("label");return o.setAttribute("text",e),t&&o.setAttribute("web-icon-color",pxt.toolbox.convertColor(t)),i&&(1===i.length?(o.setAttribute("web-icon",i),s&&o.setAttribute("web-icon-class",s)):o.setAttribute("web-icon-class","blocklyFlyoutIcon"+e)),o}function v(i,r,s,o=!1,n=0){let l,e,t,a;if(r.attributes.toolboxParent){var c=i.blocksById[r.attributes.toolboxParent];if(c){var u=pxt.blocks.compileInfo(c);if(t=v(i,c,u,o),r.attributes.toolboxParentArgument)!(a=t.querySelector(`value[name=${r.attributes.toolboxParentArgument}]`))&&u.parameters.some(e=>e.definitionName===r.attributes.toolboxParentArgument)&&((a=document.createElement("value")).setAttribute("name",r.attributes.toolboxParentArgument),t.appendChild(a));else if(!(a=t.querySelector("value")))for(var h of u.parameters)if(!t.querySelector(`field[name=${h.definitionName}]`)){(a=document.createElement("value")).setAttribute("name",h.definitionName),t.appendChild(a);break}if(a)for(;a.firstChild;)a.removeChild(a.firstChild);else t=void 0}}let d=document.createElement(t||o?"shadow":"block");if(d.setAttribute("type",r.attributes.blockId),r.attributes.blockGap?d.setAttribute("gap",r.attributes.blockGap):pxt.appTarget.appTheme&&pxt.appTarget.appTheme.defaultBlockGap&&d.setAttribute("gap",pxt.appTarget.appTheme.defaultBlockGap.toString()),s.thisParameter){c=s.thisParameter,u=!(null==(l=i.apis.byQName[c.type])||!l.attributes.fixedInstances);let e=c.shadowBlockId,t=c.defaultValue;u||e&&"variables_get"!==e||(e="variables_get",t=t||c.definitionName);u=T(i,c,e,t,o,n);u&&d.appendChild(u)}if("ENUM_GET"===r.attributes.shim||"KIND_GET"===r.attributes.shim?null!=(e=r.parameters)&&e.length&&(c=r.parameters[0].default)&&((u=document.createElement("field")).setAttribute("name","MEMBER"),u.textContent=c,d.appendChild(u)):r.parameters&&(s.parameters.filter(e=>_.test(e.type)||_.test(f(e.type))||e.shadowBlockId||e.defaultValue).forEach(e=>{e=T(i,e,void 0,void 0,o,n);e&&d.appendChild(e)}),r.attributes.draggableParameters?s.handlerArgs.forEach(e=>{var t="reporter"===r.attributes.draggableParameters,i=document.createElement("value"),s=(i.setAttribute("name",m.DRAGGABLE_PARAM_INPUT_PREFIX+e.name),t?pxt.blocks.reporterTypeForArgType(e.type):"variables_get_reporter"),o=document.createElement("block"),n=(o.setAttribute("type",s),document.createElement("mutation")),s=(o.appendChild(n),t&&"argument_reporter_custom"===s&&n.setAttribute("typename",e.type),n.setAttribute(g.LOCALIZATION_NAME_MUTATION_KEY,e.localizationKey),document.createElement("field"));s.setAttribute("name",t?"VALUE":"VAR"),s.textContent=pxt.Util.htmlEscape(e.name),o.appendChild(s),i.appendChild(o),d.appendChild(i)}):s.handlerArgs.forEach(e=>{var t=document.createElement("field");t.setAttribute("name","HANDLER_"+e.name),t.textContent=e.name,d.appendChild(t)})),r.attributes.expandArgumentsInToolbox){let e;for(var p of d.children)if("mutation"===p.tagName){e=p;break}e||(e=document.createElement("mutation"),d.appendChild(e)),e.setAttribute("_expanded",""+r.attributes._expandedDef.parameters.length)}return t?(a.appendChild(d),t):d}function s(e,t,i,s){s=document.createElement(s?"shadow":"block"),s.setAttribute("type",pxt.Util.htmlEscape(e)),e=document.createElement("field");return e.setAttribute("name",pxt.Util.htmlEscape(t)),e.textContent=pxt.Util.htmlEscape(i),s.appendChild(e),s}function c(){var e=document.createElement("block"),t=(e.setAttribute("type","function_return"),document.createElement("value")),i=(t.setAttribute("name","RETURN_VALUE"),e.appendChild(t),s("math_number","NUM","0",!0));return t.appendChild(i),e}i.isArrayType=f,i.createShadowValue=T,i.createFlyoutHeadingLabel=l,i.createFlyoutGroupLabel=a,i.createFlyoutButton=function(e,t){var i=n.utils.xml.createElement("button");return i.setAttribute("text",t),i.setAttribute("callbackKey",e),i},i.createFlyoutGap=function(e){var t=n.utils.xml.createElement("sep");return t.setAttribute("gap",e+""),t},i.createToolboxBlock=v,i.mkPredicateBlock=function(e){var t=document.createElement("block");t.setAttribute("type",e);(e=document.createElement("value")).setAttribute("name","PREDICATE"),t.appendChild(e);var i=s("logic_boolean","BOOL","TRUE",!0);return e.appendChild(i),t},i.mkFieldBlock=s,i.mkVariableFieldBlock=function(e,t,i,s,o){return(o=document.createElement(o?"shadow":"block")).setAttribute("type",pxt.Util.htmlEscape(e)),(e=document.createElement("field")).setAttribute("name","VAR"),e.id=t,e.setAttribute("variabletype",pxt.Util.htmlEscape(i)),e.textContent=pxt.Util.htmlEscape(s),o.appendChild(e),o},i.mkReturnStatementBlock=c,i.createFunctionsFlyoutCategory=function(e){var i,t=(0,g.flyoutCategory)(e),s=(1<t.length&&(o=c(),t.splice(1,0,a(lf("Your Functions"))),t.splice(1,0,o)),(0,g.getAllFunctionDefinitionBlocks)(e).filter(e=>e.getDescendants(!1).some(e=>"function_return"===e.type&&e.getInputTargetBlock("RETURN_VALUE"))).map(e=>e.getField("function_name").getText())),o=l(lf("Functions"),pxt.toolbox.getNamespaceColor("functions"),pxt.toolbox.getNamespaceIcon("functions"),"blocklyFlyoutIconfunctions"),n=(t.unshift(o),[]);for(i of t)if(n.push(i),"function_call"===i.getAttribute("type")){var r=i.children.item(0);if(r){let t=r.getAttribute("name");s.some(e=>e===t)&&((r=i.cloneNode(!0)).setAttribute("type","function_call_output"),n.push(r))}}return n}},{"./loader":77,"./plugins/functions":111,blockly:175}],140:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.PxtWorkspaceSearch=void 0;let s=e("blockly");e=e("@blockly/plugin-workspace-search");class o extends e.WorkspaceSearch{constructor(e){super(e),this.injectionDiv=e.getInjectionDiv()}highlightSearchGroup(e){e.forEach(e=>{e=e.pathObject.svgPath;s.utils.dom.addClass(e,"blockly-ws-search-highlight-pxt")})}unhighlightSearchGroup(e){e.forEach(e=>{e=e.pathObject.svgPath;s.utils.dom.removeClass(e,"blockly-ws-search-highlight-pxt")})}open(){super.open(),s.utils.dom.addClass(this.injectionDiv,"blockly-ws-searching")}close(){super.close(),s.utils.dom.removeClass(this.injectionDiv,"blockly-ws-searching")}}i.PxtWorkspaceSearch=o,s.Css.register(`
.blockly-ws-search {
    background: var(--pxt-neutral-background1);
    color: var(--pxt-neutral-foreground1);
    border: solid var(--pxt-neutral-alpha50) 1px;
    border-top: none;
    border-right: none;
    box-shadow: 0px 2px 15px var(--pxt-neutral-alpha50);
}

.blockly-ws-search input {
    -webkit-tap-highlight-color: transparent;
    background: var(--pxt-neutral-background1);
    color: var(--pxt-neutral-foreground1);
    border: none;
}

.blockly-ws-search input::-webkit-input-placeholder {
    color: var(--pxt-neutral-alpha50);
}

.blockly-ws-search input::-moz-placeholder {
    color: var(--pxt-neutral-alpha50);
}

.blockly-ws-search input::-ms-input-placeholder {
    color: var(--pxt-neutral-alpha50);
}

.blockly-ws-search input:active,
.blockly-ws-search input:focus {
    border-color: var(--pxt-neutral-alpha50);
    background: var(--pxt-neutral-background1);
    color: var(--pxt-neutral-foreground1);
}

.blockly-ws-search input::selection {
    color: var(--pxt-neutral-foreground1);
}

.blockly-ws-search button {
    padding-left: 6px;
    padding-right: 6px;
    color: var(--pxt-neutral-foreground1);
}`)},{"@blockly/plugin-workspace-search":170,blockly:175}],141:[function(e,t,i){function o(e,t,i,s){return pxt.Util.toArray(e.getElementsByTagName(t)).filter(e=>e.getAttribute(i)===s)}Object.defineProperty(i,"__esModule",{value:!0}),i.cleanOuterHTML=i.getDirectChildren=i.getFirstChildWithAttr=i.getChildrenWithAttr=i.getBlocksWithType=void 0,i.getBlocksWithType=function(e,t){return o(e,"block","type",t).concat(o(e,"shadow","type",t))},i.getChildrenWithAttr=o,i.getFirstChildWithAttr=function(e,t,i,s){return(e=o(e,t,i,s)).length?e[0]:void 0},i.getDirectChildren=function(t,i){var s=[];for(let e=0;e<t.childNodes.length;e++){var o=t.childNodes.item(e);o.tagName===i&&s.push(o)}return s},i.cleanOuterHTML=function(e){return e.outerHTML.replace(/^<\?[^>]*>/,"")}},{}],142:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getNestedChildBlocks=void 0,i.getNestedChildBlocks=function(t){return t.getDescendants(!0).filter(e=>e.isEnabled()&&e.getSurroundParent()===t)}},{}],143:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(i,"__esModule",{value:!0}),o(e("./runValidatorPlan"),i),o(e("./validateBlocksExist"),i),o(e("./validateBlocksInSetExist"),i),o(e("./validateCommentsExist"),i),o(e("./validateSpecificBlockCommentsExist"),i)},{"./runValidatorPlan":144,"./validateBlocksExist":146,"./validateBlocksInSetExist":147,"./validateCommentsExist":148,"./validateSpecificBlockCommentsExist":149}],144:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.runValidatorPlan=void 0;let u=e("./validateBlockFieldValueExists"),h=e("./validateBlocksExist"),d=e("./validateBlocksInSetExist"),p=e("./validateCommentsExist"),g=e("./validateSpecificBlockCommentsExist"),m=e("./getNestedChildBlocks"),_=e("./validateVariableUsage");i.runValidatorPlan=function s(e,t,o){var n,i=Date.now();let r=0,l=[];for(n of t.checks){let i=!1;switch(n.validator){case"blocksExist":[l,i]=[...((e,t)=>{let i=t.blockCounts.reduce((e,t)=>(e[t.blockId]=t.count,e),{}),s=(0,h.validateBlocksExist)({usedBlocks:e,requiredBlockCounts:i}),o=[];if(s.passed)for(var n of t.blockCounts)n=n.blockId,o.push(...s.successfulBlocks[n]);return[o,s.passed]})(e,n)];break;case"blockCommentsExist":i=((e,t)=>(e=(0,p.validateBlockCommentsExist)({usedBlocks:e,numRequired:t.count})).passed)(e,n);break;case"specificBlockCommentsExist":i=((e,t)=>(e=(0,g.validateSpecificBlockCommentsExist)({usedBlocks:e,blockType:t.blockType})).passed)(e,n);break;case"blocksInSetExist":[l,i]=[...((e,t)=>[(e=(0,d.validateBlocksInSetExist)({usedBlocks:e,blockIdsToCheck:t.blocks,count:t.count})).successfulBlocks,e.passed])(e,n)];break;case"blockFieldValueExists":[l,i]=[...((e,t)=>[(e=(0,u.validateBlockFieldValueExists)({usedBlocks:e,fieldType:t.fieldType,fieldValue:t.fieldValue,specifiedBlock:t.blockType})).successfulBlocks,e.passed])(e,n)];break;case"variableUsage":[l,i]=[...((e,t)=>{var i,e=(0,_.validateVariableUsage)({usedBlocks:e,count:t.count,name:t.name}),s=[];for(i of e.passingVarDefinitions.values())s.push(...i);return[s,e.passed]})(e,n)];break;default:return pxt.debug("Unrecognized validator: "+n.validator),pxt.tickEvent("validation.unrecognized_validator",{validator:n.validator}),{executionSuccess:!1,executionErrorMsg:lf("Unrecognized evaluation rule")}}if(i&&n.childValidatorPlans)for(let t of n.childValidatorPlans){let e=0;for(var a of l)a=s((0,m.getNestedChildBlocks)(a),o.find(e=>e.name===t),o),e+=a?1:0;i=i&&0<e}r+=i?1:0}var c=r>=t.threshold;return pxt.tickEvent("validation.evaluation_complete",{plan:t.name,durationMs:Date.now()-i,passed:""+c}),{result:c,executionSuccess:!0}}},{"./getNestedChildBlocks":142,"./validateBlockFieldValueExists":145,"./validateBlocksExist":146,"./validateBlocksInSetExist":147,"./validateCommentsExist":148,"./validateSpecificBlockCommentsExist":149,"./validateVariableUsage":150}],145:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.validateBlockFieldValueExists=void 0,i.validateBlockFieldValueExists=function({usedBlocks:e,fieldType:i,fieldValue:s,specifiedBlock:t}){return{successfulBlocks:e=e.filter(e=>e.isEnabled()&&e.type===t).filter(e=>{var t;return"VAR"===i?(null==(t=e.getVarModels())?void 0:t[0].getName())===s:e.getFieldValue(i)===s}),passed:0<e.length}}},{}],146:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.validateBlocksExist=void 0,i.validateBlocksExist=function({usedBlocks:i,requiredBlockCounts:s}){var o=[],n=[],r=[],l={},a=null==i?void 0:i.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+(t.isEnabled()?1:0),e),{});for(let[t,e]of Object.entries(s||{})){var c=a[t],u=i.filter(e=>e.isEnabled()&&e.type===t);0<u.length&&(l[t]=u),void 0===c?o.push(t):c?c<e&&r.push(t):n.push(t)}return{missingBlocks:o,disabledBlocks:n,insufficientBlocks:r,successfulBlocks:l,passed:0===o.length&&0===n.length&&0===r.length}}},{}],147:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.validateBlocksInSetExist=void 0,i.validateBlocksInSetExist=function({usedBlocks:e,blockIdsToCheck:i,count:t,requireUnique:s}){var o=[],n=e.filter(e=>e.isEnabled());for(let t of i){var r=n.filter(e=>e.type===t);s&&1<=r.length?o.push(r[0]):o.push(...r)}return{successfulBlocks:o,passed:t<=o.length}}},{}],148:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.validateBlockCommentsExist=void 0,i.validateBlockCommentsExist=function({usedBlocks:e,numRequired:t}){return{commentedBlocks:e=e.filter(e=>!!e.getCommentText()),passed:e.length>=t}}},{}],149:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.validateSpecificBlockCommentsExist=void 0,i.validateSpecificBlockCommentsExist=function({usedBlocks:e,blockType:t}){var i=(e=e.filter(e=>e.type===t)).filter(e=>!e.getCommentText());return{uncommentedBlocks:i,passed:0!==e.length&&0===i.length}}},{}],150:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.validateVariableUsage=void 0,i.validateVariableUsage=function({usedBlocks:e,count:t,name:i}){var s,o=new Map,n=new Set;for(s of e)if(s.isEnabled()){var r,l=s.getVarModels();for(r of null!=l?l:[]){var a=r.getName();i&&a!==i||("variables_set"===s.type||"variables_change"===s.type?(o.has(a)||o.set(a,[]),o.get(a).push(s)):n.add(a))}}var c,u,h=new Map;for([c,u]of o)n.has(c)&&h.set(c,u);return{passingVarDefinitions:h,passed:h.size>=t}}},{}],151:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isBlocks=i.initEditorExtensionsAsync=i.HELP_IMAGE_URI=void 0,i.HELP_IMAGE_URI="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjYiIGhlaWdodD0iMjYiIHZpZXdCb3g9IjAgMCAyNiAyNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTMiIGN5PSIxMyIgcj0iMTMiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNy45NTIgOS4xODQwMkMxNy45NTIgMTAuMjU2IDE3LjgxNiAxMS4wNzIgMTcuNTQ0IDExLjYzMkMxNy4yODggMTIuMTkyIDE2Ljc1MiAxMi43OTIgMTUuOTM2IDEzLjQzMkMxNS4xMiAxNC4wNzIgMTQuNTc2IDE0LjU4NCAxNC4zMDQgMTQuOTY4QzE0LjA0OCAxNS4zMzYgMTMuOTIgMTUuNzM2IDEzLjkyIDE2LjE2OFYxNi45NkgxMS44MDhDMTEuNDI0IDE2LjQ2NCAxMS4yMzIgMTUuODQgMTEuMjMyIDE1LjA4OEMxMS4yMzIgMTQuNjg4IDExLjM4NCAxNC4yODggMTEuNjg4IDEzLjg4OEMxMS45OTIgMTMuNDg4IDEyLjUzNiAxMi45NjggMTMuMzIgMTIuMzI4QzE0LjEwNCAxMS42NzIgMTQuNjI0IDExLjE2OCAxNC44OCAxMC44MTZDMTUuMTM2IDEwLjQ0OCAxNS4yNjQgOS45NjgwMiAxNS4yNjQgOS4zNzYwMkMxNS4yNjQgOC4yMDgwMiAxNC40MTYgNy42MjQwMiAxMi43MiA3LjYyNDAyQzExLjc2IDcuNjI0MDIgMTAuNzUyIDcuNzM2MDIgOS42OTYgNy45NjAwMkw5LjE0NCA4LjA4MDAyTDkgNi4wODgwMkMxMC40ODggNS41NjAwMiAxMS44NCA1LjI5NjAyIDEzLjA1NiA1LjI5NjAyQzE0LjczNiA1LjI5NjAyIDE1Ljk2OCA1LjYwODAyIDE2Ljc1MiA2LjIzMjAyQzE3LjU1MiA2Ljg0MDAyIDE3Ljk1MiA3LjgyNDAyIDE3Ljk1MiA5LjE4NDAyWk0xMS40IDIyVjE4LjY0SDE0LjE4NFYyMkgxMS40WiIgZmlsbD0iIzU5NUU3NCIvPgo8L3N2Zz4K";let s;i.initEditorExtensionsAsync=function(){if(!s&&(s=Promise.resolve(),pxt.appTarget)&&pxt.appTarget.appTheme&&pxt.appTarget.appTheme.extendFieldEditors){let e={};s=s.then(()=>pxt.BrowserUtils.loadBlocklyAsync()).then(()=>pxt.BrowserUtils.loadScriptAsync("fieldeditors.js")).then(()=>pxt.editor.initFieldExtensionsAsync(e)).then(e=>{e.fieldEditors&&e.fieldEditors.forEach(e=>{pxt.blocks.registerFieldEditor(e.selector,e.editor,e.validator)})})}return s},i.isBlocks=function(e){return pxt.U.endsWith(e.name,".blocks")}},{}],152:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.postHostMessageAsync=i.shouldPostHostMessages=i.enableControllerAnalytics=i.bindEditorMessages=void 0;let l=e("./code-validation/runValidatorPlan"),n=e("../pxtservices/iframeEmbeddedClient"),a=e("./projectImport"),c={},r;let u=!(i.bindEditorMessages=function(i){let t=pxt.appTarget.appTheme.allowParentController||pxt.shell.isControllerMode(),s=pxt.appTarget.appTheme.allowPackageExtensions,o=pxt.appTarget.appTheme.allowSimulatorTelemetry;(t||s||o)&&(r=new n.IFrameEmbeddedClient(e=>{let r=e.data;if(!r||!/^pxt(host|editor|pkgext|sim)$/.test(r.type))return!1;if("pxtpkgext"===r.type&&s)i().then(e=>{e.handleExtensionRequest(r)});else if("pxtsim"===r.type&&o){e=r;"event"===e.action&&(e.category||e.message?pxt.reportError(e.category,e.message,e.data):pxt.tickEvent(e.tick,e.data))}else if(t){let t=Promise.resolve(),n=void 0;if("pxthost"==r.type){let e=c[r.id];e?t=t.then(()=>e.resolve(r)):pxt.debug("pxthost: unknown request "+r.id)}else"pxteditor"==r.type&&(t=t.then(()=>i().then(s=>{var e=r;switch(pxt.debug("pxteditor: "+e.action),e.action.toLowerCase()){case"switchjavascript":return Promise.resolve().then(()=>s.openJavaScript());case"switchpython":return Promise.resolve().then(()=>s.openPython());case"switchblocks":return Promise.resolve().then(()=>s.openBlocks());case"startsimulator":return Promise.resolve().then(()=>s.startSimulator());case"restartsimulator":return Promise.resolve().then(()=>s.restartSimulator());case"hidesimulator":return Promise.resolve().then(()=>s.collapseSimulator());case"showsimulator":return Promise.resolve().then(()=>s.expandSimulator());case"closeflyout":return Promise.resolve().then(()=>s.closeFlyout());case"unloadproject":return Promise.resolve().then(()=>s.unloadProjectAsync());case"saveproject":return s.saveProjectAsync();case"compile":return s.compile();case"redo":return Promise.resolve().then(()=>{var e=s.editor;e&&e.hasRedo()&&e.redo()});case"undo":return Promise.resolve().then(()=>{var e=s.editor;e&&e.hasUndo()&&e.undo()});case"setscale":{let e=r;return Promise.resolve().then(()=>s.editor.setScale(e.scale))}case"stopsimulator":{let e=r;return Promise.resolve().then(()=>s.stopSimulator(e.unload))}case"newproject":{let e=r;return Promise.resolve().then(()=>s.newProject(e.options))}case"importproject":{let e=r;return Promise.resolve().then(()=>s.importProjectAsync(e.project,{filters:e.filters,searchBar:e.searchBar}))}case"importexternalproject":var o=r;return(0,a.saveProjectAsync)(o.project).then(e=>{e=location.origin+location.pathname+"#embedimport:"+e;n={importUrl:e}});case"openheader":o=r;return s.openProjectByHeaderIdAsync(o.headerId);case"startactivity":{let e=r,t=e.path,i=void 0;return/^([jt]s|py|blocks?):/i.test(t)&&(i=/^py:/i.test(t)?pxt.PYTHON_PROJECT_NAME:/^[jt]s:/i.test(t)?pxt.JAVASCRIPT_PROJECT_NAME:pxt.BLOCKS_PROJECT_NAME,t=t.substr(t.indexOf(":")+1)),Promise.resolve().then(()=>s.startActivity({activity:e.activityType,path:t,title:e.title,editor:i,previousProjectHeaderId:e.previousProjectHeaderId,carryoverPreviousCode:e.carryoverPreviousCode}))}case"importtutorial":{let e=r;return Promise.resolve().then(()=>s.importTutorialAsync(e.markdown))}case"proxytosim":{let e=r;return Promise.resolve().then(()=>s.proxySimulatorMessage(e.content))}case"renderblocks":{let e=r;return Promise.resolve().then(()=>s.renderBlocksAsync(e)).then(e=>e.xml.then(e=>{n=e.xml}))}case"renderxml":{let e=r;return Promise.resolve().then(()=>s.renderXml(e).resultXml.then(e=>{n=e.xml}))}case"renderbyblockid":{let e=r;return Promise.resolve().then(()=>s.renderByBlockIdAsync(e)).then(e=>e.resultXml.then(e=>{n=e.xml}))}case"runeval":{o=r;let t=o.validatorPlan,i=o.planLib;return Promise.resolve().then(()=>{var e=s.getBlocks();return(0,l.runValidatorPlan)(e,t,i)}).then(e=>{n=e})}case"gettoolboxcategories":{let e=r;return Promise.resolve().then(()=>{n=s.getToolboxCategories(e.advanced)})}case"getblockastext":{let t=r;return Promise.resolve().then(()=>{var e=s.getBlockAsText(t.blockId);n={blockAsText:e}})}case"renderpython":{let e=r;return Promise.resolve().then(()=>s.renderPythonAsync(e)).then(e=>{n=e.python})}case"toggletrace":{let e=r;return Promise.resolve().then(()=>s.toggleTrace(e.intervalSpeed))}case"settracestate":{let e=r;return Promise.resolve().then(()=>s.setTrace(e.enabled,e.intervalSpeed))}case"setsimulatorfullscreen":{let e=r;return Promise.resolve().then(()=>s.setSimulatorFullScreen(e.enabled))}case"showthemepicker":return Promise.resolve().then(()=>s.showThemePicker());case"togglehighcontrast":return Promise.resolve().then(()=>s.toggleHighContrast());case"sethighcontrast":{let e=r;return Promise.resolve().then(()=>s.setHighContrast(e.on))}case"togglegreenscreen":return Promise.resolve().then(()=>s.toggleGreenScreen());case"togglekeyboardcontrols":return Promise.resolve().then(()=>s.toggleAccessibleBlocks("editormessage"));case"print":return Promise.resolve().then(()=>s.printCode());case"pair":return s.pairAsync().then(()=>{});case"info":return Promise.resolve().then(()=>{n={versions:pxt.appTarget.versions,locale:ts.pxtc.Util.userLanguage(),availableLocales:pxt.appTarget.appTheme.availableLocales,keyboardControls:s.isAccessibleBlocks()}});case"shareproject":o=r;return s.anonymousPublishHeaderByIdAsync(o.headerId,o.projectName).then(e=>{n=e});case"savelocalprojectstocloud":o=r;return s.saveLocalProjectsToCloudAsync(o.headerIds).then(e=>{n={headerIdMap:e}});case"requestprojectcloudstatus":o=r;return s.requestProjectCloudStatus(o.headerIds);case"convertcloudprojectstolocal":o=r;return s.convertCloudProjectsToLocal(o.userId);case"setlanguagerestriction":o=r;if("no-blocks"===o.restriction)throw pxt.warn("no-blocks language restriction is not supported"),new Error("no-blocks language restriction is not supported");return s.setLanguageRestrictionAsync(o.restriction);case"precachetutorial":{o=r;let e=o.data,t=o.lang||pxt.Util.userLanguage();return pxt.github.db.cacheReposAsync(e).then(async()=>{"string"==typeof e.markdown&&await(await pxt.BrowserUtils.translationDbAsync()).setAsync(t,e.path,void 0,void 0,e.markdown)})}case"setcolorthemebyid":o=r;return s.setColorThemeById(o.colorThemeId,!!o.savePreference),Promise.resolve()}return Promise.resolve()})));t.then(()=>h(r,n,!0,void 0),e=>h(r,n,!1,e))}return!0}))});function h(e,t,i,s){e.response&&(e={type:e.type,id:e.id,resp:t,success:i,error:s},r?r.postMessage(e):window.parent.postMessage(e,"*"))}function d(s){return new Promise((e,t)=>{var i=pxt.Util.clone(s);if(i.id=ts.pxtc.Util.guidGen(),s.response&&(c[i.id]={resolve:e,reject:t}),r?r.postMessage(i):window.parent.postMessage(i,"*"),pxt.commands.onPostHostMessage)try{pxt.commands.onPostHostMessage(i)}catch(e){pxt.reportException(e)}s.response||e(void 0)})}i.enableControllerAnalytics=function(){if(!u){var e=!!pxt.commands.onPostHostMessage,t=pxt.appTarget.appTheme.allowParentController,i=pxt.BrowserUtils.isIFrame();if(e||t&&i){let i=pxt.tickEvent,s=(pxt.tickEvent=function(e,t){i&&i(e,t),d({type:"pxthost",action:"event",tick:e,response:!1,data:t})},pxt.reportException),o=(pxt.reportException=function(e,t){s&&s(e,t);try{d({type:"pxthost",action:"event",tick:"error",message:e.message,response:!1,data:t})}catch(e){}},pxt.reportError);pxt.reportError=function(e,t,i){o&&o(e,t,i),d({type:"pxthost",action:"event",tick:"error",category:e,message:t,data:i})},u=!0}}},i.shouldPostHostMessages=function(){return pxt.appTarget.appTheme.allowParentController&&pxt.BrowserUtils.isIFrame()},i.postHostMessageAsync=d},{"../pxtservices/iframeEmbeddedClient":168,"./code-validation/runValidatorPlan":144,"./projectImport":163}],153:[function(e,t,i){function s(e){return"experiments-"+("object"==typeof e?e.id:e)}Object.defineProperty(i,"__esModule",{value:!0}),i.setState=i.state=i.toggle=i.isEnabled=i.someEnabled=i.clear=i.all=i.syncTheme=i.setEditorExtensionExperiments=void 0;let o;function n(){let i=pxt.savedAppTheme(),s={};var e=r();return e.forEach(e=>{var t=l(e);i[e.id]=!!t,t&&(s[e.id]=t?1:0)}),e.length&&Object.keys(s).length&&(pxt.tickEvent("experiments.loaded",s),pxt.reloadAppTargetVariant()),pxt.appTarget.appTheme}function r(){let t=pxt.appTarget.appTheme.experiments;return t?[{id:"print",name:lf("Print Code"),description:lf("Print the code from the current project"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4740"},{id:"greenScreen",name:lf("Green screen"),description:lf("Display a webcam video stream or a green background behind the code."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4738"},{id:"allowPackageExtensions",name:lf("Editor Extensions"),description:lf("Allow Extensions to add buttons in the editor."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4741"},{id:"instructions",name:lf("Wiring Instructions"),description:lf("Generate step-by-step assembly instructions for breadboard wiring."),feedbackUrl:"https://github.com/microsoft/pxt/issues/4739"},{id:"debugger",name:lf("Debugger"),description:lf("Step through code and inspect variables in the debugger"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4729"},{id:"bluetoothUartConsole",name:"Bluetooth Console",description:lf("Receives UART message through Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4796"},{id:"bluetoothPartialFlashing",name:"Bluetooth Download",description:lf("Download code via Web Bluetooth"),feedbackUrl:"https://github.com/microsoft/pxt/issues/4807"},{id:"simScreenshot",name:lf("Simulator Screenshots"),description:lf("Download screenshots of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5232"},{id:"python",name:lf("Static Python"),description:lf("Use Static Python to code your device"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5390"},{id:"simGif",name:lf("Simulator Gifs"),description:lf("Download gifs of the simulator"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5297"},{id:"qrCode",name:lf("Shared QR Code"),description:lf("Generate a QR Code form the shared project url"),feedbackUrl:"https://github.com/microsoft/pxt/issues/5456"},{id:"importExtensionFiles",name:lf("Import Extension Files"),description:lf("Import Extensions from compiled project files")},{id:"debugExtensionCode",name:lf("Debug Extension Code"),description:lf("Use the JavaScript debugger to debug extension code")},{id:"advancedBlockDebugger",name:lf("Advanced Blocks Debugger"),description:lf("Enables extra options and variables in the Blocks debugger")},{id:"snippetBuilder",name:lf("Snippet Builder"),description:lf("Try out the new snippet dialogs.")},{id:"experimentalHw",name:lf("Experimental Hardware"),description:lf("Enable support for hardware marked 'experimental' in the hardware seletion dialog")},{id:"checkForHwVariantWebUSB",name:lf("Detect Hardware with WebUSB"),description:lf("When compiling, use WebUSB to detect hardware configuration.")},{id:"githubEditor",name:lf("GitHub editor"),description:lf("Review, commit and push to GitHub."),feedbackUrl:"https://github.com/microsoft/pxt/issues/6419",enableOnline:!0},{id:"githubCompiledJs",name:lf("GitHub Pages JavaScript"),description:lf("Commit compiled javascript when creating a release"),enableOnline:!0},{id:"blocksCollapsing",name:lf("Collapse blocks"),description:lf("Collapse and expand functions or event blocks")},{id:"tutorialBlocksDiff",name:lf("Tutorial Block Diffs"),description:lf("Automatially render blocks diff in tutorials")},{id:"openProjectNewTab",name:lf("Open in New Tab"),description:lf("Open an editor in a new tab.")},{id:"openProjectNewDependentTab",name:lf("Open in New Connected Tab"),description:lf("Open connected editors in different browser tabs.")},{id:"errorList",name:lf("Error List"),description:lf("Show an error list panel for JavaScript and Python.")},{id:"timeMachine",name:lf("Time Machine"),description:lf("Save and restore past versions of a project")},{id:"forceEnableAiErrorHelp",name:lf("AI Error Explainer"),description:lf("Get AI's help explaining errors in your code"),feedbackUrl:"https://github.com/microsoft/pxt/issues/10694",enableOnline:!0}].filter(e=>-1<t.indexOf(e.id)).concat(o||[]).filter(e=>!(pxt.BrowserUtils.isPxtElectron()&&e.enableOnline)):[]}function l(e){return!!pxt.storage.getLocal(s(e))}function a(e,t){t!=l(e)&&(t?pxt.storage.setLocal(s(e),"1"):pxt.storage.removeLocal(s(e)),n())}i.setEditorExtensionExperiments=function(e){o=e},i.syncTheme=n,i.all=r,i.clear=function(){r().forEach(e=>pxt.storage.removeLocal(s(e))),n()},i.someEnabled=function(){return r().some(e=>l(e))},i.isEnabled=l,i.toggle=function(e){e.onClick?e.onClick():a(e,!l(e))},i.state=function(){let t={};return r().forEach(e=>t[e.id]=l(e)),JSON.stringify(t)},i.setState=a},{}],154:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.patchConfigEditorVersion=i.getTextAtTime=i.updateShareHistory=i.pushSnapshotOnHistory=i.updateHistory=i.parseHistoryFile=i.applySnapshot=i.createSnapshot=i.applyDiff=i.diffScriptText=i.collapseHistory=void 0;let s=3e5,g=18e5,m=864e5;function _(e,t,i,s,o){var n=[],r=e.entries.slice();let l=Object.assign({},t),{interval:a,minTime:c,maxTime:u}=i,h=(void 0===c&&(c=0),void 0===u&&(u=e.lastSaveTime),Object.assign({},l)),d=e.lastSaveTime;for(;r.length;){var p=r.pop();l=f(l,p,o),p.timestamp>u?(n.unshift(p),h=Object.assign({},l),d=p.timestamp):p.timestamp<c?h?(n.unshift({timestamp:p.timestamp,editorVersion:p.editorVersion,changes:b(l,h,p.timestamp,s).changes}),h=void 0):n.unshift(p):d-p.timestamp>=a&&(n.unshift({timestamp:p.timestamp,editorVersion:p.editorVersion,changes:b(l,h,p.timestamp,s).changes}),h=Object.assign({},l),d=p.timestamp)}return h&&d>e.entries[0].timestamp&&n.unshift({timestamp:e.entries[0].timestamp,editorVersion:e.entries[0].editorVersion,changes:b(l,h,e.entries[0].timestamp,s).changes}),Object.assign(Object.assign({},e),{entries:n})}function b(e,t,i,s){var o,n,r=[];for(o of Object.keys(e))(o.endsWith(".ts")||o.endsWith(".jres")||o.endsWith(".py")||o.endsWith(".blocks")||"pxt.json"===o)&&(null==t[o]?r.push({type:"removed",filename:o,value:e[o]}):e[o]!==t[o]&&r.push({type:"edited",filename:o,patch:s(t[o],e[o])}));for(n of Object.keys(t))(n.endsWith(".ts")||n.endsWith(".jres")||n.endsWith(".py")||n.endsWith(".blocks")||"pxt.json"===n)&&null==e[n]&&r.push({type:"added",filename:n,value:t[n]});if(r.length)return{timestamp:i,editorVersion:null==(i=null==(i=pxt.appTarget)?void 0:i.versions)?void 0:i.target,changes:r}}function f(e,t,i){var s,o=Object.assign({},e);for(s of t.changes)"added"===s.type?delete o[s.filename]:"removed"===s.type?o[s.filename]=s.value:o[s.filename]=i(s.patch,e[s.filename]);return o}function o(t){let i;try{i={};var e,s=JSON.parse(t[pxt.CONFIG_NAME]);for(e of s.files)e===pxt.IMAGES_CODE||e===pxt.TILEMAP_CODE?i[e]="":i[e]=t[e];if(i[pxt.CONFIG_NAME]=t[pxt.CONFIG_NAME],s.preferredEditor===pxt.BLOCKS_PROJECT_NAME?i[pxt.MAIN_BLOCKS]&&(i[pxt.MAIN_TS]=""):s.preferredEditor===pxt.PYTHON_PROJECT_NAME&&i[pxt.MAIN_PY]&&(i[pxt.MAIN_TS]=""),s.testFiles)for(var o of s.testFiles)i[o]=t[o]}catch(e){i=Object.assign({},t)}return i[pxt.HISTORY_FILE]&&delete i[pxt.HISTORY_FILE],i}function T(e){e=JSON.parse(e);return e.entries||(e.entries=[]),e.shares||(e.shares=[]),e.snapshots||(e.snapshots=[]),e}function l(e,t){e=Object.assign({},e);try{var i=JSON.parse(e[pxt.CONFIG_NAME]);i.targetVersions&&(i.targetVersions.target=t),e[pxt.CONFIG_NAME]=JSON.stringify(i,null,4)}catch(e){}return{files:e,editorVersion:t}}function E(e,t){return{timestamp:t,editorVersion:pxt.appTarget.versions.target,text:o(e)}}function v(){var e;return null!=(null==(e=null==(e=pxt.appTarget)?void 0:e.appTheme)?void 0:e.timeMachineDiffInterval)?pxt.appTarget.appTheme.timeMachineDiffInterval:s}i.collapseHistory=function(e,t,i,s){e[pxt.HISTORY_FILE]&&(t=_(T(e[pxt.HISTORY_FILE]),e,t,i,s),e[pxt.HISTORY_FILE]=JSON.stringify(t))},i.diffScriptText=b,i.applyDiff=f,i.createSnapshot=o,i.applySnapshot=function(t,i){var e;try{var s,o=Object.assign({},i),n=JSON.parse(t[pxt.CONFIG_NAME]);for(s of Object.keys(t))s===pxt.HISTORY_FILE||-1!==n.files.indexOf(s)||-1!==(null==(e=n.testFiles)?void 0:e.indexOf(s))||o[s]||(o[s]=t[s]);return o}catch(e){var r,l=Object.assign({},t);for(r of Object.keys(i))l[r]=i[r];return l}},i.parseHistoryFile=T,i.updateHistory=function(i,t,s,o,n,r,l=!1){let a;i[pxt.HISTORY_FILE]?void 0===(a=T(i[pxt.HISTORY_FILE])).lastSaveTime&&(a.lastSaveTime=s):a={entries:[],snapshots:[E(i,s-1)],shares:[],lastSaveTime:s};var c,u,h=a.lastSaveTime;for(let t of o)a.shares.some(e=>e.id===t.id)||a.shares.push({id:t.id,timestamp:s});if(!((e,t)=>{var i=Object.keys(e),s=Object.keys(t);if(i.length===s.length){for(var o of i){if(-1===s.indexOf(o))return;if(e[o]!==t[o])return}return 1}})(i,t)){let e=!1;if(1===a.entries.length?s-a.entries[a.entries.length-1].timestamp<v()&&(e=!0):1<a.entries.length&&(o=a.entries[a.entries.length-1].timestamp,c=a.entries[a.entries.length-2].timestamp,s-o<v())&&o-c<v()&&(e=!0),e?(c=b(f(i,o=a.entries.pop(),r),t,o.timestamp,n))&&a.entries.push(c):(o=b(i,t,a.lastSaveTime,n))&&a.entries.push(o),(a=l&&Math.floor(h/m)!==Math.floor(s/m)?_(a,t,{interval:72e5,maxTime:s-m},n,r):a).lastSaveTime=s,0==a.snapshots.length)a.snapshots.push(E(i,s-1));else if(s-a.snapshots[a.snapshots.length-1].timestamp>=(null==(null==(c=null==(c=pxt.appTarget)?void 0:c.appTheme)?void 0:c.timeMachineSnapshotInterval)?g:pxt.appTarget.appTheme.timeMachineSnapshotInterval)){a.snapshots.push(E(i,s));var d=[];let t=Math.floor(s/m)*m;for(let e=0;e<a.snapshots.length;e++){var p=a.snapshots[a.snapshots.length-1-e];s-p.timestamp<m||e===a.snapshots.length-1?d.unshift(p):p.timestamp<t&&(d.unshift(p),t=Math.floor(p.timestamp/m)*m)}a.snapshots=d}for(u of a.snapshots)u.text[pxt.HISTORY_FILE]&&delete u.text[pxt.HISTORY_FILE]}t[pxt.HISTORY_FILE]=JSON.stringify(a)},i.pushSnapshotOnHistory=function(e,t){let i;(i=e[pxt.HISTORY_FILE]?T(e[pxt.HISTORY_FILE]):{entries:[],snapshots:[],shares:[],lastSaveTime:t}).snapshots.push(E(e,t)),e[pxt.HISTORY_FILE]=JSON.stringify(i)},i.updateShareHistory=function(e,i,s){let o;o=e[pxt.HISTORY_FILE]?T(e[pxt.HISTORY_FILE]):{entries:[],snapshots:[],shares:[],lastSaveTime:i};for(let t of s)o.shares.some(e=>e.id===t.id)||o.shares.push({id:t.id,timestamp:i});e[pxt.HISTORY_FILE]=JSON.stringify(o)},i.getTextAtTime=function(e,t,i,s){let o=Object.assign({},e);for(let e=0;e<t.entries.length;e++){var n=t.entries.length-1-e,r=t.entries[n];if(o=f(o,r,s),r.timestamp===i)return n=(0<n?t.entries[n-1]:r).editorVersion,l(o,n)}return{files:o,editorVersion:pxt.appTarget.versions.target}},i.patchConfigEditorVersion=l},{}],155:[function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var o=Object.getOwnPropertyDescriptor(t,i);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,o)}:function(e,t,i,s){e[s=void 0===s?i:s]=t[i]}),o=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)},n=(Object.defineProperty(i,"__esModule",{value:!0}),i.importDb=i.validation=i.experiments=i.workspace=i.monaco=i.history=void 0,e("./history")),n=(i.history=n,e("./monaco")),n=(i.monaco=n,e("./workspace")),n=(i.workspace=n,e("./experiments")),n=(i.experiments=n,e("./code-validation")),n=(i.validation=n,e("./projectImport"));i.importDb=n,o(e("./editor"),i),o(e("./editorcontroller"),i),o(e("./monaco-fields/monacoFieldEditor"),i),o(e("./monaco-fields/field_tilemap"),i),o(e("./monaco-fields/field_musiceditor"),i),o(e("./monaco-fields/field_soundEffect"),i),o(e("./monaco-fields/field_sprite"),i),o(e("./monaco-fields/field_react"),i)},{"./code-validation":143,"./editor":151,"./editorcontroller":152,"./experiments":153,"./history":154,"./monaco":162,"./monaco-fields/field_musiceditor":156,"./monaco-fields/field_react":157,"./monaco-fields/field_soundEffect":158,"./monaco-fields/field_sprite":159,"./monaco-fields/field_tilemap":160,"./monaco-fields/monacoFieldEditor":161,"./projectImport":163,"./workspace":164}],156:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.songEditorDefinition=i.MonacoSongEditor=void 0;var s=e("./field_react"),e=e("./monacoFieldEditor");let o="music-editor";class n extends s.MonacoReactFieldEditor{textToValue(e){this.isPython=-1===e.indexOf("`"),this.text=e;var t,i,s=pxt.parseAssetTSReference(e);return s?(s=s.name,s=s.trim(),i=pxt.react.getTilemapProject(),this.isAsset=!0,(t=i.lookupAssetByName("song",s))?this.editing=t:(t=i.createNewSong(pxt.assets.music.getEmptySong(2)),s&&!i.isNameTaken("song",s)&&pxt.validateAssetName(s)&&(t.meta.displayName=s),this.editing=t)):(i=/hex\s*(?:`|\(""")\s*([a-fA-F0-9]*)\s*(?:`|"""\))\s*(?:;?)/m.exec(e))?(s=i[1].trim(),this.editing=r(s?pxt.assets.music.decodeSongFromHex(s):pxt.assets.music.getEmptySong(2)),this.editing):void 0}resultToText(e){var t,i=pxt.react.getTilemapProject();if(i.pushUndo(),null!=(t=(e=pxt.patchTemporaryAsset(this.editing,e,i)).meta)&&t.displayName)return e=this.isAsset||i.lookupAsset(e.type,e.id)?i.updateAsset(e):i.createNewSong(e.song,e.meta.displayName),this.isAsset=!0,pxt.getTSReferenceForAsset(e,this.isPython);let s=pxt.assets.music.encodeSongToHex(e.song);return s=this.isPython?`hex("""${s}""")`:"hex`"+s+"`",this.text.replace(/hex\s*(?:`|\(""")\s*([a-fA-F0-9]*)\s*(?:`|"""\))\s*(?:;?)/m,s)}getFieldEditorId(){return o}getOptions(){return{blocksInfo:this.host.blocksInfo()}}}function r(e){return{type:"song",id:"",internalID:0,meta:{},song:e}}i.MonacoSongEditor=n,i.songEditorDefinition={id:o,foldMatches:!0,glyphCssClass:"fas fa-music sprite-focus-hover",heightInPixels:510,matcher:{searchString:'(?:(?:assets\\s*\\.\\s*song)|(?:music\\s*\\.\\s*create(?:S|_s)ong\\s*\\(\\s*hex))\\s*(?:`|\\(\\s*""")(?:(?:[^(){}:\\[\\]"\';?/,+\\-=*&|^%!`~]|\\n)*)\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:n},(0,e.registerMonacoFieldEditor)(o,i.songEditorDefinition)},{"./field_react":157,"./monacoFieldEditor":161}],157:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.MonacoReactFieldEditor=void 0;i.MonacoReactFieldEditor=class{getId(){return"image-editor"}showEditorAsync(e,t,i){return this.fileType=e,this.editrange=t,this.host=i,this.initAsync().then(()=>{var e=this.textToValue(i.getText(t));return e?(this.fv=pxt.react.getFieldEditorView(this.getFieldEditorId(),e,this.getOptions()),this.fv.onHide(()=>{this.onClosed()}),this.fv.show(),new Promise((e,t)=>{this.resolver=e,this.rejecter=t})):Promise.resolve(null)})}onClosed(){this.resolver&&(this.resolver({range:this.editrange,replacement:this.resultToText(this.fv.getResult())}),this.editrange=void 0,this.resolver=void 0,this.rejecter=void 0)}dispose(){this.onClosed()}initAsync(){return Promise.resolve()}textToValue(e){return null}resultToText(e){return e+""}getFieldEditorId(){return""}getOptions(){return null}}},{}],158:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.soundEditorDefinition=i.MonacoSoundEffectEditor=void 0;var s=e("./field_react"),e=e("./monacoFieldEditor");let o="soundeffect-editor";class n extends s.MonacoReactFieldEditor{textToValue(e){var t={wave:"sine",startFrequency:5e3,endFrequency:0,startVolume:255,endVolume:0,duration:500,effect:"none",interpolation:"linear"};this.value=t;e=/\(([^)]*)\)/.exec(e)[1].split(",").map(e=>e.replace(/\s/g,""));if(8===e.length){switch(e[0]){case"WaveShape.Sawtooth":t.wave="sawtooth";break;case"WaveShape.Square":t.wave="square";break;case"WaveShape.Noise":t.wave="noise";break;case"WaveShape.Triangle":t.wave="triangle";break;default:t.wave="sine"}var i=(e,t)=>isNaN(e)?t:e;switch(t.startFrequency=i(parseInt(e[1]),t.startFrequency),t.endFrequency=i(parseInt(e[2]),t.endFrequency),t.startVolume=i(parseInt(e[3]),t.startVolume),t.endVolume=i(parseInt(e[4]),t.endVolume),t.duration=i(parseInt(e[5]),t.duration),e[6]){case"SoundExpressionEffect.Vibrato":t.effect="vibrato";break;case"SoundExpressionEffect.Tremolo":t.effect="tremolo";break;case"SoundExpressionEffect.Warble":t.effect="warble";break;default:t.effect="none"}switch(e[7]){case"InterpolationCurve.Logarithmic":t.interpolation="logarithmic";break;case"InterpolationCurve.Curve":t.interpolation="curve";break;default:t.interpolation="linear"}}return t}resultToText(e){let t;switch((e=this.value).wave){case"sine":t="WaveShape.Sine";break;case"square":t="WaveShape.Square";break;case"triangle":t="WaveShape.Triangle";break;case"noise":t="WaveShape.Noise";break;case"sawtooth":t="WaveShape.Sawtooth"}let i;switch(e.effect){case"vibrato":i="SoundExpressionEffect.Vibrato";break;case"tremolo":i="SoundExpressionEffect.Tremolo";break;case"warble":i="SoundExpressionEffect.Warble";break;case"none":i="SoundExpressionEffect.None"}let s;switch(e.interpolation){case"curve":s="InterpolationCurve.Curve";break;case"linear":s="InterpolationCurve.Linear";break;case"logarithmic":s="InterpolationCurve.Logarithmic"}return`music.createSoundEffect(${t}, ${Math.round(e.startFrequency)}, ${Math.round(e.endFrequency)}, ${Math.round(e.startVolume)}, ${Math.round(e.endVolume)}, ${Math.round(e.duration)}, ${i}, ${s})`}getFieldEditorId(){return o}getOptions(){return{onClose:()=>this.fv.hide(),onSoundChange:e=>this.value=e,initialSound:this.value,useFlex:!0,useMixerSynthesizer:"microbit"!==pxt.appTarget.id}}}i.MonacoSoundEffectEditor=n,i.soundEditorDefinition={id:o,foldMatches:!0,glyphCssClass:"fas fa-music sprite-focus-hover",heightInPixels:510,matcher:{searchString:"music\\s*\\.\\s*createSoundEffect\\s*\\(",isRegex:!0,matchCase:!0,matchWholeWord:!1,validateRange:function(e,t){let i=e.startLineNumber,s=0,o=!1,n=0;for(var r="createSoundEffect",l=t.getLineCount();i<l;){var a=t.getLineContent(i),c=a.indexOf(r);if(-1!==c&&(o=!0,s=c+r.length),o)for(;s<a.length;){var u=a.charAt(s);if("("===u)n++;else if(")"===u&&0===--n)return new monaco.Range(e.startLineNumber,e.startColumn,i,s+t.getLineMinColumn(i)+1);s++}s=0,i++}}},proto:n},(0,e.registerMonacoFieldEditor)(o,i.soundEditorDefinition)},{"./field_react":157,"./monacoFieldEditor":161}],159:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.spriteEditorDefinition=i.MonacoSpriteEditor=void 0;var s=e("./field_react"),e=e("./monacoFieldEditor"),o="image-editor";class n extends s.MonacoReactFieldEditor{textToValue(e){this.isPython=-1===e.indexOf("`"),this.template=e.startsWith("bmp")?"bmp":"img";var t,i,s=pxt.parseAssetTSReference(e);return s?(s=s.name,s=s.trim(),t=pxt.react.getTilemapProject(),this.isAsset=!0,(i=t.lookupAssetByName("image",s))?this.editing=i:(i=t.createNewImage(),s&&!t.isNameTaken("image",s)&&pxt.validateAssetName(s)&&(i.meta.displayName=s),this.editing=i)):(this.editing={type:"image",id:"",internalID:0,bitmap:pxt.sprite.imageLiteralToBitmap(e,this.template).data(),meta:{},jresData:""},this.editing)}resultToText(e){var t,i=pxt.react.getTilemapProject();return i.pushUndo(),null!=(t=(e=pxt.patchTemporaryAsset(this.editing,e,i)).meta)&&t.displayName?(e=this.isAsset||i.lookupAsset(e.type,e.id)?i.updateAsset(e):i.createNewProjectImage(e.bitmap,e.meta.displayName),this.isAsset=!0,pxt.getTSReferenceForAsset(e,this.isPython)):pxt.sprite.bitmapToImageLiteral(pxt.sprite.Bitmap.fromData(e.bitmap),this.isPython?"python":"typescript",this.template)}getFieldEditorId(){return"image-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}}i.MonacoSpriteEditor=n,i.spriteEditorDefinition={id:o,foldMatches:!0,glyphCssClass:"sprite-editor-glyph sprite-focus-hover",heightInPixels:510,matcher:{searchString:'(?:img|bmp|assets\\s*\\.\\s*image)\\s*(?:`|\\(\\s*""")(?:(?:[^(){}:\\[\\]"\';?/,+\\-=*&|^%!`~]|\\n)*)\\s*(?:`|"""\\s*\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:n},(0,e.registerMonacoFieldEditor)(o,i.spriteEditorDefinition)},{"./field_react":157,"./monacoFieldEditor":161}],160:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.tilemapEditorDefinition=i.MonacoTilemapEditor=void 0;var s=e("./field_react"),e=e("./monacoFieldEditor"),o="tilemap-editor";class n extends s.MonacoReactFieldEditor{textToValue(e){var e=this.readTilemap(e),t=pxt.react.getTilemapProject();return pxt.sprite.addMissingTilemapTilesAndReferences(t,e),this.editing=e}readTilemap(e){var i=pxt.react.getTilemapProject();if(/^\s*tiles\s*\./.test(e)&&(this.isTilemapLiteral=!1,e)){try{return{type:"tilemap",id:"",internalID:0,meta:{},data:pxt.sprite.decodeTilemap(e,"typescript",i)}}catch(e){}return null}this.isTilemapLiteral=!0;e=/^\s*(tilemap(?:4|8|16|32)?)\s*(?:`([^`]*)`)|(?:\(\s*"""([^"]*)"""\s*\))\s*$/.exec(e);let t=(e[2]||e[3]||"").trim();this.tilemapLiteral=e[1];let s,o;if(t&&(o=ts.pxtc.escapeIdentifier(t),s=i.getTilemap(o)||i.lookupAssetByName("tilemap",t)),!s){let e=16,[t]=("tilemap8"===this.tilemapLiteral?e=8:"tilemap32"===this.tilemapLiteral?e=32:"tilemap4"===this.tilemapLiteral&&(e=4),i.createNewTilemap(o,e,16,16));s=i.getTilemap(t),o=t}return s}resultToText(e){var t=pxt.react.getTilemapProject();return t.pushUndo(),e=pxt.patchTemporaryAsset(this.editing,e,t),pxt.sprite.updateTilemapReferencesFromResult(t,e),this.isTilemapLiteral?(t.updateAsset(e),pxt.getTSReferenceForAsset(e,"python"===this.fileType)):pxt.sprite.encodeTilemap(e.data,"typescript"===this.fileType?"typescript":"python")}getFieldEditorId(){return"tilemap-editor"}getOptions(){return{initWidth:16,initHeight:16,blocksInfo:this.host.blocksInfo()}}getCreateTilemapRange(){var t=this.editrange.getStartPosition();let i=this.editrange.getEndPosition(),s=1;for(;;){var o,e=new monaco.Range(i.lineNumber,i.column,i.lineNumber+1,0),n=this.host.getText(e);for(let e=0;e<n.length;e++)if("("===n.charAt(e))s++;else if(")"===n.charAt(e))if(0===--s)return o=new monaco.Position(i.lineNumber,i.column+e+2),monaco.Range.fromPositions(t,o);if((i=e.getEndPosition()).lineNumber>t.lineNumber+20)return null}}}i.MonacoTilemapEditor=n,i.tilemapEditorDefinition={id:o,foldMatches:!0,alwaysBuildOnClose:!0,glyphCssClass:"sprite-focus-hover ms-Icon ms-Icon--Nav2DMapView",heightInPixels:510,weight:5,matcher:{searchString:'(?:tilemap(?:8|16|32)?\\s*(?:`|\\(""")(?:[ a-zA-Z0-9_]|\\n)*\\s*(?:`|"""\\)))|(?:tiles\\s*\\.\\s*createTilemap\\s*\\([^\\)]+\\))',isRegex:!0,matchCase:!0,matchWholeWord:!1},proto:n},(0,e.registerMonacoFieldEditor)(o,i.tilemapEditorDefinition)},{"./field_react":157,"./monacoFieldEditor":161}],161:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getMonacoFieldEditor=i.registerMonacoFieldEditor=void 0;let s={};i.registerMonacoFieldEditor=function(e,t){s[e]=t},i.getMonacoFieldEditor=function(e){return s[e]}},{}],162:[function(e,t,i){function r(e){var t=pxt.appTarget.appTheme.invertedMonaco,i=!(!pxt.appTarget.appTheme.monacoFieldEditors||!pxt.appTarget.appTheme.monacoFieldEditors.length),e=monaco.editor.create(e,{model:null,ariaLabel:pxt.Util.lf("JavaScript editor"),fontFamily:"'Consolas', 'Monaco', 'Menlo', 'Ubuntu Mono', 'source-code-pro', 'monospace'",scrollBeyondLastLine:!0,language:"typescript",mouseWheelZoom:!1,wordBasedSuggestions:!0,lineNumbersMinChars:3,formatOnPaste:!0,folding:i,glyphMargin:i||pxt.appTarget.appTheme.debugger,minimap:{enabled:!1},fixedOverflowWidgets:!0,autoIndent:"full",useTabStops:!0,dragAndDrop:!0,matchBrackets:"always",occurrencesHighlight:!1,quickSuggestionsDelay:200,theme:t?"vs-dark":"vs",renderIndentGuides:!0,accessibilityHelpUrl:"",quickSuggestions:{other:!0,comments:!0,strings:!0},acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",accessibilitySupport:"on"});return e.layout(),e}Object.defineProperty(i,"__esModule",{value:!0}),i.createEditor=i.initMonacoAsync=i.syncModels=void 0,i.syncModels=function(e,o,n,t){if(!t){t=monaco.languages.typescript.typescriptDefaults.getExtraLibs();let s={};e.sortedDeps().forEach(i=>{i.getFiles().forEach(e=>{var t=i.id+"/"+e;/\.(ts)$/.test(e)&&t!=n&&(monaco.languages.typescript.typescriptDefaults.getExtraLibs()[t]||(e=i.readFile(e)||"\n",o[t]=monaco.languages.typescript.typescriptDefaults.addExtraLib(e,t)),s[t]="1")})}),Object.keys(t).filter(e=>/\.(ts)$/.test(e)&&!s[e]).forEach(e=>{o[e].dispose()})}},i.initMonacoAsync=function(n){return new Promise((i,e)=>{if("object"==typeof window.monaco)i(r(n));else{let t=window.MonacoPaths;var s,o=()=>{var e=window.require;e.config({paths:t}),e(["vs/editor/editor.main"],()=>{monaco.languages.register({id:"asm",extensions:[".asm"]}),monaco.languages.setMonarchTokensProvider("asm",{tokenPostfix:"",keywords:["movs","mov","adds","add","adcs","adr","subs","sbcs","sub","rsbs","muls","cmp","cmn","ands","eors","orrs","bics","mvns","tst","lsls","lsrs","asrs","rors","ldr","ldrh","ldrb","ldrsh","ldrsb","ldm","str","strh","strb","stm","push","pop","cbz","cbnz","b","bl","bx","blx","sxth","sxtb","uxth","uxtb","rev","rev16","revsh","svc","cpsid","cpsie","setend","bkpt","nop","sev","wfe","wfi","yield","beq","bne","bcs","bhs","bcc","blo","bmi","bpl","bvs","bvc","bhi","bls","bge","blt","bgt","ble","bal","r0","r1","r2","r3","r4","r5","r6","r7","r8","r9","r10","r11","r12","r13","r14","r15","pc","sp","lr"],typeKeywords:[".startaddr",".hex",".short",".space",".section",".string",".byte"],operators:[],symbols:/[:\*]+/,escapes:/\\(?:[abfnrtv\\"']|x[0-9A-Fa-f]{1,4}|u[0-9A-Fa-f]{4}|U[0-9A-Fa-f]{8})/,tokenizer:{root:[[/(\.)?[a-z_$\.][\w$]*/,{cases:{"@typeKeywords":"keyword","@keywords":"keyword","@default":"identifier"}}],{include:"@whitespace"},[/[{}()\[\]]/,"@brackets"],[/[<>](?!@symbols)/,"@brackets"],[/@symbols/,{cases:{"@operators":"operator","@default":""}}],[/@\s*[a-zA-Z_\$][\w\$]*/,{token:"annotation"}],[/(#|(0[xX]))?[0-9a-fA-F]+/,"number"],[/[;,.]/,"delimiter"],[/"([^"\\]|\\.)*$/,"string.invalid"],[/"/,{token:"string.quote",bracket:"@open",next:"@string"}],[/'[^\\']'/,"string"],[/(')(@escapes)(')/,["string","string.escape","string"]],[/'/,"string.invalid"]],comment:[],string:[[/[^\\"]+/,"string"],[/@escapes/,"string.escape"],[/\\./,"string.escape.invalid"],[/"/,{token:"string.quote",bracket:"@close",next:"@pop"}]],whitespace:[[/[ \t\r\n]+/,"white"],[/\/\*/,"comment","@comment"],[/;.*$/,"comment"]]}}),monaco.languages.typescript&&(monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSyntaxValidation:!0,noSemanticValidation:!0}),monaco.languages.typescript.typescriptDefaults.setWorkerOptions({customWorkerPath:pxt.webConfig.typeScriptWorkerJs}),monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowUnreachableCode:!0,noImplicitAny:!0,allowJs:!1,allowUnusedLabels:!0,target:monaco.languages.typescript.ScriptTarget.ES5,outDir:"built",rootDir:".",noLib:!0,mouseWheelZoom:!1})),i(r(n))})};window.require?o():((s=document.createElement("script")).type="text/javascript",s.src=t["vs/loader"],s.addEventListener("load",o),document.body.appendChild(s))}})},i.createEditor=r},{}],163:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.removeProjectAsync=i.saveProjectAsync=void 0;let s,o="projects",n="importId";async function r(){var e;return s||(e=pxt.appTarget.id+"-import",await(s=new pxt.BrowserUtils.IDBWrapper(e,1,(e,t)=>{t.result.createObjectStore(o,{keyPath:n})})).openAsync()),s}i.saveProjectAsync=async function(e){var e={importId:pxt.U.guidGen(),project:e},t=await r();return await t.deleteAllAsync(o),await t.setAsync(o,e),e.importId},i.removeProjectAsync=async function(e){var t=await r(),e=await t.getAsync(o,e);return await t.deleteAllAsync(o),null==e?void 0:e.project}},{}],164:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.freshHeader=void 0,i.freshHeader=function(e,t){return{target:pxt.appTarget.id,targetVersion:pxt.appTarget.versions.target,name:e,meta:{},editor:pxt.JAVASCRIPT_PROJECT_NAME,pubId:"",pubCurrent:!1,_rev:null,id:pxt.U.guidGen(),recentUse:t,modificationTime:t,cloudUserId:null,cloudCurrent:!1,cloudVersion:null,cloudLastSyncTime:0,isDeleted:!1}}},{}],165:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var i=e("./runner"),s=e("./renderer"),e=e("../pxteditor");window.pxt||(window.pxt={}),window.pxt.runner=Object.assign(Object.assign({},i),s),window.pxt.editor=Object.assign({},e),(i=window.ksRunnerWhenLoaded)&&i()},{"../pxteditor":155,"./renderer":166,"./runner":167}],166:[function(e,o,t){Object.defineProperty(t,"__esModule",{value:!0}),t.renderAsync=t.fireClickOnEnter=t.defaultClientRenderOptions=void 0;let h=e("./runner"),d=e("blockly"),p=e("../pxtblocks"),a=e("../pxtblocks/codecardRenderer"),E="icon xicon js",v="icon xicon python",y="icon xicon blocks";function n(){return{blocksAspectRatio:window.innerHeight<window.innerWidth?1.62:1/1.62,snippetClass:"lang-blocks",signatureClass:"lang-sig",blocksClass:"lang-block",blocksXmlClass:"lang-blocksxml",diffBlocksXmlClass:"lang-diffblocksxml",diffClass:"lang-diff",diffStaticPythonClass:"lang-diffspy",diffBlocksClass:"lang-diffblocks",staticPythonClass:"lang-spy",simulatorClass:"lang-sim",linksClass:"lang-cards",namespacesClass:"lang-namespaces",apisClass:"lang-apis",codeCardClass:"lang-codecard",packageClass:"lang-package",jresClass:"lang-jres",assetJSONClass:"lang-assetsjson",projectClass:"lang-project",snippetReplaceParent:!0,simulator:!0,showEdit:!0,hex:!0,tutorial:!1,showJavaScript:!1,hexName:pxt.appTarget.id}}function l(e){"undefined"!=typeof hljs&&(e.hasClass("highlight")?hljs.highlightBlock(e[0]):e.find("code.highlight").each(function(e,t){hljs.highlightBlock(t)}),c(e))}function c(e){e.find("span.hljs-comment:contains(@highlight)").each((e,t)=>{try{{var s=t;var o=$(s),n=document.createElement("span");n.className="highlight-line";let i=s.nextSibling;if(i&&i.nodeType==Node.TEXT_NODE){let t=i.textContent,e=t.indexOf("\n");if(!(e<0)){for(i.textContent=t.substring(0,e+1),$(document.createTextNode(t.substring(e+1).replace(/^\s+/,""))).insertAfter($(i)),i=i.nextSibling;i;){var r=i.nextSibling;if(i.nodeType==Node.TEXT_NODE){let e=(t=i.textContent).indexOf("\n");if(!(e<0)){n.appendChild(document.createTextNode(t.substring(0,e))),i.textContent=t.substring(e+1);break}}n.appendChild(i),i=r}$(n).insertAfter(o),o.remove()}}return}}catch(e){pxt.reportException(e)}})}function k(e,t){e.append($('<div class="ui content blocks"/>').append(t))}function I(e,t){e.append($('<div class="ui content js"><div class="subheading"><i class="ui icon xicon js"></i>JavaScript</div></div>').append(t)),l(t)}function C(e,t){e.append($('<div class="ui content py"><div class="subheading"><i class="ui icon xicon python"></i>Python</div></div>').append(t)),l(t)}function S(e,t){var i=$('<a class="item" role="button" tabindex="0"><i role="presentation" aria-hidden="true"></i><span class="ui desktop only"></span></a>');return i.attr("aria-label",e),i.attr("title",e),i.find("i").attr("class",t),i.find("span").text(e),i.keypress(s),i}function s(e){var t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}t.defaultClientRenderOptions=n,t.fireClickOnEnter=s;let w=!1;function g(n,e,r,t,i,s,o={}){var l=$('<div class="ui bottom attached tabular icon small compact menu hideprint"> <div class="right icon menu"></div></div>');let a=$('<div class="ui top attached segment codewidget"></div>'),c=l.find(".right.menu");var u=pxt.appTarget.appTheme||{};if(o.showEdit&&!u.hideDocsEdit&&s){var h=S(lf("Edit"),"edit icon"),{package:d,compileBlocks:s,compilePython:p}=s,g=d.host();if(i&&s?(d.setPreferredEditor(pxt.BLOCKS_PROJECT_NAME),g.writeFile(d,pxt.MAIN_BLOCKS,s.outfiles[pxt.MAIN_BLOCKS])):t&&p?(d.setPreferredEditor(pxt.PYTHON_PROJECT_NAME),g.writeFile(d,pxt.MAIN_PY,s.outfiles[pxt.MAIN_PY])):d.setPreferredEditor(pxt.JAVASCRIPT_PROJECT_NAME),n.assetJSON)for(var m of Object.keys(n.assetJSON))d.config.files.indexOf(m)<0&&d.config.files.push(m),g.writeFile(d,m,n.assetJSON[m]);let e=d.compressToFileAsync();h.click(()=>{pxt.tickEvent("docs.btn",{button:"edit"}),e.then(e=>{window.open((e=>((e=e.pxtUrl||pxt.appTarget.appTheme.homeUrl)||"").replace(/\/$/,""))(n)+"/#project:"+ts.pxtc.encodeBase64(pxt.Util.uint8ArrayToString(e)),"pxt")})}),c.append(h)}n.showJavaScript||!i&&!t?(a.append(r),_(),f()):i?(a.append(i),b(),f()):t&&(a.append(t),_(),b()),o.run&&!u.hideDocsSimulator&&(p=S(lf("Run"),"play icon").click(()=>{if(pxt.tickEvent("docs.btn",{button:"sim"}),a.find(".sim")[0])a.find(".sim").remove(),T(a);else{w||(w=!0,window.addEventListener("message",e=>{var t,e=e.data;"aspectratio"===e.type&&(t=e.value,null!=(e=document.querySelector(`iframe[data-frameid="${e.frameid}"]`)))&&e.parentElement&&(e.parentElement.style.paddingBottom=100/t+"%")}));let e="81.97%";pxt.appTarget.simulator&&(e=100/pxt.appTarget.simulator.aspectRatio+"%");var t=n.package?"&deps="+encodeURIComponent(n.package):"",t=D(n)+"#nofooter=1"+t,i=n.assetJSON?`data-assets="${encodeURIComponent(JSON.stringify(n.assetJSON))}"`:"",s=encodeURIComponent(r.text()),o="sim-"+pxt.Util.guidGen(),t=$(`<div class="ui card sim"><div class="ui content"><div style="position:relative;height:0;padding-bottom:${e};overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${t}" data-code="${s}" data-frameid="${o}" ${i} allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div></div></div>`);a.append(t),T(t)}}),c.append(p)),o.hexname&&o.hex&&(s=S(lf("Download"),"download icon").click(()=>{pxt.tickEvent("docs.btn",{button:"hex"}),pxt.BrowserUtils.browserDownloadBinText(o.hex,o.hexname,{contentType:pxt.appTarget.compile.hexMimeType})}),c.append(s));h=$("<div class=codesnippet></div>");function _(){var e;i&&(e=S(lf("Blocks"),y).click(()=>{pxt.tickEvent("docs.btn",{button:"blocks"}),a.find(".blocks")[0]?(a.find(".blocks").remove(),T(a)):(k(r?r.parent():a,i),T(i))}),c.append(e))}function b(){var e;r&&(o.showJs?I(a,r):(e=S("JavaScript",E).click(()=>{pxt.tickEvent("docs.btn",{button:"js"}),a.find(".js")[0]?(a.find(".js").remove(),T(a)):(I(i?i.parent():a,r),T(r))}),c.append(e)))}function f(){var e;t&&(o.showPy?C(a,t):(e=S("Python",v).click(()=>{pxt.tickEvent("docs.btn",{button:"py"}),a.find(".py")[0]?(a.find(".py").remove(),T(a)):(C(i?i.parent():a,t),T(t))}),c.append(e)))}function T(e){null!=(e=e[0])&&e.scrollIntoView({behavior:"smooth",block:"center"})}c.children().length&&h.append(l),h.append(a),e.replaceWith(h)}let u=[];function m(){let n={};return function e(){let t=u.shift();if(!t)return Promise.resolve();let{el:i,options:s,render:o}=t;return(0,h.decompileSnippetAsync)(i.text(),s).then(e=>{let t=e.compileJS&&e.compileJS.diagnostics&&e.compileJS.diagnostics.filter(e=>e.category==pxtc.DiagnosticCategory.Error);t&&t.length&&t.forEach(e=>pxt.reportError("docs.decompile",""+e.messageText,{code:e.code+""})),e.blocksSvg.querySelectorAll("defs *").forEach(e=>{n[e.id]?e.remove():n[e.id]=!0}),o(i,e)},e=>{pxt.reportException(e),i.append($("<div/>").addClass("ui segment warning").text(e.message))}).finally(()=>(i.removeClass("lang-shadow"),e()))}().then(()=>{d.Workspace.getAll().forEach(e=>e.dispose()),(0,p.cleanRenderingWorkspace)()})}function _(e,t,i){var s;return e&&(s=$("."+e).first())[0]?(i.emPixels||(i.emPixels=18),i.layout||(i.layout=1),i.splitSvg=!0,u.push({el:s,source:s.text(),options:i,render:t}),s.addClass("lang-shadow"),s.removeClass(e),_(e,t,i)):Promise.resolve()}function b(e){return e&&e.kind==ts.SyntaxKind.ExpressionStatement&&e.expression&&e.expression.kind==ts.SyntaxKind.CallExpression?pxtc.pxtInfo(e.expression).callInfo:null}function f(i){return i.blocksXmlClass?function t(i,s,o){let n=$("."+i).first();return n[0]?(o.emPixels||(o.emPixels=18),o.splitSvg=!0,(0,h.compileBlocksAsync)(n.text(),o).then(e=>{try{s(n,e)}catch(e){pxt.reportException(e),n.append($("<div/>").addClass("ui segment warning").text(e.message))}return n.removeClass(i),pxt.U.delay(1,t(i,s,o))})):Promise.resolve()}(i.blocksXmlClass,(e,t)=>{t=t.blocksSvg,i.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:i.package,snippetMode:!0,aspectRatio:i.blocksAspectRatio,assets:i.assetJSON}):Promise.resolve()}function T(i){return i.diffBlocksXmlClass?function i(s,o,n){let r=$("."+s).first();if(!r[0])return Promise.resolve();n.emPixels||(n.emPixels=18),n.splitSvg=!0;var e=r.text().split(/-{10,}/);let l=e[0],a=e[1];return(0,h.compileBlocksAsync)("",n).then(e=>{r.removeClass(s);try{var t=(0,p.diffXml)(l,a);t?(e.blocksSvg=t.svg,o(r,e)):r.text("no changes")}catch(e){pxt.reportException(e),r.append($("<div/>").addClass("ui segment warning").text(e.message))}return pxt.U.delay(1,i(s,o,n))})}(i.diffBlocksXmlClass,(e,t)=>{t=t.blocksSvg,i.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:i.package,snippetMode:!0,aspectRatio:i.blocksAspectRatio,assets:i.assetJSON}):Promise.resolve()}function A(l){return l.diffClass?function e(t){let i=$("."+t).first();if(!i[0])return Promise.resolve();var{fileA:s,fileB:o}=pxt.diff.split(i.text());try{var n=pxt.diff.render(s,o,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0}),r=(l.snippetReplaceParent&&(i=i.parent()),$('<div class="ui segment codewidget"/>').append(n));i.removeClass(t),i.replaceWith(r)}catch(e){pxt.reportException(e),i.append($("<div/>").addClass("ui segment warning").text(e.message))}return pxt.U.delay(1,e(t))}(l.diffClass):Promise.resolve()}function x(u){return u.diffBlocksClass?function e(r){let l=$("."+r).first();if(!l[0])return Promise.resolve();let{fileA:a,fileB:c}=pxt.diff.split(l.text(),{removeTrailingSemiColumns:!0});return pxt.U.promiseMapAllSeries([a,c],e=>(0,h.decompileSnippetAsync)(e,{generateSourceMap:!0})).then(t=>{try{var i=(0,p.decompiledDiffAsync)(a,t[0].compileBlocks,c,t[1].compileBlocks,{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0}),s=pxt.diff.render(a,c,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});let e;var[o,n]=t.map(e=>e.compilePython&&e.compilePython.outfiles&&e.compilePython.outfiles[pxt.MAIN_PY]);o&&n&&(e=pxt.diff.render(o,n,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0})),g(u,l.parent(),$(s),e&&$(e),$(i.svg),void 0,{showEdit:!1,run:!1,hexname:void 0,hex:void 0})}catch(e){pxt.reportException(e),l.append($("<div/>").addClass("ui segment warning").text(e.message))}return pxt.U.delay(1,e(r))})}(u.diffBlocksClass):Promise.resolve()}let i;function R(e){return i=i||(0,h.decompileSnippetAsync)("",e)}function F(r){(r=pxt.Util.clone(r)).emPixels=18,r.snippetMode=!0;let l=$(":not(pre) > code"),a=0;return function e(){if(a>=l.length)return Promise.resolve();let s=$(l[a++]);var t,i,o=s.text(),n=/^(\|+)([^\|]+)\|+$/.exec(o);return n?(t=((i=/^(([^\:\.]*?)[\:\.])?(.*)$/.exec(n[2]))[2]?i[2].trim().toLowerCase():"").replace(/\(.*?\)/g,""),n=1==n[1].length?"docs inlinebutton "+t:"docs inlineblock "+t,t=i[3].trim(),s.replaceWith($(`<span class="${n}"/>`).text(pxt.U.rlf(t))),e()):(i=/^\[(.+)\]$/.exec(o))?(n=i[1],(0,h.decompileSnippetAsync)(n,r).then(t=>{if(t.blocksSvg){let e=$('<span class="block"/>').append(t.blocksSvg);var i=b(t.compileProgram.getSourceFile(pxt.MAIN_TS).statements[0]);i&&t.apiInfo&&(t=t.apiInfo.byQName[i.qName])&&t.attributes.help&&(e=$('<a class="ui link"/>').attr("href","/reference/"+t.attributes.help).append(e)),s.replaceWith(e)}return pxt.U.delay(1,e())})):e()}()}function U(o){return o.projectClass?function e(){var t=$("."+o.projectClass).first();let i=t[0];if(!i)return Promise.resolve();t.removeClass(o.projectClass);var s,t=pxt.Cloud.parseScriptId(i.innerText);return t?(o.snippetReplaceParent&&(i=i.parentElement,s=document.createElement("div"),i.parentElement.insertBefore(s,i),i.parentElement.removeChild(i),i=s),(0,h.renderProjectAsync)(i,t).then(()=>e())):e()}():Promise.resolve()}function O(e,t){var i,s,o;t&&(o=/^\/(v\d+)/.exec(t.url),i=/^\/(v\d+)/.exec(window.location.pathname),s=/#doc/i.test(window.location.href),t.url&&!o&&i&&!s&&(t.url=`/${i[1]}/`+t.url),(o=document.createElement("div")).setAttribute("role","listitem"),o.append((0,a.renderCodeCard)(t,{hideHeader:!0,shortName:!0})),e.append(o))}function N(e,t,i){var s=t.attributes,o=!s.blockHidden&&d.Blocks[s.blockId];(null==o?void 0:o.codeCard)?(o=pxt.U.clone(o.codeCard),i&&(o.style=i),O(e,o)):O(e,{name:t.qName,description:s.jsDoc,url:s.help||void 0,style:i})}function L(e,t,i,u){return _(t,(e,c)=>{var t=c.compileProgram;if(t){t=t.getSourceFile(pxt.MAIN_TS).statements.slice(0);let a=document.createElement("div");a.setAttribute("role","list"),a.className="card-list",t.forEach(t=>{var e=t.kind,i=b(t);if(i&&c.apiInfo&&c.apiInfo.byQName[i.qName]){var s,i=c.apiInfo.byQName[i.qName],o=i.attributes,n=d.Blocks[o.blockId];u?(s=c.compileBlocks.blocksInfo.apis.byQName[i.namespace],O(a,{name:s.attributes.blockNamespace||s.name,url:s.attributes.help||"reference/"+(s.attributes.blockNamespace||s.name).toLowerCase(),description:s.attributes.jsDoc,blocksXml:n&&n.codeCard?n.codeCard.blocksXml:o.blockId?`<xml xmlns="http://www.w3.org/1999/xhtml"><block type="${o.blockId}"></block></xml>`:void 0})):N(a,i)}else switch(e){case ts.SyntaxKind.ExpressionStatement:var r=t;switch(r.expression.kind){case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:O(a,{name:"Boolean",url:"blocks/logic/boolean",description:lf("True or false values"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="logic_boolean"><field name="BOOL">TRUE</field></block></xml>'});break;default:pxt.debug("card expr kind: "+r.expression.kind)}break;case ts.SyntaxKind.IfStatement:O(a,{name:u?"Logic":"if",url:"blocks/logic"+(u?"":"/if"),description:u?lf("Logic operators and constants"):lf("Conditional statement"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_if"></block></xml>'});break;case ts.SyntaxKind.WhileStatement:O(a,{name:u?"Loops":"while",url:"blocks/loops"+(u?"":"/while"),description:u?lf("Loops and repetition"):lf("Repeat code while a condition is true."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="device_while"></block></xml>'});break;case ts.SyntaxKind.ForOfStatement:O(a,{name:u?"Loops":"for of",url:"blocks/loops"+(u?"":"/for-of"),description:u?lf("Loops and repetition"):lf("Repeat code for each item in a list."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_for_of"></block></xml>'});break;case ts.SyntaxKind.BreakStatement:O(a,{name:u?"Loops":"break",url:"blocks/loops"+(u?"":"/break"),description:u?lf("Loops and repetition"):lf("Break out of the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="break_keyword"></block></xml>'});break;case ts.SyntaxKind.ContinueStatement:O(a,{name:u?"Loops":"continue",url:"blocks/loops"+(u?"":"/continue"),description:u?lf("Loops and repetition"):lf("Skip iteration and continue the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="continue_keyboard"></block></xml>'});break;case ts.SyntaxKind.ForStatement:{var l=t;let e=!0;(e=3==l.condition.getChildCount()?!("0"==l.condition.getChildAt(0).getText()||l.condition.getChildAt(1).kind==ts.SyntaxKind.LessThanToken):e)?O(a,{name:u?"Loops":"for",url:"blocks/loops"+(u?"":"/for"),description:u?lf("Loops and repetition"):lf("Repeat code for a given number of times using an index."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_simple_for"></block></xml>'}):O(a,{name:u?"Loops":"repeat",url:"blocks/loops"+(u?"":"/repeat"),description:u?lf("Loops and repetition"):lf("Repeat code for a given number of times."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_repeat_ext"></block></xml>'});break}case ts.SyntaxKind.VariableStatement:O(a,{name:u?"Variables":"variable declaration",url:"blocks/variables"+(u?"":"/assign"),description:u?lf("Variables"):lf("Assign a value to a named variable."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="variables_set"></block></xml>'});break;default:pxt.debug("card kind: "+e)}}),(e=i?e.parent():e).replaceWith(a)}},{package:e.package,aspectRatio:e.blocksAspectRatio,assets:e.assetJSON})}function M(e,t){if(!e)return Promise.resolve();let i=$("."+e).first();if(!i[0])return Promise.resolve();i.removeClass(e);var s=pxt.gallery.parseCodeCardsHtml(i[0]);return s||i.append($("<div/>").addClass("ui segment warning").text("invalid codecard format")),((e,t,l)=>{if(t&&0!=t.length)if(0==t.length){var i=(0,a.renderCodeCard)(t[0],l);e.replaceWith(i)}else{let r=document.createElement("div");r.className="card-list",r.setAttribute("role","list"),r.setAttribute("aria-label",l.cardCategory||lf("Content cards")),t.forEach(i=>{var e=/^\/(v\d+)/.exec(i.url),t=/^\/(v\d+)/.exec(window.location.pathname),s=/#doc/i.test(window.location.href);i.url&&!e&&t&&!s&&(i.url="/"+t[1]+i.url);let o=(0,a.renderCodeCard)(i,l),n=document.createElement("div");if(n.setAttribute("role","listitem"),n.appendChild(o),r.appendChild(n),"package"==i.cardType){let t=pxt.github.parseRepoId((i.url||"").replace(/^\/pkg\//,""));t&&pxt.packagesConfigAsync().then(e=>{switch(pxt.github.repoStatus(t,e)){case pxt.github.GitRepoStatus.Banned:o.remove();break;case pxt.github.GitRepoStatus.Approved:i.imageUrl=pxt.github.mkRepoIconUrl(t),n.insertBefore((0,a.renderCodeCard)(i,l),o),o.remove()}}).catch(e=>{pxt.reportException(e),pxt.debug("failed to load repo "+i.url)})}}),e.replaceWith(r)}return Promise.resolve()})(i=t.snippetReplaceParent?i.parent():i,s,{hideHeader:!0,cardCategory:t.hexName}).then(()=>pxt.U.delay(1,M(e,t)))}function D(e){return e.pxtUrl?e.pxtUrl+"/--run":pxt.webConfig&&pxt.webConfig.runUrl?pxt.webConfig.runUrl:"/--run"}function H(e){let s,o;e.jresClass&&$("."+e.jresClass).each((e,t)=>{var i=$(t);o=i.text(),t.parentElement.remove()}),e.assetJSONClass&&$("."+e.assetJSONClass).each((e,t)=>{var i=$(t);s=i.text(),t.parentElement.remove()}),e.assetJSON=((e,t)=>{if(e||t)return e=pxt.tutorial.parseAssetJson(e)||{},t&&(t=JSON.parse(t),e[pxt.TILEMAP_JRES]=JSON.stringify(t),e[pxt.TILEMAP_CODE]=pxt.emitTilemapsFromJRes(t)),e})(s,o)}function G(n){let r={showEdit:!!n.showEdit,run:!!n.simulator};$("code.lang-python").each((e,t)=>{var i,s,o;i=t,s=!1,"undefined"!=typeof hljs&&($(i).text($(i).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(i),c($(i))),o=pxt.U.clone(r),s&&(o.run=!1,o.showEdit=!1),g(n,$(i).parent(),$(i),void 0,void 0,void 0,o),$(t).removeClass("lang-python")})}function B(e,t){(e=t.snippetReplaceParent?e.parent():e).remove()}function P(e,t,i){$(`code.lang-${e}\\.`+t).each((e,t)=>{B($(t),i)})}t.renderAsync=function(r){var s,e,a;pxt.analytics.enable(pxt.Util.userLanguage()),(r=r||n()).pxtUrl&&(r.pxtUrl=r.pxtUrl.replace(/\/$/,"")),r.showEdit&&(r.showEdit=!pxt.BrowserUtils.isIFrame()),(s=r).packageClass&&($("."+s.packageClass).each((e,t)=>{let i=$(t);t=i.text().split("\n").map(e=>e.replace(/\s*/g,"")).filter(e=>!!e).join(",");s.package=s.package?s.package+","+t:t,(i=s.snippetReplaceParent?i.parent():i).remove()}),$(".lang-config").each((e,t)=>{let i=$(t);(i=s.snippetReplaceParent?i.parent():i).remove()})),H(r),u=[],e=r,B($("code.lang-ghost"),e),P("blockconfig","local",e=r),P("blockconfig","global",e),e=r,B($("code.lang-template"),e),P("validation","local",e=r),P("validation","global",e),(a=r).simulatorClass&&$("."+a.simulatorClass).each((e,t)=>{let i,s=$(t),o="81.97%";pxt.appTarget.simulator&&(o=100/pxt.appTarget.simulator.aspectRatio+"%");var t=lf("MakeCode {0} Simulator",(null==(i=pxt.appTarget.appTheme)?void 0:i.boardName)||pxt.appTarget.name),t=$(`
            <div class="ui card">
                <div class="ui content">
                    <div style="position:relative;height:0;padding-bottom:${o};overflow:hidden;">
                        <iframe
                            style="position:absolute;top:0;left:0;width:100%;height:100%;"
                            allowfullscreen="allowfullscreen"
                            frameborder="0"
                            sandbox="allow-popups allow-forms allow-scripts allow-same-origin"
                            title="${pxt.U.htmlEscape(t)}"
                        ></iframe>
                    </div>
                </div>
            </div>
        `),n=a.package?"&deps="+encodeURIComponent(a.package):"",n=D(a)+"#nofooter=1"+n,r=encodeURIComponent(s.text().trim()),l=t.find("iframe");l.attr("src",n),l.attr("data-code",r),a.assetJSON&&l.attr("data-assets",JSON.stringify(a.assetJSON)),(s=a.snippetReplaceParent?s.parent():s).replaceWith(t)});{var o=r;let s={showEdit:!!o.showEdit,run:!!o.simulator};function i(e,t){"undefined"!=typeof hljs&&($(e).text($(e).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(e),c($(e)));var i=pxt.U.clone(s);t&&(i.run=!1,i.showEdit=!1),g(o,$(e).parent(),$(e),void 0,void 0,void 0,i)}$("code.lang-typescript").each((e,t)=>{i(t,!1),$(t).removeClass("lang-typescript")}),$("code.lang-typescript-ignore").each((e,t)=>{$(t).removeClass("lang-typescript-ignore"),$(t).addClass("lang-typescript"),i(t,!0),$(t).removeClass("lang-typescript")}),$("code.lang-typescript-invalid").each((e,t)=>{$(t).removeClass("lang-typescript-invalid"),$(t).addClass("lang-typescript"),i(t,!0),$(t).removeClass("lang-typescript"),$(t).parent("div").addClass("invalid"),$(t).parent("div").prepend($("<i>",{class:"icon ban"})),$(t).addClass("invalid")}),$("code.lang-typescript-valid").each((e,t)=>{$(t).removeClass("lang-typescript-valid"),$(t).addClass("lang-typescript"),i(t,!0),$(t).removeClass("lang-typescript"),$(t).parent("div").addClass("valid"),$(t).parent("div").prepend($("<i>",{class:"icon check"})),$(t).addClass("valid")})}return G(r),Promise.resolve().then(()=>M(r.codeCardClass,r)).then(()=>(async t=>{if("core"!=pxt.appTarget.id){var i,s,o,n=(await R(t)).compileBlocks.blocksInfo,r={};for(i of n.blocks){var l,a=(i.attributes.blockNamespace||i.namespace).split(".")[0];r[a]||(l=n.apis.byQName[a])&&l.attributes.color&&(r[a]=l.attributes.color)}let e="";for(s of Object.keys(r)){var c=r[s];e+=`
                span.docs.${s.toLowerCase()} {
                    --inline-namespace-color: ${c};
                }
            `}for(o of Object.keys(pxt.toolbox.blockColors)){var u=pxt.toolbox.getNamespaceColor(o);e+=`
                span.docs.${o.toLowerCase()} {
                    --inline-namespace-color: ${u};
                }
            `}t=document.createElement("style");t.id="namespaceColors",t.type="text/css",(document.head||document.getElementsByTagName("head")[0]).appendChild(t),t.appendChild(document.createTextNode(e))}})(r)).then(()=>F(r)).then(()=>L(r,r.linksClass,r.snippetReplaceParent,!1)).then(()=>L(r,r.namespacesClass,r.snippetReplaceParent,!0)).then(()=>{{var e=r,n=r.snippetReplaceParent,i=e.apisClass;if(!i)return Promise.resolve();let t=$("."+i);return t.length?R(e).then(e=>{e=e.compileBlocks.blocksInfo;let o=pxt.Util.values(e.apis.byQName).filter(e=>!(e.attributes.hidden||e.attributes.deprecated||e.attributes.blockAliasFor||!e.attributes.jsDoc||!e.attributes.block||/^__/.test(e.name)));t.each((e,i)=>{let s=$(i),t=pxt.Util.toDictionary(s.text().split("\n"),e=>e);i=o.filter(e=>!!t[e.attributes.blockNamespace||e.namespace]);if(i.length){i.sort((e,t)=>{var i=!e.attributes.blockHidden&&d.Blocks[e.attributes.blockId],s=!t.attributes.blockHidden&&d.Blocks[t.attributes.blockId];return!!i!=!!s?(s?1:0)-(i?1:0):e.name.localeCompare(t.name)});let t=document.createElement("div");t.className="ui divided items",t.setAttribute("role","list"),i.forEach(e=>N(t,e,"item")),(s=n?s.parent():s).replaceWith(t)}})}):Promise.resolve()}}).then(()=>{return _((l=r).signatureClass,(e,t)=>{var i,s,o,n,r=t.compileProgram;r&&(r=b(r.getSourceFile(pxt.MAIN_TS).statements[0]))&&t.apiInfo&&(r=t.apiInfo.byQName[r.qName])&&(i=(i=(i=(null==(i=null==(i=d.Blocks[r.attributes.blockId])?void 0:i.codeCard)?void 0:i.blocksXml)||void 0)?(0,p.render)(i):null!=(i=t.compileBlocks)&&i.success?t.blocksSvg:void 0)?$(i):void 0,s=ts.pxtc.service.displayStringForSymbol(r,!1,t.apiInfo).split("\n")[1]+";",s=$('<code class="lang-typescript highlight"/>').text(s),o=(o=(null==(o=null==(o=pxt.appTarget)?void 0:o.appTheme)?void 0:o.python)&&ts.pxtc.service.displayStringForSymbol(r,!0,t.apiInfo).split("\n")[1])&&$('<code class="lang-python highlight"/>').text(o),l.snippetReplaceParent&&(e=e.parent()),pxt.Util.isTranslationMode()&&((n=$('<div class="ui segment" />')).append($('<div class="ui header"><i class="ui xicon globe"></i></div>')),r.attributes.translationId&&n.append($('<div class="ui message">').text(r.attributes.translationId)),r.attributes.jsDoc&&n.append($('<div class="ui message">').text(r.attributes.jsDoc)),n.insertAfter(e)),g(l,e,s,o,i,t,{showJs:!0,showPy:!0,hideGutter:!0}))},{package:l.package,snippetMode:!0,aspectRatio:l.blocksAspectRatio,assets:l.assetJSON});var l}).then(()=>{{var a=r;if(a.tutorial)return _(a.snippetClass,(e,t)=>{t=t.blocksSvg,a.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:a.package,snippetMode:!1,aspectRatio:a.blocksAspectRatio,assets:a.assetJSON});let l=0;return _(a.snippetClass,(e,t)=>{var i=t.compileBlocks&&t.compileBlocks.success?$(t.blocksSvg):void 0,s=t.compilePython&&t.compilePython.success&&t.compilePython.outfiles[pxt.MAIN_PY],o=$('<code class="lang-typescript highlight"/>').text(e.text().trim()),s=s?$('<code class="lang-python highlight"/>').text(s.trim()):void 0,n=(a.snippetReplaceParent&&(e=e.parent()),t.compileJS&&t.compileJS.success),n=a.hex&&n&&t.compileJS.outfiles[pxtc.BINARY_HEX]?t.compileJS.outfiles[pxtc.BINARY_HEX]:void 0,r=`${pxt.appTarget.nickname||pxt.appTarget.id}-${a.hexName||""}-${l++}.hex`;g(a,e,o,s,i,t,{showEdit:a.showEdit,run:a.simulator,hexname:r,hex:n})},{package:a.package,aspectRatio:a.blocksAspectRatio,assets:a.assetJSON})}}).then(()=>{return _((i=r).blocksClass,(e,t)=>{t=t.blocksSvg,i.snippetReplaceParent&&(e=e.parent()),t=$('<div class="ui segment codewidget"/>').append(t);e.replaceWith(t)},{package:i.package,snippetMode:!0,aspectRatio:i.blocksAspectRatio,assets:i.assetJSON});var i}).then(()=>f(r)).then(()=>T(r)).then(()=>x(r)).then(()=>A(r)).then(()=>{{var n=r;let o={showEdit:!!n.showEdit,run:!!n.simulator};return _(n.staticPythonClass,(e,t)=>{var i,s=t.compilePython;s&&s.success&&(s=(i=e.clone().removeClass("lang-shadow").addClass("highlight")).clone().addClass("lang-python").text(s.outfiles[pxt.MAIN_PY]),i.addClass("lang-typescript"),l(s),g(n,e.parent(),i,s,void 0,t,o))},{package:n.package,snippetMode:!0,assets:n.assetJSON})}}).then(()=>U(r)).then(()=>m())}},{"../pxtblocks":74,"../pxtblocks/codecardRenderer":11,"./runner":167,blockly:175}],167:[function(e,B,d){Object.defineProperty(d,"__esModule",{value:!0}),d.init=d.setInitCallbacks=d.compileBlocksAsync=d.decompileSnippetAsync=d.renderMarkdownAsync=d.renderProjectFilesAsync=d.renderProjectAsync=d.startDocsServer=d.startRenderServer=d.setEditorContextAsync=d.editorLanguageMode=d.LanguageMode=d.buildSimJsInfo=d.fetchSimJsInfo=d.postSimMessage=d.currentDriver=d.preloadSim=d.simulateAsync=d.generateVMFileAsync=d.generateHexFileAsync=d.showError=d.initFooter=d.initHost=d.mainPkg=void 0;let p=e("../pxtblocks"),l=e("../pxteditor/editor"),a=e("./renderer"),s=e("../pxtblocks"),t=e("blockly");pxt.blocks.requirePxtBlockly=()=>s,pxt.blocks.requireBlockly=()=>t,pxt.blocks.registerFieldEditor=(e,t,i)=>s.registerFieldEditor(e,t,i);class o{constructor(e,t){this.ksPkg=e,this.topPkg=t,this.files={}}getKsPkg(){return this.ksPkg}getPkgId(){return(this.ksPkg||this).id}isTopLevel(){return this.ksPkg&&0==this.ksPkg.level}setFiles(e){this.files=e}getAllFiles(){return pxt.Util.mapMap(this.files,(e,t)=>t)}}class P{constructor(){this.githubPackageCache={}}readFile(e,t){e=c(e);return pxt.U.lookup(e.files,t)}writeFile(e,t,i){c(e).files[t]=i}getHexInfoAsync(e){return pxt.hexloader.getHexInfoAsync(this,e)}cacheStoreAsync(e,t){return Promise.resolve()}cacheGetAsync(e){return Promise.resolve(null)}patchDependencies(e,t,i){if(i){var s=pxt.github.parseRepoId(i);if(s)for(var o of Object.keys(e.dependencies)){var n=e.dependencies[o],n=pxt.github.parseRepoId(n);if(n&&s.fullName==n.fullName)return pxt.semver.strcmp(s.tag,n.tag)<0&&(e.dependencies[o]=i),!0}}return!1}downloadPackageAsync(i,s){let t=i.verProtocol(),o=void 0,n=("github"==t&&(o=this.githubPackageCache[i._verspec]),c(i));return(o?Promise.resolve(o):i.commonDownloadAsync()).then(e=>{if(e)return"github"!=t||o||(this.githubPackageCache[i._verspec]=pxt.Util.clone(e)),n.setFiles(e),Promise.resolve();if("empty"==t){if(0==Object.keys(n.files).length&&n.setFiles(u()),s&&s.length){e=c(i).files;let t=JSON.parse(e[pxt.CONFIG_NAME]);s.forEach(e=>{r(t,e)}),e[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(t)}return Promise.resolve()}if("docs"!=t)return"invalid"==t?(pxt.log("skipping invalid pkg "+i.id),Promise.resolve()):Promise.reject(`Cannot download ${i.version()}; unknown protocol`);{e=u();let t=JSON.parse(e[pxt.CONFIG_NAME]);return i.verArgument().split(",").forEach(e=>{r(t,e)}),t.yotta||(t.yotta={}),t.yotta.ignoreConflicts=!0,e[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(t),n.setFiles(e),Promise.resolve()}})}}let g;function r(e,t){var i=/^([a-zA-Z0-9_-]+)(=(.+))?$/.exec(t);return i?e.dependencies[i[1]]=i[3]||"*":pxt.warn("unknown package syntax "+t),1}function c(e){var t=e._editorPkg;if(t)return t;let i=null;e!=d.mainPkg&&(i=c(d.mainPkg));t=new o(e,i);return e==d.mainPkg&&(t.topPkg=t),e._editorPkg=t}function u(){var e=pxt.appTarget.tsprj,t=pxt.U.clone(e.files);return t[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(e.config),t[pxt.MAIN_BLOCKS]="",t}function F(){pxt.setAppTarget(window.pxtTargetBundle),pxt.analytics.enable(pxt.Util.userLanguage()),pxt.Util.assert(!!pxt.appTarget);var e,t=window.location.href;let i=!1,s=void 0;/[&?]translate=1/.test(t)&&!pxt.BrowserUtils.isIE()?(s=ts.pxtc.Util.TRANSLATION_LOCALE,i=!0,pxt.Util.enableLiveLocalizationUpdates()):(e=/PXT_LANG=(.*?)(?:;|$)/.exec(document.cookie),t=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(t),s=t?t[3]:e&&e[1]||pxt.appTarget.appTheme.defaultLocale||navigator.userLanguage||navigator.language,e=pxt.appTarget.appTheme.defaultLocale,o=null==s?void 0:s.toLocaleLowerCase(),e=pxt.BrowserUtils.isLocalHostDev()&&(!o||(e?e.toLocaleLowerCase()===o:"en"===o||"en-us"===o)),(!(pxt.BrowserUtils.isPxtElectron()||e||pxt.appTarget.appTheme.disableLiveTranslations)||null!=t&&t[1])&&pxt.Util.enableLiveLocalizationUpdates(),i=!!t&&!!t[2]);pxt.appTarget.versions;$&&$.fn&&$.fn.embed&&$.fn.embed.settings&&$.fn.embed.settings.sources&&$.fn.embed.settings.sources.youtube&&($.fn.embed.settings.sources.youtube.url="//www.youtube.com/embed/{id}?rel=0");var o=pxt.webConfig;return pxt.Util.updateLocalizationAsync({targetId:pxt.appTarget.id,baseUrl:o.commitCdnUrl,code:s,force:i}).then(()=>n())}function n(){d.mainPkg=new pxt.MainPackage(new P)}function h(e){pxt.error(e)}pxt.react.getTilemapProject||(pxt.react.getTilemapProject=()=>(g||(g=new pxt.TilemapProject).loadPackage(d.mainPkg),g)),d.initHost=n,d.initFooter=function(e,t){if(e){var i=pxt.appTarget.appTheme,s=$("body");let t=$(e);e=$("<a/>").attr("href",i.homeUrl).attr("target","_blank");t.append(e),i.organizationLogo?e.append($("<img/>").attr("src",pxt.Util.toDataUri(i.organizationLogo))):e.append(lf("powered by {0}",i.title)),s.mouseenter(e=>t.fadeOut()),s.mouseleave(e=>t.fadeIn())}},d.showError=h;let m=void 0;function _(e,i,t){var s=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj";let o,n,r;return m&&m._verspec==s?(d.mainPkg=m,o=d.mainPkg.host(),n=Promise.resolve(),r=Promise.resolve()):(o=d.mainPkg.host(),d.mainPkg=new pxt.MainPackage(o),d.mainPkg._verspec=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj",n=o.downloadPackageAsync(d.mainPkg,t),r=d.mainPkg.installAllAsync(),m=d.mainPkg),n.then(()=>o.readFile(d.mainPkg,pxt.CONFIG_NAME)).then(e=>e?r.then(()=>{var e,t;i&&((e=c(d.mainPkg)).files[pxt.MAIN_TS]=i,(t=JSON.parse(e.files[pxt.CONFIG_NAME])).name=window.location.href.split("/").pop().split(/[?#]/)[0],e.files[pxt.CONFIG_NAME]=pxt.Package.stringifyConfig(t),d.mainPkg.config.name=t.name,-1==d.mainPkg.config.files.indexOf(pxt.MAIN_BLOCKS))&&d.mainPkg.config.files.push(pxt.MAIN_BLOCKS)}).catch(e=>{h(lf("Cannot load extension: {0}",e.message))}):Promise.resolve())}function b(e){var t=d.mainPkg.getTargetOptions();return t.isNative=!!e,t.hasHex=!!e,d.mainPkg.getCompileOptionsAsync(t)}function f(e,t){return b(e).then(e=>{t&&t(e);e=pxtc.compile(e);return e.diagnostics&&0<e.diagnostics.length&&e.diagnostics.forEach(e=>{pxt.error(e.messageText)}),e})}d.generateHexFileAsync=function(t){return _(t.id).then(()=>f(!0,e=>{t.code&&(e.fileSystem[pxt.MAIN_TS]=t.code)})).then(e=>(e.diagnostics&&0<e.diagnostics.length&&pxt.error("Diagnostics",e.diagnostics),e.outfiles[pxtc.BINARY_HEX]))},d.generateVMFileAsync=function(t){return pxt.setHwVariant("vm"),_(t.id).then(()=>f(!0,e=>{t.code&&(e.fileSystem[pxt.MAIN_TS]=t.code)})).then(e=>(pxt.log(e),e))},d.simulateAsync=async function(e,r){var t=r.builtJsInfo||await v(r)||await y(r);let l=t.js;if(l){let n=i(e,r,t);return T.options.messageSimulators=null==(e=null==(e=pxt.appTarget)?void 0:e.simulator)?void 0:e.messageSimulators,T.options.onSimulatorCommand=e=>{if("restart"===e.command)n.storedState=k(r.id),T.run(l,n);else if("setstate"===e.command){if(e.stateKey){var t=r.id,i=e.stateKey,s=e.stateValue,o=k(t);if(t){null!=s?o[i]=s:delete o[i];try{window.localStorage.setItem(t,JSON.stringify(o))}catch(e){}}}}else"single"===e.command&&T.setSingleSimulator()},t.breakpoints&&r.debug&&T.setBreakpoints(t.breakpoints),T.run(l,n),t}pxt.error("Program failed to compile")};let T,E;function i(e,t,i){T&&t.embedId&&E===t.embedId?T.container=e:(T=new pxsim.SimulatorDriver(e),E=t.embedId);var{fnArgs:e,parts:i,usedBuiltinParts:s}=i||{},o=pxt.appTarget.simulator.boardDefinition,n=k(t.id),s={debug:t.debug,mute:t.mute,boardDefinition:o,parts:i,builtinParts:s,fnArgs:e,cdnUrl:pxt.webConfig.commitCdnUrl,localizedStrings:pxt.Util.getLocalizedStrings(),partDefinitions:null==d.mainPkg?void 0:d.mainPkg.computePartDefinitions(i),highContrast:t.highContrast,storedState:n,light:t.light,single:t.single,hideSimButtons:t.hideSimButtons,autofocus:t.autofocus,queryParameters:t.additionalQueryParameters,mpRole:t.mpRole,theme:null==(o=d.mainPkg.config)?void 0:o.theme};return pxt.appTarget.simulator&&!t.fullScreen&&(s.aspectRatio=i.length&&pxt.appTarget.simulator.partsAspectRatio?pxt.appTarget.simulator.partsAspectRatio:pxt.appTarget.simulator.aspectRatio),window.parent&&s.aspectRatio&&s.aspectRatio!==pxt.appTarget.simulator.aspectRatio&&(n=null==(e=window.frameElement)?void 0:e.getAttribute("data-frameid"))&&window.parent.postMessage({type:"aspectratio",frameid:n,value:s.aspectRatio},"*"),T.setRunOptions(s),s}async function v(e){try{var t=Date.now(),i=await pxt.Cloud.downloadBuiltSimJsInfoAsync(e.id);return pxt.tickEvent("perfMeasurement",{durationMs:Date.now()-t,operation:"fetchSimJsInfo"}),i}catch(e){pxt.debug(e.toString())}}async function y(l){var e,t=Date.now();await _(l.id,l.code,l.dependencies);let a=!1,c=pxt.appTarget.versions.target,i=await f(!1,e=>{var t;if(e.computeUsedParts=!0,e.computeUsedSymbols=!0,l.debug&&(e.breakpoints=!0),l.assets){var i,s=JSON.parse(l.assets);for(i of Object.keys(s)){var o=s[i];e.fileSystem[i]=o,e.sourceFiles.indexOf(i)<0&&e.sourceFiles.push(i),/\.jres$/.test(i)&&(o=JSON.parse(o),e.jres=pxt.inflateJRes(o,e.jres))}}l.code&&(e.fileSystem[pxt.MAIN_TS]=l.code),e.target.preferredEditor===pxt.PYTHON_PROJECT_NAME&&(e.target.preferredEditor=pxt.JAVASCRIPT_PROJECT_NAME,e.ast=!0,t=N(pxtc.compile(e).ast,e),e.apisInfo=t,e.target.preferredEditor=pxt.PYTHON_PROJECT_NAME);var n=null==(t=d.mainPkg.config.targetVersions)?void 0:t.target;if(n&&c&&pxt.semver.cmp(pxt.semver.parse(n),pxt.semver.parse(c))<0)for(var r of Object.keys(e.fileSystem))!pxt.Util.startsWith(r,"pxt_modules")&&pxt.Util.endsWith(r,".ts")&&(a=!0,e.fileSystem[r]=pxt.patching.patchJavaScript(n,e.fileSystem[r]))});0<(null==(s=i.diagnostics)?void 0:s.length)&&a&&(pxt.log("Compile with upgrade rules failed, trying again with original code"),i=await f(!1,e=>{l.code&&(e.fileSystem[pxt.MAIN_TS]=l.code)})),i.diagnostics&&0<i.diagnostics.length&&pxt.error("Diagnostics",i.diagnostics);var s=pxtc.buildSimJsInfo(i);let o=(null==(e=null==(e=pxt.appTarget.simulator)?void 0:e.boardDefinition)?void 0:e.onboardComponents)||[];return s.allParts=i.usedParts||[],s.usedBuiltinParts=i.usedParts.filter(e=>-1!==o.indexOf(e)),s.parts=i.usedParts.filter(e=>-1===o.indexOf(e)),pxt.tickEvent("perfMeasurement",{durationMs:Date.now()-t,operation:"buildSimJsInfo"}),s}function k(e){let t={};try{var i=window.localStorage.getItem(e);i&&(t=JSON.parse(i))}catch(e){}return t}var I;function C(e,t){return d.editorLanguageMode=e,t!=pxt.Util.localeInfo()?((e=/^live-/).test(t)&&pxt.Util.enableLiveLocalizationUpdates(),pxt.Util.updateLocalizationAsync({targetId:pxt.appTarget.id,baseUrl:pxt.webConfig.commitCdnUrl,code:t.replace(e,"")})):Promise.resolve()}function U(e){var t=e.data;if(t)switch(t.type){case"fileloaded":var i=t,s=i.name;let e=I.Blocks;/\.ts$/i.test(s)?e=I.TypeScript:/\.py$/i.test(s)&&(e=I.Python),C(e,i.locale);break;case"popout":var o,s=/((\/v[0-9+])\/)?[^\/]*#(doc|md):([^&?:]+)/i.exec(window.location.href);s&&(i=pxt.webConfig.docsUrl||"/--docs",o=s[2]||"",i="doc"==s[3]?pxt.webConfig.isStatic?`/docs${s[4]}.html`:""+s[4]:i+"?md="+s[4],window.parent)&&window.parent.postMessage({type:"opendoc",url:pxt.BrowserUtils.urlJoin(o,i)},"*");break;case"localtoken":t&&t.localToken&&(pxt.Cloud.localToken=t.localToken,M.forEach(e=>e()),M=[])}}function S(t,i){return pxt.Cloud.privateGetTextAsync(i+"/text").then(e=>JSON.parse(e)).then(e=>w(t,e,i))}function w(e,t,i=null,s=!1){let o=JSON.parse(t[pxt.CONFIG_NAME])||{},n=`# ${o.name} ${o.version||""}

`,r="README.md";t[r]&&(n+=t[r].replace(/^#+/,"$0#")+"\n"),o.files.filter(e=>e!=pxt.CONFIG_NAME&&e!=r).filter(e=>{var t=e;switch(d.editorLanguageMode){case I.Blocks:return/\.blocks?$/.test(t);case I.TypeScript:return/\.ts?$/.test(t);case I.Python:return/\.py?$/.test(t)}}).forEach(e=>{/^main\.(ts|blocks)$/.test(e)||(n+=`
## ${e}
`),/\.ts$/.test(e)?n+=`\`\`\`typescript
${t[e]}
\`\`\`
`:/\.blocks?$/.test(e)?n+=`\`\`\`blocksxml
${t[e]}
\`\`\`
`:n+=`\`\`\`${e.substr(e.indexOf("."))}
${t[e]}
\`\`\`
`});var l=o&&o.dependencies&&Object.keys(o.dependencies).filter(e=>e!=pxt.appTarget.corepkg);if(l&&l.length&&(n+=`
## ${lf("Extensions")} #extensions

${l.map(e=>`* ${e}, `+o.dependencies[e]).join("\n")}

\`\`\`package
${l.map(e=>e+"="+o.dependencies[e]).join("\n")}
\`\`\`
`),i){let e=(pxt.appTarget.appTheme.shareUrl||"https://makecode.com/")+i;s&&(e="`"+e+"`"),n+=`
${e}

`}pxt.debug("print md: "+n);return A(e,n,{print:!0})}d.preloadSim=function(e,t){i(e,t),T.preload((null==(t=null==(e=pxt.appTarget)?void 0:e.simulator)?void 0:t.aspectRatio)||1,!0)},d.currentDriver=function(){return T},d.postSimMessage=function(e){null!=T&&T.postMessage(e)},d.fetchSimJsInfo=v,d.buildSimJsInfo=y,(e=I=d.LanguageMode||(d.LanguageMode={}))[e.Blocks=0]="Blocks",e[e.TypeScript=1]="TypeScript",e[e.Python=2]="Python",d.editorLanguageMode=I.Blocks,d.setEditorContextAsync=C,d.startRenderServer=function(){pxt.tickEvent("renderer.ready");let t=[],i=void 0;(0,l.initEditorExtensionsAsync)().then(()=>{window.addEventListener("message",function(e){e=e.data;"renderblocks"==e.type&&(t.push(e),function e(){if(!i){let r=t.shift();if(r){let o=r.options||{},n=(o.splitSvg=!1,pxt.tickEvent("renderer.job"),/^\s*<xml/.test(r.code));i=(async()=>{var e=(i=(n?await L(r.code,o):await O(r.code,r.options)).blocksSvg).viewBox.baseVal.width,t=i.viewBox.baseVal.height,i=i?await(0,p.blocklyToSvgAsync)(i,0,0,e,t):void 0;let s;try{s=i?await pxt.BrowserUtils.encodeToPngAsync(i.xml,{width:e,height:t}):void 0}catch(e){pxt.warn(e)}window.parent.postMessage({source:"makecode",type:"renderblocks",id:r.id,width:null==i?void 0:i.width,height:null==i?void 0:i.height,svg:null==i?void 0:i.svg,uri:s||(null==i?void 0:i.xml),css:null==i?void 0:i.css},"*")})().catch(e=>{window.parent.postMessage({source:"makecode",type:"renderblocks",id:r.id,error:e.message},"*")}).finally(()=>{i=void 0,e()})}}}())},!1),window.parent.postMessage({source:"makecode",type:"renderready",versions:pxt.appTarget.versions},"*")})},d.startDocsServer=function(e,n,s){pxt.tickEvent("docrenderer.ready");let i=[];function r(i,o){pxt.debug("rendering "+i),s&&$(s).hide(),$(n).hide(),$(e).show(),pxt.U.delay(100).then(()=>{switch(i){case"print":var e=window.localStorage.printjob;return delete window.localStorage.printjob,w(n,JSON.parse(e),void 0,!0).then(()=>pxsim.print(1e3));case"project":return w(n,JSON.parse(o)).then(()=>pxsim.print(1e3));case"projectid":return S(n,JSON.parse(o)).then(()=>pxsim.print(1e3));case"doc":return(async(e,t)=>{t=t.replace(/^\//,"");var i=await pxt.Cloud.markdownAsync(t,void 0,!0);try{await A(e,i,{path:t})}catch(e){pxt.warn(e)}})(n,o);case"book":{var s=n;var t=o;t=t.replace(/^\//,""),pxt.tickEvent("book",{id:t}),pxt.log("rendering book from "+t),$("#loading").find(".loader").addClass("text").text(lf("Compiling your book (this may take a minute)"));let i;return pxt.U.delay(100).then(()=>pxt.Cloud.markdownAsync(t,void 0,!0)).then(e=>{i=pxt.docs.buildTOC(e),pxt.log("TOC: "+JSON.stringify(i,null,2));let t=[];return pxt.docs.visitTOC(i,e=>{/^\//.test(e.path)&&!/^\/pkg\//.test(e.path)&&t.push(e)}),pxt.U.promisePoolAsync(4,t,async t=>{try{var e=await pxt.Cloud.markdownAsync(t.path,void 0,!0);t.markdown=e}catch(e){t.markdown=`_${t.path} failed to load._`}})}).then(e=>{let t=i[0].name;return pxt.docs.visitTOC(i,e=>{e.markdown&&(t+="\n\n"+e.markdown)}),A(s,t)});return}default:return A(n,o)}}).catch(e=>{$(n).html(`
                <img style="height:4em;" src="${pxt.appTarget.appTheme.docsLogo}" />
                <h1>${lf("Oops")}</h1>
                <h3>${lf("We could not load the documentation, please check your internet connection.")}</h3>
                <button class="ui button primary" id="tryagain">${lf("Try Again")}</button>`),$(n).find("#tryagain").click(()=>{r(i,o)}),window.parent&&window.parent.postMessage({type:"docfailed",docType:i,src:o},"*")}).finally(()=>{$(e).hide(),s&&$(s).show(),$(n).show()}).then(()=>{})}function o(e,t){t?(pxsim.U.addClass(e,"disabled"),e.setAttribute("aria-disabled","true")):(pxsim.U.removeClass(e,"disabled"),e.setAttribute("aria-disabled","false"))}async function t(){var t=/^#(doc|md|tutorial|book|project|projectid|print):([^&?:]+)(:([^&?:]+):([^&?:]+))?/i.exec(window.location.hash);if(t){if(s&&(i.push(window.location.hash),10<i.length&&i.shift(),1<i.length)&&o(s,!1),t[4]){let e=I.TypeScript;/^blocks$/i.test(t[4])?e=I.Blocks:/^python$/i.test(t[4])&&(e=I.Python),await C(e,t[5])}r(t[1],decodeURIComponent(t[2]))}}s&&(s.addEventListener("click",()=>{s&&(1<i.length&&(i.pop(),window.location.hash=i.pop()),i.length<=1)&&o(s,!0)}),s.addEventListener("keydown",a.fireClickOnEnter),o(s,!0)),(0,l.initEditorExtensionsAsync)().then(()=>{window.addEventListener("message",U,!1),window.addEventListener("hashchange",()=>{t()},!1),parent.postMessage({type:"sidedocready"},"*"),setTimeout(()=>t(),1)})},d.renderProjectAsync=S,d.renderProjectFilesAsync=w;let H=`
<aside id=button class=box>
<a class="ui primary button" href="@ARGS@">@BODY@</a>
</aside>

<aside id=vimeo>
<div class="ui two column stackable grid container">
<div class="column">
<div class="ui embed mdvid" data-source="vimeo" data-id="@ARGS@" data-placeholder="/thumbnail/1024/vimeo/@ARGS@" data-icon="video play">
</div>
</div></div>
</aside>

<aside id=youtube>
<div class="ui two column stackable grid container">
<div class="column">
<div class="ui embed mdvid" data-source="youtube" data-id="@ARGS@" data-placeholder="https://img.youtube.com/vi/@ARGS@/0.jpg">
</div>
</div></div>
</aside>

<aside id=section>
<!-- section @ARGS@ -->
</aside>

<aside id=hide class=box>
<div style='display:none'>
    @BODY@
</div>
</aside>

<aside id=avatar class=box>
<div class='avatar @ARGS@'>
    <div class='avatar-image'></div>
    <div class='ui compact message'>
        @BODY@
    </div>
</div>
</aside>

<aside id=hint class=box>
<div class="ui info message">
    <div class="content">
        @BODY@
    </div>
</div>
</aside>

<aside id=codecard class=box>
<pre><code class="lang-codecard">@BODY@</code></pre>
</aside>

<aside id=tutorialhint class=box>
<div class="ui hint message">
    <div class="content">
        @BODY@
    </div>
</div>
</aside>

<aside id=reminder class=box>
<div class="ui warning message">
    <div class="content">
        @BODY@
    </div>
</div>
</aside>

<aside id=alert class=box>
<div class="ui negative message">
    <div class="content">
        @BODY@
    </div>
</div>
</aside>

<aside id=tip class=box>
<div class="ui positive message">
    <div class="content">
        @BODY@
    </div>
</div>
</aside>

<!-- wrapped around ordinary content -->
<aside id=main-container class=box>
<div class="ui text">
    @BODY@
</div>
</aside>

<!-- used for 'column' box - they are collected and wrapped in 'column-container' -->
<aside id=column class=aside>
<div class='column'>
    @BODY@
</div>
</aside>
<aside id=column-container class=box>
<div class="ui three column stackable grid text">
    @BODY@
</div>
</aside>
@breadcrumb@
@body@`;function A(e,t,i={}){var t=pxt.docs.renderMarkdown({template:H,markdown:t,theme:pxt.appTarget.appTheme}),s=i.blocksAspectRatio||window.innerHeight<window.innerWidth?1.62:1/1.62,t=($(e).html(t),$(e).find("a").attr("target","_blank"),(0,a.defaultClientRenderOptions)());return t.tutorial=!!i.tutorial,t.blocksAspectRatio=s||t.blocksAspectRatio,t.showJavaScript=d.editorLanguageMode==I.TypeScript,i.print&&(t.showEdit=!1,t.simulator=!1),(0,a.renderAsync)(t).then(()=>{$(e).find('a[href^="/"]').removeAttr("target").each((e,t)=>{$(t).attr("href","#doc:"+$(t).attr("href").replace(/^\//,""))}),$(e).find(".ui.embed").embed()})}d.renderMarkdownAsync=A;let x,R;function O(i,a){let{assets:c,forceCompilation:s,snippetMode:u,generateSourceMap:h}=a||{};return _(a&&a.packageId?"pub:"+a.packageId:a&&a.package?"docs:"+a.package:null,i).then(()=>b(!!pxt.appTarget.compile&&pxt.appTarget.compile.hasHex)).then(e=>{if(i&&(e.fileSystem[pxt.MAIN_TS]=i),e.ast=!0,c)for(var t of Object.keys(c))e.sourceFiles.indexOf(t)<0&&e.sourceFiles.push(t),e.fileSystem[t]=c[t];let o=void 0,n,r=(n=s?(o=pxtc.compile(e))&&o.ast:pxtc.getTSProgram(e,x),x=n,void 0),l=(pxt.appTarget.appTheme.python&&(r=ts.pxtc.transpile.tsToPy(n,pxt.MAIN_TS)),N(n,e));return ts.pxtc.localizeApisAsync(l,d.mainPkg).then(()=>{var e=pxtc.getBlocksInfo(l),t=((0,p.initializeAndInject)(e),null==c?void 0:c[pxt.TILEMAP_JRES]),i=null==c?void 0:c[pxt.IMAGES_JRES],e=((t||i)&&((g=new pxt.TilemapProject).loadPackage(d.mainPkg),t&&g.loadTilemapJRes(JSON.parse(t),!0),i)&&g.loadAssetsJRes(JSON.parse(i)),pxtc.decompiler.decompileToBlocks(e,n.getSourceFile(pxt.MAIN_TS),{snippetMode:u,generateSourceMap:h}));if(e.diagnostics&&0<e.diagnostics.length&&e.diagnostics.forEach(e=>pxt.error(e.messageText)),!e.success)return{package:d.mainPkg,compileProgram:n,compileJS:o,compileBlocks:e,apiInfo:l};pxt.debug(e.outfiles[pxt.MAIN_BLOCKS]);var s=(0,p.render)(e.outfiles[pxt.MAIN_BLOCKS],a);return(t||i)&&(g=null),{package:d.mainPkg,compileProgram:n,compileJS:o,compileBlocks:e,compilePython:r,apiInfo:l,blocksSvg:s}})})}function N(e,t){R=R||{};var i=Object.keys(t.fileSystem).sort().join(";");return R[i]||(R[i]=pxtc.getApiInfo(e,t.jres)),R[i]}function L(o,n){let r=(n||{}).assets;return _(n&&n.packageId?"pub:"+n.packageId:n&&n.package?"docs:"+n.package:null,"").then(()=>b(!!pxt.appTarget.compile&&pxt.appTarget.compile.hasHex)).then(e=>{if(e.ast=!0,r)for(var t of Object.keys(r))e.sourceFiles.indexOf(t)<0&&e.sourceFiles.push(t),e.fileSystem[t]=r[t];let s=N(pxtc.compile(e).ast,e);return ts.pxtc.localizeApisAsync(s,d.mainPkg).then(()=>{var e=pxtc.getBlocksInfo(s),e=((0,p.initializeAndInject)(e),null==r?void 0:r[pxt.TILEMAP_JRES]),t=null==r?void 0:r[pxt.IMAGES_JRES],i=((e||t)&&((g=new pxt.TilemapProject).loadPackage(d.mainPkg),e&&g.loadTilemapJRes(JSON.parse(e),!0),t)&&g.loadAssetsJRes(JSON.parse(t)),(0,p.render)(o,n));return(e||t)&&(g=null),{package:d.mainPkg,blocksSvg:i,apiInfo:s}})})}d.decompileSnippetAsync=O,d.compileBlocksAsync=L;let M=[];let D=[];d.setInitCallbacks=function(e){D=e},d.init=function(){F().then(()=>{for(let e=0;e<D.length;++e)D[e]()})}},{"../pxtblocks":74,"../pxteditor/editor":151,"./renderer":166,blockly:175}],168:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.IFrameEmbeddedClient=void 0;class s{constructor(e){this.messageHandler=e,this.onMessageReceived=e=>{var t=e.data;if(t){if("iframeclientsetmessageport"===t.type)return this.port=e.ports[0],this.port.onmessage=this.onMessageReceived,void this.postMessage({type:"iframeclientsetmessageport"});if("iframeclientready"===t.type)return void this.sendReadyMessage()}this.messageHandler(e)},this.frameId=(()=>{var e=/frameid=([a-zA-Z0-9\-]+)/i.exec(window.location.href);if(e)return e[1]})(),window.addEventListener("message",this.onMessageReceived),this.sendReadyMessage()}dispose(){window.removeEventListener("message",this.onMessageReceived),this.port&&this.port.close()}postMessage(e){this.postMessageCore(e)}postMessageCore(e){this.frameId&&(e.frameId=this.frameId),this.port?this.port.postMessage(e):window.acquireVsCodeApi?window.acquireVsCodeApi().postMessage(e):window.parent&&window.parent!==window&&window.parent.postMessage(e,"*")}sendReadyMessage(){this.postMessage({type:"iframeclientready"})}}i.IFrameEmbeddedClient=s},{}],169:[function(e,t,i){var s=this,o=t=>{{var i={370:e=>{e.exports=t}},s={};function o(e){var t=s[e];return void 0!==t||(t=s[e]={exports:{}},i[e](t,t.exports,o)),t.exports}o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var e={},l=((o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(e),o.d(e,{FieldGridDropdown:()=>r}),o(370));class a{constructor(e,t,i,s){this.value=i,this.selected=!1,this.selectionCallback=s,this.element=document.createElement("button"),this.element.id=l.utils.idGenerator.getNextUniqueId(),this.element.className="blocklyFieldGridItem",this.clickHandler=l.browserEvents.conditionalBind(this.element,"click",this,this.onClick,!0),e.appendChild(this.element);i="string"==typeof t?document.createTextNode(t):t;this.element.appendChild(i),l.utils.aria.setRole(this.element,l.utils.aria.Role.GRIDCELL)}dispose(){this.selectionCallback=null,this.element.remove(),this.clickHandler&&(l.browserEvents.unbind(this.clickHandler),this.clickHandler=null)}getId(){return this.element.id}getValue(){return this.value}isSelected(){return this.selected}setSelected(e){this.selected=e,l.utils.aria.setState(this.element,l.utils.aria.State.SELECTED,this.selected),this.element.classList.toggle("blocklyFieldGridItemSelected",this.selected),this.isSelected()&&this.focus()}onClick(){var e;this.setSelected(!0),null!=(e=this.selectionCallback)&&e.call(this,this)}focus(){this.element.focus({preventScroll:!0});var e,t,i,s=this.element.offsetParent;s&&(e=this.element.offsetTop,t=s.scrollTop,i=this.getInterItemSpacing(),e<t?s.scrollTo(0,e-i):e+this.element.offsetHeight>t+s.clientHeight&&s.scrollBy(0,e+this.element.clientHeight-(t+s.clientHeight)+i))}getInterItemSpacing(){let e=this.element.closest(".blocklyFieldGrid");if(e){var t=[...e.querySelectorAll(".blocklyFieldGridItem")];if(t.length){var i=t[0].offsetTop,s=t[0].offsetHeight;for(let e of t)if(e.offsetTop!==i)return e.offsetTop-s-i}}return 0}}class n{constructor(e,t,i,s,o){if(this.columns=i,this.rtl=s,this.itemIndices=new Map,this.items=new Array,this.keyDownHandler=null,this.pointerMoveHandler=null,this.selectionCallback=o,this.root=document.createElement("div"),this.root.className="blocklyFieldGrid",this.root.tabIndex=0,l.utils.aria.setRole(this.root,l.utils.aria.Role.GRID),e.appendChild(this.root),this.populateItems(t),this.keyDownHandler=l.browserEvents.conditionalBind(this.root,"keydown",this,this.onKeyDown),this.pointerMoveHandler=l.browserEvents.conditionalBind(this.root,"pointermove",this,this.onPointerMove,!0),!(1<=i))throw new Error("Number of columns must be >= 1; got "+i);this.columns=i,this.root.style.setProperty("--grid-columns",""+this.columns)}populateItems(e){let o=document.createElement("div");for(var[n,r]of e.entries())if(r!==l.FieldDropdown.SEPARATOR){n%this.columns==0&&((o=document.createElement("div")).className="blocklyFieldGridRow",l.utils.aria.setRole(o,l.utils.aria.Role.ROW),this.root.appendChild(o));let[t,e]=r,i=(()=>{if((e=t)&&"object"==typeof e&&"src"in e&&"string"==typeof e.src&&"alt"in e&&"string"==typeof e.alt&&"width"in e&&"number"==typeof e.width&&"height"in e&&"number"==typeof e.height){let e=new Image(t.width,t.height);return e.src=t.src,e.alt=t.alt||"",e}var e;return t})(),s=new a(o,i,e,e=>{var t;this.setSelectedValue(e.getValue()),null!=(t=this.selectionCallback)&&t.call(this,e)});this.itemIndices.set(s.getId(),this.itemIndices.size),this.items.push(s)}}dispose(){this.selectionCallback=void 0;for(var e of this.items)e.dispose();this.itemIndices.clear(),this.items.length=0,this.keyDownHandler&&(l.browserEvents.unbind(this.keyDownHandler),this.keyDownHandler=null),this.pointerMoveHandler&&(l.browserEvents.unbind(this.pointerMoveHandler),this.pointerMoveHandler=null),this.root.remove()}onKeyDown(e){if(!(!this.items.length||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){switch(e.key){case"ArrowUp":this.moveFocus(-1*this.columns,!0);break;case"ArrowDown":this.moveFocus(this.columns,!0);break;case"ArrowLeft":this.moveFocus(-1*(this.rtl?-1:1),!0);break;case"ArrowRight":this.moveFocus(this.rtl?-1:1,!0);break;case"PageUp":case"Home":this.moveFocus(0,!1);break;case"PageDown":case"End":this.moveFocus(this.items.length-1,!1);break;case"Enter":case"Space":return void e.stopPropagation();default:return}e.preventDefault(),e.stopPropagation()}}onPointerMove(e){(e.movementX||e.movementY)&&e.target instanceof Element&&(e=e.target.closest(".blocklyFieldGridItem"))&&(e=e.id,void 0!==(e=this.itemIndices.get(e)))&&this.moveFocus(e,!1)}setSelectedValue(e){for(var[t,i]of this.items.entries()){var s=i.getValue()===e;i.setSelected(s),s&&this.moveFocus(t,!1)}}moveFocus(e,t){let i=e;if(t){let e=this.getFocusedItem();if(!e)return;i+=this.indexOfItem(e)}e=this.itemAtIndex(i);e&&(e.focus(),l.utils.aria.setState(this.root,l.utils.aria.State.ACTIVEDESCENDANT,e.getId()))}indexOfItem(e){return null!=(e=this.itemIndices.get(e.getId()))?e:-1}itemAtIndex(e){return this.items[e]}getFocusedItem(){var e=null!=(e=this.root.querySelector(".blocklyFieldGridItem:focus"))?e:this.root.querySelector(".blocklyFieldGridItem");return e&&e.id&&void 0!==(e=this.itemIndices.get(e.id))?this.itemAtIndex(e):void 0}}class r extends l.FieldDropdown{constructor(e,t,i){super(e,t,i),this.columns=3,null!=i&&i.columns&&this.setColumns(parseInt(""+i.columns)),i&&i.primaryColour&&(this.primaryColour=i.primaryColour),i&&i.borderColour&&(this.borderColour=i.borderColour)}static fromJson(e){if(e.options)return new this(e.options,void 0,e);throw new Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.")}setColumns(e){!isNaN(e)&&1<=e&&(this.columns=e,l.DropDownDiv.getOwner()===this)&&l.DropDownDiv.isVisible()&&(null!=(e=this.grid)&&e.dispose(),this.showEditor_())}showEditor_(e){l.DropDownDiv.clearContent();var t=!(null==(t=this.getSourceBlock())||!t.workspace.RTL),t=(this.grid=new n(l.DropDownDiv.getContentDiv(),this.getOptions(!1),this.columns,t,e=>{l.DropDownDiv.hideIfOwner(this),this.setValue(e.getValue())}),l.DropDownDiv.getContentDiv().classList.add("blocklyFieldGridContainer"),this.getColours()),t=(t&&t.border&&l.DropDownDiv.setColour(t.primary,t.border),l.DropDownDiv.showPositionedByField(this,this.dropdownDispose_.bind(this)),this.getValue());t&&this.grid.setSelectedValue(t)}doValueUpdate_(e){var t;super.doValueUpdate_(e),null!=(t=this.grid)&&t.setSelectedValue(e)}getColours(){var e,t;return this.primaryColour&&this.borderColour?{primary:this.primaryColour,border:this.borderColour}:(t=this.getSourceBlock())instanceof l.BlockSvg&&(t=t.isShadow()?t.getParent():t)?{primary:null!=(e=this.primaryColour)?e:t.getColour(),border:null!=(e=this.borderColour)?e:t.getColourTertiary()}:void 0}}return l.fieldRegistry.register("field_grid_dropdown",r),l.Css.register("\n   .blocklyFieldGridContainer {\n     padding: 7px;\n     overflow: auto;\n   }\n   \n  .blocklyFieldGrid {\n    display: grid;\n    grid-gap: 7px;\n    grid-template-columns: repeat(var(--grid-columns), min-content);\n  }\n\n .blocklyFieldGrid .blocklyFieldGridItem {\n   border: 1px solid rgba(1, 1, 1, 0.5);\n   border-radius: 4px;\n   color: white;\n   min-width: auto;\n   background: none;\n   white-space: nowrap;\n   cursor: pointer;\n   padding: 6px 15px;\n }\n \n .blocklyFieldGrid .blocklyFieldGridRow {\n   display: contents;\n }\n \n .blocklyFieldGrid .blocklyFieldGridItem.blocklyFieldGridItemSelected {\n   background-color: rgba(1, 1, 1, 0.25);\n }\n\n .blocklyFieldGrid .blocklyFieldGridItem:focus {\n   box-shadow: 0 0 0 4px hsla(0, 0%, 100%, .2);\n   outline: none;\n }\n "),e}};if("object"==typeof i&&"object"==typeof t)t.exports=o(e("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],o);else{var n,r=o("object"==typeof i?e("blockly/core"):s.Blockly);for(n in r)("object"==typeof i?i:s)[n]=r[n]}},{"blockly/core":174}],170:[function(e,t,i){var s=this,o=t=>{{var i={370:e=>{e.exports=t}},s={};function o(e){var t=s[e];return void 0!==t||(t=s[e]={exports:{}},i[e](t,t.exports,o)),t.exports}o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={},r=((o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})})(n),o.d(n,{WorkspaceSearch:()=>l}),o(370));let e=(()=>{let i=!1;return function(){var e,t;i||(i=!0,(e=document.createElement("style")).id="blockly-ws-search-style",t=document.createTextNode("path.blocklyPath.blockly-ws-search-highlight {\n    fill: #000;\n  }\n  path.blocklyPath.blockly-ws-search-highlight.blockly-ws-search-current {\n    fill: grey;\n  }\n  .blockly-ws-search-close-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyeiIvPjxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=) no-repeat top left;\n  }\n  .blockly-ws-search-next-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSA4LjU5TDEyIDEzLjE3bDQuNTktNC41OEwxOCAxMGwtNiA2LTYtNiAxLjQxLTEuNDF6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PC9zdmc+) no-repeat top left;\n  }\n  .blockly-ws-search-previous-btn {\n    background: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjE0Ij48cGF0aCBkPSJNNy40MSAxNS40MUwxMiAxMC44M2w0LjU5IDQuNThMMTggMTRsLTYtNi02IDZ6Ii8+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==) no-repeat top left;\n  }\n  .blockly-ws-search {\n    background: #fff;\n    border: solid lightgrey 0.5px;\n    box-shadow: 0px 10px 20px grey;\n    justify-content: center;\n    padding: 0.25em;\n    position: absolute;\n    z-index: 70;\n  }\n  .blockly-ws-search-input input {\n    border: none;\n  }\n  .blockly-ws-search button {\n    border: none;\n    padding-left: 6px;\n    padding-right: 6px;\n  }\n  .blockly-ws-search-actions {\n    display: flex;\n  }\n  .blockly-ws-search-container {\n    display: flex;\n  }\n  .blockly-ws-search-content {\n    display: flex;\n  }"),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild))}})();class l{constructor(e){this.workspace=e,this.id="workspaceSearch",this.htmlDiv=null,this.actionDiv=null,this.inputElement=null,this.textInputPlaceholder="Search",this.blocks=[],this.lastHighlighted=null,this.currentBlockIndex=-1,this.searchText="",this.searchOnInput=!0,this.caseSensitive=!1,this.preserveSelected=!0,this.boundEvents=[]}init(){this.workspace.getComponentManager().addComponent({component:this,weight:0,capabilities:[r.ComponentManager.Capability.POSITIONABLE]}),e(),this.createDom(),this.setVisible(!1),this.workspace.resize()}dispose(){for(var e of this.boundEvents)r.browserEvents.unbind(e);this.boundEvents.length=0,this.htmlDiv&&(this.htmlDiv.remove(),this.htmlDiv=null),this.actionDiv=null,this.inputElement=null}createDom(){var e=this.workspace.getInjectionDiv(),t=(this.addEvent(e,"keydown",this,e=>this.onWorkspaceKeyDown(e)),this.htmlDiv=document.createElement("div"),r.utils.dom.addClass(this.htmlDiv,"blockly-ws-search"),document.createElement("div")),i=(r.utils.dom.addClass(t,"blockly-ws-search-container"),document.createElement("div")),s=(r.utils.dom.addClass(i,"blockly-ws-search-content"),t.appendChild(i),document.createElement("div")),s=(r.utils.dom.addClass(s,"blockly-ws-search-input"),this.inputElement=this.createTextInput(),this.addEvent(this.inputElement,"keydown",this,e=>this.onKeyDown(e)),this.addEvent(this.inputElement,"input",this,()=>this.onInput()),this.addEvent(this.inputElement,"click",this,()=>{var e;this.searchAndHighlight(this.searchText,this.preserveSelected),null!=(e=this.inputElement)&&e.select()}),s.appendChild(this.inputElement),i.appendChild(s),this.actionDiv=document.createElement("div"),r.utils.dom.addClass(this.actionDiv,"blockly-ws-search-actions"),i.appendChild(this.actionDiv),this.createNextBtn()),i=(s&&this.addActionBtn(s,()=>this.next()),this.createPreviousBtn()),s=(i&&this.addActionBtn(i,()=>this.previous()),this.createCloseBtn());s&&(this.addBtnListener(s,()=>this.close()),t.appendChild(s)),this.htmlDiv.appendChild(t),e.insertBefore(this.htmlDiv,this.workspace.getParentSvg())}addEvent(e,t,i,s){e=r.browserEvents.conditionalBind(e,t,i,s);this.boundEvents.push(e)}addActionBtn(e,t){this.addBtnListener(e,t),null!=(t=this.actionDiv)&&t.appendChild(e)}createTextInput(){var e=document.createElement("input");return e.type="text",e.setAttribute("placeholder",this.textInputPlaceholder),e}createNextBtn(){return this.createBtn("blockly-ws-search-next-btn","Find next")}createPreviousBtn(){return this.createBtn("blockly-ws-search-previous-btn","Find previous")}createCloseBtn(){return this.createBtn("blockly-ws-search-close-btn","Close search bar")}createBtn(e,t){var i=document.createElement("button");return r.utils.dom.addClass(i,e),i.setAttribute("aria-label",t),i}addBtnListener(e,t){this.addEvent(e,"click",this,t),this.addEvent(e,"keydown",this,e=>{"Enter"===e.key?(t(e),e.preventDefault()):"Escape"===e.key&&this.close(),e.stopPropagation()})}getBoundingRectangle(){return null}position(e,t){this.htmlDiv&&(this.workspace.RTL?this.htmlDiv.style.left=e.absoluteMetrics.left+"px":e.toolboxMetrics.position===r.TOOLBOX_AT_RIGHT?this.htmlDiv.style.right=e.toolboxMetrics.width+"px":this.htmlDiv.style.right="0",this.htmlDiv.style.top=e.absoluteMetrics.top+"px")}onInput(){var e;this.searchOnInput&&this.inputElement&&(e=this.inputElement.value.trim())!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}onKeyDown(e){if("Escape"===e.key)this.close();else if("Enter"===e.key)if(this.searchOnInput)e.shiftKey?this.previous():this.next();else if(this.inputElement){let e=this.inputElement.value.trim();e!==this.searchText&&this.searchAndHighlight(e,this.preserveSelected)}}onWorkspaceKeyDown(e){(e.ctrlKey||e.metaKey)&&"f"===e.key&&(this.open(),e.preventDefault(),e.stopPropagation())}previous(){this.setCurrentBlock(this.currentBlockIndex-1)}next(){this.setCurrentBlock(this.currentBlockIndex+1)}setSearchPlaceholder(e){this.textInputPlaceholder=e,this.inputElement&&this.inputElement.setAttribute("placeholder",this.textInputPlaceholder)}setCurrentBlock(e){var t;this.blocks.length&&((t=this.blocks[this.currentBlockIndex])&&this.unhighlightCurrentSelection(t),this.currentBlockIndex=(e%this.blocks.length+this.blocks.length)%this.blocks.length,t=this.blocks[this.currentBlockIndex],this.highlightCurrentSelection(t),this.workspace.centerOnBlock(t.id,!1),this.lastHighlighted=t)}open(){var e;this.setVisible(!0),null!=(e=this.inputElement)&&e.focus(),null!=(e=this.inputElement)&&e.select(),this.searchText&&this.searchAndHighlight(this.searchText)}close(){this.setVisible(!1);var e=r.FocusManager.getFocusManager();this.lastHighlighted&&!this.lastHighlighted.isDisposed()?e.focusNode(this.lastHighlighted):e.focusTree(this.workspace),this.clearBlocks(),this.lastHighlighted=null}setVisible(e){this.htmlDiv&&(this.htmlDiv.style.display=e?"flex":"none")}searchAndHighlight(e,t){var i=this.blocks[this.currentBlockIndex];this.searchText=e.trim(),this.clearBlocks(),this.blocks=this.getMatchingBlocks(this.workspace,this.searchText,this.caseSensitive),this.highlightSearchGroup(this.blocks);let s=0;t&&(s=-1<(s=this.blocks.indexOf(i))?s:0),this.setCurrentBlock(s)}getSearchPool(e){return e.getAllBlocks(!0).filter(e=>{e=e.getSurroundParent();return!e||!e.isCollapsed()})}isBlockMatch(e,t,i){let s="";if(e.isCollapsed())s=e.toString();else{let t=[];e.inputList.forEach(e=>{e.fieldRow.forEach(e=>{t.push(e.getText())})}),s=t.join(" ").trim()}return-1<(s=i?s:s.toLowerCase()).indexOf(t)}getMatchingBlocks(e,t,i){return t?(this.caseSensitive||(t=t.toLowerCase()),this.getSearchPool(e).filter(e=>this.isBlockMatch(e,t,i))):[]}clearBlocks(){this.unhighlightSearchGroup(this.blocks);var e=this.blocks[this.currentBlockIndex];e&&this.unhighlightCurrentSelection(e),this.currentBlockIndex=-1,this.blocks=[]}highlightCurrentSelection(e){e=e.pathObject.svgPath;r.utils.dom.addClass(e,"blockly-ws-search-current")}unhighlightCurrentSelection(e){e=e.pathObject.svgPath;r.utils.dom.removeClass(e,"blockly-ws-search-current")}highlightSearchGroup(e){e.forEach(e=>{e=e.pathObject.svgPath;r.utils.dom.addClass(e,"blockly-ws-search-highlight")})}unhighlightSearchGroup(e){e.forEach(e=>{e=e.pathObject.svgPath;r.utils.dom.removeClass(e,"blockly-ws-search-highlight")})}}return n}};if("object"==typeof i&&"object"==typeof t)t.exports=o(e("blockly/core"));else if("function"==typeof define&&define.amd)define(["blockly/core"],o);else{var n,r=o("object"==typeof i?e("blockly/core"):s.Blockly);for(n in r)("object"==typeof i?i:s)[n]=r[n]}},{"blockly/core":174}],171:[function(e,i,s){!function(ig){!function(){var e,t;e=this,t=function(){var g,D,B,P,F,U,H,G,m,V,a,c,W,r,z,l,j,Y,X,K,J,q,Z,Q,ee,te,ie,se,oe,ne,re,le,ae,ce,ue,he,de,pe,ge,me,_e,be,fe,Te,Ee,ve,ye,ke,Ie,Ce,Se,we,Ae,xe,Re,Oe,Ne,$e,Le,Me,De,Be,Pe,Fe,Ue,He,Ge,Ve,We,ze,je,Ye,Xe,Ke,Je,qe,Ze,Qe,et,tt,it,st,ot,nt,rt,lt,at,ct,ut,ht,dt,pt,gt,mt,_t,bt,ft,Tt,Et,vt,yt,kt,It,Ct,St,wt,At,xt,Rt,Ot,Nt,$t,Lt,Mt,Dt,Bt,Pt,Ft,Ut,Ht,Gt,Vt,Wt,zt,jt,Yt,Xt,Kt,Jt,qt,Zt,Qt,ei,ti,ii,si,oi,ni,ri,li,ai,ci,ui,hi,di,pi,gi,mi,_i,bi,fi,Ti,Ei,vi,yi,ki,Ii,Ci,Si,wi,Ai,xi,Ri,Oi,Ni,$i,Li,Mi,Di,Bi,Pi,Fi,Ui,Hi,Gi,Vi,Wi,zi,ji,Yi,Xi,Ki,Ji,qi,Zi,Qi,es,ts,is,ss,os,ns,rs,ls,as,cs,us,hs,ds,ps,gs,ms,_s,bs,fs,Ts,Es,vs,ys,ks,Is,Cs,Ss,ws,As,xs,Rs,Os,Ns,$s,Ls,Ms,Ds,Bs,Ps,Fs,Us,Hs,Gs,Vs,Ws,zs,js,Ys,Xs,Ks,Js,qs,Zs,Qs,eo,to,io,so,oo,no,ro,lo,u,ao,co,uo,ho,po,h,go,mo,_o,bo,fo,To,Eo,vo,yo,ko,Io,Co,So,wo,Ao,xo,Ro,Oo,No,$o,Lo,Mo,Do,Bo,Po,Fo,Uo,Ho,Go,Vo,Wo,zo,jo,Yo,Xo,Ko,Jo,qo,Zo,Qo,en,tn,sn,on,nn,rn,ln,an,cn,un,hn,dn,pn,gn,mn,_n,bn,fn,Tn,En,vn,yn,kn,In,Cn,Sn,wn,An,xn,Rn,On,Nn,$n,Ln,Mn,Dn,Bn,Pn,Fn,Un,Hn,Gn,Vn,Wn,zn,jn,Yn,Xn,Kn,Jn,qn,Zn,Qn,er,tr,ir,sr,or,nr,rr,lr,d,_={},o=function(e,t,i,s){if(!(e instanceof b)&&"string"!=typeof e||""===(""+e).trim())throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=(""+e).toLowerCase(),"string"!=typeof t||""===t.trim())throw Error('Invalid name "'+t+'". The name must be a non-empty string.');var o=t.toLowerCase();if(!i)throw Error("Can not register a null value");let n=Br[e],r=Fr[e];if(n||(n=Br[e]=Object.create(null),r=Fr[e]=Object.create(null)),ar(e,i),!s&&n[o]&&n[o]!==i)throw Error('Name "'+o+'" with type "'+e+'" already registered.');n[o]=i,r[o]=t},ar=function(e,t){if(e===String(b.FIELD))if("function"!=typeof t.fromJson)throw Error('Type "'+e+'" must have a fromJson function')},cr=function(e,t){e=(""+e).toLowerCase(),t=t.toLowerCase();var i=Br[e];i&&i[t]?(delete Br[e][t],delete Fr[e][t]):console.warn("Unable to unregister ["+t+"]["+e+"] from the registry.")},ur=function(e,t,i){e=(""+e).toLowerCase(),t=t.toLowerCase();var s=Br[e];if(s&&s[t])return s[t];if(t="Unable to find ["+t+"]["+e+"] in the registry.",i)throw Error(t+" You must require or register a "+e+" plugin.");return console.warn(t),null},hr=function(e,t){return e=(""+e).toLowerCase(),t=t.toLowerCase(),!!(e=Br[e])&&!!e[t]},dr=ur,pr=ur,gr=function(e,t,i){e=(""+e).toLowerCase();var s,o=Br[e];if(!o){if(o=`Unable to find [${e}] in the registry.`,i)throw Error(o+` You must require or register a ${e} plugin.`);return console.warn(o),null}if(!t)return o;e=Fr[e],i=Object.create(null);for(s of Object.keys(o))i[e[s]]=o[s];return i},mr=function(e,t,i){return"function"==typeof(t=t.plugins[String(e)]||Ur)?t:dr(e,t,i)},_r=function(e,t){br(),jr=setTimeout(function(){t&&t.handleRightClick(e)},Gr)},br=function(){jr&&(clearTimeout(jr),jr=0)},fr=function(){Wr=null},Tr=function(e){return!e.type.startsWith("pointer")||e instanceof PointerEvent&&vr(e)},Er=function(e){return""+e.pointerId},vr=function(e){var t=Er(e);return Wr?Wr===t:"pointerdown"===e.type&&(Wr=t,!0)},p=function(t,i,s,o,n){function r(e){(n||Tr(e))&&(s?o.call(s,e):o(e))}var l=[];if(i in zr)for(let e=0;e<zr[i].length;e++){var a=zr[i][e];t.addEventListener(a,r,!1),l.push([t,a,r])}else t.addEventListener(i,r,!1),l.push([t,i,r]);return l},yr=function(t,i,s,o){function n(e){s?o.call(s,e):o(e)}var r=[];if(i in zr)for(let e=0;e<zr[i].length;e++){var l=zr[i][e];t.addEventListener(l,n,!1),r.push([t,l,n])}else t.addEventListener(i,n,!1),r.push([t,i,n]);return r},n=function(e){for(var t=e[e.length-1][2];e.length;){var[i,s,o]=e.pop();i.removeEventListener(s,o,!1)}return t},kr=function(e){if(e.target instanceof HTMLElement){if(e.target.isContentEditable||"true"===e.target.getAttribute("data-is-text-input"))return!0;if(e.target instanceof HTMLInputElement)return"text"===(e=e.target).type||"number"===e.type||"email"===e.type||"password"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type;if(e.target instanceof HTMLTextAreaElement)return!0}return!1},Ir=function(e){return!(!e.ctrlKey||!gl)||2===e.button},Cr=function(e,t,i){var s=t.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,i=i||t.getScreenCTM().inverse(),s.matrixTransform(i)},Sr=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*bl,y:e.deltaY*bl};case 2:return{x:e.deltaX*fl,y:e.deltaY*fl}}},wr=function(){return"blockly-"+(kl++).toString(36)},Ar=function(){return yl.genUid()},xr=function(e){return e.type===f.BLOCK_CREATE},Rr=function(e){return e.type===f.BLOCK_DELETE},Or=function(e){return e.type===f.BLOCK_CHANGE},Nr=function(e){return e.type===f.BLOCK_FIELD_INTERMEDIATE_CHANGE},$r=function(e){return e.type===f.BLOCK_MOVE},Lr=function(e){return e.type===f.CLICK},Mr=function(e){return e.type===f.BUBBLE_OPEN},Dr=function(e){return e.type===f.VIEWPORT_CHANGE},Br=(_.setRecordUndo$$module$build$src$core$events$utils=function(e){Cl=e},ur=function(){return Cl},g=function(e){xl.fireInternal(e)},Wl=function(e){if(U()){if(!Al.length)try{requestAnimationFrame(()=>{setTimeout(D,0)})}catch(e){setTimeout(D,0)}B(e)}},D=function(){var e,t,i=P(Al);Al.length=0;for(e of i)e.workspaceId&&null!=(t=ie(e.workspaceId))&&t.fireChangeListener(e)},B=function(t){if(Or(t)&&"mutation"===t.element){let e;for(e=Al.length;0<e;e--){var i=Al[e-1];if(i.group!==t.group||i.workspaceId!==t.workspaceId||!$r(i)||i.newParentId!==t.blockId)break}Al.splice(e,0,t)}else Al.push(t)},P=function(e){var t,i,s=[];for(t of e)e=s[s.length-1],t.isNull()||(e&&e.workspaceId===t.workspaceId&&e.group===t.group?$r(t)&&$r(e)&&t.blockId===e.blockId?(e.newParentId=t.newParentId,e.newInputName=t.newInputName,e.newCoordinate=t.newCoordinate,(e.reason||t.reason)&&(e.reason=Array.from(new Set((null!=(i=e.reason)?i:[]).concat(null!=(i=t.reason)?i:[]))))):Or(t)&&Or(e)&&t.blockId===e.blockId&&t.element===e.element&&t.name===e.name?e.newValue=t.newValue:Dr(t)&&Dr(e)?(e.viewTop=t.viewTop,e.viewLeft=t.viewLeft,e.scale=t.scale,e.oldScale=t.oldScale):Lr(t)&&Mr(e)||s.push(t):s.push(t));return s.filter(e=>!e.isNull())},F=function(){for(let e=0,t;t=Al[e];e++)t.recordUndo=!1},_.disable$$module$build$src$core$events$utils=function(){Sl++},_.enable$$module$build$src$core$events$utils=function(){Sl--},U=function(){return 0===Sl},_.getGroup$$module$build$src$core$events$utils=function(){return Il},_.setGroup$$module$build$src$core$events$utils=function(e){xl.setGroupInternal(e)},zl=function(e){Il="boolean"==typeof e?e?Ar():"":e},H=function(i){var s=[];i=i.getDescendants(!1);for(let e=0,t;t=i[e];e++)s[e]=t.id;return s},G=function(e,t){var i=m(e.type);if(i)return i.fromJson(e,t);throw Error("Unknown event type.")},m=function(e){var t=dr(b.EVENT,e);if(t)return t;throw Error(`Event type ${e} not found in registry.`)},V=function(e){if(($r(e)||xr(e))&&e.workspaceId){var t=ie(e.workspaceId);if(!e.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(e=t.getBlockById(e.blockId)){var i=Cl;try{Cl=!1;var s=e.getParent();if(s&&!s.hasDisabledReason(wl)){var o=e.getDescendants(!1);for(let e=0,t;t=o[e];e++)t.setDisabledReason(!1,wl)}else if((e.outputConnection||e.previousConnection)&&!t.isDragging())for(;e.setDisabledReason(!0,wl),e=e.getNextBlock(););}finally{Cl=i}}}},a=function(e,t,i){for(var s in e=document.createElementNS(Rl,""+e),t)e.setAttribute(s,""+t[s]);return i&&i.appendChild(e),e},c=function(t,e){return!(e=e.split(" ")).every(e=>t.classList.contains(e))&&(t.classList.add(...e),!0)},W=function(e,t){e.classList.remove(...t.split(" "))},r=function(t,e){return!(e=e.split(" ")).every(e=>!t.classList.contains(e))&&(t.classList.remove(...e),!0)},z=function(e,t){return e.classList.contains(t)},l=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},j=function(e,t){var i=t.nextSibling;if(!(t=t.parentNode))throw Error("Reference node has no parent.");i?t.insertBefore(e,i):t.appendChild(e)},Y=function(e,t){e.style.transform=t,e.style["-webkit-transform"]=t},X=function(){Ll++,$l=$l||Object.create(null)},K=function(){--Ll||($l=null)},J=function(e){var t,i=e.textContent+"\n"+e.className.baseVal;return $l&&(t=$l[i])||(t=window.getComputedStyle(e),t=q(e,t.fontSize,t.fontWeight,t.fontFamily),$l&&($l[i]=t)),t},Yl=function(e,t,i,s){return q(e,t+"pt",i,s)},q=function(e,t,i,s){var o,n=e.textContent;return e=n+"\n"+e.className.baseVal,$l&&(o=$l[e])||(Ml||((o=document.createElement("canvas")).className="blocklyComputeCanvas",document.body.appendChild(o),Ml=o.getContext("2d")),o=n&&Ml?(Ml.font=i+" "+t+" "+s,Ml.measureText(n).width):0,$l&&($l[e]=o)),o},Z=function(e,t,i,s){var o=document.createElement("span");o.style.font=i+" "+t+" "+s,o.textContent=e,(e=document.createElement("div")).style.width="1px",e.style.height="0",(t=document.createElement("div")).style.display="flex",t.style.position="fixed",t.style.top="0",t.style.left="0",t.appendChild(o),t.appendChild(e),document.body.appendChild(t),i={height:0,baseline:0};try{t.style.alignItems="baseline",i.baseline=e.offsetTop-o.offsetTop,t.style.alignItems="flex-end",i.height=e.offsetTop-o.offsetTop}finally{document.body.removeChild(t)}return i},_.getFocusManager$$module$build$src$core$focus_manager=function(){return Fl.getFocusManager()},Q=function(e){return e&&"function"==typeof e.getFocusableElement&&"function"==typeof e.getFocusableTree&&"function"==typeof e.onNodeFocus&&"function"==typeof e.onNodeBlur&&"function"==typeof e.canBeFocused},ee=function(e){return Q(e)&&"string"==typeof e.id&&"object"==typeof e.workspace&&"function"==typeof e.select&&"function"==typeof e.unselect},te=function(e,t){for(var i in t)null!==t[i]&&Array.isArray(t[i])?e[i]=te(e[i]||[],t[i]):e[i]=null!==t[i]&&"object"==typeof t[i]?te(e[i]||Object.create(null),t[i]):t[i];return e},ie=function(e){return Hl[e]||null},se=function(){var e,t=[];for(e in Hl)t.push(Hl[e]);return t},oe=function(e){Hl[e.id]=e},ne=function(e){delete Hl[e.id]},re=function(){return qr},le=function(e){qr=e},ae=function(){var e=_.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode();return e&&ee(e)?e:null},ea=function(e){_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e)},ce=function(e){var t=ae(),i=new(m(f.SELECTED))(null!=(i=null==t?void 0:t.id)?i:null,null!=(i=null==e?void 0:e.id)?i:null,null!=(e=null!=(i=null==e?void 0:e.workspace.id)?i:null==t?void 0:t.workspace.id)?e:"");g(i)},Zl=function(){return Zr},ue=function(e){Zr=e},he=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;var t,i=e.getParentSvg(),s=e.getCachedParentSvgSize(),o=i.parentElement;o instanceof HTMLElement&&(t=o.offsetWidth,o=o.offsetHeight,s.width!==t&&(i.setAttribute("width",t+"px"),e.setCachedParentSvgSize(t,null)),s.height!==o&&(i.setAttribute("height",o+"px"),e.setCachedParentSvgSize(null,o)),e.resize())},de=function(e,t){var i=Object.create(null),s=e.getDescendants(!0);t&&(e=e.getNextBlock())&&(e=s.indexOf(e),s.splice(e,s.length-e));for(let e=0,t;t=s[e];e++)i[t.type]?i[t.type]++:i[t.type]=1;return i},pe=function(e){return function(){this.jsonInit(e)}},ge=function(e){Vl.defineBlocksWithJsonArrayInternal(e)},t=function(e){_.defineBlocks$$module$build$src$core$common(_.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(e))},_.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(t){var i={};for(let e=0;e<t.length;e++){var s,o=t[e];o?(s=o.type)?i[s]={init:pe(o)}:console.warn(`Block definition #${e} in JSON array is missing a type attribute. `+"Skipping."):console.warn(`Block definition #${e} in JSON array is ${o}. Skipping`)}return i},_.defineBlocks$$module$build$src$core$common=function(e){for(var t of Object.keys(e)){var i=e[t];t in Hr&&console.warn(`Block definition "${t}" overwrites previous definition.`),Hr[t]=i}},me=function(e){let t=qr;var i,s=_.getFocusManager$$module$build$src$core$focus_manager().getFocusedTree();for(i of se())if(s===i){t=i;break}kr(e)||!t||t.rendered&&!t.isFlyout&&!t.isVisible()||v.registry.onKeyDown(t,e)},_e=function(e,t){return-1!==(t=e.indexOf(t))&&(e.splice(t,1),!0)},be=function(e){if(Jl)throw Error("CSS already injected");ql+="\n"+e},fe=function(e,t){Jl||(Jl=!0,e&&(e=t.replace(/[\\/]$/,""),t=ql.replace(/<<<PATH>>>/g,e),ql="",(e=document.createElement("style")).id="blockly-common-style",t=document.createTextNode(t),e.appendChild(t),document.head.insertBefore(e,document.head.firstChild)))},Te=function(e){return Ql.getSizeInternal(e)},ga=function(e){var t,i,s,o,n;return"none"!==ve(e,"display")?Ee(e):(i=(t=e.style).display,s=t.visibility,o=t.position,t.visibility="hidden",t.position="absolute",t.display="inline",n=e.offsetWidth,e=e.offsetHeight,t.display=i,t.position=o,t.visibility=s,new C(n,e))},Ee=function(e){return new C(e.offsetWidth,e.offsetHeight)},ve=function(e,t){return(e=window.getComputedStyle(e))[t]||e.getPropertyValue(t)},ye=function(e){var t=new y(0,0),i=(e=e.getBoundingClientRect(),document.documentElement),i=new y(window.pageXOffset||i.scrollLeft,window.pageYOffset||i.scrollTop);return t.x=e.left+i.x,t.y=e.top+i.y,t},ke=function(){var e=document.body,t=document.documentElement;return new y(e.scrollLeft||t.scrollLeft,e.scrollTop||t.scrollTop)},Ie=function(e){var t=parseFloat(ve(e,"borderLeftWidth")),i=parseFloat(ve(e,"borderRightWidth")),s=parseFloat(ve(e,"borderTopWidth"));return e=parseFloat(ve(e,"borderBottomWidth")),new I(s,e,t,i)},Ce=function(e,t,i){e=Se(e,t,i),t.scrollLeft=e.x,t.scrollTop=e.y},Se=function(e,t,i){var s=ye(e),o=ye(t),n=Ie(t),r=s.x-o.x-n.left,s=s.y-o.y-n.top,o=Ee(e);return e=t.clientWidth-o.width,o=t.clientHeight-o.height,n=t.scrollLeft,t=t.scrollTop,i?(n+=r-e/2,t+=s-o/2):(n+=Math.min(r,Math.max(r-e,0)),t+=Math.min(s,Math.max(s-o,0))),new y(n,t)},we=function(e){var t=new y(0,0),i=e.x&&e.getAttribute("x"),s=e.y&&e.getAttribute("y");return i&&(t.x=parseInt(i)),s&&(t.y=parseInt(s)),(i=(i=e.getAttribute("transform"))&&i.match(ta))&&(t.x+=Number(i[1]),i[3])&&(t.y+=Number(i[3])),(e=e.getAttribute("style"))&&e.includes("translate")&&(e=e.match(ia))&&(t.x+=Number(e[1]),e[3])&&(t.y+=Number(e[3])),t},Ae=function(e){let t=0,i=0;for(;e;){var s=we(e);if(t+=s.x,i+=s.y,(" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv "))break;e=e.parentNode}return new y(t,i)},xe=function(){var e=ke();return new I(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},Re=function(){var e=document.documentElement,t=window;return new y(t.pageXOffset||e.scrollLeft,t.pageYOffset||e.scrollTop)},Oe=function(e,t){var i=t.x,s=(t=t.y,e.getInjectionDiv().getBoundingClientRect()),i=new y(i-s.left,t-s.top);return t=e.getOriginOffsetInPixels(),y.difference(i,t).scale(1/e.scale)},Ne=function(e,t){var i=t.scale(e.scale),s=(t=i.x,i=i.y,e.getInjectionDiv().getBoundingClientRect());return e=e.getOriginOffsetInPixels(),new y(t+s.left+e.x,i+s.top+e.y)},fa=function(e){({document:ra=ra,DOMParser:la=la,XMLSerializer:aa=aa}=e),oa=new la,na=new aa},_.createElement$$module$build$src$core$utils$xml=function(e){return ra.createElementNS(ca,e)},_.createTextNode$$module$build$src$core$utils$xml=function(e){return ra.createTextNode(e)},_.textToDom$$module$build$src$core$utils$xml=function(e){let t=oa.parseFromString(e,"text/xml");if(t&&t.documentElement&&!t.getElementsByTagName("parsererror").length)return t.documentElement;if((t=oa.parseFromString(e,"text/html"))&&t.body.firstChild&&"xml"===t.body.firstChild.nodeName.toLowerCase())return t.body.firstChild;throw Error("DOMParser was unable to parse: "+e)},$e=function(e){return Le(na.serializeToString(e))},Le=function(e){return e.replace(ua,e=>`&#${e.charCodeAt(0)};`)},Me=function(e){return e?((e instanceof Element||"string"==typeof e)&&(e=Ve(e),e=Ue(e)),De(e),e):null},De=function(e){var t=e.kind;if(e=e.contents,t&&t!==da&&t!==ha)throw Error("Invalid toolbox kind "+t+". Please supply either "+da+" or "+ha);if(!e)throw Error("Toolbox must have a contents attribute.")},Be=function(e){return e?e.contents||(Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:He(e)):[]},Pe=function(e){return pa.hasCategoriesInternal(e)},ma=function(e){var t;return!!e&&((t=e.kind)?t===ha:!!e.contents.filter(e=>"CATEGORY"===e.kind.toUpperCase()).length)},Fe=function(e){return!(!e||!e.contents||!e.contents.filter(function(e){return"CATEGORY"===e.kind.toUpperCase()}).length)},Ue=function(e){var t={contents:He(e)};return e instanceof Node&&Ge(e,t),t},He=function(i){var s,o=[];let n=i.childNodes;n=n||i;for(let e=0,t;t=n[e];e++)t.tagName&&(i={},s=t.tagName.toUpperCase(),"BLOCK"===(i.kind=s)?i.blockxml=t:t.childNodes&&0<t.childNodes.length&&(i.contents=He(t)),Ge(t,i),o.push(i));return o},Ge=function(t,i){for(let e=0;e<t.attributes.length;e++){var s=t.attributes[e];s.nodeName.includes("css-")?(i.cssconfig=i.cssconfig||{},i.cssconfig[s.nodeName.replace("css-","")]=s.value):i[s.nodeName]=s.value}},Ve=function(e){let t=null;if(e)if("string"==typeof e){if("xml"!==(t=_.textToDom$$module$build$src$core$utils$xml(e)).nodeName.toLowerCase())throw TypeError("Toolbox should be an <xml> document.")}else e instanceof Element&&(t=e);return t},We=function(e,t,i,s,o,n){var r=n.scrollbar&&n.scrollbar.canScrollVertically();return e.horizontal===el.LEFT?(i=o.absoluteMetrics.left+i,r&&n.RTL&&(i+=sa.scrollbarThickness)):(i=o.absoluteMetrics.left+o.viewMetrics.width-t.width-i,r&&!n.RTL&&(i-=sa.scrollbarThickness)),e.vertical===Qr.TOP?e=o.absoluteMetrics.top+s:(e=o.absoluteMetrics.top+o.viewMetrics.height-t.height-s,n.scrollbar&&n.scrollbar.canScrollHorizontally()&&(e-=sa.scrollbarThickness)),new I(e,e+t.height,i,i+t.width)},ze=function(e,t){return{horizontal:t.toolboxMetrics.position===T.LEFT||e.horizontalLayout&&!e.RTL?el.RIGHT:el.LEFT,vertical:t.toolboxMetrics.position===T.BOTTOM?Qr.TOP:Qr.BOTTOM}},je=function(t,i,s,o){var n=t.left,r=t.right-t.left,l=t.bottom-t.top;for(let e=0;e<o.length;e++){var a=o[e];t.intersects(a)&&(t=s===tl.UP?a.top-l-i:a.bottom+i,t=new I(t,t+l,n,n+r),e=-1)}return t},Zp=function(e,t){o(b.SERIALIZER,e,t)},Ta=function(e){cr(b.SERIALIZER,e)},Ye=function(e,{addCoordinates:t=!1,saveIds:i=!0}={}){var s=e.workspace,o=Object.create(null);return o.height=e.getSize().height,o.width=e.getSize().width,i&&(o.id=e.id),t&&(t=e.getRelativeToSurfaceXY(),o.x=s.RTL?s.getWidth()-t.x:t.x,o.y=t.y),e.getText()&&(o.text=e.getText()),e.isCollapsed()&&(o.collapsed=!0),e.isOwnEditable()||(o.editable=!1),e.isOwnMovable()||(o.movable=!1),e.isOwnDeletable()||(o.deletable=!1),o},Xe=function(e,t,{recordUndo:i=!1}={}){var s,o,n,r=Cl;return _.setRecordUndo$$module$build$src$core$events$utils(i),i=t.newComment(e.id),void 0!==e.text&&i.setText(e.text),void 0===e.x&&void 0===e.y||(s=i.getRelativeToSurfaceXY(),o=null!=(o=e.x)?o:s.x,o=t.RTL?t.getWidth()-o:o,t=null!=(n=e.y)?n:s.y,i.moveTo(new y(o,t))),void 0===e.width&&!e.height||(n=i.getSize(),i.setSize(new C(null!=(s=e.width)?s:n.width,null!=(o=e.height)?o:n.height))),void 0!==e.collapsed&&i.setCollapsed(e.collapsed),void 0!==e.editable&&i.setEditable(e.editable),void 0!==e.movable&&i.setMovable(e.movable),void 0!==e.deletable&&i.setDeletable(e.deletable),_.setRecordUndo$$module$build$src$core$events$utils(r),i},up=function(e,t){o(b.PASTER,e,t)},S=function(e){cr(b.PASTER,e)},Ke=function(t){for(var e=t.workspace,i=t.getRelativeToSurfaceXY(),s=new y(0,0),o=e.getTopComments(!1).filter(e=>e.id!==t.id).map(e=>e.getRelativeToSurfaceXY());Je(y.sum(i,s),o);)s.translate(e.RTL?-30:30,30);t.moveTo(y.sum(i,s))},Je=function(t,e){return e.some(e=>Math.abs(e.x-t.x)<=1&&Math.abs(e.y-t.y)<=1)},qe=function(e,t){e.setAttribute(ya,t)},Ze=function(e,t,i){Array.isArray(i)&&(i=i.join(" ")),e.setAttribute(va+t,""+i)},Qe=function(e){return e&&"function"==typeof e.saveState&&"function"==typeof e.loadState},et=function(e){return ot(e),st()?(nt(),Promise.resolve()):$a=$a||new Promise(e=>{La=e,Ma=window.requestAnimationFrame(()=>{nt(),e()})})},tt=function(){return $a||Promise.resolve()},it=function(e){e||window.cancelAnimationFrame(Ma),nt(e),!e&&La&&La()},st=function(){return cl},ot=function(e){Oa.add(e),Na.set(e,_.getGroup$$module$build$src$core$events$utils());var t=e.getParent();t?ot(t):Ra.add(e)},nt=function(e){let t=e?new Set([e]):new Set([...Ra].map(e=>e.workspace)),i=[...Ra].filter(lt).filter(e=>t.has(e.workspace));for(var s of i)at(s);for(var o of t)o.resizeContents();for(var n of i)s=n.getRelativeToSurfaceXY(),n.updateComponentLocations(s);for(var r of i)n=_.getGroup$$module$build$src$core$events$utils(),(s=Na.get(r))&&_.setGroup$$module$build$src$core$events$utils(s),r.bumpNeighbours(),_.setGroup$$module$build$src$core$events$utils(n);for(var l of i)rt(l);e||($a=null)},rt=function(e){Ra.delete(e),Oa.delete(e),Na.delete(e);for(var t of e.getChildren(!1))rt(t)},lt=function(e){return!e.isDisposed()&&!e.getParent()},at=function(e){if(Oa.has(e)&&e.initialized){for(var t of e.getChildren(!1))at(t);e.renderEfficiently()}},ct=function(e,t){Ga(e,t)},w=function(e=Ha){Ga=e},ut=function(e,t){Wa(e,t)},tc=function(e=Va){Wa=e},ht=function(e,t,i){ja(e,t,i)},lc=function(e=za){ja=e},cc=function(e,t){Xa(e,t)},ac=function(e=Ya){Xa=e},dt=function(e){return e&&"function"==typeof e.getProcedureDef},pt=function(e){return e&&"function"==typeof e.getProcedureCall&&"function"==typeof e.renameProcedure},gt=function(e){return void 0!==e.getVariableModel},mt=function(e,t,i,s){e=e+" was deprecated in "+t+" and will be deleted in "+i+".",s&&(e+="\nUse "+s+" instead."),Ja.has(e)||(Ja.add(e),console.warn(e))},_.allUsedVarModels$$module$build$src$core$variables=function(t){t=t.getAllBlocks(!1);var i=new Set;for(let e=0;e<t.length;e++){var s=t[e].getVarModels();if(s)for(let e=0;e<s.length;e++){var o=s[e];o.getId()&&i.add(o)}}return Array.from(i.values())},_.allDeveloperVariables$$module$build$src$core$variables=function(i){i=i.getAllBlocks(!1);var s=new Set;for(let e=0,t;t=i[e];e++){var o=t.getDeveloperVariables;if(o){o=o();for(let e=0;e<o.length;e++)s.add(o[e])}}return Array.from(s.values())},_t=function(e){return bt(e,!1)},bt=function(e,t=!0){return Hr.variables_set||Hr.variables_get||console.warn("There are no variable blocks, but there is a variable category."),t?(mt("The XML return value of Blockly.Variables.flyoutCategory()","v12","v13","the same method, but handle a return type of FlyoutItemInfo[] (JSON) instead."),Et(e)):(e.registerButtonCallback("CREATE_VARIABLE",function(e){It(e.getTargetWorkspace())}),[{kind:"button",text:"%{BKY_NEW_VARIABLE}",callbackkey:"CREATE_VARIABLE"},...Tt(e,e.getVariableMap().getVariablesOfType(""),!0)])},ft=function(e){return{VAR:{name:e.getName(),type:e.getType()}}},Tt=function(e,t,i,s="variables_get",o="variables_set"){i=i&&Hr.math_change,e=[];var n=t.slice(-1)[0];return n&&(Hr[o]&&e.push({kind:"block",type:o,gap:i?8:24,fields:ft(n)}),i)&&e.push({kind:"block",type:"math_change",gap:Hr[s]?20:8,fields:ft(n),inputs:{DELTA:{shadow:{type:"math_number",fields:{NUM:1}}}}}),Hr[s]&&e.push(...t.sort(Lt).map(e=>({kind:"block",type:s,gap:8,fields:ft(e)}))),e},Et=function(e){let t=[];var i=document.createElement("button");return i.setAttribute("text","%{BKY_NEW_VARIABLE}"),i.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",function(e){It(e.getTargetWorkspace())}),t.push(i),e=vt(e),t=t.concat(e)},vt=function(i){var s=[];if(0<(i=i.getVariableMap().getVariablesOfType("")).length){var e,o=i[i.length-1];if(Hr.variables_set&&((e=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_set"),e.setAttribute("gap",Hr.math_change?"8":"24"),e.appendChild(Ot(o)),s.push(e)),Hr.math_change&&((e=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","math_change"),e.setAttribute("gap",Hr.variables_get?"20":"8"),e.appendChild(Ot(o)),o=_.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),e.appendChild(o),s.push(e)),Hr.variables_get){i.sort(Lt);for(let e=0,t;t=i[e];e++)(o=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get"),o.setAttribute("gap","8"),o.appendChild(Ot(t)),s.push(o)}}return s},yt=function(e){return Qa.generateUniqueNameInternal(e)},pc=function(e){return kt(Za.charAt(0),e.getVariableMap().getAllVariables().map(e=>e.getName()))},kt=function(s,o){if(o.length){var n=Za;let e="",i=n.indexOf(s);for(;;){let t=!1;for(let e=0;e<o.length;e++)if(o[e].toLowerCase()===s){t=!0;break}if(!t)break;++i===n.length&&(i=0,e=""+(Number(e)+1)),s=n.charAt(i)+e}}return s},It=function(o,n,e){let r=e||"";!function s(e){Ct(_.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,e,function(e){var t,i;e?(t=wt(e,o))?(i=t.getType()===r?_.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",t.getName()):(i=_.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE).replace("%1",t.getName()).replace("%2",t.getType()),ct(i,function(){s(e)})):(o.getVariableMap().createVariable(e,r),n&&n(e)):n&&n(null)})}("")},_.renameVariable$$module$build$src$core$variables=function(n,r,l){!function o(e){var t=_.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",r.getName());Ct(t,e,function(e){var t,i,s;e?(t=St(e,r.getType(),n),i=At(r.getName(),e,n),t||i?(s="",t?s=_.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",t.getName()).replace("%2",t.getType()):i&&(s=_.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",e).replace("%2",i)),ct(s,function(){o(e)})):(n.getVariableMap().renameVariable(r,e),l&&l(e))):l&&l(null)})}("")},Ct=function(e,t,i){ht(e,t,function(e){!e||(e=e.replace(/[\s\xa0]+/g," ").trim())!==_.Msg$$module$build$src$core$msg.RENAME_VARIABLE&&e!==_.Msg$$module$build$src$core$msg.NEW_VARIABLE||(e=null),i(e)})},St=function(i,s,o){o=o.getVariableMap().getAllVariables(),i=i.toLowerCase();for(let e=0,t;t=o[e];e++)if(t.getName().toLowerCase()===i&&t.getType()!==s)return t;return null},wt=function(i,s){s=s.getVariableMap().getAllVariables(),i=i.toLowerCase();for(let e=0,t;t=s[e];e++)if(t.getName().toLowerCase()===i)return t;return null},At=function(e,t,i){return(i.getProcedureMap().getProcedures().length?xt:Rt)(e,t,i)},xt=function(t,i,e){t=t.toLowerCase(),i=i.toLowerCase();for(var s of e=e.getProcedureMap().getProcedures()){var o=s.getParameters().filter(gt).map(e=>e.getVariableModel().getName());if(o&&(e=o.some(e=>e.toLowerCase()===t),o=o.some(e=>e.toLowerCase()===i),e)&&o)return s.getName()}return null},Rt=function(t,i,e){t=t.toLowerCase(),i=i.toLowerCase();for(var s of e=e.getAllBlocks(!1))if(dt(s)){var o=(s=(e=s.getProcedureDef())[1]).some(e=>e.toLowerCase()===t),s=s.some(e=>e.toLowerCase()===i);if(o&&s)return e[0]}return null},Ot=function(e){var t=_.createElement$$module$build$src$core$utils$xml("field");return t.setAttribute("name","VAR"),t.setAttribute("id",e.getId()),t.setAttribute("variabletype",e.getType()),e=_.createTextNode$$module$build$src$core$utils$xml(e.getName()),t.appendChild(e),t},_.getOrCreateVariablePackage$$module$build$src$core$variables=function(e,t,i,s){let o=_.getVariable$$module$build$src$core$variables(e,t,i,s);return o=o||Nt(e,t,i,s)},_.getVariable$$module$build$src$core$variables=function(e,t,i,s){var o=e.getPotentialVariableMap();let n=null;if((!t||!(n=!(n=e.getVariableById(t))&&o?o.getVariableById(t):n))&&i){if(void 0===s)throw Error("Tried to look up a variable by name without a type");!(n=e.getVariable(i,s))&&o&&(n=o.getVariable(i,s))}return n},Nt=function(e,t,i,s){var o=e.getVariableMap(),n=e.getPotentialVariableMap();return i=i||yt(e.isFlyout?e.targetWorkspace:e),n?n.createVariable(i,s,null!=t?t:void 0):o.createVariable(i,s,t)},$t=function(t,i){t=t.getAllVariables();var s=[];if(i.length!==t.length)for(let e=0;e<t.length;e++){var o=t[e];i.includes(o)||s.push(o)}return s},Lt=function(e,t){return e.getName().localeCompare(t.getName(),void 0,{sensitivity:"base"})},Mt=function(i,s){var o=[];i=i.getAllBlocks(!1);for(let t=0;t<i.length;t++){var n=i[t].getVarModels();if(n)for(let e=0;e<n.length;e++)n[e].getId()===s&&o.push(i[t])}return o},_.deleteVariable$$module$build$src$core$variables=function(t,i,s){var o=i.getName(),n=Mt(t,i.getId());for(let e=n.length-1;0<=e;e--){var r=n[e];if("procedures_defnoreturn"===r.type||"procedures_defreturn"===r.type)return s=String(r.getFieldValue("NAME")),o=_.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",o).replace("%2",s),void ct(o);r===s&&n.splice(e,1)}s&&n.length||1<n.length?(o=_.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(n.length+(s&&!s.workspace.isFlyout?1:0))).replace("%2",o),ut(o,e=>{e&&i&&t.getVariableMap().deleteVariable(i)})):t.getVariableMap().deleteVariable(i)},Dt=function(e,{addCoordinates:t=!1,addInputBlocks:i=!0,addNextBlocks:s=!0,doFullSerialization:o=!0,saveIds:n=!0}={}){var r;return e.isInsertionMarker()?null:(r={type:e.type,id:n?e.id:void 0},t&&Pt(e,r),Bt(e,r),Ft(e,r,o),Ut(e,r,o),Ht(e,r,o),i&&Gt(e,r,o,n),s&&Vt(e,r,o,n),r)},Bt=function(e,t){e.isCollapsed()&&(t.collapsed=!0),e.isEnabled()||(t.disabledReasons=Array.from(e.getDisabledReasons())),e.isOwnDeletable()||(t.deletable=!1),e.isOwnMovable()||(t.movable=!1),e.isOwnEditable()||(t.editable=!1),void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&(t.inline=e.inputsInline),e.data&&(t.data=e.data)},Pt=function(e,t){var i=e.workspace;e=e.getRelativeToSurfaceXY(),t.x=Math.round(i.RTL?i.getWidth()-e.x:e.x),t.y=Math.round(e.y)},Ft=function(e,t,i){e.saveExtraState?null!==(e=e.saveExtraState(i))&&(t.extraState=e):e.mutationToDom&&null!==(e=e.mutationToDom())&&(t.extraState=Ms(e).replace(' xmlns="https://developers.google.com/blockly/xml"',""))},Ut=function(e,t,i){var s,o=Object.create(null);for(s of e.getIcons())Qe(s)&&(e=s.saveState(i))&&(o[s.getType().toString()]=e);Object.keys(o).length&&(t.icons=o)},Ht=function(e,t,i){var s,o=Object.create(null);for(s of e.getFields())s.isSerializable()&&(o[s.name]=s.saveState(i));Object.keys(o).length&&(t.fields=o)},Gt=function(t,e,i,s){var o=Object.create(null);for(let e=0;e<t.inputList.length;e++){var n,r=t.inputList[e];r.connection&&(n=Wt(r.connection,i,s))&&(o[r.name]=n)}Object.keys(o).length&&(e.inputs=o)},Vt=function(e,t,i,s){e.nextConnection&&(e=Wt(e.nextConnection,i,s))&&(t.next=e)},Wt=function(e,t,i){var s,o=e.getShadowState(!0);return e=e.targetBlock(),o||e?(s=Object.create(null),o&&(s.shadow=o),e&&!e.isShadow()&&(s.block=Dt(e,{doFullSerialization:t,saveIds:i})),s):null},zt=function(e,t,{recordUndo:i=!1}={}){return e=jt(e,t,{recordUndo:i}),t.rendered&&it(),e},jt=function(e,t,{parentConnection:i,isShadow:s=!1,recordUndo:o=!1}={}){var n=Cl,r=(_.setRecordUndo$$module$build$src$core$events$utils(o),(o=_.getGroup$$module$build$src$core$events$utils())||_.setGroup$$module$build$src$core$events$utils(!0),_.disable$$module$build$src$core$events$utils(),t.getAllVariables());let l;try{l=Yt(e,t,{parentConnection:i,isShadow:s})}finally{_.enable$$module$build$src$core$events$utils()}if(Xt(t,r),U()&&g(new(m(f.BLOCK_CREATE))(l)),_.setGroup$$module$build$src$core$events$utils(o),_.setRecordUndo$$module$build$src$core$events$utils(n),t.rendered){let e=l;setTimeout(()=>{e.disposed||e.setConnectionTracking(!0)},1)}return l},Yt=function(e,t,{parentConnection:i,isShadow:s=!1}={}){var o;if(e.type)return(o=t.newBlock(e.type,e.id)).setShadow(s),Kt(o,e),Jt(o,e),qt(o,e),Zt(i,o,e),Qt(o,e),ei(o,e),ti(o,e),ii(o,e),oi(o,t.rendered),o;throw new ic(e)},Xt=function(e,t){if(U())for(e=$t(e,t),t=0;t<e.length;t++){var i=e[t];g(new(m(f.VAR_CREATE))(i))}},Kt=function(e,t){var i=void 0===t.x?0:t.x,s=(t=void 0===t.y?0:t.y,e.workspace),i=s.RTL?s.getWidth()-i:i;e.moveBy(i,t)},Jt=function(e,t){if(t.collapsed&&e.setCollapsed(!0),!1===t.deletable&&e.setDeletable(!1),!1===t.movable&&e.setMovable(!1),!1===t.editable&&e.setEditable(!1),!1===t.enabled&&e.setDisabledReason(!0,Aa),Array.isArray(t.disabledReasons))for(var i of t.disabledReasons)e.setDisabledReason(!0,i);void 0!==t.inline&&e.setInputsInline(t.inline),void 0!==t.data&&(e.data=t.data)},qt=function(e,t){t.extraState&&(e.loadExtraState?e.loadExtraState(t.extraState):e.domToMutation&&e.domToMutation(_.textToDom$$module$build$src$core$utils$xml(t.extraState)))},Zt=function(e,t,i){if(e){if(e.getSourceBlock().isShadow()&&!t.isShadow())throw new nc(i);if(e.type===_.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var s=t.outputConnection;if(!s)throw new sc("output",t,i)}else if(!(s=t.previousConnection))throw new sc("previous",t,i);var o;if(!e.connect(s))throw o=t.workspace.connectionChecker,new oc(o.getErrorMessage(o.canConnectWithReason(s,e,!1),s,e),e.type===_.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",t,i)}},Qt=function(e,t){var i;if(t.icons)for(i of Object.keys(t.icons)){var s=t.icons[i],o=e.getIcon(i);if(!o){if(!(o=dr(b.ICON,i,!1)))throw new rc(i,e,t);o=new o(e),e.addIcon(o)}Qe(o)&&o.loadState(s)}},ei=function(t,i){if(i.fields){var s=Object.keys(i.fields);for(let e=0;e<s.length;e++){var o=s[e],n=i.fields[o],r=t.getField(o);r?r.loadState(n):console.warn(`Ignoring non-existant field ${o} in block `+t.type)}}},ti=function(t,i){if(i.inputs){var s=Object.keys(i.inputs);for(let e=0;e<s.length;e++){var o=s[e],n=t.getInput(o);if(!n||!n.connection)throw new sc(o,t,i);si(n.connection,i.inputs[o])}}},ii=function(e,t){if(t.next){if(!e.nextConnection)throw new sc("next",e,t);si(e.nextConnection,t.next)}},si=function(e,t){t.shadow&&e.setShadowState(t.shadow),t.block&&Yt(t.block,e.getSourceBlock().workspace,{parentConnection:e})},oi=function(e,t){if(t){e.setConnectionTracking(!1),e.initSvg(),e.queueRender();for(var i of e.getIcons())i.onLocationChange(e.getRelativeToSurfaceXY())}else e.initModel()},ni=function(e){return"function"==typeof e.bubbleIsVisible&&"function"==typeof e.setBubbleVisible&&"function"==typeof e.getBubble},ri=function(e){return e*Math.PI/180},zc=function(e){return 180*e/Math.PI},li=function(e,t,i){var s;return i<e&&(s=i,i=e,e=s),Math.max(e,Math.min(t,i))},ai=function(){document.querySelector(".blocklyDropDownDiv")||((nl=document.createElement("div")).className="blocklyDropDownDiv",nl.tabIndex=-1,(Zr||document.body).appendChild(nl),(rl=document.createElement("div")).className="blocklyDropDownContent",nl.appendChild(rl),wc=p(rl,"keydown",null,me),(ll=document.createElement("div")).className="blocklyDropDownArrow",nl.appendChild(ll),nl.style.opacity="0",nl.style.transition="transform "+fc+"s, opacity "+fc+"s")},ci=function(e){kc=e},Jc=function(){return Ic},Kc=function(){return rl},ui=function(){wc&&(n(wc),wc=null),nl.remove(),ai()},hi=function(e,t){nl.style.backgroundColor=e,nl.style.borderColor=t},cu=function(e,t,i,s,o=!0){return mi(pi(t),e,o,i,s)},di=function(e,t,i,s=!0){return Cc=!0,mi(gi(e),e,s,t,i)},pi=function(e){var t=e.getSvgRoot(),i=e.workspace.scale,s=e.height*i;return e=e.width*i,t=ye(t),new I(t.y,t.y+s,t.x,t.x+e)},gi=function(e){return e=e.getScaledBBox(),new I(e.top,e.bottom,e.left,e.right)},mi=function(e,t,i,s,o){var n=e.left+(e.right-e.left)/2,r=e.bottom;e=e.top,o&&(e+=o);let l=(o=t.getSourceBlock()).workspace;for(;l.options.parentWorkspace;)l=l.options.parentWorkspace;return ci(l.getParentSvg().parentNode),_i(t,o.RTL,n,r,n,e,i,s)},_i=function(e,t,i,s,o,n,r,l){return Ic=e,Ec=l||null,nl.style.direction=t?"rtl":"ltr",vc=(e=qr).getRenderer().getClassName(),yc=e.getTheme().getClassName(),c(nl,vc),c(nl,yc),i=Ii(i,s,o,n),r&&(Sc=_.getFocusManager$$module$build$src$core$focus_manager().takeEphemeralFocus(nl)),i},bi=function(e,t,i,s){return{initialX:(e=Ei(e,i.left,i.right,s.width)).divX,initialY:t,finalX:e.divX,finalY:t+bc,arrowX:e.arrowX,arrowY:-(gc/2+mc),arrowAtTop:!0,arrowVisible:!0}},fi=function(e,t,i,s){return{initialX:(e=Ei(e,i.left,i.right,s.width)).divX,initialY:t-s.height,finalX:e.divX,finalY:t-s.height-bc,arrowX:e.arrowX,arrowY:s.height-2*mc-gc/2,arrowAtTop:!1,arrowVisible:!0}},Ti=function(e,t,i){return{initialX:(e=Ei(e,t.left,t.right,i.width)).divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},Ei=function(e,t,i,s){return t=li(t,e-s/2,i-s),{arrowX:e=li(i=_c,e=e-gc/2-t,s-i-gc),divX:t}},nu=function(){return!!Ic},vi=function(e,t){return Ic===e&&((t?ki:yi)(),!0)},yi=function(){nl.style.transform="translate(0, 0)",nl.style.opacity="0",Tc=setTimeout(function(){ki()},1e3*fc),Ec&&(Ec(),Ec=null)},ki=function(){Ic&&(Tc&&clearTimeout(Tc),Ec&&(Ec(),Ec=null),ui(),Ic=null,qr.markFocused(),Sc)&&(Sc(),Sc=null)},Ii=function(e,t,i,s){(e=Ac.getPositionMetrics(e,t,i,s)).arrowVisible?(t=e.arrowX,i=e.arrowY,s=e.arrowAtTop?45:225,ll.style.display="",ll.style.transform=`translate(${t}px, ${i}px) rotate(${s}deg)`,ll.setAttribute("class","blocklyDropDownArrow")):ll.style.display="none",t=Math.floor(e.initialX),i=Math.floor(e.initialY),s=Math.floor(e.finalX);var o=Math.floor(e.finalY);return nl.style.left=t+"px",nl.style.top=i+"px",nl.style.display="block",nl.style.opacity="1",nl.style.transform="translate("+(s-t)+"px,"+(o-i)+"px)",!!e.arrowAtTop},Ci=function(){var e,t;Ic?(e=Ic.getSourceBlock(),t=(e=Cc?gi(Ic):pi(e)).left+(e.right-e.left)/2,Ii(t,e.bottom,t,e.top)):yi()},Si=function(e){return e.length?e.reduce(function(e,t){return e.length<t.length?e:t}).length:0},wi=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i=0;t=t||Si(e);let s;for(s=0;s<t;s++){for(var o=e[0][s],n=1;n<e.length;n++)if(o!==e[n][s])return i;" "===o&&(i=s+1)}for(o=1;o<e.length;o++)if((n=e[o][s])&&" "!==n)return i;return t},Ai=function(e,t){if(!e.length)return 0;if(1===e.length)return e[0].length;let i=0;t=t||Si(e);let s;for(s=0;s<t;s++){for(var o=e[0].substr(-s-1,1),n=1;n<e.length;n++)if(o!==e[n].substr(-s-1,1))return i;" "===o&&(i=s+1)}for(o=1;o<e.length;o++)if((n=e[o].charAt(e[o].length-s-1))&&" "!==n)return i;return t},_.wrap$$module$build$src$core$utils$string=function(t,i){t=t.split("\n");for(let e=0;e<t.length;e++)t[e]=xi(t[e],i);return t.join("\n")},xi=function(i,e){if(i.length<=e)return i;for(var s=i.trim().split(/\s+/),o=0;o<s.length;o++)s[o].length>e&&(e=s[o].length);var n=-1/0;let r,l=1;do{o=n,r=i,i=[],n=s.length/l;let t=1;for(let e=0;e<s.length-1;e++)t<(e+1.5)/n?(t++,i[e]=!0):i[e]=!1}while(i=Oi(s,i,e),n=Ri(s,i,e),i=Ni(s,i),l++,o<n);return r},Ri=function(e,t,i){for(var s=[0],o=[],n=0;n<e.length;n++)s[s.length-1]+=e[n].length,!0===t[n]?(s.push(0),o.push(e[n].charAt(e[n].length-1))):!1===t[n]&&s[s.length-1]++;for(e=Math.max(...s),n=t=0;n<s.length;n++)t=(t-=2*Math.pow(Math.abs(i-s[n]),1.5))-Math.pow(e-s[n],1.5),".?!".includes(o[n])?t+=i/3:",;)]}".includes(o[n])&&(t+=i/4);return 1<s.length&&s[s.length-1]<=s[s.length-2]&&(t+=.5),t},Oi=function(t,i,s){let o=Ri(t,i,s),n;for(let e=0;e<i.length-1;e++){var r,l;i[e]!==i[e+1]&&((r=[].concat(i))[e]=!r[e],r[e+1]=!r[e+1],(l=Ri(t,r,s))>o)&&(o=l,n=r)}return n?Oi(t,n,s):i},Ni=function(t,i){var s=[];for(let e=0;e<t.length;e++)s.push(t[e]),void 0!==i[e]&&s.push(i[e]?"\n":" ");return s.join("")},_.isNumber$$module$build$src$core$utils$string=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},Iu=function(e){xc=e},cp=function(){return xc},hu=function(){return Rc},qd=function(){return Wc},$i=function(e){if(e=Li(e)){for(e=e.tooltip;"function"==typeof e;)e=e();if("string"!=typeof e)throw Error("Tooltip function must return a string.");return e}return""},Li=function(e){for(;e&&e.tooltip;){if("string"==typeof e.tooltip||"function"==typeof e.tooltip)return e;e=e.tooltip}return null},Mi=function(){document.querySelector(".blocklyTooltipDiv")||((Wc=document.createElement("div")).className="blocklyTooltipDiv",(Zr||document.body).appendChild(Wc))},Di=function(e){e.mouseOverWrapper_=yr(e,"pointerover",null,Pi),e.mouseOutWrapper_=yr(e,"pointerout",null,Fi),e.addEventListener("pointermove",Ui,!1)},Bi=function(e){e&&(n(e.mouseOverWrapper_),n(e.mouseOutWrapper_),e.removeEventListener("pointermove",Ui))},Pi=function(e){Oc||(e=Li(e.currentTarget),Bc!==e&&(Gi(),Pc=null,Bc=e),clearTimeout($c))},Fi=function(e){Oc||($c=setTimeout(function(){Pc=Bc=null,Gi()},1),clearTimeout(Lc),Lc=0)},Ui=function(e){var t;Bc&&Bc.tooltip&&!Oc&&(Rc?(t=Mc-e.pageX,e=Dc-e.pageY,Math.sqrt(t*t+e*e)>Hc&&Gi()):Pc!==Bc&&(clearTimeout(Lc),Mc=e.pageX,Dc=e.pageY,Lc=setTimeout(Xi,Gc)))},Hi=function(){Pc=Bc=null,Gi()},Gi=function(){Rc&&(Rc=!1,Wc)&&(Wc.style.display="none"),Lc&&(clearTimeout(Lc),Lc=0)},Vi=function(){Gi(),Oc=!0},Wi=function(){Oc=!1},zi=function(){Wc&&Bc&&("function"==typeof xc?xc(Wc,Bc):ji())},ji=function(){var t=$i(Bc);t=(t=_.wrap$$module$build$src$core$utils$string(t,Nc)).split("\n");for(let e=0;e<t.length;e++){var i=document.createElement("div");i.appendChild(document.createTextNode(t[e])),Wc.appendChild(i)}},Yi=function(e){var t=document.documentElement.clientWidth,i=document.documentElement.clientHeight;let s=Mc,o=(s=e?s-(Fc+Wc.offsetWidth):s+Fc,Dc+Uc);return o+Wc.offsetHeight>i+window.scrollY&&(o-=Wc.offsetHeight+2*Uc),e?s=Math.max(Vc-window.scrollX,s):s+Wc.offsetWidth>t+window.scrollX-2*Vc&&(s=t-Wc.offsetWidth-2*Vc),{x:s,y:o}},Xi=function(){var e,t;!Oc&&(Pc=Bc,Wc)&&(Wc.textContent="",zi(),e=Bc.RTL,{x:e,y:t}=(Wc.style.direction=e?"rtl":"ltr",Wc.style.display="block",Rc=!0,Yi(e)),Wc.style.left=e+"px",Wc.style.top=t+"px")},_h=function(){return jc},Vu=function(e){jc=e},$u=function(){return Yc},Wu=function(e){Yc=e},Ki=function(e){e=(""+e).toLowerCase().trim();var t,i=Xc[e];return i||(i="#"===(i="0x"===e.substring(0,2)?"#"+e.substring(2):e)[0]?i:"#"+i,/^#[0-9a-f]{6}$/.test(i)?i:/^#[0-9a-f]{3}$/.test(i)?["#",i[1],i[1],i[2],i[2],i[3],i[3]].join(""):(t=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/))&&(e=Number(t[1]),i=Number(t[2]),t=Number(t[3]),0<=e)&&e<256&&0<=i&&i<256&&0<=t&&t<256?Ji(e,i,t):null)},Ji=function(e,t,i){return t=e<<16|t<<8|i,e<16?"#"+(16777216|t).toString(16).substr(1):"#"+t.toString(16)},qi=function(e){return(e=Ki(e))?[(e=parseInt(e.substr(1),16))>>16,e>>8&255,255&e]:[0,0,0]},Zi=function(e,t,i){let s=0,o=0,n=0;if(0===t)n=o=s=i;else{var r=Math.floor(e/60),l=e/60-r,a=(e=i*(1-t),i*(1-t*l));switch(t=i*(1-t*(1-l)),r){case 1:s=a,o=i,n=e;break;case 2:s=e,o=i,n=t;break;case 3:s=e,o=a,n=i;break;case 4:s=t,o=e,n=i;break;case 5:s=i,o=e,n=a;break;case 6:case 0:s=i,o=t,n=e}}return Ji(Math.floor(s),Math.floor(o),Math.floor(n))},Qi=function(e,t,i){return(e=Ki(e))&&(t=Ki(t))?(e=qi(e),t=qi(t),Ji(Math.round(t[0]+i*(e[0]-t[0])),Math.round(t[1]+i*(e[1]-t[1])),Math.round(t[2]+i*(e[2]-t[2])))):null},es=function(e){return Zi(e,jc,255*Yc)},ts=function(t,i,s){var o=[],n=t.split(""),r=(n.push(""),0);t=[];let l=null;for(let e=0;e<n.length;e++){var a,c,u=n[e];0===r?"%"===u?((r=t.join(""))&&o.push(r),t.length=0,r=1):(s&&"\n"===u?((a=t.join(""))&&o.push(a),t.length=0,o):t).push(u):1===r?"%"===u?(t.push(u),r=0):i&&"0"<=u&&u<="9"?(r=2,l=u,(u=t.join(""))&&o.push(u),t.length=0):r="{"===u?3:(t.push("%",u),0):2===r?"0"<=u&&u<="9"?l+=u:(c=void 0,o.push(parseInt(null!=(c=l)?c:"",10)),e--,r=0):3===r&&(""===u?(t.splice(0,0,"%{"),e--,r=0):"}"!==u?t.push(u):(r=t.join(""),/[A-Z]\w*/i.test(r)&&(u=(u=r.toUpperCase()).startsWith("BKY_")?u.substring(4):null)&&u in _.Msg$$module$build$src$core$msg?"string"==typeof(r=_.Msg$$module$build$src$core$msg[u])?Array.prototype.push.apply(o,ts(r,i,s)):o.push(i?""+r:r):o.push("%{"+r+"}"),r=t.length=0))}for((i=t.join(""))&&o.push(i),c=[],n=t.length=0;n<o.length;n++)("string"!=typeof o[n]||s&&"\n"===o[n]?((i=t.join(""))&&c.push(i),t.length=0,c):t).push(o[n]);return(i=t.join(""))&&c.push(i),t.length=0,c},is=function(e){return ts(e,!0,!0)},ss=function(e){return"string"!=typeof e?e:(e=ts(e,!1,!1)).length?String(e[0]):""},L=function(t){let i=!0;var s=_.Msg$$module$build$src$core$msg,o=t.match(/%{BKY_[A-Z]\w*}/gi);if(o)for(let e=0;e<o.length;e++)void 0===s[o[e].toUpperCase().slice(6,-1)]&&(console.warn("No message string for "+o[e]+" in "+t),i=!1);return i},os=function(e){var t="string"==typeof e?ss(e):e,i=Number(t);if(!isNaN(i)&&0<=i&&i<=360)return{hue:i,hex:Zi(i,jc,255*Yc)};if(i=Ki(t))return{hue:null,hex:i};throw i='Invalid colour: "'+t+'"',e!==t&&(i+=' (from "'+e+'")'),Error(i)},zu=function(){return al},ju=function(e){null===(al=e)&&null!=(e=document.querySelector("."+tu))&&e.remove()},ns=function(){var e=Zr||document.body,t=document.querySelector("div."+tu);t?al=t:((al=document.createElement("div")).className=tu,al.tabIndex=-1),p(al,"keydown",null,me),e.appendChild(al)},rs=function(e,t,i,s,o=!0){ls(),Zc=e,eu=i,(i=al)&&(i.style.direction=t?"rtl":"ltr",i.style.display="block",!s&&e instanceof A&&(s=null==(t=e.getSourceBlock())?void 0:t.workspace),Qc=null!=s?s:null,iu=(e=null!=s?s:qr).getRenderer().getClassName(),su=e.getTheme().getClassName(),iu&&c(i,iu),su&&c(i,su),o)&&(ou=_.getFocusManager$$module$build$src$core$focus_manager().takeEphemeralFocus(i))},ls=function(){var e;as()&&(Zc=null,e=al)&&(e.style.display="none",e.style.left="",e.style.top="",eu&&(eu(),eu=null),e.textContent="",iu&&(r(e,iu),iu=""),su&&(r(e,su),su=""),qr.markFocused(),ou)&&(ou(),ou=null)},as=function(){return!!Zc},cs=function(e){Zc===e&&ls()},us=function(e){let t=null===Qc,i=e;for(;!t&&i;){if(i===e){t=!0;break}i=e.options.parentWorkspace}t&&ls()},hs=function(e,t,i){al.style.left=e+"px",al.style.top=t+"px",al.style.height=i+"px"},ds=function(e,t,i,s){var o=gs(e,t,i);e=ps(e,t,i,s),o<0?hs(e,0,i.height+o):hs(e,o,i.height)},ps=function(e,t,i,s){return s?Math.min(Math.max(t.right-i.width,e.left),e.right-i.width):Math.max(Math.min(t.left,e.right-i.width),e.left)},gs=function(e,t,i){return t.bottom+i.height>=e.bottom?t.top-i.height:t.bottom},ms=function(e){return!(null==e||!e.repositionForWindowResize)},_s=function(){ms(Zc)&&Zc.repositionForWindowResize()||ls()},Xu=function(){return ru},bs=function(e){ru=e},fs=function(e,t,i,s,o){var n;rs(lu,i,Is,s),t.length?(o=o||(e instanceof PointerEvent?new y(e.clientX,e.clientY):(console.warn("Context menu opened with keyboard but no location given"),new y(0,0))),n=Ts(t,i,e,o),Es(au=n,i,o),setTimeout(function(){n.focus()},1),ru=null):ks()},Ts=function(t,s,o,n){var r,l=new Ia;l.setRole(il.MENU);for(let e=0;e<t.length;e++){let i=t[e];i.separator?l.addChild(new Ca):((r=new ka(i.text)).setRightToLeft(s),r.setRole(il.MENUITEM),l.addChild(r),r.setEnabled(i.enabled),i.enabled&&r.onAction(function(e,t){ks(),requestAnimationFrame(()=>{setTimeout(()=>{i.callback(i.scope,o,t,n)},0)})},{}))}return l},Es=function(e,t,i){var s=xe(),o=(i=new I(i.y+s.top,i.y+s.top,i.x+s.left,i.x+s.left),vs(e),e.getSize());t&&(i.left+=o.width,i.right+=o.width,s.left+=o.width,s.right+=o.width),ds(s,i,o,t),e.focus()},vs=function(e){var t=al;if(!t)throw Error("Attempting to create a context menu when widget div is null");t=e.render(t),c(t,"blocklyContextMenu"),p(t,"contextmenu",null,ys),e.focus()},ys=function(e){e.preventDefault(),e.stopPropagation()},ks=function(){cs(lu),ru=null},Is=function(){au&&(au.dispose(),au=null)},_.callbackFactory$$module$build$src$core$contextmenu=function(i,s){return()=>{_.disable$$module$build$src$core$events$utils();let e;try{e=(s instanceof Element?Bs:jt)(s,i.workspace);var t=i.getRelativeToSurfaceXY();t.x=i.RTL?t.x-_.config$$module$build$src$core$config.snapRadius:t.x+_.config$$module$build$src$core$config.snapRadius,t.y+=2*_.config$$module$build$src$core$config.snapRadius,e.moveBy(t.x,t.y)}finally{_.enable$$module$build$src$core$events$utils()}return U()&&!e.isShadow()&&g(new(m(f.BLOCK_CREATE))(e)),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e),e}},Cs=function(e,t){return(t=Cr(t,e.getParentSvg(),e.getInverseScreenCTM())).x/=e.scale,t.y/=e.scale,t},Ss=function(e,t,i){t=Cs(e,t),pu.set(e,y.difference(i,t))},ws=function(e,t){if(t=Cs(e,t),e=pu.get(e))return y.sum(e,t);throw Error("Drag not initialized")},gh=function(e,t=!1){var i,s=_.createElement$$module$build$src$core$utils$xml("xml"),o=xs(_.allUsedVarModels$$module$build$src$core$variables(e));o.hasChildNodes()&&s.appendChild(o);for(i of e.getTopComments())s.appendChild(As(i,t));for(e=e.getTopBlocks(!0),o=0;o<e.length;o++)s.appendChild(Rs(e[o],t));return s},As=function(e,t=!1){var i=_.createElement$$module$build$src$core$utils$xml("comment"),s=(t||i.setAttribute("id",e.id),t=e.workspace,e.getRelativeToSurfaceXY());return s.x=t.RTL?t.getWidth()-s.x:s.x,i.setAttribute("x",""+s.x),i.setAttribute("y",""+s.y),i.setAttribute("w",""+e.getSize().width),i.setAttribute("h",""+e.getSize().height),e.getText()&&(i.textContent=e.getText()),e.isCollapsed()&&i.setAttribute("collapsed","true"),e.isOwnEditable()||i.setAttribute("editable","false"),e.isOwnMovable()||i.setAttribute("movable","false"),e.isOwnDeletable()||i.setAttribute("deletable","false"),i},xs=function(t){var i=_.createElement$$module$build$src$core$utils$xml("variables");for(let e=0;e<t.length;e++){var s=t[e],o=_.createElement$$module$build$src$core$utils$xml("variable");o.appendChild(_.createTextNode$$module$build$src$core$utils$xml(s.getName())),s.getType()&&o.setAttribute("type",s.getType()),o.id=s.getId(),i.appendChild(o)}return i},Rs=function(e,t){if(e.isInsertionMarker()&&!(e=e.getChildren(!1)[0]))return new DocumentFragment;let i=0;var s;return e.workspace.RTL&&(i=e.workspace.getWidth()),t=$s(e,t),Ks(t)&&(s=e.getRelativeToSurfaceXY(),t.setAttribute("x",String(Math.round(e.workspace.RTL?i-s.x:s.x))),t.setAttribute("y",String(Math.round(s.y)))),t},Os=function(e){var t;return e.isSerializable()?((t=_.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name",e.name||""),e.toXml(t)):null},Ns=function(e,t){for(var i of e.getFields())(e=Os(i))&&t.appendChild(e)},$s=function(e,t){if(e.isInsertionMarker())return(t=e.getChildren(!1)[0])?$s(t):new DocumentFragment;var i,s,o,n=_.createElement$$module$build$src$core$utils$xml(e.isShadow()?"shadow":"block");for(n.setAttribute("type",e.type),t||(n.id=e.id),e.mutationToDom&&(i=e.mutationToDom())&&(i.hasChildNodes()||i.hasAttributes())&&n.appendChild(i),Ns(e,n),(i=e.getCommentText())&&(r=(s=e.getIcon(uc.COMMENT)).getBubbleSize(),a=s.bubbleIsVisible(),s=s.getBubbleLocation(),(o=_.createElement$$module$build$src$core$utils$xml("comment")).appendChild(_.createTextNode$$module$build$src$core$utils$xml(i)),o.setAttribute("pinned",""+a),o.setAttribute("h",""+r.height),o.setAttribute("w",""+r.width),s&&(o.setAttribute("x",""+(e.workspace.RTL?e.workspace.getWidth()-(s.x+r.width):s.x)),o.setAttribute("y",""+s.y)),n.appendChild(o)),e.data&&((i=_.createElement$$module$build$src$core$utils$xml("data")).appendChild(_.createTextNode$$module$build$src$core$utils$xml(e.data)),n.appendChild(i)),i=0;i<e.inputList.length;i++){var r,l=void 0,a=!0;(r=e.inputList[i]).type!==_.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&r.type!==_.inputTypes$$module$build$src$core$inputs$input_types.END_ROW&&(s=r.connection.targetBlock(),r.type===_.inputTypes$$module$build$src$core$inputs$input_types.VALUE?l=_.createElement$$module$build$src$core$utils$xml("value"):r.type===_.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(l=_.createElement$$module$build$src$core$utils$xml("statement")),!(o=r.connection.getShadowDom())||s&&s.isShadow()||l.appendChild(Ls(o,t)),s&&(s=$s(s,t)).nodeType===Jr.ELEMENT_NODE&&(l.appendChild(s),a=!1),l.setAttribute("name",r.name),a||n.appendChild(l))}void 0!==e.inputsInline&&e.inputsInline!==e.inputsInlineDefault&&n.setAttribute("inline",String(e.inputsInline)),e.isCollapsed()&&n.setAttribute("collapsed","true"),e.isEnabled()||n.setAttribute("disabled-reasons",Array.from(e.getDisabledReasons()).map(encodeURIComponent).join(",")),e.isOwnDeletable()||n.setAttribute("deletable","false"),e.isOwnMovable()||n.setAttribute("movable","false"),e.isOwnEditable()||n.setAttribute("editable","false");let c;return(l=e.getNextBlock())&&(i=$s(l,t)).nodeType===Jr.ELEMENT_NODE&&((c=_.createElement$$module$build$src$core$utils$xml("next")).appendChild(i),n.appendChild(c)),!(e=e.nextConnection&&e.nextConnection.getShadowDom())||l&&l.isShadow()||c.appendChild(Ls(e,t)),n},Ls=function(e,t){let i=e=e.cloneNode(!0),s;for(;i;)if(t&&"shadow"===i.nodeName&&i.removeAttribute("id"),i.firstChild)i=i.firstChild;else{for(;i&&!i.nextSibling;){var o;i=(s=i).parentNode,s.nodeType===Jr.TEXT_NODE&&""===s.data.trim()&&(null==(o=i)?void 0:o.firstChild)!==s&&l(s)}i&&(i=(s=i).nextSibling,s.nodeType===Jr.TEXT_NODE)&&""===s.data.trim()&&l(s)}return e},Ms=function(e){return $e(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},ph=function(t){t=Ms(t).split("<");let i="";for(let e=1;e<t.length;e++){var s=t[e];"/"===s[0]&&(i=i.substring(2)),t[e]=i+"<"+s,"/"!==s[0]&&"/>"!==s.slice(-2)&&(i+="  ")}return(t=(t=t.join("\n")).replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>")).replace(/^\n/,"")},lh=function(e,t){return t.setResizesEnabled(!1),t.clear(),e=_.domToWorkspace$$module$build$src$core$xml(e,t),t.setResizesEnabled(!0),e},_.domToWorkspace$$module$build$src$core$xml=function(i,s){let o=0;s.RTL&&(o=s.getWidth());var n=[],e=(X(),_.getGroup$$module$build$src$core$events$utils());e||_.setGroup$$module$build$src$core$events$utils(!0),s.setResizesEnabled&&s.setResizesEnabled(!1);let r=!0;try{for(let e=0,t;t=i.childNodes[e];e++){var l=t.nodeName.toLowerCase(),a=t;if("block"===l||"shadow"===l&&!Cl){var c,u,h=Bs(a,s),d=(n.push(h.id),parseInt(null!=(c=a.getAttribute("x"))?c:"10",10)),p=parseInt(null!=(u=a.getAttribute("y"))?u:"10",10);isNaN(d)||isNaN(p)||h.moveBy(s.RTL?o-d:d,p,["create"]),r=!1}else{if("shadow"===l)throw TypeError("Shadow block cannot be a top-level block.");if("comment"===l)Ds(a,s);else if("variables"===l){if(!r)throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");Ps(a,s),r=!1}}}}finally{_.setGroup$$module$build$src$core$events$utils(e),s.setResizesEnabled&&s.setResizesEnabled(!0),s.rendered&&it(),K()}return g(new(m(f.FINISHED_LOADING))(s)),n},Ds=function(e,t){var i,s,o=null!=(n=e.getAttribute("id"))?n:void 0,n=new(t.rendered?ku:yu)(t,o);return n.setText(null!=(o=e.textContent)?o:""),o=parseInt(null!=(i=e.getAttribute("x"))?i:"",10),i=parseInt(null!=(s=e.getAttribute("y"))?s:"",10),isNaN(o)||isNaN(i)||(o=t.RTL?t.getWidth()-o:o,n.moveTo(new y(o,i))),t=parseInt(null!=(s=e.getAttribute("w"))?s:"",10),s=parseInt(null!=(o=e.getAttribute("h"))?o:"",10),isNaN(t)||isNaN(s)||n.setSize(new C(t,s)),"true"===e.getAttribute("collapsed")&&n.setCollapsed(!0),"false"===e.getAttribute("editable")&&n.setEditable(!1),"false"===e.getAttribute("movable")&&n.setMovable(!1),"false"===e.getAttribute("deletable")&&n.setDeletable(!1),n},eh=function(s,o){if(!o.getBlocksBoundingBox)return _.domToWorkspace$$module$build$src$core$xml(s,o);var e=o.getBlocksBoundingBox();if(s=_.domToWorkspace$$module$build$src$core$xml(s,o),e&&e.top!==e.bottom){var n=e.bottom,e=o.RTL?e.right:e.left,r=1/0;let t=-1/0,i=1/0;for(let e=0;e<s.length;e++){var l=o.getBlockById(s[e]).getRelativeToSurfaceXY();l.y<i&&(i=l.y),l.x<r&&(r=l.x),l.x>t&&(t=l.x)}for(n=n-i+10,e=o.RTL?e-t:e-r,r=0;r<s.length;r++)o.getBlockById(s[r]).moveBy(e,n,["create"])}return s},_.domToBlock$$module$build$src$core$xml=function(e,t){return e=Bs(e,t),t.rendered&&it(),e},Bs=function(e,i){_.disable$$module$build$src$core$events$utils();var t=i.getAllVariables();let s;try{if(s=Ys(e,i),i.rendered){let e=s,t=s.getDescendants(!1);e.setConnectionTracking(!1);for(let e=t.length-1;0<=e;e--)t[e].initSvg();for(let e=t.length-1;0<=e;e--)t[e].queueRender();setTimeout(function(){e.disposed||e.setConnectionTracking(!0)},1),i.resizeContents()}else{var o=s.getDescendants(!1);for(let e=o.length-1;0<=e;e--)o[e].initModel()}}finally{_.enable$$module$build$src$core$events$utils()}if(U()){for(e=$t(i,t),i=0;i<e.length;i++)t=e[i],g(new(m(f.VAR_CREATE))(t));g(new(m(f.BLOCK_CREATE))(s))}return s},Ps=function(t,i){for(let e=0;e<t.children.length;e++){var s=t.children[e],o=s.getAttribute("type"),n=s.getAttribute("id");if(!(s=s.textContent))break;i.getVariableMap().createVariable(s,null!=o?o:void 0,n)}},Fs=function(t){var i={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let e=0;e<t.children.length;e++){var s=t.children[e];if(s.nodeType!==Jr.TEXT_NODE)switch(s.nodeName.toLowerCase()){case"mutation":i.mutation.push(s);break;case"comment":i.comment.push(s);break;case"data":i.data.push(s);break;case"title":case"field":i.field.push(s);break;case"value":case"statement":i.input.push(s);break;case"next":i.next.push(s);break;default:console.warn("Ignoring unknown tag: "+s.nodeName)}}return i},Us=function(t,i){let s=!1;for(let e=0;e<t.length;e++){var o=t[e];i.domToMutation&&(i.domToMutation(o),i.initSvg)&&(s=!0)}return s},Hs=function(u,h){for(let c=0;c<u.length;c++){let e=u[c],t=e.textContent,i="true"===e.getAttribute("pinned");let s=parseInt(null!=(d=e.getAttribute("w"))?d:"50",10);var d=parseInt(null!=(d=e.getAttribute("h"))?d:"50",10);let o,n=parseInt(null!=(o=e.getAttribute("x"))?o:"",10),r,l=parseInt(null!=(r=e.getAttribute("y"))?r:"",10),a=(h.setCommentText(t),h.getIcon(uc.COMMENT));isNaN(s)||isNaN(d)||a.setBubbleSize(new C(s,d)),a.setBubbleVisible(i),setTimeout(()=>{isNaN(n)||isNaN(l)||(n=h.workspace.RTL?h.workspace.getWidth()-(n+s):n,a.setBubbleLocation(new y(n,l))),a.setBubbleVisible(i)},1)}},Gs=function(t,i){for(let e=0;e<t.length;e++)i.data=t[e].textContent},Vs=function(t,i){for(let e=0;e<t.length;e++){var s=t[e],o=s.getAttribute("name");o?Xs(i,o,s):console.warn("Ignoring unnamed field in block "+i.type)}},Ws=function(t){let i=null,s=null;for(let e=0;e<t.childNodes.length;e++){var o=t.childNodes[e];Ks(o)&&("block"===o.nodeName.toLowerCase()?i=o:"shadow"===o.nodeName.toLowerCase()&&(s=o))}return{childBlockElement:i,childShadowElement:s}},zs=function(t,i,s,o){for(let e=0;e<t.length;e++){var n=t[e],r=n.getAttribute("name"),l=r?s.getInput(r):null;if(!l){console.warn("Ignoring non-existent input "+r+" in block "+o);break}if((n=Ws(n)).childBlockElement){if(!l.connection)throw TypeError("Input connection does not exist.");Ys(n.childBlockElement,i,l.connection,!1)}n.childShadowElement&&null!=(r=l.connection)&&r.setShadowDom(n.childShadowElement)}},js=function(t,i,s){for(let e=0;e<t.length;e++){var o=Ws(t[e]);if(o.childBlockElement){if(!s.nextConnection)throw TypeError("Next statement does not exist.");if(s.nextConnection.isConnected())throw TypeError("Next statement is already connected.");Ys(o.childBlockElement,i,s.nextConnection,!0)}o.childShadowElement&&s.nextConnection&&s.nextConnection.setShadowDom(o.childShadowElement)}},Ys=function(e,t,i,s){var o=e.getAttribute("type");if(!o)throw TypeError("Block type unspecified: "+e.outerHTML);var n=null!=(r=e.getAttribute("id"))?r:void 0,r=t.newBlock(o,n),n=Fs(e),l=Us(n.mutation,r);if(Hs(n.comment,r),Gs(n.data,r),i)if(s){if(!r.previousConnection)throw TypeError("Next block does not have previous statement.");i.connect(r.previousConnection)}else if(r.outputConnection)i.connect(r.outputConnection);else{if(!r.previousConnection)throw TypeError("Child block does not have output or previous statement.");i.connect(r.previousConnection)}if(Vs(n.field,r),zs(n.input,t,r,o),js(n.next,t,r),l&&r.initSvg(),(t=e.getAttribute("inline"))&&r.setInputsInline("true"===t),(t=e.getAttribute("disabled"))&&r.setDisabledReason("true"===t||"disabled"===t,Aa),null!==(t=e.getAttribute("disabled-reasons")))for(var a of t.split(","))r.setDisabledReason(!0,decodeURIComponent(a));if((a=e.getAttribute("deletable"))&&r.setDeletable("true"===a),(a=e.getAttribute("movable"))&&r.setMovable("true"===a),(a=e.getAttribute("editable"))&&r.setEditable("true"===a),(a=e.getAttribute("collapsed"))&&r.setCollapsed("true"===a),"shadow"===e.nodeName.toLowerCase()){for(e=r.getChildren(!1),a=0;a<e.length;a++)if(!e[a].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");r.setShadow(!0)}return r},Xs=function(e,t,i){var s=e.getField(t);s?s.fromXml(i):console.warn("Ignoring non-existent field "+t+" in block "+e.type)},ch=function(t){for(let e=0;e<t.childNodes.length;e++){var i=t.childNodes[e];if("next"===i.nodeName.toLowerCase()){t.removeChild(i);break}}},Ks=function(e){return e.nodeType===Jr.ELEMENT_NODE},qh=function(e,t){o(b.FIELD,e,t)},Dh=function(e){cr(b.FIELD,e)},_.fromJson$$module$build$src$core$field_registry=function(e){return Nu.fromJsonInternal(e)},Lh=function(e){var t=pr(b.FIELD,e.type);return t?t.fromJson(e):(console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},Js=function(e){return e&&"object"==typeof e&&"src"in e&&"string"==typeof e.src&&"alt"in e&&"string"==typeof e.alt&&"width"in e&&"number"==typeof e.width&&"height"in e&&"number"==typeof e.height},_.register$$module$build$src$core$extensions=function(e,t){if("string"!=typeof e||""===e.trim())throw Error('Error: Invalid extension name "'+e+'"');if(Gu[e])throw Error('Error: Extension "'+e+'" is already registered.');if("function"!=typeof t)throw Error('Error: Extension "'+e+'" must be a function');Gu[e]=t},_.registerMixin$$module$build$src$core$extensions=function(e,t){if(!t||"object"!=typeof t)throw Error('Error: Mixin "'+e+'" must be a object');_.register$$module$build$src$core$extensions(e,function(){this.mixin(t)})},_.registerMutator$$module$build$src$core$extensions=function(e,t,i,s){var o='Error when registering mutator "'+e+'": ';oo(o,t);let n=io(t,o);if(i&&"function"!=typeof i)throw Error(o+'Extension "'+e+'" is not a function');_.register$$module$build$src$core$extensions(e,function(){n&&this.setMutator(new _.MutatorIcon$$module$build$src$core$icons$mutator_icon(s||[],this)),this.mixin(t),i&&i.apply(this)})},M=function(e){qs(e)?delete Gu[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},qs=function(e){return!!Gu[e]},Zs=function(e,t,i){var s=Gu[e];if("function"!=typeof s)throw Error('Error: Extension "'+e+'" not found.');let o;if(i?Qs(e,t):o=no(t),s.apply(t),i)oo('Error after applying mutator "'+e+'": ',t);else if(!ro(o,t))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},Qs=function(e,t){if(no(t).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+t.id)},eo=function(e,t){return so(e.mutationToDom,e.domToMutation,t+" mutationToDom/domToMutation")},to=function(e,t){return so(e.saveExtraState,e.loadExtraState,t+" saveExtraState/loadExtraState")},io=function(e,t){return so(e.compose,e.decompose,t+" compose/decompose")},so=function(e,t,i){if(e&&t){if("function"!=typeof e||"function"!=typeof t)throw Error(i+" must be a function");return!0}if(e||t)throw Error(i+"Must have both or neither functions");return!1},oo=function(e,t){var i=eo(t,e),s=to(t,e);if(!i&&!s)throw Error(e+"Mutations must contain either XML hooks, or JSON hooks, or both");io(t,e)},no=function(e){var t=[];return void 0!==e.domToMutation&&t.push(e.domToMutation),void 0!==e.mutationToDom&&t.push(e.mutationToDom),void 0!==e.saveExtraState&&t.push(e.saveExtraState),void 0!==e.loadExtraState&&t.push(e.loadExtraState),void 0!==e.compose&&t.push(e.compose),void 0!==e.decompose&&t.push(e.decompose),t},ro=function(t,i){if((i=no(i)).length!==t.length)return!1;for(let e=0;e<i.length;e++)if(t[e]!==i[e])return!1;return!0},Yh=function(t){if("object"!=typeof document)throw Error("runAfterPageLoad() requires browser document.");if("complete"===document.readyState)t();else{let e=setInterval(function(){"complete"===document.readyState&&(clearInterval(e),t())},10)}},_.buildTooltipForDropdown$$module$build$src$core$extensions=function(t,i){let e=[];return function(){e.includes(this.type)||(lo(this,t,i),e.push(this.type)),this.setTooltip(function(){var e=String(this.getFieldValue(t));return ss(i[e])}.bind(this))}},lo=function(e,t,i){var s=e.getField(t);if(s instanceof Lu&&!s.isOptionListDynamic())for(var o of s=s.getOptions())o!==Lu.SEPARATOR&&([,s]=o,void 0===i[s])&&console.warn(`No tooltip mapping for value ${s} of field `+`${t} of block type ${e.type}.`)},_.buildTooltipWithFieldText$$module$build$src$core$extensions=function(t,i){return function(){this.setTooltip(function(){var e=this.getField(i);return ss(t).replace("%1",e?e.getText():"")}.bind(this))}},Gh=function(){let t=this.tooltip;this.setTooltip(function(){var e=this.getParent();return e&&e.getInputsInline()&&e.tooltip||t}.bind(this))},u=function(e,t){return" "+e+","+t+" "},ao=function(e,t){return" "+e+t.join("")},co=function(e,t){return" M "+e+","+t+" "},uo=function(e,t){return" m "+e+","+t+" "},ho=function(e,t){return" l "+e+","+t+" "},po=function(e){return" l"+e.join("")},h=function(e,t){return" "+e+" "+t+" "},go=function(e,t,i,s){return e+" "+i+" "+i+" "+t+s},mo=function(e,t){if(!e||!t)throw Error("Cannot connect null connections.");(e.targetConnection=t).targetConnection=e},_o=function(i,s){let o=null;var n=null==(s=s.outputConnection)?void 0:s.getConnectionChecker();for(let e=0,t;t=i.inputList[e];e++){var r=t.connection;if(r&&null!=n&&n.canConnect(s,r,!1)){if(o)return null;o=r}}return o},bo=function(e,t){for(var i;i=_o(e,t);)if(!(e=i.targetBlock())||e.isShadow())return i;return null},fo=function(e){return Q(e)&&"function"==typeof e.getType&&"function"==typeof e.initView&&"function"==typeof e.dispose&&"function"==typeof e.getWeight&&"function"==typeof e.getSize&&"function"==typeof e.applyColour&&"function"==typeof e.hideForInsertionMarker&&"function"==typeof e.updateEditable&&"function"==typeof e.updateCollapsed&&"function"==typeof e.isShownWhenCollapsed&&"function"==typeof e.setOffsetInBlock&&"function"==typeof e.onLocationChange&&"function"==typeof e.onClick},To=function(e){return fo(e)&&ni(e)&&Qe(e)&&"function"==typeof e.setText&&"function"==typeof e.getText&&"function"==typeof e.setBubbleSize&&"function"==typeof e.getBubbleSize&&"function"==typeof e.setBubbleLocation&&"function"==typeof e.getBubbleLocation&&e.getType()===uc.COMMENT},Eo=function(e){var t,i,s,o;100<e.getDescendants(!1).length||(t=e.workspace,o=e.getSvgRoot(),t.getAudioManager().play("delete"),i=e.getRelativeToSurfaceXY(),(s=o.cloneNode(!0)).setAttribute("transform","translate("+i.x+","+i.y+")"),null!=(o=t.getLayerManager())&&o.appendToAnimationLayer({getSvgRoot:()=>s}),vo(s,{x:i.x,y:i.y,width:e.width,height:e.height},t.RTL,new Date))},vo=function(e,t,i,s){var o=((new Date).getTime()-s.getTime())/150;1<o?l(e):(e.setAttribute("transform","translate("+(t.x+(i?-1:1)*t.width/2*o)+","+(t.y+t.height/2*o)+") scale("+(1-o)+")"),setTimeout(vo,10,e,t,i,s))},yo=function(e){var t,i,s=e.workspace,o=s.scale;s.getAudioManager().play("click"),o<1||(t=s.getSvgXY(e.getSvgRoot()),e.outputConnection?(t.x+=(e.RTL?3:-3)*o,t.y+=13*o):e.previousConnection&&(t.x+=(e.RTL?-23:23)*o,t.y+=3*o),i=a(k.CIRCLE,{cx:t.x,cy:t.y,r:0,fill:"none",stroke:"#888","stroke-width":10},s.getParentSvg()),e=a(k.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*o},i),s=a(k.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},i),e.beginElement(),s.beginElement(),setTimeout(()=>{l(i)},150))},ko=function(e){var t;Co(),e.workspace.getAudioManager().play("disconnect"),e.workspace.scale<1||(t=e.getHeightWidth().height,t=Math.atan(10/t)/Math.PI*180,e.RTL||(t*=-1),Io(rh=e,t,new Date,0))},Io=function(e,t,i,s){var o=[.66,1,.66,0,-.66,-1,-.66,0];let n="";i.getTime()+200>(new Date).getTime()&&(n=`skewX(${Math.round(o[s%o.length]*t)})`,nh=setTimeout(Io,15,e,t,i,s+1)),e.getSvgRoot().setAttribute("transform",e.getTranslation()+" "+n)},Co=function(){rh&&(nh&&(clearTimeout(nh),nh=null),rh.getSvgRoot().setAttribute("transform",rh.getTranslation()),rh=null)},So=function(t,e){for(var i=t.workspace,s=_.config$$module$build$src$core$config.snapRadius,o=y.difference(e,t.getRelativeToSurfaceXY()),n=new y(0,0),r=i.getAllBlocks(!1).filter(e=>e.id!=t.id).map(e=>e.getRelativeToSurfaceXY());wo(y.sum(e,n),r)||Ao(t,y.sum(o,n),s);)i.RTL?n.translate(-s,2*s):n.translate(s,2*s);t.moveTo(y.sum(e,n))},wo=function(t,e){return e.some(e=>Math.abs(e.x-t.x)<=1&&Math.abs(e.y-t.y)<=1)},Ao=function(e,t,i){return e.getConnections_(!1).some(e=>!!e.closest(i,t).connection)},xo=function(e,t,i){var s=i.getBoundingRectangle(),o=s.right-s.left,n=li(t.top,s.top,t.top+t.height-(s.bottom-s.top))-s.top;let r=t.left;return t=t.left+t.width-o,e.RTL?r=Math.min(t,r):t=Math.max(r,t),!(!(e=li(r,s.left,t)-s.left)&&!n||(i.moveBy(e,n,["inbounds"]),0))},Ro=function(o){return e=>{var t,i,s=o.getMetricsManager();s.hasFixedEdges()&&!o.isDragging()&&(El.includes(null!=(t=e.type)?t:"")?(t=s.getScrollMetrics(!0),(i=Oo(o,e))&&(s=_.getGroup$$module$build$src$core$events$utils()||!1,_.setGroup$$module$build$src$core$events$utils(e.group),xo(o,t,i)&&!e.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),_.setGroup$$module$build$src$core$events$utils(s))):Dr(e)&&e.scale&&e.oldScale&&e.scale>e.oldScale&&No(o))}},Oo=function(e,t){let i=null;switch(t.type){case f.BLOCK_CREATE:case f.BLOCK_MOVE:i=(i=e.getBlockById(t.blockId))&&i.getRootBlock();break;case f.COMMENT_CREATE:case f.COMMENT_MOVE:case f.COMMENT_RESIZE:i=e.getCommentById(t.commentId)}return i},No=function(i){if((s=i.getMetricsManager()).hasFixedEdges()&&!i.isDragging()){var s=s.getScrollMetrics(!0),o=i.getTopBoundedElements();for(let e=0,t;t=o[e];e++)xo(i,s,t)}},$o=function(e){return e&&"function"==typeof e.isDeletable&&"function"==typeof e.dispose&&"function"==typeof e.setDeleteStyle},Lo=function(e,t){var i,s,o=e.getIcons();for(i of e.inputList)i.isVisible()&&(o.push(...i.fieldRow),null!=(s=i.connection)&&s.targetBlock()?(e=i.connection.targetBlock(),(i.connection.type!==E.NEXT_STATEMENT||t||(e=null==(s=e.lastConnectionInStack(!1))?void 0:s.getSourceBlock()))&&o.push(e)):(null==(s=i.connection)?void 0:s.type)===E.INPUT_VALUE&&o.push(i.connection));return o},Mo=function(e,t){var i=e.workspace.getTopBoundedElements(!0).filter(e=>Q(e));let s=null;return 0<=(e=i.indexOf(e instanceof N?e.getRootBlock():e)+t)&&e<i.length?s=i[e]:e<0?s=i[i.length-1]:e>=i.length&&(s=i[0]),t<0&&s instanceof N&&null!=(i=null==(e=s.lastConnectionInStack(!1))?void 0:e.getSourceBlock())?i:s},Do=function(e,t){var i,s=e instanceof N?null!=(s=null==(i=e.outputConnection)?void 0:i.targetBlock())?s:e.getSurroundParent():e.getSourceBlock();return s instanceof N&&-1!==(e=(i=Lo(s,0<t)).indexOf(e))&&0<=(t=e+t)&&t<i.length?i[t]:null},Bo=function(e){return e&&"function"==typeof e.getRelativeToSurfaceXY&&"function"==typeof e.isMovable&&"function"==typeof e.startDrag&&"function"==typeof e.drag&&"function"==typeof e.endDrag&&"function"==typeof e.revertDrag},Po=function(e){return e&&"function"==typeof e.autoHide},pp=function(e,t){o(b.ICON,e.toString(),t)},dp=function(e){cr(b.ICON,e)},Fo=function(e){return"function"==typeof e.getProcedureModel&&"function"==typeof e.doProcedureUpdate&&"function"==typeof e.isProcedureDef},Uo=function(e){return e&&"function"==typeof e.startPublishing&&"function"==typeof e.stopPublishing},Ho=function(e){let t=e.getProcedureMap().getProcedures().filter(e=>!e.getReturnTypes()).map(e=>[e.getName(),e.getParameters().map(e=>e.getName()),!1]),i=(e.getBlocksByType("procedures_defnoreturn",!1).forEach(e=>{!Fo(e)&&dt(e)&&t.push(e.getProcedureDef())}),e.getProcedureMap().getProcedures().filter(e=>!!e.getReturnTypes()).map(e=>[e.getName(),e.getParameters().map(e=>e.getName()),!0]));return e.getBlocksByType("procedures_defreturn",!1).forEach(e=>{!Fo(e)&&dt(e)&&i.push(e.getProcedureDef())}),t.sort(Go),i.sort(Go),[t,i]},Go=function(e,t){return e[0].localeCompare(t[0],void 0,{sensitivity:"base"})},_.findLegalName$$module$build$src$core$procedures=function(e,t){if(!t.isInFlyout)for(e=e||_.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!Vo(e,t.workspace,t);){var i=e.match(/^(.*?)(\d+)$/);e=i?i[1]+(parseInt(i[2])+1):e+"2"}return e},Vo=function(e,t,i){return!Wo(e,t,i)},Wo=function(e,t,i){for(var s of t.getAllBlocks(!1))if(s!==i&&dt(s)&&_.Names$$module$build$src$core$names.equals(s.getProcedureDef()[0],e))return!0;i=!i||!Fo(i)||null==i?void 0:i.getProcedureModel();for(var o of t.getProcedureMap().getProcedures())if(o!==i&&_.Names$$module$build$src$core$names.equals(o.getName(),e))return!0;return!1},_.rename$$module$build$src$core$procedures=function(e){var t=this.getSourceBlock();if(!t)throw new qc;e=e.trim();var i=_.findLegalName$$module$build$src$core$procedures(e,t),s=(Fo(t)&&!t.isInsertionMarker()&&t.getProcedureModel().setName(i),this.getValue());if(s!==e&&s!==i)for(e=t.workspace.getAllBlocks(!1),t=0;t<e.length;t++){var o=e[t];o.renameProcedure&&o.renameProcedure(s,i)}return i},zo=function(e){function t(t,i){for(let e=0;e<t.length;e++){var s=t[e][0],o=t[e][1],n=_.createElement$$module$build$src$core$utils$xml("block"),r=(n.setAttribute("type",i),n.setAttribute("gap","16"),_.createElement$$module$build$src$core$utils$xml("mutation"));for(r.setAttribute("name",s),n.appendChild(r),s=0;s<o.length;s++){var l=_.createElement$$module$build$src$core$utils$xml("arg");l.setAttribute("name",o[s]),r.appendChild(l)}a.push(n)}}let a=[];var i,s;return Hr.procedures_defnoreturn&&((i=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_defnoreturn"),i.setAttribute("gap","16"),(s=_.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),s.appendChild(_.createTextNode$$module$build$src$core$utils$xml(_.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),i.appendChild(s),a.push(i)),Hr.procedures_defreturn&&((i=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_defreturn"),i.setAttribute("gap","16"),(s=_.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),s.appendChild(_.createTextNode$$module$build$src$core$utils$xml(_.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),i.appendChild(s),a.push(i)),Hr.procedures_ifreturn&&((i=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","procedures_ifreturn"),i.setAttribute("gap","16"),a.push(i)),a.length&&a[a.length-1].setAttribute("gap","24"),t((e=Ho(e))[0],"procedures_callnoreturn"),t(e[1],"procedures_callreturn"),a},jo=function(e){return Yo(e,!1)},Yo=function(e,t=!0){function i(e,t){for(var[i,s]of e)o.push({kind:"block",type:t,gap:16,extraState:{name:i,params:s}})}if(t)return mt("The XML return value of Blockly.Procedures.flyoutCategory()","v12","v13","the same method, but handle a return type of FlyoutItemInfo[] (JSON) instead."),zo(e);let o=[];return Hr.procedures_defnoreturn&&o.push({kind:"block",type:"procedures_defnoreturn",gap:16,fields:{NAME:_.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE}}),Hr.procedures_defreturn&&o.push({kind:"block",type:"procedures_defreturn",gap:16,fields:{NAME:_.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE}}),Hr.procedures_ifreturn&&o.push({kind:"block",type:"procedures_ifreturn",gap:16}),o.length&&(o[o.length-1].gap=24),i((e=Ho(e))[0],"procedures_callnoreturn"),i(e[1],"procedures_callreturn"),o},Xo=function(e){var i=[],s=e.getBlocksByType("procedures_mutatorarg",!1);for(let e=0,t;t=s[e];e++)i.push(t.getFieldValue("NAME"));var s=_.createElement$$module$build$src$core$utils$xml("xml"),t=_.createElement$$module$build$src$core$utils$xml("block"),o=(t.setAttribute("type","procedures_mutatorarg"),_.createElement$$module$build$src$core$utils$xml("field"));o.setAttribute("name","NAME"),i=kt(_.DEFAULT_ARG$$module$build$src$core$procedures,i),i=_.createTextNode$$module$build$src$core$utils$xml(i),o.appendChild(i),t.appendChild(o),s.appendChild(t),e.updateToolbox(s)},Ko=function(e){var t;Mr(e)&&"mutator"===e.bubbleType&&e.isOpen&&e.blockId&&("procedures_defnoreturn"!==(t=(e=ie(e.workspaceId).getBlockById(e.blockId)).type)&&"procedures_defreturn"!==t||(e=e.getIcon(_.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),Xo(e),e.addChangeListener(Jo)))},Jo=function(e){(xr(e)||Rr(e)||Or(e)||Nr(e))&&(e=ie(e.workspaceId),Xo(e))},qo=function(t,e){return e.getAllBlocks(!1).filter(e=>Zo(e,t)||pt(e)&&_.Names$$module$build$src$core$names.equals(e.getProcedureCall(),t))},Zo=function(e,t){return Fo(e)&&!e.isProcedureDef()&&e.getProcedureModel()&&_.Names$$module$build$src$core$names.equals(e.getProcedureModel().getName(),t)},_.mutateCallers$$module$build$src$core$procedures=function(i){var s=Cl,o=i.getProcedureDef()[0],n=i.mutationToDom(!0);i=qo(o,i.workspace);for(let e=0,t;t=i[e];e++){o=(o=t.mutationToDom())&&$e(o),t.domToMutation&&t.domToMutation(n);var r=t.mutationToDom();o!==(r=r&&$e(r))&&(_.setRecordUndo$$module$build$src$core$events$utils(!1),g(new(m(f.BLOCK_CHANGE))(t,"mutation",null,o,r)),_.setRecordUndo$$module$build$src$core$events$utils(s))}},_.getDefinition$$module$build$src$core$procedures=function(e,t){for(var i of t.getAllBlocks(!1))if(Fo(i)&&i.isProcedureDef()&&_.Names$$module$build$src$core$names.equals(i.getProcedureModel().getName(),e)||dt(i)&&_.Names$$module$build$src$core$names.equals(i.getProcedureDef()[0],e))return i;return null},Qo=function(e){return e.isDynamic},en=function(e){return void 0!==e.pathDown&&void 0!==e.pathUp},tn=function(e){return void 0!==e.pathLeft&&void 0!==e.pathRight},sn=function(e,t){o(b.RENDERER,e,t)},Rp=function(e){cr(b.RENDERER,e)},on=function(e,t,i){return(e=new(dr(b.RENDERER,e))(e)).init(t,i),e},nn=function(e){It(e.getTargetWorkspace(),void 0,"String")},rn=function(e){It(e.getTargetWorkspace(),void 0,"Number")},ln=function(e){It(e.getTargetWorkspace(),void 0,"Colour")},an=function(e){return cn(e,!1)},cn=function(e,t=!0){return Hr.variables_set_dynamic||Hr.variables_get_dynamic||console.warn("There are no dynamic variable blocks, but there is a dynamic variable category."),t?(mt("The XML return value of Blockly.VariablesDynamic.flyoutCategory()","v12","v13","the same method, but handle a return type of FlyoutItemInfo[] (JSON) instead."),un(e)):(e.registerButtonCallback("CREATE_VARIABLE_STRING",nn),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",rn),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",ln),[{kind:"button",text:_.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE,callbackkey:"CREATE_VARIABLE_STRING"},{kind:"button",text:_.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE,callbackkey:"CREATE_VARIABLE_NUMBER"},{kind:"button",text:_.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE,callbackkey:"CREATE_VARIABLE_COLOUR"},...Tt(e,e.getVariableMap().getAllVariables(),!1,"variables_get_dynamic","variables_set_dynamic")])},un=function(e){let t=[],i=document.createElement("button");return i.setAttribute("text",_.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),t.push(i),(i=document.createElement("button")).setAttribute("text",_.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),t.push(i),(i=document.createElement("button")).setAttribute("text",_.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),i.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),t.push(i),e.registerButtonCallback("CREATE_VARIABLE_STRING",nn),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",rn),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",ln),e=hn(e),t=t.concat(e)},hn=function(i){i=i.getVariableMap().getAllVariables();var s,e,o=[];if(0<i.length&&(Hr.variables_set_dynamic&&(s=i[i.length-1],(e=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_set_dynamic"),e.setAttribute("gap","24"),e.appendChild(Ot(s)),o.push(e)),Hr.variables_get_dynamic)){i.sort(Lt);for(let e=0,t;t=i[e];e++)(s=_.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type","variables_get_dynamic"),s.setAttribute("gap","8"),s.appendChild(Ot(t)),o.push(s)}return o},dn=function(e,t){var i=e.toCopyData();return Xd=i,Kd=ee(e)&&e.workspace instanceof wd?e.workspace:null,Jd=t,i},Np=function(){return Xd},zp=function(e){Xd=e},Lp=function(){return Kd},Yp=function(e){Kd=e},$p=function(){return Jd},jp=function(e){Jd=e},pn=function(e,t,i){return e&&t?gn(e,t,i):Xd&&Kd?gn(Xd,Kd,Jd):null},gn=function(e,t,i){var s;return t=!t.isMutator&&null!=(s=t.options.parentWorkspace)?s:t,null!=(s=null==(s=pr(b.PASTER,e.paster,!1))?void 0:s.paste(e,t,i))?s:null},mn=function(e){return e&&"function"==typeof e.toCopyData},_n=function(){v.registry.register({name:Kh.ESCAPE,preconditionFn(e){return!e.isReadOnly()},callback(e){return e.hideChaff(),!0},keyCodes:[s.ESC]})},bn=function(){v.registry.register({name:Kh.DELETE,preconditionFn(e,t){return t=t.focusedNode,!e.isReadOnly()&&null!=t&&$o(t)&&t.isDeletable()&&!e.isDragging()&&!_.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()},callback(e,t,i,s){return t.preventDefault(),(e=s.focusedNode)instanceof N?e.checkAndDelete():$o(e)&&e.isDeletable()&&(_.setGroup$$module$build$src$core$events$utils(!0),e.dispose(),_.setGroup$$module$build$src$core$events$utils(!1)),!0},keyCodes:[s.DELETE,s.BACKSPACE]})},fn=function(e){return!!(mn(e)&&$o(e)&&Bo(e))&&(e.isCopyable?e.isCopyable():e instanceof N||e instanceof ku?e.isOwnDeletable()&&e.isOwnMovable():e.isDeletable()&&e.isMovable())},Tn=function(e){return fn(e)&&$o(e)&&e.isDeletable()},En=function(){var e=v.registry.createSerializedKey(s.C,[s.CTRL]),t=v.registry.createSerializedKey(s.C,[s.META]);v.registry.register({name:Kh.COPY,preconditionFn(e,t){return t=t.focusedNode,e=e.isFlyout?e.targetWorkspace:e,!!t&&!!e&&!e.isDragging()&&!_.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()&&fn(t)},callback(e,t,i,s){return t.preventDefault(),!!((t=s.focusedNode)&&mn(t)&&fn(t))&&!!(e=e.isFlyout?e.targetWorkspace:e)&&(t.workspace.isFlyout||e.hideChaff(),e=Bo(t)&&t.workspace==e?t.getRelativeToSurfaceXY():void 0,!!dn(t,e))},keyCodes:[e,t]})},vn=function(){var e=v.registry.createSerializedKey(s.X,[s.CTRL]),t=v.registry.createSerializedKey(s.X,[s.META]);v.registry.register({name:Kh.CUT,preconditionFn(e,t){return!!(t=t.focusedNode)&&!e.isReadOnly()&&!e.isDragging()&&!_.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()&&Tn(t)},callback(e,t,i,s){return!!((e=s.focusedNode)&&Tn(e)&&mn(e))&&(t=Bo(e)?e.getRelativeToSurfaceXY():void 0,t=dn(e,t),e instanceof N?e.checkAndDelete():$o(e)&&e.dispose(),!!t)},keyCodes:[e,t]})},yn=function(){var e=v.registry.createSerializedKey(s.V,[s.CTRL]),t=v.registry.createSerializedKey(s.V,[s.META]);v.registry.register({name:Kh.PASTE,preconditionFn(){var e=Kd;return!(!e||!e.rendered||(e=e.isFlyout?e.targetWorkspace:e,!Xd)||!e||e.isReadOnly()||e.isDragging()||_.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken())},callback(e,t){if(!(e=Xd))return!1;var i=Kd;if(!i)return!1;if(!(i=i.isFlyout?i.targetWorkspace:i)||i.isReadOnly())return!1;if(t instanceof PointerEvent)t=Oe(i,new y(t.clientX,t.clientY));else{if(!(t=Jd))return!!pn(e,i);var{left:s,top:o,width:n,height:r}=i.getMetricsManager().getViewMetrics(!0);if(new I(o,o+r,s,s+n).contains(t.x,t.y))return!!pn(e,i);t=new y(s+n/2,o+r/2)}return!!pn(e,i,t)},keyCodes:[e,t]})},kn=function(){var e=v.registry.createSerializedKey(s.Z,[s.CTRL]),t=v.registry.createSerializedKey(s.Z,[s.META]);v.registry.register({name:Kh.UNDO,preconditionFn(e){return!e.isReadOnly()&&!e.isDragging()&&!_.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()},callback(e,t){return e.hideChaff(),e.undo(!1),t.preventDefault(),!0},keyCodes:[e,t]})},In=function(){var e=v.registry.createSerializedKey(s.Z,[s.CTRL,s.SHIFT]),t=v.registry.createSerializedKey(s.Z,[s.META,s.SHIFT]),i=v.registry.createSerializedKey(s.Y,[s.CTRL]);v.registry.register({name:Kh.REDO,preconditionFn(e){return!e.isDragging()&&!e.isReadOnly()&&!_.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()},callback(e,t){return e.hideChaff(),e.undo(!0),t.preventDefault(),!0},keyCodes:[e,t,i]})},qp=function(){_n(),bn(),En(),vn(),yn(),kn(),In()},Cn=function(e){var t=e.saveState();return e.getParameters().length&&(t.parameters=e.getParameters().map(e=>e.saveState())),t},Sn=function(e,t,i,s){if(e=e.loadState(i,s),i.parameters)for(var[o,n]of i.parameters.entries())e.insertParameter(t.loadState(n,s),o);return e},tg=function(e){var t,i=Object.create(null),s=gr(b.SERIALIZER,!0);for(t in s){var o=null==(o=s[t])?void 0:o.save(e);o&&(i[t]=o)}return i},Qp=function(e,t,{recordUndo:i=!1}={}){if(a=gr(b.SERIALIZER,!0)){var s,o,n,r,l,a=Object.entries(a).sort((e,t)=>t[1].priority-e[1].priority),c=Cl;_.setRecordUndo$$module$build$src$core$events$utils(i),(i=_.getGroup$$module$build$src$core$events$utils())||_.setGroup$$module$build$src$core$events$utils(!0),X(),t instanceof wd&&t.setResizesEnabled(!1);for([,s]of a.reverse())null!=(o=s)&&o.clear(t);for([n,r]of a.reverse())e[n]&&null!=(l=r)&&l.load(e[n],t);t instanceof wd&&t.setResizesEnabled(!0),K(),g(new(m(f.FINISHED_LOADING))(t)),_.setGroup$$module$build$src$core$events$utils(i),_.setRecordUndo$$module$build$src$core$events$utils(c)}},wn=function(e,t){var i,s=null,s="string"==typeof e?document.getElementById(e)||document.querySelector(e):e;if(!document.contains(s)&&document!==(null==(i=s)?void 0:i.ownerDocument))throw Error("Error: container is not in current document");e=new Bu(t||{}),i=document.createElement("div"),c(i,"injectionDiv"),null!=t&&t.rtl&&c(i,"blocklyRTL"),s.appendChild(i),t=An(i,e);let o=xn(i,t,e);return Rn(o),le(o),he(o),i.addEventListener("focusin",function(){le(o)}),p(i,"keydown",null,me),o},An=function(e,t){e.setAttribute("dir","LTR"),fe(t.hasCss,t.pathToMedia);var i=a(k.SVG,{xmlns:Rl,"xmlns:html":Ol,"xmlns:xlink":Nl,version:"1.1",class:"blocklySvg"},e),s=a(k.DEFS,{},i),o=String(Math.random()).substring(2);return t.gridPattern=Uh.createDom(o,t.gridOptions,s,e),i},xn=function(e,t,i){i.parentWorkspace=null;var s=(i=new wd(i)).options,o=(i.scale=s.zoomOptions.startScale,t.appendChild(i.createDom("blocklyMainBackground",e)),i.getRenderer().getClassName());return o&&c(e,o),(o=i.getTheme().getClassName())&&c(e,o),!s.hasCategories&&s.languageTree&&(e=i.addFlyout(k.SVG),j(e,t)),s.hasTrashcan&&i.addTrashcan(),s.zoomOptions&&s.zoomOptions.controls&&i.addZoomControls(),i.getThemeManager().subscribe(t,"workspaceBackgroundColour","background-color"),i.translate(0,0),i.addChangeListener(Ro(i)),he(i),ns(),ai(),Mi(),i},Rn=function(e){var t,i=e.options,s=e.getParentSvg();p(s.parentNode,"contextmenu",null,function(e){kr(e)||e.preventDefault()}),s=p(window,"resize",null,function(){Gi(),e.hideComponents(!0),Ci(),_s(),he(e),No(e)}),e.setResizeHandlerWrapper(s),On(),i.languageTree&&(s=e.getToolbox(),t=e.getFlyout(!0),s?s.init():t&&(t.init(e),t.show(i.languageTree),"function"==typeof t.scrollToStart)&&t.scrollToStart()),i.hasTrashcan&&e.trashcan.init(),i.zoomOptions&&i.zoomOptions.controls&&e.zoomControls_.init(),i.moveOptions&&i.moveOptions.scrollbars?(e.scrollbar=new Nh(e,!0===i.moveOptions.scrollbars||!!i.moveOptions.scrollbars.horizontal,!0===i.moveOptions.scrollbars||!!i.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),i.hasSounds&&Nn(i.pathToMedia,e)},On=function(){hp||(p(document,"scroll",null,function(){var i=se();for(let e=0,t;t=i[e];e++)t instanceof wd&&t.updateInverseScreenCTM()}),yr(document,"touchend",null,br),yr(document,"touchcancel",null,br)),hp=!0},Nn=function(e,t){function i(){for(;o.length;){var e=o.pop();e&&n(e)}s.preload()}let s=t.getAudioManager(),o=(s.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),s.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),s.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete"),[]);o.push(p(document,"pointermove",null,i,!0)),o.push(p(document,"touchstart",null,i,!0))},$n=function(){x.registry.register({displayText(){return _.Msg$$module$build$src$core$msg.UNDO},preconditionFn(e){return 0<e.workspace.getUndoStack().length?"enabled":"disabled"},callback(e){e.workspace.undo(!1)},scopeType:x.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},Ln=function(){x.registry.register({displayText(){return _.Msg$$module$build$src$core$msg.REDO},preconditionFn(e){return 0<e.workspace.getRedoStack().length?"enabled":"disabled"},callback(e){e.workspace.undo(!0)},scopeType:x.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},Mn=function(){x.registry.register({displayText(){return _.Msg$$module$build$src$core$msg.CLEAN_UP},preconditionFn(e){return e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden"},callback(e){e.workspace.cleanUp()},scopeType:x.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},Dn=function(t,i){function s(e){n--,e.setCollapsed(t),0===n&&_.setGroup$$module$build$src$core$events$utils(!1)}let o=0,n=0;_.setGroup$$module$build$src$core$events$utils(!0);for(let t=0;t<i.length;t++){let e=i[t];for(;e;)n++,setTimeout(s.bind(null,e),o),e=e.getNextBlock(),o+=10}},Bn=function(){x.registry.register({displayText(){return _.Msg$$module$build$src$core$msg.COLLAPSE_ALL},preconditionFn(i){if(i.workspace.options.collapse){i=i.workspace.getTopBlocks(!1);for(let t=0;t<i.length;t++){let e=i[t];for(;e;){if(!e.isCollapsed())return"enabled";e=e.getNextBlock()}}return"disabled"}return"hidden"},callback(e){Dn(!0,e.workspace.getTopBlocks(!0))},scopeType:x.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},Pn=function(){x.registry.register({displayText(){return _.Msg$$module$build$src$core$msg.EXPAND_ALL},preconditionFn(i){if(i.workspace.options.collapse){i=i.workspace.getTopBlocks(!1);for(let t=0;t<i.length;t++){let e=i[t];for(;e;){if(e.isCollapsed())return"enabled";e=e.getNextBlock()}}return"disabled"}return"hidden"},callback(e){Dn(!1,e.workspace.getTopBlocks(!0))},scopeType:x.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},Fn=function(t,i){if(t.isDeletable())Array.prototype.push.apply(i,t.getDescendants(!1));else{t=t.getChildren(!1);for(let e=0;e<t.length;e++)Fn(t[e],i)}},Un=function(t){var i=[];t=t.getTopBlocks(!0);for(let e=0;e<t.length;e++)Fn(t[e],i);return i},Hn=function(e,t){t?_.setGroup$$module$build$src$core$events$utils(t):(_.setGroup$$module$build$src$core$events$utils(!0),t=_.getGroup$$module$build$src$core$events$utils());var i=e.shift();i&&(i.isDeadOrDying()?Hn(e,t):(i.dispose(!1,!0),setTimeout(Hn,10,e,t))),_.setGroup$$module$build$src$core$events$utils(!1)},Gn=function(){x.registry.register({displayText(e){return e.workspace?1===(e=Un(e.workspace).length)?_.Msg$$module$build$src$core$msg.DELETE_BLOCK:_.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",""+e):""},preconditionFn(e){return e.workspace&&0<Un(e.workspace).length?"enabled":"disabled"},callback(e){var t;e.workspace&&(e.workspace.cancelCurrentGesture(),(t=Un(e.workspace)).length<2?Hn(t):ut(_.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(t.length)),function(e){e&&Hn(t)}))},scopeType:x.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},Vn=function(){$n(),Ln(),Mn(),Bn(),Pn(),Gn()},Wn=function(){x.registry.register({displayText(){return _.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK},preconditionFn(e){return!(e=e.block).isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden"},callback(e){var t;e.block&&(t=e.block.toCopyData())&&pn(t,e.block.workspace)},scopeType:x.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},zn=function(){x.registry.register({displayText(e){return e.block.hasIcon(jh.TYPE)?_.Msg$$module$build$src$core$msg.REMOVE_COMMENT:_.Msg$$module$build$src$core$msg.ADD_COMMENT},preconditionFn(e){return!(e=e.block).isInFlyout&&e.workspace.options.comments&&!e.isCollapsed()&&e.isEditable()?"enabled":"hidden"},callback(e){(e=e.block).hasIcon(jh.TYPE)?e.setCommentText(null):e.setCommentText("")},scopeType:x.ScopeType.BLOCK,id:"blockComment",weight:2})},jn=function(){x.registry.register({displayText(e){return e.block.getInputsInline()?_.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:_.Msg$$module$build$src$core$msg.INLINE_INPUTS},preconditionFn(t){if(!(t=t.block).isInFlyout&&t.isMovable()&&!t.isCollapsed())for(let e=1;e<t.inputList.length;e++)if(!(t.inputList[e-1]instanceof sp||t.inputList[e]instanceof sp))return"enabled";return"hidden"},callback(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:x.ScopeType.BLOCK,id:"blockInline",weight:3})},Yn=function(){x.registry.register({displayText(e){return e.block.isCollapsed()?_.Msg$$module$build$src$core$msg.EXPAND_BLOCK:_.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK},preconditionFn(e){return!(e=e.block).isInFlyout&&e.isMovable()&&e.workspace.options.collapse?"enabled":"hidden"},callback(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:x.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},Xn=function(){x.registry.register({displayText(e){return e.block.hasDisabledReason(Aa)?_.Msg$$module$build$src$core$msg.ENABLE_BLOCK:_.Msg$$module$build$src$core$msg.DISABLE_BLOCK},preconditionFn(e){var t;return!(e=e.block).isInFlyout&&e.workspace.options.disable&&e.isEditable()?(t=(t=e.getDisabledReasons()).size>(t.has(Aa)?1:0),e.getInheritedDisabled()||t?"disabled":"enabled"):"hidden"},callback(e){e=e.block;var t=_.getGroup$$module$build$src$core$events$utils();t||_.setGroup$$module$build$src$core$events$utils(!0),e.setDisabledReason(!e.hasDisabledReason(Aa),Aa),_.setGroup$$module$build$src$core$events$utils(t)},scopeType:x.ScopeType.BLOCK,id:"blockDisable",weight:5})},Kn=function(){x.registry.register({displayText(e){var t=e.block;return e=t.getDescendants(!1).length,(t=t.getNextBlock())&&(e-=t.getDescendants(!1).length),1===e?_.Msg$$module$build$src$core$msg.DELETE_BLOCK:_.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",""+e)},preconditionFn(e){return!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden"},callback(e){e.block&&e.block.checkAndDelete()},scopeType:x.ScopeType.BLOCK,id:"blockDelete",weight:6})},Jn=function(){x.registry.register({displayText(){return _.Msg$$module$build$src$core$msg.HELP},preconditionFn(e){return("function"==typeof(e=e.block).helpUrl?e.helpUrl():e.helpUrl)?"enabled":"hidden"},callback(e){e.block.showHelp()},scopeType:x.ScopeType.BLOCK,id:"blockHelp",weight:7})},qn=function(){x.registry.register({displayText:()=>_.Msg$$module$build$src$core$msg.REMOVE_COMMENT,preconditionFn(e){return null!=(e=e.comment)&&e.isDeletable()?"enabled":"hidden"},callback(e){_.setGroup$$module$build$src$core$events$utils(!0),null!=(e=e.comment)&&e.dispose(),_.setGroup$$module$build$src$core$events$utils(!1)},scopeType:x.ScopeType.COMMENT,id:"commentDelete",weight:6})},Zn=function(){x.registry.register({displayText:()=>_.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,preconditionFn(e){return null!=(e=e.comment)&&e.isMovable()?"enabled":"hidden"},callback(e){var t;e.comment&&(t=e.comment.toCopyData())&&pn(t,e.comment.workspace)},scopeType:x.ScopeType.COMMENT,id:"commentDuplicate",weight:1})},Qn=function(){x.registry.register({displayText:()=>_.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:e=>null!=(e=e.workspace)&&e.isMutator?"hidden":"enabled",callback:(e,t,i,s)=>{(e=e.workspace)&&(_.setGroup$$module$build$src$core$events$utils(!0),(t=new ku(e)).setPlaceholderText(_.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT),t.moveTo(er(new y(s.x,s.y),e)),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(t),_.setGroup$$module$build$src$core$events$utils(!1))},scopeType:x.ScopeType.WORKSPACE,id:"commentCreate",weight:8})},er=function(e,t){var i=t.getInjectionDiv().getBoundingClientRect();return e=new y(e.x-i.left,e.y-i.top),i=t.getOriginOffsetInPixels(),(e=y.difference(e,i)).scale(1/t.scale),e},tr=function(){Wn(),zn(),jn(),Yn(),Xn(),Kn(),Jn()},ir=function(){Zn(),qn(),Qn()},sr=function(){Vn(),tr()},or=function(e){return e&&"function"==typeof e.paste},nr=function(e){return e&&"function"==typeof e.getSvgRoot},rr=function(e){return e.isSelectable()},lr=function(e){qr.hideChaff(e)},(d=d||{}).scope={},d.ASSUME_ES5=!1,d.ASSUME_ES6=!1,d.ASSUME_ES2020=!1,d.ASSUME_NO_NATIVE_MAP=!1,d.ASSUME_NO_NATIVE_SET=!1,d.ISOLATE_POLYFILLS=!1,d.FORCE_POLYFILL_PROMISE=!1,d.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,d.INSTRUMENT_ASYNC_CONTEXT=!0,d.objectCreate=d.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t},d.defineProperty=d.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,i){return e!=Array.prototype&&e!=Object.prototype&&(e[t]=i.value),e},d.getGlobal=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ig&&ig];for(var t=0;t<e.length;++t){var i=e[t];if(i&&i.Math==Math)return i}throw Error("Cannot find global object")},d.global=d.ASSUME_ES2020?globalThis:d.getGlobal(this),d.IS_SYMBOL_NATIVE="function"==typeof Symbol&&"symbol"==typeof Symbol("x"),d.TRUST_ES6_POLYFILLS=!d.ISOLATE_POLYFILLS||d.IS_SYMBOL_NATIVE,d.polyfills={},d.propertyToPolyfillSymbol={},d.POLYFILL_PREFIX="$jscp$",d.polyfill=function(e,t,i,s){t&&(d.ISOLATE_POLYFILLS?d.polyfillIsolated(e,t,i,s):d.polyfillUnisolated(e,t,i,s))},d.polyfillUnisolated=function(e,t,i,s){for(i=d.global,e=e.split("."),s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))return;i=i[o]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&d.defineProperty(i,e,{configurable:!0,writable:!0,value:t})},d.polyfillIsolated=function(e,t,i,s){var o=e.split(".");e=1===o.length,s=o[0],s=!e&&s in d.polyfills?d.polyfills:d.global;for(var n=0;n<o.length-1;n++){var r=o[n];if(!(r in s))return;s=s[r]}o=o[o.length-1],null!=(t=t(i=d.IS_SYMBOL_NATIVE&&"es6"===i?s[o]:null))&&(e?d.defineProperty(d.polyfills,o,{configurable:!0,writable:!0,value:t}):t!==i&&(void 0===d.propertyToPolyfillSymbol[o]&&(i=1e9*Math.random()>>>0,d.propertyToPolyfillSymbol[o]=d.IS_SYMBOL_NATIVE?d.global.Symbol(o):d.POLYFILL_PREFIX+i+"$"+o),d.defineProperty(s,d.propertyToPolyfillSymbol[o],{configurable:!0,writable:!0,value:t})))},d.getConstructImplementation=function(){var s;return d.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct?(Reflect.construct(e,[],function(){}),new e instanceof e?Reflect.construct:(s=Reflect.construct,function(e,t,i){return e=s(e,t),i&&Reflect.setPrototypeOf(e,i.prototype),e})):function(e,t,i){return i=d.objectCreate((i=void 0===i?e:i).prototype||Object.prototype),Function.prototype.apply.call(e,i,t)||i};function e(){}},d.construct={valueOf:d.getConstructImplementation}.valueOf(),d.underscoreProtoCanBeSet=function(){var e={};try{return e.__proto__={a:!0},e.a}catch(e){}return!1},d.setPrototypeOf=d.ASSUME_ES6||d.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:d.underscoreProtoCanBeSet()?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null,d.inherits=function(e,t){if(e.prototype=d.objectCreate(t.prototype),e.prototype.constructor=e,d.ASSUME_ES6||d.setPrototypeOf){var i=d.setPrototypeOf;i(e,t)}else for(i in t){var s;"prototype"!=i&&(Object.defineProperties?(s=Object.getOwnPropertyDescriptor(t,i))&&Object.defineProperty(e,i,s):e[i]=t[i])}e.superClass_=t.prototype},d.arrayIteratorImpl=function(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}},d.arrayIterator=function(e){return{next:d.arrayIteratorImpl(e)}},d.makeIterator=function(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if(t)return t.call(e);if("number"==typeof e.length)return d.arrayIterator(e);throw Error(String(e)+" is not an iterable or ArrayLike")},d.arrayFromIterator=function(e){for(var t,i=[];!(t=e.next()).done;)i.push(t.value);return i},d.arrayFromIterable=function(e){return e instanceof Array?e:d.arrayFromIterator(d.makeIterator(e))},d.generator={},d.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError("Iterator result "+e+" is not an object")},d.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},d.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},d.generator.Context.prototype.stop_=function(){this.isRunning_=!1},d.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},d.generator.Context.prototype.next_=function(e){this.yieldResult=e},d.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0},this.jumpToErrorHandler_()},d.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e},this.nextAddress=this.finallyAddress_},d.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e},this.nextAddress=this.finallyAddress_},d.generator.Context.prototype.yield=function(e,t){return this.nextAddress=t,{value:e}},d.generator.Context.prototype.yieldAll=function(e,t){var i=(e=d.makeIterator(e)).next();if(d.generator.ensureIteratorResultIsObject_(i),!i.done)return this.yieldAllIterator_=e,this.yield(i.value,t);this.yieldResult=i.value,this.nextAddress=t},d.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e},d.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},d.generator.Context.prototype.setCatchFinallyBlocks=function(e,t){this.catchAddress_=e,null!=t&&(this.finallyAddress_=t)},d.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0,this.finallyAddress_=e||0},d.generator.Context.prototype.leaveTryBlock=function(e,t){this.nextAddress=e,this.catchAddress_=t||0},d.generator.Context.prototype.enterCatchBlock=function(e){return this.catchAddress_=e||0,e=this.abruptCompletion_.exception,this.abruptCompletion_=null,e},d.generator.Context.prototype.enterFinallyBlock=function(e,t,i){i?this.finallyContexts_[i]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=e||0,this.finallyAddress_=t||0},d.generator.Context.prototype.leaveFinallyBlock=function(e,t){if(t=this.finallyContexts_.splice(t||0)[0],t=this.abruptCompletion_=this.abruptCompletion_||t){if(t.isException)return this.jumpToErrorHandler_();null!=t.jumpTo&&this.finallyAddress_<t.jumpTo?(this.nextAddress=t.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e},d.generator.Context.prototype.forIn=function(e){return new d.generator.Context.PropertyIterator(e)},d.generator.Context.PropertyIterator=function(e){for(var t in this.object_=e,this.properties_=[],e)this.properties_.push(t);this.properties_.reverse()},d.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null},d.generator.Engine_=function(e){this.context_=new d.generator.Context,this.program_=e},d.generator.Engine_.prototype.next_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_):(this.context_.next_(e),this.nextStep_())},d.generator.Engine_.prototype.return_=function(e){this.context_.start_();var t=this.context_.yieldAllIterator_;return t?this.yieldAllStep_("return"in t?t.return:function(e){return{value:e,done:!0}},e,this.context_.return):(this.context_.return(e),this.nextStep_())},d.generator.Engine_.prototype.throw_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,e,this.context_.next_):(this.context_.throw_(e),this.nextStep_())},d.generator.Engine_.prototype.yieldAllStep_=function(e,t,i){try{var s=e.call(this.context_.yieldAllIterator_,t);if(d.generator.ensureIteratorResultIsObject_(s),!s.done)return this.context_.stop_(),s;var o=s.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}return this.context_.yieldAllIterator_=null,i.call(this.context_,o),this.nextStep_()},d.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(e=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}},d.generator.Generator_=function(t){this.next=function(e){return t.next_(e)},this.throw=function(e){return t.throw_(e)},this.return=function(e){return t.return_(e)},this[Symbol.iterator]=function(){return this}},d.generator.createGenerator=function(e,t){return t=new d.generator.Generator_(new d.generator.Engine_(t)),d.setPrototypeOf&&e.prototype&&d.setPrototypeOf(t,e.prototype),t},d.asyncExecutePromiseGenerator=function(t){function o(e){return t.next(e)}function n(e){return t.throw(e)}return new Promise(function(i,s){!function e(t){t.done?i(t.value):Promise.resolve(t.value).then(o,n).then(e,s)}(t.next())})},d.asyncExecutePromiseGeneratorFunction=function(e){return d.asyncExecutePromiseGenerator(e())},d.asyncExecutePromiseGeneratorProgram=function(e){return d.asyncExecutePromiseGenerator(new d.generator.Generator_(new d.generator.Engine_(e)))},d.polyfill("globalThis",function(e){return e||d.global},"es_2020","es3"),d.polyfill("Array.prototype.includes",function(e){return e||function(e,t){var i=this,s=(i=i instanceof String?String(i):i).length;for((t=t||0)<0&&(t=Math.max(t+s,0));t<s;t++){var o=i[t];if(o===e||Object.is(o,e))return!0}return!1}},"es7","es3"),d.checkEs6ConformanceViaProxy=function(){try{var s={},o=Object.create(new d.global.Proxy(s,{get:function(e,t,i){return e==s&&"q"==t&&i==o}}));return!0===o.q}catch(e){return!1}},d.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1,d.ES6_CONFORMANCE=d.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&d.checkEs6ConformanceViaProxy(),d.initSymbol=function(){},d.iteratorPrototype=function(e){return(e={next:e})[Symbol.iterator]=function(){return this},e},d.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},d.MapEntry=function(){},d.polyfill("Set.prototype.difference",function(e){return e||function(e){d.checkIsSetInstance(this),d.checkIsSetLike(e);for(var t=d.getSmallerAndLargerSets(this,e),i=(e=new Set(this),t.smallerSetIterator),t=t.largerSet,s=i.next();!s.done;)t.has(s.value)&&e.delete(s.value),s=i.next();return e}},"es_next","es6"),d.checkIsSetLike=function(e){if("object"!=typeof e||null===e||"number"!=typeof e.size||e.size<0||"function"!=typeof e.keys||"function"!=typeof e.has)throw new TypeError("Argument must be set-like")},d.checkIsValidIterator=function(e){if("object"!=typeof e||null===e||"function"!=typeof e.next)throw new TypeError("Invalid iterator.");return e},d.getSmallerAndLargerSets=function(e,t){return e.size<=t.size?{smallerSetIterator:e.keys(),largerSet:t}:{smallerSetIterator:d.checkIsValidIterator(t.keys()),largerSet:e}},d.checkIsSetInstance=function(e){if(!(e instanceof Set))throw new TypeError("Method must be called on an instance of Set.")},d.iteratorFromArray=function(t,i){if(d.ASSUME_ES6)return t[Symbol.iterator]();t instanceof String&&(t+="");var s=0,o=!1,e={next:function(){var e;return!o&&s<t.length?(e=s++,{value:i(e,t[e]),done:!1}):{done:o=!0,value:void 0}}};return e[Symbol.iterator]=function(){return e},e},d.polyfill("Array.prototype.values",function(e){return e||function(){return d.iteratorFromArray(this,function(e,t){return t})}},"es8","es3"),d.polyfill("Array.prototype.flatMap",function(e){return e||function(i,s){var o=[];return Array.prototype.forEach.call(this,function(e,t){e=i.call(s,e,t,this),Array.isArray(e)?o.push.apply(o,e):o.push(e)}),o}},"es9","es5"),d.polyfill("Array.prototype.flat",function(e){return e||function(t){t=void 0===t?1:t;var i=[];return Array.prototype.forEach.call(this,function(e){Array.isArray(e)&&0<t?(e=Array.prototype.flat.call(e,t-1),i.push.apply(i,e)):i.push(e)}),i}},"es9","es5"),d.polyfill("Object.entries",function(e){return e||function(e){var t,i=[];for(t in e)d.owns(e,t)&&i.push([t,e[t]]);return i}},"es8","es3"),d.polyfill("Object.values",function(e){return e||function(e){var t,i=[];for(t in e)d.owns(e,t)&&i.push(e[t]);return i}},"es8","es3"),Object.create(null)),Pr={typeMap:Br},Fr=Object.create(null),Ur="default",b=class{constructor(e){this.name=e}toString(){return this.name}},Pr=(b.CONNECTION_CHECKER=new b("connectionChecker"),b.CONNECTION_PREVIEWER=new b("connectionPreviewer"),b.CURSOR=new b("cursor"),b.EVENT=new b("event"),b.FIELD=new b("field"),b.INPUT=new b("input"),b.RENDERER=new b("renderer"),b.TOOLBOX=new b("toolbox"),b.THEME=new b("theme"),b.TOOLBOX_ITEM=new b("toolboxItem"),b.FLYOUTS_VERTICAL_TOOLBOX=new b("flyoutsVerticalToolbox"),b.FLYOUTS_HORIZONTAL_TOOLBOX=new b("flyoutsHorizontalToolbox"),b.FLYOUT_INFLATER=new b("flyoutInflater"),b.METRICS_MANAGER=new b("metricsManager"),b.BLOCK_DRAGGER=new b("blockDragger"),b.SERIALIZER=new b("serializer"),b.ICON=new b("icon"),b.PASTER=new b("paster"),b.VARIABLE_MODEL=new b("variableModel"),b.VARIABLE_MAP=new b("variableMap"),{DEFAULT:Ur,TEST_ONLY:Pr}),Hr=(Pr.Type=b,Pr.getAllItems=gr,Pr.getClass=dr,Pr.getClassFromOptions=mr,Pr.getObject=pr,Pr.hasItem=hr,Pr.register=o,Pr.unregister=cr,Object.create(null)),Gr=750,Vr="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),Wr=null,zr={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},jr=0,Yr={TOUCH_ENABLED:Vr,TOUCH_MAP:zr};Yr.checkTouchIdentifier=vr,Yr.clearTouchIdentifier=fr,Yr.getTouchIdentifierFromEvent=Er,Yr.longStart=_r,Yr.longStop=br,Yr.shouldHandleEvent=Tr;{var Xr=globalThis.navigator&&globalThis.navigator.userAgent||"";function Kr(e){return t.includes(e.toUpperCase())}let t=(Xl=Xr).toUpperCase();_l=Kr("JavaFX"),Tl=Kr("WebKit"),Tl=Kr("Gecko")&&!Tl,e=Kr("Android"),Xr=globalThis.navigator&&globalThis.navigator.maxTouchPoints,Xr=Kr("iPad")||Kr("Macintosh")&&0<Xr,i=Kr("iPhone")&&!Xr,Dl=Kr("Macintosh"),Ul=!(Ul=Xr||e&&!Kr("Mobile")||Kr("Silk"))&&(i||e)}var f,Jr,qr,Zr,T,Qr,el,tl,il,sl,ol,nl,rl,ll,al,E,s,cl=_l,ul=Tl,hl=e,dl=Xr,pl=i,gl=Dl,ml=Ul,_l={ANDROID:hl,GECKO:ul,IPAD:dl,IPHONE:pl,JavaFx:cl,MAC:gl,MOBILE:ml,raw:Xl},bl=40,fl=125,Tl={},El=(Tl.bind=yr,Tl.conditionalBind=p,Tl.getScrollDeltaPixels=Sr,Tl.isRightButton=Ir,Tl.isTargetInput=kr,Tl.mouseToSvg=Cr,Tl.unbind=n,(e=f=f||{}).BLOCK_CREATE="create",e.BLOCK_DELETE="delete",e.BLOCK_CHANGE="change",e.BLOCK_FIELD_INTERMEDIATE_CHANGE="block_field_intermediate_change",e.BLOCK_MOVE="move",e.VAR_CREATE="var_create",e.VAR_DELETE="var_delete",e.VAR_RENAME="var_rename",e.VAR_TYPE_CHANGE="var_type_change",e.UI="ui",e.BLOCK_DRAG="drag",e.SELECTED="selected",e.CLICK="click",e.MARKER_MOVE="marker_move",e.BUBBLE_OPEN="bubble_open",e.TRASHCAN_OPEN="trashcan_open",e.TOOLBOX_ITEM_SELECT="toolbox_item_select",e.THEME_CHANGE="theme_change",e.VIEWPORT_CHANGE="viewport_change",e.COMMENT_CREATE="comment_create",e.COMMENT_DELETE="comment_delete",e.COMMENT_CHANGE="comment_change",e.COMMENT_MOVE="comment_move",e.COMMENT_RESIZE="comment_resize",e.COMMENT_DRAG="comment_drag",e.COMMENT_COLLAPSE="comment_collapse",e.FINISHED_LOADING="finished_loading",[f.BLOCK_CREATE,f.BLOCK_MOVE,f.COMMENT_CREATE,f.COMMENT_MOVE]),vl=({BUMP_EVENTS:El}.EventType=f,"!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"),yl={genUid:()=>{var t=vl.length,i=[];for(let e=0;e<20;e++)i[e]=vl.charAt(Math.random()*t);return i.join("")}},kl=0,Xr={TEST_ONLY:yl},Il=(Xr.genUid=Ar,Xr.getNextUniqueId=wr,""),Cl=!0,Sl=0,wl="ORPHANED_BLOCK",Al=[],xl={FIRE_QUEUE:Al,enqueueEvent:B,fireNow:D,fireInternal:Wl,setGroupInternal:zl},Rl=(_.disable$$module$build$src$core$events$utils,_.enable$$module$build$src$core$events$utils,_.getGroup$$module$build$src$core$events$utils,_.setGroup$$module$build$src$core$events$utils,_.setRecordUndo$$module$build$src$core$events$utils,"http://www.w3.org/2000/svg"),Ol="http://www.w3.org/1999/xhtml",Nl="http://www.w3.org/1999/xlink",$l=((i=Jr=Jr||{})[i.ELEMENT_NODE=1]="ELEMENT_NODE",i[i.TEXT_NODE=3]="TEXT_NODE",i[i.COMMENT_NODE=8]="COMMENT_NODE",null),Ll=0,Ml=null,Dl={HTML_NS:Ol},Bl=(Dl.NodeType=Jr,Dl.SVG_NS=Rl,Dl.XLINK_NS=Nl,Dl.addClass=c,Dl.createSvgElement=a,Dl.getFastTextWidth=Yl,Dl.getFastTextWidthWithSizeString=q,Dl.getTextWidth=J,Dl.hasClass=z,Dl.insertAfter=j,Dl.measureFontMetrics=Z,Dl.removeClass=r,Dl.removeClasses=W,Dl.removeNode=l,Dl.setCssTransform=Y,Dl.startTextWidthCache=X,Dl.stopTextWidthCache=K,class{static findFocusedNode(e){var t,i=e.getRootFocusableNode();return i.canBeFocused()?(t=i.getFocusableElement(),z(t,Bl.ACTIVE_CLASS_NAME)||z(t,Bl.PASSIVE_CSS_CLASS_NAME)||((i=t.querySelector(this.ACTIVE_FOCUS_NODE_CSS_SELECTOR))instanceof HTMLElement||i instanceof SVGElement)&&(i=Bl.findFocusableNodeFor(i,e))?i:((t=t.querySelector(this.PASSIVE_FOCUS_NODE_CSS_SELECTOR))instanceof HTMLElement||t instanceof SVGElement)&&(e=Bl.findFocusableNodeFor(t,e))?e:null):null}static findFocusableNodeFor(t,e){var i,s;return t.id&&"null"!==t.id&&-1===e.getNestedTrees().map(e=>Bl.findFocusableNodeFor(t,e)).findIndex(e=>!!e)?(i=e.getRootFocusableNode()).canBeFocused()&&t===i.getFocusableElement()?i:(i=null!=(s=e.lookUpFocusableNode(t.id))?s:null)||(s=t.parentElement,!i&&s?Bl.findFocusableNodeFor(s,e):null):null}}),Pl=(Bl.ACTIVE_CLASS_NAME="blocklyActiveFocus",Bl.PASSIVE_CSS_CLASS_NAME="blocklyPassiveFocus",Bl.ACTIVE_FOCUS_NODE_CSS_SELECTOR="."+Bl.ACTIVE_CLASS_NAME,Bl.PASSIVE_FOCUS_NODE_CSS_SELECTOR="."+Bl.PASSIVE_CSS_CLASS_NAME,class{constructor(e,t){this.tree=e,this.rootShouldBeAutoTabbable=t}}),Fl=class{constructor(e){this.previouslyFocusedNode=this.focusedNode=null,this.registeredTrees=[],this.isUpdatingFocusedNode=this.recentlyLostAllFocus=this.lockFocusStateChanges=this.currentlyHoldsEphemeralFocus=!1;let t=e=>{if(!this.isUpdatingFocusedNode){this.recentlyLostAllFocus=!e;var t,i=null;if(e instanceof HTMLElement||e instanceof SVGElement)for(var s of this.registeredTrees)if(i=Bl.findFocusableNodeFor(e,s.tree))break;i&&i.canBeFocused()?(e=i.getFocusableTree(),s=null==(t=this.focusedNode)?void 0:t.getFocusableTree(),i===e.getRootFocusableNode()&&e!==s?this.focusTree(e):this.focusNode(i)):this.defocusCurrentFocusedNode()}};e("focusin",e=>{e instanceof FocusEvent&&t(document.activeElement)}),e("focusout",e=>{e instanceof FocusEvent&&t(e.relatedTarget)})}registerTree(e,t=!1){if(this.ensureManagerIsUnlocked(),this.isRegistered(e))throw Error(`Attempted to re-register already registered tree: ${e}.`);this.registeredTrees.push(new Pl(e,t));var i=e.getRootFocusableNode().getFocusableElement();if(!i.id||"null"===i.id)throw Error("Attempting to register a tree with a root element that has an "+`invalid ID: ${e}.`);t&&(i.tabIndex=0)}isRegistered(e){return!!this.lookUpRegistration(e)}lookUpRegistration(t){var e;return null!=(e=this.registeredTrees.find(e=>e.tree===t))?e:null}unregisterTree(t){if(this.ensureManagerIsUnlocked(),!this.isRegistered(t))throw Error(`Attempted to unregister not registered tree: ${t}.`);var e=this.registeredTrees.findIndex(e=>e.tree===t),i=this.registeredTrees[e],s=(this.registeredTrees.splice(e,1),e=Bl.findFocusedNode(t),t.getRootFocusableNode());e&&this.removeHighlight(e),this.focusedNode!==e&&this.focusedNode!==s||this.updateFocusedNode(null),this.removeHighlight(s),i.rootShouldBeAutoTabbable&&t.getRootFocusableNode().getFocusableElement().removeAttribute("tabindex")}getFocusedTree(){var e;return null!=(e=null==(e=this.focusedNode)?void 0:e.getFocusableTree())?e:null}getFocusedNode(){return this.focusedNode}focusTree(e){if(this.ensureManagerIsUnlocked(),!this.isRegistered(e))throw Error(`Attempted to focus unregistered tree: ${e}.`);var t=Bl.findFocusedNode(e),i=e.getRestoredFocusableNode(t);e=e.getRootFocusableNode(),this.focusNode(null!=(i=null!=i?i:t)?i:e)}focusNode(e){this.ensureManagerIsUnlocked();var t=!this.currentlyHoldsEphemeralFocus;t&&(this.isUpdatingFocusedNode=!0);var i,s=(null==(i=this.focusedNode)?void 0:i.getFocusableElement())!==document.activeElement;if(this.focusedNode!==e||s)if(e.canBeFocused()){if(i=e.getFocusableTree(),!this.isRegistered(i))throw Error(`Attempted to focus unregistered node: ${e}.`);(s=e.getFocusableElement()).id&&"null"!==s.id||console.warn("Trying to focus a node that has an invalid ID.");var o,n=Bl.findFocusableNodeFor(s,i),s=Bl.findFocusedNode(i),r=e;n!==e&&(r=i.getRestoredFocusableNode(s),e=i.getRootFocusableNode(),r=null!=(o=null!=r?r:s)?o:e),o=null==(e=this.focusedNode)?void 0:e.getFocusableTree(),e&&this.passivelyFocusNode(e,i),i=i.getRootFocusableNode(),s&&this.removeHighlight(s),i!==r&&this.removeHighlight(i),this.currentlyHoldsEphemeralFocus||this.activelyFocusNode(r,null!=o?o:null),this.updateFocusedNode(r)}else console.warn("Trying to focus a node that can't be focused.");t&&(this.isUpdatingFocusedNode=!1)}takeEphemeralFocus(e){if(this.ensureManagerIsUnlocked(),this.currentlyHoldsEphemeralFocus)throw Error("Attempted to take ephemeral focus when it's already held, "+`with new element: ${e}.`);this.currentlyHoldsEphemeralFocus=!0,this.focusedNode&&this.passivelyFocusNode(this.focusedNode,null),e.focus();let t=!1;return()=>{if(t)throw Error("Attempted to finish ephemeral focus twice for element: "+e+".");if(t=!0,this.currentlyHoldsEphemeralFocus=!1,this.focusedNode){this.activelyFocusNode(this.focusedNode,null);let e=this.focusedNode;setTimeout(()=>{!this.focusedNode&&this.previouslyFocusedNode===e&&this.recentlyLostAllFocus&&this.focusNode(e)},0)}}}ephemeralFocusTaken(){return this.currentlyHoldsEphemeralFocus}ensureManagerIsUnlocked(){if(this.lockFocusStateChanges)throw Error("FocusManager state changes cannot happen in a tree/node focus/blur callback.")}updateFocusedNode(e){this.previouslyFocusedNode=this.focusedNode,this.focusedNode=e}defocusCurrentFocusedNode(){this.focusedNode&&!this.currentlyHoldsEphemeralFocus&&(this.passivelyFocusNode(this.focusedNode,null),this.updateFocusedNode(null))}activelyFocusNode(e,t){this.lockFocusStateChanges=!0;var i=e.getFocusableTree(),s=e.getFocusableElement(),o=null==(o=this.lookUpRegistration(i))?void 0:o.rootShouldBeAutoTabbable;i!==t&&(i.onTreeFocus(e,t),o)&&(i.getRootFocusableNode().getFocusableElement().tabIndex=-1),e.onNodeFocus(),this.lockFocusStateChanges=!1,o&&e===i.getRootFocusableNode()||s.hasAttribute("tabindex")||(s.tabIndex=-1),this.setNodeToVisualActiveFocus(e),s.focus()}passivelyFocusNode(e,t){this.lockFocusStateChanges=!0;var i,s=e.getFocusableTree();s!==t&&(s.onTreeBlur(t),null!=(i=this.lookUpRegistration(s)))&&i.rootShouldBeAutoTabbable&&(s.getRootFocusableNode().getFocusableElement().tabIndex=0),e.onNodeBlur(),this.lockFocusStateChanges=!1,s!==t&&this.setNodeToVisualPassiveFocus(e)}setNodeToVisualActiveFocus(e){e=e.getFocusableElement(),c(e,Fl.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),r(e,Fl.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME)}setNodeToVisualPassiveFocus(e){e=e.getFocusableElement(),r(e,Fl.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),c(e,Fl.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME)}removeHighlight(e){e=e.getFocusableElement(),r(e,Fl.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),r(e,Fl.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME)}static getFocusManager(){return Fl.focusManager||(Fl.focusManager=new Fl(document.addEventListener)),Fl.focusManager}},Ul=(Fl.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME="blocklyActiveFocus",Fl.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME="blocklyPassiveFocus",Fl.focusManager=null,_.getFocusManager$$module$build$src$core$focus_manager,{}),v=(Ul.deepMerge=te,class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(e,t){if(this.shortcuts.get(e.name)&&!t)throw Error(`Shortcut named "${e.name}" already exists.`);if(this.shortcuts.set(e.name,e),null!=(t=e.keyCodes)&&t.length)for(var i of t)this.addKeyMapping(i,e.name,!!e.allowCollision)}unregister(e){return this.shortcuts.get(e)?(this.removeAllKeyMappings(e),this.shortcuts.delete(e),!0):(console.warn(`Keyboard shortcut named "${e}" not found.`),!1)}addKeyMapping(e,t,i){var s=this.keyMap.get(e=""+e);if(s&&!i)throw Error(`Shortcut named "${t}" collides with shortcuts "${s}"`);s&&i?s.unshift(t):this.keyMap.set(e,[t])}removeKeyMapping(e,t,i){var s=this.keyMap.get(e);if(s){var o=s.indexOf(t);if(-1<o)return s.splice(o,1),0===s.length&&this.keyMap.delete(e),!0}return i||console.warn(`No keyboard shortcut named "${t}" registered with key code "${e}"`),!1}removeAllKeyMappings(e){for(var t of this.keyMap.keys())this.removeKeyMapping(t,e,!0)}setKeyMap(e){for(var t in this.keyMap.clear(),e)this.keyMap.set(t,e[t])}getKeyMap(){var e,t,i=Object.create(null);for([e,t]of this.keyMap)i[e]=t;return i}getRegistry(){var e,t,i=Object.create(null);for([e,t]of this.shortcuts)i[e]=t;return te(Object.create(null),i)}onKeyDown(e,t){var i=this.serializeKeyEvent(t);if(i=this.getShortcutNamesByKeyCode(i))for(var s of i){var o,i=this.shortcuts.get(s);if(i&&(!i.preconditionFn||i.preconditionFn(e,{focusedNode:null!=(s=_.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode())?s:void 0})))if(null!=(o=(s=i).callback)&&o.call(s,e,t,i,{focusedNode:null!=(o=_.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode())?o:void 0}))return!0}return!1}getShortcutNamesByKeyCode(e){return(null==(e=this.keyMap.get(e))?void 0:e.slice())||[]}getKeyCodesByShortcutName(e){var t,i,s=[];for([t,i]of this.keyMap)-1<i.indexOf(e)&&s.push(t);return s}serializeKeyEvent(e){let t="";for(var i in v.modifierKeys)e.getModifierState(i)&&(""!==t&&(t+="+"),t+=i);return""!==t&&e.keyCode?t+="+"+e.keyCode:e.keyCode&&(t=String(e.keyCode)),t}checkModifiers(e){for(var t of e)if(!(t in v.modifierKeys))throw Error(t+" is not a valid modifier key.")}createSerializedKey(e,t){let i="";if(t)for(var s in this.checkModifiers(t),v.modifierKeys)t.includes(v.modifierKeys[s])&&(""!==i&&(i+="+"),i+=s);return""!==i&&e?i+="+"+e:e&&(i=""+e),i}}),Hl=(v.registry=new v,(Xl=(Xl=v=v||{}).modifierKeys||(Xl.modifierKeys={}))[Xl.Shift=16]="Shift",Xl[Xl.Control=17]="Control",Xl[Xl.Alt=18]="Alt",Xl[Xl.Meta=91]="Meta",Object.create(null)),Gl=[],Vl={defineBlocksWithJsonArrayInternal:t},e={TEST_ONLY:Vl},Wl=(e.createBlockDefinitionsFromJsonArray=_.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,e.defineBlocks=_.defineBlocks$$module$build$src$core$common,e.defineBlocksWithJsonArray=ge,e.draggingConnections=Gl,e.fireSelectedEvent=ce,e.getAllWorkspaces=se,e.getBlockTypeCounts=de,e.getMainWorkspace=re,e.getParentContainer=Zl,e.getSelected=ae,e.getWorkspaceById=ie,e.globalShortcutHandler=me,e.registerWorkspace=oe,e.setMainWorkspace=le,e.setParentContainer=ue,e.setSelected=ea,e.svgResize=he,e.unregisterWorkpace=ne,class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=_.getGroup$$module$build$src$core$events$utils(),this.recordUndo=Cl}toJson(){return{type:this.type,group:this.group}}static fromJson(e,t,i){return i.isBlank=!1,i.group=e.group||"",i.workspaceId=t.id,i}isNull(){return!1}run(e){}getEventWorkspace_(){let e;if(e=this.workspaceId?ie(this.workspaceId):e)return e;throw Error("Workspace is null. Event must have been generated from real Blockly events.")}}),zl=class extends Wl{constructor(e){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=void 0===e,this.workspaceId=e||""}},jl=class extends zl{constructor(e,t,i){super(t=null===(t=e?e.workspace.id:t)?void 0:t),this.type=f.CLICK,this.blockId=e?e.id:void 0,this.targetType=i}toJson(){var e=super.toJson();if(this.targetType)return e.targetType=this.targetType,e.blockId=this.blockId,e;throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new jl)).targetType=e.targetType,t.blockId=e.blockId,t}},Yl=((i=eg=eg||{}).BLOCK="block",i.WORKSPACE="workspace",i.ZOOM_CONTROLS="zoom_controls",o(b.EVENT,f.CLICK,jl),{}),Xl=(Yl.removeElem=_e,class{constructor(e){this.name=e}toString(){return this.name}}),Kl=(Xl.POSITIONABLE=new Xl("positionable"),Xl.DRAG_TARGET=new Xl("drag_target"),Xl.DELETE_AREA=new Xl("delete_area"),Xl.AUTOHIDEABLE=new Xl("autohideable"),class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(e,t){var i,s=e.component.id;if(!t&&this.componentData.has(s))throw Error('Plugin "'+s+'" with capabilities "'+(null==(i=this.componentData.get(s))?void 0:i.capabilities)+'" already added.');for(this.componentData.set(s,e),t=[],i=0;i<e.capabilities.length;i++){var o,n=String(e.capabilities[i]).toLowerCase();t.push(n),this.capabilityToComponentIds.has(n)?null!=(o=this.capabilityToComponentIds.get(n))&&o.push(s):this.capabilityToComponentIds.set(n,[s])}this.componentData.get(s).capabilities=t}removeComponent(t){var i=this.componentData.get(t);if(i){for(let e=0;e<i.capabilities.length;e++){var s=String(i.capabilities[e]).toLowerCase();_e(this.capabilityToComponentIds.get(s),t)}this.componentData.delete(t)}}addCapability(e,t){if(!this.getComponent(e))throw Error('Cannot add capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');var i;this.hasCapability(e,t)?console.warn('Plugin "'+e+'already has capability "'+t+'"'):(t=(""+t).toLowerCase(),null!=(i=this.componentData.get(e))&&i.capabilities.push(t),null!=(i=this.capabilityToComponentIds.get(t))&&i.push(e))}removeCapability(e,t){if(!this.getComponent(e))throw Error('Cannot remove capability, "'+t+'". Plugin "'+e+'" has not been added to the ComponentManager');this.hasCapability(e,t)?(t=(""+t).toLowerCase(),_e(this.componentData.get(e).capabilities,t),_e(this.capabilityToComponentIds.get(t),e)):console.warn('Plugin "'+e+"doesn't have capability \""+t+'" to remove')}hasCapability(e,t){return t=(""+t).toLowerCase(),this.componentData.has(e)&&this.componentData.get(e).capabilities.includes(t)}getComponent(e){return null==(e=this.componentData.get(e))?void 0:e.component}getComponents(e,t){if(e=(""+e).toLowerCase(),!(e=this.capabilityToComponentIds.get(e)))return[];let i=[];if(t){let t=[];e.forEach(e=>{t.push(this.componentData.get(e))}),t.sort(function(e,t){return e.weight-t.weight}),t.forEach(function(e){i.push(e.component)})}else e.forEach(e=>{i.push(this.componentData.get(e).component)});return i}}),Jl=(Kl.Capability=Xl,(t=(t=Kl=Kl||{}).ComponentWeight||(t.ComponentWeight={}))[t.TOOLBOX_WEIGHT=0]="TOOLBOX_WEIGHT",t[t.FLYOUT_WEIGHT=1]="FLYOUT_WEIGHT",t[t.TRASHCAN_WEIGHT=2]="TRASHCAN_WEIGHT",t[t.ZOOM_CONTROLS_WEIGHT=3]="ZOOM_CONTROLS_WEIGHT",Kl.ComponentWeight,!1),ql='\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n  user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyEmboss {\n  filter: var(--blocklyEmbossFilter);\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv:focus {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyHighlighted>.blocklyPath {\n  filter: var(--blocklyEmbossFilter);\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n  /* Drag surface disables events to not block the toolbox, so we have to\n   * reenable them here for the cursor values to work. */\n  pointer-events: auto;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabledPattern>.blocklyPath {\n  fill: var(--blocklyDisabledPattern);\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyNonEditableField>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don\'t allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n  height: 100%;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n  pointer-events: none;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu:focus {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;\n  outline: none;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n\n.blocklyMenuSeparator {\n  background-color: #ccc;\n  height: 1px;\n  border: 0;\n  margin-left: 4px;\n  margin-right: 4px;\n}\n\n.blocklyBlockDragSurface, .blocklyAnimationLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 80;\n  pointer-events: none;\n}\n\n.blocklyField {\n  cursor: default;\n}\n\n.blocklyInputField {\n  cursor: text;\n}\n\n.blocklyDragging .blocklyField,\n.blocklyDragging .blocklyIconGroup {\n  cursor: grabbing;\n}\n\n.blocklyActiveFocus:is(\n  .blocklyFlyout,\n  .blocklyWorkspace,\n  .blocklyField,\n  .blocklyPath,\n  .blocklyHighlightedConnectionPath,\n  .blocklyComment,\n  .blocklyBubble,\n  .blocklyIconGroup,\n  .blocklyTextarea\n) {\n  outline: none;\n}\n',Zl={},y=(Zl.inject=fe,Zl.register=be,class{constructor(e,t){this.x=e,this.y=t}clone(){return new y(this.x,this.y)}scale(e){return this.x*=e,this.y*=e,this}translate(e,t){return this.x+=e,this.y+=t,this}static equals(e,t){return e===t||!(!e||!t)&&e.x===t.x&&e.y===t.y}static distance(e,t){var i=e.x-t.x;return e=e.y-t.y,Math.sqrt(i*i+e*e)}static magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static difference(e,t){return new y(e.x-t.x,e.y-t.y)}static sum(e,t){return new y(e.x+t.x,e.y+t.y)}}),k=class{constructor(e){this.tagName=e}toString(){return this.tagName}},I=(k.ANIMATE=new k("animate"),k.CIRCLE=new k("circle"),k.CLIPPATH=new k("clipPath"),k.DEFS=new k("defs"),k.FECOMPOSITE=new k("feComposite"),k.FECOMPONENTTRANSFER=new k("feComponentTransfer"),k.FEFLOOD=new k("feFlood"),k.FEFUNCA=new k("feFuncA"),k.FEGAUSSIANBLUR=new k("feGaussianBlur"),k.FEPOINTLIGHT=new k("fePointLight"),k.FESPECULARLIGHTING=new k("feSpecularLighting"),k.FILTER=new k("filter"),k.FOREIGNOBJECT=new k("foreignObject"),k.G=new k("g"),k.IMAGE=new k("image"),k.LINE=new k("line"),k.PATH=new k("path"),k.PATTERN=new k("pattern"),k.POLYGON=new k("polygon"),k.RECT=new k("rect"),k.SVG=new k("svg"),k.TEXT=new k("text"),k.TSPAN=new k("tspan"),class{constructor(e,t,i,s){this.top=e,this.bottom=t,this.left=i,this.right=s}static from(e){return new I(e.y,e.y+e.height,e.x,e.x+e.width)}clone(){return new I(this.top,this.bottom,this.left,this.right)}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}getOrigin(){return new y(this.left,this.top)}contains(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}intersects(e){return this.left<=e.right&&this.right>=e.left&&this.bottom>=e.top&&this.top<=e.bottom}static equals(e,t){return e===t||!(!e||!t)&&e.top===t.top&&e.bottom===t.bottom&&e.left===t.left&&e.right===t.right}static createFromPoint(e,t,i){var s=e.x;return new I(e=e.y,e+i,s,s+t)}}),C=class{constructor(e,t){this.width=e,this.height=t}static equals(e,t){return e===t||!(!e||!t)&&e.width===t.width&&e.height===t.height}static max(e,t){return new C(Math.max(e.width,t.width),Math.max(e.height,t.height))}static min(e,t){return new C(Math.min(e.width,t.width),Math.min(e.height,t.height))}},Ql={getSizeInternal:ga},ea={TEST_ONLY:Ql},ta=(ea.getBorderBox=Ie,ea.getComputedStyle=ve,ea.getContainerOffsetToScrollInto=Se,ea.getPageOffset=ye,ea.getSize=Te,ea.getViewportPageOffset=ke,ea.scrollIntoContainerView=Ce,/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/),ia=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,i={TEST_ONLY:{XY_REGEX:ta,XY_STYLE_REGEX:ia}},sa=(i.getDocumentScroll=Re,i.getInjectionDivXY=Ae,i.getRelativeXY=we,i.getViewportBBox=xe,i.screenToWsCoordinates=Oe,i.wsToScreenCoordinates=Ne,class{constructor(e,t,i,s,o){this.workspace=e,this.horizontal=t,this.oldHostMetrics=null,this.ratio=1,this.origin=new y(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new y(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=i||!1,this.margin=void 0!==o?o:sa.DEFAULT_SCROLLBAR_MARGIN,e="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),s&&(e+=" "+s),this.outerSvg=a(k.SVG,{class:e}),s=a(k.G,{},this.outerSvg),this.svgBackground=a(k.RECT,{class:"blocklyScrollbarBackground"},s),e=Math.floor((sa.scrollbarThickness-5)/2),this.svgHandle=a(k.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},s),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),j(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),t?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=p(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=p(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){var e=sa.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(e)),this.outerSvg.setAttribute("height",String(e)),this.svgHandle.setAttribute("height",String(e-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(e)),this.outerSvg.setAttribute("width",String(e)),this.svgHandle.setAttribute("width",String(e-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),n(this.onMouseDownBarWrapper_),n(this.onMouseDownHandleWrapper_),l(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(e){return e<=0||isNaN(e)?0:Math.min(e,this.scrollbarLength)}setHandleLength(e){this.handleLength=e,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(e){return e<=0||isNaN(e)?0:Math.min(e,this.scrollbarLength-this.handleLength)}setHandlePosition(e){this.handlePosition=e,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(e){this.scrollbarLength=e,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(e,t){this.position.x=e,this.position.y=t,Y(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(e){!e&&!(e=this.workspace.getMetrics())||this.oldHostMetrics&&sa.metricsAreEquivalent(e,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(e):this.resizeVertical(e),this.oldHostMetrics=e,this.updateMetrics())}requiresViewResize(e){return!this.oldHostMetrics||this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics.absoluteTop!==e.absoluteTop}resizeHorizontal(e){this.requiresViewResize(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)}resizeViewHorizontal(e){var t=e.viewWidth-2*this.margin;this.pair&&(t-=sa.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),t=e.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(t+=sa.scrollbarThickness),this.setPosition(t,e.absoluteTop+e.viewHeight-sa.scrollbarThickness-this.margin),this.resizeContentHorizontal(e)}resizeContentHorizontal(e){var t,i;e.viewWidth>=e.scrollWidth?(this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1)):(this.pair||this.setVisible(!0),t=this.scrollbarLength*e.viewWidth/e.scrollWidth,t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollWidth-e.viewWidth,i=this.scrollbarLength-this.handleLength,e=this.constrainHandlePosition(e=(e.viewLeft-e.scrollLeft)/t*i),this.setHandlePosition(e),this.ratio=i/t)}resizeVertical(e){this.requiresViewResize(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)}resizeViewVertical(e){let t=e.viewHeight-2*this.margin;this.pair&&(t-=sa.scrollbarThickness),this.setScrollbarLength(Math.max(0,t)),this.setPosition(this.workspace.RTL?e.absoluteLeft+this.margin:e.absoluteLeft+e.viewWidth-sa.scrollbarThickness-this.margin,e.absoluteTop+this.margin),this.resizeContentVertical(e)}resizeContentVertical(e){var t,i;e.viewHeight>=e.scrollHeight?(this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1)):(this.pair||this.setVisible(!0),t=this.scrollbarLength*e.viewHeight/e.scrollHeight,t=this.constrainHandleLength(t),this.setHandleLength(t),t=e.scrollHeight-e.viewHeight,i=this.scrollbarLength-this.handleLength,e=this.constrainHandlePosition(e=(e.viewTop-e.scrollTop)/t*i),this.setHandlePosition(e),this.ratio=i/t)}isVisible(){return this.isHandleVisible}setContainerVisible(e){var t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay_()}setVisible(e){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(e)}setVisibleInternal(e){var t=e!==this.isVisible();this.isHandleVisible=e,t&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(e){var t,i,s,o;this.workspace.markFocused(),fr(),this.cleanUp(),Ir(e)?e.stopPropagation():(t=Cr(e,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM()),t=this.horizontal?t.x:t.y,i=Ae(this.svgHandle),i=this.horizontal?i.x:i.y,s=this.handlePosition,o=.95*this.handleLength,t<=i?s-=o:t>=i+this.handleLength&&(s+=o),this.setHandlePosition(this.constrainHandlePosition(s)),this.updateMetrics(),e.stopPropagation(),e.preventDefault())}onMouseDownHandle(e){this.workspace.markFocused(),this.cleanUp(),Ir(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?e.clientX:e.clientY,this.onMouseUpWrapper_=p(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=p(document,"pointermove",this,this.onMouseMoveHandle),e.stopPropagation(),e.preventDefault())}onMouseMoveHandle(e){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?e.clientX:e.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){fr(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(n(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(n(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let e=this.handlePosition/(this.scrollbarLength-this.handleLength);return e=isNaN(e)?0:e}updateMetrics(){var e=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:e}):this.workspace.setMetrics({y:e})}set(e,t){this.setHandlePosition(this.constrainHandlePosition(e*this.ratio)),!t&&void 0!==t||this.updateMetrics()}setOrigin(e,t){this.origin=new y(e,t)}static metricsAreEquivalent(e,t){return e.viewWidth===t.viewWidth&&e.viewHeight===t.viewHeight&&e.viewLeft===t.viewLeft&&e.viewTop===t.viewTop&&e.absoluteTop===t.absoluteTop&&e.absoluteLeft===t.absoluteLeft&&e.scrollWidth===t.scrollWidth&&e.scrollHeight===t.scrollHeight&&e.scrollLeft===t.scrollLeft&&e.scrollTop===t.scrollTop}}),oa=(sa.scrollbarThickness=Vr?25:15,sa.DEFAULT_SCROLLBAR_MARGIN=.5,{parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}}),na={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:ra,DOMParser:la,XMLSerializer:aa}=globalThis,ca=(la&&(oa=new la),aa&&(na=new aa),"https://developers.google.com/blockly/xml"),ua=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,Xl={NAME_SPACE:ca},ha=(Xl.createElement=_.createElement$$module$build$src$core$utils$xml,Xl.createTextNode=_.createTextNode$$module$build$src$core$utils$xml,Xl.domToText=$e,Xl.injectDependencies=fa,Xl.textToDom=_.textToDom$$module$build$src$core$utils$xml,"categoryToolbox"),da="flyoutToolbox",pa=((t=T=T||{})[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",{hasCategoriesInternal:ma}),ga={},ma=(ga.Position=T,ga.TEST_ONLY=pa,ga.convertFlyoutDefToJsonArray=Be,ga.convertToolboxDefToJson=Me,ga.hasCategories=Pe,ga.isCategoryCollapsible=Fe,ga.parseToolboxTree=Ve,(Vr=Qr=Qr||{})[Vr.TOP=0]="TOP",Vr[Vr.BOTTOM=1]="BOTTOM",(fa=el=el||{})[fa.LEFT=0]="LEFT",fa[fa.RIGHT=1]="RIGHT",(t=tl=tl||{})[t.UP=0]="UP",t[t.DOWN=1]="DOWN",{}),_a=(ma.bumpDirection=tl,ma.bumpPositionRect=je,ma.getCornerOppositeToolbox=ze,ma.getStartPositionRect=We,ma.horizontalPosition=el,ma.verticalPosition=Qr,{width:96,height:124,url:"sprites.png"}),ba=class{constructor(e){this.workspace=e,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=a(k.G,{});var e=String(Math.random()).substring(2);return this.createZoomOutSvg(e),this.createZoomInSvg(e),this.workspace.isMovable()&&this.createZoomResetSvg(e),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:Kl.ComponentWeight.ZOOM_CONTROLS_WEIGHT,capabilities:[Kl.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&l(this.svgGroup);for(var e of this.boundEvents)n(e);this.boundEvents.length=0}getBoundingRectangle(){let e=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(e+=this.LARGE_SPACING+this.HEIGHT),new I(this.top,this.top+e,this.left,this.left+this.WIDTH)}position(e,t){var i,s,o,n;this.initialized&&(i=ze(this.workspace,e),o=this.SMALL_SPACING+2*this.HEIGHT,this.zoomResetGroup&&(o+=this.LARGE_SPACING+this.HEIGHT),e=We(i,new C(this.WIDTH,o),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,e,this.workspace),i=i.vertical,t=je(e,this.MARGIN_VERTICAL,i===Qr.TOP?tl.DOWN:tl.UP,t),i===Qr.TOP?(s=this.SMALL_SPACING+this.HEIGHT,null!=(n=this.zoomInGroup)&&n.setAttribute("transform","translate(0, "+s+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+(s+this.LARGE_SPACING+this.HEIGHT)+")")):(n=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0,null!=(o=this.zoomInGroup)&&o.setAttribute("transform","translate(0, "+n+")"),n=n+this.SMALL_SPACING+this.HEIGHT,null!=(s=this.zoomOutGroup)&&s.setAttribute("transform","translate(0, "+n+")")),this.top=t.top,this.left=t.left,null!=(e=this.svgGroup))&&e.setAttribute("transform","translate("+this.left+","+this.top+")")}createZoomOutSvg(e){this.zoomOutGroup=a(k.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);var t=a(k.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup);a(k.RECT,{width:32,height:32},t),a(k.IMAGE,{width:_a.width,height:_a.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup).setAttributeNS(Nl,"xlink:href",this.workspace.options.pathToMedia+_a.url),this.boundEvents.push(p(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(e){this.zoomInGroup=a(k.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);var t=a(k.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup);a(k.RECT,{width:32,height:32},t),a(k.IMAGE,{width:_a.width,height:_a.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup).setAttributeNS(Nl,"xlink:href",this.workspace.options.pathToMedia+_a.url),this.boundEvents.push(p(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(e,t){this.workspace.markFocused(),this.workspace.zoomCenter(e),this.fireZoomEvent(),fr(),t.stopPropagation(),t.preventDefault()}createZoomResetSvg(e){this.zoomResetGroup=a(k.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);var t=a(k.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup);a(k.RECT,{width:32,height:32},t),a(k.IMAGE,{width:_a.width,height:_a.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup).setAttributeNS(Nl,"xlink:href",this.workspace.options.pathToMedia+_a.url),this.boundEvents.push(p(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(e){this.workspace.markFocused();var t=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(t),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),fr(),e.stopPropagation(),e.preventDefault()}fireZoomEvent(){var e=new(m(f.CLICK))(null,this.workspace.id,"zoom_controls");g(e)}},Vr=(be("\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n"),{BLOCKS:50,PROCEDURES:75,VARIABLES:100,WORKSPACE_COMMENTS:25}),fa={},t=(fa.register=Zp,fa.unregister=Ta,class{constructor(){this.priority=25}save(e){var t,i=[];for(t of e.getTopComments())(e=Ye(t,{addCoordinates:!0,saveIds:!0}))&&i.push(e);return i.length?i:null}load(e,t){for(var i of e)Xe(i,t,{recordUndo:Cl})}clear(e){for(var t of e.getTopComments())t.dispose()}}),Ta=(Zp("workspaceComments",new t),{}),t=(Ta.WorkspaceCommentSerializer=t,Ta.append=Xe,Ta.save=Ye,{}),Ea=(t.register=up,t.unregister=S,class{paste(e,t,i){e=e.commentState,i&&(e.x=i.x,e.y=i.y),_.disable$$module$build$src$core$events$utils();let s;try{s=Xe(e,t),Ke(s)}finally{_.enable$$module$build$src$core$events$utils()}return s?(U()&&g(new(m(f.COMMENT_CREATE))(s)),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(s),s):null}}),va=(up(Ea.TYPE="workspace-comment",new Ea),_.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:28,connectingSnapRadius:28,currentConnectionPreference:8,bumpDelay:250},_.config$$module$build$src$core$config,"aria-"),ya="role",S=((S=il=il||{}).GRID="grid",S.GRIDCELL="gridcell",S.GROUP="group",S.LISTBOX="listbox",S.MENU="menu",S.MENUITEM="menuitem",S.MENUITEMCHECKBOX="menuitemcheckbox",S.OPTION="option",S.PRESENTATION="presentation",S.ROW="row",S.TREE="tree",S.TREEITEM="treeitem",S.SEPARATOR="separator",S.STATUS="status",(S=sl=sl||{}).ACTIVEDESCENDANT="activedescendant",S.COLCOUNT="colcount",S.DISABLED="disabled",S.EXPANDED="expanded",S.INVALID="invalid",S.LABEL="label",S.LABELLEDBY="labelledby",S.LEVEL="level",S.ORIENTATION="orientation",S.POSINSET="posinset",S.ROWCOUNT="rowcount",S.SELECTED="selected",S.SETSIZE="setsize",S.VALUEMAX="valuemax",S.VALUEMIN="valuemin",S.LIVE="live",S.HIDDEN="hidden",{}),ka=(S.Role=il,S.State=sl,S.setRole=qe,S.setState=Ze,class{constructor(e,t){this.content=e,this.opt_value=t,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){var e,t=document.createElement("div"),i=(t.id=wr(),(this.element=t).className="blocklyMenuItem "+(this.enabled?"":"blocklyMenuItemDisabled ")+(this.checked?"blocklyMenuItemSelected ":"")+(this.highlight?"blocklyMenuItemHighlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl ":""),document.createElement("div"));return i.className="blocklyMenuItemContent",this.checkable&&((e=document.createElement("div")).className="blocklyMenuItemCheckbox ",i.appendChild(e)),e=this.content,"string"==typeof this.content&&(e=document.createTextNode(this.content)),i.appendChild(e),t.appendChild(i),this.roleName&&qe(t,this.roleName),Ze(t,sl.SELECTED,this.checkable&&this.checked||!1),Ze(t,sl.DISABLED,!this.enabled),t}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){var e;return null!=(e=this.opt_value)?e:null}setRightToLeft(e){this.rightToLeft=e}setRole(e){this.roleName=e}setCheckable(e){this.checkable=e}setChecked(e){this.checked=e}setHighlighted(e){this.highlight=e;var t=this.getElement();t&&this.isEnabled()&&(e?c:r)(t,"blocklyMenuItemHighlight")}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}performAction(e){this.isEnabled()&&this.actionHandler&&this.actionHandler(this,e)}onAction(e,t){this.actionHandler=e.bind(t)}}),Ia=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.pointerLeaveHandler=this.pointerEnterHandler=this.clickHandler=this.pointerMoveHandler=this.highlightedItem=this.openingCoords=null}addChild(e){this.menuItems.push(e)}render(e){var i=document.createElement("div");i.className="blocklyMenu",i.tabIndex=0,this.roleName&&qe(i,this.roleName),this.element=i;for(let e=0,t;t=this.menuItems[e];e++)i.appendChild(t.createDom());return this.pointerMoveHandler=p(i,"pointermove",this,this.handlePointerMove,!0),this.clickHandler=p(i,"pointerup",this,this.handleClick,!0),this.pointerEnterHandler=p(i,"pointerenter",this,this.handlePointerEnter,!0),this.pointerLeaveHandler=p(i,"pointerleave",this,this.handlePointerLeave,!0),this.onKeyDownHandler=p(i,"keydown",this,this.handleKeyEvent),e.appendChild(i),i}getElement(){return this.element}focus(){var e=this.getElement();e&&e.focus({preventScroll:!0})}blur(){var e=this.getElement();e&&e.blur()}setRole(e){this.roleName=e}dispose(){this.pointerMoveHandler&&(n(this.pointerMoveHandler),this.pointerMoveHandler=null),this.clickHandler&&(n(this.clickHandler),this.clickHandler=null),this.pointerEnterHandler&&(n(this.pointerEnterHandler),this.pointerEnterHandler=null),this.pointerLeaveHandler&&(n(this.pointerLeaveHandler),this.pointerLeaveHandler=null),this.onKeyDownHandler&&(n(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let e=0,t;t=this.menuItems[e];e++)t.dispose();this.element=null}getMenuItem(i){for(var e=this.getElement();i&&i!==e;){if(i.classList.contains("blocklyMenuItem")){var s=this.getMenuItems();for(let e=0,t;t=s[e];e++)if(t.getElement()===i)return t}i=i.parentElement}return null}setHighlighted(e){var t,i=this.highlightedItem;i&&(i.setHighlighted(!1),this.highlightedItem=null),e&&(e.setHighlighted(!0),this.highlightedItem=e,i=this.getElement(),t=e.getElement(),i)&&t&&(Ce(t,i),Ze(i,sl.ACTIVEDESCENDANT,e.getId()))}highlightNext(){var e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e,1)}highlightPrevious(){var e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e<0?this.menuItems.length:e,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(e,t){e+=t;for(var i,s=this.getMenuItems();i=s[e];){if(i.isEnabled()){this.setHighlighted(i);break}e+=t}}handlePointerMove(e){0!==Math.max(Math.abs(e.movementX),Math.abs(e.movementY))&&(e=this.getMenuItem(e.target))&&(e.isEnabled()?this.highlightedItem!==e&&this.setHighlighted(e):this.setHighlighted(null))}handleClick(e){var t=this.openingCoords;if(this.openingCoords=null,t&&"number"==typeof e.clientX){var i=new y(e.clientX,e.clientY);if(y.distance(t,i)<1)return}(t=this.getMenuItem(e.target))&&t.performAction(e)}handlePointerEnter(e){this.focus()}handlePointerLeave(e){this.getElement()&&this.setHighlighted(null)}handleKeyEvent(e){if(this.menuItems.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var t=this.highlightedItem;switch(e.key){case"Enter":case" ":t&&t.performAction(e);break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}e.preventDefault(),e.stopPropagation()}}getSize(){var e=this.getElement(),t=Te(e);return t.height=e.scrollHeight,t}getMenuItems(){return this.menuItems.filter(e=>e instanceof ka)}},Ca=class{constructor(){this.element=null}createDom(){return this.element=document.createElement("hr"),this.element.className="blocklyMenuSeparator",qe(this.element,il.SEPARATOR),this.element}dispose(){var e;null!=(e=this.element)&&e.remove(),this.element=null}},Sa="_TEMP_COLLAPSED_INPUT",wa="_TEMP_COLLAPSED_FIELD",Aa="MANUALLY_DISABLED",xa={COLLAPSED_FIELD_NAME:wa,COLLAPSED_INPUT_NAME:Sa,MANUALLY_DISABLED:Aa},Ra=((Da=_.inputTypes$$module$build$src$core$inputs$input_types||(_.inputTypes$$module$build$src$core$inputs$input_types={}))[Da.VALUE=1]="VALUE",Da[Da.STATEMENT=3]="STATEMENT",Da[Da.DUMMY=5]="DUMMY",Da[Da.CUSTOM=6]="CUSTOM",Da[Da.END_ROW=7]="END_ROW",_.inputTypes$$module$build$src$core$inputs$input_types,new Set),Oa=new WeakSet,Na=new WeakMap,$a=null,La=null,Ma=0,Da={},Ba=(Da.finishQueuedRenders=tt,Da.queueRender=et,Da.triggerQueuedRenders=it,_.Msg$$module$build$src$core$msg=Object.create(null),Jh={Msg:_.Msg$$module$build$src$core$msg,setLocale:ol=function(t){Object.keys(t).forEach(function(e){_.Msg$$module$build$src$core$msg[e]=t[e]})}},"blocklyToast"),Pa="blocklyToastMessage",Fa="blocklyToastCloseButton",Ua=class{static show(e,t){if(t.oncePerSession&&t.id){if(this.shownIds.has(t.id))return;this.shownIds.add(t.id)}this.hide(e);let i=this.createDom(e,t);requestAnimationFrame(()=>{i.style.bottom="2rem"})}static createDom(e,t){let{message:i,duration:s=5,assertiveness:o=Ua.Assertiveness.POLITE}=t,n=document.createElement("div");e.getInjectionDiv().appendChild(n),n.dataset.toastId=t.id,n.className=Ba,qe(n,il.STATUS),Ze(n,sl.LIVE,o),(t=n.appendChild(document.createElement("div"))).className=Pa,t.innerText=i,(t=n.appendChild(document.createElement("button"))).className=Fa,Ze(t,sl.LABEL,_.Msg$$module$build$src$core$msg.CLOSE);var r=a(k.SVG,{width:24,height:24,viewBox:"0 0 24 24",fill:"none"},t);Ze(r,sl.HIDDEN,!0),a(k.RECT,{x:19.7782,y:2.80762,width:2,height:24,transform:"rotate(45, 19.7782, 2.80762)",fill:"black"},r),a(k.RECT,{x:2.80762,y:4.22183,width:2,height:24,transform:"rotate(-45, 2.80762, 4.22183)",fill:"black"},r),t.addEventListener("click",()=>{n.remove(),e.markFocused()});let l;return t=()=>{l=setTimeout(()=>n.remove(),1e3*s)},r=()=>clearTimeout(l),n.addEventListener("focusin",r),n.addEventListener("focusout",t),n.addEventListener("mouseenter",r),n.addEventListener("mousemove",r),n.addEventListener("mouseleave",t),t(),n}static hide(e,t){(e=e.getInjectionDiv().querySelector("."+Ba))instanceof HTMLElement&&(!t||t===e.dataset.toastId)&&e.remove()}},Ha=(Ua.shownIds=new Set,(Ka=(Ka=Ua=Ua||{}).Assertiveness||(Ka.Assertiveness={})).ASSERTIVE="assertive",Ka.POLITE="polite",be(`
.${Ba} {
  font-size: 1.2rem;
  position: absolute;
  bottom: -10rem;
  right: 2rem;
  padding: 1rem;
  color: black;
  background-color: white;
  border: 2px solid black;
  border-radius: 0.4rem;
  z-index: 999;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  line-height: 1.5;
  transition: bottom 0.3s ease-out;
}

.${Ba} .${Pa} {
  maxWidth: 18rem;
}

.${Ba} .${Fa} {
  margin: 0;
  padding: 0.2rem;
  background-color: transparent;
  color: black;
  border: none;
  cursor: pointer;
}
`),function(e,t){window.alert(e),t&&t()}),Ga=Ha,Va=function(e,t){t(window.confirm(e))},Wa=Va,za=function(e,t,i){i(window.prompt(e,t))},ja=za,Ya=Ua.show.bind(Ua),Xa=Ya,Ka={},Ja=(Ka.alert=ct,Ka.confirm=ut,Ka.prompt=ht,Ka.setAlert=w,Ka.setConfirm=tc,Ka.setPrompt=lc,Ka.setToast=ac,Ka.toast=cc,new Set),w={},qa=(w.warn=mt,"VARIABLE"),Za="ijkmnopqrstuvwxyzabcdefgh",Qa={generateUniqueNameInternal:pc},ec={CATEGORY_NAME:qa,TEST_ONLY:Qa,VAR_LETTER_OPTIONS:Za},tc=(ec.allDeveloperVariables=_.allDeveloperVariables$$module$build$src$core$variables,ec.allUsedVarModels=_.allUsedVarModels$$module$build$src$core$variables,ec.compareByName=Lt,ec.createVariableButtonHandler=It,ec.deleteVariable=_.deleteVariable$$module$build$src$core$variables,ec.flyoutCategory=bt,ec.flyoutCategoryBlocks=vt,ec.generateUniqueName=yt,ec.generateUniqueNameFromOptions=kt,ec.generateVariableFieldDom=Ot,ec.getAddedVariables=$t,ec.getOrCreateVariablePackage=_.getOrCreateVariablePackage$$module$build$src$core$variables,ec.getVariable=_.getVariable$$module$build$src$core$variables,ec.getVariableUsesById=Mt,ec.internalFlyoutCategory=_t,ec.jsonFlyoutCategoryBlocks=Tt,ec.nameUsedWithAnyType=wt,ec.nameUsedWithConflictingParam=At,ec.promptName=Ct,ec.renameVariable=_.renameVariable$$module$build$src$core$variables,class extends Error{}),ic=class extends tc{constructor(e){super("Expected to find a 'type' property, defining the block type"),this.state=e}},sc=class extends tc{constructor(e,t,i){super(`The block ${t.toDevString()} is missing a(n) ${e}
connection`),this.block=t,this.state=i}},oc=class extends tc{constructor(e,t,i,s){super(`The block ${i.toDevString()} could not connect its
${t} to its parent, because: `+e),this.childBlock=i,this.childState=s}},nc=class extends tc{constructor(e){super("Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren"),this.state=e}},rc=class extends tc{constructor(e,t,i){super(`Cannot add an icon of type '${e}' to the block `+t.toDevString()+", because there is no icon registered with "+`type '${e}'. Make sure that all of your icons have been `+"registered."),this.block=t,this.state=i}},lc={},ac=(lc.BadConnectionCheck=oc,lc.DeserializationError=tc,lc.MissingBlockType=ic,lc.MissingConnection=sc,lc.RealChildOfShadow=nc,lc.UnregisteredIcon=rc,class{constructor(){this.priority=50}save(e){var t,i=[];for(t of e.getTopBlocks(!1))(e=Dt(t,{addCoordinates:!0,doFullSerialization:!1}))&&i.push(e);return i.length?{languageVersion:0,blocks:i}:null}load(e,t){for(var i of e=e.blocks)zt(i,t,{recordUndo:Cl})}clear(e){for(var t of e.getTopBlocks(!1))t.dispose(!1)}}),cc=(Zp("blocks",new ac),{}),uc=(cc.BlockSerializer=ac,cc.append=zt,cc.appendInternal=jt,cc.save=Dt,class{constructor(e){this.name=e}toString(){return this.name}equals(e){return this.name===e.toString()}}),hc=(uc.MUTATOR=new uc("mutator"),uc.WARNING=new uc("warning"),uc.COMMENT=new uc("comment"),class extends Wl{constructor(e){super(),this.isBlank=!e,e&&(this.blockId=e.id,this.workspaceId=e.workspace.id)}toJson(){var e=super.toJson();if(this.blockId)return e.blockId=this.blockId,e;throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new hc)).blockId=e.blockId,t}}),dc=class extends hc{constructor(e,t,i,s,o){super(e),this.type=f.BLOCK_CHANGE,e&&(this.element=t,this.name=i||void 0,this.oldValue=s,this.newValue=o)}toJson(){var e=super.toJson();if(this.element)return e.element=this.element,e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,this.disabledReason&&(e.disabledReason=this.disabledReason),e;throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new dc)).element=e.element,t.name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,void 0!==e.disabledReason&&(t.disabledReason=e.disabledReason),t}setDisabledReason(e){if("disabled"!==this.element)throw Error('Cannot set the disabled reason for a BlockChange event if the element is not "disabled".');this.disabledReason=e}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");var i,s=t.getIcon(uc.MUTATOR);switch(s&&ni(s)&&s.bubbleIsVisible()&&s.setBubbleVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":t.setCommentText(e||null);break;case"collapsed":t.setCollapsed(!!e);break;case"disabled":t.setDisabledReason(!!e,null!=(i=this.disabledReason)?i:Aa);break;case"inline":t.setInputsInline(!!e);break;case"mutation":i=dc.getExtraBlockState_(t),t.loadExtraState?t.loadExtraState(JSON.parse(e||"{}")):t.domToMutation&&t.domToMutation(_.textToDom$$module$build$src$core$utils$xml(e||"<mutation/>")),g(new dc(t,"mutation",null,i,e));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(e){return e.saveExtraState?(e=e.saveExtraState(!0))?JSON.stringify(e):"":e.mutationToDom&&(e=e.mutationToDom())?Ms(e):""}},pc=(o(b.EVENT,f.BLOCK_CHANGE,dc),{}),gc=(pc.clamp=li,pc.toDegrees=zc,pc.toRadians=ri,16),mc=1,_c=12,bc=16,fc=.25,Tc=null,Ec=null,vc="",yc="",kc=null,Ic=null,Cc=null,Sc=null,wc=null,Ac={getBoundsInfo:function(){var e=ye(kc),t=Te(kc);return{left:e.x,right:e.x+t.width,top:e.y,bottom:e.y+t.height,width:t.width,height:t.height}},getPositionMetrics:function(e,t,i,s){var o=Ac.getBoundsInfo(),n=Te(nl);return t+n.height<o.bottom?bi(e,t,o,n):s-n.height>o.top?fi(i,s,o,n):t+n.height<document.documentElement.clientHeight?bi(e,t,o,n):s-n.height>document.documentElement.clientTop?fi(i,s,o,n):Ti(e,o,n)}},tc={ANIMATION_TIME:fc,ARROW_HORIZONTAL_PADDING:_c,ARROW_SIZE:gc,BORDER_SIZE:mc,PADDING_Y:bc,TEST_ONLY:Ac},ac=(tc.clearContent=ui,tc.createDom=ai,tc.getContentDiv=Kc,tc.getOwner=Jc,tc.getPositionX=Ei,tc.hide=yi,tc.hideIfOwner=vi,tc.hideWithoutAnimation=ki,tc.isVisible=nu,tc.repositionForWindowResize=Ci,tc.setBoundsElement=ci,tc.setColour=hi,tc.show=_i,tc.showPositionedByBlock=cu,tc.showPositionedByField=di,{}),xc=(ac.commonWordPrefix=wi,ac.commonWordSuffix=Ai,ac.isNumber=_.isNumber$$module$build$src$core$utils$string,ac.shortestStringLength=Si,ac.wrap=_.wrap$$module$build$src$core$utils$string,void 0),Rc=!1,Oc=!1,Nc=50,$c=0,Lc=0,Mc=0,Dc=0,Bc=null,Pc=null,Fc=0,Uc=10,Hc=10,Gc=750,Vc=5,Wc=null,zc={HOVER_MS:Gc,LIMIT:Nc,MARGINS:Vc,OFFSET_X:Fc,OFFSET_Y:Uc,RADIUS_OK:Hc},jc=(zc.bindMouseEvents=Di,zc.block=Vi,zc.createDom=Mi,zc.dispose=Hi,zc.getCustomTooltip=cp,zc.getDiv=qd,zc.getTooltipOfObject=$i,zc.hide=Gi,zc.isVisible=hu,zc.setCustomTooltip=Iu,zc.unbindMouseEvents=Bi,zc.unblock=Wi,.45),Yc=.65,Xc={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},Kc={},Jc=(Kc.blend=Qi,Kc.getHsvSaturation=_h,Kc.getHsvValue=$u,Kc.hexToRgb=qi,Kc.hsvToHex=Zi,Kc.hueToHex=es,Kc.names=Xc,Kc.parse=Ki,Kc.rgbToHex=Ji,Kc.setHsvSaturation=Vu,Kc.setHsvValue=Wu,{}),A=(Jc.checkMessageReferences=L,Jc.parseBlockColour=os,Jc.replaceMessageReferences=ss,Jc.tokenizeInterpolation=is,class{get size_(){return this.size}set size_(e){this.size=e}constructor(e,t,i){this.DEFAULT_VALUE=null,this.name=void 0,this.tooltip=this.validator_=null,this.size=new C(0,0),this.constants_=this.mouseDownWrapper=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.id_=null,this.value_=("DEFAULT_VALUE"in new.target.prototype?new.target.prototype:this).DEFAULT_VALUE,this.size_=new C(0,0),e!==A.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t)&&this.setValidator(t)}configure_(e){e.tooltip&&this.setTooltip(ss(e.tooltip))}setSourceBlock(e){if(this.sourceBlock_)throw Error("Field already bound to a block");if((this.sourceBlock_=e).id.includes("_field"))throw Error("Field ID indicator is contained in block ID. This may cause "+`problems with focus: ${e.id}.`);this.id_=e.id+"_field_"+wr()}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){if(!this.fieldGroup_){var e=this.id_;if(!e)throw Error("Expected ID to be defined prior to init.");this.fieldGroup_=a(k.G,{id:e}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip),this.bindEvents_(),this.initModel(),this.applyColour()}}initView(){this.createBorderRect_(),this.createTextElement_(),this.fieldGroup_&&c(this.fieldGroup_,"blocklyField")}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=a(k.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=a(k.TEXT,{class:"blocklyText blocklyFieldText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){var e=this.getClickTarget_();if(!e)throw Error("A click target has not been set.");Di(e),this.mouseDownWrapper=p(e,"pointerdown",this,this.onMouseDown_)}fromXml(e){this.setValue(e.textContent)}toXml(e){return e.textContent=this.getValue(),e}saveState(e){return null!==(e=this.saveLegacyState(A))?e:this.getValue()}loadState(e){this.loadLegacyState(A,e)||this.setValue(e)}saveLegacyState(e){return e.prototype.saveState===this.saveState&&e.prototype.toXml!==this.toXml?((e=_.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name",this.name||""),$e(this.toXml(e)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(e,t){return e.prototype.loadState===this.loadState&&e.prototype.fromXml!==this.fromXml&&(this.fromXml(_.textToDom$$module$build$src$core$utils$xml(t)),!0)}dispose(){var e;vi(this),cs(this),null!=(e=this.getSourceBlock())&&e.isDeadOrDying()||l(this.fieldGroup_),this.disposed=!0}updateEditable(){var e=this.fieldGroup_,t=this.getSourceBlock();this.EDITABLE&&e&&t&&(this.enabled_&&t.isEditable()?(c(e,"blocklyEditableField"),r(e,"blocklyNonEditableField")):(c(e,"blocklyNonEditableField"),r(e,"blocklyEditableField")))}setEnabled(e){this.enabled_=e,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==A.prototype.showEditor_}isClickableInFlyout(e){return!e}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e}isVisible(){return this.visible_}setVisible(e){var t;this.visible_!==e&&(this.visible_=e,t=this.fieldGroup_)&&(t.style.display=e?"block":"none")}setValidator(e){this.validator_=e}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(this.borderRect_)return this.borderRect_;throw Error(`The border rectangle is ${this.borderRect_}.`)}getTextElement(){if(this.textElement_)return this.textElement_;throw Error(`The text element is ${this.textElement_}.`)}getTextContent(){if(this.textContent_)return this.textContent_;throw Error(`The text content is ${this.textContent_}.`)}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(e){this.isClickable()&&this.showEditor_(e)}showEditor_(e){}repositionForWindowResize(){return!1}updateSize_(e){var t=this.getConstants();let i=2*(e=void 0!==e?e:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING),s=t.FIELD_TEXT_HEIGHT,o=0;this.textElement_&&(o=J(this.textElement_),i+=o),this.isFullBlockField()||(s=Math.max(s,t.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=s,this.size_.width=i,this.positionTextElement_(e,o),this.positionBorderRect_()}positionTextElement_(e,t){var i,s,o;this.textElement_&&(i=this.getConstants(),s=this.size_.height/2,this.textElement_.setAttribute("x",String(null!=(o=this.getSourceBlock())&&o.RTL?this.size_.width-t-e:e)),this.textElement_.setAttribute("y",String(i.FIELD_TEXT_BASELINE_CENTER?s:s-i.FIELD_TEXT_HEIGHT/2+i.FIELD_TEXT_BASELINE)))}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_&&(this.render_(),this.isDirty_=!1),this.size_):new C(0,0)}getScaledBBox(){let e;var t,i,s=this.getSourceBlock();if(s)return this.isFullBlockField()?(t=this.sourceBlock_.getHeightWidth(),i=s.workspace.scale,e=this.getAbsoluteXY_(),s=(t.width+1)*i,t=(t.height+1)*i,ul?(e.x+=1.5*i,e.y+=1.5*i):(e.x-=.5*i,e.y-=.5*i)):(t=this.borderRect_.getBoundingClientRect(),e=ye(this.borderRect_),s=t.width,t=t.height),new I(e.y,e.y+t,e.x,e.x+s);throw new qc}onLocationChange(e){}getDisplayText_(){let e=this.getText();return e=(e=e.length>this.maxDisplayLength?e.substring(0,this.maxDisplayLength-2)+"â€¦":e).replace(/\s/g,A.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+="â€"),e}getText(){var e=this.getText_();return null!==e?String(e):String(this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_.queueRender()}setValue(e,t=!0){if(null!==e){var i=_.getGroup$$module$build$src$core$events$utils();i||_.setGroup$$module$build$src$core$events$utils(!0);try{var s,o,n,r,l,a=this.doClassValidation_(e),c=this.processValidation(e,a,t);c instanceof Error||(o=null==(s=this.getValidator())?void 0:s.call(this,c),(n=this.processValidation(c,o,t))instanceof Error)||(r=this.sourceBlock_)&&r.disposed||((l=this.getValue())===n?this.doValueUpdate_(n):(this.doValueUpdate_(n),t&&r&&U()&&g(new(m(f.BLOCK_CHANGE))(r,"field",this.name||null,l,n)),this.isDirty_&&this.forceRerender()))}finally{_.setGroup$$module$build$src$core$events$utils(i)}}}processValidation(e,t,i){return null===t?(this.doValueInvalid_(e,i),this.isDirty_&&this.forceRerender(),Error()):void 0===t?e:t}getValue(){return this.value_}doClassValidation_(e){return null==e?null:e}doValueUpdate_(e){this.value_=e,this.isDirty_=!0}doValueInvalid_(e,t){}onMouseDown_(e){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)}setTooltip(e){e||""===e||(e=this.sourceBlock_);var t=this.getClickTarget_();t?t.tooltip=e:this.tooltip=e}getTooltip(){var e=this.getClickTarget_();return $i(e||{tooltip:this.tooltip})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return ye(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let t=null;var i=this.getSourceBlock();if(!i)throw new qc;var s=i.inputList;for(let e=0;e<i.inputList.length;e++){var o=s[e],n=o.fieldRow;for(let e=0;e<n.length;e++)if(n[e]===this){t=o;break}}return t}getFlipRtl(){return!1}onShortcut(e){return!1}getFocusableElement(){if(this.fieldGroup_)return this.fieldGroup_;throw Error("This field currently has no representative DOM element.")}getFocusableTree(){var e=this.getSourceBlock();if(e)return e.workspace;throw new qc}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}static fromJson(e){throw Error("Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.")}}),qc=(A.NBSP="Â ",A.SKIP_SETUP=Symbol("SKIP_SETUP"),class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}}),Zc=null,Qc=null,eu=null,tu="blocklyWidgetDiv",iu="",su="",ou=null,nu={},ru=(nu.createDom=ns,nu.getDiv=zu,nu.hide=ls,nu.hideIfOwner=cs,nu.hideIfOwnerIsInWorkspace=us,nu.isVisible=as,nu.positionWithAnchor=ds,nu.repositionForWindowResize=_s,nu.show=rs,nu.testOnly_setDiv=ju,null),lu={},au=null,cu={},x=(cu.callbackFactory=_.callbackFactory$$module$build$src$core$contextmenu,cu.dispose=Is,cu.getCurrentBlock=Xu,cu.hide=ks,cu.setCurrentBlock=bs,cu.show=fs,class{constructor(){this.registeredItems=new Map,this.reset()}reset(){this.registeredItems.clear()}register(e){if(this.registeredItems.has(e.id))throw Error('Menu item with ID "'+e.id+'" is already registered.');this.registeredItems.set(e.id,e)}unregister(e){if(!this.registeredItems.has(e))throw Error('Menu item with ID "'+e+'" not found.');this.registeredItems.delete(e)}getItem(e){return null!=(e=this.registeredItems.get(e))?e:null}getContextMenuOptions(t,i){var s,o=[];for(s of this.registeredItems.values()){if(s.scopeType){if(s.scopeType===uu.BLOCK&&!t.block)continue;if(s.scopeType===uu.COMMENT&&!t.comment)continue;if(s.scopeType===uu.WORKSPACE&&!t.workspace)continue}let e;if(e={scope:t,weight:s.weight},s.separator)e=Object.assign({},e,{separator:!0});else{var n=s.preconditionFn(t,i);if("hidden"===n)continue;var r="function"==typeof s.displayText?s.displayText(t):s.displayText;e=Object.assign({},e,{text:r,callback:s.callback,enabled:"enabled"===n})}o.push(e)}return o.sort(function(e,t){return e.weight-t.weight}),o}}),uu=(cp=x=x||{},(qd=cp.ScopeType||(cp.ScopeType={})).BLOCK="block",qd.WORKSPACE="workspace",qd.COMMENT="comment",cp.registry=new cp,x.ScopeType),hu={BLOCK:50,BUBBLE:100},du=class{constructor(e){this.comment=e,this.startLoc=null,this.workspace=e.workspace}isMovable(){return this.comment.isOwnMovable()&&!this.comment.isDeadOrDying()&&!this.workspace.isReadOnly()}startDrag(){var e;this.fireDragStartEvent(),this.startLoc=this.comment.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1),null!=(e=this.workspace.getLayerManager())&&e.moveToDragLayer(this.comment),this.comment.setDragging(!0)}drag(e){this.comment.moveDuringDrag(e)}endDrag(){var e;this.fireDragEndEvent(),this.fireMoveEvent(),null!=(e=this.workspace.getLayerManager())&&e.moveOffDragLayer(this.comment,50),this.comment.setDragging(!1),this.comment.snapToGrid(),this.workspace.setResizesEnabled(!0)}fireDragStartEvent(){var e=new(m(f.COMMENT_DRAG))(this.comment,!0);g(e)}fireDragEndEvent(){var e=new(m(f.COMMENT_DRAG))(this.comment,!1);g(e)}fireMoveEvent(){var e;this.comment.isDeadOrDying()||((e=new(m(f.COMMENT_MOVE))(this.comment)).setReason(["drag"]),e.oldCoordinate_=this.startLoc,e.recordNew(),g(e))}revertDrag(){this.startLoc&&this.comment.moveDuringDrag(this.startLoc)}},pu=new WeakMap,gu=class{constructor(e,t,i){this.id=e,this.workspace=t,this.container=i}isVisible(){return this.icon.checkVisibility()}getParentComment(){var e=this.workspace.getCommentById(this.id);if(e)return e;throw Error(`Comment bar button ${this.id} has no corresponding comment`)}getSize(e=!1){var t=this.icon.getBBox(),t=I.from(t);return e&&(e=this.getMargin(),t.left-=e,t.top-=e,t.bottom+=e,t.right+=e),t}getMargin(){return(this.container.getBBox().height-this.icon.getBBox().height)/2}getFocusableElement(){return this.icon}getFocusableTree(){return this.workspace}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return this.isVisible()}},mu="_collapse_bar_button",_u=class extends gu{constructor(e,t,i){super(e,t,i),this.id=e,this.workspace=t,this.container=i,this.icon=a(k.IMAGE,{class:"blocklyFoldoutIcon",href:this.workspace.options.pathToMedia+"foldout-icon.svg",id:this.id+mu},this.container),this.bindId=p(this.icon,"pointerdown",this,this.performAction.bind(this))}dispose(){n(this.bindId)}reposition(){var e=this.getMargin();this.icon.setAttribute("y",""+e),this.icon.setAttribute("x",""+e)}performAction(e){fr();var t=this.getParentComment();t.view.bringToFront(),(e&&e instanceof PointerEvent&&Ir(e)||(t.setCollapsed(!t.isCollapsed()),this.workspace.hideChaff(),null!=e))&&e.stopPropagation()}},bu=({COMMENT_COLLAPSE_BAR_BUTTON_FOCUS_IDENTIFIER:mu}.CollapseCommentBarButton=_u,"_comment_textarea_"),fu=class{constructor(e,t,i){this.workspace=e,this.onFinishEditing=i,this.textChangeListeners=[],this.text="",this.foreignObject=a(k.FOREIGNOBJECT,{class:"blocklyCommentForeignObject"}),(e=document.createElementNS(Ol,"body")).setAttribute("xmlns",Ol),e.className="blocklyMinimalBody",this.textArea=document.createElementNS(Ol,"textarea"),this.textArea.setAttribute("tabindex","-1"),c(this.textArea,"blocklyCommentText"),c(this.textArea,"blocklyTextarea"),c(this.textArea,"blocklyText"),e.appendChild(this.textArea),this.foreignObject.appendChild(e),t&&(this.id=t+bu,this.textArea.setAttribute("id",this.id)),p(this.textArea,"change",this,this.onTextChange),p(this.textArea,"pointerdown",this,e=>{e.stopPropagation(),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this),fr()}),p(this.textArea,"keydown",this,this.handleKeyDown)}getDom(){return this.foreignObject}getText(){return this.text}setText(e){this.textArea.value=e,this.onTextChange()}onTextChange(){var t=this.text;this.text=this.textArea.value;for(let e=this.textChangeListeners.length-1;0<=e;e--)this.textChangeListeners[e](t,this.text)}handleKeyDown(e){("Escape"===e.key||"Enter"===e.key&&(e.ctrlKey||e.metaKey))&&(this.onFinishEditing&&this.onFinishEditing(),e.stopPropagation())}addTextChangeListener(e){this.textChangeListeners.push(e)}removeTextChangeListener(e){this.textChangeListeners.splice(this.textChangeListeners.indexOf(e),1)}setPlaceholderText(e){this.textArea.placeholder=e}setEditable(e){e?this.textArea.removeAttribute("readonly"):this.textArea.setAttribute("readonly","true")}updateSize(e,t){this.foreignObject.setAttribute("height",""+(e.height-t.height)),this.foreignObject.setAttribute("width",""+e.width),this.foreignObject.setAttribute("y",""+t.height),this.workspace.RTL&&this.foreignObject.setAttribute("x",""+-e.width)}getFocusableElement(){return this.textArea}getFocusableTree(){return this.workspace}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!!this.id}},Tu=({COMMENT_EDITOR_FOCUS_IDENTIFIER:bu}.CommentEditor=fu,"_delete_bar_button"),Eu=class extends gu{constructor(e,t,i){super(e,t,i),this.id=e,this.workspace=t,this.container=i,this.icon=a(k.IMAGE,{class:"blocklyDeleteIcon",href:this.workspace.options.pathToMedia+"delete-icon.svg",id:this.id+Tu},i),this.bindId=p(this.icon,"pointerdown",this,this.performAction.bind(this))}dispose(){n(this.bindId)}reposition(){var e=this.getMargin(),t=(this.icon.setAttribute("x","0"),this.container.getBBox());this.icon.setAttribute("y",""+e),this.icon.setAttribute("x",""+(t.width-this.getSize(!0).getWidth()))}performAction(e){fr(),e&&e instanceof PointerEvent&&Ir(e)?e.stopPropagation():(this.getParentComment().dispose(),null!=e&&e.stopPropagation(),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.workspace))}},vu=({COMMENT_DELETE_BAR_BUTTON_FOCUS_IDENTIFIER:Tu}.DeleteCommentBarButton=Eu,class{constructor(e,t){this.workspace=e,this.commentId=t,this.collapsed=!1,this.editable=!0,this.location=new y(0,0),this.sizeChangeListeners=[],this.disposeListeners=[],this.collapseChangeListeners=[],this.resizePointerMoveListener=this.resizePointerUpListener=null,this.disposed=this.disposing=!1,this.svgRoot=a(k.G,{class:"blocklyComment blocklyEditable blocklyDraggable"}),this.highlightRect=this.createHighlightRect(this.svgRoot),{topBarGroup:this.topBarGroup,topBarBackground:this.topBarBackground,deleteButton:this.deleteButton,foldoutButton:this.foldoutButton,textPreview:this.textPreview,textPreviewNode:this.textPreviewNode}=this.createTopBar(this.svgRoot),this.commentEditor=this.createTextArea(),this.resizeHandle=this.createResizeHandle(this.svgRoot,e),null!=(t=e.getLayerManager())&&t.append(this,50),this.size=vu.defaultCommentSize,this.setSizeWithoutFiringEvents(this.size),this.moveTo(new y(0,0))}createHighlightRect(e){return a(k.RECT,{class:"blocklyCommentHighlight"},e)}createTopBar(e){e=a(k.G,{class:"blocklyCommentTopbar"},e);var t=a(k.RECT,{class:"blocklyCommentTopbarBackground"},e),i=new Eu(this.commentId,this.workspace,e),s=new _u(this.commentId,this.workspace,e),o=a(k.TEXT,{class:"blocklyCommentPreview blocklyCommentText blocklyText"},e),n=document.createTextNode("");return o.appendChild(n),{topBarGroup:e,topBarBackground:t,deleteButton:i,foldoutButton:s,textPreview:o,textPreviewNode:n}}createTextArea(){var e=new fu(this.workspace,this.commentId,()=>this.svgRoot.focus());return this.svgRoot.appendChild(e.getDom()),e.addTextChangeListener((e,t)=>{this.updateTextPreview(t),this.setSize(this.size)}),e}getEditorFocusableNode(){return this.commentEditor}createResizeHandle(e,t){return e=a(k.IMAGE,{class:"blocklyResizeHandle",href:t.options.pathToMedia+"resize-handle.svg"},e),p(e,"pointerdown",this,this.onResizePointerDown),e}getSvgRoot(){return this.svgRoot}getSize(){return this.collapsed?this.topBarBackground.getBBox():this.size}setSizeWithoutFiringEvents(e){var t=this.topBarBackground.getBBox(),i=this.textPreview.getBBox(),s=this.resizeHandle.getBBox();this.size=e=C.max(e,this.calcMinSize(t)),this.svgRoot.setAttribute("height",""+e.height),this.svgRoot.setAttribute("width",""+e.width),this.updateHighlightRect(e),this.updateTopBarSize(e),this.commentEditor.updateSize(e,t),this.deleteButton.reposition(),this.foldoutButton.reposition(),this.updateTextPreviewSize(e,t,i),this.updateResizeHandlePosition(e,s)}setSize(e){var t=this.preResizeSize||this.size;this.setSizeWithoutFiringEvents(e),this.onSizeChange(t,this.size)}calcMinSize(e){var t;this.updateTextPreview(null!=(t=this.commentEditor.getText())?t:"");let i=t=J(this.textPreview);return this.foldoutButton.isVisible()?i+=this.foldoutButton.getSize(!0).getWidth():t&&(i+=4),this.deleteButton.isVisible()?i+=this.deleteButton.getSize(!0).getWidth():t&&(i+=4),new C(i,e.height+20)}updateHighlightRect(e){this.highlightRect.setAttribute("height",""+e.height),this.highlightRect.setAttribute("width",""+e.width),this.workspace.RTL&&this.highlightRect.setAttribute("x",""+-e.width)}updateTopBarSize(e){this.topBarBackground.setAttribute("width",""+e.width)}updateTextPreviewSize(e,t,i){t=(t.height-i.height)/2;var s=this.foldoutButton.getSize(!0),o=this.deleteButton.getSize(!0);e=e.width-s.getWidth()-o.getWidth(),this.textPreview.setAttribute("x",""+s.getWidth()),this.textPreview.setAttribute("y",""+(t+i.height/2)),this.textPreview.setAttribute("width",""+e)}updateResizeHandlePosition(e,t){this.resizeHandle.setAttribute("y",""+(e.height-t.height)),this.resizeHandle.setAttribute("x",""+(e.width-t.width))}onSizeChange(t,i){for(let e=this.sizeChangeListeners.length-1;0<=e;e--)this.sizeChangeListeners[e](t,i)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}removeSizeChangeListener(e){this.sizeChangeListeners.splice(this.sizeChangeListeners.indexOf(e),1)}onResizePointerDown(e){this.isEditable()&&(this.bringToFront(),Ir(e)||(this.preResizeSize=this.getSize(),Ss(this.workspace,e,new y(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=p(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=p(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation())}onResizePointerUp(e){fr(),this.resizePointerUpListener&&(n(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(n(this.resizePointerMoveListener),this.resizePointerMoveListener=null),this.setSize(this.size),this.preResizeSize=void 0}onResizePointerMove(e){e=ws(this.workspace,e),this.setSizeWithoutFiringEvents(new C(this.workspace.RTL?-e.x:e.x,e.y))}isCollapsed(){return this.collapsed}setCollapsed(e){((this.collapsed=e)?c:r)(this.svgRoot,"blocklyCollapsed"),this.setSizeWithoutFiringEvents(this.size),this.onCollapse()}onCollapse(){for(let e=this.collapseChangeListeners.length-1;0<=e;e--)this.collapseChangeListeners[e](this.collapsed)}addOnCollapseListener(e){this.collapseChangeListeners.push(e)}removeOnCollapseListener(e){this.collapseChangeListeners.splice(this.collapseChangeListeners.indexOf(e),1)}isEditable(){return this.editable}setEditable(e){((this.editable=e)?(c(this.svgRoot,"blocklyEditable"),r):(r(this.svgRoot,"blocklyEditable"),c))(this.svgRoot,"blocklyReadonly"),this.commentEditor.setEditable(e)}getRelativeToSurfaceXY(){return this.location}moveTo(e){this.location=e,this.svgRoot.setAttribute("transform",`translate(${e.x}, ${e.y})`)}getText(){return this.commentEditor.getText()}setText(e){this.commentEditor.setText(e)}setPlaceholderText(e){this.commentEditor.setPlaceholderText(e)}addTextChangeListener(e){this.commentEditor.addTextChangeListener(e)}removeTextChangeListener(e){this.commentEditor.removeTextChangeListener(e)}updateTextPreview(e){this.textPreviewNode.textContent=this.truncateText(e)}truncateText(e){return 12<=e.length?e.substring(0,9)+"...":e}bringToFront(){var e=this.svgRoot.parentNode,t=e.childNodes;t[t.length-1]!==this.svgRoot&&e.appendChild(this.svgRoot)}onDeleteDown(e){fr(),Ir(e)||this.dispose(),e.stopPropagation()}dispose(){this.disposing=!0,this.foldoutButton.dispose(),this.deleteButton.dispose(),l(this.svgRoot);for(let e=this.disposeListeners.length-1;0<=e;e--)this.disposeListeners[e]();this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}addDisposeListener(e){this.disposeListeners.push(e)}removeDisposeListener(e){this.disposeListeners.splice(this.disposeListeners.indexOf(e),1)}getCommentBarButtons(){return[this.foldoutButton,this.deleteButton]}}),yu=(vu.defaultCommentSize=new C(120,100),be("\n.injectionDiv {\n  --commentFillColour: #FFFCC7;\n  --commentBorderColour: #F2E49B;\n}\n\n.blocklyComment .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 1px solid var(--commentBorderColour);\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n\n.blocklyReadonly.blocklyComment .blocklyTextarea {\n  cursor: inherit;\n}\n\n.blocklyDeleteIcon {\n  width: 20px;\n  height: 20px;\n  display: none;\n  cursor: pointer;\n}\n\n.blocklyFoldoutIcon {\n  width: 20px;\n  height: 20px;\n  transform-origin: 12px 12px;\n  cursor: pointer;\n}\n.blocklyResizeHandle {\n  width: 12px;\n  height: 12px;\n  cursor: se-resize;\n}\n.blocklyReadonly.blocklyComment .blocklyResizeHandle {\n  cursor: inherit;\n}\n\n.blocklyCommentTopbarBackground {\n  fill: var(--commentBorderColour);\n  height: 24px;\n}\n\n.blocklyComment .blocklyCommentPreview.blocklyText {\n  fill: #000;\n  dominant-baseline: middle;\n  visibility: hidden;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentPreview {\n  visibility: visible;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,\n.blocklyCollapsed.blocklyComment .blocklyResizeHandle {\n  display: none;\n}\n\n.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {\n  transform: rotate(-90deg);\n}\n\n.blocklyRTL .blocklyCommentTopbar {\n  transform: scale(-1, 1);\n}\n\n.blocklyRTL .blocklyCommentForeignObject {\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyCommentPreview {\n  /* Revert the scale and control RTL using direction instead. */\n  transform: scale(-1, 1);\n  direction: rtl;\n}\n\n.blocklyRTL .blocklyResizeHandle {\n  transform: scale(-1, 1);\n  cursor: sw-resize;\n}\n\n.blocklyCommentHighlight {\n  fill: none;\n}\n\n.blocklyCommentText.blocklyActiveFocus {\n  border-color: #fc3;\n  border-width: 2px;\n}\n\n.blocklySelected .blocklyCommentHighlight {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {\n  stroke: none;\n}\n\n.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n"),class{constructor(e,t){this.workspace=e,this.text="",this.collapsed=!1,this.deletable=this.movable=this.editable=!0,this.location=new y(0,0),this.disposing=this.disposed=!1,this.id=t&&!e.getCommentById(t)?t:Ar(),this.size=vu.defaultCommentSize,e.addTopComment(this),this.fireCreateEvent()}fireCreateEvent(){U()&&g(new(m(f.COMMENT_CREATE))(this))}fireDeleteEvent(){U()&&g(new(m(f.COMMENT_DELETE))(this))}fireChangeEvent(e,t){U()&&g(new(m(f.COMMENT_CHANGE))(this,e,t))}fireCollapseEvent(e){U()&&g(new(m(f.COMMENT_COLLAPSE))(this,e))}setText(e){var t=this.text;this.text=e,this.fireChangeEvent(t,e)}getText(){return this.text}setSize(e){var t=new(m(f.COMMENT_RESIZE))(this);this.size=e,t.recordCurrentSizeAsNewSize(),g(t)}getSize(){return this.size}setCollapsed(e){this.collapsed=e,this.fireCollapseEvent(e)}isCollapsed(){return this.collapsed}setEditable(e){this.editable=e}isEditable(){return this.isOwnEditable()&&!this.workspace.isReadOnly()}isOwnEditable(){return this.editable}setMovable(e){this.movable=e}isMovable(){return this.isOwnMovable()&&!this.workspace.isReadOnly()&&!this.workspace.isFlyout}isOwnMovable(){return this.movable}setDeletable(e){this.deletable=e}isDeletable(){return this.isOwnDeletable()&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()&&!this.workspace.isFlyout}isOwnDeletable(){return this.deletable}moveTo(e,t){var i=new(m(f.COMMENT_MOVE))(this);t&&i.setReason(t),this.location=e,i.recordNew(),g(i)}getRelativeToSurfaceXY(){return this.location}dispose(){this.disposing=!0,this.fireDeleteEvent(),this.workspace.removeTopComment(this),this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}}),ku=class extends yu{constructor(e,t){super(e,t),this.dragStrategy=new du(this),this.workspace=e,this.view=new vu(e,this.id),this.view.setSize(this.getSize()),this.view.setEditable(this.isEditable()),this.view.getSvgRoot().setAttribute("data-id",this.id),this.view.getSvgRoot().setAttribute("id",this.id),this.addModelUpdateBindings(),p(this.view.getSvgRoot(),"pointerdown",this,this.startGesture),p(this.view.getSvgRoot(),"wheel",this,e=>{e.stopPropagation()})}addModelUpdateBindings(){this.view.addTextChangeListener((e,t)=>{super.setText(t)}),this.view.addSizeChangeListener((e,t)=>{super.setSize(t)}),this.view.addOnCollapseListener(()=>{super.setCollapsed(this.view.isCollapsed())}),this.view.addDisposeListener(()=>{this.isDeadOrDying()||this.dispose()})}setText(e){this.view.setText(e)}setPlaceholderText(e){this.view.setPlaceholderText(e)}setSize(e){this.view.setSize(e)}setCollapsed(e){this.view.setCollapsed(e)}setEditable(e){super.setEditable(e),this.view.setEditable(this.isEditable())}getSvgRoot(){return this.view.getSvgRoot()}getSize(){return super.getSize()}getBoundingRectangle(){var e,t=this.getRelativeToSurfaceXY(),i=null!=(s=null==(e=this.view)?void 0:e.getSize())?s:this.getSize(),s=this.workspace.RTL?(e=t.x-i.width,t.x):(e=t.x,t.x+i.width);return new I(t.y,t.y+i.height,e,s)}moveBy(e,t,i){var s=this.getRelativeToSurfaceXY();e=new y(s.x+e,s.y+t),this.moveTo(e,i)}moveTo(e,t){super.moveTo(e,t),this.view.moveTo(e)}moveDuringDrag(e){this.location=e,this.view.moveTo(e)}setDragging(e){(e?c:r)(this.getSvgRoot(),"blocklyDragging")}dispose(){this.disposing=!0;let e=_.getFocusManager$$module$build$src$core$focus_manager();e.getFocusedNode()===this&&setTimeout(()=>e.focusTree(this.workspace),0),this.view.isDeadOrDying()||this.view.dispose(),super.dispose()}startGesture(e){var t=this.workspace.getGesture(e);t&&(t.handleCommentStart(e,this),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this))}setDeleteStyle(e){(e?c:r)(this.getSvgRoot(),"blocklyDraggingDelete")}isCopyable(){return this.isOwnMovable()&&this.isOwnDeletable()}isMovable(){return this.dragStrategy.isMovable()}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){c(this.getSvgRoot(),"blocklySelected"),ce(this)}unselect(){r(this.getSvgRoot(),"blocklySelected"),ce(null)}toCopyData(){return{paster:Ea.TYPE,commentState:Ye(this,{addCoordinates:!0})}}showContextMenu(e){var t=x.registry.getContextMenuOptions({comment:this,focusedNode:this},e),i=e instanceof PointerEvent?new y(e.clientX,e.clientY):Ne(this.workspace,this.getRelativeToSurfaceXY()).translate(10,10);fs(e,t,this.workspace.RTL,this.workspace,i)}snapToGrid(){var e,t;this.isDeadOrDying()||null!=(t=this.workspace.getGrid())&&t.shouldSnap()&&(e=this.getRelativeToSurfaceXY(),(t=t.alignXY(e))!==e)&&this.moveTo(t,["snap"])}getEditorFocusableNode(){return this.view.getEditorFocusableNode()}getFocusableElement(){return this.getSvgRoot()}getFocusableTree(){return this.workspace}onNodeFocus(){var e;this.select(),null!=(e=this.workspace.getLayerManager())&&e.append(this,50)}onNodeBlur(){this.unselect()}canBeFocused(){return!0}},Iu={},Cu=(Iu.appendDomToWorkspace=eh,Iu.blockToDom=$s,Iu.blockToDomWithXY=Rs,Iu.clearWorkspaceAndLoadFromXml=lh,Iu.deleteNext=ch,Iu.domToBlock=_.domToBlock$$module$build$src$core$xml,Iu.domToBlockInternal=Bs,Iu.domToPrettyText=ph,Iu.domToText=Ms,Iu.domToVariables=Ps,Iu.domToWorkspace=_.domToWorkspace$$module$build$src$core$xml,Iu.loadWorkspaceComment=Ds,Iu.saveWorkspaceComment=As,Iu.variablesToDom=xs,Iu.workspaceToDom=gh,class extends hc{constructor(e){super(e),this.type=f.BLOCK_CREATE,e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=Rs(e),this.ids=H(e),this.json=Dt(e,{addCoordinates:!0}))}toJson(){var e=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(this.json)return e.xml=Ms(this.xml),e.ids=this.ids,e.json=this.json,this.recordUndo||(e.recordUndo=this.recordUndo),e;throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Cu)).xml=_.textToDom$$module$build$src$core$utils$xml(e.xml),t.ids=e.ids,t.json=e.json,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){var t=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!Su(t,this.ids))if(e)zt(this.json,t);else for(e=0;e<this.ids.length;e++){var i=this.ids[e],s=t.getBlockById(i);s?s.dispose(!1):i===this.blockId&&console.warn("Can't uncreate non-existent block: "+i)}}}),Su=function(t,e){return e.map(e=>t.getBlockById(e)).filter(e=>e&&e.isShadow()).length===e.length},wu=(o(b.EVENT,f.BLOCK_CREATE,Cu),class extends zl{constructor(e,t){super(t),this.type=f.THEME_CHANGE,this.themeName=e}toJson(){var e=super.toJson();if(this.themeName)return e.themeName=this.themeName,e;throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new wu)).themeName=e.themeName,t}}),Au=(o(b.EVENT,f.THEME_CHANGE,wu),class extends zl{constructor(e,t,i,s,o){super(s),this.type=f.VIEWPORT_CHANGE,this.viewTop=e,this.viewLeft=t,this.scale=i,this.oldScale=o}toJson(){var e=super.toJson();if(void 0===this.viewTop)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.viewLeft)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.scale)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(void 0===this.oldScale)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Au)).viewTop=e.viewTop,t.viewLeft=e.viewLeft,t.scale=e.scale,t.oldScale=e.oldScale,t}}),xu=(o(b.EVENT,f.VIEWPORT_CHANGE,Au),(_h=E=E||{})[_h.INPUT_VALUE=1]="INPUT_VALUE",_h[_h.OUTPUT_VALUE=2]="OUTPUT_VALUE",_h[_h.NEXT_STATEMENT=3]="NEXT_STATEMENT",_h[_h.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT",class{constructor(e){this.connectionChecker=e,this.connections=[]}addConnection(e,t){t=this.calculateIndexForYPos(t),this.connections.splice(t,0,e)}findIndexOfConnection(t,i){if(this.connections.length){var s=this.calculateIndexForYPos(i);if(!(s>=this.connections.length)){i=t.y;let e=s;for(;0<=e&&this.connections[e].y===i;){if(this.connections[e]===t)return e;e--}for(e=s;e<this.connections.length&&this.connections[e].y===i;){if(this.connections[e]===t)return e;e++}}}return-1}calculateIndexForYPos(e){if(!this.connections.length)return 0;let t=0,i=this.connections.length;for(;t<i;){var s=Math.floor((t+i)/2);if(this.connections[s].y<e)t=s+1;else{if(!(this.connections[s].y>e)){t=s;break}i=s}}return t}removeConnection(e,t){if(-1===(e=this.findIndexOfConnection(e,t)))throw Error("Unable to find connection in connectionDB.");this.connections.splice(e,1)}getNeighbours(e,s){function t(e){var t=n-o[e].x,i=r-o[e].y;return Math.sqrt(t*t+i*i)<=s&&a.push(o[e]),i<s}let o=this.connections,n=e.x,r=e.y,i=(e=0,o.length-2),l=i;for(;e<l;)o[l].y<r?e=l:i=l,l=Math.floor((e+i)/2);let a=[];if(i=e=l,o.length){for(;0<=e&&t(e);)e--;for(;++i<o.length&&t(i););}return a}isInYRange(e,t,i){return Math.abs(this.connections[e].y-t)<=i}searchForClosest(e,t,i){if(!this.connections.length)return{connection:null,radius:t};var s=e.y,o=e.x,n=(e.x=o+i.x,e.y=s+i.y,this.calculateIndexForYPos(e.y));i=null;let r=t,l,a=n-1;for(;0<=a&&this.isInYRange(a,e.y,t);)l=this.connections[a],this.connectionChecker.canConnect(e,l,!0,r)&&(i=l,r=l.distanceFrom(e)),a--;for(;n<this.connections.length&&this.isInYRange(n,e.y,t);)l=this.connections[n],this.connectionChecker.canConnect(e,l,!0,r)&&(i=l,r=l.distanceFrom(e)),n++;return e.x=o,e.y=s,{connection:i,radius:r}}static init(e){var t=[];return t[E.INPUT_VALUE]=new xu(e),t[E.OUTPUT_VALUE]=new xu(e),t[E.NEXT_STATEMENT]=new xu(e),t[E.PREVIOUS_STATEMENT]=new xu(e),t}}),Ru=class extends zl{constructor(e,t,i){super(i),this.type=f.SELECTED,this.oldElementId=null!=e?e:void 0,this.newElementId=null!=t?t:void 0}toJson(){var e=super.toJson();return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ru)).oldElementId=e.oldElementId,t.newElementId=e.newElementId,t}},Ou=(o(b.EVENT,f.SELECTED,Ru),class extends hc{constructor(e){if(super(e),this.type=f.BLOCK_DELETE,e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=Rs(e),this.ids=H(e),this.wasShadow=e.isShadow(),this.oldJson=Dt(e,{addCoordinates:!0})}}toJson(){var e=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(void 0===this.wasShadow)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(this.oldJson)return e.oldXml=Ms(this.oldXml),e.ids=this.ids,e.wasShadow=this.wasShadow,e.oldJson=this.oldJson,this.recordUndo||(e.recordUndo=this.recordUndo),e;throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ou)).oldXml=_.textToDom$$module$build$src$core$utils$xml(e.oldXml),t.ids=e.ids,t.wasShadow=e.wasShadow||"shadow"===t.oldXml.tagName.toLowerCase(),t.oldJson=e.oldJson,void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}run(e){var t=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(e)for(e=0;e<this.ids.length;e++){var i=this.ids[e],s=t.getBlockById(i);s?s.dispose(!1):i===this.blockId&&console.warn("Can't delete non-existent block: "+i)}else zt(this.oldJson,t)}}),Nu=(o(b.EVENT,f.BLOCK_DELETE,Ou),{fromJsonInternal:Lh}),$u={TEST_ONLY:Nu},Lu=($u.fromJson=_.fromJson$$module$build$src$core$field_registry,$u.register=qh,$u.unregister=Dh,class extends A{constructor(e,t,i){super(A.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,e!==A.SKIP_SETUP&&(this.setOptions(e),i&&this.configure_(i),t)&&this.setValidator(t)}fromXml(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)}loadState(e){this.loadLegacyState(Lu,e)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=a(k.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&c(this.borderRect_,"blocklyDropdownRect"),this.fieldGroup_&&(c(this.fieldGroup_,"blocklyField"),c(this.fieldGroup_,"blocklyDropdownField"))}shouldAddBorderRect_(){var e;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!(null!=(e=this.getSourceBlock())&&e.isShadow())}createTextArrow_(){var e;this.arrow=a(k.TSPAN,{},this.textElement_),this.arrow.appendChild(document.createTextNode(null!=(e=this.getSourceBlock())&&e.RTL?Lu.ARROW_CHAR+" ":" "+Lu.ARROW_CHAR)),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.arrow.setAttribute("dominant-baseline","central"),null!=(e=this.getSourceBlock())&&e.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=a(k.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(Nl,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(e){var t=this.getSourceBlock();if(!t)throw new qc;this.dropdownCreate(),this.menu_&&(this.menu_.openingCoords=e&&"number"==typeof e.clientX?new y(e.clientX,e.clientY):null,ui(),e=this.menu_.render(rl),c(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(t=t.getColour(),e=this.sourceBlock_.getColourTertiary(),hi(t,e)),di(this,this.dropdownDispose_.bind(this)),rl.style.height=this.menu_.getSize().height+"px",this.menu_.focus(),this.selectedMenuItem&&this.menu_.setHighlighted(this.selectedMenuItem),this.applyColour())}dropdownCreate(){var t=this.getSourceBlock();if(!t)throw new qc;var i=new Ia,s=(i.setRole(il.LISTBOX),this.menu_=i,this.getOptions(!1));this.selectedMenuItem=null;for(let e=0;e<s.length;e++){var o,n,r=s[e];r===Lu.SEPARATOR?i.addChild(new Ca):([o,n]=r,Js(o)?((r=new Image(o.width,o.height)).src=o.src,r.alt=o.alt):r=o,(r=new ka(r,n)).setRole(il.OPTION),r.setRightToLeft(t.RTL),r.setCheckable(!0),i.addChild(r),r.setChecked(n===this.value_),n===this.value_&&(this.selectedMenuItem=r),r.onAction(this.handleMenuActionEvent,this))}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(e){vi(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,t){this.setValue(t.getValue())}isOptionListDynamic(){return"function"==typeof this.menuGenerator_}getOptions(e){if(this.menuGenerator_)return Array.isArray(this.menuGenerator_)?this.menuGenerator_:(e&&this.generatedOptions||(this.generatedOptions=this.menuGenerator_(),this.validateOptions(this.generatedOptions)),this.generatedOptions);throw TypeError("A menu generator was never defined.")}setOptions(e){Array.isArray(e)?(this.validateOptions(e),e=this.trimOptions(e),this.menuGenerator_=e.options,this.prefixField=e.prefix||null,this.suffixField=e.suffix||null):this.menuGenerator_=e,this.selectedOption=this.getOptions(!1)[0],this.setValue(this.selectedOption[1])}doClassValidation_(t){return this.getOptions(!0).some(e=>e[1]===t)?t:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+t),null)}doValueUpdate_(i){super.doValueUpdate_(i),i=this.getOptions(!0);for(let e=0,t;t=i[e];e++)t[1]===this.value_&&(this.selectedOption=t)}applyColour(){var e=this.sourceBlock_;this.borderRect_&&(this.borderRect_.setAttribute("stroke",e.getColourTertiary()),this.menu_?this.borderRect_.setAttribute("fill",e.getColourTertiary()):this.borderRect_.setAttribute("fill","transparent")),e&&this.arrow&&(e.isShadow()?this.arrow.style.fill=e.getColourSecondary():this.arrow.style.fill=e.getColour())}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";var e=this.selectedOption&&this.selectedOption[0];Js(e)?this.renderSelectedImage(e):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(e){var t=this.getSourceBlock();if(!t)throw new qc;this.imageElement.style.display="",this.imageElement.setAttributeNS(Nl,"xlink:href",e.src),this.imageElement.setAttribute("height",String(e.height)),this.imageElement.setAttribute("width",String(e.width));var i=Number(e.height),s=(e=Number(e.width),!!this.borderRect_),o=Math.max(s?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,i+Lu.IMAGE_Y_PADDING),s=s?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,n=this.svgArrow?this.positionSVGArrow(e+s,o/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):J(this.arrow);this.size_.width=e+n+2*s,this.size_.height=o;let r=0;t.RTL?this.imageElement.setAttribute("x",""+(s+n)):(r=e+n,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",""+s)),this.imageElement.setAttribute("y",String(o/2-i/2)),this.positionTextElement_(r+s,e+n)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var e=this.getTextElement(),t=(c(e,"blocklyDropdownText"),e.setAttribute("text-anchor","start"),!!this.borderRect_),e=Math.max(t?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT),i=J(this.getTextElement()),t=t?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let s=0;this.svgArrow&&(s=this.positionSVGArrow(i+t,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=i+s+2*t,this.size_.height=e,this.positionTextElement_(t,i)}positionSVGArrow(e,t){if(!this.svgArrow)return 0;var i,s,o,n=this.getSourceBlock();if(n)return i=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,s=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,o=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE,this.svgArrow.setAttribute("transform","translate("+(n.RTL?i:e+s)+","+t+")"),o+s;throw new qc}getText_(){if(this.selectedOption){var e,t=this.selectedOption[0];if(Js(t))return t.alt;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return null!=(e=null!=(e=t.title)?e:t.ariaLabel)?e:t.innerText;if("string"==typeof t)return t;console.warn("Can't get text for existing dropdown option. If you're using HTMLElement dropdown options in node, ensure you're using jsdom-global or similar.")}return null}static fromJson(e){if(e.options)return new this(e.options,void 0,e);throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.")}trimOptions(e){let i=!1;var t,s,o,n=e.map(e=>{var t;return e===Lu.SEPARATOR?e:([e,t]=e,"string"==typeof e?[ss(e),t]:(i=!0,[Js(e)?Object.assign({},e,{alt:ss(e.alt)}):Object.assign({},e),t]))});return i||e.length<2||(t=n.map(([e])=>e),s=Si(t),e=wi(t,s),o=Ai(t,s),!e&&!o)||s<=e+o?{options:n}:(s=e?t[0].substring(0,e-1):void 0,t=o?t[0].substr(1-o):void 0,{options:this.applyTrim(n,e,o),prefix:s,suffix:t})}applyTrim(e,i,s){return e.map(([e,t])=>[e.substring(i,e.length-s),t])}validateOptions(t){if(!Array.isArray(t))throw TypeError("FieldDropdown options must be an array.");if(!t.length)throw TypeError("FieldDropdown options must not be an empty array.");let i=!1;for(let e=0;e<t.length;e++){var s=t[e];Array.isArray(s)||s===Lu.SEPARATOR?"string"!=typeof s[1]?(i=!0,console.error(`Invalid option[${e}]: Each FieldDropdown option id must be a string. 
          Found ${s[1]} in: `+s)):!s[0]||"string"==typeof s[0]||Js(s[0])||"undefined"!=typeof HTMLElement&&s[0]instanceof HTMLElement||(i=!0,console.error(`Invalid option[${e}]: Each FieldDropdown option must have a string 
          label, image description, or HTML element. Found ${s[0]} in: `+s)):(i=!0,console.error(`Invalid option[${e}]: Each FieldDropdown option must be an array or
          the string literal 'separator'. Found: `+s))}if(i)throw TypeError("Found invalid FieldDropdown options.")}}),Mu=(Lu.SEPARATOR="separator",Lu.ARROW_CHAR="â–¾",Lu.IMAGE_Y_OFFSET=5,Lu.IMAGE_Y_PADDING=2*Lu.IMAGE_Y_OFFSET,qh("field_dropdown",Lu),class{constructor(e,t,i,s){this.name=e,this.startHats=!1,this.blockStyles=t||Object.create(null),this.categoryStyles=i||Object.create(null),this.componentStyles=s||Object.create(null),this.fontStyle=Object.create(null),o(b.THEME,e,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(e,t){this.blockStyles[e]=t}setCategoryStyle(e,t){this.categoryStyles[e]=t}getComponentStyle(e){if(!(e=this.componentStyles[e]))return null;if("string"==typeof e){var t=this.getComponentStyle(e);if(t)return t}return""+e}setComponentStyle(e,t){this.componentStyles[e]=t}setFontStyle(e){this.fontStyle=e}setStartHats(e){this.startHats=e}static defineTheme(e,t){e=e.toLowerCase();var i,s=new Mu(e);let o=t.base;return o&&(o="string"==typeof o?null!=(i=pr(b.THEME,o))?i:void 0:o)instanceof Mu&&(te(s,o),s.name=e),te(s.blockStyles,t.blockStyles),te(s.categoryStyles,t.categoryStyles),te(s.componentStyles,t.componentStyles),te(s.fontStyle,t.fontStyle),null!==t.startHats&&(s.startHats=t.startHats),s}}),Du=new Mu("classic",{colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},{colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}}),Bu=class{constructor(e){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let t=null,i=!1;var s,o=!1,n=!1,r=!1,l=!1,a=!1,c=!!e.readOnly,u=(c||(t=Me(null!=(s=e.toolbox)?s:null),i=Pe(t),o=void 0===(o=e.trashcan)?i:o,n=void 0===(n=e.collapse)?i:n,r=void 0===(r=e.comments)?i:r,l=void 0===(l=e.disable)?i:l,a=void 0===(a=e.sounds)||a),s=e.maxTrashcanContents,o?void 0===s&&(s=32):s=0,!!e.rtl);let h=e.horizontalLayout;void 0===h&&(h=!1);var d="end"!==e.toolboxPosition,d=h?d?T.TOP:T.BOTTOM:d==u?T.RIGHT:T.LEFT;let p=e.css,g=(void 0===p&&(p=!0),"https://blockly-demo.appspot.com/static/media/");e.media&&(g=e.media.endsWith("/")?e.media:e.media+"/");var m=e.oneBasedIndex,_=e.renderer||"geras",b=e.plugins||{};let f=e.modalInputs;void 0===f&&(f=!0),this.RTL=u,this.oneBasedIndex=void 0===m||m,this.collapse=n,this.comments=r,this.disable=l,this.readOnly=c,this.maxBlocks=e.maxBlocks||1/0,this.maxInstances=null!=(u=e.maxInstances)?u:null,this.modalInputs=f,this.pathToMedia=g,this.hasCategories=i,this.moveOptions=Bu.parseMoveOptions(e,i),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=o,this.maxTrashcanContents=s,this.hasSounds=a,this.hasCss=p,this.horizontalLayout=h,this.languageTree=t,this.gridOptions=Bu.parseGridOptions(e),this.zoomOptions=Bu.parseZoomOptions(e),this.toolboxPosition=d,this.theme=Bu.parseThemeOptions(e),this.renderer=_,this.rendererOverrides=null!=(m=e.rendererOverrides)?m:null,this.parentWorkspace=null!=(n=e.parentWorkspace)?n:null,this.plugins=b}static parseMoveOptions(e,t){var i=e.move||{},s={};return void 0===i.scrollbars&&void 0===e.scrollbars?s.scrollbars=t:"object"==typeof i.scrollbars?(s.scrollbars={horizontal:!!i.scrollbars.horizontal,vertical:!!i.scrollbars.vertical},s.scrollbars.horizontal&&s.scrollbars.vertical?s.scrollbars=!0:s.scrollbars.horizontal||s.scrollbars.vertical||(s.scrollbars=!1)):s.scrollbars=!!i.scrollbars||!!e.scrollbars,s.wheel=s.scrollbars&&void 0!==i.wheel?!!i.wheel:"object"==typeof s.scrollbars,s.drag=!(!s.scrollbars||void 0!==i.drag&&!i.drag),s}static parseZoomOptions(e){e=e.zoom||{};var t={};return t.controls=void 0!==e.controls&&!!e.controls,t.wheel=void 0!==e.wheel&&!!e.wheel,t.startScale=void 0===e.startScale?1:Number(e.startScale),t.maxScale=void 0===e.maxScale?3:Number(e.maxScale),t.minScale=void 0===e.minScale?.3:Number(e.minScale),t.scaleSpeed=void 0===e.scaleSpeed?1.2:Number(e.scaleSpeed),t.pinch=void 0===e.pinch?t.wheel||t.controls:!!e.pinch,t}static parseGridOptions(e){e=e.grid||{};var t={};return t.spacing=Number(e.spacing)||0,t.colour=e.colour||"#888",t.length=void 0===e.length?1:Number(e.length),t.snap=0<t.spacing&&!!e.snap,t}static parseThemeOptions(e){return"string"==typeof(e=e.theme||Du)?pr(b.THEME,e):e instanceof Mu?e:Mu.defineTheme(e.name||"builtin"+wr(),e)}},Pu=class{constructor(e,t){this.bubble=e,this.workspace=t,this.startLoc=null}isMovable(){return!0}startDrag(){var e;this.startLoc=this.bubble.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1),null!=(e=this.workspace.getLayerManager())&&e.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}drag(e){this.bubble.moveDuringDrag(e)}endDrag(){var e;this.workspace.setResizesEnabled(!0),null!=(e=this.workspace.getLayerManager())&&e.moveOffDragLayer(this.bubble,100),this.bubble.setDragging(!1)}revertDrag(){this.startLoc&&this.bubble.moveDuringDrag(this.startLoc)}},R=class{constructor(e,t,i,s){this.workspace=e,this.anchor=t,this.ownerRect=i,this.size=new C(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.dragStrategy=new Pu(this,this.workspace),this.id=wr(),this.svgRoot=a(k.G,{class:"blocklyBubble"},e.getBubbleCanvas()),e=a(k.G,{class:"blocklyEmboss"},this.svgRoot),this.tail=a(k.PATH,{class:"blocklyBubbleTail"},e),this.background=a(k.RECT,{class:"blocklyDraggable",x:0,y:0,rx:Fu.BORDER_WIDTH,ry:Fu.BORDER_WIDTH},e),this.contentContainer=a(k.G,{},this.svgRoot),this.focusableElement=null!=s?s:this.svgRoot,this.focusableElement.setAttribute("id",this.id),p(this.background,"pointerdown",this,this.onMouseDown)}dispose(){l(this.svgRoot),this.disposed=!0}setAnchorLocation(e,t=!1){this.anchor=e,t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,t){this.relativeLeft=e,this.relativeTop=t,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(e,t=!1){e.width=Math.max(e.width,Fu.MIN_SIZE),e.height=Math.max(e.height,Fu.MIN_SIZE),this.size=e,this.background.setAttribute("width",""+e.width),this.background.setAttribute("height",""+e.height),t?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e){this.colour=e,this.tail.setAttribute("fill",e),this.background.setAttribute("fill",e)}onMouseDown(e){var t;null!=(t=this.workspace.getGesture(e))&&t.handleBubbleStart(e,this),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this)}positionRelativeToAnchor(){var e=this.anchor.x,e=this.workspace.RTL?e-(this.relativeLeft+this.size.width):e+this.relativeLeft;this.moveTo(e,this.relativeTop+this.anchor.y)}moveTo(e,t){this.svgRoot.setAttribute("transform",`translate(${e}, ${t})`)}positionByRect(e=new I(0,0,0,0)){var t=this.workspace.getMetricsManager().getViewMetrics(!0),i=this.getOptimalRelativeLeft(t),s=this.getOptimalRelativeTop(t),o={x:i,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},n={x:-this.size.width-30,y:s},s={x:e.getWidth(),y:s},r={x:i,y:e.getHeight()},i=e.getWidth()<e.getHeight()?s:r,r=(e=e.getWidth()<e.getHeight()?r:s,s=this.getOverlap(o,t),this.getOverlap(n,t)),l=this.getOverlap(i,t),t=this.getOverlap(e,t);s===(t=Math.max(s,r,l,t))?(this.relativeLeft=o.x,this.relativeTop=o.y):r===t?(this.relativeLeft=n.x,this.relativeTop=n.y):l===t?(this.relativeLeft=i.x,this.relativeTop=i.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,t){var i=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x;return e=e.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(i+this.size.width,t.left+t.width)-Math.max(i,t.left))*(Math.min(e+this.size.height,t.top+t.height)-Math.max(e,t.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let t=-this.size.width/4;var i,s;return this.size.width>e.width||(e=this.getWorkspaceViewRect(e),this.workspace.RTL?(i=this.anchor.x-t)-this.size.width<e.left?t=-(e.left-this.anchor.x+this.size.width):i>e.right&&(t=-(e.right-this.anchor.x)):(s=(i=t+this.anchor.x)+this.size.width,i<e.left?t=e.left-this.anchor.x:s>e.right&&(t=e.right-this.anchor.x-this.size.width))),t}getOptimalRelativeTop(e){let t=-this.size.height/4;var i,s;return this.size.height>e.height||(s=(i=this.anchor.y+t)+this.size.height,i<(e=this.getWorkspaceViewRect(e)).top?t=e.top-this.anchor.y:s>e.bottom&&(t=e.bottom-this.anchor.y-this.size.height)),t}getWorkspaceViewRect(e){var t=e.top;let i=e.top+e.height,s=e.left;return e=e.left+e.width,i-=this.getScrollbarThickness(),this.workspace.RTL?s-=this.getScrollbarThickness():e-=this.getScrollbarThickness(),new I(t,i,s,e)}getScrollbarThickness(){return sa.scrollbarThickness/this.workspace.scale}renderTail(){var e,t,i,s,o,n,r,l=[],a=this.size.width/2,c=this.size.height/2,u=-this.relativeLeft,h=-this.relativeTop;a===u&&c==h?l.push("M "+a+","+c):(h-=c,u-=a,this.workspace.RTL&&(u*=-1),e=Math.sqrt(h*h+u*u),t=Math.acos(u/e),o=(t=h<0?2*Math.PI-t:t)+Math.PI/2,2*Math.PI<o&&(o-=2*Math.PI),i=Math.sin(o),r=Math.cos(o),s=(this.size.width+this.size.height)/Fu.TAIL_THICKNESS,s=Math.min(s,this.size.width,this.size.height)/4,u=a+(o=1-Fu.ANCHOR_RADIUS/e)*u,h=c+o*h,o=a+s*r,n=c+s*i,a-=s*r,c-=s*i,(i=t+(i=ri(this.workspace.RTL?-Fu.TAIL_ANGLE:Fu.TAIL_ANGLE)))>2*Math.PI&&(i-=2*Math.PI),t=Math.sin(i)*e/Fu.TAIL_BEND,e=Math.cos(i)*e/Fu.TAIL_BEND,l.push("M"+o+","+n),l.push("C"+(o+e)+","+(n+t)+" "+u+","+h+" "+u+","+h),l.push("C"+u+","+h+" "+(a+e)+","+(c+t)+" "+a+","+c)),l.push("z"),null!=(r=this.tail)&&r.setAttribute("d",l.join(" "))}bringToFront(){var e=null==(e=this.svgRoot)?void 0:e.parentNode;return!(!this.svgRoot||(null==e?void 0:e.lastChild)===this.svgRoot||(null!=e&&e.appendChild(this.svgRoot),0))}getRelativeToSurfaceXY(){return new y(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){}isDeletable(){return!1}showContextMenu(e){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){ce(this)}unselect(){ce(null)}getFocusableElement(){return this.focusableElement}getFocusableTree(){return this.workspace}onNodeFocus(){this.select(),this.bringToFront()}onNodeBlur(){this.unselect()}canBeFocused(){return!0}},Fu=R,Uu=(R.BORDER_WIDTH=6,R.DOUBLE_BORDER=2*Fu.BORDER_WIDTH,R.MIN_SIZE=Fu.DOUBLE_BORDER,R.TAIL_THICKNESS=1,R.TAIL_ANGLE=20,R.TAIL_BEND=4,R.ANCHOR_RADIUS=8,class extends R{constructor(e,t,i,s){super(t,i,s),this.workspace=t,this.anchor=i,this.ownerRect=s,this.autoLayout=!0,t=new Bu(e),this.validateWorkspaceOptions(t),this.svgDialog=a(k.SVG,{x:R.BORDER_WIDTH,y:R.BORDER_WIDTH},this.contentContainer),e.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new Bu(e)),this.miniWorkspace.internalIsMutator=!0,e=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(e),t.languageTree&&(e.insertBefore(this.miniWorkspace.addFlyout(k.G),this.miniWorkspace.getCanvas()),null!=(e=this.miniWorkspace.getFlyout())&&e.init(this.miniWorkspace),null!=e)&&e.show(t.languageTree),c(this.svgRoot,"blocklyMiniWorkspaceBubble"),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));let o,n;null!=(o=this.miniWorkspace.getFlyout())&&null!=(n=o.getWorkspace())&&n.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(e){this.miniWorkspace.addChangeListener(e)}validateWorkspaceOptions(e){if(e.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(e.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(e.zoomOptions.controls||e.zoomOptions.wheel||e.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(e.moveOptions.scrollbars||e.moveOptions.wheel||e.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(e.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging()||this.miniWorkspace.keyboardMoveInProgress)for(var t of this.miniWorkspace.getTopBlocks(!1)){var i=t.getRelativeToSurfaceXY();if(i.y<20&&t.moveBy(0,20-i.y),t.RTL){let e=-20;var s=this.miniWorkspace.getFlyout();s&&(e-=s.getWidth()),i.x>e&&t.moveBy(e-i.x,0)}else i.x<20&&t.moveBy(20-i.x,0)}}updateBubbleSize(){var e,t;this.miniWorkspace.isDragging()&&!this.miniWorkspace.keyboardMoveInProgress||(this.autoLayout&&(this.autoLayout=!this.miniWorkspace.keyboardMoveInProgress),e=this.getSize(),t=this.calculateWorkspaceSize(),Math.abs(e.width-t.width)<Uu.MINIMUM_VIEW_CHANGE&&Math.abs(e.height-t.height)<Uu.MINIMUM_VIEW_CHANGE)||(this.svgDialog.setAttribute("width",t.width+"px"),this.svgDialog.setAttribute("height",t.height+"px"),this.miniWorkspace.setCachedParentSvgSize(t.width,t.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${t.width}, 0)`),this.setSize(new C(t.width+R.DOUBLE_BORDER,t.height+R.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}calculateWorkspaceSize(){var e=this.miniWorkspace.getCanvas().getBBox();let t=e.width+Uu.MARGIN;e=e.height+Uu.MARGIN;var i,s=this.miniWorkspace.getFlyout();return s&&(i=s.getWorkspace().getMetricsManager().getScrollMetrics(),e=Math.max(e,i.height+20),t+=s.getWidth()),new C(t,e)}updateBlockStyles(){for(var e of this.miniWorkspace.getAllBlocks(!1))e.setStyle(e.getStyleName());var t;if(e=null==(t=this.miniWorkspace.getFlyout())?void 0:t.getWorkspace())for(var i of e.getAllBlocks(!1))i.setStyle(i.getStyleName())}moveDuringDrag(e){super.moveDuringDrag(e),this.autoLayout=!1}moveTo(e,t){super.moveTo(e,t),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(e){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}}),Hu=(Uu.MINIMUM_VIEW_CHANGE=10,Uu.MARGIN=3*R.DOUBLE_BORDER,class{constructor(e){this.sourceBlock=e,this.offsetInBlock=new y(0,0),this.workspaceLocation=new y(0,0),this.svgRoot=null,this.tooltip=e,this.id=wr()}getType(){throw Error("Icons must implement getType")}initView(e){var t;this.svgRoot||(t=this.sourceBlock,this.svgRoot=a(k.G,{class:"blocklyIconGroup",id:this.id}),t.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),p(this.svgRoot,"pointerdown",this,e),this.svgRoot.tooltip=this,Di(this.svgRoot))}dispose(){Bi(this.svgRoot),l(this.svgRoot)}getWeight(){return-1}getSize(){return new C(0,0)}setTooltip(e){this.tooltip=null!=e?e:this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",ni(this))&&this.setBubbleVisible(!1)}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(e){this.offsetInBlock=e,this.updateSvgRootOffset()}updateSvgRootOffset(){var e;null!=(e=this.svgRoot)&&e.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(e){this.workspaceLocation=y.sum(e,this.offsetInBlock)}onClick(){}isClickableInFlyout(e){return!0}getFocusableElement(){var e=this.svgRoot;if(e)return e;throw Error("Attempting to focus uninitialized icon.")}getFocusableTree(){return this.sourceBlock.workspace}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}getSourceBlock(){return this.sourceBlock}}),Gu=(_.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends Hu{constructor(e,t){super(t),this.flyoutBlockTypes=e,this.sourceBlock=t,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return _.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(e){this.svgRoot||(super.initView(e),a(k.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),a(k.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),a(k.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),c(this.svgRoot,"blocklyMutatorIcon"))}dispose(){var e;super.dispose(),null!=(e=this.miniWorkspaceBubble)&&e.dispose()}getWeight(){return _.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new C(17,17)}applyColour(){var e;super.applyColour(),null!=(e=this.miniWorkspaceBubble)&&e.setColour(this.sourceBlock.getColour()),null!=(e=this.miniWorkspaceBubble)&&e.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(e){super.onLocationChange(e),null!=(e=this.miniWorkspaceBubble)&&e.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(t){let i=this;return(0,d.asyncExecutePromiseGeneratorFunction)(function*(){var e;i.bubbleIsVisible()!==t&&(yield tt(),t?(i.miniWorkspaceBubble=new Uu(i.getMiniWorkspaceConfig(),i.sourceBlock.workspace,i.getAnchorLocation(),i.getBubbleOwnerRect()),i.applyColour(),i.createRootBlock(),i.addSaveConnectionsListener(),null!=(e=i.miniWorkspaceBubble)&&e.addWorkspaceChangeListener(i.createMiniWorkspaceChangeListener())):(null!=(e=i.miniWorkspaceBubble)&&e.dispose(),i.miniWorkspaceBubble=null,i.saveConnectionsListener&&i.sourceBlock.workspace.removeChangeListener(i.saveConnectionsListener),i.saveConnectionsListener=null),g(new(m(f.BUBBLE_OPEN))(i.sourceBlock,t,"mutator")))})}getBubble(){return this.miniWorkspaceBubble}getMiniWorkspaceConfig(){var e={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:null!=(e=this.sourceBlock.workspace.options.rendererOverrides)?e:void 0};return this.flyoutBlockTypes.length&&(e.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map(e=>({kind:"block",type:e}))}),e}getAnchorLocation(){return y.sum(this.workspaceLocation,new y(8.5,8.5))}getBubbleOwnerRect(){var e=this.sourceBlock.getSvgRoot().getBBox();return new I(e.y,e.y+e.height,e.x,e.x+e.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace());for(var e of this.rootBlock.getDescendants(!1))e.queueRender();var t;this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1),e=null!=(t=null==(t=this.miniWorkspaceBubble)||null==(t=t.getWorkspace())||null==(t=t.getFlyout())?void 0:t.getWidth())?t:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(e+16):16,16)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return e=>{_.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(e)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout(()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()},0))}}static isIgnorableMutatorEvent(e){return e.isUiEvent||xr(e)||Or(e)&&"disabled"===e.element}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var e=_.getGroup$$module$build$src$core$events$utils(),t=(e||_.setGroup$$module$build$src$core$events$utils(!0),dc.getExtraBlockState_(this.sourceBlock)),i=(this.sourceBlock.compose(this.rootBlock),dc.getExtraBlockState_(this.sourceBlock));t!==i&&g(new(m(f.BLOCK_CHANGE))(this.sourceBlock,"mutation",null,t,i)),_.setGroup$$module$build$src$core$events$utils(e)}}getWorkspace(){var e;return null==(e=this.miniWorkspaceBubble)?void 0:e.getWorkspace()}},_.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=uc.MUTATOR,_.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,_.MutatorIcon$$module$build$src$core$icons$mutator_icon,Object.create(null)),Vu={allExtensions:Gu},Wu=(_.register$$module$build$src$core$extensions("parent_tooltip_when_inline",Gh),{TEST_ONLY:Vu}),zu=(Wu.apply=Zs,Wu.buildTooltipForDropdown=_.buildTooltipForDropdown$$module$build$src$core$extensions,Wu.buildTooltipWithFieldText=_.buildTooltipWithFieldText$$module$build$src$core$extensions,Wu.isRegistered=qs,Wu.register=_.register$$module$build$src$core$extensions,Wu.registerMixin=_.registerMixin$$module$build$src$core$extensions,Wu.registerMutator=_.registerMutator$$module$build$src$core$extensions,Wu.runAfterPageLoad=Yh,Wu.unregister=M,(L=s=s||{})[L.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",L[L.MAC_ENTER=3]="MAC_ENTER",L[L.BACKSPACE=8]="BACKSPACE",L[L.TAB=9]="TAB",L[L.NUM_CENTER=12]="NUM_CENTER",L[L.ENTER=13]="ENTER",L[L.SHIFT=16]="SHIFT",L[L.CTRL=17]="CTRL",L[L.ALT=18]="ALT",L[L.PAUSE=19]="PAUSE",L[L.CAPS_LOCK=20]="CAPS_LOCK",L[L.ESC=27]="ESC",L[L.SPACE=32]="SPACE",L[L.PAGE_UP=33]="PAGE_UP",L[L.PAGE_DOWN=34]="PAGE_DOWN",L[L.END=35]="END",L[L.HOME=36]="HOME",L[L.LEFT=37]="LEFT",L[L.UP=38]="UP",L[L.RIGHT=39]="RIGHT",L[L.DOWN=40]="DOWN",L[L.PLUS_SIGN=43]="PLUS_SIGN",L[L.PRINT_SCREEN=44]="PRINT_SCREEN",L[L.INSERT=45]="INSERT",L[L.DELETE=46]="DELETE",L[L.ZERO=48]="ZERO",L[L.ONE=49]="ONE",L[L.TWO=50]="TWO",L[L.THREE=51]="THREE",L[L.FOUR=52]="FOUR",L[L.FIVE=53]="FIVE",L[L.SIX=54]="SIX",L[L.SEVEN=55]="SEVEN",L[L.EIGHT=56]="EIGHT",L[L.NINE=57]="NINE",L[L.FF_SEMICOLON=59]="FF_SEMICOLON",L[L.FF_EQUALS=61]="FF_EQUALS",L[L.FF_DASH=173]="FF_DASH",L[L.FF_HASH=163]="FF_HASH",L[L.QUESTION_MARK=63]="QUESTION_MARK",L[L.AT_SIGN=64]="AT_SIGN",L[L.A=65]="A",L[L.B=66]="B",L[L.C=67]="C",L[L.D=68]="D",L[L.E=69]="E",L[L.F=70]="F",L[L.G=71]="G",L[L.H=72]="H",L[L.I=73]="I",L[L.J=74]="J",L[L.K=75]="K",L[L.L=76]="L",L[L.M=77]="M",L[L.N=78]="N",L[L.O=79]="O",L[L.P=80]="P",L[L.Q=81]="Q",L[L.R=82]="R",L[L.S=83]="S",L[L.T=84]="T",L[L.U=85]="U",L[L.V=86]="V",L[L.W=87]="W",L[L.X=88]="X",L[L.Y=89]="Y",L[L.Z=90]="Z",L[L.META=91]="META",L[L.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",L[L.CONTEXT_MENU=93]="CONTEXT_MENU",L[L.NUM_ZERO=96]="NUM_ZERO",L[L.NUM_ONE=97]="NUM_ONE",L[L.NUM_TWO=98]="NUM_TWO",L[L.NUM_THREE=99]="NUM_THREE",L[L.NUM_FOUR=100]="NUM_FOUR",L[L.NUM_FIVE=101]="NUM_FIVE",L[L.NUM_SIX=102]="NUM_SIX",L[L.NUM_SEVEN=103]="NUM_SEVEN",L[L.NUM_EIGHT=104]="NUM_EIGHT",L[L.NUM_NINE=105]="NUM_NINE",L[L.NUM_MULTIPLY=106]="NUM_MULTIPLY",L[L.NUM_PLUS=107]="NUM_PLUS",L[L.NUM_MINUS=109]="NUM_MINUS",L[L.NUM_PERIOD=110]="NUM_PERIOD",L[L.NUM_DIVISION=111]="NUM_DIVISION",L[L.F1=112]="F1",L[L.F2=113]="F2",L[L.F3=114]="F3",L[L.F4=115]="F4",L[L.F5=116]="F5",L[L.F6=117]="F6",L[L.F7=118]="F7",L[L.F8=119]="F8",L[L.F9=120]="F9",L[L.F10=121]="F10",L[L.F11=122]="F11",L[L.F12=123]="F12",L[L.NUMLOCK=144]="NUMLOCK",L[L.SCROLL_LOCK=145]="SCROLL_LOCK",L[L.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",L[L.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",L[L.SEMICOLON=186]="SEMICOLON",L[L.DASH=189]="DASH",L[L.EQUALS=187]="EQUALS",L[L.COMMA=188]="COMMA",L[L.PERIOD=190]="PERIOD",L[L.SLASH=191]="SLASH",L[L.APOSTROPHE=192]="APOSTROPHE",L[L.TILDE=192]="TILDE",L[L.SINGLE_QUOTE=222]="SINGLE_QUOTE",L[L.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",L[L.BACKSLASH=220]="BACKSLASH",L[L.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",L[L.WIN_KEY=224]="WIN_KEY",L[L.MAC_FF_META=224]="MAC_FF_META",L[L.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",L[L.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",L[L.WIN_IME=229]="WIN_IME",L[L.VK_NONAME=252]="VK_NONAME",L[L.PHANTOM=255]="PHANTOM",{}),ju=(zu.arc=go,zu.curve=ao,zu.line=po,zu.lineOnAxis=h,zu.lineTo=ho,zu.moveBy=uo,zu.moveTo=co,zu.point=u,{}),O=(ju.Coordinate=y,ju.KeyCodes=s,ju.Rect=I,ju.Size=C,ju.Svg=k,ju.aria=S,ju.array=Yl,ju.browserEvents=Tl,ju.colour=Kc,ju.deprecation=w,ju.dom=Dl,ju.extensions=Wu,ju.idGenerator=Xr,ju.math=pc,ju.object=Ul,ju.parsing=Jc,ju.string=ac,ju.style=ea,ju.svgMath=i,ju.svgPaths=zu,ju.toolbox=ga,ju.userAgent=_l,ju.xml=Xl,class{constructor(e,t){if(this.type=t,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,(this.sourceBlock_=e).id.includes("_connection"))throw Error("Connection ID indicator is contained in block ID. This will cause "+`problems with focus: ${e.id}.`);this.id=e.id+"_connection_"+wr()}connect_(e){var t,i,s=E.INPUT_VALUE,o=this.getSourceBlock(),n=e.getSourceBlock();e.isConnected()&&e.disconnectInternal(!1);let r;this.isConnected()&&(t=this.stashShadowState(),(i=this.targetBlock()).isShadow()?i.dispose(!1):(this.disconnectInternal(),r=i),this.applyShadowState(t));let l;U()&&(l=new(m(f.BLOCK_MOVE))(n)).setReason(["connect"]),mo(this,e),n.setParent(o),l&&(l.recordNew(),g(l)),r&&(e=this.type===s?r.outputConnection:r.previousConnection)&&((n=O.getConnectionForOrphanedConnection(n,e))?e.connect(n):e.onFailedConnect(this))}dispose(){var e;this.isConnected()&&(this.isSuperior()&&this.setShadowStateInternal(),e=this.targetBlock())&&!e.isDeadOrDying()&&e.unplug(),this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===E.INPUT_VALUE||this.type===E.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(e){}connect(e){var t;return this.targetConnection===e||(this.getConnectionChecker().canConnect(this,e,!1)&&((t=_.getGroup$$module$build$src$core$events$utils())||_.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(e):e.connect_(this),_.setGroup$$module$build$src$core$events$utils(t)),this.isConnected())}disconnect(){this.disconnectInternal()}disconnectInternal(e=!0){var{parentConnection:t,childConnection:i}=this.getParentAndChildConnections();if(!t||!i)throw Error("Source connection not connected.");var s=_.getGroup$$module$build$src$core$events$utils();s||_.setGroup$$module$build$src$core$events$utils(!0);let o;U()&&(o=new(m(f.BLOCK_MOVE))(i.getSourceBlock())).setReason(["disconnect"]);var n=this.targetConnection;n&&(n.targetConnection=null),this.targetConnection=null,e&&i.getSourceBlock().setParent(null),o&&(o.recordNew(),g(o)),i.getSourceBlock().isShadow()||t.respawnShadow_(),_.setGroup$$module$build$src$core$events$utils(s)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(e,t){var i;return!(this.getSourceBlock().isDeadOrDying()||(t=null==(i=e.getInput(t))?void 0:i.connection,(i=this.targetBlock())&&i!==e)||!t||t.targetConnection===this||(t.isConnected()&&t.disconnect(),t.connect(this),0))}targetBlock(){var e;return this.isConnected()&&null!=(e=null==(e=this.targetConnection)?void 0:e.getSourceBlock())?e:null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return e?(Array.isArray(e)||(e=[e]),this.check=e,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(e){this.setShadowStateInternal({shadowDom:e})}getShadowDom(e){return e&&this.targetBlock().isShadow()?$s(this.targetBlock()):this.shadowDom}setShadowState(e){this.setShadowStateInternal({shadowState:e})}getShadowState(e){return e&&this.targetBlock()&&this.targetBlock().isShadow()?Dt(this.targetBlock()):this.shadowState}neighbours(e){return[]}getParentInput(){let t=null;var i=this.sourceBlock_.inputList;for(let e=0;e<i.length;e++)if(i[e].connection===this){t=i[e];break}return t}toString(){var i=this.sourceBlock_;if(!i)return"Orphan Connection";if(i.outputConnection===this)var s="Output Connection of ";else if(i.previousConnection===this)s="Previous Connection of ";else if(i.nextConnection===this)s="Next Connection of ";else{s=null;for(let e=0,t;t=i.inputList[e];e++)if(t.connection===this){s=t;break}if(!s)return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection";s='Input "'+s.name+'" connection on '}return s+i.toDevString()}stashShadowState(){var e=this.getShadowDom(!0),t=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:e,shadowState:t}}applyShadowState({shadowDom:e,shadowState:t}){this.shadowDom=e,this.shadowState=t}setShadowStateInternal({shadowDom:e=null,shadowState:t=null}={}){this.shadowDom=e,this.shadowState=t,this.getSourceBlock().isDeadOrDying()||((e=this.targetBlock())?e.isShadow()?(e.dispose(!1),this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())):(e=this.createShadowBlock(!1),this.serializeShadow(e),e&&e.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())))}createShadowBlock(e){var t=this.getSourceBlock(),i=this.getShadowState(),s=this.getShadowDom();if(!t.isDeadOrDying()&&(i||s)){if(i)return jt(i,t.workspace,{parentConnection:e?this:void 0,isShadow:!0,recordUndo:!1});if(s){if(t=Bs(s,t.workspace),e)if(this.type===E.INPUT_VALUE){if(!t.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(t.outputConnection))throw Error("Could not connect shadow block to connection")}else{if(this.type!==E.NEXT_STATEMENT)throw Error("Cannot connect a shadow block to a previous/output connection");if(!t.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(t.previousConnection))throw Error("Could not connect shadow block to connection")}return t}}return null}serializeShadow(e){e&&(this.shadowDom=$s(e),this.shadowState=Dt(e))}static getConnectionForOrphanedConnection(e,t){if(t.type===E.OUTPUT_VALUE)return bo(e,t.getSourceBlock());e=e.lastConnectionInStack(!0);var i=t.getConnectionChecker();return e&&i.canConnect(t,e,!1)?e:null}}),Yu=(O.CAN_CONNECT=0,O.REASON_SELF_CONNECTION=1,O.REASON_WRONG_TYPE=2,O.REASON_TARGET_NULL=3,O.REASON_CHECKS_FAILED=4,O.REASON_DIFFERENT_WORKSPACES=5,O.REASON_SHADOW_PARENT=6,O.REASON_DRAG_CHECKS_FAILED=7,O.REASON_PREVIOUS_AND_OUTPUT=8,class extends Error{constructor(e){super(`Tried to append an icon of type ${e.getType()} when an icon of `+"that type already exists on the block. Use getIcon to access the existing icon."),this.icon=e}}),Xu={},Ku=(Xu.DuplicateIconType=Yu,(qd=_.Align$$module$build$src$core$inputs$align||(_.Align$$module$build$src$core$inputs$align={}))[qd.LEFT=-1]="LEFT",qd[qd.CENTRE=0]="CENTRE",qd[qd.RIGHT=1]="RIGHT",_.Align$$module$build$src$core$inputs$align,class extends A{constructor(e,t,i){super(A.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,e!==A.SKIP_SETUP&&(i?this.configure_(i):this.class=t||null,this.setValue(e))}configure_(e){super.configure_(e),e.class&&(this.class=e.class)}initView(){this.createTextElement_(),this.class&&c(this.getTextElement(),this.class),this.fieldGroup_&&c(this.fieldGroup_,"blocklyLabelField")}doClassValidation_(e){return null==e?null:""+e}setClass(e){this.textElement_&&(this.class&&r(this.textElement_,this.class),e)&&c(this.textElement_,e),this.class=e}static fromJson(e){return new this(ss(e.text),void 0,e)}}),Ju=(qh("field_label",Ku),Ku.prototype.DEFAULT_VALUE="",[]),qu=(Ju[E.INPUT_VALUE]=E.OUTPUT_VALUE,Ju[E.OUTPUT_VALUE]=E.INPUT_VALUE,Ju[E.NEXT_STATEMENT]=E.PREVIOUS_STATEMENT,Ju[E.PREVIOUS_STATEMENT]=E.NEXT_STATEMENT,"RENAME_VARIABLE_ID"),Zu="DELETE_VARIABLE_ID",Qu=class extends O{constructor(e,t){super(e,t),this.highlighted=!1,this.targetConnection=null,this.db=e.workspace.connectionDBList[t],this.dbOpposite=e.workspace.connectionDBList[Ju[t]],this.offsetInBlock=new y(0,0),this.trackedState=Qu.TrackedState.WILL_TRACK}dispose(){var e,t;super.dispose(),this.trackedState===Qu.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),null!=(t=(e=this.sourceBlock_.pathObject).removeConnectionHighlight)&&t.call(e,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(e){var t=this.x-e.x;return e=this.y-e.y,Math.sqrt(t*t+e*e)}bumpAwayFrom(e,t=!1){if(!this.sourceBlock_.workspace.isDragging()){var i=_.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random()),s=_.config$$module$build$src$core$config.snapRadius+Math.floor(10*Math.random()),o=e.sourceBlock_.getRootBlock(),n=this.sourceBlock_.getRootBlock();if(!o.isInFlyout&&!n.isInFlyout){var r=!0;if(n.isMovable())o.isMovable()&&t&&(s=-s);else{if(!o.isMovable())return;r=!1,i=-i,s=-s}(o=r?n:o).RTL&&(i=-i),o.moveBy((t=r?e:this).x+i-(e=r?this:e).x,t.y+s-e.y,["bump"])}}}moveTo(e,t){let i=!1;return this.trackedState===Qu.TrackedState.WILL_TRACK?(this.db.addConnection(this,t),this.trackedState=Qu.TrackedState.TRACKED,i=!0):this.trackedState===Qu.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,t),i=!0),this.x=e,this.y=t,i}moveBy(e,t){return this.moveTo(this.x+e,this.y+t)}moveToOffset(e){return this.moveTo(e.x+this.offsetInBlock.x,e.y+this.offsetInBlock.y)}setOffsetInBlock(e,t){this.offsetInBlock.x=e,this.offsetInBlock.y=t}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var e=this.targetConnection,t=this.targetBlock();e&&t&&(e=y.difference(this.offsetInBlock,e.offsetInBlock),t.translate(e.x,e.y))}closest(e,t){return this.dbOpposite.searchForClosest(this,e,t)}highlight(){this.highlighted=!0;var e=this.findHighlightSvg();e&&(e.style.display="")}unhighlight(){this.highlighted=!1;var e=this.findHighlightSvg();e&&(e.style.display="none")}isHighlighted(){return this.highlighted}setTracking(e){e&&this.trackedState===Qu.TrackedState.TRACKED||!e&&this.trackedState===Qu.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db.addConnection(this,this.y),this.trackedState=Qu.TrackedState.TRACKED):(this.trackedState===Qu.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=Qu.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){var t=this.targetBlock().getDescendants(!1);for(let e=0;e<t.length;e++){var i,s=t[e],o=s.getConnections_(!0);for(let e=0;e<o.length;e++)o[e].setTracking(!1);for(i of s.getIcons())ni(i)&&i.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let i=[];if(this.type===E.INPUT_VALUE||this.type===E.NEXT_STATEMENT){var e=this.targetBlock();if(e){let t;e.isCollapsed()?(t=[],e.outputConnection&&t.push(e.outputConnection),e.nextConnection&&t.push(e.nextConnection),e.previousConnection&&t.push(e.previousConnection)):t=e.getConnections_(!0);for(let e=0;e<t.length;e++)i.push(...t[e].startTrackingAll());i.length||(i=[e])}}return i}onFailedConnect(t){let i=this.getSourceBlock();if(Cl){let e=_.getGroup$$module$build$src$core$events$utils();setTimeout(function(){i.isDisposed()||i.getParent()||(_.setGroup$$module$build$src$core$events$utils(e),this.bumpAwayFrom(t),_.setGroup$$module$build$src$core$events$utils(!1))}.bind(this),_.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(e=!0){var t,{parentConnection:i,childConnection:s}=this.getParentAndChildConnections();i&&s&&((t=_.getGroup$$module$build$src$core$events$utils())||_.setGroup$$module$build$src$core$events$utils(!0),i=i.getSourceBlock(),s=s.getSourceBlock(),super.disconnectInternal(e),i.queueRender(),s.updateDisabled(),s.queueRender(),s.getSvgRoot().style.display="block",_.setGroup$$module$build$src$core$events$utils(t))}respawnShadow_(){super.respawnShadow_();var e=this.targetBlock();e&&(e.initSvg(),e.queueRender())}neighbours(e){return this.dbOpposite.getNeighbours(this,e)}connect_(e){super.connect_(e);var t=this.getSourceBlock();e=e.getSourceBlock(),t.updateDisabled(),e.updateDisabled(),e.queueRender(),(t=t.getInputWithBlock(e))&&(t=t.isVisible(),e.getSvgRoot().style.display=t?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return super.setCheck(e),this.sourceBlock_.queueRender(),this}showContextMenu(e){var t,i,s,o=x.registry.getContextMenuOptions({focusedNode:this},e);o.length&&(i=(t=this.getSourceBlock()).workspace,s=e instanceof PointerEvent?new y(e.clientX,e.clientY):(s=new y(this.x,this.y),Ne(i,s).translate(t.RTL?-5:5,5)),fs(e,o,t.RTL,i,s))}getFocusableElement(){var e=this.findHighlightSvg();if(e)return e;throw Error("No highlight SVG found corresponding to this connection.")}getFocusableTree(){return this.getSourceBlock().workspace}onNodeFocus(){this.highlight()}onNodeBlur(){this.unhighlight()}canBeFocused(){return!0}findHighlightSvg(){return document.getElementById(this.id)}},eh=((cp=(cp=Qu=Qu||{}).TrackedState||(cp.TrackedState={}))[cp.WILL_TRACK=-1]="WILL_TRACK",cp[cp.UNTRACKED=0]="UNTRACKED",cp[cp.TRACKED=1]="TRACKED",Qu.TrackedState,class{constructor(e,t){this.name=e,this.sourceBlock=t,this.fieldRow=[],this.align=_.Align$$module$build$src$core$inputs$align.LEFT,this.visible=!0,this.type=_.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(e,t){return this.insertFieldAt(this.fieldRow.length,e,t),this}insertFieldAt(e,t,i){if(e<0||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return(t||""===t&&i)&&((t="string"==typeof t?_.fromJson$$module$build$src$core$field_registry({type:"field_label",text:t}):t).setSourceBlock(this.sourceBlock),this.sourceBlock.initialized&&this.initField(t),t.name=i,t.setVisible(this.isVisible()),t.prefixField&&(e=this.insertFieldAt(e,t.prefixField)),this.fieldRow.splice(e,0,t),e++,t.suffixField&&(e=this.insertFieldAt(e,t.suffixField)),this.sourceBlock.rendered)&&this.sourceBlock.queueRender(),e}removeField(i,e){for(let e=0,t;t=this.fieldRow[e];e++)if(t.name===i)return t.dispose(),this.fieldRow.splice(e,1),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),!0;if(e)return!1;throw Error('Field "'+i+'" not found.')}isVisible(){return this.visible}setVisible(i){let e=[];if(this.visible!==i){this.visible=i;for(let e=0,t;t=this.fieldRow[e];e++)t.setVisible(i);var t;this.connection&&this.connection instanceof Qu&&(i?e=this.connection.startTrackingAll():this.connection.stopTrackingAll(),t=this.connection.targetBlock())&&(t.getSvgRoot().style.display=i?"block":"none")}return e}markDirty(){for(let e=0,t;t=this.fieldRow[e];e++)t.markDirty()}setCheck(e){if(this.connection)return this.connection.setCheck(e),this;throw Error("This input does not have a connection.")}setAlign(e){return this.align=e,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(e){if(this.connection)return this.connection.setShadowDom(e),this;throw Error("This input does not have a connection.")}getShadowDom(){if(this.connection)return this.connection.getShadowDom();throw Error("This input does not have a connection.")}init(){for(var e of this.fieldRow)e.init()}initModel(){for(var e of this.fieldRow)e.initModel()}initField(e){this.sourceBlock.rendered?e.init():e.initModel()}dispose(){for(let e=0,t;t=this.fieldRow[e];e++)t.dispose();this.connection&&this.connection.dispose()}makeConnection(e){return this.sourceBlock.makeConnection_(e)}}),th=class extends eh{constructor(e,t){super(e,t),this.name=e,this.type=_.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},ih=class extends eh{constructor(e,t){super(e,t),this.name=e,this.type=_.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},sh=class extends eh{constructor(e,t){if(!e)throw Error("Statement inputs must have a non-empty name");super(e,t),this.name=e,this.type=_.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(E.NEXT_STATEMENT)}},oh=(_.ValueInput$$module$build$src$core$inputs$value_input=class extends eh{constructor(e,t){if(!e)throw Error("Value inputs must have a non-empty name");super(e,t),this.name=e,this.type=_.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(E.INPUT_VALUE)}},_.ValueInput$$module$build$src$core$inputs$value_input,class{constructor(e,t,i){if(this.data=null,this.disposed=!1,this.hue=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabledReasons=new Set,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable=this.movable=this.deletable=!0,this.collapsed_=this.shadow=!1,this.outputShape_=null,this.rendered=this.isInsertionMarker_=this.initialized=this.disposing=!1,this.onchangeWrapper=this.helpUrl=null,this.statementInputCount=0,this.workspace=e,this.id=i&&!e.getBlockById(i)?i:Ar(),e.setBlockById(this.id,this),this.xy=new y(0,0),this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,t){if(this.type=t,!(i=Hr[t])||"object"!=typeof i)throw TypeError("Invalid block definition for type: "+t);Object.assign(this,i)}e.addTopBlock(this),e.addTypedBlock(this),new.target===oh&&this.doInit_()}doInit_(){var e=_.getGroup$$module$build$src$core$events$utils(),t=(e||_.setGroup$$module$build$src$core$events$utils(!0),Cl);try{"function"==typeof this.init&&(_.setRecordUndo$$module$build$src$core$events$utils(!1),this.init(),_.setRecordUndo$$module$build$src$core$events$utils(t)),U()&&g(new(m(f.BLOCK_CREATE))(this))}finally{_.setGroup$$module$build$src$core$events$utils(e),_.setRecordUndo$$module$build$src$core$events$utils(t)}this.inputsInlineDefault=this.inputsInline,"function"==typeof this.onchange&&this.setOnChange(this.onchange)}dispose(e=!1){this.disposing=!0,this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.unplug(e),U()&&g(new(m(f.BLOCK_DELETE))(this)),this.workspace.removeTopBlock(this),this.disposeInternal()}disposeInternal(){this.disposing=!0,this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),"function"==typeof this.destroy&&this.destroy(),this.childBlocks_.forEach(e=>e.disposeInternal()),this.inputList.forEach(e=>e.dispose()),this.inputList.length=0,this.getConnections_(!0).forEach(e=>e.dispose()),this.disposed=!0}isDeadOrDying(){return this.disposing||this.disposed}initModel(){if(!this.initialized){for(var e of this.inputList)e.initModel();this.initialized=!0}}unplug(e){this.outputConnection&&this.unplugFromRow(e),this.previousConnection&&this.unplugFromStack(e)}unplugFromRow(e){let t=null,i;null!=(i=this.outputConnection)&&i.isConnected()&&(t=this.outputConnection.targetConnection,this.outputConnection.disconnect()),t&&(e=e&&this.getOnlyValueConnection())&&e.isConnected()&&!e.targetBlock().isShadow()&&(null!=(e=e.targetConnection)&&e.disconnect(),this.workspace.connectionChecker.canConnect(e,t,!1)?t.connect(e):null!=e&&e.onFailedConnect(t))}getOnlyValueConnection(){let t=null;for(let e=0;e<this.inputList.length;e++){var i=this.inputList[e].connection;if(i&&i.type===E.INPUT_VALUE&&i.targetConnection){if(t)return null;t=i}}return t}unplugFromStack(e){let t=null;var i;null!=(i=this.previousConnection)&&i.isConnected()&&(t=this.previousConnection.targetConnection,this.previousConnection.disconnect()),i=this.getNextBlock(),e&&i&&!i.isShadow()&&(null!=(e=null!=(i=null==(i=this.nextConnection)?void 0:i.targetConnection)?i:null)&&e.disconnect(),t)&&this.workspace.connectionChecker.canConnect(t,e,!1)&&t.connect(e)}getConnections_(i){i=[],this.outputConnection&&i.push(this.outputConnection),this.previousConnection&&i.push(this.previousConnection),this.nextConnection&&i.push(this.nextConnection);for(let e=0,t;t=this.inputList[e];e++)t.connection&&i.push(t.connection);return i}lastConnectionInStack(e){let t=this.nextConnection;for(;t;){var i=t.targetBlock();if(!i||e&&i.isShadow())return t;t=i.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(i){for(let e=0,t;t=this.inputList[e];e++)if(t.connection&&t.connection.targetBlock()===i)return t;return null}getSurroundParent(){let e=this,t;do{if(!(e=(t=e).getParent()))return null}while(e.getNextBlock()===t);return e}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let e,t=this;for(;t=(e=t).parentBlock_;);return e}getTopStackBlock(){let e=this,t;for(;(t=e.getPreviousBlock())&&t.getNextBlock()===e&&(e=t););return e}getChildren(i){if(!i)return this.childBlocks_;i=[];for(let e=0,t;t=this.inputList[e];e++){var s;t.connection&&(s=t.connection.targetBlock())&&i.push(s)}return(s=this.getNextBlock())&&i.push(s),i}setParent(e){if(e!==this.parentBlock_){var t=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),i=!!t;if(i&&e&&t!==e)throw Error("Block connected to superior one that is not new parent.");if(!i&&e)throw Error("Block not connected to new parent.");if(i&&!e)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?_e(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(i){var s=[this],o=this.getChildren(i);for(let e,t=0;e=o[t];t++)s.push(...e.getDescendants(i));return s}isDeletable(){return this.deletable&&!this.isInFlyout&&!this.shadow&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()}isOwnDeletable(){return this.deletable}setDeletable(e){this.deletable=e}isMovable(){return this.movable&&!this.isInFlyout&&!this.shadow&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()}isOwnMovable(){return this.movable}setMovable(e){this.movable=e}isDuplicatable(){return!this.workspace.hasBlockLimits()||this.workspace.isCapacityAvailable(de(this,!0))}isShadow(){return this.shadow}setShadow(e){this.shadow=e}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(e){this.isInsertionMarker_=e}isEditable(){return this.editable&&!this.isDeadOrDying()&&!this.workspace.isReadOnly()}isOwnEditable(){return this.editable}setEditable(e){this.editable=e;for(var t of this.getFields())t.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(var e of this.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}getMatchingConnection(t,i){var s=this.getConnections_(!0);if(t=t.getConnections_(!0),s.length!==t.length)throw Error("Connection lists did not match in length.");for(let e=0;e<t.length;e++)if(t[e]===i)return s[e];return null}setHelpUrl(e){this.helpUrl=e}setTooltip(e){this.tooltip=e}getTooltip(){return $i(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue}setColour(e){e=os(e),this.hue=e.hue,this.colour_=e.hex}setStyle(e){this.styleName_=e}setOnChange(e){if(e&&"function"!=typeof e)throw Error("onchange must be a function.");this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.onchange=e,this.onchangeWrapper=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper)}getField(e){if("string"!=typeof e)throw TypeError("Block.prototype.getField expects a string with the field name but received "+(void 0===e?"nothing":e+" of type "+typeof e)+" instead");for(var t of this.getFields())if(t.name===e)return t;return null}*getFields(){for(var e of this.inputList)for(var t of e.fieldRow)yield t}getVars(){var e,t=[];for(e of this.getFields())e.referencesVariables()&&t.push(e.getValue());return t}getVarModels(){var e,t,i=[];for(e of this.getFields())e.referencesVariables()&&(t=this.workspace.getVariableById(e.getValue()))&&i.push(t);return i}updateVarName(e){for(var t of this.getFields())t.referencesVariables()&&e.getId()===t.getValue()&&t.refreshVariableName()}renameVarById(e,t){for(var i of this.getFields())i.referencesVariables()&&e===i.getValue()&&i.setValue(t)}getFieldValue(e){return(e=this.getField(e))?e.getValue():null}setFieldValue(e,t){var i=this.getField(t);if(!i)throw Error('Field "'+t+'" not found.');i.setValue(e)}setPreviousStatement(e,t){if(e)void 0===t&&(t=null),this.previousConnection||(this.previousConnection=this.makeConnection_(E.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(t);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(e,t){if(e)void 0===t&&(t=null),this.nextConnection||(this.nextConnection=this.makeConnection_(E.NEXT_STATEMENT)),this.nextConnection.setCheck(t);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(e,t){if(e)void 0===t&&(t=null),this.outputConnection||(this.outputConnection=this.makeConnection_(E.OUTPUT_VALUE)),this.outputConnection.setCheck(t);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(e){this.inputsInline!==e&&(g(new(m(f.BLOCK_CHANGE))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)}getInputsInline(){if(void 0!==this.inputsInline)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof th&&this.inputList[e]instanceof th)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof _.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[e]instanceof th)return!0;for(e=0;e<this.inputList.length;e++)if(this.inputList[e]instanceof ih)return!0;return!1}setOutputShape(e){this.outputShape_=e}getOutputShape(){return this.outputShape_}isEnabled(){return 0===this.disabledReasons.size}setDisabledReason(e,t){e||this.workspace.options.disable||!this.hasDisabledReason(Aa)||t==Aa||this.setDisabledReason(!1,Aa),this.disabledReasons.has(t)!==e&&(e?this.disabledReasons.add(t):this.disabledReasons.delete(t),(e=new(m(f.BLOCK_CHANGE))(this,"disabled",null,!e,e)).setDisabledReason(t),g(e))}getInheritedDisabled(){let e=this.getSurroundParent();for(;e;){if(!e.isEnabled())return!0;e=e.getSurroundParent()}return!1}hasDisabledReason(e){return this.disabledReasons.has(e)}getDisabledReasons(){return this.disabledReasons}isCollapsed(){return this.collapsed_}setCollapsed(e){this.collapsed_!==e&&(g(new(m(f.BLOCK_CHANGE))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)}toString(e,t){t=this.toTokens(t);for(let e=2;e<t.length;e++)"("===t[e-2]&&")"===t[e]&&(t[e-2]=t[e-1],t.splice(e-1,2));let i="";return t=(t=t.reduce((e,t)=>(e=e+("("===i||")"===t?"":" ")+t,i=t[t.length-1],e),"")).trim()||"???",t=e&&t.length>e?t.substring(0,e-3)+"...":t}toTokens(t="?"){var i,s=[];for(i of this.inputList)if(i.name!=Sa){for(var e of i.fieldRow)s.push(e.getText());if(i.connection){var o=i.connection.targetBlock();if(o){var n=i.connection;let e=n.getCheck();(n=!!(e=!e&&n.targetConnection?n.targetConnection.getCheck():e)&&(e.includes("Boolean")||e.includes("Number")))&&s.push("("),s.push(...o.toTokens(t)),n&&s.push(")")}else s.push(t)}}return s}appendValueInput(e){return this.appendInput(new _.ValueInput$$module$build$src$core$inputs$value_input(e,this))}appendStatementInput(e){return this.statementInputCount++,this.appendInput(new sh(e,this))}appendDummyInput(e=""){return this.appendInput(new th(e,this))}appendEndRowInput(e=""){return this.appendInput(new ih(e,this))}appendInput(e){return this.inputList.push(e),e}appendInputFromRegistry(e,t){return(e=dr(b.INPUT,e,!1))?this.appendInput(new e(t,this)):null}jsonInit(e){var t=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(t+"Must not have both an output and a previousStatement.");for(var i=0;e["args"+i];){if(void 0===e["message"+i])throw Error(t+`args${i} must have a corresponding message (message${i}).`);i++}if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(t+"Must not have both a colour and a style.");for(e.style?this.jsonInitStyle(e,t):this.jsonInitColour(e,t),i=0;void 0!==e["message"+i];)this.interpolate(e["message"+i],e["args"+i]||[],e["implicitAlign"+i]||e["lastDummyAlign"+i],t),i++;if(void 0!==e.inputsInline&&(_.disable$$module$build$src$core$events$utils(),this.setInputsInline(e.inputsInline),_.enable$$module$build$src$core$events$utils()),void 0!==e.output&&this.setOutput(!0,e.output),void 0!==e.outputShape&&this.setOutputShape(e.outputShape),void 0!==e.previousStatement&&this.setPreviousStatement(!0,e.previousStatement),void 0!==e.nextStatement&&this.setNextStatement(!0,e.nextStatement),void 0!==e.tooltip&&(i=ss(e.tooltip),this.setTooltip(i)),void 0!==e.enableContextMenu&&(this.contextMenu=!!e.enableContextMenu),void 0!==e.suppressPrefixSuffix&&(this.suppressPrefixSuffix=!!e.suppressPrefixSuffix),void 0!==e.helpUrl&&(i=ss(e.helpUrl),this.setHelpUrl(i)),"string"==typeof e.extensions&&(console.warn(t+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),void 0!==e.mutator&&Zs(e.mutator,this,!0),e=e.extensions,Array.isArray(e))for(t=0;t<e.length;t++)Zs(e[t],this,!1)}jsonInitColour(t,i){if("colour"in t)if(void 0===t.colour)console.warn(i+"Undefined colour value.");else{t=t.colour;try{this.setColour(t)}catch(e){console.warn(i+"Illegal colour value: ",t)}}}jsonInitStyle(t,i){t=t.style;try{this.setStyle(t)}catch(e){console.warn(i+"Style does not exist: ",t)}}mixin(e,t){if(void 0!==t&&"boolean"!=typeof t)throw Error("opt_disableCheck must be a boolean if provided");if(!t){for(var i in t=[],e)void 0!==this[i]&&t.push(i);if(t.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(t))}Object.assign(this,e)}interpolate(i,s,o,n){i=is(i),this.validateTokens(i,s.length),s=this.interpolateArguments(i,s,o),o=[];for(let e=0,t;t=s[e];e++)if(this.isInputKeyword(t.type)){if(i=this.inputFromJson(t,n)){for(let e=0,t;t=o[e];e++)i.appendField(t[0],t[1]);o.length=0}}else(i=this.fieldFromJson(t))&&o.push([i,t.name])}validateTokens(t,i){var s=[];let o=0;for(let e=0;e<t.length;e++){var n=t[e];if("number"==typeof n){if(n<1||i<n)throw Error('Block "'+this.type+'": Message index %'+n+" out of range.");if(s[n])throw Error('Block "'+this.type+'": Message index %'+n+" duplicated.");s[n]=!0,o++}}if(o!==i)throw Error('Block "'+this.type+'": Message does not reference all '+i+" arg(s).")}interpolateArguments(t,i,s){var o=[];for(let e=0;e<t.length;e++){var n=t[e];if("string"==typeof(n="number"==typeof n?i[n-1]:n))if("\n"===n)n={type:"input_end_row"},s&&(n.align=s);else if(!(n=this.stringToFieldJson(n)))continue;o.push(n)}return(t=o.length)&&!this.isInputKeyword(o[t-1].type)&&(t={type:"input_dummy"},s&&(t.align=s),o.push(t)),o}fieldFromJson(e){var t=_.fromJson$$module$build$src$core$field_registry(e);return!t&&e.alt?"string"==typeof e.alt?(e=this.stringToFieldJson(e.alt))?this.fieldFromJson(e):null:this.fieldFromJson(e.alt):t}inputFromJson(e,t){let i={LEFT:_.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:_.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:_.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:_.Align$$module$build$src$core$inputs$align.CENTRE},s;switch(e.type){case"input_value":s=this.appendValueInput(e.name);break;case"input_statement":s=this.appendStatementInput(e.name);break;case"input_dummy":s=this.appendDummyInput(e.name);break;case"input_end_row":s=this.appendEndRowInput(e.name);break;default:s=this.appendInputFromRegistry(e.type,e.name)}return s?(e.check&&s.setCheck(e.check),e.align&&(void 0===(i=i[e.align.toUpperCase()])?console.warn(t+"Illegal align value: ",e.align):s.setAlign(i)),s):null}isInputKeyword(e){return"input_value"===e||"input_statement"===e||"input_dummy"===e||"input_end_row"===e||hr(b.INPUT,e)}stringToFieldJson(e){return(e=e.trim())?{type:"field_label",text:e}:null}moveInputBefore(i,s){if(i!==s){var o=-1,n=s?-1:this.inputList.length;for(let e=0,t;t=this.inputList[e];e++)if(t.name===i){if(o=e,-1!==n)break}else if(s&&t.name===s&&(n=e,-1!==o))break;if(-1===o)throw Error('Named input "'+i+'" not found.');if(-1===n)throw Error('Reference input "'+s+'" not found.');this.moveNumberedInputBefore(o,n)}}moveNumberedInputBefore(e,t){if(e===t)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(t>this.inputList.length)throw RangeError("Reference input "+t+" out of bounds.");var i=this.inputList[e];this.inputList.splice(e,1),e<t&&t--,this.inputList.splice(t,0,i)}removeInput(i,e){for(let e=0,t;t=this.inputList[e];e++)if(t.name===i)return t instanceof sh&&this.statementInputCount--,t.dispose(),this.inputList.splice(e,1),!0;if(e)return!1;throw Error("Input not found: "+i)}getInput(i){for(let e=0,t;t=this.inputList[e];e++)if(t.name===i)return t;return null}getInputTargetBlock(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()}getCommentText(){var e;return null!=(e=null==(e=this.getIcon(uc.COMMENT))?void 0:e.getText())?e:null}setCommentText(e){var t,i=null!=(i=null==(t=this.getIcon(uc.COMMENT))?void 0:t.getText())?i:null;if(i!==e){if(null!==e){if(!(t=this.getIcon(uc.COMMENT))){if(!(t=dr(b.ICON,uc.COMMENT.toString(),!1)))throw Error("No comment icon class is registered, so a comment cannot be set");if(t=new t(this),!To(t))throw Error("The class registered as a comment icon does not conform to the ICommentIcon interface");t=this.addIcon(t)}_.disable$$module$build$src$core$events$utils(),t.setText(e),_.enable$$module$build$src$core$events$utils()}else this.removeIcon(uc.COMMENT);g(new(m(f.BLOCK_CHANGE))(this,"comment",null,i,e))}}setWarningText(e,t){}setMutator(e){}addIcon(e){if(this.hasIcon(e.getType()))throw new Yu(e);return this.icons.push(e),this.icons.sort((e,t)=>e.getWeight()-t.getWeight()),e}removeIcon(t){var e;return!!this.hasIcon(t)&&(null!=(e=this.getIcon(t))&&e.dispose(),this.icons=this.icons.filter(e=>!e.getType().equals(t)),!0)}hasIcon(t){return this.icons.some(e=>e.getType().equals(t))}getIcon(t){return t instanceof uc?this.icons.find(e=>e.getType().equals(t)):this.icons.find(e=>e.getType().toString()===t)}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");var s=new(m(f.BLOCK_MOVE))(this);i&&s.setReason(i),this.xy.translate(e,t),s.recordNew(),g(s)}makeConnection_(e){return new O(this,e)}allInputsFilled(i){if(!(i=void 0===i?!0:i)&&this.isShadow())return!1;for(let e=0,t;t=this.inputList[e];e++)if(t.connection){var s=t.connection.targetBlock();if(!s||!s.allInputsFilled(i))return!1}return!(s=this.getNextBlock())||s.allInputsFilled(i)}toDevString(){let e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e}}),nh=(oh.COLLAPSED_INPUT_NAME=Sa,oh.COLLAPSED_FIELD_NAME=wa,null),rh=null,lh={},ah=(lh.connectionUiEffect=yo,lh.disconnectUiEffect=ko,lh.disconnectUiStop=Co,lh.disposeUiEffect=Eo,class{paste(e,t,i){if(!t.isCapacityAvailable(e.typeCounts))return null;i&&(e.blockState.x=i.x,e.blockState.y=i.y),i=i||new y(e.blockState.x||0,e.blockState.y||0),_.disable$$module$build$src$core$events$utils();let s;try{s=zt(e.blockState,t),So(s,i)}finally{_.enable$$module$build$src$core$events$utils()}if(s){U()&&!s.isShadow()&&g(new(m(f.BLOCK_CREATE))(s));let e=s;tt().then(()=>_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e))}return s}}),ch=(up(ah.TYPE="block",new ah),{}),uh=(ch.bumpIntoBounds=xo,ch.bumpIntoBoundsHandler=Ro,ch.bumpTopObjectsIntoBounds=No,class{constructor(e){this.block=e,this.connectionPreviewer=this.connectionCandidate=this.startLoc=this.startChildConn=this.startParentConn=null,this.dragging=!1,this.dragOffset=new y(0,0),this.originalEventGroup="",this.workspace=e.workspace}isMovable(){var e;return this.block.isShadow()?null!=(e=null==(e=this.block.getParent())?void 0:e.isMovable())&&e:this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.isReadOnly()&&!this.block.isInFlyout}startDrag(e){this.block.isShadow()?this.startDraggingShadow(e):(this.dragging=!0,this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY(),this.connectionCandidate=null,this.connectionPreviewer=new(mr(b.CONNECTION_PREVIEWER,this.workspace.options))(this.block),X(),this.workspace.setResizesEnabled(!1),Co(),e=this.shouldHealStack(e),this.shouldDisconnect(e)&&this.disconnectBlock(e),this.block.setDragging(!0),null!=(e=this.workspace.getLayerManager())&&e.moveToDragLayer(this.block))}shouldHealStack(e){return!!e&&(e.altKey||e.ctrlKey||e.metaKey)}startDraggingShadow(e){var t=this.block.getParent();if(!t)throw Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=y.difference(t.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),t.startDrag(e)}shouldDisconnect(e){return!!(this.block.getParent()||e&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(e){var t;this.startParentConn=null!=(t=null==(t=this.block.outputConnection)?void 0:t.targetConnection)?t:null==(t=this.block.previousConnection)?void 0:t.targetConnection,e&&(this.startChildConn=null==(t=this.block.nextConnection)?void 0:t.targetConnection),this.block.unplug(e),ko(this.block)}fireDragStartEvent(){var e=new(m(f.BLOCK_DRAG))(this.block,!0,this.block.getDescendants(!1));g(e)}fireDragEndEvent(){var e=new(m(f.BLOCK_DRAG))(this.block,!1,this.block.getDescendants(!1));g(e)}fireMoveEvent(){var e;this.block.isDeadOrDying()||((e=new(m(f.BLOCK_MOVE))(this.block)).setReason(["drag"]),e.oldCoordinate=this.startLoc,e.recordNew(),g(e))}drag(e){var t;this.block.isShadow()?null!=(t=this.block.getParent())&&t.drag(y.sum(e,this.dragOffset)):(this.block.moveDuringDrag(e),this.updateConnectionPreview(this.block,y.difference(e,this.startLoc)))}updateConnectionPreview(e,t){var i,s,o=this.connectionCandidate,n=this.getConnectionCandidate(e,t);n?(this.connectionCandidate=t=o&&this.currCandidateIsBetter(o,t,n)?o:n,{local:n,neighbour:i}=t,t=n.type===E.OUTPUT_VALUE||n.type===E.PREVIOUS_STATEMENT,o=i.isConnected()&&!(null!=(s=i.targetBlock())&&s.isInsertionMarker()),t&&o&&!this.orphanCanConnectAtEnd(e,i.targetBlock(),n.type)?null!=(s=this.connectionPreviewer)&&s.previewReplacement(n,i,i.targetBlock()):null!=(t=this.connectionPreviewer)&&t.previewConnection(n,i)):(null!=(o=this.connectionPreviewer)&&o.hidePreview(),this.connectionCandidate=null)}orphanCanConnectAtEnd(e,t,i){return!!O.getConnectionForOrphanedConnection(e,i===E.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}currCandidateIsBetter(e,t,i){var{local:s,neighbour:o}=e,s=(e=new y(s.x,s.y),new y(o.x,o.y));return t=y.distance(y.sum(e,t),s),i.distance>t-_.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(e,t){e=this.getLocalConnections(e);let i=this.getSearchRadius(),s=null;for(var o of e){var{connection:n,radius:r}=o.closest(i,t);n&&(s={local:o,neighbour:n,distance:r},i=r)}return s}getSearchRadius(){return this.connectionCandidate?_.config$$module$build$src$core$config.connectingSnapRadius:_.config$$module$build$src$core$config.snapRadius}getLocalConnections(e){var t=e.getConnections_(!1),i=e.lastConnectionInStack(!0);return i&&i!==e.nextConnection&&t.push(i),t}endDrag(e){var t;this.block.isShadow()?null!=(t=this.block.getParent())&&t.endDrag(e):(this.originalEventGroup=_.getGroup$$module$build$src$core$events$utils(),this.fireDragEndEvent(),this.fireMoveEvent(),K(),Co(),null!=(t=this.connectionPreviewer)&&t.hidePreview(),!this.block.isDeadOrDying()&&this.dragging&&(null!=(e=this.workspace.getLayerManager())&&e.moveOffDragLayer(this.block,50),this.block.setDragging(!1)),this.connectionCandidate?(this.applyConnections(this.connectionCandidate),this.disposeStep()):this.block.queueRender().then(()=>this.disposeStep()))}disposeStep(){var e,t=_.getGroup$$module$build$src$core$events$utils();_.setGroup$$module$build$src$core$events$utils(this.originalEventGroup),this.block.snapToGrid(),null!=(e=this.connectionPreviewer)&&e.dispose(),this.workspace.setResizesEnabled(!0),_.setGroup$$module$build$src$core$events$utils(t)}applyConnections(e){var{local:e,neighbour:t}=e;e.connect(t);let i=e.isSuperior()?t:e,s=this.block.getRootBlock();tt().then(()=>{yo(i.getSourceBlock()),setTimeout(()=>{s.bringToFront()},0)})}revertDrag(){if(this.block.isShadow())null!=(e=this.block.getParent())&&e.revertDrag();else{var e;if(null!=(e=this.connectionPreviewer)&&e.hidePreview(),(this.connectionCandidate=null)!=(e=this.startChildConn)&&e.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case E.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case E.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else this.block.moveTo(this.startLoc,["drag"]),null!=(e=this.workspace.getLayerManager())&&e.moveOffDragLayer(this.block,50),xo(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block);this.startParentConn=this.startChildConn=null,this.block.setDragging(!1),this.dragging=!1}}}),hh=class extends R{constructor(e,t,i,s){super(t,i,s),this.text=e,this.workspace=t,this.anchor=i,this.ownerRect=s,this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize(),c(this.svgRoot,"blocklyTextBubble")}getText(){return this.text}setText(e){this.text=e,l(this.paragraph),this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}stringToSvg(e,t){return t=this.createParagraph(t),e=this.createTextFragments(t,e),this.workspace.RTL&&this.rightAlignTextFragments(t.getBBox().width,e),t}createParagraph(e){return a(k.G,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",transform:`translate(0,${R.BORDER_WIDTH})`,style:"direction: "+(this.workspace.RTL?"rtl":"ltr")},e)}createTextFragments(i,e){let s=1;return e.split("\n").map(e=>{var t=a(k.TEXT,{y:s+"em",x:R.BORDER_WIDTH},i);return e=document.createTextNode(e),t.appendChild(e),s+=1,t})}rightAlignTextFragments(e,t){for(var i of t)i.setAttribute("text-anchor","start"),i.setAttribute("x",""+(e+R.BORDER_WIDTH))}updateBubbleSize(){var e=this.paragraph.getBBox();this.setSize(new C(e.width+2*R.BORDER_WIDTH,e.height+2*R.BORDER_WIDTH),!0)}},dh=class extends Hu{constructor(e){super(e),this.sourceBlock=e,this.textMap=new Map,this.textBubble=null}getType(){return dh.TYPE}initView(e){this.svgRoot||(super.initView(e),a(k.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),a(k.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),a(k.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),c(this.svgRoot,"blocklyWarningIcon"))}dispose(){var e;super.dispose(),null!=(e=this.textBubble)&&e.dispose()}getWeight(){return dh.WEIGHT}getSize(){return new C(17,17)}applyColour(){var e;super.applyColour(),null!=(e=this.textBubble)&&e.setColour(this.sourceBlock.getColour())}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(e){super.onLocationChange(e),null!=(e=this.textBubble)&&e.setAnchorLocation(this.getAnchorLocation())}addMessage(e,t){return this.textMap.get(t)!==e&&(e?this.textMap.set(t,e):this.textMap.delete(t),null!=(e=this.textBubble))&&e.setText(this.getText()),this}getText(){return[...this.textMap.values()].join("\n")}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(t){let i=this;return(0,d.asyncExecutePromiseGeneratorFunction)(function*(){var e;i.bubbleIsVisible()!==t&&(yield tt(),t?(i.textBubble=new hh(i.getText(),i.sourceBlock.workspace,i.getAnchorLocation(),i.getBubbleOwnerRect()),i.applyColour()):(null!=(e=i.textBubble)&&e.dispose(),i.textBubble=null),g(new(m(f.BUBBLE_OPEN))(i.sourceBlock,t,"warning")))})}getBubble(){return this.textBubble}getAnchorLocation(){return y.sum(this.workspaceLocation,new y(8.5,8.5))}getBubbleOwnerRect(){var e=this.sourceBlock.getSvgRoot().getBBox();return new I(e.y,e.y+e.height,e.x,e.x+e.width)}},N=(dh.TYPE=uc.WARNING,dh.WEIGHT=2,class extends oh{constructor(e,t,i){if(super(e,t,i),this.childlessWidth=this.width=this.height=0,this.warningTextDb=new Map,this.mutator=null,this.rendered=!0,this.visuallyDisabled=!1,this.translation="",this.dragging=!1,this.relativeCoords=new y(0,0),this.dragStrategy=new uh(this),!e.rendered)throw TypeError("Cannot create a rendered block in a headless workspace");this.workspace=e,this.svgGroup=a(k.G,{}),t&&c(this.svgGroup,t),this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup,this.style),(e=this.pathObject.svgPath).tooltip=this,Di(e),this.svgGroup.setAttribute("data-id",this.id),e.id=wr(),this.doInit_()}initSvg(){if(!this.initialized){for(var e of this.inputList)e.init();for(var t of this.getIcons())t.initView(this.createIconPointerDownListener(t)),t.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()||this.isInFlyout),(e=this.getSvgRoot())&&p(e,"pointerdown",this,this.onMouseDown),e.parentNode||this.workspace.getCanvas().appendChild(e),this.initialized=!0}}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){this.addSelect(),ce(this)}unselect(){this.removeSelect(),ce(null)}setParent(e){var t,i,s,o,n,r=this.parentBlock_;e!==r&&(X(),super.setParent(e),K(),t=this.getSvgRoot(),!this.workspace.isClearing)&&t&&(i=this.getRelativeToSurfaceXY(),s=_.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode(),n=this.getSvgRoot().contains(null!=(o=null==s?void 0:s.getFocusableElement())?o:null),e?(e.getSvgRoot().appendChild(t),n&&s&&_.getFocusManager$$module$build$src$core$focus_manager().focusNode(s)):r&&((null==(e=this.workspace.getCanvas().querySelector(".blocklyDragging"))?void 0:e.parentElement)===(o=this.workspace.getCanvas())?o.insertBefore(t,e):(o.appendChild(t),n&&s&&_.getFocusManager$$module$build$src$core$focus_manager().focusNode(s)),this.translate(i.x,i.y)),this.applyColour())}getRelativeToSurfaceXY(){var e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let t=0,i=0,s=this.getSvgRoot();if(s)do{var o=we(s);t+=o.x,i+=o.y,s=s.parentNode}while(s&&!e.hasLayer(s));return new y(t,i)}moveBy(e,t,i){if(this.parentBlock_)throw Error("Block has parent");var s=U();let o=null;s&&(o=new(m(f.BLOCK_MOVE))(this),i)&&o.setReason(i),e=new y(e,t),t=this.getRelativeToSurfaceXY(),e=y.sum(t,e),this.translate(e.x,e.y),this.updateComponentLocations(e),s&&o&&(o.recordNew(),g(o)),this.workspace.resizeContents()}translate(e,t){this.translation=`translate(${e}, ${t})`,this.relativeCoords=new y(e,t),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(e,t){var i=this.getRelativeToSurfaceXY();this.moveBy(e.x-i.x,e.y-i.y,t)}moveDuringDrag(e){this.translate(e.x,e.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(e)}snapToGrid(){var e,t;this.isDeadOrDying()||this.getParent()||this.isInFlyout||null!=(t=this.workspace.getGrid())&&t.shouldSnap()&&(e=this.getRelativeToSurfaceXY(),(t=t.alignXY(e))!==e)&&this.moveTo(t,["snap"])}getBoundingRectangle(){return this.getBoundingRectangleWithDimensions(this.getHeightWidth())}getBoundingRectangleWithoutChildren(){return this.getBoundingRectangleWithDimensions({height:this.height,width:this.childlessWidth})}getBoundingRectangleWithDimensions(e){var t=this.getRelativeToSurfaceXY();let i,s;return s=this.RTL?(i=t.x-e.width,t.x):(i=t.x,t.x+e.width),new I(t.y,t.y+e.height,i,s)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let e=0,t;t=this.inputList[e];e++)t.markDirty()}setCollapsed(e){this.collapsed_!==e&&(super.setCollapsed(e),this.updateCollapsed())}childHasWarning(){var e;for(e of this.getChildren(!1))if(e.getIcon(dh.TYPE)||e.childHasWarning())return!0;return!1}updateCollapsed(){var e,i=this.isCollapsed(),s=Sa,t=wa;for(let e=0,t;t=this.inputList[e];e++)t.name!==s&&t.setVisible(!i);for(e of this.getIcons())e.updateCollapsed();i?(c(this.svgGroup,"blocklyCollapsed"),this.childHasWarning()&&this.setWarningText(_.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,N.COLLAPSED_WARNING_ID),i=this.toString(30),(e=this.getField(t))?e.setValue(i):(this.getInput(s)||this.appendDummyInput(s)).appendField(new Ku(i),t)):(this.updateDisabled(),this.removeInput(s),r(this.svgGroup,"blocklyCollapsed"),this.setWarningText(null,N.COLLAPSED_WARNING_ID))}onMouseDown(e){var t;this.workspace.isReadOnly()||(t=this.workspace.getGesture(e))&&t.handleBlockStart(e,this)}showHelp(){var e="function"==typeof this.helpUrl?this.helpUrl():this.helpUrl;e&&window.open(e)}generateContextMenu(e){return this.workspace.isReadOnly()||!this.contextMenu?null:(e=x.registry.getContextMenuOptions({block:this,focusedNode:this},e),this.customContextMenu&&this.customContextMenu(e),e)}calculateContextMenuLocation(e){var t;return e instanceof PointerEvent?new y(e.clientX,e.clientY):(e=Ne(this.workspace,this.getRelativeToSurfaceXY()),t=null==(t=this.inputList.filter(e=>e.isVisible()).flatMap(e=>e.fieldRow).find(e=>e.isVisible()))||null==(t=t.getSvgRoot())?void 0:t.getBoundingClientRect(),new y(this.RTL?e.x-5:e.x+5,(t&&t.height?t.y+t.height:e.y+this.height)+5))}showContextMenu(e){var t=this.generateContextMenu(e),i=this.calculateContextMenuLocation(e);t&&t.length&&(fs(e,t,this.RTL,this.workspace,i),bs(this))}updateComponentLocations(e){this.dragging||this.updateConnectionLocations(e),this.updateIconLocations(e),this.updateFieldLocations(e);for(var t of this.getChildren(!1))t.updateComponentLocations(y.sum(e,t.relativeCoords))}updateConnectionLocations(e){for(var t of this.getConnections_(!1))t.moveToOffset(e)}updateIconLocations(e){for(var t of this.getIcons())t.onLocationChange(e)}updateFieldLocations(e){for(var t of this.inputList)for(var i of t.fieldRow)i.onLocationChange(e)}addClass(e){c(this.svgGroup,e)}removeClass(e){r(this.svgGroup,e)}setDragging(t){(this.dragging=t)?(this.translation="",Gl.push(...this.getConnections_(!0)),this.addClass("blocklyDragging")):(Gl.length=0,this.removeClass("blocklyDragging"));for(let e=0;e<this.childBlocks_.length;e++)this.childBlocks_[e].setDragging(t)}setMovable(e){super.setMovable(e),this.pathObject.updateMovable(e)}setEditable(t){super.setEditable(t),(t?r:c)(this.svgGroup,"blocklyNotEditable"),t=this.getIcons();for(let e=0;e<t.length;e++)t[e].updateEditable()}setShadow(e){super.setShadow(e),this.applyColour()}setInsertionMarker(e){this.isInsertionMarker_!==e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup}dispose(e,t){this.disposing=!0,Hi(),ks();let i=_.getFocusManager$$module$build$src$core$focus_manager();var s,o,n;this.getSvgRoot().contains(null!=(s=null==(n=i.getFocusedNode())?void 0:n.getFocusableElement())?s:null)&&((n=this.getParent())||(s=null!=(o=this.outputConnection)?o:this.previousConnection)&&(n=null==(o=s.closest(0,new y(0,0)).connection)?void 0:o.getSourceBlock()),n?i.focusNode(n):setTimeout(()=>i.focusTree(this.workspace),0)),t&&(this.unplug(e),Eo(this)),super.dispose(!!e),l(this.svgGroup)}disposeInternal(){this.disposing=!0,super.disposeInternal(),_.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode()===this&&this.workspace.cancelCurrentGesture(),[...this.warningTextDb.values()].forEach(e=>clearTimeout(e)),this.warningTextDb.clear(),this.getIcons().forEach(e=>e.dispose())}checkAndDelete(){this.workspace.isFlyout||(_.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),_.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:ah.TYPE,blockState:Dt(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:de(this,!0)}}applyColour(){var e,t,i;for(null!=(t=(e=this.pathObject).applyColour)&&t.call(e,this),e=this.getIcons(),t=0;t<e.length;t++)e[t].applyColour();for(i of this.getFields())i.applyColour()}updateDisabled(){var e,t=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===t)null!=(e=this.getNextBlock())&&e.updateDisabled();else{this.applyColour(),this.visuallyDisabled=t;for(var i of this.getChildren(!1))i.updateDisabled()}}setWarningText(i,s=""){if(s)this.warningTextDb.has(s)&&(clearTimeout(this.warningTextDb.get(s)),this.warningTextDb.delete(s));else{for(var o of this.warningTextDb.values())clearTimeout(o);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(s,setTimeout(()=>{this.isDeadOrDying()||(this.warningTextDb.delete(s),this.setWarningText(i,s))},100));else if(this.isInFlyout&&(i=null),o=this.getIcon(dh.TYPE),i){let e=this.getSurroundParent(),t=null;for(;e;)e.isCollapsed()&&(t=e),e=e.getSurroundParent();t&&t.setWarningText(_.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,N.COLLAPSED_WARNING_ID),o?o.addMessage(i,s):this.addIcon(new dh(this).addMessage(i,s))}else!o||s&&(o.addMessage("",s),o.getText())||this.removeIcon(dh.TYPE)}setMutator(e){this.removeIcon(_.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),e&&this.addIcon(e)}addIcon(e){return super.addIcon(e),e instanceof _.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=e),e.initView(this.createIconPointerDownListener(e)),e.applyColour(),e.updateEditable(),this.queueRender(),e}createIconPointerDownListener(t){return e=>{this.isDeadOrDying()||(e=this.workspace.getGesture(e))&&e.setStartIcon(t)}}removeIcon(e){var t=super.removeIcon(e);return e.equals(_.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.queueRender(),t}setDisabledReason(e,t){var i=this.isEnabled();super.setDisabledReason(e,t),this.isEnabled()===i||this.getInheritedDisabled()||this.updateDisabled()}setDeletable(e){super.setDeletable(e),(e?r:c)(this.svgGroup,"blocklyNotDeletable")}setHighlighted(e){this.pathObject.updateHighlighted(e)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(e){this.pathObject.updateDraggingDelete(e)}getColour(){return this.style.colourPrimary}setColour(e){var t,i;super.setColour(e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),null!=(i=(t=this.pathObject).setStyle)&&i.call(t,e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()}setStyle(e){var t,i,s=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_&&r(this.svgGroup,this.styleName_),!s)throw Error("Invalid style name: "+e);this.hat=s.hat,null!=(i=(t=this.pathObject).setStyle)&&i.call(t,s),this.colour_=s.colourPrimary,this.style=s,this.applyColour(),c(this.svgGroup,e),this.styleName_=e}getStyle(){return this.style}bringToFront(e=!1){var t=_.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode();let i=this;if(!i.isDeadOrDying()){do{var s=i.getSvgRoot(),o=s.parentNode,n=o.childNodes;if(n[n.length-1]!==s&&o.appendChild(s),e)break}while(i=i.getParent());t&&_.getFocusManager$$module$build$src$core$focus_manager().focusNode(t)}}setPreviousStatement(e,t){super.setPreviousStatement(e,t),this.queueRender()}setNextStatement(e,t){super.setNextStatement(e,t),this.queueRender()}setOutput(e,t){super.setOutput(e,t),this.queueRender()}setInputsInline(e){super.setInputsInline(e),this.queueRender()}removeInput(e,t){return e=super.removeInput(e,t),this.queueRender(),e}moveNumberedInputBefore(e,t){super.moveNumberedInputBefore(e,t),this.queueRender()}appendInput(e){return super.appendInput(e),this.queueRender(),e}setConnectionTracking(e){var t;if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection&&(this.nextConnection.setTracking(e),t=this.nextConnection.targetBlock())&&t.setConnectionTracking(e),!this.collapsed_)for(t=0;t<this.inputList.length;t++){var i=this.inputList[t].connection;i&&(i.setTracking(e),i=i.targetBlock())&&i.setConnectionTracking(e)}}getConnections_(e){var i=[];if(this.outputConnection&&i.push(this.outputConnection),this.previousConnection&&i.push(this.previousConnection),this.nextConnection&&i.push(this.nextConnection),e||!this.collapsed_)for(let e=0,t;t=this.inputList[e];e++)t.connection&&i.push(t.connection);return i}lastConnectionInStack(e){return super.lastConnectionInStack(e)}getMatchingConnection(e,t){return super.getMatchingConnection(e,t)}makeConnection_(e){return new Qu(this,e)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){var e,t,i=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||i.isInFlyout))for(var s of this.getConnections_(!1)){s.isSuperior()&&null!=(e=s.targetBlock())&&e.bumpNeighbours();for(t of s.neighbours(_.config$$module$build$src$core$config.snapRadius))t.getSourceBlock().getRootBlock()===i||s.isConnected()&&t.isConnected()||(s.isSuperior()?t.bumpAwayFrom(s,!1):s.bumpAwayFrom(t,!0))}}scheduleSnapAndBump(){this.snapToGrid(),this.bumpNeighbours()}positionNearConnection(e,t,i){var s;e.type!==E.NEXT_STATEMENT&&e.type!==E.INPUT_VALUE||(s=t.x,t=t.y,s+=i.x-e.getOffsetInBlock().x,t+=i.y-e.getOffsetInBlock().y,this.moveBy(s,t))}getChildren(e){return super.getChildren(e)}queueRender(){return et(this)}render(){this.queueRender(),it()}renderEfficiently(){X(),this.isCollapsed()&&this.updateCollapsed(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),K()}tightenChildrenEfficiently(){for(var e of this.inputList){e=e.connection;e&&e.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}getHeightWidth(){let e=this.height,t=this.width;var i,s=this.getNextBlock();return s&&(s=s.getHeightWidth(),i=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT,e+=s.height-i,t=Math.max(t,s.width)),{height:e,width:t}}fadeForReplacement(e){this.pathObject.updateReplacementFade(e)}highlightShapeForInput(e,t){this.pathObject.updateShapeForInputHighlight(e,t)}getDragStrategy(){return this.dragStrategy}setDragStrategy(e){this.dragStrategy=e}isCopyable(){return this.isOwnDeletable()&&this.isOwnMovable()}isMovable(){return this.dragStrategy.isMovable()}startDrag(e){this.dragStrategy.startDrag(e)}drag(e,t){this.dragStrategy.drag(e,t)}endDrag(e){this.dragStrategy.endDrag(e)}revertDrag(){this.dragStrategy.revertDrag()}toFlyoutInfo(){let e=Object.assign({},{kind:"BLOCK"},Dt(this)),i=new Set(["id","height","width","pinned","enabled"]),s=function(e){for(var t in e)i.has(t)?delete e[t]:"object"==typeof e[t]&&s(e[t])};return s(e),[e]}jsonInit(e){super.jsonInit(e),e.classes&&this.addClass(Array.isArray(e.classes)?e.classes.join(" "):e.classes)}getFocusableElement(){return this.pathObject.svgPath}getFocusableTree(){return this.workspace}onNodeFocus(){this.select()}onNodeBlur(){this.unselect()}canBeFocused(){return!0}}),ph=(N.INLINE=-1,N.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_",class{constructor(){}onDragEnter(e){}onDragOver(e){}onDragExit(e){}onDrop(e){}getClientRect(){return null}shouldPreventMove(e){return!1}}),gh=class extends ph{constructor(){super(),this.wouldDelete_=!1}wouldDelete(e){return e instanceof N?(e=!e.getParent()&&e.isDeletable(),this.updateWouldDelete_(e)):this.updateWouldDelete_($o(e)&&e.isDeletable()),this.wouldDelete_}updateWouldDelete_(e){this.wouldDelete_=e}},mh=class{constructor(e,t){this.element=e,this.type=t}getElement(){return this.element}getType(){return this.type}},_h=class{constructor(e){this.workspace_=e}getDimensionsPx_(e){let t=0,i=0;return e&&(t=e.getWidth(),i=e.getHeight()),new C(t,i)}getFlyoutMetrics(e){return{width:(e=this.getDimensionsPx_(this.workspace_.getFlyout(e))).width,height:e.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){var e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let e=0,t=0;var i=this.getToolboxMetrics(),s=this.getFlyoutMetrics(),o=!!this.workspace_.getToolbox(),n=!(null!=(r=this.workspace_.getFlyout())&&r.autoClose),r=(o?i:s).position,l=r===T.TOP;return r===T.LEFT&&(o&&(e+=i.width),n)&&(e+=s.width),l&&(o&&(t+=i.height),n)&&(t+=s.height),{top:t,left:e}}getViewMetrics(e){e=e?this.workspace_.scale:1;var t=this.getSvgMetrics(),i=this.getToolboxMetrics(),s=this.getFlyoutMetrics(),o=!!this.workspace_.getToolbox(),n=!(null!=(r=this.workspace_.getFlyout())&&r.autoClose),r=(o?i:s).position,l=r===T.LEFT||r===T.RIGHT;return r!==T.TOP&&r!==T.BOTTOM||(o&&(t.height-=i.height),n&&(t.height-=s.height)),l&&(o&&(t.width-=i.width),n)&&(t.width-=s.width),{height:t.height/e,width:t.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}}getContentMetrics(e){e=e?1:this.workspace_.scale;var t=this.workspace_.getBlocksBoundingBox();return{height:(t.bottom-t.top)*e,width:(t.right-t.left)*e,top:t.top*e,left:t.left*e}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(e){var t,i,s;return this.hasFixedEdges()?(t=this.workspace_.isMovableHorizontally(),i=this.workspace_.isMovableVertically(),e=e||this.getViewMetrics(!1),s={},i||(s.top=e.top,s.bottom=e.top+e.height),t||(s.left=e.left,s.right=e.left+e.width),s):{}}getPaddedContent_(e,t){var i=t.top+t.height,s=t.left+t.width,o=e.width,n=o/2,r=(e=e.height)/2;return{top:Math.min(t.top-r,i-e),bottom:Math.max(i+r,t.top+e),left:Math.min(t.left-n,s-o),right:Math.max(s+n,t.left+o)}}getScrollMetrics(e,t,i){e=e?this.workspace_.scale:1,t=t||this.getViewMetrics(!1);var s=i||this.getContentMetrics(),o=(i=this.getComputedFixedEdges_(t),t=this.getPaddedContent_(t,s),s=(void 0!==i.top?i:t).top,(void 0!==i.left?i:t).left);return{top:s/e,left:o/e,width:((void 0!==i.right?i:t).right-o)/e,height:((void 0!==i.bottom?i:t).bottom-s)/e}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){var e=this.getToolboxMetrics(),t=this.getFlyoutMetrics(!0),i=this.getSvgMetrics(),s=this.getAbsoluteMetrics(),o=this.getViewMetrics(),n=this.getContentMetrics(),r=this.getScrollMetrics(!1,o,n);return{contentHeight:n.height,contentWidth:n.width,contentTop:n.top,contentLeft:n.left,scrollHeight:r.height,scrollWidth:r.width,scrollTop:r.top,scrollLeft:r.left,viewHeight:o.height,viewWidth:o.width,viewTop:o.top,viewLeft:o.left,absoluteTop:s.top,absoluteLeft:s.left,svgHeight:i.height,svgWidth:i.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:t.width,flyoutHeight:t.height}}},bh=(o(b.METRICS_MANAGER,Ur,_h),class extends _h{constructor(e,t){super(e),this.flyout_=t}getBoundingBox(){let t;try{t=this.workspace_.getCanvas().getBBox()}catch(e){t={height:0,y:0,width:0,x:0}}return t}getContentMetrics(e){var t=this.getBoundingBox();return e=e?1:this.workspace_.scale,{height:t.height*e,width:t.width*e,top:t.y*e,left:t.x*e}}getScrollMetrics(e,t,i){return t=i||this.getContentMetrics(),i=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(t.height+2*i)/e,width:(t.width+t.left+i)/e,top:0,left:0}}}),fh=class{constructor(e,t,i,s){this.workspace=e,this.targetWorkspace=t,this.isFlyoutLabel=s,this.height=this.width=0,this.cursorSvg=this.svgText=null,this.text=i.text,this.position=new y(0,0),this.callbackKey=i.callbackKey||i.callbackkey,this.cssClass=i["web-class"]||null,this.info=i,e=this.isFlyoutLabel?"blocklyFlyoutLabel":"blocklyFlyoutButton",this.cssClass&&(e+=" "+this.cssClass),this.id=wr(),this.svgGroup=a(k.G,{id:this.id,class:e},this.workspace.getCanvas());let o;this.isFlyoutLabel||(o=a(k.RECT,{class:"blocklyFlyoutButtonShadow",rx:fh.BORDER_RADIUS,ry:fh.BORDER_RADIUS,x:1,y:1},this.svgGroup)),e=a(k.RECT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:fh.BORDER_RADIUS,ry:fh.BORDER_RADIUS},this.svgGroup),t=a(k.TEXT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup),i=ss(this.text),this.workspace.RTL&&(i+="â€"),t.textContent=i,this.isFlyoutLabel&&(this.svgText=t,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill")),s=ve(t,"fontSize");var n=ve(t,"fontWeight"),r=ve(t,"fontFamily");this.width=q(t,s,n,r),i=Z(i,s,n,r),this.height=this.height||i.height,this.isFlyoutLabel||(this.width+=2*fh.TEXT_MARGIN_X,this.height+=2*fh.TEXT_MARGIN_Y,null!=(s=o)&&s.setAttribute("width",String(this.width)),null!=(n=o)&&n.setAttribute("height",String(this.height))),e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),t.setAttribute("x",String(this.width/2)),t.setAttribute("y",String(this.height/2-i.height/2+i.baseline)),this.updateTransform(),this.onMouseDownWrapper=p(this.svgGroup,"pointerdown",this,this.onMouseDown),this.onMouseUpWrapper=p(this.svgGroup,"pointerup",this,this.onMouseUp)}createDom(){return this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(e,t){this.position.x=e,this.position.y=t,this.updateTransform()}moveBy(e,t,i){this.moveTo(this.position.x+e,this.position.y+t)}isLabel(){return this.isFlyoutLabel}getPosition(){return this.position}getBoundingRectangle(){return new I(this.position.y,this.position.y+this.height,this.position.x,this.position.x+this.width)}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}getWorkspace(){return this.workspace}dispose(){n(this.onMouseDownWrapper),n(this.onMouseUpWrapper),this.svgGroup&&l(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}setCursorSvg(e){e?this.svgGroup&&(this.svgGroup.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}onMouseUp(e){(e=this.targetWorkspace.getGesture(e))&&e.cancel(),this.isFlyoutLabel&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isFlyoutLabel||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isFlyoutLabel||(e=this.targetWorkspace.getButtonCallback(this.callbackKey))&&e(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}onMouseDown(e){var t=this.targetWorkspace.getGesture(e),i=this.targetWorkspace.getFlyout();t&&i&&t.handleFlyoutStart(e,i)}getSvgRoot(){return this.svgGroup}getFocusableElement(){return this.svgGroup}getFocusableTree(){return this.workspace}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}},Th=(fh.TEXT_MARGIN_X=5,fh.TEXT_MARGIN_Y=2,fh.BORDER_RADIUS=4,be("\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n"),class{getFirstChild(e){return null}getParent(e){return e.getWorkspace()}getNextSibling(e){return null}getPreviousSibling(e){return null}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof fh}}),Eh=class{constructor(e,t){this.policy=e,this.flyout=t}getFirstChild(e){return null}getParent(e){return this.policy.getParent(e)}getNextSibling(t){var e=this.flyout.getContents();if(!e)return null;let i=e.findIndex(e=>e.getElement()===t);return-1===i?null:e[i=++i>=e.length?0:i].getElement()}getPreviousSibling(t){var e=this.flyout.getContents();if(!e)return null;let i=e.findIndex(e=>e.getElement()===t);return-1===i?null:e[i=--i<0?e.length-1:i].getElement()}isNavigable(e){return this.policy.isNavigable(e)}isApplicable(e){return this.policy.isApplicable(e)}},vh=class{constructor(e,t){this.gap=e,this.axis=t,this.y=this.x=0}getBoundingRectangle(){switch(this.axis){case"x":return new I(this.y,this.y,this.x,this.x+this.gap);case"y":return new I(this.y,this.y+this.gap,this.x,this.x)}}moveBy(e,t,i){this.x+=e,this.y+=t}isNavigable(){return!1}getFocusableElement(){throw Error("Cannot be focused")}getFocusableTree(){throw Error("Cannot be focused")}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!1}},yh=class{getFirstChild(e){return null}getParent(e){return null}getNextSibling(e){return null}getPreviousSibling(e){return null}isNavigable(e){return!1}isApplicable(e){return e instanceof vh}},kh=class{getFirstChild(e){return Lo(e,!0)[0]}getParent(e){var t;if(null!=(t=e.previousConnection)&&t.targetBlock()){if(t=e.getSurroundParent())return t}else if(null!=(t=e.outputConnection)&&t.targetBlock())return e.outputConnection.targetBlock();return e.workspace}getNextSibling(e){var t;return null!=(t=e.nextConnection)&&t.targetBlock()?null==(t=e.nextConnection)?void 0:t.targetBlock():null!=(t=e.outputConnection)&&t.targetBlock()?Do(e,1):e.getSurroundParent()?Do(e.getTopStackBlock(),1):this.getParent(e)instanceof wd?Mo(e,1):null}getPreviousSibling(e){var t;return null!=(t=e.previousConnection)&&t.targetBlock()?null==(t=e.previousConnection)?void 0:t.targetBlock():null!=(t=e.outputConnection)&&t.targetBlock()?Do(e,-1):this.getParent(e)instanceof wd?Mo(e,-1):null}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof N}},Ih=class{getFirstChild(e){return null}getParent(e){return e.getParentComment()}getNextSibling(e){var t=e.getParentComment().view.getCommentBarButtons();return 0<=(e=t.indexOf(e))&&e+1<t.length?t[e+1]:null}getPreviousSibling(e){var t=e.getParentComment().view.getCommentBarButtons();return 0<(e=t.indexOf(e))?t[e-1]:null}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof gu}},Ch=class{getFirstChild(e){return e.getParentInput()?e.targetConnection:null}getParent(e){return e.getSourceBlock()}getNextSibling(e){var t,i;return e.getParentInput()?Do(e,1):e.type===E.NEXT_STATEMENT?(t=e.targetConnection,i=e.getSourceBlock(),t||i.getRootBlock().lastConnectionInStack(!1)!==e?t:(i=(e=i.workspace.getTopBlocks(!0)).indexOf(i.getRootBlock())+1,i=e[i=i>=e.length?0:i],null!=(t=this.getParentConnection(i))?t:i)):e.getSourceBlock()}getPreviousSibling(e){var t,i;return e.getParentInput()?Do(e,-1):e.type===E.PREVIOUS_STATEMENT||e.type===E.OUTPUT_VALUE?(t=e.targetConnection&&!e.targetConnection.getParentInput()?e.targetConnection:null,i=e.getSourceBlock(),t||this.getParentConnection(i.getRootBlock())!==e?t:(i=(e=i.workspace.getTopBlocks(!0)).indexOf(i.getRootBlock())-1,null!=(t=(i=e[i=i<0?e.length-1:i]).lastConnectionInStack(!1))?t:i)):e.type===E.NEXT_STATEMENT?e.getSourceBlock():null}getParentConnection(e){var t;return!e.outputConnection||null!=(t=e.previousConnection)&&t.isConnected()?e.previousConnection:e.outputConnection}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof Qu}},Sh=class{getFirstChild(e){return null}getParent(e){return e.getSourceBlock()}getNextSibling(e){return Do(e,1)}getPreviousSibling(e){return Do(e,-1)}isNavigable(e){var t;return e.canBeFocused()&&e.isVisible()&&(e.isClickable()||e.isCurrentlyEditable())&&!(null!=(t=e.getSourceBlock())&&t.isSimpleReporter()&&e.isFullBlockField())&&e.getParentInput().isVisible()}isApplicable(e){return e instanceof A}},wh=class{getFirstChild(e){return e instanceof _.MutatorIcon$$module$build$src$core$icons$mutator_icon&&e.bubbleIsVisible()&&_.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode()===e&&null!=(e=null==(e=e.getBubble())?void 0:e.getWorkspace())?e:null}getParent(e){return e.getSourceBlock()}getNextSibling(e){return Do(e,1)}getPreviousSibling(e){return Do(e,-1)}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof Hu}},Ah=class{getFirstChild(e){return e.view.getCommentBarButtons()[0]}getParent(e){return e.workspace}getNextSibling(e){return Mo(e,1)}getPreviousSibling(e){return Mo(e,-1)}isNavigable(e){return e.canBeFocused()}isApplicable(e){return e instanceof ku}},xh=class{getFirstChild(e){return(e=e.getTopBlocks(!0)).length?e[0]:null}getParent(e){return null}getNextSibling(e){return null}getPreviousSibling(e){return null}isNavigable(e){return e.canBeFocused()&&!e.isMutator}isApplicable(e){return e instanceof wd}},Rh=class{constructor(){this.rules=[new kh,new Sh,new Ch,new xh,new wh,new Ah,new Ih]}addNavigationPolicy(e){this.rules.push(e)}get(t){return this.rules.find(e=>e.isApplicable(t))}getFirstChild(e){var t=null==(t=this.get(e))?void 0:t.getFirstChild(e);return t?null!=(e=this.get(t))&&e.isNavigable(t)?t:this.getFirstChild(t)||this.getNextSibling(t):null}getParent(e){var t=null==(t=this.get(e))?void 0:t.getParent(e);return t?null!=(e=this.get(t))&&e.isNavigable(t)?t:this.getParent(t):null}getNextSibling(e){var t=null==(t=this.get(e))?void 0:t.getNextSibling(e);return t?null!=(e=this.get(t))&&e.isNavigable(t)?t:this.getNextSibling(t):null}getPreviousSibling(e){var t=null==(t=this.get(e))?void 0:t.getPreviousSibling(e);return t?null!=(e=this.get(t))&&e.isNavigable(t)?t:this.getPreviousSibling(t):null}},Oh=class extends Rh{constructor(t){super(),this.rules.push(new Th,new yh),this.rules=this.rules.map(e=>new Eh(e,t))}},Nh=class{constructor(e,t,i,s,o){this.workspace=e,this.oldHostMetrics=this.corner_=this.vScroll=this.hScroll=null,i=void 0===i||i;var n=(t=void 0===t||t)&&i;t&&(this.hScroll=new sa(e,!0,n,s,o)),i&&(this.vScroll=new sa(e,!1,n,s,o)),n&&(this.corner_=a(k.RECT,{height:sa.scrollbarThickness,width:sa.scrollbarThickness,class:"blocklyScrollbarBackground"}),j(this.corner_,e.getBubbleCanvas()))}dispose(){l(this.corner_),this.oldHostMetrics=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){var e=this.workspace.getMetrics();if(e){var t=!1,i=!1;if(this.oldHostMetrics&&this.oldHostMetrics.viewWidth===e.viewWidth&&this.oldHostMetrics.viewHeight===e.viewHeight&&this.oldHostMetrics.absoluteTop===e.absoluteTop&&this.oldHostMetrics.absoluteLeft===e.absoluteLeft?(this.oldHostMetrics&&this.oldHostMetrics.scrollWidth===e.scrollWidth&&this.oldHostMetrics.viewLeft===e.viewLeft&&this.oldHostMetrics.scrollLeft===e.scrollLeft||(t=!0),this.oldHostMetrics&&this.oldHostMetrics.scrollHeight===e.scrollHeight&&this.oldHostMetrics.viewTop===e.viewTop&&this.oldHostMetrics.scrollTop===e.scrollTop||(i=!0)):i=t=!0,t||i){try{_.disable$$module$build$src$core$events$utils(),this.hScroll&&t&&this.hScroll.resize(e),this.vScroll&&i&&this.vScroll.resize(e)}finally{_.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}this.hScroll&&this.vScroll&&(this.oldHostMetrics&&this.oldHostMetrics.viewWidth===e.viewWidth&&this.oldHostMetrics.absoluteLeft===e.absoluteLeft||null!=(t=this.corner_)&&t.setAttribute("x",String(this.vScroll.position.x)),this.oldHostMetrics&&this.oldHostMetrics.viewHeight===e.viewHeight&&this.oldHostMetrics.absoluteTop===e.absoluteTop||null!=(i=this.corner_)&&i.setAttribute("y",String(this.hScroll.position.y))),this.oldHostMetrics=e}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(e,t){this.hScroll&&this.hScroll.setOrigin(e,t),this.vScroll&&this.vScroll.setOrigin(e,t)}set(e,t,i){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(t,!1),!i&&void 0!==i||(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace.setMetrics(e))}setX(e){this.hScroll&&this.hScroll.set(e,!0)}setY(e){this.vScroll&&this.vScroll.set(e,!0)}setContainerVisible(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)}isVisible(){let e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),e=this.vScroll?e||this.vScroll.isVisible():e}setVisible(e){this.hScroll&&this.hScroll.setVisibleInternal(e),this.vScroll&&this.vScroll.setVisibleInternal(e)}resizeContent(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)}resizeView(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)}},$h="sep",Lh=class{load(e,t){return e=new vh(0,t.horizontalLayout?"x":"y"),new mh(e,$h)}gapForItem(e,t){return null!=(e=parseInt(String(e.gap)))?e:t}disposeItem(e){}getType(){return $h}};o(b.FLYOUT_INFLATER,$h,Lh);({SEPARATOR_TYPE:$h}).SeparatorFlyoutInflater=Lh;var Mh=class extends gh{constructor(e){super(),this.horizontalLayout=!1,this.boundEvents=[],this.reflowWrapper=null,this.contents=[],this.autoClose=!0,this.visible=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,this.inflaters=new Map,e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new wd(e),this.workspace_.setMetricsManager(new bh(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.visible),this.workspace_.setNavigator(new Oh(this)),this.id=Ar(),this.RTL=!!e.RTL,this.toolboxPosition_=e.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(e){return this.svgGroup_=a(e,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=a(k.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new Nh(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(p(this.svgGroup_,"wheel",this,this.wheel_)),this.boundEvents.push(p(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),e.getComponentManager().addComponent({component:this,weight:Kl.ComponentWeight.FLYOUT_WEIGHT,capabilities:[Kl.Capability.AUTOHIDEABLE,Kl.Capability.DELETE_AREA,Kl.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(var e of this.boundEvents)n(e);this.boundEvents.length=0,this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&l(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(e){this.autoClose=e,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(e){!e&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}getTargetWorkspace(){return this.targetWorkspace}isVisible(){return this.visible}setVisible(e){var t=e!==this.isVisible();this.visible=e,t&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(e){var t=e!==this.containerVisible;this.containerVisible=e,t&&this.updateDisplay()}getContents(){return this.contents}setContents(e){this.contents=e}updateDisplay(){var e,t=!!this.containerVisible&&this.isVisible();this.svgGroup_&&(this.svgGroup_.style.display=t?"block":"none"),null!=(e=this.workspace_.scrollbar)&&e.setContainerVisible(t)}positionAt_(e,t,i,s){var o;null!=(o=this.svgGroup_)&&o.setAttribute("width",""+e),null!=(o=this.svgGroup_)&&o.setAttribute("height",""+t),this.workspace_.setCachedParentSvgSize(e,t),this.svgGroup_&&Y(this.svgGroup_,"translate("+i+"px,"+s+"px)"),(e=this.workspace_.scrollbar)&&(e.setOrigin(i,s),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll)&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y)}hide(){this.isVisible()&&(this.setVisible(!1),this.reflowWrapper)&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null)}show(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),"string"==typeof e&&(e=this.getDynamicCategoryContents(e)),this.setVisible(!0),e=Be(e),e=this.createFlyoutInfo(e),it(this.workspace_),this.setContents(e),this.layout_(e),this.horizontalLayout?this.height_=0:this.width_=0,this.reflow(),this.workspace_.setResizesEnabled(!0),this.reflowWrapper=e=>{e.type!==f.BLOCK_CHANGE&&e.type!==f.BLOCK_FIELD_INTERMEDIATE_CHANGE||this.reflow()},this.workspace_.addChangeListener(this.reflowWrapper)}createFlyoutInfo(e){var t,i=[],s=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(t of e)"custom"in t&&(e=this.getDynamicCategoryContents(t.custom),e=Be(e),i.push(...this.createFlyoutInfo(e))),e=t.kind.toLowerCase(),(e=this.getInflaterForType(e))&&(i.push(e.load(t,this)),e=e.gapForItem(t,s))&&i.push(new mh(new vh(e,this.horizontalLayout?"x":"y"),$h));return this.normalizeSeparators(i)}normalizeSeparators(t){for(let e=t.length-1;0<e;e--){var i=t[e].getType().toLowerCase(),s=t[e-1].getType().toLowerCase();i===$h&&s===$h&&t.splice(e-1,1)}return t}getDynamicCategoryContents(e){if("function"!=typeof(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e)))throw TypeError("Couldn't find a callback function when opening a toolbox category.");return e(this.workspace_.targetWorkspace)}clearOldBlocks(){var e;this.getContents().forEach(e=>{var t;null!=(t=this.getInflaterForType(e.getType()))&&t.disposeItem(e)}),null!=(e=this.workspace_.getPotentialVariableMap())&&e.clear()}onMouseDown(e){var t=this.targetWorkspace.getGesture(e);t&&t.handleFlyoutStart(e,this)}isBlockCreatable(e){return e.isEnabled()&&!this.getTargetWorkspace().isReadOnly()}createBlock(e){let t=null;_.disable$$module$build$src$core$events$utils();var i=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{t=this.placeNewBlock(e)}finally{_.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),e=$t(this.targetWorkspace,i),U()){for(_.setGroup$$module$build$src$core$events$utils(!0),i=0;i<e.length;i++){var s=e[i];g(new(m(f.VAR_CREATE))(s))}g(new(m(f.BLOCK_CREATE))(t))}return this.autoClose&&this.hide(),t}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return!!this.workspace_.scrollbar&&this.workspace_.scrollbar.isVisible()}placeNewBlock(e){var t,i=this.targetWorkspace;if(e.getSvgRoot())return t=this.serializeBlock(e),i.setResizesEnabled(!1),i=zt(t,i),this.positionNewBlock(e,i),i;throw Error("oldBlock is not rendered")}serializeBlock(e){return Dt(e)}positionNewBlock(e,t){var i=this.targetWorkspace,s=i.getOriginOffsetInPixels(),o=this.workspace_.getOriginOffsetInPixels();(e=e.getRelativeToSurfaceXY()).scale(this.workspace_.scale),o=y.sum(o,e),(s=y.difference(o,s)).scale(1/i.scale),t.moveTo(new y(s.x,s.y))}getInflaterForType(e){var t;return this.inflaters.has(e)?null!=(t=this.inflaters.get(e))?t:null:(t=dr(b.FLYOUT_INFLATER,e))?(t=new t,this.inflaters.set(e,t),t):null}getFocusableElement(){throw Error("Flyouts are not directly focusable.")}getFocusableTree(){throw Error("Flyouts are not directly focusable.")}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!1}getRootFocusableNode(){throw Error("Flyouts are not directly focusable.")}getRestoredFocusableNode(e){throw Error("Flyouts are not directly focusable.")}getNestedTrees(){throw Error("Flyouts are not directly focusable.")}lookUpFocusableNode(e){throw Error("Flyouts are not directly focusable.")}onTreeFocus(e,t){}onTreeBlur(e){throw Error("Flyouts are not directly focusable.")}},Dh=class{constructor(){this.isActive=!1,this.activeClassName="blocklyKeyboardNavigation"}setIsActive(e=!0){this.isActive=e,this.updateActiveVisualization()}getIsActive(){return this.isActive}updateActiveVisualization(){this.isActive?document.body.classList.add(this.activeClassName):document.body.classList.remove(this.activeClassName)}},Bh=new Dh,Ph=class{constructor(e){this.workspace=e,this.horizontalScrollEnabled=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled=this.workspace.isMovableVertically(),this.startScrollXY_=new y(e.scrollX,e.scrollY)}dispose(){this.workspace=null}startDrag(){}endDrag(e){this.drag(e)}drag(e){if(e=y.sum(this.startScrollXY_,e),this.horizontalScrollEnabled&&this.verticalScrollEnabled)this.workspace.scroll(e.x,e.y);else if(this.horizontalScrollEnabled)this.workspace.scroll(e.x,this.workspace.scrollY);else{if(!this.verticalScrollEnabled)throw new TypeError("Invalid state.");this.workspace.scroll(this.workspace.scrollX,e.y)}}},Fh=class{constructor(e,t){this.creatorWorkspace=t,this.mouseDownXY=new y(0,0),this.startWorkspace_=this.targetBlock=this.startComment=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.workspaceDragger=this.dragger=null,this.dragging=!1,this.flyout=null,this.multiTouch=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=e,this.currentDragDeltaXY=new y(0,0)}dispose(){fr(),Wi(),this.creatorWorkspace.clearGesture();for(var e of this.boundEvents)n(e);this.boundEvents.length=0,this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(e){var t=new y(e.clientX,e.clientY);this.updateDragDelta(t)&&(this.updateIsDragging(e),br()),this.mostRecentEvent=e}updateDragDelta(e){return this.currentDragDeltaXY=y.difference(e,this.mouseDownXY),!this.hasExceededDragRadius&&(this.hasExceededDragRadius=y.magnitude(this.currentDragDeltaXY)>(this.flyout?_.config$$module$build$src$core$config.flyoutDragRadius:_.config$$module$build$src$core$config.dragRadius))}updateIsDraggingFromFlyout(){let e;if(!this.targetBlock||null==(e=this.flyout)||!e.isBlockCreatable(this.targetBlock))return!1;if(this.flyout.targetWorkspace)return!(this.flyout.isScrollable()&&!this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)||(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),_.getGroup$$module$build$src$core$events$utils()||_.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.targetBlock),0));throw Error("Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined")}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.dragging=!0,this.workspaceDragger=new Ph(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(e){if(!this.startWorkspace_)throw Error("Cannot update dragging because the start workspace is undefined");if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.flyout&&this.updateIsDraggingFromFlyout();var t=ae();t&&Bo(t)&&t.isMovable()?(this.dragging=!0,this.dragger=this.createDragger(t,this.startWorkspace_),this.dragger.onDragStart(e),this.dragger.onDrag(e,this.currentDragDeltaXY)):this.updateIsDraggingWorkspace()}createDragger(e,t){return new(mr(b.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(e,t)}doStart(e){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,kr(e)?this.cancel():(this.gestureHasStarted=!0,Co(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=Ic,this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=e,Vi(),Ir(e)?this.handleRightClick(e):("pointerdown"===e.type.toLowerCase()&&"mouse"!==e.pointerType&&_r(e,this),this.mouseDownXY=new y(e.clientX,e.clientY),this.bindMouseEvents(e),this.isEnding_||this.handleTouchStart(e)))}bindMouseEvents(e){this.boundEvents.push(p(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(p(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(p(document,"pointerup",null,this.handleUp.bind(this),!0)),e.preventDefault(),e.stopPropagation()}handleStart(e){this.isDragging()||(this.handleTouchStart(e),this.isMultiTouch()&&br())}handleMove(e){this.isDragging()&&Tr(e)||!this.isMultiTouch()?(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(e),br())}handleUp(e){if(this.isDragging()||this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()){if(!Tr(e))return;if(this.updateFromEvent(e),br(),this.isEnding_)return void console.log("Trying to end a gesture recursively.");this.isEnding_=!0,this.dragger?(Bh.setIsActive(!1),this.dragger.onDragEnd(e,this.currentDragDeltaXY)):this.workspaceDragger?(Bh.setIsActive(!1),this.workspaceDragger.endDrag(this.currentDragDeltaXY)):this.isBubbleClick()||this.isCommentClick()||(this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(e))}e.preventDefault(),e.stopPropagation(),this.dispose()}handleTouchStart(e){var t=Er(e),i=(this.cachedPoints.set(t,this.getTouchPoint(e)),Array.from(this.cachedPoints.keys()));2===i.length&&(t=this.cachedPoints.get(i[0]),i=this.cachedPoints.get(i[1]),this.startDistance=y.distance(t,i),this.multiTouch=!0,e.preventDefault())}handleTouchMove(e){var t=Er(e);this.cachedPoints.set(t,this.getTouchPoint(e)),this.isPinchZoomEnabled&&2===this.cachedPoints.size?this.handlePinch(e):(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation())}handlePinch(e){var t=Array.from(this.cachedPoints.keys()),i=this.cachedPoints.get(t[0]),t=this.cachedPoints.get(t[1]),i=y.distance(i,t)/this.startDistance;if(0<this.previousScale&&this.previousScale<1/0){if(t=0<(t=i-this.previousScale)?5*t:6*t,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");var s=this.startWorkspace_,o=Cr(e,s.getParentSvg(),s.getInverseScreenCTM());s.zoom(o.x,o.y,t)}this.previousScale=i,e.preventDefault()}handleTouchEnd(e){e=Er(e),this.cachedPoints.has(e)&&this.cachedPoints.delete(e),this.cachedPoints.size<2&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(e){return this.startWorkspace_?new y(e.pageX,e.pageY):null}isMultiTouch(){return this.multiTouch}cancel(){this.isEnding_||(br(),this.dragger?this.dragger.onDragEnd(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(e){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(e)):this.startBubble?this.startBubble.showContextMenu(e):this.startComment?(this.startComment.workspace.hideChaff(),this.startComment.showContextMenu(e)):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.startWorkspace_),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),Bh.setIsActive(!1),this.dispose()}handleWsStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(t),this.mostRecentEvent=e,this.startBlock||this.startBubble||this.startComment?this.startBlock&&_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.startBlock):_.getFocusManager$$module$build$src$core$focus_manager().focusNode(t),this.doStart(e)}fireWorkspaceClick(e){g(new(m(f.CLICK))(null,e.id,"workspace"))}handleFlyoutStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(t),this.handleWsStart(e,t.getWorkspace())}handleBlockStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(t),this.mostRecentEvent=e}handleBubbleStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(t),this.mostRecentEvent=e}handleCommentStart(e,t){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleCommentStart, but the gesture had already been started.");this.setStartComment(t),this.mostRecentEvent=e}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.bringBlockToFront(),this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent)}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");var e;this.flyout.isBlockCreatable(this.targetBlock)&&(_.getGroup$$module$build$src$core$events$utils()||_.setGroup$$module$build$src$core$events$utils(!0),(e=this.flyout.createBlock(this.targetBlock)).snapToGrid(),e.bumpNeighbours(),_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e))}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");e=new(m(f.CLICK))(this.startBlock,this.startWorkspace_.id,"block"),g(e)}this.bringBlockToFront(),_.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(e){this.fireWorkspaceClick(this.startWorkspace_||this.creatorWorkspace)}bringBlockToFront(){this.targetBlock&&!this.flyout&&(_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.targetBlock),this.targetBlock.bringToFront())}setStartField(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=e)}setStartIcon(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=e)}setStartBubble(e){this.startBubble||(this.startBubble=e)}setStartComment(e){this.startComment||(this.startComment=e)}setStartBlock(e){this.startBlock||this.startBubble||((this.startBlock=e).isInFlyout&&e!==e.getRootBlock()?this.setTargetBlock(e.getRootBlock()):this.setTargetBlock(e))}setTargetBlock(e){e.isShadow()?this.setTargetBlock(e.getParent()):(this.targetBlock=e,_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e))}setStartWorkspace(e){this.startWorkspace_||(this.startWorkspace_=e)}setStartFlyout(e){this.flyout||(this.flyout=e)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isCommentClick(){return!!this.startComment&&!this.hasExceededDragRadius}isBlockClick(){return!(!this.startBlock||this.hasExceededDragRadius||this.isFieldClick()||this.isIconClick())}isFieldClick(){return!!this.startField&&this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose))}isIconClick(){var e;return!!this.startIcon&&(e=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose),!this.hasExceededDragRadius)&&e}isWorkspaceClick(){return!(this.startBlock||this.startBubble||this.startField||this.hasExceededDragRadius)}getCurrentDragger(){var e;return null!=(e=null!=(e=this.workspaceDragger)?e:this.dragger)?e:null}isDragging(){return this.dragging}hasStarted(){return this.gestureHasStarted}static inProgress(){var i=se();for(let e=0,t;t=i[e];e++)if(t.currentGesture_)return!0;return!1}},Uh=class{constructor(e,t){var i;this.pattern=e,this.scale=1,this.spacing=null!=(i=t.spacing)?i:0,this.length=null!=(i=t.length)?i:1,this.line2=(this.line1=e.firstChild)&&this.line1.nextSibling,this.snapToGrid=null!=(i=t.snap)&&i}setSpacing(e){this.spacing=e,this.update(this.scale)}getSpacing(){return this.spacing}setLength(e){this.length=e,this.update(this.scale)}getLength(){return this.length}setSnapToGrid(e){this.snapToGrid=e}shouldSnap(){return this.snapToGrid}getPatternId(){return this.pattern.id}update(e){this.scale=e;var t=this.spacing*e,i=(this.pattern.setAttribute("width",""+t),this.pattern.setAttribute("height",""+t),(t=Math.floor(this.spacing/2)+.5)-this.length/2),s=t+this.length/2;this.setLineAttributes(this.line1,e,i*=e,s*=e,t*=e,t),this.setLineAttributes(this.line2,e,t,t,i,s)}setLineAttributes(e,t,i,s,o,n){e&&(e.setAttribute("stroke-width",""+t),e.setAttribute("x1",""+i),e.setAttribute("y1",""+o),e.setAttribute("x2",""+s),e.setAttribute("y2",""+n))}moveTo(e,t){this.pattern.setAttribute("x",""+e),this.pattern.setAttribute("y",""+t)}alignXY(e){var t=(s=this.getSpacing())/2,i=Math.round(Math.round((e.x-t)/s)*s+t),s=Math.round(Math.round((e.y-t)/s)*s+t);return i===e.x&&s===e.y?e:new y(i,s)}static createDom(e,t,i,s){return e=a(k.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},i),0<(null!=(i=t.length)?i:1)&&0<(null!=(i=t.spacing)?i:0)?(a(k.LINE,{stroke:t.colour},e),null!=(i=t.length)&&i&&a(k.LINE,{stroke:t.colour},e)):a(k.LINE,{},e),s&&s.style.setProperty("--blocklyGridPattern",`url(#${e.id})`),e}},Hh=class{constructor(e){this.workspace=e,this.layers=new Map,(e=e.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(e),this.animationLayer=this.createAnimationLayer(e)),e=this.createLayer(50),c(e,"blocklyBlockCanvas"),e=this.createLayer(100),c(e,"blocklyBubbleCanvas")}createDragLayer(e){var t=a(k.SVG,{class:"blocklyBlockDragSurface",xmlns:Rl,"xmlns:html":Ol,"xmlns:xlink":Nl,version:"1.1"});return e.append(t),a(k.G,{},t)}createAnimationLayer(e){var t=a(k.SVG,{class:"blocklyAnimationLayer",xmlns:Rl,"xmlns:html":Ol,"xmlns:xlink":Nl,version:"1.1"});return e.append(t),a(k.G,{},t)}appendToAnimationLayer(e){var t,i=null==(i=this.dragLayer)?void 0:i.getAttribute("transform");i&&null!=(t=this.animationLayer)&&t.setAttribute("transform",i),null!=(t=this.animationLayer)&&t.appendChild(e.getSvgRoot())}translateLayers(e,t){var i;e=`translate(${e.x}, ${e.y}) scale(${t})`,null!=(t=this.dragLayer)&&t.setAttribute("transform",e);for([,i]of this.layers)i.setAttribute("transform",e)}moveToDragLayer(e){var t;null!=(t=this.dragLayer)&&t.appendChild(e.getSvgRoot()),e.canBeFocused()&&_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e)}moveOffDragLayer(e,t){this.append(e,t),e.canBeFocused()&&_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e)}append(e,t){var i;this.layers.has(t)||this.createLayer(t),e=e.getSvgRoot(),(null==(i=this.layers.get(t))?void 0:i.lastChild)!==e&&null!=(i=this.layers.get(t))&&i.appendChild(e)}createLayer(e){var t,i,s=this.workspace.getSvgGroup(),o=a(k.G,{});let n=!1;for([t,i]of[...this.layers].sort((e,t)=>e[0]-t[0]))if(e<t){s.insertBefore(o,i),n=!0;break}return n||s.appendChild(o),this.layers.set(e,o),o}hasLayer(e){return e===this.dragLayer||new Set(this.layers.values()).has(e)}getBlockLayer(){return this.layers.get(50)}getBubbleLayer(){return this.layers.get(100)}},Gh=class{constructor(){this.curNode=this.colour=null,this.type="marker"}getCurNode(){return this.curNode}setCurNode(e){this.curNode=e}dispose(){this.curNode=null}getSourceBlockFromNode(e){return e instanceof N?e:e instanceof A||e instanceof Qu?e.getSourceBlock():null}getSourceBlock(){return this.getSourceBlockFromNode(this.getCurNode())}},Vh=class extends Gh{constructor(e){super(),this.workspace=e,this.type="cursor",this.potentialNodes=null}next(){var e=this.getCurNode();return e?((e=this.getNextNode(e,e=>{var t;return e instanceof N&&!(null!=(t=e.outputConnection)&&t.targetBlock())||e instanceof ku},!0))&&this.setCurNode(e),e):null}in(){var e=this.getCurNode();return e?((e=this.getNextNode(e,()=>!0,!0))&&this.setCurNode(e),e):null}prev(){var e=this.getCurNode();return e?((e=this.getPreviousNode(e,e=>{var t;return e instanceof N&&!(null!=(t=e.outputConnection)&&t.targetBlock())||e instanceof ku},!0))&&this.setCurNode(e),e):null}out(){var e=this.getCurNode();return e?((e=this.getPreviousNode(e,()=>!0,!0))&&this.setCurNode(e),e):null}atEndOfLine(){var e=this.getCurNode();return!!e&&this.getNextNode(e,()=>!0,!0)===this.getNextNode(e,e=>e instanceof N&&!(null!=(e=e.outputConnection)&&e.targetBlock()),!0)}getNextNodeImpl(e,t,i=new Set){if(!e||i.has(e))return null;let s=this.workspace.getNavigator().getFirstChild(e)||this.workspace.getNavigator().getNextSibling(e);for(var o=e;o&&!s&&(o=this.workspace.getNavigator().getParent(o));)s=this.workspace.getNavigator().getNextSibling(o);return t(s)?s:s?(i.add(e),this.getNextNodeImpl(s,t,i)):null}getNextNode(e,t,i){return!e||!i&&this.getLastNode()===e?null:this.getNextNodeImpl(e,t)}getPreviousNodeImpl(e,t,i=new Set){var s;return!e||i.has(e)?null:t(s=this.getRightMostChild(this.workspace.getNavigator().getPreviousSibling(e),e)||this.workspace.getNavigator().getParent(e))?s:s?(i.add(e),this.getPreviousNodeImpl(s,t,i)):null}getPreviousNode(e,t,i){return!e||!i&&this.getFirstNode()===e?null:this.getPreviousNodeImpl(e,t)}getRightMostChild(e,t){if(!e)return e;let i=this.workspace.getNavigator().getFirstChild(e);if(!i||i===t)return e;for(e=i;e&&e!==t;e=this.workspace.getNavigator().getNextSibling(i))i=e;return this.getRightMostChild(i,t)}preDelete(e){var t,i=(i=this.getCurNode())?[i]:[],s=null!=(s=null==(t=e.previousConnection)?void 0:t.targetConnection)?s:null==(s=e.outputConnection)?void 0:s.targetConnection;s&&i.push(s),(t=e.getNextBlock())&&i.push(t),(e=e.getParent())&&i.push(e),i.push(this.workspace),this.potentialNodes=i}postDelete(){var e,t,i=this.potentialNodes;if(this.potentialNodes=null,!i)throw Error("must call preDelete first");for(e of i)if(null==(t=this.getSourceBlockFromNode(e))||!t.disposed)return void this.setCurNode(e);throw Error("no valid nodes in this.potentialNodes")}getCurNode(){return _.getFocusManager$$module$build$src$core$focus_manager().getFocusedNode()}setCurNode(e){_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e),e instanceof N?e.workspace.scrollBoundsIntoView(e.getBoundingRectangleWithoutChildren()):e instanceof A?(e=e.getSourceBlock()).workspace.scrollBoundsIntoView(e.getBoundingRectangleWithoutChildren()):e instanceof ku&&e.workspace.scrollBoundsIntoView(e.getBoundingRectangle())}getFirstNode(){return this.workspace.getNavigator().getFirstChild(this.workspace)}getLastNode(){var e=this.getFirstNode();return this.getPreviousNode(e,()=>!0,!0)}},Wh=(o(b.CURSOR,Ur,Vh),class{constructor(e){this.workspace=e,this.markers=new Map,this.cursor=new Vh(this.workspace)}registerMarker(e,t){this.markers.has(e)&&this.unregisterMarker(e),this.markers.set(e,t)}unregisterMarker(e){var t=this.markers.get(e);if(!t)throw Error("Marker with ID "+e+" does not exist. Can only unregister markers that exist.");t.dispose(),this.markers.delete(e)}getCursor(){return this.cursor}getMarker(e){return this.markers.get(e)||null}setCursor(e){this.cursor=e}dispose(){var i=Object.keys(this.markers);for(let e=0,t;t=i[e];e++)this.unregisterMarker(t);this.markers.clear(),this.cursor.dispose()}}),zh=(Wh.LOCAL_MARKER="local_marker_1",class extends R{constructor(e,t,i){super(e,t,i,zh.createTextArea()),this.workspace=e,this.anchor=t,this.ownerRect=i,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.locationChangeListeners=[],this.text="",this.DEFAULT_SIZE=new C(160+R.DOUBLE_BORDER,80+R.DOUBLE_BORDER),this.MIN_SIZE=new C(45+R.DOUBLE_BORDER,20+R.DOUBLE_BORDER),this.editable=!0,c(this.svgRoot,"blocklyTextInputBubble"),this.textArea=this.getFocusableElement(),this.inputRoot=this.createEditor(this.contentContainer,this.textArea),this.resizeGroup=this.createResizeHandle(this.svgRoot,e),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}setEditable(e){(this.editable=e)?this.textArea.removeAttribute("readonly"):this.textArea.setAttribute("readonly","")}isEditable(){return this.editable}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}addLocationChangeListener(e){this.locationChangeListeners.push(e)}static createTextArea(){var e=document.createElementNS(Ol,"textarea");return e.className="blocklyTextarea blocklyText",e}createEditor(e,t){e=a(k.FOREIGNOBJECT,{x:R.BORDER_WIDTH,y:R.BORDER_WIDTH},e);var i=document.createElementNS(Ol,"body");return i.setAttribute("xmlns",Ol),i.className="blocklyMinimalBody",t.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),i.appendChild(t),e.appendChild(i),this.bindTextAreaEvents(t),e}bindTextAreaEvents(e){p(e,"wheel",this,e=>{e.stopPropagation()}),p(e,"pointerdown",this,e=>{e.stopPropagation(),fr()}),p(e,"change",this,this.onTextChange)}createResizeHandle(e,t){return e=a(k.IMAGE,{class:"blocklyResizeHandle",href:t.options.pathToMedia+"resize-handle.svg"},e),p(e,"pointerdown",this,this.onResizePointerDown),e}setSize(e,t=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height);var i=e.width-R.DOUBLE_BORDER,s=e.height-R.DOUBLE_BORDER;this.inputRoot.setAttribute("width",""+i),this.inputRoot.setAttribute("height",""+s),this.resizeGroup.setAttribute("y",""+s),this.workspace.RTL?this.resizeGroup.setAttribute("x",""+-R.DOUBLE_BORDER):this.resizeGroup.setAttribute("x",""+i),super.setSize(e,t),this.onSizeChange()}getSize(){return super.getSize()}moveDuringDrag(e){super.moveDuringDrag(e),this.onLocationChange()}setPositionRelativeToAnchor(e,t){super.setPositionRelativeToAnchor(e,t),this.onLocationChange()}positionByRect(e=new I(0,0,0,0)){super.positionByRect(e),this.onLocationChange()}onResizePointerDown(e){this.bringToFront(),Ir(e)||(Ss(this.workspace,e,new y(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=p(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=p(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){fr(),this.resizePointerUpListener&&(n(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(n(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=ws(this.workspace,e),this.setSize(new C(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onTextChange(){this.text=this.textArea.value;for(var e of this.textChangeListeners)e()}onSizeChange(){for(var e of this.sizeChangeListeners)e()}onLocationChange(){for(var e of this.locationChangeListeners)e()}}),Vu=(be("\n.blocklyTextInputBubble .blocklyTextarea {\n  background-color: var(--commentFillColour);\n  border: 0;\n  box-sizing: border-box;\n  display: block;\n  outline: 0;\n  padding: 5px;\n  resize: none;\n  width: 100%;\n  height: 100%;\n}\n"),{}),jh=(Vu.register=pp,Vu.unregister=dp,class extends Hu{constructor(e){super(e),this.sourceBlock=e,this.textInputBubble=null,this.text="",this.bubbleSize=new C(160,80),this.bubbleVisiblity=!1}getType(){return jh.TYPE}initView(e){this.svgRoot||(super.initView(e),a(k.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),a(k.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),a(k.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),c(this.svgRoot,"blocklyCommentIcon"))}dispose(){var e;super.dispose(),null!=(e=this.textInputBubble)&&e.dispose()}getWeight(){return jh.WEIGHT}getSize(){return new C(17,17)}applyColour(){super.applyColour();var e,t=this.sourceBlock.getColour();null!=(e=this.textInputBubble)&&e.setColour(t)}updateEditable(){let e=this,t=()=>super.updateEditable;return(0,d.asyncExecutePromiseGeneratorFunction)(function*(){t().call(e),e.bubbleIsVisible()&&(yield e.setBubbleVisible(!1),yield e.setBubbleVisible(!0))})}onLocationChange(e){var t=this.workspaceLocation;super.onLocationChange(e),this.bubbleLocation&&(e=y.difference(this.workspaceLocation,t),this.bubbleLocation=y.sum(this.bubbleLocation,e)),e=this.getAnchorLocation(),null!=(t=this.textInputBubble)&&t.setAnchorLocation(e)}setText(e){var t=this.text;g(new(m(f.BLOCK_CHANGE))(this.sourceBlock,"comment",null,t,e)),this.text=e,null!=(t=this.textInputBubble)&&t.setText(this.text)}getText(){return this.text}setBubbleSize(e){this.bubbleSize=e,null!=(e=this.textInputBubble)&&e.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}setBubbleLocation(e){var t;this.bubbleLocation=e,null!=(t=this.textInputBubble)&&t.moveDuringDrag(e)}getBubbleLocation(){return this.bubbleLocation}saveState(){var e,t;return this.text?(e={text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width},(t=this.getBubbleLocation())&&(e.x=this.sourceBlock.workspace.RTL?this.sourceBlock.workspace.getWidth()-(t.x+this.bubbleSize.width):t.x,e.y=t.y),e):null}loadState(e){var t;this.text=null!=(t=e.text)?t:"",this.bubbleSize=new C(null!=(t=e.width)?t:160,null!=(t=e.height)?t:80),this.bubbleVisiblity=null!=(t=e.pinned)&&t,this.setBubbleVisible(this.bubbleVisiblity);let i=e.x,s=e.y;tt().then(()=>{i&&s&&(i=this.sourceBlock.workspace.RTL?this.sourceBlock.workspace.getWidth()-(i+this.bubbleSize.width):i,this.setBubbleLocation(new y(i,s)))})}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){var e;this.textInputBubble&&(e=this.textInputBubble.getText(),this.text!==e)&&(g(new(m(f.BLOCK_CHANGE))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}onBubbleLocationChange(){this.textInputBubble&&(this.bubbleLocation=this.textInputBubble.getRelativeToSurfaceXY())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(e){let t=this;return(0,d.asyncExecutePromiseGeneratorFunction)(function*(){t.bubbleVisiblity!==e&&(t.bubbleVisiblity=e,yield tt(),!t.sourceBlock.rendered||t.sourceBlock.isInFlyout||t.sourceBlock.isInsertionMarker()||(e?(t.sourceBlock.isEditable()?t.showEditableBubble():t.showNonEditableBubble(),t.applyColour()):t.hideBubble(),g(new(m(f.BUBBLE_OPEN))(t.sourceBlock,e,"comment"))))})}getBubble(){return this.textInputBubble}showEditableBubble(){var e;this.createBubble(),null!=(e=this.textInputBubble)&&e.addTextChangeListener(()=>this.onTextChange()),null!=(e=this.textInputBubble)&&e.addSizeChangeListener(()=>this.onSizeChange())}showNonEditableBubble(){var e;this.createBubble(),null!=(e=this.textInputBubble)&&e.setEditable(!1)}createBubble(){this.textInputBubble=new zh(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0),this.bubbleLocation&&this.textInputBubble.moveDuringDrag(this.bubbleLocation),this.textInputBubble.addTextChangeListener(()=>this.onTextChange()),this.textInputBubble.addSizeChangeListener(()=>this.onSizeChange()),this.textInputBubble.addLocationChangeListener(()=>this.onBubbleLocationChange())}hideBubble(){var e;null!=(e=this.textInputBubble)&&e.dispose(),this.textInputBubble=null}getAnchorLocation(){return y.sum(this.workspaceLocation,new y(8.5,8.5))}getBubbleOwnerRect(){return this.sourceBlock.getBoundingRectangleWithoutChildren()}}),Yh=(jh.TYPE=uc.COMMENT,jh.WEIGHT=3,pp(jh.TYPE,jh),{});Yh.CommentIcon=jh,Yh.Icon=Hu,Yh.IconType=uc,Yh.MutatorIcon=_.MutatorIcon$$module$build$src$core$icons$mutator_icon,Yh.WarningIcon=dh,Yh.exceptions=Xu,Yh.registry=Vu;_.Names$$module$build$src$core$names=class{constructor(e,t){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=t||"",this.reservedWords=new Set(e?e.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(e){this.variableMap=e}getNameForUserVariable(e){return this.variableMap?(e=this.variableMap.getVariableById(e))?e.getName():null:(console.warn("Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:\nBlockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());"),null)}populateVariables(t){t=_.allUsedVarModels$$module$build$src$core$variables(t);for(let e=0;e<t.length;e++)this.getName(t[e].getId(),_.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(e){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(e,t){let i=e;e=(i=t===_.NameType$$module$build$src$core$names.VARIABLE&&(e=this.getNameForUserVariable(e))?e:i).toLowerCase();var s=t===_.NameType$$module$build$src$core$names.VARIABLE||t===_.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"",o=(this.db.has(t)||this.db.set(t,new Map),this.db.get(t));return o.has(e)?s+o.get(e):(t=this.getDistinctName(i,t),o.set(e,t.substr(s.length)),t)}getUserNames(e){var t;return(e=null==(t=this.db.get(e))?void 0:t.keys())?Array.from(e):[]}getDistinctName(e,t){e=this.safeName(e);let i=null,s,o;for(;this.dbReverse.has(e+(null!=(s=i)?s:""))||this.reservedWords.has(e+(null!=(o=i)?o:""));)i=i?i+1:2;var n;return e+=null!=(n=i)?n:"",this.dbReverse.add(e),(t===_.NameType$$module$build$src$core$names.VARIABLE||t===_.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+e}safeName(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),"0123456789".includes(e[0])&&(e="my_"+e)):e=_.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",e}static equals(e,t){return e.toLowerCase()===t.toLowerCase()}},(M=(M=_.Names$$module$build$src$core$names||(_.Names$$module$build$src$core$names={})).NameType||(M.NameType={})).DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",M.VARIABLE="VARIABLE",M.PROCEDURE="PROCEDURE",_.NameType$$module$build$src$core$names=_.Names$$module$build$src$core$names.NameType,_.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=_.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE;({NameType:_.NameType$$module$build$src$core$names}).Names=_.Names$$module$build$src$core$names;var Xh,Kh,Jh,qh,Zh=class extends Map{constructor(){super()}set(e,t){return this.get(e)!==t&&(super.set(e,t),Uo(t))&&t.startPublishing(),this}delete(e){var t=this.get(e);return(e=super.delete(e))&&Uo(t)&&t.stopPublishing(),e}clear(){if(this.size)for(var e of this.keys())this.delete(e)}add(e){return this.set(e.getId(),e)}getProcedures(){return[...this.values()]}},Qh="PROCEDURE",$=(_.DEFAULT_ARG$$module$build$src$core$procedures="x",(Xh={CATEGORY_NAME:Qh,DEFAULT_ARG:_.DEFAULT_ARG$$module$build$src$core$procedures}).ObservableProcedureMap=Zh,Xh.allProcedures=Ho,Xh.findLegalName=_.findLegalName$$module$build$src$core$procedures,Xh.flyoutCategory=Yo,Xh.getCallers=qo,Xh.getDefinition=_.getDefinition$$module$build$src$core$procedures,Xh.internalFlyoutCategory=jo,Xh.isNameUsed=Wo,Xh.isProcedureBlock=Fo,Xh.mutateCallers=_.mutateCallers$$module$build$src$core$procedures,Xh.mutatorOpenListener=Ko,Xh.rename=_.rename$$module$build$src$core$procedures,new class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(e){return Object.prototype.hasOwnProperty.call(this,e)||(this[e]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[e]}isField(e){return 1<=(e.type&this.FIELD)}isHat(e){return 1<=(e.type&this.HAT)}isIcon(e){return 1<=(e.type&this.ICON)}isSpacer(e){return 1<=(e.type&this.SPACER)}isInRowSpacer(e){return 1<=(e.type&this.IN_ROW_SPACER)}isSpacerRow(e){return 1<=(e.type&this.BETWEEN_ROW_SPACER)}isInput(e){return 1<=(e.type&this.INPUT)}isExternalInput(e){return 1<=(e.type&this.EXTERNAL_VALUE_INPUT)}isInlineInput(e){return 1<=(e.type&this.INLINE_INPUT)}isStatementInput(e){return 1<=(e.type&this.STATEMENT_INPUT)}isPreviousConnection(e){return 1<=(e.type&this.PREVIOUS_CONNECTION)}isNextConnection(e){return 1<=(e.type&this.NEXT_CONNECTION)}isPreviousOrNextConnection(e){return this.isPreviousConnection(e)||this.isNextConnection(e)}isRoundCorner(e){return 1<=(e.type&this.LEFT_ROUND_CORNER)||1<=(e.type&this.RIGHT_ROUND_CORNER)}isLeftRoundedCorner(e){return this.isRoundCorner(e)&&1<=(e.type&this.LEFT_ROUND_CORNER)}isRightRoundedCorner(e){return this.isRoundCorner(e)&&1<=(e.type&this.RIGHT_ROUND_CORNER)}isLeftSquareCorner(e){return 1<=(e.type&this.LEFT_SQUARE_CORNER)}isRightSquareCorner(e){return 1<=(e.type&this.RIGHT_SQUARE_CORNER)}isCorner(e){return 1<=(e.type&this.CORNER)}isJaggedEdge(e){return 1<=(e.type&this.JAGGED_EDGE)}isRow(e){return 1<=(e.type&this.ROW)}isBetweenRowSpacer(e){return 1<=(e.type&this.BETWEEN_ROW_SPACER)}isTopRow(e){return 1<=(e.type&this.TOP_ROW)}isBottomRow(e){return 1<=(e.type&this.BOTTOM_ROW)}isTopOrBottomRow(e){return this.isTopRow(e)||this.isBottomRow(e)}isInputRow(e){return 1<=(e.type&this.INPUT_ROW)}}),L=class{constructor(e){this.centerline=this.xPos=this.height=this.width=0,this.constants_=e,this.type=$.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},S=class{constructor(e){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=e,this.type=$.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let e=this.elements.length-1;0<=e;e--){var t=this.elements[e];if($.isInput(t))return t}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let e=0;e<this.elements.length;e++){var t=this.elements[e];if($.isInRowSpacer(t))return t}return null}getLastSpacer(){for(let e=this.elements.length-1;0<=e;e--){var t=this.elements[e];if($.isInRowSpacer(t))return t}return null}},ed=class extends S{constructor(e){super(e),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=$.BOTTOM_ROW}hasLeftSquareCorner(e){return!!e.outputConnection||!!e.getNextBlock()}hasRightSquareCorner(e){return!0}measure(){let t=0,i=0,s=0;for(let e=0;e<this.elements.length;e++){var o=this.elements[e];i+=o.width,$.isSpacer(o)||($.isNextConnection(o)?s=Math.max(s,o.height):t=Math.max(t,o.height))}this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,t)+s,this.descenderHeight=s,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},td=class extends L{constructor(e,t){super(e),this.connectionModel=t,this.type|=$.CONNECTION,this.shape=this.constants_.shapeFor(t),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=t.isHighlighted()}},Yl=class extends td{constructor(e,t){super(e,t.connection),this.input=t,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=$.INPUT,this.align=t.align,(this.connectedBlock=t.connection&&t.connection.targetBlock()?t.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},id=class extends Yl{constructor(e,t){super(e,t),this.height=0,this.type|=$.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},sd=class extends L{constructor(e,t,i){super(e),this.field=t,this.parentInput=i,this.isEditable=t.EDITABLE,this.flipRtl=t.getFlipRtl(),this.type|=$.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width}},od=class extends L{constructor(e){super(e),this.type|=$.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},nd=class extends L{constructor(e,t){super(e),this.icon=t,this.flipRtl=!1,this.type|=$.ICON,e=t.getSize(),this.height=e.height,this.width=e.width}},rd=class extends L{constructor(e,t){super(e),this.type|=$.SPACER|$.IN_ROW_SPACER,this.width=t,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},ld=class extends Yl{constructor(e,t){super(e,t),this.type|=$.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},ad=class extends S{constructor(e){super(e),this.connectedBlockWidths=0,this.type|=$.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let t=0;for(let e=0;e<this.elements.length;e++){var i=this.elements[e];this.width+=i.width,$.isInput(i)&&($.isStatementInput(i)?t+=i.connectedBlockWidth:$.isExternalInput(i)&&0!==i.connectedBlockWidth&&(t+=i.connectedBlockWidth-i.connectionWidth)),$.isSpacer(i)||(this.height=Math.max(this.height,i.height))}this.connectedBlockWidths=t,this.widthWithConnectedBlocks=this.width+t}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},cd=class extends L{constructor(e){super(e),this.type|=$.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},ud=class extends td{constructor(e,t){super(e,t),this.type|=$.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},hd=class extends td{constructor(e,t){super(e,t),this.connectionOffsetX=0,this.type|=$.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},dd=class extends td{constructor(e,t){super(e,t),this.type|=$.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},pd=class extends L{constructor(e,t){super(e),this.type=(t&&"left"!==t?$.RIGHT_ROUND_CORNER:$.LEFT_ROUND_CORNER)|$.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},gd=class extends S{constructor(e,t,i){super(e),this.height=t,this.width=i,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type|=$.SPACER|$.BETWEEN_ROW_SPACER,this.elements=[new rd(this.constants_,i)]}measure(){}},md=class extends L{constructor(e,t){super(e),this.type=(t&&"left"!==t?$.RIGHT_SQUARE_CORNER:$.LEFT_SQUARE_CORNER)|$.CORNER,this.width=this.height=this.constants_.NO_PADDING}},_d=class extends Yl{constructor(e,t){super(e,t),this.type|=$.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},bd=class extends S{constructor(e){super(e),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=$.TOP_ROW}hasLeftSquareCorner(e){var t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,i=e.getPreviousBlock();return!!e.outputConnection||t||!!i&&i.getNextBlock()===e}hasRightSquareCorner(e){return!0}measure(){let t=0,i=0,s=0;for(let e=0;e<this.elements.length;e++){var o=this.elements[e];i+=o.width,$.isSpacer(o)||($.isHat(o)?s=Math.max(s,o.ascenderHeight):t=Math.max(t,o.height))}this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,t)+s,this.capline=this.ascenderHeight=s,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},fd=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=uo(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(e){this.blockStyles=Object.create(null);var t,i=e.blockStyles;for(t in i)this.blockStyles[t]=this.validatedBlockStyle_(i[t]);this.setDynamicProperties_(e)}setDynamicProperties_(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=void 0!==e.startHats?e.startHats:this.ADD_START_HATS}setFontConstants_(e){e.fontStyle&&e.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=e.fontStyle.family),e.fontStyle&&e.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=e.fontStyle.weight),e.fontStyle&&e.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=e.fontStyle.size),e=Z("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline}setComponentConstants_(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(e){var t="auto_"+e;return this.blockStyles[t]||(this.blockStyles[t]=this.createBlockStyle_(e)),{style:this.blockStyles[t],name:t}}getBlockStyle(e){return this.blockStyles[e||""]||(e&&e.startsWith("auto_")?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(e){return this.validatedBlockStyle_({colourPrimary:e})}validatedBlockStyle_(e){var t={};return e&&Object.assign(t,e),e=os(t.colourPrimary||"#000"),t.colourPrimary=e.hex,t.colourSecondary=t.colourSecondary?os(t.colourSecondary).hex:this.generateSecondaryColour_(t.colourPrimary),t.colourTertiary=t.colourTertiary?os(t.colourTertiary).hex:this.generateTertiaryColour_(t.colourPrimary),t.hat=t.hat||"",t}generateSecondaryColour_(e){return Qi("#fff",e,.6)||e}generateTertiaryColour_(e){return Qi("#fff",e,.3)||e}dispose(){this.embossFilter&&l(this.embossFilter),this.disabledPattern&&l(this.disabledPattern),this.debugFilter&&l(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){var e=this.JAGGED_TEETH_HEIGHT,t=this.JAGGED_TEETH_WIDTH;return{height:e,width:t,path:po([u(t,e/4),u(2*-t,e/2),u(t,e/4)])}}makeStartHat(){var e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:.75*e,width:t,path:ao("c",[u(30,-e),u(70,-e),u(t,0)])}}makePuzzleTab(){function e(e){var t=-(e=e?-1:1),i=2.5+(n=l/2),s=.5+n,o=u(-r,e*n),n=u(r,e*n);return ao("c",[u(0,e*i),u(-r,t*s),o])+ao("s",[u(r,2.5*t),n])}let r=this.TAB_WIDTH,l=this.TAB_HEIGHT,t=e(!0),i=e(!1);return{type:this.SHAPES.PUZZLE,width:r,height:l,pathDown:i,pathUp:t}}makeNotch(){function e(e){return po([u(e*s,i),u(3*e,0),u(e*s,-i)])}let t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,s=(t-3)/2,o=e(1),n=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:o,pathRight:n}}makeInsideCorners(){var e=this.CORNER_RADIUS;return{width:e,height:e,pathTop:go("a","0 0,0",e,u(-e,e)),pathBottom:go("a","0 0,0",e,u(e,e))}}makeOutsideCorners(){var e=this.CORNER_RADIUS,t=uo(0,e)+go("a","0 0,1",e,u(e,-e)),i=go("a","0 0,1",e,u(e,e)),s=go("a","0 0,1",e,u(-e,-e));return{topLeft:t,topRight:i,bottomRight:go("a","0 0,1",e,u(-e,e)),bottomLeft:s,rightHeight:e}}shapeFor(e){switch(e.type){case E.INPUT_VALUE:case E.OUTPUT_VALUE:return this.PUZZLE_TAB;case E.PREVIOUS_STATEMENT:case E.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(e,t,i,s){this.injectCSS_(t,i),this.defs=a(k.DEFS,{},e),e=a(k.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),a(k.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),t=a(k.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),a(k.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},t),a(k.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),a(k.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter=e,e=a(k.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),a(k.RECT,{width:10,height:10,fill:"#aaa"},e),a(k.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern=e,this.createDebugFilter(),s&&(s.style.setProperty("--blocklyEmbossFilter",`url(#${this.embossFilterId})`),s.style.setProperty("--blocklyDisabledPattern",`url(#${this.disabledPatternId})`),s.style.setProperty("--blocklyDebugFilter",`url(#${this.debugFilterId})`))}createDebugFilter(){var e,t;this.debugFilter||(e=a(k.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),t=a(k.FECOMPONENTTRANSFER,{result:"outBlur"},e),a(k.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),a(k.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),a(k.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter=e)}injectCSS_(e,t){t=this.getCSS_(t),e="blockly-renderer-style-"+e,this.cssNode=document.getElementById(e);var i=t.join("\n");this.cssNode?this.cssNode.firstChild.textContent=i:((t=document.createElement("style")).id=e,e=document.createTextNode(i),t.appendChild(e),document.head.insertBefore(t,document.head.firstChild),this.cssNode=t)}getCSS_(e){return[e+" .blocklyText, ",e+" .blocklyFlyoutLabelText {",`font: ${this.FIELD_TEXT_FONTWEIGHT} `+`${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",e+" .blocklyText {","fill: #fff;","}",e+" .blocklyNonEditableField>rect,",e+" .blocklyEditableField>rect {",`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",e+" .blocklyNonEditableField>text,",e+" .blocklyEditableField>text {","fill: #000;","}",e+" .blocklyFlyoutLabelText {","fill: #000;","}",e+" .blocklyText.blocklyBubbleText {","fill: #000;","}",e+" .blocklyEditableField:not(.blocklyEditing):hover>rect {","stroke: #fff;","stroke-width: 2;","}",e+" .blocklyHtmlInput {",`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",e+" .blocklySelected>.blocklyPath {","stroke: #fc3;","stroke-width: 3px;","}",e+" .blocklyHighlightedConnectionPath {","stroke: #fc3;","}",e+" .blocklyReplaceable .blocklyPath {","fill-opacity: .5;","}",e+" .blocklyReplaceable .blocklyPathLight,",e+" .blocklyReplaceable .blocklyPathDark {","display: none;","}",e+" .blocklyInsertionMarker>.blocklyPath {",`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},Td=class{constructor(e,t){this.inlinePath_=this.outlinePath_="",this.block_=e,this.info_=t,this.topLeft_=e.getRelativeToSurfaceXY(),this.constants_=t.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren,this.block_.childlessWidth=this.info_.width}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){var t=this.info_.rows[e];t.hasJaggedEdge?this.drawJaggedEdge_(t):t.hasStatement?this.drawStatementInput_(t):t.hasExternalInput?this.drawValueInput_(t):this.drawRightSideRow_(t)}this.drawBottom_(),this.drawLeft_()}drawTop_(){var e=this.info_.topRow,i=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=uo(e.xPos,this.info_.startY);for(let e=0,t;t=i[e];e++)$.isLeftRoundedCorner(t)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:$.isRightRoundedCorner(t)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:$.isPreviousConnection(t)?this.outlinePath_+=t.shape.pathLeft:$.isHat(t)?this.outlinePath_+=this.constants_.START_HAT.path:$.isSpacer(t)&&(this.outlinePath_+=h("h",t.width));this.outlinePath_+=h("v",e.height)}drawJaggedEdge_(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+h("v",e.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(e){var t=e.getLastInput(),i=(this.positionExternalValueConnection_(e),Qo(t.shape)?t.shape.pathDown(t.height):t.shape.pathDown);this.outlinePath_+=h("H",t.xPos+t.width)+i+h("v",e.height-t.connectionHeight)}drawStatementInput_(e){var t,i,s=e.getLastInput();s&&(t=s.xPos+s.notchOffset+s.shape.width,s=s.shape.pathRight+h("h",-(s.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop,i=e.height-2*this.constants_.INSIDE_CORNERS.height,this.outlinePath_+=h("H",t)+s+h("v",i)+this.constants_.INSIDE_CORNERS.pathBottom+h("H",e.xPos+e.width),this.positionStatementInputConnection_(e))}drawRightSideRow_(e){this.outlinePath_+=h("V",e.yPos+e.height)}drawBottom_(){var i=this.info_.bottomRow,s=i.elements;this.positionNextConnection_();let o=0,n="";for(let e=s.length-1,t;t=s[e];e--)$.isNextConnection(t)?n+=t.shape.pathRight:$.isLeftSquareCorner(t)?n+=h("H",i.xPos):$.isLeftRoundedCorner(t)?n+=this.constants_.OUTSIDE_CORNERS.bottomLeft:$.isRightRoundedCorner(t)?(n+=this.constants_.OUTSIDE_CORNERS.bottomRight,o=this.constants_.OUTSIDE_CORNERS.rightHeight):$.isSpacer(t)&&(n+=h("h",-1*t.width));this.outlinePath_+=h("V",i.baseline-o),this.outlinePath_+=n}drawLeft_(){var e,t=this.info_.outputConnection;this.positionOutputConnection_(),t&&(e=t.connectionOffsetY+t.height,t=Qo(t.shape)?t.shape.pathUp(t.height):t.shape.pathUp,this.outlinePath_+=h("V",e)+t),this.outlinePath_+="z"}drawInternals_(){for(let e=0,i;i=this.info_.rows[e];e++)for(let e=0,t;t=i.elements[e];e++)$.isInlineInput(t)?this.drawInlineInput_(t):($.isIcon(t)||$.isField(t))&&this.layoutField_(t)}layoutField_(e){var t=e.centerline-e.height/2;let i=e.xPos;var s="";this.info_.RTL&&(i=-(i+e.width),e.flipRtl)&&(i+=e.width,s="scale(-1 1)"),$.isIcon(e)?((s=e.icon).setOffsetInBlock(new y(i,t)),this.info_.isInsertionMarker&&s.hideForInsertionMarker()):((e=e.field.getSvgRoot()).setAttribute("transform","translate("+i+","+t+")"+s),this.info_.isInsertionMarker&&e.setAttribute("display","none"))}drawInlineInput_(e){var t=e.width,i=e.height,s=e.connectionOffsetY;this.inlinePath_+=co(e.xPos+e.connectionWidth,e.centerline-i/2)+h("v",s)+e.shape.pathDown+h("v",i-(e.connectionHeight+s))+h("h",t-e.connectionWidth)+h("v",-i)+"z",this.positionInlineInputConnection_(e)}positionInlineInputConnection_(t){var i=t.centerline-t.height/2;if(t.connectionModel){let e=t.xPos+t.connectionWidth+t.connectionOffsetX;this.info_.RTL&&(e*=-1),t.connectionModel.setOffsetInBlock(e,i+t.connectionOffsetY)}}positionStatementInputConnection_(t){var i=t.getLastInput();if(null!=i&&i.connectionModel){let e=t.xPos+t.statementEdge+i.notchOffset;this.info_.RTL&&(e*=-1),i.connectionModel.setOffsetInBlock(e,t.yPos)}}positionExternalValueConnection_(t){var i=t.getLastInput();if(i&&i.connectionModel){let e=t.xPos+t.width;this.info_.RTL&&(e*=-1),i.connectionModel.setOffsetInBlock(e,t.yPos)}}positionPreviousConnection_(){var e,t=this.info_.topRow;t.connection&&(e=t.xPos+t.notchOffset,t.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-e:e,0))}positionNextConnection_(){var e,t,i=this.info_.bottomRow;i.connection&&(t=(e=i.connection).xPos,e.connectionModel.setOffsetInBlock(this.info_.RTL?-t:t,i.baseline))}positionOutputConnection_(){var e;this.info_.outputConnection&&(e=this.info_.startX+this.info_.outputConnection.connectionOffsetX,this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY))}updateConnectionHighlights(){for(var e of this.info_.rows)for(var t of e.elements){var i;t instanceof td&&(i=this.drawConnectionHighlightPath(t))&&(i.style.display=t.highlighted?"":"none")}}drawConnectionHighlightPath(e){var t,i,s=e.connectionModel,o=(e=s.type===E.INPUT_VALUE||s.type===E.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(e):this.getStatementConnectionHighlightPath(e),s.getSourceBlock());return null==(i=(t=o.pathObject).addConnectionHighlight)?void 0:i.call(t,s,e,s.getOffsetInBlock(),o.RTL)}getExpressionConnectionHighlightPath(e){let t="";return Qo(e.shape)?t=e.shape.pathDown(e.height):en(e.shape)&&(t=e.shape.pathDown),e=this.constants_.TAB_OFFSET_FROM_TOP,uo(0,-e)+h("v",e)+t+h("v",e)}getStatementConnectionHighlightPath(e){var t;if(tn(e.shape))return t=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS,uo(-t,0)+h("h",t)+e.shape.pathLeft+h("h",t);throw Error("Statement connections should have notch shapes")}},Ed=class{constructor(e,t){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=e,this.block_=t,this.constants_=this.renderer_.getConstants(),this.outputConnection=t.outputConnection?new hd(this.constants_,t.outputConnection):null,this.isInline=t.getInputsInline()&&!t.isCollapsed(),this.isCollapsed=t.isCollapsed(),this.isInsertionMarker=t.isInsertionMarker(),this.RTL=t.RTL,this.topRow=new bd(this.constants_),this.bottomRow=new ed(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let s=new ad(this.constants_);this.inputRows.push(s);var o=this.block_.getIcons();for(let e=0,t;t=o[e];e++){var i=new nd(this.constants_,t);this.isCollapsed&&!t.isShownWhenCollapsed()||s.elements.push(i)}o=void 0;for(let e=0,i;i=this.block_.inputList[e];e++)if(i.isVisible()){this.shouldStartNewRow_(i,o)&&(this.rows.push(s),s=new ad(this.constants_),this.inputRows.push(s));for(let e=0,t;t=i.fieldRow[e];e++)s.elements.push(new sd(this.constants_,t,i));this.addInput_(i,s),o=i}this.isCollapsed&&(s.hasJaggedEdge=!0,s.elements.push(new cd(this.constants_))),(s.elements.length||s.hasDummyInput)&&this.rows.push(s),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var e=!!this.block_.previousConnection,t=(this.block_.hat?"cap"===this.block_.hat:this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;let i=this.topRow.hasLeftSquareCorner(this.block_)?md:pd;this.topRow.elements.push(new i(this.constants_)),t?(e=new od(this.constants_),this.topRow.elements.push(e)):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new dd(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof sh&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,i=this.topRow.hasRightSquareCorner(this.block_)?md:pd,this.topRow.elements.push(new i(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof sh?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new md(this.constants_)):this.bottomRow.elements.push(new pd(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new ud(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new md(this.constants_,"right")):this.bottomRow.elements.push(new pd(this.constants_,"right"))}addInput_(e,t){this.isInline&&e instanceof _.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new ld(this.constants_,e)),t.hasInlineInput=!0):e instanceof sh?(t.elements.push(new _d(this.constants_,e)),t.hasStatement=!0):e instanceof _.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new id(this.constants_,e)),t.hasExternalInput=!0):(e instanceof th||e instanceof ih)&&(t.minHeight=Math.max(t.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),null===t.align&&(t.align=e.align)}shouldStartNewRow_(e,t){return!!t&&(t instanceof ih||e instanceof sh||t instanceof sh||(e instanceof _.ValueInput$$module$build$src$core$inputs$value_input||e instanceof th||t instanceof _.ValueInput$$module$build$src$core$inputs$value_input)&&!this.isInline)}addElemSpacing_(){for(let e=0,t;t=this.rows[e];e++){var i=t.elements;if(t.elements=[],t.startsWithElemSpacer()&&t.elements.push(new rd(this.constants_,this.getInRowSpacing_(null,i[0]))),i.length){for(let e=0;e<i.length-1;e++){t.elements.push(i[e]);var s=this.getInRowSpacing_(i[e],i[e+1]);t.elements.push(new rd(this.constants_,s))}t.elements.push(i[i.length-1]),t.endsWithElemSpacer()&&t.elements.push(new rd(this.constants_,this.getInRowSpacing_(i[i.length-1],null)))}}}getInRowSpacing_(e,t){if(!e&&t&&$.isStatementInput(t))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&$.isInput(e)&&!t){if($.isExternalInput(e))return this.constants_.NO_PADDING;if($.isInlineInput(e))return this.constants_.LARGE_PADDING;if($.isStatementInput(e))return this.constants_.NO_PADDING}return e&&$.isLeftSquareCorner(e)&&t&&($.isPreviousConnection(t)||$.isNextConnection(t))?t.notchOffset:e&&$.isLeftRoundedCorner(e)&&t&&($.isPreviousConnection(t)||$.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&$.isField(e)&&0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING}computeBounds_(){let i=0,s=0,o=0;for(let e=0,t;t=this.rows[e];e++){var n,r;t.measure(),s=Math.max(s,t.width),t.hasStatement&&(r=t.getLastInput(),r=t.width-(null!=(n=null==r?void 0:r.width)?n:0),i=Math.max(i,r)),o=Math.max(o,t.widthWithConnectedBlocks)}this.statementEdge=i,this.width=s;for(let e=0,t;t=this.rows[e];e++)t.hasStatement&&(t.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(s,o),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let e=0,t;t=this.rows[e];e++){var i;t.hasStatement?this.alignStatementRow_(t):(i=t.width,0<(i=this.getDesiredRowWidth_(t)-i)&&this.addAlignmentPadding_(t,i),$.isTopOrBottomRow(t)&&(t.widthWithConnectedBlocks=t.width))}}getDesiredRowWidth_(e){return this.width-this.startX}addAlignmentPadding_(e,t){var i=e.getFirstSpacer(),s=e.getLastSpacer();if((e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=t),e.align===_.Align$$module$build$src$core$inputs$align.LEFT&&s)s.width+=t;else if(e.align===_.Align$$module$build$src$core$inputs$align.CENTRE&&i&&s)i.width+=t/2,s.width+=t/2;else if(e.align===_.Align$$module$build$src$core$inputs$align.RIGHT&&i)i.width+=t;else{if(!s)return;s.width+=t}e.width+=t}alignStatementRow_(e){var t,i,s=e.getLastInput();s&&(i=e.width-s.width,0<(i=this.statementEdge-i)&&this.addAlignmentPadding_(e,i),i=e.width,t=this.getDesiredRowWidth_(e),s.width+=t-i,s.height=Math.max(s.height,e.height),e.width+=t-i,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths))}addRowSpacing_(){var t=this.rows;this.rows=[];for(let e=0;e<t.length;e++)this.rows.push(t[e]),e!==t.length-1&&this.rows.push(this.makeSpacerRow_(t[e],t[e+1]))}makeSpacerRow_(e,t){var i=this.getSpacerRowHeight_(e,t),s=this.getSpacerRowWidth_(e,t),i=new gd(this.constants_,i,s);return e.hasStatement&&(i.followsStatement=!0),t.hasStatement&&(i.precedesStatement=!0),i}getSpacerRowWidth_(e,t){return this.width-this.startX}getSpacerRowHeight_(e,t){return this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){return $.isSpacer(t)?e.yPos+t.height/2:$.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,$.isNextConnection(t)?e+t.height/2:e-t.height/2):$.isTopRow(e)?$.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:e.yPos+e.height/2}recordElemPositions_(i){let s=i.xPos;for(let e=0,t;t=i.elements[e];e++)$.isSpacer(t)&&(t.height=i.height),t.xPos=s,t.centerline=this.getElemCenterline_(i,t),s+=t.width}finalize_(){let i=0,s=0;for(let e=0,t;t=this.rows[e];e++)t.yPos=s,t.xPos=this.startX,s+=t.height,i=Math.max(i,t.widthWithConnectedBlocks),this.recordElemPositions_(t);var e;this.outputConnection&&this.block_.nextConnection&&(e=this.block_.nextConnection.targetBlock())&&(i=Math.max(i,e.getHeightWidth().width)),this.widthWithChildren=i+this.startX,this.height=s,this.startY=this.topRow.capline,this.bottomRow.baseline=s-this.bottomRow.descenderHeight}getMeasureableForConnection(e){var t,i;if((null==(t=this.outputConnection)?void 0:t.connectionModel)===e)return this.outputConnection;for(i of this.rows)for(var s of i.elements)if(s instanceof td&&s.connectionModel===e)return s;return null}},vd=class{constructor(e,t,i){this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=i,this.style=t,this.svgRoot=e,this.svgPath=a(k.PATH,{class:"blocklyPath"},this.svgRoot),this.setClass_("blocklyBlock",!0)}setPath(e){this.svgPath.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}applyColour(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())}setStyle(e){this.style=e}setClass_(e,t){e&&(t?c:r)(this.svgRoot,e)}updateHighlighted(e){e?this.setClass_("blocklyHighlighted",!0):this.setClass_("blocklyHighlighted",!1)}updateShadow_(e){e?(this.setClass_("blocklyShadow",!0),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)):this.setClass_("blocklyShadow",!1)}updateDisabled_(e){this.setClass_("blocklyDisabled",e),this.setClass_("blocklyDisabledPattern",e)}updateSelected(e){this.setClass_("blocklySelected",e)}updateDraggingDelete(e){this.setClass_("blocklyDraggingDelete",e)}updateInsertionMarker(e){this.setClass_("blocklyInsertionMarker",e)}updateMovable(e){this.setClass_("blocklyDraggable",e)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){}addConnectionHighlight(e,t,i,s){return i=`translate(${i.x}, ${i.y})`+(s?" scale(-1 1)":""),(s=this.connectionHighlights.get(e))?(s.setAttribute("d",t),s.setAttribute("transform",i),s):(t=a(k.PATH,{id:e.id,class:"blocklyHighlightedConnectionPath",style:"display: none;",d:t,transform:i},this.svgRoot),this.connectionHighlights.set(e,t),t)}removeConnectionHighlight(e){var t=this.connectionHighlights.get(e);t&&(l(t),this.connectionHighlights.delete(e))}},Kc=class{constructor(e){this.overrides=null,this.name=e}getClassName(){return this.name+"-renderer"}init(e,t){this.constants_=this.makeConstants_(),t&&(this.overrides=t,Object.assign(this.constants_,t)),this.constants_.setTheme(e),this.constants_.init()}createDom(e,t,i){this.constants_.createDom(e,this.name+"-"+t.name,"."+this.getClassName()+"."+t.getClassName(),i)}refreshDom(e,t,i){var s=this.getConstants();s.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=s.randomIdentifier,this.constants_.setTheme(t),this.constants_.init(),this.createDom(e,t,i)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new fd}makeRenderInfo_(e){return new Ed(this,e)}makeDrawer_(e,t){return new Td(e,t)}makePathObject(e,t){return new vd(e,t,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(e){return!0}orphanCanConnectAtEnd(e,t,i){return!!O.getConnectionForOrphanedConnection(e,i===E.OUTPUT_VALUE?t.outputConnection:t.previousConnection)}render(e){var t=this.makeRenderInfo_(e);t.measure(),this.makeDrawer_(e,t).draw()}},w={},yd=(w.BottomRow=ed,w.Connection=td,w.ConstantProvider=fd,w.Drawer=Td,w.ExternalValueInput=id,w.Field=sd,w.Hat=od,w.Icon=nd,w.InRowSpacer=rd,w.InlineInput=ld,w.InputConnection=Yl,w.InputRow=ad,w.JaggedEdge=cd,w.Measurable=L,w.NextConnection=ud,w.OutputConnection=hd,w.PathObject=vd,w.PreviousConnection=dd,w.RenderInfo=Ed,w.Renderer=Kc,w.RoundCorner=pd,w.Row=S,w.SpacerRow=gd,w.SquareCorner=md,w.StatementInput=_d,w.TopRow=bd,w.Types=$,w.init=on,w.register=sn,w.unregister=Rp,class{constructor(e,t){this.workspace=e,this.theme=t,this.subscribedWorkspaces=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(e){var t,i,s,o=this.theme;this.theme=e,(e=this.workspace.getInjectionDiv())&&((o=o&&o.getClassName())&&r(e,o),o=this.theme.getClassName())&&c(e,o);for(let e=0,t;t=this.subscribedWorkspaces[e];e++)t.refreshTheme();for([t,i]of this.componentDB)for(var n of i){e=n.element;o=n.propertyName,n=this.theme&&this.theme.getComponentStyle(t);e.style.setProperty(o,n||"")}for(s of this.subscribedWorkspaces)s.hideChaff()}subscribeWorkspace(e){this.subscribedWorkspaces.push(e)}unsubscribeWorkspace(e){if(!_e(this.subscribedWorkspaces,e))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(e,t,i){this.componentDB.has(t)||this.componentDB.set(t,[]),this.componentDB.get(t).push({element:e,propertyName:i}),t=this.theme&&this.theme.getComponentStyle(t),e.style.setProperty(i,t||"")}unsubscribe(t){if(t)for(var[e,i]of this.componentDB){for(let e=i.length-1;0<=e;e--)i[e].element===t&&i.splice(e,1);i.length||this.componentDB.delete(e)}}dispose(){this.subscribedWorkspaces.length=0,this.componentDB.clear()}}),kd="VARIABLE_DYNAMIC",Id={CATEGORY_NAME:kd},Dl=(Id.flyoutCategory=cn,Id.flyoutCategoryBlocks=hn,Id.internalFlyoutCategory=an,Id.onCreateVariableButtonClick_Colour=ln,Id.onCreateVariableButtonClick_Number=rn,Id.onCreateVariableButtonClick_String=nn,class{canConnect(e,t,i,s){return this.canConnectWithReason(e,t,i,s)===O.CAN_CONNECT}canConnectWithReason(e,t,i,s){var o=this.doSafetyChecks(e,t);return o!==O.CAN_CONNECT?o:this.doTypeChecks(e,t)?i&&!this.doDragChecks(e,t,s||0)?O.REASON_DRAG_CHECKS_FAILED:O.CAN_CONNECT:O.REASON_CHECKS_FAILED}getErrorMessage(e,t,i){switch(e){case O.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case O.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case O.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case O.REASON_TARGET_NULL:return"Target connection is null.";case O.REASON_CHECKS_FAILED:return"Connection checks failed. "+t+" expected "+t.getCheck()+", found "+i.getCheck();case O.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case O.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case O.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(e,t){if(!e||!t)return O.REASON_TARGET_NULL;let i,s,o;return e.isSuperior()?(i=e.getSourceBlock(),s=t.getSourceBlock(),o=t):(s=e.getSourceBlock(),i=t.getSourceBlock(),o=e,e=t),i===s?O.REASON_SELF_CONNECTION:o.type!==Ju[e.type]?O.REASON_WRONG_TYPE:i.workspace!==s.workspace?O.REASON_DIFFERENT_WORKSPACES:i.isShadow()&&!s.isShadow()?O.REASON_SHADOW_PARENT:o.type===E.OUTPUT_VALUE&&s.previousConnection&&s.previousConnection.isConnected()||o.type===E.PREVIOUS_STATEMENT&&s.outputConnection&&s.outputConnection.isConnected()?O.REASON_PREVIOUS_AND_OUTPUT:O.CAN_CONNECT}doTypeChecks(t,i){if(t=t.getCheck(),i=i.getCheck(),!t||!i)return!0;for(let e=0;e<t.length;e++)if(i.includes(t[e]))return!0;return!1}doDragChecks(e,t,i){if(e.distanceFrom(t)>i||t.getSourceBlock().isInsertionMarker())return!1;switch(t.type){case E.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,t);case E.OUTPUT_VALUE:if(t.isConnected()&&!t.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case E.INPUT_VALUE:if(!t.isConnected()||t.targetBlock().isMovable()||t.targetBlock().isShadow())break;return!1;case E.NEXT_STATEMENT:if(t.isConnected()&&!e.getSourceBlock().nextConnection&&!t.targetBlock().isShadow()&&t.targetBlock().nextConnection||t.targetBlock()&&!t.targetBlock().isMovable()&&!t.targetBlock().isShadow())return!1;break;default:return!1}return!Gl.includes(t)}canConnectToPrevious_(e,t){return!(e.targetConnection||Gl.includes(t)||t.targetConnection&&(!(e=t.targetBlock()).isInsertionMarker()||e.getPreviousBlock()))}}),Cd=(o(b.CONNECTION_CHECKER,Ur,Dl),class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(e){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new Zh,this.readOnly=!1,this.potentialVariableMap=null,this.id=Ar(),oe(this),this.options=e||new Bu({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(mr(b.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new(this.getVariableMapClass())(this),this.setIsReadOnly(this.options.readOnly)}dispose(){this.listeners.length=0,this.clear(),ne(this)}sortObjects(e,t){var i=t=>({getBoundingRectangle:()=>{var e=t.getRelativeToSurfaceXY();return new I(e.y,e.y,e.x,e.x)},moveBy:()=>{}});return this.sortByOrigin(i(e),i(t))}sortByOrigin(e,t){var i=Math.sin(ri(Cd.SCAN_ANGLE))*(this.RTL?-1:1);return e=e.getBoundingRectangle().getOrigin(),t=t.getBoundingRectangle().getOrigin(),e.y+i*e.x-(t.y+i*t.x)}addTopBlock(e){this.topBlocks.push(e)}removeTopBlock(e){if(!_e(this.topBlocks,e))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(e=!1){var t=[].concat(this.topBlocks);return e&&1<t.length&&t.sort(this.sortObjects.bind(this)),t}addTypedBlock(e){this.typedBlocksDB.has(e.type)||this.typedBlocksDB.set(e.type,[]),this.typedBlocksDB.get(e.type).push(e)}removeTypedBlock(e){_e(this.typedBlocksDB.get(e.type),e),this.typedBlocksDB.get(e.type).length||this.typedBlocksDB.delete(e.type)}getBlocksByType(e,t=!1){return this.typedBlocksDB.has(e)?(e=this.typedBlocksDB.get(e).slice(0),t&&e&&1<e.length&&e.sort(this.sortObjects.bind(this)),e.filter(e=>!e.isInsertionMarker())):[]}addTopComment(e){this.topComments.push(e),this.commentDB.has(e.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB.set(e.id,e)}removeTopComment(e){if(!_e(this.topComments,e))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(e.id)}getTopComments(e=!1){var t=[].concat(this.topComments);return e&&1<t.length&&t.sort(this.sortObjects.bind(this)),t}getAllBlocks(t=!1){if(t){var i=this.getTopBlocks(!0);t=[];for(let e=0;e<i.length;e++)t.push(...i[e].getDescendants(!0))}else for(t=this.getTopBlocks(!1),i=0;i<t.length;i++)t.push(...t[i].getChildren(!1));return t.filter(e=>!e.isInsertionMarker())}clear(){this.isClearing=!0;try{var e=_.getGroup$$module$build$src$core$events$utils();for(e||_.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();_.setGroup$$module$build$src$core$events$utils(e),this.isFlyout||this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(e,t){mt("Blockly.Workspace.renameVariableById","v12","v13","Blockly.Workspace.getVariableMap().renameVariable"),(e=this.variableMap.getVariableById(e))&&this.variableMap.renameVariable(e,t)}createVariable(e,t,i){return mt("Blockly.Workspace.createVariable","v12","v13","Blockly.Workspace.getVariableMap().createVariable"),this.variableMap.createVariable(e,null!=t?t:void 0,null!=i?i:void 0)}getVariableUsesById(e){return mt("Blockly.Workspace.getVariableUsesById","v12","v13","Blockly.Workspace.getVariableMap().getVariableUsesById"),Mt(this,e)}deleteVariableById(e){mt("Blockly.Workspace.deleteVariableById","v12","v13","Blockly.Workspace.getVariableMap().deleteVariable");var t=this.variableMap.getVariableById(e);t?_.deleteVariable$$module$build$src$core$variables(this,t):console.warn("Can't delete non-existent variable: "+e)}getVariable(e,t){return mt("Blockly.Workspace.getVariable","v12","v13","Blockly.Workspace.getVariableMap().getVariable"),this.variableMap.getVariable(e,t)}getVariableById(e){return mt("Blockly.Workspace.getVariableById","v12","v13","Blockly.Workspace.getVariableMap().getVariableById"),this.variableMap.getVariableById(e)}getVariablesOfType(e){return mt("Blockly.Workspace.getVariablesOfType","v12","v13","Blockly.Workspace.getVariableMap().getVariablesOfType"),this.variableMap.getVariablesOfType(null!=e?e:"")}getAllVariables(){return mt("Blockly.Workspace.getAllVariables","v12","v13","Blockly.Workspace.getVariableMap().getAllVariables"),this.variableMap.getAllVariables()}getAllVariableNames(){return mt("Blockly.Workspace.getAllVariableNames","v12","v13","Blockly.Workspace.getVariableMap().getAllVariables"),this.variableMap.getAllVariables().map(e=>e.getName())}getWidth(){return 0}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(e){return this.options.maxInstances?(void 0!==this.options.maxInstances[e]?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0}isCapacityAvailable(e){if(!this.hasBlockLimits())return!0;let t=0;for(var i in e){if(e[i]>this.remainingCapacityOfType(i))return!1;t+=e[i]}return!(t>this.remainingCapacity())}hasBlockLimits(){return this.options.maxBlocks!==1/0||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(e){var t=e?this.redoStack_:this.undoStack_,i=e?this.undoStack_:this.redoStack_,s=t.pop();if(s){for(var o=[s];t.length&&s.group&&s.group===t[t.length-1].group;){var n=t.pop();n&&o.push(n)}for(t=0;t<o.length;t++)i.push(o[t]);_.setRecordUndo$$module$build$src$core$events$utils(!1);try{for(i=0;i<o.length;i++)o[i].run(e)}finally{_.setRecordUndo$$module$build$src$core$events$utils(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,F()}addChangeListener(e){return this.listeners.push(e),e}removeChangeListener(e){_e(this.listeners,e)}fireChangeListener(t){if(t.recordUndo)for(this.undoStack_.push(t),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let e=0;e<this.listeners.length;e++)(0,this.listeners[e])(t)}getBlockById(e){return this.blockDB.get(e)||null}setBlockById(e,t){this.blockDB.set(e,t)}removeBlockById(e){this.blockDB.delete(e)}getCommentById(e){return null!=(e=this.commentDB.get(e))?e:null}allInputsFilled(t){var i=this.getTopBlocks(!1);for(let e=0;e<i.length;e++)if(!i[e].allInputsFilled(t))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new(this.getVariableMapClass())(this,!0)}getVariableMap(){return this.variableMap}setVariableMap(e){this.variableMap=e}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let e=null;var t=this.options.parentWorkspace;return this.isFlyout?t&&t.options&&(e=t.options.parentWorkspace):t&&(e=t),e}static getById(e){return ie(e)}static getAll(){return se()}getVariableMapClass(){var e=mr(b.VARIABLE_MAP,this.options,!0);if(e)return e;throw Error("No variable map is registered.")}isReadOnly(){return this.readOnly}setIsReadOnly(e){this.readOnly=e,this.options.readOnly=e}}),Sd=(Cd.SCAN_ANGLE=3,class{constructor(e){this.parentWorkspace=e,this.sounds=new Map,this.lastSound=null,this.muted=!1}dispose(){this.sounds.clear()}load(t,e){if(t.length){try{var i=new globalThis.Audio}catch(e){return}for(let e=0;e<t.length;e++){var s=t[e],o=s.match(/\.(\w+)$/);if(o&&i.canPlayType("audio/"+o[1])){var n=new globalThis.Audio(s);break}}n&&this.sounds.set(e,n)}}preload(){for(var e of this.sounds.values()){e.volume=.01;var t=e.play();if(void 0!==t?t.then(e.pause).catch(function(){}):e.pause(),dl||pl)break}}play(e,t){var i;this.muted||((i=this.sounds.get(e))?(e=new Date,null!==this.lastSound&&e.getTime()-this.lastSound.getTime()<100||(this.lastSound=e,(i=dl||hl?i:i.cloneNode()).volume=void 0===t?1:t,i.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(e,t))}setMuted(e){this.muted=e}getMuted(){return this.muted}}),wd=class extends Cd{constructor(e){super(e),this.resizeHandlerWrapper=null,this.resizesEnabled=this.visible=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardMoveInProgress=this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.navigator=new Rh,this.metricsManager=new(mr(b.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=e.setMetrics||wd.setTopLevelWorkspaceMetrics,this.componentManager=new Kl,this.connectionDBList=xu.init(this.connectionChecker),this.audioManager=new Sd(e.parentWorkspace),this.grid=this.options.gridPattern?new Uh(this.options.gridPattern,e.gridOptions):null,this.markerManager=new Wh(this),ec&&this.registerToolboxCategoryCallback(qa,_t),Id&&this.registerToolboxCategoryCallback(kd,an),Xh&&(this.registerToolboxCategoryCallback(Qh,jo),this.addChangeListener(Ko)),this.addChangeListener(this.variableChangeCallback.bind(this)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new yd(this,this.options.theme||Du),this.themeManager_.subscribeWorkspace(this),this.renderer=on(this.options.renderer||"geras",this.getTheme(),null!=(e=this.options.rendererOverrides)?e:void 0),this.cachedParentSvgSize=new C(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(e){this.metricsManager=e,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}getMarker(e){return this.markerManager.getMarker(e)}getCursor(){return this.markerManager.getCursor()}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(e){this.themeManager_.setTheme(e=e||Du)}refreshTheme(){var e;this.svgGroup_&&(e=null===this.options.parentWorkspace,this.renderer.refreshDom(this.svgGroup_,this.getTheme(),e?this.getInjectionDiv():void 0)),this.updateBlockStyles(this.getAllBlocks(!1).filter(e=>!!e.getStyleName())),this.refreshToolboxSelection(),this.toolbox&&this.toolbox.refreshTheme(),this.isVisible()&&this.setVisible(!0),e=new(m(f.THEME_CHANGE))(this.getTheme().name,this.id),g(e)}updateBlockStyles(i){for(let e=0,t;t=i[e];e++){var s=t.getStyleName();s&&t.setStyle(s)}}getInverseScreenCTM(){var e;return this.inverseScreenCTMDirty&&(e=this.getParentSvg().getScreenCTM())&&(this.inverseScreenCTM=e.inverse(),this.inverseScreenCTMDirty=!1),this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.visible}getSvgXY(e){let t=0,i=0,s=1;(this.getCanvas().contains(e)||this.getBubbleCanvas().contains(e))&&(s=this.scale);do{var o=we(e);e!==this.getCanvas()&&e!==this.getBubbleCanvas()||(s=1),t+=o.x*s,i+=o.y*s,e=e.parentNode}while(e&&e!==this.getParentSvg()&&e!==this.getInjectionDiv());return new y(t,i)}getCachedParentSvgSize(){var e=this.cachedParentSvgSize;return new C(e.width,e.height)}getOriginOffsetInPixels(){return Ae(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let e=this.svgGroup_;for(;e;){if((" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv ")){this.injectionDiv=e;break}e=e.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(e){this.resizeHandlerWrapper=e}createDom(e,t){return this.injectionDiv||(this.injectionDiv=null!=t?t:null),this.svgGroup_=a(k.G,{class:"blocklyWorkspace",id:this.id}),t&&Ze(this.svgGroup_,sl.LABEL,_.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),e&&(this.svgBackground_=a(k.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),"blocklyMainBackground"===e&&this.grid?this.svgBackground_.style.fill="var(--blocklyGridPattern)":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new Hh(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(p(this.svgGroup_,"pointerdown",this,this.onMouseDown,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),p(this.svgGroup_,"wheel",this,this.onMouseWheel)),this.options.hasCategories&&(this.toolbox=new(mr(b.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(e=mr(b.CURSOR,this.options))&&this.markerManager.setCursor(new e(this)),e=null===this.options.parentWorkspace,this.renderer.createDom(this.svgGroup_,this.getTheme(),e?this.getInjectionDiv():void 0),_.getFocusManager$$module$build$src$core$focus_manager().registerTree(this,!!this.injectionDiv||this.isFlyout),this.svgGroup_}dispose(){var e;this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&l(this.svgGroup_),this.toolbox&&(this.toolbox.dispose(),this.toolbox=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),this.options.parentWorkspace||(e=this.getParentSvg())&&e.parentNode&&l(e.parentNode),this.resizeHandlerWrapper&&(n(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null),_.getFocusManager$$module$build$src$core$focus_manager().isRegistered(this)&&_.getFocusManager$$module$build$src$core$focus_manager().unregisterTree(this)}addTrashcan(){this.trashcan=wd.newTrashcan(this);var e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.getCanvas())}static newTrashcan(e){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new ba(this);var e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)}copyOptionsForFlyout(){return new Bu({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,plugins:this.options.plugins,modalInputs:this.options.modalInputs,move:{scrollbars:!0}})}addFlyout(e){var t=this.copyOptionsForFlyout();return t.toolboxPosition=this.options.toolboxPosition,this.flyout=new(this.horizontalLayout?mr(b.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0):mr(b.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(t),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(e)}getFlyout(e){return this.flyout||e?this.flyout:this.toolbox?this.toolbox.getFlyout():null}getToolbox(){return this.toolbox}updateScreenCalculations(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox?this.toolbox.position():this.flyout&&this.flyout.position();var i=this.componentManager.getComponents(Kl.Capability.POSITIONABLE,!0),s=this.getMetricsManager().getUiMetrics(),o=[];for(let e=0,t;t=i[e];e++){t.position(s,o);var n=t.getBoundingRectangle();n&&o.push(n)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations()}updateScreenCalculationsIfScrolled(){var e=Re();y.equals(this.lastRecordedPageScroll,e)||(this.lastRecordedPageScroll=e,this.updateScreenCalculations())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(e,t){var i=this.getParentSvg();null!=e&&(this.cachedParentSvgSize.width=e,i.setAttribute("data-cached-width",""+e)),null!=t&&(this.cachedParentSvgSize.height=t,i.setAttribute("data-cached-height",""+t))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let e=this.svgGroup_;for(;e;){if("svg"===e.tagName){this.cachedParentSvg=e;break}e=e.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){var e,t,i,s;U()&&(e=this.scale,t=-this.scrollY,i=-this.scrollX,e===this.oldScale&&Math.abs(t-this.oldTop)<1&&Math.abs(i-this.oldLeft)<1||(s=new(m(f.VIEWPORT_CHANGE))(t,i,e,this.id,this.oldScale),this.oldScale=e,this.oldTop=t,this.oldLeft=i,g(s)))}translate(e,t){var i;null!=(i=this.layerManager)&&i.translateLayers(new y(e,t),this.scale),null!=(i=this.grid)&&i.moveTo(e,t),this.maybeFireViewportChangeEvent()}getWidth(){var e=this.getMetrics();return e?e.viewWidth/this.scale:0}setVisible(e){this.visible=e,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox&&this.toolbox.setVisible(e),e||this.hideChaff(!0))}render(){var t=this.getAllBlocks(!1);for(let e=t.length-1;0<=e;e--)t[e].queueRender();this.getTopBlocks().flatMap(e=>e.getDescendants(!1)).filter(e=>e.isInsertionMarker()).forEach(e=>e.queueRender())}highlightBlock(e,t){if(void 0===t){for(let e=0,t;t=this.highlightedBlocks[e];e++)t.setHighlighted(!1);this.highlightedBlocks.length=0}(e=e?this.getBlockById(e):null)&&((t=void 0===t||t)?this.highlightedBlocks.includes(e)||this.highlightedBlocks.push(e):_e(this.highlightedBlocks,e),e.setHighlighted(t))}variableChangeCallback(e){switch(e.type){case f.VAR_CREATE:case f.VAR_DELETE:case f.VAR_RENAME:case f.VAR_TYPE_CHANGE:this.refreshToolboxSelection()}}refreshToolboxSelection(){var e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox&&e.toolbox.getFlyout()&&e.toolbox.refreshSelection()}recordDragTargets(){var i=this.componentManager.getComponents(Kl.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let e=0,t;t=i[e];e++){var s=t.getClientRect();s&&this.dragTargetAreas.push({component:t,clientRect:s})}}newBlock(e,t){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}getDragTarget(i){for(let e=0,t;t=this.dragTargetAreas[e];e++)if(t.clientRect.contains(i.clientX,i.clientY))return t.component;return null}onMouseDown(e){var t=this.getGesture(e);t&&t.handleWsStart(e,this)}startDrag(e,t){Ss(this,e,t)}moveDrag(e){return ws(this,e)}setKeyboardMoveInProgress(e){this.keyboardMoveInProgress=e}isDragging(){return this.keyboardMoveInProgress||null!==this.currentGesture_&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){var e=!!this.scrollbar;return this.isMovable()&&(!e||this.scrollbar.canScrollHorizontally())}isMovableVertically(){var e=!!this.scrollbar;return this.isMovable()&&(!e||this.scrollbar.canScrollVertically())}onMouseWheel(e){var t,i,s,o;Fh.inProgress()?(e.preventDefault(),e.stopPropagation()):(t=this.options.zoomOptions&&this.options.zoomOptions.wheel,i=this.options.moveOptions&&this.options.moveOptions.wheel,(t||i)&&(s=Sr(e),gl&&(o=e.metaKey),t&&(e.ctrlKey||o||!i)?(s=-s.y/50,t=Cr(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(t.x,t.y,s)):(t=this.scrollX-s.x,i=this.scrollY-s.y,e.shiftKey&&!s.x&&(t=this.scrollX-s.y,i=this.scrollY),this.scroll(t,i)),e.preventDefault()))}getBlocksBoundingBox(){var t=this.getTopBoundedElements();if(!t.length)return new I(0,0,0,0);var i=t[0].getBoundingRectangle();for(let e=1;e<t.length;e++){var s=t[e];s.isInsertionMarker&&s.isInsertionMarker()||((s=s.getBoundingRectangle()).top<i.top&&(i.top=s.top),s.bottom>i.bottom&&(i.bottom=s.bottom),s.left<i.left&&(i.left=s.left),s.right>i.right&&(i.right=s.right))}return i}cleanUp(){this.setResizesEnabled(!1),_.setGroup$$module$build$src$core$events$utils(!0);var e=(s=this.getTopBlocks(!0)).filter(e=>e.isMovable());let i=s.filter(e=>!e.isMovable()).map(e=>e.getBoundingRectangle());var t,s=function(e){for(var t of i)if(e.intersects(t))return t;return null},o=0,n=this.renderer.getConstants().MIN_BLOCK_HEIGHT;for(t of e){for(e=t.getBoundingRectangle(),t.moveBy(-e.left,o-e.top,["cleanup"]),t.snapToGrid(),o=s(e=t.getBoundingRectangle());null!=o;)o=o.top+o.getHeight()+n,t.moveBy(0,o-e.top,["cleanup"]),t.snapToGrid(),o=s(e=t.getBoundingRectangle());o=t.getRelativeToSurfaceXY().y+t.getHeightWidth().height+n}_.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(e){var t,i;this.isReadOnly()||this.isFlyout||(t=x.registry.getContextMenuOptions({workspace:this,focusedNode:this},e),this.configureContextMenu&&this.configureContextMenu(t,e),i=e instanceof PointerEvent?new y(e.clientX,e.clientY):Ne(this,new y(5,5)),fs(e,t,this.RTL,this,i))}updateToolbox(e){if(e=Me(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(Pe(e)){if(!this.toolbox)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox.render(e)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(le(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(e,t,i){i=Math.pow(this.options.zoomOptions.scaleSpeed,i);var s,o,n=this.scale*i;this.scale!==n&&(n>this.options.zoomOptions.maxScale?i=this.options.zoomOptions.maxScale/this.scale:n<this.options.zoomOptions.minScale&&(i=this.options.zoomOptions.minScale/this.scale),s=this.getCanvas().getCTM(),(o=this.getParentSvg().createSVGPoint()).x=e,o.y=t,e=(o=o.matrixTransform(s.inverse())).x,s=s.translate(e*(1-i),(t=o.y)*(1-i)).scale(i),this.scrollX=s.e,this.scrollY=s.f,this.setScale(n))}zoomCenter(e){var t=this.getMetrics();let i;t=this.flyout?(i=t.svgWidth?t.svgWidth/2:0,t.svgHeight?t.svgHeight/2:0):(i=t.viewWidth/2+t.absoluteLeft,t.viewHeight/2+t.absoluteTop),this.zoom(i,t,e)}zoomToFit(){if(this.isMovable()){var e=(t=this.getMetrics()).viewWidth,t=t.viewHeight,i=(s=this.getBlocksBoundingBox()).right-s.left+40,s=s.bottom-s.top+40;if(i){this.flyout&&(this.horizontalLayout?(t+=this.flyout.getHeight(),s+=this.flyout.getHeight()/this.scale):(e+=this.flyout.getWidth(),i+=this.flyout.getWidth()/this.scale)),e/=i,t/=s,_.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(e,t)),this.scrollCenter()}finally{_.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){c(this.getCanvas(),"blocklyCanvasTransitioning"),c(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){r(this.getCanvas(),"blocklyCanvasTransitioning"),r(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){var e,t;this.isMovable()?(t=((e=this.getMetrics()).scrollWidth-e.viewWidth)/2,this.scroll(t=-t-e.scrollLeft,-((e.scrollHeight-e.viewHeight)/2)-e.scrollTop)):console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(e,t){var i,s;this.isMovable()?(i=e?this.getBlockById(e):null)&&(e=i.getRelativeToSurfaceXY(),i=t?{height:i.height,width:i.width}:i.getHeightWidth(),s=this.scale,t=(e.x+(this.RTL?-1:1)*i.width/2)*s,e=(e.y+i.height/2)*s,i=this.getMetrics(),this.scroll(-(t-i.viewWidth/2),-(e-i.viewHeight/2))):console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,this.hideChaff(!1),(e=this.getFlyout(!1))&&e.isVisible()&&(e.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))}getScale(){return this.scale}getAbsoluteScale(){let i=e=>{if(e.isFlyout){var t=null==(t=e.targetWorkspace)?void 0:t.getFlyout();if(t instanceof Mh)return t.getFlyoutScale()}return e.getScale()},s=(e,t)=>e.options.parentWorkspace&&e.options.parentWorkspace.getSvgGroup().contains(e.getSvgGroup())?s(e.options.parentWorkspace,t*i(e)):t*i(e);return s(this,1)}scroll(e,t){this.hideChaff(!0);var i=this.getMetrics(),s=(e=Math.min(e,-i.scrollLeft),t=Math.min(t,-i.scrollTop),i.scrollTop+Math.max(0,i.scrollHeight-i.viewHeight));e=Math.max(e,-(i.scrollLeft+Math.max(0,i.scrollWidth-i.viewWidth))),t=Math.max(t,-s),this.scrollX=e,this.scrollY=t,this.scrollbar&&this.scrollbar.set(-(e+i.scrollLeft),-(t+i.scrollTop),!1),e+=i.absoluteLeft,t+=i.absoluteTop,this.translate(e,t)}getBlockById(e){return super.getBlockById(e)}getAllBlocks(e=!1){return super.getAllBlocks(e)}getTopBlocks(e=!1){return super.getTopBlocks(e)}addTopBlock(e){this.addTopBoundedElement(e),super.addTopBlock(e)}removeTopBlock(e){this.removeTopBoundedElement(e),super.removeTopBlock(e)}addTopComment(e){this.addTopBoundedElement(e),super.addTopComment(e)}removeTopComment(e){this.removeTopBoundedElement(e),super.removeTopComment(e)}getTopComments(e=!1){return super.getTopComments(e)}getCommentById(e){return super.getCommentById(e)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(e){this.topBoundedElements.push(e)}removeTopBoundedElement(e){_e(this.topBoundedElements,e)}getTopBoundedElements(e=!1){var t=[].concat(this.topBoundedElements);return e&&t.sort(this.sortByOrigin.bind(this)),t}setResizesEnabled(e){var t=!this.resizesEnabled&&e;this.resizesEnabled=e,t&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(e,t){if("function"!=typeof t)throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(e,t)}getButtonCallback(e){return null!=(e=this.flyoutButtonCallbacks.get(e))?e:null}removeButtonCallback(e){this.flyoutButtonCallbacks.delete(e)}registerToolboxCategoryCallback(e,t){if("function"!=typeof t)throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(e,t)}getToolboxCategoryCallback(e){return this.toolboxCategoryCallbacks.get(e)||null}removeToolboxCategoryCallback(e){this.toolboxCategoryCallbacks.delete(e)}getGesture(e){var t,i;return this.keyboardMoveInProgress?(e.preventDefault(),e.stopPropagation(),null):((t="pointerdown"===e.type)&&null!=(i=this.currentGesture_)&&i.hasStarted()&&(console.warn("Tried to start the same gesture twice."),this.currentGesture_.cancel()),!this.currentGesture_&&t&&(this.currentGesture_=new Fh(e,this)),this.currentGesture_)}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(e=!1){Gi(),us(this),ki(),this.hideComponents(e)}hideComponents(t=!1){this.getComponentManager().getComponents(Kl.Capability.AUTOHIDEABLE,!0).forEach(e=>e.autoHide(t))}static setTopLevelWorkspaceMetrics(e){var t=this.getMetrics();"number"==typeof e.x&&(this.scrollX=-(t.scrollLeft+(t.scrollWidth-t.viewWidth)*e.x)),"number"==typeof e.y&&(this.scrollY=-(t.scrollTop+(t.scrollHeight-t.viewHeight)*e.y)),this.translate(this.scrollX+t.absoluteLeft,this.scrollY+t.absoluteTop)}addClass(e){this.injectionDiv&&c(this.injectionDiv,e)}removeClass(e){this.injectionDiv&&r(this.injectionDiv,e)}setIsReadOnly(e){super.setIsReadOnly(e),e?this.addClass("blocklyReadOnly"):this.removeClass("blocklyReadOnly")}scrollBoundsIntoView(e,t=10){var i,s,o;Fh.inProgress()||(i=this.getScale(),o=this.getMetricsManager().getViewMetrics(!0),o=new I(o.top,o.top+o.height,o.left,o.left+o.width),e.left>=o.left&&e.top>=o.top&&e.right<=o.right&&e.bottom<=o.bottom)||((e=e.clone()).top-=t,e.bottom+=t,e.left-=t,e.right+=t,s=t=0,e.left<o.left?t=this.RTL?Math.min(o.left-e.left,o.right-e.right):o.left-e.left:e.right>o.right&&(t=this.RTL?o.right-e.right:Math.max(o.right-e.right,o.left-e.left)),e.top<o.top?s=o.top-e.top:e.bottom>o.bottom&&(s=Math.max(o.bottom-e.bottom,o.top-e.top)),this.scroll(this.scrollX+t*i,this.scrollY+s*i))}getFocusableElement(){return this.svgGroup_}getFocusableTree(){return this.isMutator&&this.options.parentWorkspace||this}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}getRootFocusableNode(){return this}getRestoredFocusableNode(e){return!e&&null!=(e=this.getTopBlocks(!0)[0])?e:null}getNestedTrees(){var e=this.getAllBlocks().map(e=>e.getIcons()).flat().filter(e=>e instanceof _.MutatorIcon$$module$build$src$core$icons$mutator_icon&&e.bubbleIsVisible()).map(e=>null==(e=e.getBubble())?void 0:e.getWorkspace()).filter(e=>!!e),t=this.getFlyout(!0);return t&&e.push(t.getWorkspace()),e}searchForWorkspaceComment(e){for(var t of this.getTopComments())if(t instanceof ku&&t.canBeFocused()&&t.getFocusableElement().id===e)return t}lookUpFocusableNode(t){var e,i,s=null==(e=this.targetWorkspace)?void 0:e.getFlyout();if(this.isFlyout&&s)for(var o of s.getContents())if(e=o.getElement(),Q(e)&&e.canBeFocused()&&e.getFocusableElement().id===t)return e;if(o=t.indexOf("_field_"),e=t.indexOf("_connection_"),-1!==o){var n=t.substring(0,o);if(n=this.getBlockById(n))for(var r of n.getFields())if(r.canBeFocused()&&r.getFocusableElement().id===t)return r}else if(-1!==e){if(n=t.substring(0,e),n=this.getBlockById(n))for(var l of n.getConnections_(!0))if(l.id===t)return l}else{if(-1!==(r=Math.max(t.indexOf(bu),t.indexOf(mu),t.indexOf(Tu)))&&(r=t.substring(0,r),r=this.searchForWorkspaceComment(r)))return-1<t.indexOf(bu)?r.getEditorFocusableNode():null!=(i=r.view.getCommentBarButtons().find(e=>e.getFocusableElement().id.includes(t)))?i:null;if(i=(i=this.getAllBlocks(!1).find(e=>e.getFocusableElement().id===t))||this.searchForWorkspaceComment(t))return i;for(n of i=this.getAllBlocks().map(e=>e.getIcons()).flat()){if(n.canBeFocused()&&n.getFocusableElement().id===t)return n;if(ni(n)&&(i=n.getBubble())&&i.canBeFocused()&&i.getFocusableElement().id===t)return i}}return null}onTreeFocus(e,t){}onTreeBlur(e){var t,i;this.isFlyout&&this.targetWorkspace&&!_.getFocusManager$$module$build$src$core$focus_manager().ephemeralFocusTaken()&&(t=this.targetWorkspace.getFlyout(),(i=this.targetWorkspace.getToolbox())&&e===i||(i&&i.clearSelection(),t&&Po(t)&&t.autoHide(!1)))}getNavigator(){return this.navigator}setNavigator(e){this.navigator=e}},Ad=class extends Wl{constructor(e){super(),this.isBlank=void 0===e,e&&(this.varId=e.getId(),this.workspaceId=e.getWorkspace().id)}toJson(){var e=super.toJson();if(this.varId)return e.varId=this.varId,e;throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ad)).varId=e.varId,t}},xd=class extends Ad{constructor(e){super(e),this.type=f.VAR_CREATE,e&&(this.varType=e.getType(),this.varName=e.getName())}toJson(){var e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(this.varName)return e.varType=this.varType,e.varName=this.varName,e;throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new xd)).varType=e.varType,t.varName=e.varName,t}run(e){var t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");t=t.getVariableMap(),e?t.createVariable(this.varName,this.varType,this.varId):(e=t.getVariableById(this.varId))&&t.deleteVariable(e)}},Xr=(o(b.EVENT,f.VAR_CREATE,xd),class{constructor(e,t,i,s){this.workspace=e,this.name=t,this.type=i||"",this.id=s||Ar()}getId(){return this.id}getName(){return this.name}setName(e){return this.name=e,this}getType(){return this.type}setType(e){return this.type=e,this}getWorkspace(){return this.workspace}save(){var e={name:this.getName(),id:this.getId()},t=this.getType();return t&&(e.type=t),e}static load(e,t){e=new this(t,e.name,e.type,e.id),t.getVariableMap().addVariable(e),g(new(m(f.VAR_CREATE))(e))}}),Rd=(o(b.VARIABLE_MODEL,Ur,Xr),class extends Ad{constructor(e){super(e),this.type=f.VAR_DELETE,e&&(this.varType=e.getType(),this.varName=e.getName())}toJson(){var e=super.toJson();if(void 0===this.varType)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(this.varName)return e.varType=this.varType,e.varName=this.varName,e;throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Rd)).varType=e.varType,t.varName=e.varName,t}run(e){var t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");t=t.getVariableMap(),e?(e=t.getVariableById(this.varId))&&t.deleteVariable(e):t.createVariable(this.varName,this.varType,this.varId)}}),Od=(o(b.EVENT,f.VAR_DELETE,Rd),class extends Ad{constructor(e,t){super(e),this.type=f.VAR_RENAME,e&&(this.oldName=e.getName(),this.newName=void 0===t?"":t)}toJson(){var e=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(this.newName)return e.oldName=this.oldName,e.newName=this.newName,e;throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Od)).oldName=e.oldName,t.newName=e.newName,t}run(e){var t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");var i=(t=t.getVariableMap()).getVariableById(this.varId);e?i&&t.renameVariable(i,this.newName):i&&t.renameVariable(i,this.oldName)}}),pc=(o(b.EVENT,f.VAR_RENAME,Od),class{constructor(e,t=!1){this.workspace=e,this.potentialMap=t,this.variableMap=new Map}clear(){for(var e of this.variableMap.values())for(var t of e.values())this.deleteVariable(t);if(0!==this.variableMap.size)throw Error("Non-empty variable map")}renameVariable(t,i){if(t.getName()!==i){var s=t.getType(),s=this.getVariable(i,s),o=this.workspace.getAllBlocks(!1);let e="";this.potentialMap||(e=_.getGroup$$module$build$src$core$events$utils())||_.setGroup$$module$build$src$core$events$utils(!0);try{s&&s.getId()!==t.getId()?this.renameVariableWithConflict(t,i,s,o):this.renameVariableAndUses(t,i,o)}finally{this.potentialMap||_.setGroup$$module$build$src$core$events$utils(e)}}return t}changeVariableType(e,t){var i,s;return null!=(i=this.variableMap.get(e.getType()))&&i.delete(e.getId()),e.setType(t),(i=null!=(s=this.variableMap.get(t))?s:new Map).set(e.getId(),e),this.variableMap.has(t)||this.variableMap.set(t,i),e}renameVariableById(e,t){mt("VariableMap.renameVariableById","v12","v13","VariableMap.renameVariable");var i=this.getVariableById(e);if(!i)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(i,t)}renameVariableAndUses(e,t,i){for(this.potentialMap||g(new(m(f.VAR_RENAME))(e,t)),e.setName(t),t=0;t<i.length;t++)i[t].updateVarName(e)}renameVariableWithConflict(e,t,i,s){var o=e.getType();for(t!==i.getName()&&this.renameVariableAndUses(i,t,s),t=0;t<s.length;t++)s[t].renameVarById(e.getId(),i.getId());this.potentialMap||g(new(m(f.VAR_DELETE))(e)),null!=(o=this.variableMap.get(o))&&o.delete(e.getId())}createVariable(e,t,i){if(s=this.getVariable(e,t)){if(i&&s.getId()!==i)throw Error('Variable "'+e+'" is already in use and its id is "'+s.getId()+'" which conflicts with the passed in id, "'+i+'".')}else{if(i&&this.getVariableById(i))throw Error('Variable id, "'+i+'", is already in use.');if(s=i||Ar(),t=t||"",!(i=pr(b.VARIABLE_MODEL,Ur,!0)))throw Error("No variable model is registered.");var s=new i(this.workspace,e,t,s);(e=null!=(i=this.variableMap.get(t))?i:new Map).set(s.getId(),s),this.variableMap.has(t)||this.variableMap.set(t,e),this.potentialMap||g(new(m(f.VAR_CREATE))(s))}return s}addVariable(e){var t=e.getType();this.variableMap.has(t)||this.variableMap.set(t,new Map),null!=(t=this.variableMap.get(t))&&t.set(e.getId(),e)}deleteVariable(e){var t=Mt(this.workspace,e.getId());let i="";this.potentialMap||(i=_.getGroup$$module$build$src$core$events$utils())||_.setGroup$$module$build$src$core$events$utils(!0);try{for(let e=0;e<t.length;e++)t[e].dispose(!0);var s=this.variableMap.get(e.getType());s&&s.has(e.getId())&&(s.delete(e.getId()),this.potentialMap||g(new(m(f.VAR_DELETE))(e)),0===s.size)&&this.variableMap.delete(e.getType())}finally{this.potentialMap||_.setGroup$$module$build$src$core$events$utils(i)}}deleteVariableById(e){mt("VariableMap.deleteVariableById","v12","v13","Blockly.Variables.deleteVariable"),(e=this.getVariableById(e))&&_.deleteVariable$$module$build$src$core$variables(this.workspace,e)}getVariable(t,e){return(e=this.variableMap.get(e||""))&&null!=(e=[...e.values()].find(e=>_.Names$$module$build$src$core$names.equals(e.getName(),t)))?e:null}getVariableById(e){for(var t of this.variableMap.values())if(t.has(e))return null!=(t=t.get(e))?t:null;return null}getVariablesOfType(e){return(e=this.variableMap.get(e||""))?[...e.values()]:[]}getTypes(){return[...this.variableMap.keys()]}getAllVariables(){let e=[];for(var t of this.variableMap.values())e=e.concat(...t.values());return e}getAllVariableNames(){mt("VariableMap.getAllVariableNames","v12","v13","Blockly.Variables.getAllVariables");var e,t=[];for(e of this.variableMap.values())for(var i of e.values())t.push(i.getName());return t}getVariableUsesById(e){return mt("VariableMap.getVariableUsesById","v12","v13","Blockly.Variables.getVariableUsesById"),Mt(this.workspace,e)}}),Nd=(o(b.VARIABLE_MAP,Ur,pc),class extends zl{constructor(e,t){super(t),this.type=f.TRASHCAN_OPEN,this.isOpen=e}toJson(){var e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Nd)).isOpen=e.isOpen,t}}),$d=(o(b.EVENT,f.TRASHCAN_OPEN,Nd),class extends gh{constructor(e){super(),this.workspace=e,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,this.workspace.options.maxTrashcanContents<=0||(e=this.workspace.copyOptionsForFlyout(),this.workspace.horizontalLayout?(e.toolboxPosition=this.workspace.toolboxPosition===T.TOP?T.BOTTOM:T.TOP,this.flyout=new(mr(b.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(e)):(e.toolboxPosition=this.workspace.toolboxPosition===T.RIGHT?T.LEFT:T.RIGHT,this.flyout=new(mr(b.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(e)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){this.svgGroup=a(k.G,{class:"blocklyTrash"});var e=String(Math.random()).substring(2),t=a(k.CLIPPATH,{id:"blocklyTrashBodyClipPath"+e},this.svgGroup),i=(a(k.RECT,{width:Ld,height:Md,y:Dd},t),a(k.IMAGE,{width:_a.width,x:-Ud,height:_a.height,y:-Hd,"clip-path":"url(#blocklyTrashBodyClipPath"+e+")"},this.svgGroup));return i.setAttributeNS(Nl,"xlink:href",this.workspace.options.pathToMedia+_a.url),t=a(k.CLIPPATH,{id:"blocklyTrashLidClipPath"+e},this.svgGroup),a(k.RECT,{width:Ld,height:Dd},t),this.svgLid=a(k.IMAGE,{width:_a.width,x:-Ud,height:_a.height,y:-Hd,"clip-path":"url(#blocklyTrashLidClipPath"+e+")"},this.svgGroup),this.svgLid.setAttributeNS(Nl,"xlink:href",this.workspace.options.pathToMedia+_a.url),yr(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),yr(this.svgGroup,"pointerup",this,this.click),yr(i,"pointerover",this,this.mouseOver),yr(i,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){var e;0<this.workspace.options.maxTrashcanContents&&(e=this.flyout.createDom(k.SVG),c(e,"blocklyTrashcanFlyout"),j(e,this.workspace.getParentSvg()),this.flyout.init(this.workspace)),this.workspace.getComponentManager().addComponent({component:this,weight:Kl.ComponentWeight.TRASHCAN_WEIGHT,capabilities:[Kl.Capability.AUTOHIDEABLE,Kl.Capability.DELETE_AREA,Kl.Capability.DRAG_TARGET,Kl.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&l(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){var t,i;this.contentsIsOpen()||(t=this.contents.map(function(e){return JSON.parse(e)}),(i=this.workspace.getParentSvg().style).cursor="wait",setTimeout(()=>{var e;null!=(e=this.flyout)&&e.show(t),i.cursor="",null!=(e=this.workspace.scrollbar)&&e.setVisible(!1)},10),this.fireUiEvent(!0))}closeFlyout(){var e;this.contentsIsOpen()&&(null!=(e=this.flyout)&&e.hide(),null!=(e=this.workspace.scrollbar)&&e.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(e,t){var i;this.initialized&&(i=ze(this.workspace,e),e=We(i,new C(Ld,Md+Dd),Pd,Bd,e,this.workspace),t=je(e,Bd,i.vertical===Qr.TOP?tl.DOWN:tl.UP,t),this.top=t.top,this.left=t.left,null!=(e=this.svgGroup)&&e.setAttribute("transform","translate("+this.left+","+this.top+")"),null!=(i=this.flyout))&&i.position()}getBoundingRectangle(){return new I(this.top,this.top+Md+Dd,this.left,this.left+Ld)}getClientRect(){var e,t;return this.svgGroup?(e=(t=this.svgGroup.getBoundingClientRect()).top+Hd-Fd,new I(e,e+Dd+Md+2*Fd,t=t.left+Ud-Fd,t+Ld+2*Fd)):null}onDragOver(e){this.setLidOpen(this.wouldDelete_)}onDragExit(e){this.setLidOpen(!1)}onDrop(e){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(e){this.isLidOpen!==e&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=e,this.animateLid())}animateLid(){var e=Wd,t=1/(e+1);this.lidOpen+=this.isLidOpen?t:-t,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*Yd),t=zd+this.lidOpen*(jd-zd),this.svgGroup&&(this.svgGroup.style.opacity=""+t),this.lidOpen>this.minOpenness&&this.lidOpen<1&&(this.lidTask=setTimeout(this.animateLid.bind(this),Vd/e))}setLidAngle(e){var t,i=this.workspace.toolboxPosition===T.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;null!=(t=this.svgLid)&&t.setAttribute("transform","rotate("+(i?-e:e)+","+(i?4:Ld-4)+","+(Dd-2)+")")}setMinOpenness(e){this.minOpenness=e,this.isLidOpen||this.setLidAngle(e*Yd)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(e){e=new(m(f.TRASHCAN_OPEN))(e,this.workspace.id),g(e)}blockMouseDownWhenOpenable(e){!this.contentsIsOpen()&&this.hasContents()&&e.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(e){if(!(this.workspace.options.maxTrashcanContents<=0||!Rr(e)||e.wasShadow)){if(!e.oldJson)throw Error("Encountered a delete event without proper oldJson");if(e=JSON.stringify(this.cleanBlockJson(e.oldJson)),!this.contents.includes(e)){for(this.contents.unshift(e);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness(Gd)}}}cleanBlockJson(e){return function e(t){if(t){var i,s;for(s in delete t.id,delete t.x,delete t.y,delete t.enabled,delete t.disabledReasons,t.icons&&t.icons.comment&&(delete(i=t.icons.comment).height,delete i.width,delete i.pinned),i=t.inputs){var o=(n=i[s]).block,n=n.shadow;o&&e(o),n&&e(n)}t.next&&(t=(s=t.next).block,s=s.shadow,t&&e(t),s)&&e(s)}}(e=JSON.parse(JSON.stringify(e))),Object.assign({},{kind:"BLOCK"},e)}}),Ld=47,Md=44,Dd=16,Bd=20,Pd=20,Fd=10,Ud=0,Hd=32,Gd=.1,Vd=80,Wd=4,zd=.4,jd=.8,Yd=45,Xd=null,Kd=null,Jd=void 0,Ul={},Jc=(Ul.BlockPaster=ah,Ul.copy=dn,Ul.getLastCopiedData=Np,Ul.getLastCopiedLocation=$p,Ul.getLastCopiedWorkspace=Lp,Ul.paste=pn,Ul.registry=t,Ul.setLastCopiedData=zp,Ul.setLastCopiedLocation=jp,Ul.setLastCopiedWorkspace=Yp,{}),ea=(Jc.CollapseCommentBarButton=_u,Jc.CommentBarButton=gu,Jc.CommentEditor=fu,Jc.CommentView=vu,Jc.DeleteCommentBarButton=Eu,Jc.RenderedWorkspaceComment=ku,Jc.WorkspaceComment=yu,(ac=Kh=Kh||{}).ESCAPE="escape",ac.DELETE="delete",ac.COPY="copy",ac.CUT="cut",ac.PASTE="paste",ac.UNDO="undo",ac.REDO="redo",qp(),{}),i=(ea.names=Kh,ea.registerCopy=En,ea.registerCut=vn,ea.registerDefaultShortcuts=qp,ea.registerDelete=bn,ea.registerEscape=_n,ea.registerPaste=yn,ea.registerRedo=In,ea.registerUndo=kn,{ProcedureSerializer:class{constructor(e,t){this.procedureModelClass=e,this.parameterModelClass=t,this.priority=75}save(e){return(e=e.getProcedureMap().getProcedures().map(e=>Cn(e))).length?e:null}load(e,t){var i,s=t.getProcedureMap();for(i of e)s.add(Sn(this.procedureModelClass,this.parameterModelClass,i,t))}clear(e){e.getProcedureMap().clear()}}}),zu=(i.loadProcedure=Sn,i.saveProcedure=Cn,class{constructor(){this.priority=100}save(e){return(e=e.getAllVariables().map(e=>e.save())).length?e:null}load(e,t){let i=pr(b.VARIABLE_MODEL,Ur);e.forEach(e=>{null!=i&&i.load(e,t)})}clear(e){e.getVariableMap().clear()}}),ga=(Zp("variables",new zu),{}),_l=(ga.VariableSerializer=zu,{}),Xl=(_l.load=Qp,_l.save=tg,{blocks:cc,exceptions:lc,priorities:Vr,procedures:i,registry:fa,variables:ga,workspaceComments:Ta,workspaces:_l}),qd=("Blockly"in globalThis||(globalThis.Blockly={Msg:Jh}),class{load(e,t){return(e=new fh(t.getWorkspace(),t.targetWorkspace,e,!0)).show(),new mh(e,"label")}gapForItem(e,t){return t}disposeItem(e){(e=e.getElement())instanceof fh&&e.dispose()}getType(){return"label"}}),Zd=(o(b.FLYOUT_INFLATER,"label",qd),class extends fd{constructor(e){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:+this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,e&&(this.GRID_UNIT=e),this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=+this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=+this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(e){super.setFontConstants_(e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(e){super.setDynamicProperties_(e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;var t=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=t&&!isNaN(t)?t:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&l(this.selectedGlowFilter),this.replacementGlowFilter&&l(this.replacementGlowFilter)}makeStartHat(){var e=this.START_HAT_HEIGHT,t=this.START_HAT_WIDTH;return{height:.75*e,width:t,path:ao("c",[u(25,-e),u(71,-e),u(t,0)])}}makeHexagonal(){function t(e,t,i){var s=(s=e/2)>o?o:s;return ho(-(i=i?-1:1)*s,e=(t?-1:1)*e/2)+ho(i*s,e)}let o=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width(e){return(e/=2)>o?o:e},height(e){return e},connectionOffsetY(e){return e/2},connectionOffsetX(e){return-e},pathDown(e){return t(e,!1,!1)},pathUp(e){return t(e,!0,!1)},pathRightDown(e){return t(e,!1,!0)},pathRightUp(e){return t(e,!1,!0)}}}makeRounded(){function t(e,t,i){var s=e>n?e-n:0,o=(e=(e>n?n:e)/2,i===t?"0":"1");return go("a","0 0,"+o,e,u((i?1:-1)*e,(t?-1:1)*e))+h("v",(t?-1:1)*s)+go("a","0 0,"+o,e,u((i?-1:1)*e,(t?-1:1)*e))}let i=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,n=2*i;return{type:this.SHAPES.ROUND,isDynamic:!0,width(e){return(e/=2)>i?i:e},height(e){return e},connectionOffsetY(e){return e/2},connectionOffsetX(e){return-e},pathDown(e){return t(e,!1,!1)},pathUp(e){return t(e,!0,!1)},pathRightDown(e){return t(e,!1,!0)},pathRightUp(e){return t(e,!1,!0)}}}makeSquared(){function t(e,t,i){e-=2*o;var s=i===t?"0":"1";return go("a","0 0,"+s,o,u((i?1:-1)*o,(t?-1:1)*o))+h("v",(t?-1:1)*e)+go("a","0 0,"+s,o,u((i?-1:1)*o,(t?-1:1)*o))}let o=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width(e){return o},height(e){return e},connectionOffsetY(e){return e/2},connectionOffsetX(e){return-e},pathDown(e){return t(e,!1,!1)},pathUp(e){return t(e,!0,!1)},pathRightDown(e){return t(e,!1,!0)},pathRightUp(e){return t(e,!1,!0)}}}shapeFor(e){let t=e.getCheck();switch(!t&&e.targetConnection&&(t=e.targetConnection.getCheck()),e.type){case E.INPUT_VALUE:case E.OUTPUT_VALUE:if(null!==(e=e.getSourceBlock().getOutputShape()))switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return t&&t.includes("Boolean")?this.HEXAGONAL:(t&&t.includes("Number")||t&&t.includes("String"),this.ROUNDED);case E.PREVIOUS_STATEMENT:case E.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function e(e){return ao("c",[u(e*o/2,0),u(e*o*3/4,r/2),u(e*o,r)])+po([u(e*o,n)])+ao("c",[u(e*o/4,r/2),u(e*o/2,r),u(e*o,r)])+h("h",e*s)+ao("c",[u(e*o/2,0),u(e*o*3/4,-r/2),u(e*o,-r)])+po([u(e*o,-n)])+ao("c",[u(e*o/4,-r/2),u(e*o/2,-r),u(e*o,-r)])}let t=this.NOTCH_WIDTH,i=this.NOTCH_HEIGHT,s=t/3,o=s/3,n=i/2,r=n/2,l=e(1),a=e(-1);return{type:this.SHAPES.NOTCH,width:t,height:i,pathLeft:l,pathRight:a}}makeInsideCorners(){var e=this.CORNER_RADIUS,t=go("a","0 0,0",e,u(-e,e)),i=go("a","0 0,1",e,u(-e,e));return{width:e,height:e,pathTop:t,pathBottom:go("a","0 0,0",e,u(e,e)),rightWidth:e,rightHeight:e,pathTopRight:i,pathBottomRight:go("a","0 0,1",e,u(e,e))}}generateSecondaryColour_(e){return Qi("#000",e,.15)||e}generateTertiaryColour_(e){return Qi("#000",e,.25)||e}createDom(e,t,i,s){super.createDom(e,t,i,s),e=a(k.DEFS,{},e),t=a(k.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),a(k.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},t),i=a(k.FECOMPONENTTRANSFER,{result:"outBlur"},t),a(k.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),a(k.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},t),a(k.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},t),this.selectedGlowFilterId=t.id,this.selectedGlowFilter=t,e=a(k.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),a(k.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),t=a(k.FECOMPONENTTRANSFER,{result:"outBlur"},e),a(k.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},t),a(k.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),a(k.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),a(k.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter=e,s&&(s.style.setProperty("--blocklySelectedGlowFilter",`url(#${this.selectedGlowFilterId})`),s.style.setProperty("--blocklyReplacementGlowFilter",`url(#${this.replacementGlowFilterId})`))}getCSS_(e){return[e+" .blocklyText,",e+" .blocklyFlyoutLabelText {",`font: ${this.FIELD_TEXT_FONTWEIGHT} `+this.FIELD_TEXT_FONTSIZE+`pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",e+" .blocklyTextInputBubble textarea {","font-weight: normal;","}",e+" .blocklyText {","fill: #fff;","}",e+" .blocklyNonEditableField>rect:not(.blocklyDropdownRect),",e+" .blocklyEditableField>rect:not(.blocklyDropdownRect) {",`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",e+" .blocklyNonEditableField>text,",e+" .blocklyEditableField>text,",e+" .blocklyNonEditableField>g>text,",e+" .blocklyEditableField>g>text {","fill: #575E75;","}",e+" .blocklyFlyoutLabelText {","fill: #575E75;","}",e+" .blocklyText.blocklyBubbleText {","fill: #575E75;","}",e+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableField:not(.blocklyEditing):hover>rect,",e+" .blocklyDraggable:not(.blocklyDisabled)"," .blocklyEditableField:not(.blocklyEditing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",e+" .blocklyHtmlInput {",`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",e+" .blocklyDropdownText {","fill: #fff !important;","}",e+".blocklyWidgetDiv .blocklyMenuItem,",e+".blocklyDropDownDiv .blocklyMenuItem {",`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",e+".blocklyDropDownDiv .blocklyMenuItemContent {","color: #fff;","}",e+" .blocklyHighlightedConnectionPath {",`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",e+" .blocklyDisabledPattern > .blocklyOutlinePath {","fill: var(--blocklyDisabledPattern)","}",e+" .blocklyInsertionMarker>.blocklyPath {",`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}",e+" .blocklySelected>.blocklyPath.blocklyPathSelected {","fill: none;","filter: var(--blocklySelectedGlowFilter);","}",e+" .blocklyReplaceable>.blocklyPath {","filter: var(--blocklyReplacementGlowFilter);","}"]}}),Qd=class extends Td{constructor(e,t){super(e,t)}draw(){var e=this.block_.pathObject;e.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),e.setPath(this.outlinePath_+"\n"+this.inlinePath_),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(e){if(!(e.height<=0)){if($.isSpacer(e)){var t,i,s=e.precedesStatement,o=e.followsStatement;if(s||o)return i=(t=this.constants_.INSIDE_CORNERS).rightHeight,i=e.height-(s?i:0),o=o?t.pathBottomRight:"",e=0<i?h("V",e.yPos+i):"",void(this.outlinePath_+=o+e+(s?t.pathTopRight:""))}this.outlinePath_+=h("V",e.yPos+e.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){var e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=uo(e.xPos,this.info_.startY),this.outlinePath_+=h("h",e.width)}drawFlatBottom_(){var e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=h("V",e.baseline),this.outlinePath_+=h("h",-e.width)}drawInlineInput_(e){this.positionInlineInputConnection_(e);var t=e.input.name;e.connectedBlock||this.info_.isInsertionMarker||(e=co(e.xPos+e.connectionWidth,e.centerline-e.height/2)+this.getInlineInputPath(e),this.block_.pathObject.setOutlinePath(t,e))}getInlineInputPath(e){var t=e.width-2*e.connectionWidth,i=e.height;return h("h",t)+e.shape.pathRightDown(i)+h("h",-t)+e.shape.pathUp(i)+"z"}drawStatementInput_(e){var t=(n=e.getLastInput()).xPos+n.notchOffset+n.shape.width,i=this.constants_.INSIDE_CORNERS,s=n.shape.pathRight+h("h",-(n.notchOffset-i.width))+i.pathTop,o=e.height-2*i.height,n=i.pathBottom+h("h",n.notchOffset-i.width)+(n.connectedBottomNextConnection?"":n.shape.pathLeft);this.outlinePath_+=h("H",t)+s+h("v",o)+n+h("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}drawConnectionHighlightPath(e){var t=e.connectionModel;if(t.type===E.NEXT_STATEMENT||t.type===E.PREVIOUS_STATEMENT||t.type===E.OUTPUT_VALUE&&!e.isDynamicShape)return super.drawConnectionHighlightPath(e);e=t.type===E.INPUT_VALUE?co(e.connectionWidth,-e.height/2)+this.getInlineInputPath(e):co(e.width,-e.height/2)+e.shape.pathDown(e.height);var i,s,o=t.getSourceBlock();return null==(s=(i=o.pathObject).addConnectionHighlight)?void 0:s.call(i,t,e,t.getOffsetInBlock(),o.RTL)}},ep=class extends A{constructor(e,t,i,s,o,n,r){if(super(A.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",i=Number(ss(i)),t=Number(ss(t)),isNaN(i)||isNaN(t))throw Error("Height and width values of an image field must cast to numbers.");if(i<=0||t<=0)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new C(t,i+ep.Y_PADDING),this.imageHeight=i,"function"==typeof o&&(this.clickHandler=o),e!==A.SKIP_SETUP&&(r?this.configure_(r):(this.flipRtl=!!n,this.altText=ss(s)||""),this.setValue(ss(e)))}configure_(e){super.configure_(e),e.flipRtl&&(this.flipRtl=e.flipRtl),e.alt&&(this.altText=ss(e.alt))}initView(){this.imageElement=a(k.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(Nl,"xlink:href",this.value_),this.fieldGroup_&&c(this.fieldGroup_,"blocklyImageField"),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(e){return"string"!=typeof e?null:e}doValueUpdate_(e){this.value_=e,this.imageElement&&this.imageElement.setAttributeNS(Nl,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(e){e!==this.altText&&(this.altText=e||"",this.imageElement)&&this.imageElement.setAttribute("alt",this.altText)}isClickable(){return super.isClickable()&&!!this.clickHandler}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(e){this.clickHandler=e}getText_(){return this.altText}static fromJson(e){if(e.src&&e.width&&e.height)return new this(e.src,e.width,e.height,void 0,void 0,void 0,e);throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.")}},tp=(ep.Y_PADDING=1,qh("field_image",ep),ep.prototype.DEFAULT_VALUE="",class extends A{set size_(e){super.size_=e}get size_(){var e=super.size_;return e.width<14&&(e.width=14),e}constructor(e,t,i){super(A.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onInputWrapper=this.onKeyDownWrapper=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,e!==A.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t)&&this.setValidator(t)}configure_(e){super.configure_(e),void 0!==e.spellcheck&&(this.spellcheck_=e.spellcheck)}initView(){if(!this.getSourceBlock())throw new qc;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot()),this.fieldGroup_&&c(this.fieldGroup_,"blocklyInputField")}isFullBlockField(){var e,t=this.getSourceBlock();if(t)return this.fullBlockClickTarget_=!(null==(e=this.getConstants())||!e.FULL_BLOCK_FIELDS)&&t.isSimpleReporter();throw new qc}doValueInvalid_(e,t=!0){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,e=this.value_,this.value_=this.valueWhenEditorWasOpened_,this.sourceBlock_)&&U()&&this.value_!==e&&t&&g(new(m(f.BLOCK_CHANGE))(this.sourceBlock_,"field",this.name||null,e,this.value_))}doValueUpdate_(e){this.isTextValid_=this.isDirty_=!0,this.value_=e}applyColour(){var e=this.getSourceBlock();if(!e)throw new qc;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",e.getColourTertiary())):(this.borderRect_.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){var e;return null!=(e=this.getConstants())&&e.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){var e;if(super.render_(),this.isBeingEdited_&&(e=this.htmlInput_,this.isTextValid_?(r(e,"blocklyInvalidInput"),Ze(e,sl.INVALID,!1)):(c(e,"blocklyInvalidInput"),Ze(e,sl.INVALID,!0))),!(e=this.getSourceBlock()))throw new qc;this.getConstants().FULL_BLOCK_FIELDS&&e.applyColour()}setSpellcheck(e){e!==this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_)&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_)}showEditor_(e,t=!1,i=!0){this.workspace_=this.sourceBlock_.workspace,!t&&this.workspace_.options.modalInputs&&(ml||hl||dl)?this.showPromptEditor():this.showInlineEditor(t,i)}showPromptEditor(){ht(_.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),e=>{null!==e&&this.setValue(this.getValueFromEditorText_(e)),this.onFinishEditing_(this.value_)})}showInlineEditor(e,t){var i=this.getSourceBlock();if(!i)throw new qc;rs(this,i.RTL,this.widgetDispose_.bind(this),this.workspace_,t),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var e=this.getSourceBlock();if(!e)throw new qc;_.setGroup$$module$build$src$core$events$utils(!0);var t=al,i=this.getClickTarget_();if(!i)throw Error("A click target has not been set.");c(i,"blocklyEditing"),(i=document.createElement("input")).className="blocklyHtmlInput",i.setAttribute("spellcheck",this.spellcheck_);var s=this.workspace_.getAbsoluteScale(),o=this.getConstants().FIELD_TEXT_FONTSIZE*s+"pt";return t.style.fontSize=o,i.style.fontSize=o,o=tp.BORDERRADIUS*s+"px",this.isFullBlockField()&&(o=((o=this.getScaledBBox()).bottom-o.top)/2+"px",e=(e.getParent()?e.getParent():this.sourceBlock_).getColourTertiary(),i.style.border=+s+"px solid "+e,t.style.borderRadius=o,t.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW)&&(t.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*s+"px"),i.style.borderRadius=o,t.appendChild(i),i.value=i.defaultValue=this.getEditorText_(this.value_),i.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(i),i}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&U()&&null!==this.valueWhenEditorWasOpened_&&this.valueWhenEditorWasOpened_!==this.value_&&(g(new(m(f.BLOCK_CHANGE))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),_.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var e=al.style;if(e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,!(e=this.getClickTarget_()))throw Error("A click target has not been set.");r(e,"blocklyEditing")}onFinishEditing_(e){}bindInputEvents_(e){this.onKeyDownWrapper=p(e,"keydown",this,this.onHtmlInputKeyDown_),this.onInputWrapper=p(e,"input",this,this.onHtmlInputChange)}unbindInputEvents_(){this.onKeyDownWrapper&&(n(this.onKeyDownWrapper),this.onKeyDownWrapper=null),this.onInputWrapper&&(n(this.onInputWrapper),this.onInputWrapper=null)}onHtmlInputKeyDown_(e){var t,i;"Enter"===e.key?(cs(this),ki()):"Escape"===e.key?(this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),cs(this),ki()):"Tab"===e.key&&(e.preventDefault(),t=null==(i=this.workspace_)?void 0:i.getCursor(),i=e=>(e instanceof tp||e instanceof N&&e.isSimpleReporter())&&e!==this.getSourceBlock(),(e=(e=e.shiftKey?null==t?void 0:t.getPreviousNode(this,i,!1):null==t?void 0:t.getNextNode(this,i,!1))instanceof N&&e.isSimpleReporter()?e.getFields().next().value:e)instanceof tp)&&(cs(this),ki(),t=e.getSourceBlock(),e.isFullBlockField()&&t&&t instanceof N?_.getFocusManager$$module$build$src$core$focus_manager().focusNode(t):_.getFocusManager$$module$build$src$core$focus_manager().focusNode(e),e.showEditor())}onHtmlInputChange(e){e=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&U()&&this.value_!==e&&g(new(m(f.BLOCK_FIELD_INTERMEDIATE_CHANGE))(this.sourceBlock_,this.name||null,e,this.value_))}setEditorValue_(e,t=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e,t)}resizeEditor_(){tt().then(()=>{var e=this.getSourceBlock();if(!e)throw new qc;var t=al,i=this.getScaledBBox(),s=(t.style.width=i.right-i.left+"px",t.style.height=i.bottom-i.top+"px",i.top);t.style.left=`${e.RTL?i.right-t.offsetWidth:i.left}px`,t.style.top=s+"px"})}repositionForWindowResize(){var e=null==(e=this.getSourceBlock())?void 0:e.getRootBlock();return e instanceof N&&(xo(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),e)||this.resizeEditor_(),!0)}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(e){return""+e}getValueFromEditorText_(e){return e}}),ip=(tp.BORDERRADIUS=4,_.FieldTextInput$$module$build$src$core$field_textinput=class extends tp{constructor(e,t,i){super(e,t,i)}initView(){super.initView(),this.fieldGroup_&&c(this.fieldGroup_,"blocklyTextInputField")}doClassValidation_(e){return void 0===e?null:""+e}static fromJson(e){return new this(ss(e.text),void 0,e)}},qh("field_input",_.FieldTextInput$$module$build$src$core$field_textinput),_.FieldTextInput$$module$build$src$core$field_textinput.prototype.DEFAULT_VALUE="",_.FieldTextInput$$module$build$src$core$field_textinput,class extends ed{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){return!!e.outputConnection}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}}),sp=class extends _d{constructor(e,t){if(super(e,t),this.connectedBottomNextConnection=!1,this.connectedBlock){for(e=this.connectedBlock;t=e.getNextBlock();)e=t;e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},op=class extends L{constructor(e){super(e),this.width=this.height=0,this.type|=$.getType("RIGHT_CONNECTION")}},np=class extends bd{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){var t=(e.hat?"cap"===e.hat:this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||t}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},rp=class extends Ed{constructor(e,t){super(e,t),this.isInline=!0,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.topRow=new np(this.constants_),this.bottomRow=new ip(this.constants_),this.isMultiRow=!t.getInputsInline()||t.isCollapsed(),this.hasStatementInput=0<t.statementInputCount,this.rightSide=this.outputConnection?new op(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(e,t){return!!t&&(t instanceof ih||e instanceof sh||t instanceof sh||(e instanceof _.ValueInput$$module$build$src$core$inputs$value_input||e instanceof th||e instanceof ih)&&(!this.isInline||this.isMultiRow))}getDesiredRowWidth_(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(e)}getInRowSpacing_(e,t){return e&&t||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&t&&$.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&$.isLeftRoundedCorner(e)&&t&&($.isPreviousConnection(t)||$.isNextConnection(t))?t.notchOffset-this.constants_.CORNER_RADIUS:e&&$.isLeftSquareCorner(e)&&t&&$.isHat(t)||e&&$.isField(e)&&0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(e,t){var i,s;return $.isTopRow(e)&&$.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:(i=$.isInputRow(e)&&e.hasStatement,(s=$.isInputRow(t)&&t.hasStatement)||i?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),s&&i?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):$.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):$.isBottomRow(t)?this.outputConnection?!t.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING)}getSpacerRowWidth_(e,t){var i=this.width-this.startX;return $.isInputRow(e)&&e.hasStatement||$.isInputRow(t)&&t.hasStatement?Math.max(i,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):i}getElemCenterline_(e,t){if(e.hasStatement&&!$.isSpacer(t)&&!$.isStatementInput(t))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if($.isInlineInput(t)){var i=t.connectedBlock;if(i&&i.outputConnection&&i.nextConnection)return e.yPos+i.height/2}return super.getElemCenterline_(e,t)}addInput_(e,t){if((e instanceof th||e instanceof ih)&&t.hasDummyInput&&t.align===_.Align$$module$build$src$core$inputs$align.LEFT&&e.align===_.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(t,e);else if(e instanceof sh)return t.elements.push(new sp(this.constants_,e)),t.hasStatement=!0,void(null===t.align&&(t.align=e.align));super.addInput_(e,t)}addAlignmentPadding_(i,e){if(this.rightAlignedDummyInputs.get(i)){let t;for(let e=0;e<i.elements.length;e++){var s=i.elements[e];if($.isSpacer(s)&&(t=s),$.isField(s)&&s.parentInput===this.rightAlignedDummyInputs.get(i))break}if(t)return t.width+=e,void(i.width+=e)}super.addAlignmentPadding_(i,e)}adjustXPosition_(){var t=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let i=t;for(let e=2;e<this.rows.length-1;e+=2){var s,o=this.rows[e-1],n=this.rows[e],r=this.rows[e+1],o=2===e?!!this.topRow.hasPreviousConnection:!!o.followsStatement,r=e+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!r.precedesStatement;if($.isInputRow(n)&&n.hasStatement)n.measure(),i=n.width-(null!=(s=null==(s=n.getLastInput())?void 0:s.width)?s:0)+t;else if(o&&(2===e||r)&&$.isInputRow(n)&&!n.hasStatement){r=n.xPos,o=null;for(let e=0;e<n.elements.length;e++){var l=n.elements[e];!((o=$.isSpacer(l)?l:o)&&($.isField(l)||$.isInput(l))&&r<i)||$.isField(l)&&(l.field instanceof Ku||l.field instanceof ep)||(o.width+=i-r),r+=l.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var e=this.outputConnection.shape;if("isDynamic"in e&&e.isDynamic){for(var t=0,i=0;i<this.rows.length;i++){var s=this.rows[i];s.yPos=t,t+=s.height}this.height=t,i=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,t=e.height(i),i=e.width(i),this.outputConnection.height=t,this.outputConnection.width=i,this.outputConnection.startX=i,this.outputConnection.connectionOffsetY=e.connectionOffsetY(t),this.outputConnection.connectionOffsetX=e.connectionOffsetX(i),e=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(e=i,this.rightSide.height=t,this.rightSide.width=e,this.rightSide.centerline=t/2,this.rightSide.xPos=this.width+e),this.startX=i,this.width+=i+e,this.widthWithChildren+=i+e}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var i=0,e=0;e<this.rows.length;e++){var s=this.rows[e];if($.isInputRow(s)){i=s.elements[s.elements.length-2];let e=this.getNegativeSpacing_(s.elements[1]),t=this.getNegativeSpacing_(i);var i=e+t,o=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-i<o&&(i=this.width-o,e=i/2,t=i/2),s.elements.unshift(new rd(this.constants_,-e)),s.elements.push(new rd(this.constants_,-t))}}if(i)for(this.width-=i,this.widthWithChildren-=i,this.rightSide.xPos-=i,e=0;e<this.rows.length;e++)s=this.rows[e],$.isTopOrBottomRow(s)&&(s.elements[1].width-=i),s.width-=i,s.widthWithConnectedBlocks-=i}}getNegativeSpacing_(e){var t,i,s,o;return e&&this.outputConnection?(t=this.outputConnection.width,i=this.outputConnection.shape.type,s=this.constants_,1<this.inputRows.length?i!==s.SHAPES.ROUND?0:(i=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,t-(i=this.height/2>i?i:this.height/2)*(1-Math.sin(Math.acos((i-this.constants_.SMALL_PADDING)/i)))):$.isInlineInput(e)?null==(e=(o=e.connectedBlock)?o.pathObject.outputShapeType:e.shape.type)||o&&o.outputConnection&&(o.statementInputCount||o.nextConnection)||i===s.SHAPES.HEXAGONAL&&i!==e?0:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][e]:$.isField(e)?i===s.SHAPES.ROUND&&e.field instanceof _.FieldTextInput$$module$build$src$core$field_textinput?t-2.75*s.GRID_UNIT:t-this.constants_.SHAPE_IN_SHAPE_PADDING[i][0]:$.isIcon(e)?this.constants_.SMALL_PADDING:0):0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let e=2;e<this.rows.length-1;e+=2){var t=this.rows[e-1],i=this.rows[e],s=this.rows[e+1],o=2===e,n=e+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!s.precedesStatement;if(o?this.topRow.hasPreviousConnection:t.followsStatement){var r=i.elements[1],r=3===i.elements.length&&r instanceof sd&&(r.field instanceof Ku||r.field instanceof ep);if(!o&&r)t.height-=this.constants_.SMALL_PADDING,s.height-=this.constants_.SMALL_PADDING,i.height-=this.constants_.MEDIUM_PADDING;else if(o||n){if(n){for(o=!1,n=0;n<i.elements.length;n++)if(r=i.elements[n],$.isInlineInput(r)&&r.connectedBlock&&!r.connectedBlock.isShadow()&&40<=r.connectedBlock.getHeightWidth().height){o=!0;break}o&&(t.height-=this.constants_.SMALL_PADDING,s.height-=this.constants_.SMALL_PADDING)}}else t.height+=this.constants_.SMALL_PADDING}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},lp=class extends vd{constructor(e,t,i){super(e,t,i),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=i}setPath(e){super.setPath(e),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",e)}applyColour(e){super.applyColour(e);var t,i=e.getParent();e.isShadow()&&i&&this.svgPath.setAttribute("stroke",i.getColourTertiary());for(t of this.outlines.values())t.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(var e of this.outlines.values())e.setAttribute("transform","scale(-1 1)")}updateSelected(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.classList.add("blocklyPathSelected"),r(this.svgPathSelected,Fl.ACTIVE_FOCUS_NODE_CSS_CLASS_NAME),r(this.svgPathSelected,Fl.PASSIVE_FOCUS_NODE_CSS_CLASS_NAME),this.svgPathSelected.removeAttribute("tabindex"),this.svgPathSelected.removeAttribute("id"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,t){e=e.getParentInput().name,(e=this.getOutlinePath(e))&&(t?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(var e of this.outlines.keys())this.remainingOutlines.add(e)}endDrawing(){if(this.remainingOutlines.size)for(var e of this.remainingOutlines)this.removeOutlinePath(e);this.remainingOutlines.clear()}setOutlinePath(e,t){(e=this.getOutlinePath(e)).setAttribute("d",t),e.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(e){return this.outlines.has(e)||this.outlines.set(e,a(k.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(e),this.outlines.get(e)}removeOutlinePath(e){let t,i;null!=(t=this.outlines.get(e))&&null!=(i=t.parentNode)&&i.removeChild(this.outlines.get(e)),this.outlines.delete(e)}},ap=class extends Kc{constructor(e){super(e)}makeConstants_(){return new Zd}makeRenderInfo_(e){return new rp(this,e)}makeDrawer_(e,t){return new Qd(e,t)}makePathObject(e,t){return new lp(e,t,this.getConstants())}getConstants(){return this.constants_}},cp=(sn("zelos",ap),class{constructor(e){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=e.workspace}previewReplacement(e,t,i){_.disable$$module$build$src$core$events$utils();try{this.hidePreview(),(this.fadedBlock=i).fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(t)&&(t.highlight(),this.staticConn=t)}finally{_.enable$$module$build$src$core$events$utils()}}previewConnection(e,t){if(e!==this.draggedConn||t!==this.staticConn){_.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.shouldUseMarkerPreview(e,t)&&(this.markerConn=this.previewMarker(e,t)),this.workspace.getRenderer().shouldHighlightConnection(t)&&t.highlight(),this.draggedConn=e,this.staticConn=t}finally{_.enable$$module$build$src$core$events$utils()}}}shouldUseMarkerPreview(e,t){return t.type===E.PREVIOUS_STATEMENT||t.type===E.NEXT_STATEMENT||!(this.workspace.getRenderer()instanceof ap)}previewMarker(e,t){let i=e.getSourceBlock(),s=this.createInsertionMarker(i),o=this.getMatchingConnection(i,s,e);if(!o)return null;s.queueRender(),it(),o.connect(t);let n={x:t.x-o.x,y:t.y-o.y},r=o.getOffsetInBlock().clone();return tt().then(()=>{if(!s.isDeadOrDying()){_.disable$$module$build$src$core$events$utils();try{null!=s&&s.positionNearConnection(o,n,r),null!=s&&s.getSvgRoot().setAttribute("visibility","visible")}finally{_.enable$$module$build$src$core$events$utils()}}}),o}createInsertionMarker(e){var t,i=Dt(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!i)throw Error("Failed to serialize source block. "+e.toDevString());for(t of(e=zt(i,this.workspace)).getDescendants(!1))t.setInsertionMarker(!0);return e.initSvg(),e.getSvgRoot().setAttribute("visibility","hidden"),e}getMatchingConnection(t,i,s){if(t=t.getConnections_(!0),i=i.getConnections_(!0),t.length===i.length)for(let e=0;e<t.length;e++)if(t[e]===s)return i[e];return null}hidePreview(){_.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{_.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(e){var t,i=e.getSourceBlock(),s=i.outputConnection;null!=(t=i.previousConnection)&&t.targetConnection||null!=s&&s.targetConnection?i.unplug(!0):null!=(t=e.targetBlock())&&t.unplug(!1),i.dispose()}dispose(){this.hidePreview()}}),up=(o(b.CONNECTION_PREVIEWER,Ur,cp),{}),hp=(up.Align=_.Align$$module$build$src$core$inputs$align,up.DummyInput=th,up.EndRowInput=ih,up.Input=eh,up.StatementInput=sh,up.ValueInput=_.ValueInput$$module$build$src$core$inputs$value_input,up.inputTypes=_.inputTypes$$module$build$src$core$inputs$input_types,!1),dp=(_.CodeGenerator$$module$build$src$core$generator=class{constructor(e){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(i){i||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),i=qr);var s=[];this.init(i),i=i.getTopBlocks(!0);for(let e=0,t;t=i[e];e++){let e=this.blockToCode(t);(e=Array.isArray(e)?e[0]:e)&&(t.outputConnection&&(e=this.scrubNakedValue(e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e=this.injectId(this.STATEMENT_PREFIX,t)+e),this.STATEMENT_SUFFIX)&&!t.suppressPrefixSuffix&&(e+=this.injectId(this.STATEMENT_SUFFIX,t)),s.push(e))}return s=s.join("\n"),(s=(s=(s=this.finish(s)).replace(/^\s+\n/,"")).replace(/\n\s+$/,"\n")).replace(/[ \t]+\n/g,"\n")}prefixLines(e,t){return t+e.replace(/(?!\n$)\n/g,"\n"+t)}allNestedComments(t){var i=[];t=t.getDescendants(!0);for(let e=0;e<t.length;e++){var s=t[e].getCommentText();s&&i.push(s)}return i.length&&i.push(""),i.join("\n")}blockToCode(e,t){if(!1===this.isInitialized&&console.warn("CodeGenerator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return t?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return t?"":this.blockToCode(e.getChildren(!1)[0]);var i=this.forBlock[e.type];if("function"!=typeof i)throw Error(this.name_+" generator does not know how to generate code "+`for block type "${e.type}".`);if(i=i.call(e,e,this),Array.isArray(i)){if(e.outputConnection)return[this.scrub_(e,i[0],t),i[1]];throw TypeError("Expecting string from statement block: "+e.type)}if("string"==typeof i)return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(i=this.injectId(this.STATEMENT_PREFIX,e)+i),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(i+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,i,t);if(null===i)return"";throw SyntaxError("Invalid code generated: "+i)}valueToCode(e,t,i){if(isNaN(i))throw TypeError("Expecting valid order from block: "+e.type);if(!(s=e.getInputTargetBlock(t))&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if(!s)return"";if(""===(t=this.blockToCode(s)))return"";if(!Array.isArray(t))throw TypeError(`Expecting tuple from value block: ${s.type} See `+"developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information");if(e=t[0],t=t[1],isNaN(t))throw TypeError("Expecting valid order from value block: "+s.type);if(!e)return"";var s=!1,o=Math.floor(i),n=Math.floor(t);if(o<=n&&(o!==n||0!==o&&99!==o))for(s=!0,o=0;o<this.ORDER_OVERRIDES.length;o++)if(this.ORDER_OVERRIDES[o][0]===i&&this.ORDER_OVERRIDES[o][1]===t){s=!1;break}return e=s?"("+e+")":e}statementToCode(e,t){var i=e.getInputTargetBlock(t);if(!i&&!e.getInput(t))throw ReferenceError(`Input "${t}" doesn't exist on "${e.type}"`);if("string"!=typeof(e=this.blockToCode(i)))throw TypeError("Expecting code from statement block: "+(i&&i.type));return e=e&&this.prefixLines(e,this.INDENT)}addLoopTrap(e,t){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,t),this.INDENT)+e),this.STATEMENT_SUFFIX&&!t.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,t),this.INDENT)+e),this.STATEMENT_PREFIX&&!t.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,t),this.INDENT)),e}injectId(e,t){return t=t.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+t+"'")}addReservedWords(e){this.RESERVED_WORDS_+=e+","}provideFunction_(t,i){if(!this.definitions_[t]){var s=this.nameDB_.getDistinctName(t,_.NameType$$module$build$src$core$names.PROCEDURE);this.functionNames_[t]=s,i=(i=Array.isArray(i)?i.join("\n"):i).trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,s);let e;for(;e!==i;)i=(e=i).replace(/^(( {2})*) {2}/gm,"$1\0");i=i.replace(/\0/g,this.INDENT),this.definitions_[t]=i}return this.functionNames_[t]}getVariableName(e){return this.getName(e,_.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(e){return this.getName(e,_.NameType$$module$build$src$core$names.PROCEDURE)}getName(e,t){if(this.nameDB_)return this.nameDB_.getName(e,t);throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.")}init(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(e,t,i){return t}finish(e){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),e}scrubNakedValue(e){return e}},0,_.CodeGenerator$$module$build$src$core$generator,class extends Mh{constructor(e){super(e)}setMetrics_(e){var t,i,s;this.isVisible()&&(t=(s=this.workspace_.getMetricsManager()).getScrollMetrics(),i=s.getViewMetrics(),s=s.getAbsoluteMetrics(),"number"==typeof e.y&&(this.workspace_.scrollY=-(t.top+(t.height-i.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+s.left,this.workspace_.scrollY+s.top))}getX(){var e,t,i;return this.isVisible()?(e=(i=this.targetWorkspace.getMetricsManager()).getAbsoluteMetrics(),t=i.getViewMetrics(),i=i.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===T.LEFT?i.width:t.width-this.getWidth():this.toolboxPosition_===T.LEFT?0:t.width:this.toolboxPosition_===T.LEFT?0:t.width+e.left-this.getWidth()):0}getY(){return 0}position(){var e,t;this.isVisible()&&this.targetWorkspace.isVisible()&&(e=this.targetWorkspace.getMetricsManager().getViewMetrics(),this.height_=e.height,t=this.getWidth()-this.CORNER_RADIUS,this.setBackgroundPath(t,e.height-2*this.CORNER_RADIUS),e=this.getX(),t=this.getY(),this.positionAt_(this.getWidth(),this.getHeight(),e,t))}setBackgroundPath(e,t){var i=this.toolboxPosition_===T.RIGHT,s=e+this.CORNER_RADIUS;(s=["M "+(i?s:0)+",0"]).push("h",i?-e:e),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("v",Math.max(0,t)),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,i?0:1,i?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("h",i?e:-e),s.push("z"),this.svgBackground_.setAttribute("d",s.join(" "))}scrollToStart(){var e;null!=(e=this.workspace_.scrollbar)&&e.setY(0)}wheel_(e){var t,i,s=Sr(e);s.y&&(t=(i=this.workspace_.getMetricsManager()).getScrollMetrics(),s=i.getViewMetrics().top-t.top+s.y,null!=(i=this.workspace_.scrollbar)&&i.setY(s),us(this.workspace_),ki()),e.preventDefault(),e.stopPropagation()}layout_(e){this.workspace_.scale=this.targetWorkspace.scale;var t,i=this.MARGIN,s=this.RTL?i:i+this.tabWidth_;for(t of e)t.getElement().moveBy(s,i),i+=t.getElement().getBoundingRectangle().getHeight()}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;var t=this.dragAngleRange_;return e<t&&-t<e||e<-180+t||180-t<e}getClientRect(){var e,t;return this.svgGroup_&&!this.autoClose&&this.isVisible()?(t=(e=this.svgGroup_.getBoundingClientRect()).left,this.toolboxPosition_===T.LEFT?new I(-1e9,1e9,-1e9,t+e.width):new I(-1e9,1e9,t,1e9)):null}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();var e=this.getContents().reduce((e,t)=>Math.max(e,t.getElement().getBoundingRectangle().getWidth()),0),e=(e=(e+=1.5*this.MARGIN+this.tabWidth_)*this.workspace_.scale)+sa.scrollbarThickness;if(this.getWidth()!==e){if(this.RTL)for(var t of this.getContents()){var i=t.getElement().getBoundingRectangle().left,s=e/this.workspace_.scale-t.getElement().getBoundingRectangle().getWidth()-this.MARGIN-this.tabWidth_;t.getElement().moveBy(s-i,0)}this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==T.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}}),pp=(dp.registryName="verticalFlyout",o(b.FLYOUTS_VERTICAL_TOOLBOX,Ur,dp),class extends Mh{constructor(e){super(e),this.horizontalLayout=!0}setMetrics_(e){var t,i,s;this.isVisible()&&(t=(s=this.workspace_.getMetricsManager()).getScrollMetrics(),i=s.getViewMetrics(),s=s.getAbsoluteMetrics(),"number"==typeof e.x&&(this.workspace_.scrollX=-(t.left+(t.width-i.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+s.left,this.workspace_.scrollY+s.top))}getX(){return 0}getY(){var e,t,i,s;return this.isVisible()?(e=(i=this.targetWorkspace.getMetricsManager()).getAbsoluteMetrics(),t=i.getViewMetrics(),i=i.getToolboxMetrics(),s=this.toolboxPosition_===T.TOP,this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?s?i.height:t.height-this.getHeight():s?0:t.height:s?0:t.height+e.top-this.getHeight()):0}position(){var e,t;this.isVisible()&&this.targetWorkspace.isVisible()&&(e=this.targetWorkspace.getMetricsManager().getViewMetrics(),this.width_=e.width,e=e.width-2*this.CORNER_RADIUS,t=this.getHeight()-this.CORNER_RADIUS,this.setBackgroundPath(e,t),e=this.getX(),t=this.getY(),this.positionAt_(this.getWidth(),this.getHeight(),e,t))}setBackgroundPath(e,t){var i=this.toolboxPosition_===T.TOP,s=["M 0,"+(i?0:this.CORNER_RADIUS)];i?(s.push("h",e+2*this.CORNER_RADIUS),s.push("v",t),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("h",-e),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),s.push("h",e),s.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),s.push("v",t),s.push("h",-e-2*this.CORNER_RADIUS)),s.push("z"),this.svgBackground_.setAttribute("d",s.join(" "))}scrollToStart(){var e;null!=(e=this.workspace_.scrollbar)&&e.setX(this.RTL?1/0:0)}wheel_(e){var t,i,s=Sr(e);(s=s.x||s.y)&&(t=(i=this.workspace_.getMetricsManager()).getScrollMetrics(),s=i.getViewMetrics().left-t.left+s,null!=(i=this.workspace_.scrollbar)&&i.setX(s),us(this.workspace_),ki()),e.preventDefault(),e.stopPropagation()}layout_(e){this.workspace_.scale=this.targetWorkspace.scale;var t,i=this.MARGIN;let s=i+this.tabWidth_;for(t of e=this.RTL?e.reverse():e)e=t.getElement().getBoundingRectangle(),e=this.RTL?s+e.getWidth():s,t.getElement().moveBy(e,i),s+=t.getElement().getBoundingRectangle().getWidth()}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;var t=this.dragAngleRange_;return e<90+t&&90-t<e||-90-t<e&&e<-90+t}getClientRect(){var e,t;return this.svgGroup_&&!this.autoClose&&this.isVisible()?(t=(e=this.svgGroup_.getBoundingClientRect()).top,this.toolboxPosition_===T.TOP?new I(-1e9,t+e.height,-1e9,1e9):new I(t,1e9,-1e9,1e9)):null}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();var e=this.getContents().reduce((e,t)=>Math.max(e,t.getElement().getBoundingRectangle().getHeight()),0),e=(e=(e+=1.5*this.MARGIN)*this.workspace_.scale)+sa.scrollbarThickness;this.getHeight()!==e&&(this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==T.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets())}}),gp=(o(b.FLYOUTS_HORIZONTAL_TOOLBOX,Ur,pp),class extends Lu{constructor(e,t,i,s,o){super(A.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=gp.dropdownCreate,this.defaultVariableName="string"==typeof e?e:"",this.size_=new C(0,0),e!==A.SKIP_SETUP&&(o?this.configure_(o):this.setTypes(i,s),t)&&this.setValidator(t)}configure_(e){super.configure_(e),this.setTypes(e.variableTypes,e.defaultType)}initModel(){var e=this.getSourceBlock();if(!e)throw new qc;this.variable||(e=_.getOrCreateVariablePackage$$module$build$src$core$variables(e.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(e.getId()))}initView(){super.initView(),c(this.fieldGroup_,"blocklyVariableField")}shouldAddBorderRect_(){var e=this.getSourceBlock();if(e)return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||"variables_get"!==e.type);throw new qc}fromXml(e){if(!(o=this.getSourceBlock()))throw new qc;var t=e.getAttribute("id"),i=e.textContent,s=e.getAttribute("variabletype")||e.getAttribute("variableType")||"",o=_.getOrCreateVariablePackage$$module$build$src$core$variables(o.workspace,t,i,s);if(null!==s&&s!==o.getType())throw Error("Serialized variable type with id '"+o.getId()+"' had type "+o.getType()+", and does not match variable field that references it: "+Ms(e)+".");this.setValue(o.getId())}toXml(e){return this.initModel(),e.id=this.variable.getId(),e.textContent=this.variable.getName(),this.variable.getType()&&e.setAttribute("variabletype",this.variable.getType()),e}saveState(e){var t=this.saveLegacyState(gp);return null===t&&(this.initModel(),t={id:this.variable.getId()},e)&&(t.name=this.variable.getName(),t.type=this.variable.getType()),t}loadState(e){var t=this.getSourceBlock();if(!t)throw new qc;this.loadLegacyState(gp,e)||(e=_.getOrCreateVariablePackage$$module$build$src$core$variables(t.workspace,e.id||null,e.name,e.type||""),this.setValue(e.getId()))}setSourceBlock(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(e)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.getName():""}getVariable(){return this.variable}getDefaultType(){return this.defaultType}getValidator(){return this.variable?this.validator_:null}doClassValidation_(e){if(null===e)return null;var t=this.getSourceBlock();if(t)return(t=_.getVariable$$module$build$src$core$variables(t.workspace,e))?(t=t.getType(),this.typeIsAllowed(t)?e:(console.warn("Variable type doesn't match this field!  Type was "+t),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null);throw new qc}doValueUpdate_(e){var t=this.getSourceBlock();if(!t)throw new qc;this.variable=_.getVariable$$module$build$src$core$variables(t.workspace,e),super.doValueUpdate_(e)}typeIsAllowed(t){var i=this.getVariableTypes();if(!i)return!0;for(let e=0;e<i.length;e++)if(t===i[e])return!0;return!1}getVariableTypes(){if(this.variableTypes)return this.variableTypes;if(!this.sourceBlock_||this.sourceBlock_.isDeadOrDying())return[""];let e=this.sourceBlock_.workspace.getVariableMap().getTypes();if(this.sourceBlock_.isInFlyout){var t=this.sourceBlock_.workspace.getPotentialVariableMap();if(!t)return e;e=Array.from(new Set([...e,...t.getTypes()]))}return e}setTypes(t=null,i=""){var s=this.getText();if(Array.isArray(t)){if(0===t.length)throw Error(`'variableTypes' of field variable ${s} was an empty list. If you want to include all variable types, pass 'null' instead.`);s=!1;for(let e=0;e<t.length;e++)t[e]===i&&(s=!0);if(!s)throw Error("Invalid default type '"+i+"' in the definition of a FieldVariable")}else if(null!==t)throw Error("'variableTypes' was not an array or null in the definition of FieldVariable "+s);this.defaultType=i,this.variableTypes=t}refreshVariableName(){this.forceRerender()}onItemSelected_(e,t){if(e=t.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if(e===qu&&this.variable)return void _.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);if(e===Zu&&this.variable)return e=this.variable.getWorkspace(),void _.deleteVariable$$module$build$src$core$variables(e,this.variable,this.sourceBlock_)}this.setValue(e)}referencesVariables(){return!0}static fromJson(e){return new this(ss(e.variable),void 0,void 0,void 0,e)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");var e=this.getText();let t=[];if((i=this.getSourceBlock())&&!i.isDeadOrDying()){var i=i.workspace,s=this.getVariableTypes();for(let e=0;e<s.length;e++){var o,n,r=s[e],l=i.getVariableMap().getVariablesOfType(r);t=t.concat(l),i.isFlyout&&(n=o=void 0,t=t.concat(null!=(n=null==(o=i.getPotentialVariableMap())?void 0:o.getVariablesOfType(r))?n:[]))}}for(t.sort(Lt),o=[],n=0;n<t.length;n++)o[n]=[t[n].getName(),t[n].getId()];return o.push([_.Msg$$module$build$src$core$msg.RENAME_VARIABLE,qu]),_.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&o.push([_.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",e),Zu]),o}}),Xu=(qh("field_variable",gp),class extends tp{constructor(e,t,i,s,o,n){super(A.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,e!==A.SKIP_SETUP&&(n?this.configure_(n):this.setConstraints(t,i,s),this.setValue(e),o)&&this.setValidator(o)}configure_(e){super.configure_(e),this.setMinInternal(e.min),this.setMaxInternal(e.max),this.setPrecisionInternal(e.precision)}setConstraints(e,t,i){this.setMinInternal(e),this.setMaxInternal(t),this.setPrecisionInternal(i),this.setValue(this.getValue())}setMin(e){this.setMinInternal(e),this.setValue(this.getValue())}setMinInternal(e){null==e?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}getMin(){return this.min_}setMax(e){this.setMaxInternal(e),this.setValue(this.getValue())}setMaxInternal(e){null==e?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}getMax(){return this.max_}setPrecision(e){this.setPrecisionInternal(e),this.setValue(this.getValue())}setPrecisionInternal(e){this.precision_=Number(e)||0;let t=String(this.precision_);var i=(t=t.includes("e")?this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}):t).indexOf(".");this.decimalPlaces=-1===i?e?0:null:t.length-i-1}getPrecision(){return this.precision_}doClassValidation_(e){return null===e||(e=(e=(e=(""+e).replace(/O/gi,"0")).replace(/,/g,"")).replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e))?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),null!==this.decimalPlaces?Number(e.toFixed(this.decimalPlaces)):e)}widgetCreate_(){var e=super.widgetCreate_();return this.min_>-1/0&&(e.min=""+this.min_,Ze(e,sl.VALUEMIN,this.min_)),this.max_<1/0&&(e.max=""+this.max_,Ze(e,sl.VALUEMAX,this.max_)),e}initView(){super.initView(),this.fieldGroup_&&c(this.fieldGroup_,"blocklyNumberField")}static fromJson(e){return new this(e.value,void 0,void 0,void 0,void 0,e)}}),Vu=(qh("field_number",Xu),Xu.prototype.DEFAULT_VALUE=0,class extends Ku{constructor(e,t,i){super(String(null!=e?e:""),t,i),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(e){return new this(ss(e.text),void 0,e)}}),mp=(qh("field_label_serializable",Vu),class extends A{constructor(e,t,i){super(A.SKIP_SETUP),this.SERIALIZABLE=!0,this.value_=this.value_,this.checkChar=mp.CHECK_CHAR,e!==A.SKIP_SETUP&&(i&&this.configure_(i),this.setValue(e),t)&&this.setValidator(t)}configure_(e){super.configure_(e),e.checkCharacter&&(this.checkChar=e.checkCharacter)}saveState(){var e=this.saveLegacyState(mp);return null!==e?e:this.getValueBoolean()}initView(){super.initView();var e=this.getTextElement();c(this.fieldGroup_,"blocklyCheckboxField"),e.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(e){this.checkChar=e||mp.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(e){return!0===e||"TRUE"===e?"TRUE":!1===e||"FALSE"===e?"FALSE":null}doValueUpdate_(e){this.value_=this.convertValueToBool(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool(this.value_))}convertValueToBool(e){return"string"==typeof e?"TRUE"===e:!!e}static fromJson(e){return new this(e.checked,void 0,e)}}),M=(mp.CHECK_CHAR="âœ“",qh("field_checkbox",mp),mp.prototype.DEFAULT_VALUE=!1,class{constructor(e,t){this.draggable=e,this.workspace=t,this.dragTarget=null,this.startLoc=e.getRelativeToSurfaceXY()}onDragStart(e){_.getGroup$$module$build$src$core$events$utils()||_.setGroup$$module$build$src$core$events$utils(!0),this.draggable.startDrag(e)}onDrag(e,t){this.moveDraggable(e,t),t=this.getRoot(this.draggable),$o(t)&&t.setDeleteStyle(this.wouldDeleteDraggable(e,t)),this.updateDragTarget(e)}updateDragTarget(e){e=this.workspace.getDragTarget(e);var t,i=this.getRoot(this.draggable);this.dragTarget!==e&&(null!=(t=this.dragTarget)&&t.onDragExit(i),null!=e)&&e.onDragEnter(i),null!=e&&e.onDragOver(i),this.dragTarget=e}moveDraggable(e,t){t=this.pixelsToWorkspaceUnits(t),t=y.sum(this.startLoc,t),this.draggable.drag(t,e)}wouldDeleteDraggable(e,t){return!(!(e=this.workspace.getDragTarget(e))||!this.workspace.getComponentManager().hasCapability(e.id,Kl.Capability.DELETE_AREA))&&e.wouldDelete(t)}onDragEnd(e){var t,i=_.getGroup$$module$build$src$core$events$utils(),s=this.workspace.getDragTarget(e),o=this.getRoot(this.draggable);s&&null!=(t=this.dragTarget)&&t.onDrop(o),this.shouldReturnToStart(e,o)&&this.draggable.revertDrag(),(s=$o(o)&&this.wouldDeleteDraggable(e,o))&&this.draggable instanceof N&&Eo(this.draggable.getRootBlock()),this.draggable.endDrag(e),s&&$o(o)&&(_.setGroup$$module$build$src$core$events$utils(i),o.dispose()),_.setGroup$$module$build$src$core$events$utils(!1),!s&&Q(this.draggable)&&_.getFocusManager$$module$build$src$core$focus_manager().focusNode(this.draggable)}getRoot(e){return e instanceof N?e.getRootBlock():e}shouldReturnToStart(e,t){return!!(e=this.workspace.getDragTarget(e))&&e.shouldPreventMove(t)}pixelsToWorkspaceUnits(e){return e=new y(e.x/this.workspace.scale,e.y/this.workspace.scale),this.workspace.isMutator&&e.scale(1/this.workspace.options.parentWorkspace.scale),e}}),Yl=(o(b.BLOCK_DRAGGER,Ur,M),{}),_p=(Yl.BlockDragStrategy=uh,Yl.BubbleDragStrategy=Pu,Yl.CommentDragStrategy=du,Yl.Dragger=M,class extends zl{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type=f.BLOCK_DRAG,e&&(this.blockId=e.id,this.isStart=t,this.blocks=i)}toJson(){var e=super.toJson();if(void 0===this.isStart)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(void 0===this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new _p)).isStart=e.isStart,t.blockId=e.blockId,t.blocks=e.blocks,t}}),bp=(o(b.EVENT,f.BLOCK_DRAG,_p),class extends hc{constructor(e,t,i,s){super(e),this.type=f.BLOCK_FIELD_INTERMEDIATE_CHANGE,this.recordUndo=!1,e&&(this.name=t,this.oldValue=i,this.newValue=s)}toJson(){var e=super.toJson();if(this.name)return e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e;throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new bp)).name=e.name,t.oldValue=e.oldValue,t.newValue=e.newValue,t}isNull(){return this.oldValue===this.newValue}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(!(t=t.getBlockById(this.blockId)))throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");e=e?this.newValue:this.oldValue,(t=t.getField(this.name))?t.setValue(e):console.warn("Can't set non-existent field: "+this.name)}}),fp=(o(b.EVENT,f.BLOCK_FIELD_INTERMEDIATE_CHANGE,bp),class extends hc{constructor(e){super(e),this.type=f.BLOCK_MOVE,e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)}toJson(){var e=super.toJson();return e.oldParentId=this.oldParentId,e.oldInputName=this.oldInputName,this.oldCoordinate&&(e.oldCoordinate=Math.round(this.oldCoordinate.x)+", "+Math.round(this.oldCoordinate.y)),e.newParentId=this.newParentId,e.newInputName=this.newInputName,this.newCoordinate&&(e.newCoordinate=Math.round(this.newCoordinate.x)+", "+Math.round(this.newCoordinate.y)),this.reason&&(e.reason=this.reason),this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new fp)).oldParentId=e.oldParentId,t.oldInputName=e.oldInputName,e.oldCoordinate&&(i=e.oldCoordinate.split(","),t.oldCoordinate=new y(Number(i[0]),Number(i[1]))),t.newParentId=e.newParentId,t.newInputName=e.newInputName,e.newCoordinate&&(i=e.newCoordinate.split(","),t.newCoordinate=new y(Number(i[0]),Number(i[1]))),void 0!==e.reason&&(t.reason=e.reason),void 0!==e.recordUndo&&(t.recordUndo=e.recordUndo),t}recordNew(){var e=this.currentLocation();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate}setReason(e){this.reason=e}currentLocation(){var e=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var t,i=e.getBlockById(this.blockId);if(i)return e={},(t=i.getParent())?(e.parentId=t.id,(i=t.getInputWithBlock(i))&&(e.inputName=i.name)):e.coordinate=i.getRelativeToSurfaceXY(),e;throw Error("The block associated with the block move event could not be found")}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&y.equals(this.oldCoordinate,this.newCoordinate)}run(e){var t=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var i=t.getBlockById(this.blockId);if(i){var s=e?this.newParentId:this.oldParentId,o=e?this.newInputName:this.oldInputName;if(e=e?this.newCoordinate:this.oldCoordinate,s){var n=t.getBlockById(s);if(!n)return void console.warn("Can't connect to non-existent block: "+s)}if(i.getParent()&&i.unplug(),e)o=i.getRelativeToSurfaceXY(),i.moveBy(e.x-o.x,e.y-o.y,this.reason);else{let e;i=null==(t=!(t=i.outputConnection)||i.previousConnection&&i.previousConnection.isConnected()?i.previousConnection:t)?void 0:t.type,o?(i=n.getInput(o))&&(e=i.connection):i===E.PREVIOUS_STATEMENT&&(e=n.nextConnection),e&&t?t.connect(e):console.warn("Can't connect to non-existent input: "+o)}}else console.warn("Can't move non-existent block: "+this.blockId)}}),Tp=(o(b.EVENT,f.BLOCK_MOVE,fp),class extends zl{constructor(e,t,i){super(e?e.workspace.id:void 0),this.type=f.BUBBLE_OPEN,e&&(this.blockId=e.id,this.isOpen=t,this.bubbleType=i)}toJson(){var e=super.toJson();if(void 0===this.isOpen)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(this.bubbleType)return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId||"",e;throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Tp)).isOpen=e.isOpen,t.bubbleType=e.bubbleType,t.blockId=e.blockId,t}}),Ep=((S=Vp=Vp||{}).MUTATOR="mutator",S.COMMENT="comment",S.WARNING="warning",o(b.EVENT,f.BUBBLE_OPEN,Tp),class extends Wl{constructor(e){super(),this.isBlank=!e,e&&(this.commentId=e.id,this.workspaceId=e.workspace.id,this.group=_.getGroup$$module$build$src$core$events$utils(),this.recordUndo=Cl)}toJson(){var e=super.toJson();if(this.commentId)return e.commentId=this.commentId,e;throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ep)).commentId=e.commentId,t}static CommentCreateDeleteHelper(e,t){var i=e.getEventWorkspace_();if(t){if(!e.json)throw Error("Encountered a comment event without proper json");Xe(e.json,i)}else{if(!e.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=i.getCommentById(e.commentId))?t.dispose():console.warn("Can't delete non-existent comment: "+e.commentId)}}}),vp=class extends Ep{constructor(e,t,i){super(e),this.type=f.COMMENT_CHANGE,e&&(this.oldContents_=void 0===t?"":t,this.newContents_=void 0===i?"":i)}toJson(){var e=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(this.newContents_)return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e;throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new vp)).oldContents_=e.oldContents,t.newContents_=e.newContents,t}isNull(){return this.oldContents_===this.newContents_}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){var i=e?this.newContents_:this.oldContents_;if(void 0===i){if(e)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson")}t.setText(i)}else console.warn("Can't change non-existent comment: "+this.commentId)}},yp=(o(b.EVENT,f.COMMENT_CHANGE,vp),class extends Ep{constructor(e,t){super(e),this.newCollapsed=t,this.type=f.COMMENT_COLLAPSE}toJson(){var e=super.toJson();if(void 0===this.newCollapsed)throw Error("The new collapse value undefined. Either call recordNew, or call fromJson");return e.newCollapsed=this.newCollapsed,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new yp)).newCollapsed=e.newCollapsed,t}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(t=t.getCommentById(this.commentId))?t.setCollapsed(e?!!this.newCollapsed:!this.newCollapsed):console.warn("Can't collapse or uncollapse non-existent comment: "+this.commentId)}}),kp=(o(b.EVENT,f.COMMENT_COLLAPSE,yp),class extends Ep{constructor(e){super(e),this.type=f.COMMENT_CREATE,e&&(this.xml=As(e),this.json=Ye(e,{addCoordinates:!0}))}toJson(){var e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(this.json)return e.xml=Ms(this.xml),e.json=this.json,e;throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new kp)).xml=_.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}run(e){Ep.CommentCreateDeleteHelper(this,e)}}),Ip=(o(b.EVENT,f.COMMENT_CREATE,kp),class extends Ep{constructor(e){super(e),this.type=f.COMMENT_DELETE,e&&(this.xml=As(e),this.json=Ye(e,{addCoordinates:!0}))}run(e){Ep.CommentCreateDeleteHelper(this,!e)}toJson(){var e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(this.json)return e.xml=Ms(this.xml),e.json=this.json,e;throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ip)).xml=_.textToDom$$module$build$src$core$utils$xml(e.xml),t.json=e.json,t}}),Cp=(o(b.EVENT,f.COMMENT_DELETE,Ip),class extends zl{constructor(e,t){super(e?e.workspace.id:void 0),this.type=f.COMMENT_DRAG,e&&(this.commentId=e.id,this.isStart=t)}toJson(){var e=super.toJson();if(void 0===this.isStart)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(void 0===this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.isStart=this.isStart,e.commentId=this.commentId,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Cp)).isStart=e.isStart,t.commentId=e.commentId,t}}),Sp=(o(b.EVENT,f.COMMENT_DRAG,Cp),class extends Ep{constructor(e){super(e),this.type=f.COMMENT_MOVE,e&&(this.comment_=e,this.oldCoordinate_=e.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setReason(e){this.reason=e}setOldCoordinate(e){this.oldCoordinate_=e}toJson(){var e=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(this.newCoordinate_)return e.oldCoordinate=Math.round(this.oldCoordinate_.x)+", "+Math.round(this.oldCoordinate_.y),e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),e;throw Error("The new comment position is undefined. Either call recordNew, or call fromJson")}static fromJson(e,t,i){return t=super.fromJson(e,t,null!=i?i:new Sp),i=e.oldCoordinate.split(","),t.oldCoordinate_=new y(Number(i[0]),Number(i[1])),i=e.newCoordinate.split(","),t.newCoordinate_=new y(Number(i[0]),Number(i[1])),t}isNull(){return y.equals(this.oldCoordinate_,this.newCoordinate_)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(!(e=e?this.newCoordinate_:this.oldCoordinate_))throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");t.moveTo(e)}else console.warn("Can't move non-existent comment: "+this.commentId)}}),wp=(o(b.EVENT,f.COMMENT_MOVE,Sp),class extends Ep{constructor(e){super(e),this.type=f.COMMENT_RESIZE,e&&(this.oldSize=e.getSize())}recordCurrentSizeAsNewSize(){if(this.newSize)throw Error("Tried to record the new size of a comment on the same event twice.");var e=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(!(e=e.getCommentById(this.commentId)))throw Error("The comment associated with the comment resize event could not be found");this.newSize=e.getSize()}toJson(){var e=super.toJson();if(!this.oldSize)throw Error("The old comment size is undefined. Either pass a comment to the constructor, or call fromJson");if(this.newSize)return e.oldWidth=Math.round(this.oldSize.width),e.oldHeight=Math.round(this.oldSize.height),e.newWidth=Math.round(this.newSize.width),e.newHeight=Math.round(this.newSize.height),e;throw Error("The new comment size is undefined. Either call recordCurrentSizeAsNewSize, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new wp)).oldSize=new C(e.oldWidth,e.oldHeight),t.newSize=new C(e.newWidth,e.newHeight),t}isNull(){return C.equals(this.oldSize,this.newSize)}run(e){var t=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(t=t.getCommentById(this.commentId)){if(!(e=e?this.newSize:this.oldSize))throw Error("Either oldSize or newSize is undefined. Either pass a comment to the constructor and call recordCurrentSizeAsNewSize, or call fromJson");t.setSize(e)}else console.warn("Can't resize non-existent comment: "+this.commentId)}}),Ap=(o(b.EVENT,f.COMMENT_RESIZE,wp),class extends zl{constructor(e,t,i){super(i),this.type=f.TOOLBOX_ITEM_SELECT,this.oldItem=null!=e?e:void 0,this.newItem=null!=t?t:void 0}toJson(){var e=super.toJson();return e.oldItem=this.oldItem,e.newItem=this.newItem,e}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new Ap)).oldItem=e.oldItem,t.newItem=e.newItem,t}}),xp=(o(b.EVENT,f.TOOLBOX_ITEM_SELECT,Ap),class extends Ad{constructor(e,t,i){super(e),this.oldType=t,this.newType=i,this.type=f.VAR_TYPE_CHANGE}toJson(){var e=super.toJson();if(this.oldType&&this.newType)return e.oldType=this.oldType,e.newType=this.newType,e;throw Error("The variable's types are undefined. Either pass them to the constructor, or call fromJson")}static fromJson(e,t,i){return(t=super.fromJson(e,t,null!=i?i:new xp)).oldType=e.oldType,t.newType=e.newType,t}run(e){var t=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldType||!this.newType)throw Error("The variable's types are undefined. Either pass them to the constructor, or call fromJson");var i=t.getVariableMap().getVariableById(this.varId);i&&(e?t.getVariableMap().changeVariableType(i,this.newType):t.getVariableMap().changeVariableType(i,this.oldType))}}),Rp=(o(b.EVENT,f.VAR_TYPE_CHANGE,xp),class extends Wl{constructor(e){super(),this.isBlank=!0,this.recordUndo=!1,this.type=f.FINISHED_LOADING,this.isBlank=!!e,e&&(this.workspaceId=e.id)}}),S=(o(b.EVENT,f.FINISHED_LOADING,Rp),_.BLOCK_CHANGE$$module$build$src$core$events$events=f.BLOCK_CHANGE,_.BLOCK_CREATE$$module$build$src$core$events$events=f.BLOCK_CREATE,_.BLOCK_DELETE$$module$build$src$core$events$events=f.BLOCK_DELETE,Np=f.BLOCK_DRAG,_.BLOCK_MOVE$$module$build$src$core$events$events=f.BLOCK_MOVE,$p=f.BLOCK_FIELD_INTERMEDIATE_CHANGE,Lp=f.BUBBLE_OPEN,t=f.BLOCK_CHANGE,zp=f.CLICK,jp=f.COMMENT_CHANGE,Yp=f.COMMENT_CREATE,ac=f.COMMENT_DELETE,qp=f.COMMENT_MOVE,Zp=f.COMMENT_RESIZE,zu=f.COMMENT_DRAG,Qp=f.BLOCK_CREATE,tg=f.BLOCK_DELETE,cc=f.FINISHED_LOADING,lc=f.BLOCK_MOVE,Vr=f.SELECTED,i=f.THEME_CHANGE,fa=f.TOOLBOX_ITEM_SELECT,ga=f.TRASHCAN_OPEN,Ta=f.UI,_l=f.VAR_CREATE,Jh=f.VAR_DELETE,L=f.VAR_RENAME,qh=f.VIEWPORT_CHANGE,(M={}).Abstract=Wl,M.BLOCK_CHANGE=_.BLOCK_CHANGE$$module$build$src$core$events$events,M.BLOCK_CREATE=_.BLOCK_CREATE$$module$build$src$core$events$events,M.BLOCK_DELETE=_.BLOCK_DELETE$$module$build$src$core$events$events,M.BLOCK_DRAG=Np,M.BLOCK_FIELD_INTERMEDIATE_CHANGE=$p,M.BLOCK_MOVE=_.BLOCK_MOVE$$module$build$src$core$events$events,M.BUBBLE_OPEN=Lp,M.BUMP_EVENTS=El,M.BlockBase=hc,M.BlockChange=dc,M.BlockCreate=Cu,M.BlockDelete=Ou,M.BlockDrag=_p,M.BlockFieldIntermediateChange=bp,M.BlockMove=fp,M.BubbleOpen=Tp,M.BubbleType=Vp,M.CHANGE=t,M.CLICK=zp,M.COMMENT_CHANGE=jp,M.COMMENT_CREATE=Yp,M.COMMENT_DELETE=ac,M.COMMENT_DRAG=zu,M.COMMENT_MOVE=qp,M.COMMENT_RESIZE=Zp,M.CREATE=Qp,M.Click=jl,M.ClickTarget=eg,M.CommentBase=Ep,M.CommentChange=vp,M.CommentCollapse=yp,M.CommentCreate=kp,M.CommentDelete=Ip,M.CommentDrag=Cp,M.CommentMove=Sp,M.CommentResize=wp,M.DELETE=tg,M.FINISHED_LOADING=cc,M.FinishedLoading=Rp,M.MOVE=lc,M.SELECTED=Vr,M.Selected=Ru,M.THEME_CHANGE=i,M.TOOLBOX_ITEM_SELECT=fa,M.TRASHCAN_OPEN=ga,M.ThemeChange=wu,M.ToolboxItemSelect=Ap,M.TrashcanOpen=Nd,M.UI=Ta,M.UiBase=zl,M.VAR_CREATE=_l,M.VAR_DELETE=Jh,M.VAR_RENAME=L,M.VIEWPORT_CHANGE=qh,M.VarBase=Ad,M.VarCreate=xd,M.VarDelete=Rd,M.VarRename=Od,M.VarTypeChange=xp,M.ViewportChange=Au,M.clearPendingUndo=F,M.disable=_.disable$$module$build$src$core$events$utils,M.disableOrphans=V,M.enable=_.enable$$module$build$src$core$events$utils,M.filter=P,M.fire=g,M.fromJson=G,M.get=m,M.getDescendantIds=H,M.getGroup=_.getGroup$$module$build$src$core$events$utils,M.getRecordUndo=ur,M.isEnabled=U,M.setGroup=_.setGroup$$module$build$src$core$events$utils,M.setRecordUndo=_.setRecordUndo$$module$build$src$core$events$utils,{}),Wl=(S.BottomRow=ip,S.ConstantProvider=Zd,S.Drawer=Qd,S.PathObject=lp,S.RenderInfo=rp,S.Renderer=ap,S.RightConnectionShape=op,S.StatementInput=sp,S.TopRow=np,sr(),{}),Op=(Wl.registerCleanup=Mn,Wl.registerCollapse=Bn,Wl.registerCollapseExpandBlock=Yn,Wl.registerComment=zn,Wl.registerCommentCreate=Qn,Wl.registerCommentDelete=qn,Wl.registerCommentDuplicate=Zn,Wl.registerCommentOptions=ir,Wl.registerDefaultOptions=sr,Wl.registerDelete=Kn,Wl.registerDeleteAll=Gn,Wl.registerDisable=Xn,Wl.registerDuplicate=Wn,Wl.registerExpand=Pn,Wl.registerHelp=Jn,Wl.registerInline=jn,Wl.registerRedo=Ln,Wl.registerUndo=$n,"button"),Np=class{load(e,t){return(e=new fh(t.getWorkspace(),t.targetWorkspace,e,!1)).show(),new mh(e,Op)}gapForItem(e,t){return t}disposeItem(e){(e=e.getElement())instanceof fh&&e.dispose()}getType(){return Op}},$p=(o(b.FLYOUT_INFLATER,Op,Np),{}),Lp=($p.Bubble=R,$p.MiniWorkspaceBubble=Uu,$p.TextBubble=hh,$p.TextInputBubble=zh,class{constructor(){this.permanentlyDisabledBlocks=new Set,this.listeners=new Map,this.capacityWrapper=this.filterFlyoutBasedOnCapacity.bind(this)}load(e,t){return this.setFlyout(t),(e=this.createBlock(e,t.getWorkspace())).isEnabled()?this.updateStateBasedOnCapacity(e):this.permanentlyDisabledBlocks.add(e),e.getDescendants(!1).forEach(e=>e.isInFlyout=!0),this.addBlockListeners(e),new mh(e,"block")}createBlock(e,t){return t=(e.blockxml?(e="string"==typeof e.blockxml?_.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,Bs):(void 0===e.enabled&&(e.enabled="true"!==e.disabled&&!0!==e.disabled),void 0===e.disabledReasons&&!1===e.enabled&&(e.disabledReasons=[Aa]),"x"in e&&delete e.x,"y"in e&&delete e.y,jt))(e,t)}gapForItem(e,t){let i;return e.gap?i=parseInt(String(e.gap)):e.blockxml&&(e="string"==typeof e.blockxml?_.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,i=parseInt(e.getAttribute("gap"))),!i||isNaN(i)?t:i}disposeItem(e){(e=e.getElement())instanceof N&&(this.removeListeners(e.id),e.dispose(!1,!1))}removeListeners(e){var t;(null!=(t=this.listeners.get(e))?t:[]).forEach(e=>n(e)),this.listeners.delete(e)}setFlyout(e){var t;this.flyout!==e&&(this.flyout&&null!=(t=this.flyout.targetWorkspace)&&t.removeChangeListener(this.capacityWrapper),this.flyout=e,null!=(t=this.flyout.targetWorkspace))&&t.addChangeListener(this.capacityWrapper)}updateStateBasedOnCapacity(e){for(var t,i=null==(t=this.flyout)||null==(t=t.targetWorkspace)?void 0:t.isCapacityAvailable(de(e));e;)e.setDisabledReason(!i,"WORKSPACE_AT_BLOCK_CAPACITY"),e=e.getNextBlock()}addBlockListeners(i){var e=[];e.push(p(i.getSvgRoot(),"pointerdown",i,e=>{var t=null==(t=this.flyout)||null==(t=t.targetWorkspace)?void 0:t.getGesture(e);t&&this.flyout&&(t.setStartBlock(i),t.handleFlyoutStart(e,this.flyout))})),e.push(yr(i.getSvgRoot(),"pointermove",null,()=>{var e;null!=(e=this.flyout)&&null!=(e=e.targetWorkspace)&&e.isDragging()||i.addSelect()})),e.push(yr(i.getSvgRoot(),"pointerleave",null,()=>{var e;null!=(e=this.flyout)&&null!=(e=e.targetWorkspace)&&e.isDragging()||i.removeSelect()})),this.listeners.set(i.id,e)}filterFlyoutBasedOnCapacity(e){!this.flyout||e&&e.type!==f.BLOCK_CREATE&&e.type!==f.BLOCK_DELETE||this.flyout.getWorkspace().getTopBlocks(!1).forEach(e=>{this.permanentlyDisabledBlocks.has(e)||this.updateStateBasedOnCapacity(e)})}getType(){return"block"}}),Mp=(o(b.FLYOUT_INFLATER,"block",Lp),class extends fd{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(e){return super.getCSS_(e).concat([e+" .blocklyInsertionMarker>.blocklyPathLight,",e+" .blocklyInsertionMarker>.blocklyPathDark {",`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}}),Dp=class{constructor(e){this.inlineSteps_=this.steps_="",this.info_=e,this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+"\n"+this.inlineSteps_}drawTopCorner(i){this.steps_+=uo(i.xPos,this.info_.startY);for(let e=0,t;t=i.elements[e];e++)$.isLeftSquareCorner(t)?this.steps_+=this.highlightConstants_.START_POINT:$.isLeftRoundedCorner(t)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):$.isPreviousConnection(t)?this.steps_+=this.notchPaths_.pathLeft:$.isHat(t)?this.steps_+=this.startPaths_.path(this.RTL_):$.isSpacer(t)&&0!==t.width&&(this.steps_+=h("H",t.xPos+t.width-this.highlightOffset));this.steps_+=h("H",i.xPos+i.width-this.highlightOffset)}drawJaggedEdge_(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+h("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(e){var t,i=e.getLastInput();this.RTL_?(t=e.height-i.connectionHeight,this.steps_+=co(i.xPos+i.width-this.highlightOffset,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+h("v",t)):this.steps_+=co(i.xPos+i.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(e){var t,i=e.getLastInput();i&&(this.RTL_?(t=e.height-2*this.insideCornerPaths_.height,this.steps_+=co(i.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+h("v",t)+this.insideCornerPaths_.pathBottom(this.RTL_)+ho(e.width-i.xPos-this.insideCornerPaths_.width,0)):this.steps_+=co(i.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+ho(e.width-i.xPos-this.insideCornerPaths_.width,0))}drawRightSideRow(e){var t=e.xPos+e.width-this.highlightOffset;e instanceof gd&&e.followsStatement&&(this.steps_+=h("H",t)),this.RTL_&&(this.steps_+=h("H",t),e.height>this.highlightOffset)&&(this.steps_+=h("V",e.yPos+e.height-this.highlightOffset))}drawBottomRow(e){var t;this.RTL_?this.steps_+=h("V",e.baseline-this.highlightOffset):(t=this.info_.bottomRow.elements[0],$.isLeftSquareCorner(t)?this.steps_+=co(e.xPos+this.highlightOffset,e.baseline-this.highlightOffset):$.isLeftRoundedCorner(t)&&(this.steps_+=co(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft()))}drawLeft(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=co(this.info_.startX,e):(this.steps_+=co(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=h("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,$.isLeftRoundedCorner(e.elements[0])?this.steps_+=h("V",this.outsideCornerPaths_.height):this.steps_+=h("V",e.capline+this.highlightOffset))}drawInlineInput(e){var t=this.highlightOffset,i=e.xPos+e.connectionWidth,s=e.centerline-e.height/2,o=e.width-e.connectionWidth,n=s+t;this.RTL_?(s=e.connectionOffsetY-t,e=e.height-(e.connectionOffsetY+e.connectionHeight)+t,this.inlineSteps_+=co(i-t,n)+h("v",s)+this.puzzleTabPaths_.pathDown(this.RTL_)+h("v",e)+h("h",o)):this.inlineSteps_+=co(e.xPos+e.width+t,n)+h("v",e.height)+h("h",-o)+co(i,s+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},Bp=class extends Td{constructor(e,t){super(e,t),this.highlighter_=new Dp(t)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();var e=this.block_.pathObject;e.setPath(this.outlinePath_+"\n"+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(e){this.highlighter_.drawJaggedEdge_(e),super.drawJaggedEdge_(e)}drawValueInput_(e){this.highlighter_.drawValueInput(e),super.drawValueInput_(e)}drawStatementInput_(e){this.highlighter_.drawStatementInput(e),super.drawStatementInput_(e)}drawRightSideRow_(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=h("H",e.xPos+e.width)+h("V",e.yPos+e.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(e){this.highlighter_.drawInlineInput(e),super.drawInlineInput_(e)}positionInlineInputConnection_(t){var i=t.centerline-t.height/2;if(t.connectionModel){let e=t.xPos+t.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(e*=-1),t.connectionModel.setOffsetInBlock(e,i+t.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(e){var t,i=e.getLastInput();null!=i&&i.connectionModel&&(t=e.xPos+e.statementEdge+i.notchOffset,t=this.info_.RTL?-1*t:t+this.constants_.DARK_PATH_OFFSET,i.connectionModel.setOffsetInBlock(t,e.yPos+this.constants_.DARK_PATH_OFFSET))}positionExternalValueConnection_(t){var i=t.getLastInput();if(i&&i.connectionModel){let e=t.xPos+t.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(e*=-1),i.connectionModel.setOffsetInBlock(e,t.yPos)}}positionNextConnection_(){var e,t,i=this.info_.bottomRow;i.connection&&(t=(e=i.connection).xPos,e.connectionModel.setOffsetInBlock((this.info_.RTL?-t:t)+this.constants_.DARK_PATH_OFFSET/2,i.baseline+this.constants_.DARK_PATH_OFFSET))}},Pp=class{constructor(e){this.OFFSET=.5,this.constantProvider=e,this.START_POINT=uo(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){let e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e+t)-t,s=uo(i,i)+go("a","0 0,0",e,u(-i-t,e-i)),o=go("a","0 0,0",e+t,u(e+t,e+t)),n=uo(i,-i)+go("a","0 0,0",e+t,u(e-i,i+t));return{width:e+t,height:e,pathTop(e){return e?s:""},pathBottom(e){return e?o:n}}}makeOutsideCorner(){let e=this.constantProvider.CORNER_RADIUS,t=this.OFFSET,i=(1-Math.SQRT1_2)*(e-t)+t,s=uo(i,i)+go("a","0 0,1",e-t,u(e-i,-i+t)),o=uo(t,e)+go("a","0 0,1",e-t,u(e,-e+t)),n=-i,r=uo(i,n)+go("a","0 0,1",e-t,u(-i+t,-n-e));return{height:e,topLeft(e){return e?s:o},bottomLeft(){return r}}}makePuzzleTab(){let e=this.constantProvider.TAB_WIDTH,t=this.constantProvider.TAB_HEIGHT,i=uo(-2,2.5-t+.9)+ho(-.45*e,-2.1),s=" v 2.5 "+uo(.97*-e,2.5)+ao("q",[u(.05*-e,10),u(.3*e,9.5)])+uo(.67*e,-1.9)+" v 2.5 ",o=" v -1.5 "+uo(-.92*e,-.5)+ao("q",[u(-.19*e,-5.5)," 0,-11 "])+uo(.92*e,1),n=uo(-5,t-.7)+ho(.46*e,-2.1);return{width:e,height:t,pathUp(e){return e?i:o},pathDown(e){return e?s:n}}}makeNotch(){return{pathLeft:h("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:" l 5.1,2.6  m -10.2,6.8  l 5.1,2.6 ",height:12,width:10.2}}makeStartHat(){let e=this.constantProvider.START_HAT.height,t=uo(25,-8.7)+ao("c",[" 29.7,-6.2 "," 57.2,-0.5 "," 75,8.7 "]),i=ao("c",[" 17.8,-9.2 "," 45.3,-14.9 "," 75,-8.7 "])+co(100.5,e+.5);return{path(e){return e?t:i}}}},Fp=class extends ld{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},Up=class extends _d{constructor(e,t){super(e,t),this.constants_=e,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},Hp=class extends Ed{constructor(e,t){super(e,t),this.renderer_=e}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof sh||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(e,t){this.isInline&&e instanceof _.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new Fp(this.constants_,e)),t.hasInlineInput=!0):e instanceof sh?(t.elements.push(new Up(this.constants_,e)),t.hasStatement=!0):e instanceof _.ValueInput$$module$build$src$core$inputs$value_input?(t.elements.push(new id(this.constants_,e)),t.hasExternalInput=!0):(e instanceof th||e instanceof ih)&&(t.minHeight=Math.max(t.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),t.hasDummyInput=!0),this.isInline||null!==t.align||(t.align=e.align)}addElemSpacing_(){let i=!1;for(let e=0,t;t=this.rows[e];e++)t.hasExternalInput&&(i=!0);for(let e=0,t;t=this.rows[e];e++){var s=t.elements;if(t.elements=[],t.startsWithElemSpacer()&&t.elements.push(new rd(this.constants_,this.getInRowSpacing_(null,s[0]))),s.length){for(let e=0;e<s.length-1;e++){t.elements.push(s[e]);var o=this.getInRowSpacing_(s[e],s[e+1]);t.elements.push(new rd(this.constants_,o))}t.elements.push(s[s.length-1]),t.endsWithElemSpacer()&&(s=this.getInRowSpacing_(s[s.length-1],null),i&&t.hasDummyInput&&(s+=this.constants_.TAB_WIDTH),t.elements.push(new rd(this.constants_,s)))}}}getInRowSpacing_(e,t){if(!e)return t&&$.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&$.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&$.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!$.isInput(e)&&(!t||$.isStatementInput(t)))return $.isField(e)&&e.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:$.isIcon(e)?2*this.constants_.LARGE_PADDING+1:$.isHat(e)?this.constants_.NO_PADDING:$.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:$.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:$.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if($.isInput(e)&&!t){if($.isExternalInput(e))return this.constants_.NO_PADDING;if($.isInlineInput(e))return this.constants_.LARGE_PADDING;if($.isStatementInput(e))return this.constants_.NO_PADDING}if(!$.isInput(e)&&t&&$.isInput(t)){if($.isField(e)&&e.isEditable){if($.isInlineInput(t)||$.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if($.isInlineInput(t)||$.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if($.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if($.isIcon(e)&&t&&!$.isInput(t))return this.constants_.LARGE_PADDING;if($.isInlineInput(e)&&t&&$.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if($.isLeftSquareCorner(e)&&t){if($.isHat(t))return this.constants_.NO_PADDING;if($.isPreviousConnection(t))return t.notchOffset;if($.isNextConnection(t))return t.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if($.isLeftRoundedCorner(e)&&t){if($.isPreviousConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS;if($.isNextConnection(t))return t.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return $.isField(e)&&t&&$.isField(t)&&e.isEditable===t.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING:t&&$.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return $.isTopRow(e)&&$.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:$.isTopRow(e)||$.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||!e.hasStatement&&t.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){if($.isSpacer(t))return e.yPos+t.height/2;if($.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,$.isNextConnection(t)?e+t.height/2:e-t.height/2;if($.isTopRow(e))return $.isHat(t)?e.capline-t.height/2:e.capline+t.height/2;let i=e.yPos;return $.isField(t)||$.isIcon(t)?(i+=t.height/2,(e.hasInlineInput||e.hasStatement)&&t.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(i+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):i=$.isInlineInput(t)?i+t.height/2:i+e.height/2,i}alignRowElements_(){if(this.isInline){var i=0,s=new WeakMap,o=null;for(let e=this.rows.length-1,t;t=this.rows[e];e--)s.set(t,i),$.isInputRow(t)&&(t.hasStatement&&this.alignStatementRow_(t),o&&o.hasStatement&&t.width<o.width?s.set(t,o.width):i=t.hasStatement?t.width:Math.max(i,t.width),o=t);for(let e=i=0,t;t=this.rows[e];e++)t.hasStatement?i=this.getDesiredRowWidth_(t):$.isSpacer(t)?t.width=Math.max(i,s.get(t)):(o=t.width,0<(i=Math.max(i,s.get(t))-o)&&this.addAlignmentPadding_(t,i),i=t.width)}else super.alignRowElements_()}getDesiredRowWidth_(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(e)}finalize_(){let i=0,s=0;for(let e=0,t;t=this.rows[e];e++){t.yPos=s,t.xPos=this.startX,s+=t.height,i=Math.max(i,t.widthWithConnectedBlocks);var o=s-this.topRow.ascenderHeight;t===this.bottomRow&&o<this.constants_.MIN_BLOCK_HEIGHT&&(o=this.constants_.MIN_BLOCK_HEIGHT-o,this.bottomRow.height+=o,s+=o),this.recordElemPositions_(t)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(o=this.block_.nextConnection.targetBlock())&&(i=Math.max(i,o.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=s-this.bottomRow.descenderHeight,this.widthWithChildren=i+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=s+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},Gp=class extends vd{constructor(e,t,i){super(e,t,i),this.constants=i,this.colourDark="#000000",this.svgPathDark=a(k.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=a(k.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)}setHighlightPath(e){this.svgPathLight.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(e){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(e),this.svgPath.setAttribute("stroke","none")}setStyle(e){this.style=e,this.colourDark=Qi("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(e){super.updateHighlighted(e),this.svgPathLight.style.display=e?"none":"inline"}updateShadow_(e){if(e){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(e){super.updateDisabled_(e),e&&this.svgPath.setAttribute("stroke","none")}},Vp=class extends Kc{constructor(e){super(e),this.highlightConstants=null}init(e,t){super.init(e,t),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(e,t,i){super.refreshDom(e,t,i),this.getHighlightConstants().init()}makeConstants_(){return new Mp}makeRenderInfo_(e){return new Hp(this,e)}makeDrawer_(e,t){return new Bp(e,t)}makePathObject(e,t){return new Gp(e,t,this.getConstants())}makeHighlightConstants_(){return new Pp(this.getConstants())}getHighlightConstants(){if(this.highlightConstants)return this.highlightConstants;throw Error("Cannot access the highlight constants because init has not been called")}},t=(sn("geras",Vp),{}),Wp=(t.ConstantProvider=Mp,t.Drawer=Bp,t.HighlightConstantProvider=Pp,t.Highlighter=Dp,t.InlineInput=Fp,t.PathObject=Gp,t.RenderInfo=Hp,t.Renderer=Vp,t.StatementInput=Up,class extends Ed{constructor(e,t){super(e,t)}getRenderer(){return this.renderer_}addElemSpacing_(){let e=!1;for(var t=0;t<this.rows.length;t++)if(this.rows[t].hasExternalInput){e=!0;break}for(t=0;t<this.rows.length;t++){var i=this.rows[t],s=i.elements;if(i.elements=[],i.startsWithElemSpacer()&&i.elements.push(new rd(this.constants_,this.getInRowSpacing_(null,s[0]))),s.length){for(let e=0;e<s.length-1;e++){i.elements.push(s[e]);var o=this.getInRowSpacing_(s[e],s[e+1]);i.elements.push(new rd(this.constants_,o))}i.elements.push(s[s.length-1]),i.endsWithElemSpacer()&&(s=this.getInRowSpacing_(s[s.length-1],null),e&&i.hasDummyInput&&(s+=this.constants_.TAB_WIDTH),i.elements.push(new rd(this.constants_,s)))}}}getInRowSpacing_(e,t){if(!e)return t&&$.isField(t)&&t.isEditable?this.constants_.MEDIUM_PADDING:t&&$.isInlineInput(t)?this.constants_.MEDIUM_LARGE_PADDING:t&&$.isStatementInput(t)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!$.isInput(e)&&!t)return $.isField(e)&&e.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:$.isIcon(e)?2*this.constants_.LARGE_PADDING+1:$.isHat(e)?this.constants_.NO_PADDING:$.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:$.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:$.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if($.isInput(e)&&!t){if($.isExternalInput(e))return this.constants_.NO_PADDING;if($.isInlineInput(e))return this.constants_.LARGE_PADDING;if($.isStatementInput(e))return this.constants_.NO_PADDING}if(!$.isInput(e)&&t&&$.isInput(t)){if($.isField(e)&&e.isEditable){if($.isInlineInput(t)||$.isExternalInput(t))return this.constants_.SMALL_PADDING}else{if($.isInlineInput(t)||$.isExternalInput(t))return this.constants_.MEDIUM_LARGE_PADDING;if($.isStatementInput(t))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if($.isIcon(e)&&t&&!$.isInput(t))return this.constants_.LARGE_PADDING;if($.isInlineInput(e)&&t&&$.isField(t))return t.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if($.isLeftSquareCorner(e)&&t){if($.isHat(t))return this.constants_.NO_PADDING;if($.isPreviousConnection(t)||$.isNextConnection(t))return t.notchOffset}return $.isLeftRoundedCorner(e)&&t?t.notchOffset-this.constants_.CORNER_RADIUS:$.isField(e)&&t&&$.isField(t)&&e.isEditable===t.isEditable?0===e.width?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING:t&&$.isJaggedEdge(t)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,t){return $.isTopRow(e)&&$.isBottomRow(t)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:$.isTopRow(e)||$.isBottomRow(t)?this.constants_.NO_PADDING:e.hasExternalInput&&t.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&t.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&t.hasStatement||e.hasDummyInput||t.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,t){var i;return $.isSpacer(t)?e.yPos+t.height/2:$.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,$.isNextConnection(t)?e+t.height/2:e-t.height/2):$.isTopRow(e)?$.isHat(t)?e.capline-t.height/2:e.capline+t.height/2:(i=e.yPos,$.isField(t)&&e.hasStatement?i+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+t.height/2):i+e.height/2)}finalize_(){let e=0,t=0;for(var i=0;i<this.rows.length;i++){var s=this.rows[i],o=(s.yPos=t,s.xPos=this.startX,t+=s.height,e=Math.max(e,s.widthWithConnectedBlocks),t-this.topRow.ascenderHeight);s===this.bottomRow&&o<this.constants_.MIN_BLOCK_HEIGHT&&(o=this.constants_.MIN_BLOCK_HEIGHT-o,this.bottomRow.height+=o,t+=o),this.recordElemPositions_(s)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(i=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,i.getHeightWidth().width)),this.bottomRow.baseline=t-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=t,this.startY=this.topRow.capline}}),zp=class extends Kc{constructor(e){super(e)}makeRenderInfo_(e){return new Wp(this,e)}},jp=(sn("thrasos",zp),{}),Yp=(jp.RenderInfo=Wp,jp.Renderer=zp,new Mu("zelos",{colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},{colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}})),ac={Classic:Du,Zelos:Yp},zu=class{constructor(e,t,i){this.id_=e.toolboxitemid||wr(),this.level_=(this.parent_=i||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=t,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(e){}getFocusableElement(){var e=this.getDiv();if(!e)throw Error("Trying to access toolbox item before DOM is initialized.");if(e instanceof HTMLElement)return e;throw Error("Toolbox item div is unexpectedly not an HTML element.")}getFocusableTree(){return this.parentToolbox_}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}},Xp=class extends zu{constructor(e,t,i){super(e,t,i),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),"true"===this.toolboxItemDef_.hidden&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategoryContainer",row:"blocklyToolboxCategory",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyToolboxCategoryIcon",label:"blocklyToolboxCategoryLabel",contents:"blocklyToolboxCategoryGroup",selected:"blocklyToolboxSelected",openicon:"blocklyToolboxCategoryIconOpen",closedicon:"blocklyToolboxCategoryIconClosed"}}parseContents_(t){if("custom"in t)this.flyoutItems_=t.custom;else if(t=t.contents)for(let e=0;e<t.length;e++){var i=t[e];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(i)}}parseCategoryDef_(e){this.name_="name"in e?ss(e.name):"",this.colour_=this.getColour_(e),Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),qe(this.htmlDiv_,il.TREEITEM),Ze(this.htmlDiv_,sl.SELECTED,!1),Ze(this.htmlDiv_,sl.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),qe(this.iconDom_,il.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);var e=this.labelDom_.getAttribute("id");return e&&Ze(this.htmlDiv_,sl.LABELLEDBY,e),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){var e=document.createElement("div"),t=(e.tabIndex=-1,e.id=this.getId(),this.cssConfig_.container);return t&&c(e,t),e}createRowContainer_(){var e=document.createElement("div"),t=this.cssConfig_.row;return t&&c(e,t),t=Xp.nestedPadding*this.getLevel()+"px",this.workspace_.RTL?e.style.paddingRight=t:e.style.paddingLeft=t,e}createRowContentsContainer_(){var e=document.createElement("div"),t=this.cssConfig_.rowcontentcontainer;return t&&c(e,t),e}createIconDom_(){var e,t=document.createElement("span");return this.parentToolbox_.isHorizontal()||(e=this.cssConfig_.icon)&&c(t,e),t.style.display="inline-block",t}createLabelDom_(e){var t=document.createElement("span");return t.setAttribute("id",this.getId()+".label"),t.textContent=e,(e=this.cssConfig_.label)&&c(t,e),t}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(e){e&&(e=Xp.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)}getColour_(e){var t=e.categorystyle||e.categoryStyle;if((e=e.colour)&&t)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(t)return this.getColourfromStyle(t);if(e)return this.parseColour(e)}return""}getColourfromStyle(e){var t=this.workspace_.getTheme();if(e&&t){if((t=t.categoryStyles[e])&&t.colour)return this.parseColour(t.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour(e){var t;return null==(e=ss(e))||""===e?"":(t=Number(e),isNaN(t)?(t=Ki(e))||(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):es(t))}openIcon_(e){var t;e&&((t=this.cssConfig_.closedicon)&&W(e,t),t=this.cssConfig_.openicon)&&c(e,t)}closeIcon_(e){var t;e&&((t=this.cssConfig_.openicon)&&W(e,t),t=this.cssConfig_.closedicon)&&c(e,t)}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let e=this;for(;e.getParent();)if(!(e=e.getParent()).isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(e){}setSelected(e){var t,i;this.rowDiv_&&(t=this.cssConfig_.selected,e?(i=this.parseColour(Xp.defaultBackgroundColour),this.rowDiv_.style.backgroundColor=this.colour_||i,t&&c(this.rowDiv_,t)):(this.rowDiv_.style.backgroundColor="",t&&r(this.rowDiv_,t)),Ze(this.htmlDiv_,sl.SELECTED,e))}setDisabled(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",""+e),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(e){this.flyoutItems_=[],this.toolboxItemDef_="string"==typeof e?{kind:this.toolboxItemDef_.kind,custom:e,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:Be(e),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){l(this.htmlDiv_)}},Kp=(Xp.registrationName="category",Xp.nestedPadding=19,Xp.borderWidth=8,Xp.defaultBackgroundColour="#57e",be('\n.blocklyToolboxCategory:not(.blocklyToolboxSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolbox[layout="h"] .blocklyToolboxCategoryContainer {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolbox[dir="RTL"][layout="h"] .blocklyToolboxCategoryContainer {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyToolboxCategory {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolbox[dir="RTL"] .blocklyToolboxCategory {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyToolboxCategoryIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyToolboxCategoryIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolbox[dir="RTL"] .blocklyToolboxCategoryIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyToolboxSelected>.blocklyToolboxCategoryIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolbox[dir="RTL"] .blocklyToolboxSelected>.blocklyToolboxCategoryIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyToolboxCategoryIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyToolboxSelected>.blocklyToolboxCategoryIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyToolboxCategoryLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyToolboxCategoryLabel {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyToolboxSelected .blocklyToolboxCategoryLabel {\n  color: #fff;\n}\n'),o(b.TOOLBOX_ITEM,Xp.registrationName,Xp),class extends zu{constructor(e,t){super(e,t),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv=null,Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}init(){this.createDom_()}createDom_(){var e=document.createElement("div"),t=(e.tabIndex=-1,e.id=this.getId(),this.cssConfig_.container);return t&&c(e,t),this.htmlDiv=e}getDiv(){return this.htmlDiv}dispose(){l(this.htmlDiv)}}),Jp=(Kp.registrationName="sep",be('\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolbox[layout="h"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n'),o(b.TOOLBOX_ITEM,Kp.registrationName,Kp),class extends Xp{constructor(e,t,i){super(e,t,i),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){var e=super.makeDefaultCssConfig_();return e.contents="blocklyToolboxCategoryGroup",e}parseContents_(t){if("custom"in t)this.flyoutItems_=t.custom;else{var i=t.contents;if(i){this.flyoutItems_=[],t=!0;for(let e=0;e<i.length;e++){var s=i[e];t=!hr(b.TOOLBOX_ITEM,s.kind)||s.kind.toLowerCase()===Kp.registrationName&&t?(this.flyoutItems_.push(s),!0):(this.createToolboxItem(s),!1)}}}}createToolboxItem(e){let t=e.kind;"CATEGORY"===t.toUpperCase()&&Fe(e)&&(t=Jp.registrationName),e=new(dr(b.TOOLBOX_ITEM,t))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)}init(){super.init(),this.setExpanded("true"===this.toolboxItemDef_.expanded||!0===this.toolboxItemDef_.expanded)}createDom_(){super.createDom_();var e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),qe(this.subcategoriesDiv_,il.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),Ze(this.htmlDiv_,sl.EXPANDED,!1),this.htmlDiv_}createIconDom_(){var e,t=document.createElement("span");return this.parentToolbox_.isHorizontal()||((e=this.cssConfig_.icon)&&c(t,e),t.style.visibility="visible"),t.style.display="inline-block",t}createSubCategoriesDom_(e){var t=document.createElement("div"),i=(t.style.display="none",this.cssConfig_.contents);for(i&&c(t,i),i=0;i<e.length;i++){var s=e[i],o=(s.init(),s.getDiv());t.appendChild(o),s.getClickTarget&&null!=(o=s.getClickTarget())&&o.setAttribute("id",s.getId())}return t}setExpanded(e){var t;this.expanded_!==e&&((this.expanded_=e)?(this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_)):(null!=(t=this.parentToolbox_.getFlyout())&&t.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)),Ze(this.htmlDiv_,sl.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize())}setVisible_(t){this.htmlDiv_.style.display=t?"block":"none";var i=this.getChildToolboxItems();for(let e=0;e<i.length;e++)i[e].setVisible_(t);this.isHidden_=!t,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(e){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}}),qp=(Jp.registrationName="collapsibleCategory",o(b.TOOLBOX_ITEM,Jp.registrationName,Jp),class extends gh{constructor(e){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.height_=this.width_=0,this.flyout=null,this.contents=new Map,this.previouslySelectedItem_=this.selectedItem_=null,this.boundEvents_=[],this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout=e.options.horizontalLayout,this.RTL=e.options.RTL,this.toolboxPosition=e.options.toolboxPosition}onShortcut(e){return!1}init(){var e=this.workspace_,t=e.getParentSvg(),i=(this.flyout=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),this.flyout.createDom("svg"));c(i,"blocklyToolboxFlyout"),j(i,t),this.setVisible(!0),this.flyout.init(e),this.render(this.toolboxDef_),(e=e.getThemeManager()).subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:Kl.ComponentWeight.TOOLBOX_WEIGHT,capabilities:[Kl.Capability.AUTOHIDEABLE,Kl.Capability.DELETE_AREA,Kl.Capability.DRAG_TARGET]}),_.getFocusManager$$module$build$src$core$focus_manager().registerTree(this,!0)}createDom_(e){e=e.getParentSvg();var t=this.createContainer_();return t.id=wr(),this.contentsDiv_=this.createContentsContainer_(),qe(this.contentsDiv_,il.TREE),t.appendChild(this.contentsDiv_),e.parentNode.insertBefore(t,e),this.attachEvents_(t,this.contentsDiv_),t}createContainer_(){var e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),c(e,"blocklyToolbox"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e}createContentsContainer_(){var e=document.createElement("div");return c(e,"blocklyToolboxCategoryGroup"),this.isHorizontal()&&(e.style.flexDirection="row"),e}attachEvents_(e,t){e=p(e,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(e),t=p(t,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(t)}onClick_(e){var t;Ir(e)||e.target===this.HtmlDiv?qr.hideChaff(!1):((t=e.target.getAttribute("id"))&&(t=this.getToolboxItemById(t)).isSelectable()&&(this.setSelectedItem(t),t.onClick(e)),qr.hideChaff(!0)),fr()}onKeyDown_(e){let t=!1;switch(e.key){case"ArrowDown":t=this.selectNext();break;case"ArrowUp":t=this.selectPrevious();break;case"ArrowLeft":t=this.selectParent();break;case"ArrowRight":t=this.selectChild();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),t=!0);break;default:t=!1}(t=!t&&this.selectedItem_&&this.selectedItem_.onKeyDown?this.selectedItem_.onKeyDown(e):t)&&e.preventDefault()}createFlyout_(){var e=this.workspace_,t=e.copyOptionsForFlyout();return t.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?mr(b.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):mr(b.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(t)}render(e){this.toolboxDef_=e,this.contents.forEach(e=>e.dispose()),this.contents.clear(),this.renderContents_(e.contents),this.position(),this.handleToolboxItemResize()}renderContents_(t){var i=document.createDocumentFragment();for(let e=0;e<t.length;e++)this.createToolboxItem(t[e],i);this.contentsDiv_.appendChild(i)}createToolboxItem(e,t){var i=e.kind;"CATEGORY"===i.toUpperCase()&&Fe(e)&&(i=Jp.registrationName),(i=dr(b.TOOLBOX_ITEM,i.toLowerCase()))&&((e=new i(e,this)).init(),this.addToolboxItem_(e),(i=e.getDiv())&&t.appendChild(i),e.getClickTarget())&&e.getClickTarget().setAttribute("id",e.getId())}addToolboxItem_(t){if(this.contents.set(t.getId(),t),t.isCollapsible()){t=t.getChildToolboxItems();for(let e=0;e<t.length;e++)this.addToolboxItem_(t[e])}}getToolboxItems(){return[...this.contents.values()]}addStyle(e){e&&this.HtmlDiv&&c(this.HtmlDiv,e)}removeStyle(e){e&&this.HtmlDiv&&r(this.HtmlDiv,e)}getClientRect(){var e,t,i,s;return this.HtmlDiv&&this.isVisible_?(t=(e=(s=this.HtmlDiv.getBoundingClientRect()).top)+s.height,s=(i=s.left)+s.width,this.toolboxPosition===T.TOP?new I(-1e7,t,-1e7,1e7):this.toolboxPosition===T.BOTTOM?new I(e,1e7,-1e7,1e7):this.toolboxPosition===T.LEFT?new I(-1e7,1e7,-1e7,s):new I(-1e7,1e7,i,1e7)):null}wouldDelete(e){return e instanceof N?this.updateWouldDelete_(!e.getParent()&&e.isDeletable()):this.updateWouldDelete_($o(e)&&e.isDeletable()),this.wouldDelete_}onDragEnter(e){this.updateCursorDeleteStyle_(!0)}onDragExit(e){this.updateCursorDeleteStyle_(!1)}onDrop(e){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(e){e!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=e,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(e){var t=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";e?this.addStyle(t):this.removeStyle(t)}getToolboxItemById(e){return this.contents.get(e)||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout}position(){var e=this.workspace_.getMetrics(),t=this.HtmlDiv;t&&(this.horizontalLayout?(t.style.left="0",t.style.height="auto",t.style.width="100%",this.height_=t.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition===T.TOP?t.style.top="0":t.style.bottom="0"):(this.toolboxPosition===T.RIGHT?t.style.right="0":t.style.left="0",t.style.height="100%",this.width_=t.offsetWidth,this.height_=e.viewHeight),this.flyout.position())}handleToolboxItemResize(){var e=this.workspace_,t=this.HtmlDiv.getBoundingClientRect(),i=this.getFlyout(),s=this.toolboxPosition===T.LEFT?e.scrollX+t.width+(null!=i&&i.isVisible()?i.getWidth():0):e.scrollX,t=this.toolboxPosition===T.TOP?e.scrollY+t.height+(null!=i&&i.isVisible()?i.getHeight():0):e.scrollY;e.translate(s,t),he(e)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){this.contents.forEach(e=>{e.refreshTheme&&e.refreshTheme()})}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout.show(this.selectedItem_.getContents())}setVisible(e){this.isVisible_!==e&&(this.HtmlDiv.style.display=e?"block":"none",this.isVisible_=e,this.workspace_.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.flyout.autoClose&&this.clearSelection()}setSelectedItem(e){var t=this.selectedItem_;!e&&!t||e&&!rr(e)||(this.shouldDeselectItem_(t,e)&&null!==t&&this.deselectItem_(t),this.shouldSelectItem_(t,e)&&null!==e&&this.selectItem_(t,e),this.updateFlyout_(t,e),this.fireSelectEvent(t,e))}shouldDeselectItem_(e,t){return null!==e&&(!e.isCollapsible()||e!==t)}shouldSelectItem_(e,t){return null!==t&&t!==e}deselectItem_(e){this.selectedItem_=null,(this.previouslySelectedItem_=e).setSelected(!1),Ze(this.contentsDiv_,sl.ACTIVEDESCENDANT,"")}selectItem_(e,t){this.selectedItem_=t,this.previouslySelectedItem_=e,t.setSelected(!0),Ze(this.contentsDiv_,sl.ACTIVEDESCENDANT,t.getId())}selectItemByPosition(e){(e=this.getToolboxItems()[e])&&this.setSelectedItem(e)}updateFlyout_(e,t){t&&(e!==t||t.isCollapsible())&&t.getContents().length?(this.flyout.show(t.getContents()),this.flyout.scrollToStart()):this.flyout.hide()}fireSelectEvent(e,t){var i=e&&e.getName();let s=t&&t.getName();e===t&&(s=null),e=new(m(f.TOOLBOX_ITEM_SELECT))(i,s,this.workspace_.id),g(e)}selectParent(){return!(!this.selectedItem_||(this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),0):!this.selectedItem_.getParent()||!this.selectedItem_.getParent().isSelectable()||(this.setSelectedItem(this.selectedItem_.getParent()),0)))}selectChild(){var e;return!(!this.selectedItem_||!this.selectedItem_.isCollapsible()||((e=this.selectedItem_).isExpanded()?this.selectNext():e.toggleExpanded(),0))}selectNext(){if(this.selectedItem_){var i=[...this.contents.values()];let t=i.indexOf(this.selectedItem_)+1;if(-1<t&&t<i.length){let e=i[t];for(;e&&!e.isSelectable();)e=i[++t];if(e&&e.isSelectable())return this.setSelectedItem(e),!0}}return!1}selectPrevious(){if(this.selectedItem_){var i=[...this.contents.values()];let t=i.indexOf(this.selectedItem_)-1;if(-1<t&&t<i.length){let e=i[t];for(;e&&!e.isSelectable();)e=i[--t];if(e&&e.isSelectable())return this.setSelectedItem(e),!0}}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout.dispose(),this.contents.forEach(e=>e.dispose());for(let e=0;e<this.boundEvents_.length;e++)n(this.boundEvents_[e]);this.boundEvents_=[],this.contents.clear(),this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),l(this.HtmlDiv)),_.getFocusManager$$module$build$src$core$focus_manager().unregisterTree(this)}getFocusableElement(){if(this.HtmlDiv)return this.HtmlDiv;throw Error("Toolbox DOM has not yet been created.")}getFocusableTree(){return this}onNodeFocus(){}onNodeBlur(){}canBeFocused(){return!0}getRootFocusableNode(){return this}getRestoredFocusableNode(e){return(!e||e===this)&&null!=(e=this.getToolboxItems().find(e=>e.isSelectable()))?e:null}getNestedTrees(){return[]}lookUpFocusableNode(e){return this.getToolboxItemById(e)}onTreeFocus(e,t){e!==this?this.getSelectedItem()!==e&&this.setSelectedItem(e):this.clearSelection()}onTreeBlur(e){e&&e===(null==(e=this.flyout)?void 0:e.getWorkspace())||(this.clearSelection(),this.flyout&&Po(this.flyout)&&this.flyout.autoHide(!1))}}),Zp=(be('\n.blocklyToolboxDelete {\n  cursor: url("<<<PATH>>>/handdelete.cur"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url("<<<PATH>>>/handclosed.cur"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolbox {\n  box-sizing: border-box;\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxCategoryGroup {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxCategoryGroup:focus {\n  outline: none;\n}\n'),o(b.TOOLBOX,Ur,qp),E.INPUT_VALUE),Qp=E.OUTPUT_VALUE,eg=E.NEXT_STATEMENT,tg=E.PREVIOUS_STATEMENT,cc=T.TOP,Rp=T.BOTTOM,lc=T.LEFT,Vr=T.RIGHT,i=(Cd.prototype.newBlock=function(e,t){return new oh(this,e,t)},wd.prototype.newBlock=function(e,t){return new N(this,e,t)},Cd.prototype.newComment=function(e){return new yu(this,e)},wd.prototype.newComment=function(e){return new ku(this,e)},wd.newTrashcan=function(e){return new $d(e)},Uu.prototype.newWorkspaceSvg=function(e){return new wd(e)},_.Names$$module$build$src$core$names.prototype.populateProcedures=function(t){t=(t=Ho(t))[0].concat(t[1]);for(let e=0;e<t.length;e++)this.getName(t[e][0],_.Names$$module$build$src$core$names.NameType.PROCEDURE)},{});i.Block=oh,i.BlockFlyoutInflater=Lp,i.BlockNavigationPolicy=kh,i.BlockSvg=N,i.Blocks=Hr,i.ButtonFlyoutInflater=Np,i.COLLAPSED_FIELD_NAME=wa,i.COLLAPSED_INPUT_NAME=Sa,i.COLLAPSE_CHARS=30,i.CodeGenerator=_.CodeGenerator$$module$build$src$core$generator,i.CollapsibleToolboxCategory=Jp,i.ComponentManager=Kl,i.Connection=O,i.ConnectionChecker=Dl,i.ConnectionDB=xu,i.ConnectionNavigationPolicy=Ch,i.ConnectionType=E,i.ContextMenu=cu,i.ContextMenuItems=Wl,i.ContextMenuRegistry=x,i.Css=Zl,i.DELETE_VARIABLE_ID=Zu,i.DeleteArea=gh,i.DragTarget=ph,i.DropDownDiv=tc,i.Events=M,i.Extensions=Wu,i.Field=A,i.FieldCheckbox=mp,i.FieldDropdown=Lu,i.FieldImage=ep,i.FieldLabel=Ku,i.FieldLabelSerializable=Vu,i.FieldNavigationPolicy=Sh,i.FieldNumber=Xu,i.FieldTextInput=_.FieldTextInput$$module$build$src$core$field_textinput,i.FieldVariable=gp,i.Flyout=Mh,i.FlyoutButton=fh,i.FlyoutButtonNavigationPolicy=Th,i.FlyoutItem=mh,i.FlyoutMetricsManager=bh,i.FlyoutNavigationPolicy=Eh,i.FlyoutNavigator=Oh,i.FlyoutSeparator=vh,i.FlyoutSeparatorNavigationPolicy=yh,i.FocusManager=Fl,i.FocusableTreeTraverser=Bl,i.Generator=_.CodeGenerator$$module$build$src$core$generator,i.Gesture=Fh,i.Grid=Uh,i.HorizontalFlyout=pp,i.INPUT_VALUE=Zp,i.Input=eh,i.InsertionMarkerPreviewer=cp,i.KeyboardNavigationController=Dh,i.LabelFlyoutInflater=qd,i.LineCursor=Vh,i.Marker=Gh,i.MarkerManager=Wh,i.Menu=Ia,i.MenuItem=ka,i.MetricsManager=_h,i.Msg=_.Msg$$module$build$src$core$msg,i.NEXT_STATEMENT=eg,i.Names=_.Names$$module$build$src$core$names,i.Navigator=Rh,i.OPPOSITE_TYPE=Ju,i.OUTPUT_VALUE=Qp,i.Options=Bu,i.PREVIOUS_STATEMENT=tg,i.PROCEDURE_CATEGORY_NAME=Qh,i.Procedures=Xh,i.RENAME_VARIABLE_ID=qu,i.RenderedConnection=Qu,i.Scrollbar=sa,i.ScrollbarPair=Nh,i.SeparatorFlyoutInflater=Lh,i.ShortcutItems=ea,i.ShortcutRegistry=v,i.TOOLBOX_AT_BOTTOM=Rp,i.TOOLBOX_AT_LEFT=lc,i.TOOLBOX_AT_RIGHT=Vr,i.TOOLBOX_AT_TOP=cc,i.Theme=Mu,i.ThemeManager=yd,i.Themes=ac,i.Toast=Ua,i.Toolbox=qp,i.ToolboxCategory=Xp,i.ToolboxItem=zu,i.ToolboxSeparator=Kp,i.Tooltip=zc,i.Touch=Yr,i.Trashcan=$d,i.UnattachedFieldError=qc,i.VARIABLE_CATEGORY_NAME=qa,i.VARIABLE_DYNAMIC_CATEGORY_NAME=kd,i.VERSION="12.2.0",i.VariableMap=pc,i.VariableModel=Xr,i.Variables=ec,i.VariablesDynamic=Id,i.VerticalFlyout=dp,i.WidgetDiv=nu,i.Workspace=Cd,i.WorkspaceAudio=Sd,i.WorkspaceDragger=Ph,i.WorkspaceNavigationPolicy=xh,i.WorkspaceSvg=wd,i.Xml=Iu,i.ZoomControls=ba,i.blockAnimations=lh,i.blockRendering=w,i.browserEvents=Tl,i.bubbles=$p,i.bumpObjects=ch,i.clipboard=Ul,i.comments=Jc,i.common=e,i.config=_.config$$module$build$src$core$config,i.constants=xa,i.defineBlocksWithJsonArray=ge,i.dialog=Ka,i.dragging=Yl,i.fieldRegistry=$u,i.geras=t,i.getFocusManager=_.getFocusManager$$module$build$src$core$focus_manager,i.getMainWorkspace=re,i.getSelected=ae,i.hasBubble=ni,i.hideChaff=lr,i.icons=Yh,i.inject=wn,i.inputs=up,i.isCopyable=mn,i.isDeletable=$o,i.isDraggable=Bo,i.isIcon=fo,i.isObservable=Uo,i.isPaster=or,i.isRenderedElement=nr,i.isSelectable=ee,i.isSerializable=Qe,i.isVariableBackedParameterModel=gt,i.keyboardNavigationController=Bh,i.layers=hu,i.navigateBlock=Do,i.navigateStacks=Mo,i.procedures=Xh,i.registry=Pr,i.renderManagement=Da,i.serialization=Xl,i.setLocale=ol,i.setParentContainer=ue,i.svgResize=he,i.thrasos=jp,i.uiPosition=ma,i.utils=ju,i.zelos=S;return i.__namespace__=_,i},"function"==typeof define&&define.amd?define([],t):"object"==typeof s?i.exports=t():e.Blockly=t()}.call(this)}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],172:[function(e,t,i){t.exports=e("./blocks_compressed.js")},{"./blocks_compressed.js":173}],173:[function(e,t,i){var s,o;s=this,o=function(e){var r=e.__namespace__,e=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),o=function(i){return function(){var e=i.workspace,t=i.getField("VAR").getVariable();r.renameVariable$$module$build$src$core$variables(e,t)}},n=function(t){return function(){var e=t.getField("VAR").getVariable();e&&r.deleteVariable$$module$build$src$core$variables(e.getWorkspace(),e,t)}},t=(r.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",{customContextMenu:function(e){var t,i,s;this.isInFlyout?"variables_get_dynamic"!==this.type&&"variables_get_reporter_dynamic"!==this.type||(t={text:r.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:o(this)},i=this.getField("VAR").getText(),i={text:r.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",i),enabled:!0,callback:n(this)},e.unshift(t),e.unshift(i)):(t="variables_get_dynamic"===this.type?(s="variables_set_dynamic",r.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET):(s="variables_get_dynamic",r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET),s={type:s,fields:{VAR:(i=this.getField("VAR")).saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:t.replace("%1",i.getText()),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,s)}))},onchange:function(e){e=this.getFieldValue("VAR"),e=r.getVariable$$module$build$src$core$variables(this.workspace,e),("variables_get_dynamic"===this.type?this.outputConnection:this.getInput("VALUE").connection).setCheck(e.getType())}}),r.defineBlocks$$module$build$src$core$common(e),{blocks:e}),i=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),l=function(i){return function(){var e=i.workspace,t=i.getField("VAR").getVariable();r.renameVariable$$module$build$src$core$variables(e,t)}},a=function(t){return function(){var e=t.getField("VAR").getVariable();e&&r.deleteVariable$$module$build$src$core$variables(e.getWorkspace(),e,t)}},s=(r.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",{customContextMenu:function(e){var t,i,s;this.isInFlyout?"variables_get"!==this.type&&"variables_get_reporter"!==this.type||(t={text:r.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:l(this)},i=this.getField("VAR").getText(),i={text:r.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",i),enabled:!0,callback:a(this)},e.unshift(t),e.unshift(i)):(t="variables_get"===this.type?(s="variables_set",r.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET):(s="variables_get",r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET),s={type:s,fields:{VAR:(i=this.getField("VAR")).saveState(!0)}},e.push({enabled:0<this.workspace.remainingCapacity(),text:t.replace("%1",i.getText()),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,s)}))}}),r.defineBlocks$$module$build$src$core$common(i),{blocks:i}),c=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),u=(c.text_getSubstring={init:function(){this.WHERE_OPTIONS_1=[[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT);var e=i=>{var e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+i]});return e.setValidator(function(e){var t=this.getValue();(e="FROM_START"===e||"FROM_END"===e)!==("FROM_START"===t||"FROM_END"===t)&&this.getSourceBlock().updateAt_(i,e)}),e};this.appendDummyInput("WHERE1_INPUT").appendField(e(1),"WHERE1"),this.appendDummyInput("AT1"),this.appendDummyInput("WHERE2_INPUT").appendField(e(2),"WHERE2"),this.appendDummyInput("AT2"),r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation"),t=this.getInput("AT1")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",""+t),t=this.getInput("AT2")instanceof r.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",""+t),e},domToMutation:function(e){var t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},updateAt_:function(e,t){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),t?(this.appendValueInput("AT"+e).setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e),2===e&&r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL)),1===e&&(this.moveInputBefore("AT1","WHERE2_INPUT"),this.getInput("ORDINAL1"))&&this.moveInputBefore("ORDINAL1","WHERE2_INPUT")}},c.text_changeCase={init:function(){var e=[[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},c.text_trim={init:function(){var e=[[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},c.text_print={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}},{updateType_:function(e){this.outputConnection.setCheck("NUMBER"===e?"Number":"String")},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("type",this.getFieldValue("TYPE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("type"))}}),h=(c.text_prompt_ext=Object.assign({},u,{init:function(){var e=[[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator(e=>{this.updateType_(e)}),this.appendValueInput("TEXT").appendField(e,"TYPE"),this.setOutput(!0,"String"),this.setTooltip(()=>"TEXT"===this.getFieldValue("TYPE")?r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}}),c.text_prompt=Object.assign({},u,{init:function(){this.mixin(h);var e=[[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),(e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator(e=>{this.updateType_(e)}),this.appendDummyInput().appendField(e,"TYPE").appendField(this.newQuote_(!0)).appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip(()=>"TEXT"===this.getFieldValue("TYPE")?r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}}),c.text_count={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},c.text_replace={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},c.text_reverse={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}},{QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(s){for(let e=0,i;i=this.inputList[e];e++)for(let e=0,t;t=i.fieldRow[e];e++)if(s===t.name)return i.insertFieldAt(e,this.newQuote_(!0)),void i.insertFieldAt(e+2,this.newQuote_(!1));console.warn('field named "'+s+'" not found in '+this.toDevString())},newQuote_:function(e){return e=this.RTL?!e:e,r.fromJson$$module$build$src$core$field_registry({type:"field_image",src:e?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:e?"â€œ":"â€"})}}),u={itemCount_:0,mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",""+this.itemCount_),e},domToMutation:function(e){this.itemCount_=parseInt(e.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(t){var e=t.newBlock("text_create_join_container");e.initSvg();let i=e.getInput("STACK").connection;for(let e=0;e<this.itemCount_;e++){var s=t.newBlock("text_create_join_item");s.initSvg(),i.connect(s.previousConnection),i=s.nextConnection}return e},compose:function(e){var t,i=e.getInputTargetBlock("STACK");for(e=[];i;)i.isInsertionMarker()||e.push(i.valueConnection_),i=i.getNextBlock();for(i=0;i<this.itemCount_;i++){var s=this.getInput("ADD"+i).connection.targetConnection;s&&!e.includes(s)&&s.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),i=0;i<this.itemCount_;i++)null!=(t=e[i])&&t.reconnect(this,"ADD"+i)},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){var i;e.isInsertionMarker()?e=e.getNextBlock():(i=this.getInput("ADD"+t),e.valueConnection_=i&&i.connection.targetConnection,e=e.getNextBlock(),t++)}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var e,t=0;t<this.itemCount_;t++)this.getInput("ADD"+t)||(e=this.appendValueInput("ADD"+t).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT),0===t&&e.appendField(r.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH));for(t=this.itemCount_;this.getInput("ADD"+t);t++)this.removeInput("ADD"+t)}},d=(r.register$$module$build$src$core$extensions("text_append_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR")),{isAt_:!1,mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("at",""+this.isAt_),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},updateAt_:function(e){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),e&&(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX),r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=e}}),u=(r.register$$module$build$src$core$extensions("text_indexOf_tooltip",function(){this.setTooltip(()=>r.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))}),r.register$$module$build$src$core$extensions("text_quotes",function(){this.mixin(h),this.quoteField_("TEXT")}),r.registerMixin$$module$build$src$core$extensions("quote_image_mixin",h),r.registerMutator$$module$build$src$core$extensions("text_join_mutator",u,function(){this.mixin(h),this.itemCount_=2,this.updateShape_(),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))}),r.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",d,function(){this.getField("WHERE").setValidator(function(e){e="FROM_START"===e||"FROM_END"===e;var t=this.getSourceBlock();e!==t.isAt_&&t.updateAt_(e)}),this.updateAt_(!0),this.setTooltip(()=>{var e=this.getFieldValue("WHERE");let t=r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return"FROM_START"!==e&&"FROM_END"!==e||!(e="FROM_START"===e?r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)||(t+="  "+e.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),t})}),r.defineBlocks$$module$build$src$core$common(c),{blocks:c}),d={},p={setStatements_:function(e){this.hasStatements_!==e&&(e?(this.appendStatementInput("STACK").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=e)},updateParams_:function(){let e="";this.arguments_.length&&(e=r.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),r.disable$$module$build$src$core$events$utils();try{this.setFieldValue(e,"PARAMS")}finally{r.enable$$module$build$src$core$events$utils()}},mutationToDom:function(t){var i=r.createElement$$module$build$src$core$utils$xml("mutation");t&&i.setAttribute("name",this.getFieldValue("NAME"));for(let e=0;e<this.argumentVarModels_.length;e++){var s=r.createElement$$module$build$src$core$utils$xml("arg"),o=this.argumentVarModels_[e];s.setAttribute("name",o.getName()),s.setAttribute("varid",o.getId()),t&&this.paramIds_&&s.setAttribute("paramId",this.paramIds_[e]),i.appendChild(s)}return this.hasStatements_||i.setAttribute("statements","false"),i},domToMutation:function(i){this.arguments_=[],this.argumentVarModels_=[];for(let e=0,t;t=i.childNodes[e];e++){var s,o;"arg"===t.nodeName.toLowerCase()&&(s=(o=t).getAttribute("name"),o=o.getAttribute("varid")||o.getAttribute("varId"),this.arguments_.push(s),null!==(o=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,o,s,""))?this.argumentVarModels_.push(o):console.log(`Failed to create a variable named "${s}", ignoring.`))}this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_("false"!==i.getAttribute("statements"))},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;var t=Object.create(null);if(this.argumentVarModels_.length){t.params=[];for(let e=0;e<this.argumentVarModels_.length;e++)t.params.push({name:this.argumentVarModels_[e].getName(),id:this.argumentVarModels_[e].getId()})}return this.hasStatements_||(t.hasStatements=!1),t},loadExtraState:function(t){if(this.arguments_=[],this.argumentVarModels_=[],t.params)for(let e=0;e<t.params.length;e++){var i=t.params[e],i=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,i.id,i.name,"");this.arguments_.push(i.getName()),this.argumentVarModels_.push(i)}this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(!1!==t.hasStatements)},decompose:function(e){var t=r.createElement$$module$build$src$core$utils$xml("block"),i=(t.setAttribute("type","procedures_mutatorcontainer"),r.createElement$$module$build$src$core$utils$xml("statement"));i.setAttribute("name","STACK"),t.appendChild(i);for(let e=0;e<this.arguments_.length;e++){var s=r.createElement$$module$build$src$core$utils$xml("block"),o=(s.setAttribute("type","procedures_mutatorarg"),r.createElement$$module$build$src$core$utils$xml("field")),n=(o.setAttribute("name","NAME"),r.createTextNode$$module$build$src$core$utils$xml(this.arguments_[e]));o.appendChild(n),s.appendChild(o),o=r.createElement$$module$build$src$core$utils$xml("next"),s.appendChild(o),i.appendChild(s),i=o}return e=r.domToBlock$$module$build$src$core$xml(t,e),"procedures_defreturn"===this.type?e.setFieldValue(this.hasStatements_,"STATEMENTS"):e.removeInput("STATEMENT_INPUT"),r.mutateCallers$$module$build$src$core$procedures(this),e},compose:function(e){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let t=e.getInputTargetBlock("STACK");for(;t&&!t.isInsertionMarker();){var i=t.getFieldValue("NAME");this.arguments_.push(i),i=this.workspace.getVariable(i,""),this.argumentVarModels_.push(i),this.paramIds_.push(t.id),t=t.nextConnection&&t.nextConnection.targetBlock()}var s;this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),null!==(e=e.getFieldValue("STATEMENTS"))&&this.hasStatements_!==(e="TRUE"===e)&&(e?(this.setStatements_(!0),null!=(s=this.statementConnection_)&&s.reconnect(this,"STACK"),this.statementConnection_=null):(s=this.getInput("STACK").connection,(this.statementConnection_=s.targetConnection)&&((s=s.targetBlock()).unplug(),s.bumpNeighbours()),this.setStatements_(!1)))},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(t,i){var e=this.workspace.getVariableById(t);if(""===e.getType()){e=e.getName(),i=this.workspace.getVariableById(i);var s=!1;for(let e=0;e<this.argumentVarModels_.length;e++)this.argumentVarModels_[e].getId()===t&&(this.arguments_[e]=i.getName(),this.argumentVarModels_[e]=i,s=!0);s&&(this.displayRenamedVar_(e,i.getName()),r.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(t){var i=t.getName();let s=!1,o;for(let e=0;e<this.argumentVarModels_.length;e++)this.argumentVarModels_[e].getId()===t.getId()&&(o=this.arguments_[e],this.arguments_[e]=i,s=!0);s&&(this.displayRenamedVar_(o,i),r.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(i,s){this.updateParams_();var o=this.getIcon(r.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(o&&o.bubbleIsVisible()){o=o.getWorkspace().getAllBlocks(!1);for(let e=0,t;t=o[e];e++)"procedures_mutatorarg"===t.type&&r.Names$$module$build$src$core$names.equals(i,t.getFieldValue("NAME"))&&t.setFieldValue(s,"NAME")}},customContextMenu:function(e){if(!this.isInFlyout){var t=this.getFieldValue("NAME"),i={type:this.callType_,extraState:{name:t,params:this.arguments_}};if(e.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",t),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,i)}),!this.isCollapsed())for(t=0;t<this.argumentVarModels_.length;t++){var s={type:"variables_get",fields:{VAR:{name:(i=this.argumentVarModels_[t]).getName(),id:i.getId(),type:i.getType()}}};e.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",i.getName()),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,s)})}}}},p=(d.procedures_defnoreturn=Object.assign({},p,{init:function(){var e=r.findLegalName$$module$build$src$core$procedures("",this);(e=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(r.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),d.procedures_defreturn=Object.assign({},p,{init:function(){var e=r.findLegalName$$module$build$src$core$procedures("",this);(e=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:e})).setValidator(r.rename$$module$build$src$core$procedures),e.setSpellcheck(!1),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(e,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT).appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"}),{init:function(){this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}}),g=(d.procedures_mutatorcontainer=p,class extends r.FieldTextInput$$module$build$src$core$field_textinput{constructor(){super(...arguments),this.editingInteractively=!1}showEditor_(e){super.showEditor_(e),this.editingInteractively=!0,this.editingVariable=void 0}onFinishEditing_(e){super.onFinishEditing_(e),this.editingInteractively=!1}}),m=(d.procedures_mutatorarg={init:function(){var e=new g(r.DEFAULT_ARG$$module$build$src$core$procedures,this.validator_);this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(e,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1},validator_:function(e){var t=this.getSourceBlock(),i=t.workspace.getRootWorkspace();if(!(e=e.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,"")))return null;var s=(t.workspace.targetWorkspace||t.workspace).getAllBlocks(!1),o=e.toLowerCase();for(let e=0;e<s.length;e++)if(s[e].id!==this.getSourceBlock().id){var n=s[e].getFieldValue("NAME");if(n&&n.toLowerCase()===o)return null}return t.isInFlyout||((t=i.getVariable(e,""))&&t.getName()!==e&&i.renameVariableById(t.getId(),e),t)||(this.editingInteractively?this.editingVariable?i.renameVariableById(this.editingVariable.getId(),e):this.editingVariable=i.createVariable(e,""):i.createVariable(e,"")),e}},"DISABLED_PROCEDURE_DEFINITION"),p={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(e,t){r.Names$$module$build$src$core$names.equals(e,this.getProcedureCall())&&(this.setFieldValue(t,"NAME"),this.setTooltip((this.outputConnection?r.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:r.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",t)))},setProcedureParameters_:function(e,t){var i,s=r.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((s=(s=s&&s.getIcon(r.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&s.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),e.join("\n")===this.arguments_.join("\n"))this.quarkIds_=t;else{if(t.length!==e.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let e=0;e<this.arguments_.length;e++){var o=this.getInput("ARG"+e);o&&(o=o.connection.targetConnection,this.quarkConnections_[this.quarkIds_[e]]=o,s)&&o&&!t.includes(this.quarkIds_[e])&&(o.disconnect(),o.getSourceBlock().bumpNeighbours())}for(this.arguments_=[].concat(e),this.argumentVarModels_=[],e=0;e<this.arguments_.length;e++)s=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[e],""),this.argumentVarModels_.push(s);if(this.updateShape_(),this.quarkIds_=t)for(t=0;t<this.arguments_.length;t++)(e=this.quarkIds_[t])in this.quarkConnections_&&(null!=(i=this.quarkConnections_[e])&&i.reconnect(this,"ARG"+t)||delete this.quarkConnections_[e])}},updateShape_:function(){for(var e=0;e<this.arguments_.length;e++){var t=this.getField("ARGNAME"+e);if(t){r.disable$$module$build$src$core$events$utils();try{t.setValue(this.arguments_[e])}finally{r.enable$$module$build$src$core$events$utils()}}else t=r.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[e]}),this.appendValueInput("ARG"+e).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT).appendField(t,"ARGNAME"+e)}for(e=this.arguments_.length;this.getInput("ARG"+e);e++)this.removeInput("ARG"+e);(e=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||e.appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"):this.getField("WITH")&&e.removeField("WITH"))},mutationToDom:function(){var t=r.createElement$$module$build$src$core$utils$xml("mutation");t.setAttribute("name",this.getProcedureCall());for(let e=0;e<this.arguments_.length;e++){var i=r.createElement$$module$build$src$core$utils$xml("arg");i.setAttribute("name",this.arguments_[e]),t.appendChild(i)}return t},domToMutation:function(i){var s=i.getAttribute("name"),o=(this.renameProcedure(this.getProcedureCall(),s),s=[],[]);for(let e=0,t;t=i.childNodes[e];e++)"arg"===t.nodeName.toLowerCase()&&(s.push(t.getAttribute("name")),o.push(t.getAttribute("paramId")));this.setProcedureParameters_(s,o)},saveExtraState:function(){var e=Object.create(null);return e.name=this.getProcedureCall(),this.arguments_.length&&(e.params=this.arguments_),e},loadExtraState:function(e){var t;this.renameProcedure(this.getProcedureCall(),e.name),(e=e.params)&&((t=[]).length=e.length,t.fill(null),this.setProcedureParameters_(e,t))},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(e){var t,i,s,o;this.workspace&&!this.workspace.isFlyout&&e.recordUndo&&(e.type===r.BLOCK_CREATE$$module$build$src$core$events$events&&e.ids.includes(this.id)?(t=this.getProcedureCall(),(i=!(i=r.getDefinition$$module$build$src$core$procedures(t,this.workspace))||i.type===this.defType_&&JSON.stringify(i.getVars())===JSON.stringify(this.arguments_)?i:null)?i.isEnabled()||(this.setDisabledReason(!0,m),this.setWarningText(r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",t))):(r.setGroup$$module$build$src$core$events$utils(e.group),e=r.createElement$$module$build$src$core$utils$xml("xml"),(t=r.createElement$$module$build$src$core$utils$xml("block")).setAttribute("type",this.defType_),s=(i=this.getRelativeToSurfaceXY()).y+2*r.config$$module$build$src$core$config.snapRadius,t.setAttribute("x",""+(i.x+r.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1))),t.setAttribute("y",""+s),i=this.mutationToDom(),t.appendChild(i),(i=r.createElement$$module$build$src$core$utils$xml("field")).setAttribute("name","NAME"),(s=this.getProcedureCall())!==(o=r.findLegalName$$module$build$src$core$procedures(s,this))&&this.renameProcedure(s,o),i.appendChild(r.createTextNode$$module$build$src$core$utils$xml(s)),t.appendChild(i),e.appendChild(t),r.domToWorkspace$$module$build$src$core$xml(e,this.workspace),r.setGroup$$module$build$src$core$events$utils(!1))):e.type===r.BLOCK_DELETE$$module$build$src$core$events$events?(t=this.getProcedureCall(),r.getDefinition$$module$build$src$core$procedures(t,this.workspace)||(r.setGroup$$module$build$src$core$events$utils(e.group),this.dispose(!0),r.setGroup$$module$build$src$core$events$utils(!1))):e.type===r.BLOCK_CHANGE$$module$build$src$core$events$events&&"disabled"===e.element&&(t=this.getProcedureCall(),s=r.getDefinition$$module$build$src$core$procedures(t,this.workspace))&&s.id===e.blockId&&((i=r.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),r.setGroup$$module$build$src$core$events$utils(e.group),e=s.isEnabled(),this.setDisabledReason(!e,m),this.setWarningText(e?null:r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",t)),r.setGroup$$module$build$src$core$events$utils(i)))},customContextMenu:function(e){var t,i;this.workspace.isMovable()&&(t=this.getProcedureCall(),i=this.workspace,e.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){var e=r.getDefinition$$module$build$src$core$procedures(t,i);e&&(i.centerOnBlock(e.id),r.getFocusManager$$module$build$src$core$focus_manager().focusNode(e))}}))}},p=(d.procedures_callnoreturn=Object.assign({},p,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defnoreturn"}),d.procedures_callreturn=Object.assign({},p,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defreturn"}),d.procedures_ifreturn={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("value",String(Number(this.hasReturnValue_))),e},domToMutation:function(e){this.hasReturnValue_="1"===e.getAttribute("value"),this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(e){if(!(this.workspace.isDragging&&this.workspace.isDragging()||e.type!==r.BLOCK_MOVE$$module$build$src$core$events$events&&e.type!==r.BLOCK_CREATE$$module$build$src$core$events$events)){e=!1;var t=this;do{if(this.FUNCTION_TYPES.includes(t.type)){e=!0;break}}while(t=t.getSurroundParent());if(e?("procedures_defnoreturn"===t.type&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):"procedures_defreturn"!==t.type||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),!this.isInFlyout)try{r.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!e,"UNPARENTED_IFRETURN")}finally{r.setRecordUndo$$module$build$src$core$events$utils(!0)}}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]},r.defineBlocks$$module$build$src$core$common(d),{blocks:d}),_=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["Ï€","PI"],["e","E"],["Ï†","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt(Â½)","SQRT1_2"],["âˆž","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]),b=(r.register$$module$build$src$core$extensions("math_op_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"})),{mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation"),t="DIVISIBLE_BY"===this.getFieldValue("PROPERTY");return e.setAttribute("divisor_input",String(t)),e},domToMutation:function(e){e="true"===e.getAttribute("divisor_input"),this.updateShape_(e)},updateShape_:function(e){var t=this.getInput("DIVISOR");e?t||this.appendValueInput("DIVISOR").setCheck("Number"):t&&this.removeInput("DIVISOR")}}),b=(r.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",b,function(){this.getField("PROPERTY").setValidator(function(e){e="DIVISIBLE_BY"===e,this.getSourceBlock().updateShape_(e)})}),r.register$$module$build$src$core$extensions("math_change_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR")),{updateType_:function(e){"MODE"===e?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("op",this.getFieldValue("OP")),e},domToMutation:function(e){if(null===(e=e.getAttribute("op")))throw new TypeError("xmlElement had no op attribute");this.updateType_(e)}}),b=(r.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",b,function(){this.getField("OP").setValidator(function(e){this.updateType_(e)}.bind(this))}),r.defineBlocks$$module$build$src$core$common(_),{blocks:_}),f=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]),T=(r.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",{WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"})),r.register$$module$build$src$core$extensions("controls_flow_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",{BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"})),{customContextMenu:function(e){var t,i;this.isInFlyout||(i=(t=this.getField("VAR")).getVariable().getName(),this.isCollapsed())||null===i||(t={type:"variables_get",fields:{VAR:t.saveState(!0)}},e.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",i),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,t)}))}}),E=(r.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",T),r.register$$module$build$src$core$extensions("controls_for_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),r.register$$module$build$src$core$extensions("controls_forEach_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR")),new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"])),T=(r.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",{getSurroundLoop:function(){let e=this;do{if(E.has(e.type))return e}while(e=e.getSurroundParent());return null},onchange:function(e){var t=this.workspace;if(t.isDragging&&!t.isDragging()&&(e.type===r.BLOCK_MOVE$$module$build$src$core$events$events||e.type===r.BLOCK_CREATE$$module$build$src$core$events$events)&&(e=!!this.getSurroundLoop(),this.setWarningText(e?null:r.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout))try{r.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!e,"CONTROL_FLOW_NOT_IN_LOOP")}finally{r.setRecordUndo$$module$build$src$core$events$utils(!0)}}}),r.defineBlocks$$module$build$src$core$common(f),{blocks:f,loopTypes:E}),v=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["â‰ ","NEQ"],["â€<","LT"],["â€â‰¤","LTE"],["â€>","GT"],["â€â‰¥","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]),y=(r.register$$module$build$src$core$extensions("logic_op_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("OP",{EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"})),{elseifCount_:0,elseCount_:0,mutationToDom:function(){var e;return this.elseifCount_||this.elseCount_?(e=r.createElement$$module$build$src$core$utils$xml("mutation"),this.elseifCount_&&e.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&e.setAttribute("else","1"),e):null},domToMutation:function(e){this.elseifCount_=parseInt(e.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(e.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){var e;return this.elseifCount_||this.elseCount_?(e=Object.create(null),this.elseifCount_&&(e.elseIfCount=this.elseifCount_),this.elseCount_&&(e.hasElse=!0),e):null},loadExtraState:function(e){this.elseifCount_=e.elseIfCount||0,this.elseCount_=e.hasElse?1:0,this.updateShape_()},decompose:function(t){var e=t.newBlock("controls_if_if");e.initSvg();let i=e.nextConnection;for(let e=1;e<=this.elseifCount_;e++){var s=t.newBlock("controls_if_elseif");s.initSvg(),i.connect(s.previousConnection),i=s.nextConnection}return this.elseCount_&&((t=t.newBlock("controls_if_else")).initSvg(),i.connect(t.previousConnection)),e},compose:function(e){e=e.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;var t=[null],i=[null];let s=null;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":this.elseifCount_++,t.push(e.valueConnection_),i.push(e.statementConnection_);break;case"controls_if_else":this.elseCount_++,s=e.statementConnection_;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(t,i,s)},saveConnections:function(e){e=e.nextConnection.targetBlock();let t=1;for(;e;){if(!e.isInsertionMarker())switch(e.type){case"controls_if_elseif":var i=this.getInput("IF"+t),s=this.getInput("DO"+t);e.valueConnection_=i&&i.connection.targetConnection,e.statementConnection_=s&&s.connection.targetConnection,t++;break;case"controls_if_else":i=this.getInput("ELSE"),e.statementConnection_=i&&i.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+e.type)}e=e.getNextBlock()}},rebuildShape_:function(){var t=[null],i=[null];let e=null;this.getInput("ELSE")&&(e=this.getInput("ELSE").connection.targetConnection);for(let e=1;this.getInput("IF"+e);e++){var s=this.getInput("IF"+e),o=this.getInput("DO"+e);t.push(s.connection.targetConnection),i.push(o.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(t,i,e)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var e=1;this.getInput("IF"+e);e++)this.removeInput("IF"+e),this.removeInput("DO"+e);for(e=1;e<=this.elseifCount_;e++)this.appendValueInput("IF"+e).setCheck("Boolean").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+e).appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(t,i,e){for(let e=1;e<=this.elseifCount_;e++){var s;null!=(s=t[e])&&s.reconnect(this,"IF"+e),null!=(s=i[e])&&s.reconnect(this,"DO"+e)}null!=e&&e.reconnect(this,"ELSE")}}),k=(r.registerMutator$$module$build$src$core$extensions("controls_if_mutator",y,null,["controls_if_elseif","controls_if_else"]),r.register$$module$build$src$core$extensions("controls_if_tooltip",function(){this.setTooltip(function(){return this.elseifCount_||this.elseCount_?!this.elseifCount_&&this.elseCount_?r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2:this.elseifCount_&&!this.elseCount_?r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3:this.elseifCount_&&this.elseCount_?r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4:"":r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1}.bind(this))}),{onchange:function(e){this.prevBlocks_||(this.prevBlocks_=[null,null]);var t=this.getInputTargetBlock("A"),i=this.getInputTargetBlock("B");t&&i&&!this.workspace.connectionChecker.doTypeChecks(t.outputConnection,i.outputConnection)&&(r.setGroup$$module$build$src$core$events$utils(e.group),(e=this.prevBlocks_[0])!==t&&(t.unplug(),!e||e.isDisposed()||e.isShadow()||this.getInput("A").connection.connect(e.outputConnection)),(t=this.prevBlocks_[1])!==i&&(i.unplug(),!t||t.isDisposed()||t.isShadow()||this.getInput("B").connection.connect(t.outputConnection)),this.bumpNeighbours(),r.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}}),y=(r.register$$module$build$src$core$extensions("logic_compare",function(){this.mixin(k)}),{prevParentConnection_:null,onchange:function(t){var i=this.getInputTargetBlock("THEN"),s=this.getInputTargetBlock("ELSE"),o=this.outputConnection.targetConnection;if((i||s)&&o)for(let e=0;e<2;e++){var n=1===e?i:s;n&&!n.workspace.connectionChecker.doTypeChecks(n.outputConnection,o)&&(r.setGroup$$module$build$src$core$events$utils(t.group),(o===this.prevParentConnection_?(this.unplug(),o.getSourceBlock()):(n.unplug(),n)).bumpNeighbours(),r.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=o}}),y=(r.registerMixin$$module$build$src$core$extensions("logic_ternary",y),r.defineBlocks$$module$build$src$core$common(v),{blocks:v}),I=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),C=(I.lists_create_with={init:function(){this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("items",String(this.itemCount_)),e},domToMutation:function(e){if(!(e=e.getAttribute("items")))throw new TypeError("element did not have items");this.itemCount_=parseInt(e,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(e){this.itemCount_=e.itemCount,this.updateShape_()},decompose:function(t){var e=t.newBlock("lists_create_with_container");e.initSvg();let i=e.getInput("STACK").connection;for(let e=0;e<this.itemCount_;e++){var s=t.newBlock("lists_create_with_item");if(s.initSvg(),!s.previousConnection)throw Error("itemBlock has no previousConnection");i.connect(s.previousConnection),i=s.nextConnection}return e},compose:function(e){var t,i=e.getInputTargetBlock("STACK");for(e=[];i;)i.isInsertionMarker()||e.push(i.valueConnection_),i=i.getNextBlock();for(i=0;i<this.itemCount_;i++){var s=this.getInput("ADD"+i).connection.targetConnection;s&&!e.includes(s)&&s.disconnect()}for(this.itemCount_=e.length,this.updateShape_(),i=0;i<this.itemCount_;i++)null!=(t=e[i])&&t.reconnect(this,"ADD"+i)},saveConnections:function(e){e=e.getInputTargetBlock("STACK");let t=0;for(;e;){var i;e.isInsertionMarker()?e=e.getNextBlock():(i=this.getInput("ADD"+t),e.valueConnection_=null==i?void 0:i.connection.targetConnection,e=e.getNextBlock(),t++)}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var e,t=0;t<this.itemCount_;t++)this.getInput("ADD"+t)||(e=this.appendValueInput("ADD"+t).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT),0===t&&e.appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH));for(t=this.itemCount_;this.getInput("ADD"+t);t++)this.removeInput("ADD"+t)}},{init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}}),C=(I.lists_create_with_container=C,{init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}}),C=(I.lists_create_with_item=C,{init:function(){var e=[[r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),!(e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})))throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(e,"END"),this.setInputsInline(!0),this.setTooltip(()=>r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))}}),C=(I.lists_indexOf=C,{init:function(){var e=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),(e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e})).setValidator(function(e){e="REMOVE"===e,this.getSourceBlock().updateStatement_(e)}),this.appendValueInput("VALUE").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),(e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS})).setValidator(function(e){var t=this.getValue();(e="FROM_START"===e||"FROM_END"===e)!==("FROM_START"===t||"FROM_END"===t)&&this.getSourceBlock().updateAt_(e)}),this.appendDummyInput().appendField(e,"WHERE"),this.appendDummyInput("AT"),r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip(()=>{var e=this.getFieldValue("MODE"),t=this.getFieldValue("WHERE");let i="";switch(e+" "+t){case"GET FROM_START":case"GET FROM_END":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":i=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return"FROM_START"!==t&&"FROM_END"!==t||(i+="  "+("FROM_START"===t?r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),i})},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation"),t=(e.setAttribute("statement",String(!this.outputConnection)),this.getInput("AT")instanceof r.ValueInput$$module$build$src$core$inputs$value_input);return e.setAttribute("at",String(t)),e},domToMutation:function(e){var t="true"===e.getAttribute("statement");this.updateStatement_(t),e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(e){e.isStatement?this.updateStatement_(!0):"string"==typeof e&&this.domToMutation(r.textToDom$$module$build$src$core$utils$xml(e))},updateStatement_:function(e){e!==!this.outputConnection&&(this.unplug(!0,!0),e?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"),r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}}),C=(I.lists_getIndex=C,{init:function(){var e=[[r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:e}),this.appendDummyInput().appendField(e,"MODE").appendField("","SPACE"),(e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS})).setValidator(function(e){var t=this.getValue();(e="FROM_START"===e||"FROM_END"===e)!==("FROM_START"===t||"FROM_END"===t)&&this.getSourceBlock().updateAt_(e)}),this.appendDummyInput().appendField(e,"WHERE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip(()=>{var e=this.getFieldValue("MODE"),t=this.getFieldValue("WHERE");let i="";switch(e+" "+t){case"SET FROM_START":case"SET FROM_END":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":i=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return"FROM_START"!==t&&"FROM_END"!==t||(i+="  "+r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),i})},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation"),t=this.getInput("AT")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at",String(t)),e},domToMutation:function(e){e="false"!==e.getAttribute("at"),this.updateAt_(e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e){this.removeInput("AT"),this.removeInput("ORDINAL",!0),e?(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO")}}),C=(I.lists_setIndex=C,{init:function(){this.WHERE_OPTIONS_1=[[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST);var e=i=>{var e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+i]});return e.setValidator(function(e){var t=this.getValue();(e="FROM_START"===e||"FROM_END"===e)!==("FROM_START"===t||"FROM_END"===t)&&this.getSourceBlock().updateAt_(i,e)}),e};this.appendDummyInput("WHERE1_INPUT").appendField(e(1),"WHERE1"),this.appendDummyInput("AT1"),this.appendDummyInput("WHERE2_INPUT").appendField(e(2),"WHERE2"),this.appendDummyInput("AT2"),r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation"),t=this.getInput("AT1")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return e.setAttribute("at1",String(t)),t=this.getInput("AT2")instanceof r.ValueInput$$module$build$src$core$inputs$value_input,e.setAttribute("at2",String(t)),e},domToMutation:function(e){var t="true"===e.getAttribute("at1");e="true"===e.getAttribute("at2"),this.updateAt_(1,t),this.updateAt_(2,e)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(e,t){this.removeInput("AT"+e),this.removeInput("ORDINAL"+e,!0),t?(this.appendValueInput("AT"+e).setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+e).appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+e),1===e&&(this.moveInputBefore("AT1","WHERE2_INPUT"),this.getInput("ORDINAL1"))&&this.moveInputBefore("ORDINAL1","WHERE2_INPUT"),r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}}),C=(I.lists_getSublist=C,I.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},I.lists_split={init:function(){var e=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[r.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!e)throw Error("field_dropdown not found");e.setValidator(e=>{this.updateType_(e)}),this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(e,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(r.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip(()=>{var e=this.getFieldValue("MODE");if("SPLIT"===e)return r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if("JOIN"===e)return r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+e)})},updateType_:function(e){var t,i;this.getFieldValue("MODE")!==e&&((t=this.getInput("INPUT").connection).setShadowDom(null),i=t.targetBlock())&&(t.disconnect(),i.isShadow()?i.dispose(!1):this.bumpNeighbours()),"SPLIT"===e?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){var e=r.createElement$$module$build$src$core$utils$xml("mutation");return e.setAttribute("mode",this.getFieldValue("MODE")),e},domToMutation:function(e){this.updateType_(e.getAttribute("mode"))},saveExtraState:function(){return{mode:this.getFieldValue("MODE")}},loadExtraState:function(e){this.updateType_(e.mode)}},r.defineBlocks$$module$build$src$core$common(I),{blocks:I}),I={blocks:Object.assign({},I,v,f,_,d,c,i,e),lists:C,logic:y,loops:T,math:b,procedures:p,texts:u,variables:s,variablesDynamic:t};return I.__namespace__=r,I},"function"==typeof define&&define.amd?define(["./blockly_compressed.js"],o):"object"==typeof i?t.exports=o(e("./blockly_compressed.js")):s.Blockly.libraryBlocks=o(s.Blockly)},{"./blockly_compressed.js":171}],174:[function(e,t,i){t.exports=e("./blockly_compressed.js")},{"./blockly_compressed.js":171}],175:[function(e,t,i){var s,o;s=this,o=function(e,t,i){return e.setLocale(t),e},"function"==typeof define&&define.amd?define(["blockly/core","blockly/msg/en","blockly/blocks"],o):"object"==typeof i?t.exports=o(e("blockly/core"),e("blockly/msg/en"),e("blockly/blocks")):s.Blockly=o(s.Blockly,s.Blockly.Msg,s.Blockly.Blocks)},{"blockly/blocks":172,"blockly/core":174,"blockly/msg/en":176}],176:[function(e,t,i){function s(){var e={Msg:Object.create(null)};return e.Msg.ADD_COMMENT="Add Comment",e.Msg.ALT_KEY="Alt",e.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="Can't delete the variable '%1' because it's part of the definition of the function '%2'",e.Msg.CHANGE_VALUE_TITLE="Change value:",e.Msg.CHROME_OS="ChromeOS",e.Msg.CLEAN_UP="Clean up Blocks",e.Msg.CLOSE="Close",e.Msg.COLLAPSED_WARNINGS_WARNING="Collapsed blocks contain warnings.",e.Msg.COLLAPSE_ALL="Collapse Blocks",e.Msg.COLLAPSE_BLOCK="Collapse Block",e.Msg.COLOUR_BLEND_COLOUR1="colour 1",e.Msg.COLOUR_BLEND_COLOUR2="colour 2",e.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",e.Msg.COLOUR_BLEND_RATIO="ratio",e.Msg.COLOUR_BLEND_TITLE="blend",e.Msg.COLOUR_BLEND_TOOLTIP="Blends two colours together with a given ratio (0.0 - 1.0).",e.Msg.COLOUR_PICKER_HELPURL="https://en.wikipedia.org/wiki/Color",e.Msg.COLOUR_PICKER_TOOLTIP="Choose a colour from the palette.",e.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",e.Msg.COLOUR_RANDOM_TITLE="random colour",e.Msg.COLOUR_RANDOM_TOOLTIP="Choose a colour at random.",e.Msg.COLOUR_RGB_BLUE="blue",e.Msg.COLOUR_RGB_GREEN="green",e.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",e.Msg.COLOUR_RGB_RED="red",e.Msg.COLOUR_RGB_TITLE="colour with",e.Msg.COLOUR_RGB_TOOLTIP="Create a colour with the specified amount of red, green, and blue. All values must be between 0 and 100.",e.Msg.COMMAND_KEY="âŒ˜ Command",e.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="break out of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="continue with next iteration of loop",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="Break out of the containing loop.",e.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="Skip the rest of this loop, and continue with the next iteration.",e.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="Warning: This block may only be used within a loop.",e.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",e.Msg.CONTROLS_FOREACH_TITLE="for each item %1 in list %2",e.Msg.CONTROLS_FOREACH_TOOLTIP="For each item in a list, set the variable '%1' to the item, and then do some statements.",e.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",e.Msg.CONTROLS_FOR_TITLE="count with %1 from %2 to %3 by %4",e.Msg.CONTROLS_FOR_TOOLTIP="Have the variable '%1' take on the values from the start number to the end number, counting by the specified interval, and do the specified blocks.",e.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="Add a condition to the if block.",e.Msg.CONTROLS_IF_ELSE_TOOLTIP="Add a final, catch-all condition to the if block.",e.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",e.Msg.CONTROLS_IF_IF_TOOLTIP="Add, remove, or reorder sections to reconfigure this if block.",e.Msg.CONTROLS_IF_MSG_ELSE="else",e.Msg.CONTROLS_IF_MSG_ELSEIF="else if",e.Msg.CONTROLS_IF_MSG_IF="if",e.Msg.CONTROLS_IF_TOOLTIP_1="If a value is true, then do some statements.",e.Msg.CONTROLS_IF_TOOLTIP_2="If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_3="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",e.Msg.CONTROLS_IF_TOOLTIP_4="If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",e.Msg.CONTROLS_REPEAT_HELPURL="https://en.wikipedia.org/wiki/For_loop",e.Msg.CONTROLS_REPEAT_INPUT_DO="do",e.Msg.CONTROLS_REPEAT_TITLE="repeat %1 times",e.Msg.CONTROLS_REPEAT_TOOLTIP="Do some statements several times.",e.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="repeat until",e.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="repeat while",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="While a value is false, then do some statements.",e.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="While a value is true, then do some statements.",e.Msg.CONTROL_KEY="Ctrl",e.Msg.COPY_SHORTCUT="Copy",e.Msg.CUT_SHORTCUT="Cut",e.Msg.DELETE_ALL_BLOCKS="Delete all %1 blocks?",e.Msg.DELETE_BLOCK="Delete Block",e.Msg.DELETE_VARIABLE="Delete the '%1' variable",e.Msg.DELETE_VARIABLE_CONFIRMATION="Delete %1 uses of the '%2' variable?",e.Msg.DELETE_X_BLOCKS="Delete %1 Blocks",e.Msg.DIALOG_CANCEL="Cancel",e.Msg.DIALOG_OK="OK",e.Msg.DISABLE_BLOCK="Disable Block",e.Msg.DUPLICATE_BLOCK="Duplicate",e.Msg.DUPLICATE_COMMENT="Duplicate Comment",e.Msg.EDIT_BLOCK_CONTENTS="Edit Block contents",e.Msg.ENABLE_BLOCK="Enable Block",e.Msg.EXPAND_ALL="Expand Blocks",e.Msg.EXPAND_BLOCK="Expand Block",e.Msg.EXTERNAL_INPUTS="External Inputs",e.Msg.HELP="Help",e.Msg.HELP_PROMPT="Press %1 for help on keyboard controls",e.Msg.INLINE_INPUTS="Inline Inputs",e.Msg.KEYBOARD_NAV_CONSTRAINED_MOVE_HINT="Use the arrow keys to move, then %1 to accept the position",e.Msg.KEYBOARD_NAV_COPIED_HINT="Copied. Press %1 to paste.",e.Msg.KEYBOARD_NAV_CUT_HINT="Cut. Press %1 to paste.",e.Msg.KEYBOARD_NAV_UNCONSTRAINED_MOVE_HINT="Hold %1 and use arrow keys to move freely, then %2 to accept the position",e.Msg.LINUX="Linux",e.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",e.Msg.LISTS_CREATE_EMPTY_TITLE="create empty list",e.Msg.LISTS_CREATE_EMPTY_TOOLTIP="Returns a list, of length 0, containing no data records",e.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="list",e.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="Add, remove, or reorder sections to reconfigure this list block.",e.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_CREATE_WITH_INPUT_WITH="create list with",e.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="Add an item to the list.",e.Msg.LISTS_CREATE_WITH_TOOLTIP="Create a list with any number of items.",e.Msg.LISTS_GET_INDEX_FIRST="first",e.Msg.LISTS_GET_INDEX_FROM_END="# from end",e.Msg.LISTS_GET_INDEX_FROM_START="#",e.Msg.LISTS_GET_INDEX_GET="get",e.Msg.LISTS_GET_INDEX_GET_REMOVE="get and remove",e.Msg.LISTS_GET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",e.Msg.LISTS_GET_INDEX_LAST="last",e.Msg.LISTS_GET_INDEX_RANDOM="random",e.Msg.LISTS_GET_INDEX_REMOVE="remove",e.Msg.LISTS_GET_INDEX_TAIL="",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="Returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="Returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="Returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="Returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="Removes and returns the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="Removes and returns the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="Removes and returns the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="Removes and returns a random item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="Removes the first item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="Removes the item at the specified position in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="Removes the last item in a list.",e.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="Removes a random item in a list.",e.Msg.LISTS_GET_SUBLIST_END_FROM_END="to # from end",e.Msg.LISTS_GET_SUBLIST_END_FROM_START="to #",e.Msg.LISTS_GET_SUBLIST_END_LAST="to last",e.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",e.Msg.LISTS_GET_SUBLIST_START_FIRST="get sub-list from first",e.Msg.LISTS_GET_SUBLIST_START_FROM_END="get sub-list from # from end",e.Msg.LISTS_GET_SUBLIST_START_FROM_START="get sub-list from #",e.Msg.LISTS_GET_SUBLIST_TAIL="",e.Msg.LISTS_GET_SUBLIST_TOOLTIP="Creates a copy of the specified portion of a list.",e.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1 is the last item.",e.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1 is the first item.",e.Msg.LISTS_INDEX_OF_FIRST="find first occurrence of item",e.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#finding-items-in-a-list",e.Msg.LISTS_INDEX_OF_LAST="find last occurrence of item",e.Msg.LISTS_INDEX_OF_TOOLTIP="Returns the index of the first/last occurrence of the item in the list. Returns %1 if item is not found.",e.Msg.LISTS_INLIST="in list",e.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",e.Msg.LISTS_ISEMPTY_TITLE="%1 is empty",e.Msg.LISTS_ISEMPTY_TOOLTIP="Returns true if the list is empty.",e.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",e.Msg.LISTS_LENGTH_TITLE="length of %1",e.Msg.LISTS_LENGTH_TOOLTIP="Returns the length of a list.",e.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",e.Msg.LISTS_REPEAT_TITLE="create list with item %1 repeated %2 times",e.Msg.LISTS_REPEAT_TOOLTIP="Creates a list consisting of the given value repeated the specified number of times.",e.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",e.Msg.LISTS_REVERSE_MESSAGE0="reverse %1",e.Msg.LISTS_REVERSE_TOOLTIP="Reverse a copy of a list.",e.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",e.Msg.LISTS_SET_INDEX_INPUT_TO="as",e.Msg.LISTS_SET_INDEX_INSERT="insert at",e.Msg.LISTS_SET_INDEX_SET="set",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="Inserts the item at the start of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="Inserts the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="Append the item to the end of a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="Inserts the item randomly in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="Sets the first item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="Sets the item at the specified position in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="Sets the last item in a list.",e.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="Sets a random item in a list.",e.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",e.Msg.LISTS_SORT_ORDER_ASCENDING="ascending",e.Msg.LISTS_SORT_ORDER_DESCENDING="descending",e.Msg.LISTS_SORT_TITLE="sort %1 %2 %3",e.Msg.LISTS_SORT_TOOLTIP="Sort a copy of a list.",e.Msg.LISTS_SORT_TYPE_IGNORECASE="alphabetic, ignore case",e.Msg.LISTS_SORT_TYPE_NUMERIC="numeric",e.Msg.LISTS_SORT_TYPE_TEXT="alphabetic",e.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",e.Msg.LISTS_SPLIT_LIST_FROM_TEXT="make list from text",e.Msg.LISTS_SPLIT_TEXT_FROM_LIST="make text from list",e.Msg.LISTS_SPLIT_TOOLTIP_JOIN="Join a list of texts into one text, separated by a delimiter.",e.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="Split text into a list of texts, breaking at each delimiter.",e.Msg.LISTS_SPLIT_WITH_DELIMITER="with delimiter",e.Msg.LOGIC_BOOLEAN_FALSE="false",e.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",e.Msg.LOGIC_BOOLEAN_TOOLTIP="Returns either true or false.",e.Msg.LOGIC_BOOLEAN_TRUE="true",e.Msg.LOGIC_COMPARE_HELPURL="https://en.wikipedia.org/wiki/Inequality_(mathematics)",e.Msg.LOGIC_COMPARE_TOOLTIP_EQ="Return true if both inputs equal each other.",e.Msg.LOGIC_COMPARE_TOOLTIP_GT="Return true if the first input is greater than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_GTE="Return true if the first input is greater than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LT="Return true if the first input is smaller than the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_LTE="Return true if the first input is smaller than or equal to the second input.",e.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="Return true if both inputs are not equal to each other.",e.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",e.Msg.LOGIC_NEGATE_TITLE="not %1",e.Msg.LOGIC_NEGATE_TOOLTIP="Returns true if the input is false. Returns false if the input is true.",e.Msg.LOGIC_NULL="null",e.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",e.Msg.LOGIC_NULL_TOOLTIP="Returns null.",e.Msg.LOGIC_OPERATION_AND="and",e.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",e.Msg.LOGIC_OPERATION_OR="or",e.Msg.LOGIC_OPERATION_TOOLTIP_AND="Return true if both inputs are true.",e.Msg.LOGIC_OPERATION_TOOLTIP_OR="Return true if at least one of the inputs is true.",e.Msg.LOGIC_TERNARY_CONDITION="test",e.Msg.LOGIC_TERNARY_HELPURL="https://en.wikipedia.org/wiki/%3F:",e.Msg.LOGIC_TERNARY_IF_FALSE="if false",e.Msg.LOGIC_TERNARY_IF_TRUE="if true",e.Msg.LOGIC_TERNARY_TOOLTIP="Check the condition in 'test'. If the condition is true, returns the 'if true' value; otherwise returns the 'if false' value.",e.Msg.MAC_OS="macOS",e.Msg.MATH_ADDITION_SYMBOL="+",e.Msg.MATH_ARITHMETIC_HELPURL="https://en.wikipedia.org/wiki/Arithmetic",e.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="Return the sum of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="Return the quotient of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="Return the difference of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="Return the product of the two numbers.",e.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="Return the first number raised to the power of the second number.",e.Msg.MATH_ATAN2_HELPURL="https://en.wikipedia.org/wiki/Atan2",e.Msg.MATH_ATAN2_TITLE="atan2 of X:%1 Y:%2",e.Msg.MATH_ATAN2_TOOLTIP="Return the arctangent of point (X, Y) in degrees from -180 to 180.",e.Msg.MATH_CHANGE_HELPURL="https://en.wikipedia.org/wiki/Programming_idiom#Incrementing_a_counter",e.Msg.MATH_CHANGE_TITLE="change %1 by %2",e.Msg.MATH_CHANGE_TOOLTIP="Add a number to variable '%1'.",e.Msg.MATH_CONSTANT_HELPURL="https://en.wikipedia.org/wiki/Mathematical_constant",e.Msg.MATH_CONSTANT_TOOLTIP="Return one of the common constants: Ï€ (3.141â€¦), e (2.718â€¦), Ï† (1.618â€¦), sqrt(2) (1.414â€¦), sqrt(Â½) (0.707â€¦), or âˆž (infinity).",e.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",e.Msg.MATH_CONSTRAIN_TITLE="constrain %1 low %2 high %3",e.Msg.MATH_CONSTRAIN_TOOLTIP="Constrain a number to be between the specified limits (inclusive).",e.Msg.MATH_DIVISION_SYMBOL="Ã·",e.Msg.MATH_IS_DIVISIBLE_BY="is divisible by",e.Msg.MATH_IS_EVEN="is even",e.Msg.MATH_IS_NEGATIVE="is negative",e.Msg.MATH_IS_ODD="is odd",e.Msg.MATH_IS_POSITIVE="is positive",e.Msg.MATH_IS_PRIME="is prime",e.Msg.MATH_IS_TOOLTIP="Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",e.Msg.MATH_IS_WHOLE="is whole",e.Msg.MATH_MODULO_HELPURL="https://en.wikipedia.org/wiki/Modulo_operation",e.Msg.MATH_MODULO_TITLE="remainder of %1 Ã· %2",e.Msg.MATH_MODULO_TOOLTIP="Return the remainder from dividing the two numbers.",e.Msg.MATH_MULTIPLICATION_SYMBOL="Ã—",e.Msg.MATH_NUMBER_HELPURL="https://en.wikipedia.org/wiki/Number",e.Msg.MATH_NUMBER_TOOLTIP="A number.",e.Msg.MATH_ONLIST_HELPURL="",e.Msg.MATH_ONLIST_OPERATOR_AVERAGE="average of list",e.Msg.MATH_ONLIST_OPERATOR_MAX="max of list",e.Msg.MATH_ONLIST_OPERATOR_MEDIAN="median of list",e.Msg.MATH_ONLIST_OPERATOR_MIN="min of list",e.Msg.MATH_ONLIST_OPERATOR_MODE="modes of list",e.Msg.MATH_ONLIST_OPERATOR_RANDOM="random item of list",e.Msg.MATH_ONLIST_OPERATOR_STD_DEV="standard deviation of list",e.Msg.MATH_ONLIST_OPERATOR_SUM="sum of list",e.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="Return the average (arithmetic mean) of the numeric values in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MAX="Return the largest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="Return the median number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MIN="Return the smallest number in the list.",e.Msg.MATH_ONLIST_TOOLTIP_MODE="Return a list of the most common item(s) in the list.",e.Msg.MATH_ONLIST_TOOLTIP_RANDOM="Return a random element from the list.",e.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="Return the standard deviation of the list.",e.Msg.MATH_ONLIST_TOOLTIP_SUM="Return the sum of all the numbers in the list.",e.Msg.MATH_POWER_SYMBOL="^",e.Msg.MATH_RANDOM_FLOAT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="random fraction",e.Msg.MATH_RANDOM_FLOAT_TOOLTIP="Return a random fraction between 0.0 (inclusive) and 1.0 (exclusive).",e.Msg.MATH_RANDOM_INT_HELPURL="https://en.wikipedia.org/wiki/Random_number_generation",e.Msg.MATH_RANDOM_INT_TITLE="random integer from %1 to %2",e.Msg.MATH_RANDOM_INT_TOOLTIP="Return a random integer between the two specified limits, inclusive.",e.Msg.MATH_ROUND_HELPURL="https://en.wikipedia.org/wiki/Rounding",e.Msg.MATH_ROUND_OPERATOR_ROUND="round",e.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="round down",e.Msg.MATH_ROUND_OPERATOR_ROUNDUP="round up",e.Msg.MATH_ROUND_TOOLTIP="Round a number up or down.",e.Msg.MATH_SINGLE_HELPURL="https://en.wikipedia.org/wiki/Square_root",e.Msg.MATH_SINGLE_OP_ABSOLUTE="absolute",e.Msg.MATH_SINGLE_OP_ROOT="square root",e.Msg.MATH_SINGLE_TOOLTIP_ABS="Return the absolute value of a number.",e.Msg.MATH_SINGLE_TOOLTIP_EXP="Return e to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LN="Return the natural logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_LOG10="Return the base 10 logarithm of a number.",e.Msg.MATH_SINGLE_TOOLTIP_NEG="Return the negation of a number.",e.Msg.MATH_SINGLE_TOOLTIP_POW10="Return 10 to the power of a number.",e.Msg.MATH_SINGLE_TOOLTIP_ROOT="Return the square root of a number.",e.Msg.MATH_SUBTRACTION_SYMBOL="-",e.Msg.MATH_TRIG_ACOS="acos",e.Msg.MATH_TRIG_ASIN="asin",e.Msg.MATH_TRIG_ATAN="atan",e.Msg.MATH_TRIG_COS="cos",e.Msg.MATH_TRIG_HELPURL="https://en.wikipedia.org/wiki/Trigonometric_functions",e.Msg.MATH_TRIG_SIN="sin",e.Msg.MATH_TRIG_TAN="tan",e.Msg.MATH_TRIG_TOOLTIP_ACOS="Return the arccosine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ASIN="Return the arcsine of a number.",e.Msg.MATH_TRIG_TOOLTIP_ATAN="Return the arctangent of a number.",e.Msg.MATH_TRIG_TOOLTIP_COS="Return the cosine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_SIN="Return the sine of a degree (not radian).",e.Msg.MATH_TRIG_TOOLTIP_TAN="Return the tangent of a degree (not radian).",e.Msg.MOVE_BLOCK="Move Block",e.Msg.NEW_COLOUR_VARIABLE="Create colour variable...",e.Msg.NEW_NUMBER_VARIABLE="Create number variable...",e.Msg.NEW_STRING_VARIABLE="Create string variable...",e.Msg.NEW_VARIABLE="Create variable...",e.Msg.NEW_VARIABLE_TITLE="New variable name:",e.Msg.NEW_VARIABLE_TYPE_TITLE="New variable type:",e.Msg.OPTION_KEY="âŒ¥ Option",e.Msg.ORDINAL_NUMBER_SUFFIX="",e.Msg.PASTE_SHORTCUT="Paste",e.Msg.PROCEDURES_ALLOW_STATEMENTS="allow statements",e.Msg.PROCEDURES_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="Run the user-defined function '%1'.",e.Msg.PROCEDURES_CALLRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_CALLRETURN_TOOLTIP="Run the user-defined function '%1' and use its output.",e.Msg.PROCEDURES_CALL_BEFORE_PARAMS="with:",e.Msg.PROCEDURES_CALL_DISABLED_DEF_WARNING="Can't run the user-defined function '%1' because the definition block is disabled.",e.Msg.PROCEDURES_CREATE_DO="Create '%1'",e.Msg.PROCEDURES_DEFNORETURN_COMMENT="Describe this function...",e.Msg.PROCEDURES_DEFNORETURN_DO="",e.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="do something",e.Msg.PROCEDURES_DEFNORETURN_TITLE="to",e.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="Creates a function with no output.",e.Msg.PROCEDURES_DEFRETURN_HELPURL="https://en.wikipedia.org/wiki/Subroutine",e.Msg.PROCEDURES_DEFRETURN_RETURN="return",e.Msg.PROCEDURES_DEFRETURN_TOOLTIP="Creates a function with an output.",e.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="Warning: This function has duplicate parameters.",e.Msg.PROCEDURES_HIGHLIGHT_DEF="Highlight function definition",e.Msg.PROCEDURES_IFRETURN_HELPURL="https://c2.com/cgi/wiki?GuardClause",e.Msg.PROCEDURES_IFRETURN_TOOLTIP="If a value is true, then return a second value.",e.Msg.PROCEDURES_IFRETURN_WARNING="Warning: This block may be used only within a function definition.",e.Msg.PROCEDURES_MUTATORARG_TITLE="input name:",e.Msg.PROCEDURES_MUTATORARG_TOOLTIP="Add an input to the function.",e.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="inputs",e.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="Add, remove, or reorder inputs to this function.",e.Msg.REDO="Redo",e.Msg.REMOVE_COMMENT="Remove Comment",e.Msg.RENAME_VARIABLE="Rename variable...",e.Msg.RENAME_VARIABLE_TITLE="Rename all '%1' variables to:",e.Msg.SHORTCUTS_CODE_NAVIGATION="Code navigation",e.Msg.SHORTCUTS_EDITING="Editing",e.Msg.SHORTCUTS_GENERAL="General",e.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_APPEND_TITLE="to %1 append text %2",e.Msg.TEXT_APPEND_TOOLTIP="Append some text to variable '%1'.",e.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",e.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="to lower case",e.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="to Title Case",e.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="to UPPER CASE",e.Msg.TEXT_CHANGECASE_TOOLTIP="Return a copy of the text in a different case.",e.Msg.TEXT_CHARAT_FIRST="get first letter",e.Msg.TEXT_CHARAT_FROM_END="get letter # from end",e.Msg.TEXT_CHARAT_FROM_START="get letter #",e.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",e.Msg.TEXT_CHARAT_LAST="get last letter",e.Msg.TEXT_CHARAT_RANDOM="get random letter",e.Msg.TEXT_CHARAT_TAIL="",e.Msg.TEXT_CHARAT_TITLE="in text %1 %2",e.Msg.TEXT_CHARAT_TOOLTIP="Returns the letter at the specified position.",e.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",e.Msg.TEXT_COUNT_MESSAGE0="count %1 in %2",e.Msg.TEXT_COUNT_TOOLTIP="Count how many times some text occurs within some other text.",e.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="Add an item to the text.",e.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="join",e.Msg.TEXT_CREATE_JOIN_TOOLTIP="Add, remove, or reorder sections to reconfigure this text block.",e.Msg.TEXT_GET_SUBSTRING_END_FROM_END="to letter # from end",e.Msg.TEXT_GET_SUBSTRING_END_FROM_START="to letter #",e.Msg.TEXT_GET_SUBSTRING_END_LAST="to last letter",e.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",e.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="in text",e.Msg.TEXT_GET_SUBSTRING_START_FIRST="get substring from first letter",e.Msg.TEXT_GET_SUBSTRING_START_FROM_END="get substring from letter # from end",e.Msg.TEXT_GET_SUBSTRING_START_FROM_START="get substring from letter #",e.Msg.TEXT_GET_SUBSTRING_TAIL="",e.Msg.TEXT_GET_SUBSTRING_TOOLTIP="Returns a specified portion of the text.",e.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",e.Msg.TEXT_INDEXOF_OPERATOR_FIRST="find first occurrence of text",e.Msg.TEXT_INDEXOF_OPERATOR_LAST="find last occurrence of text",e.Msg.TEXT_INDEXOF_TITLE="in text %1 %2 %3",e.Msg.TEXT_INDEXOF_TOOLTIP="Returns the index of the first/last occurrence of the first text in the second text. Returns %1 if text is not found.",e.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",e.Msg.TEXT_ISEMPTY_TITLE="%1 is empty",e.Msg.TEXT_ISEMPTY_TOOLTIP="Returns true if the provided text is empty.",e.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",e.Msg.TEXT_JOIN_TITLE_CREATEWITH="create text with",e.Msg.TEXT_JOIN_TOOLTIP="Create a piece of text by joining together any number of items.",e.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",e.Msg.TEXT_LENGTH_TITLE="length of %1",e.Msg.TEXT_LENGTH_TOOLTIP="Returns the number of letters (including spaces) in the provided text.",e.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",e.Msg.TEXT_PRINT_TITLE="print %1",e.Msg.TEXT_PRINT_TOOLTIP="Print the specified text, number or other value.",e.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",e.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="Prompt for user for a number.",e.Msg.TEXT_PROMPT_TOOLTIP_TEXT="Prompt for user for some text.",e.Msg.TEXT_PROMPT_TYPE_NUMBER="prompt for number with message",e.Msg.TEXT_PROMPT_TYPE_TEXT="prompt for text with message",e.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",e.Msg.TEXT_REPLACE_MESSAGE0="replace %1 with %2 in %3",e.Msg.TEXT_REPLACE_TOOLTIP="Replace all occurances of some text within some other text.",e.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",e.Msg.TEXT_REVERSE_MESSAGE0="reverse %1",e.Msg.TEXT_REVERSE_TOOLTIP="Reverses the order of the characters in the text.",e.Msg.TEXT_TEXT_HELPURL="https://en.wikipedia.org/wiki/String_(computer_science)",e.Msg.TEXT_TEXT_TOOLTIP="A letter, word, or line of text.",e.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",e.Msg.TEXT_TRIM_OPERATOR_BOTH="trim spaces from both sides of",e.Msg.TEXT_TRIM_OPERATOR_LEFT="trim spaces from left side of",e.Msg.TEXT_TRIM_OPERATOR_RIGHT="trim spaces from right side of",e.Msg.TEXT_TRIM_TOOLTIP="Return a copy of the text with spaces removed from one or both ends.",e.Msg.TODAY="Today",e.Msg.UNDO="Undo",e.Msg.UNKNOWN="Unknown",e.Msg.UNNAMED_KEY="unnamed",e.Msg.VARIABLES_DEFAULT_NAME="item",e.Msg.VARIABLES_GET_CREATE_SET="Create 'set %1'",e.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",e.Msg.VARIABLES_GET_TOOLTIP="Returns the value of this variable.",e.Msg.VARIABLES_SET="set %1 to %2",e.Msg.VARIABLES_SET_CREATE_GET="Create 'get %1'",e.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",e.Msg.VARIABLES_SET_TOOLTIP="Sets this variable to be equal to the input.",e.Msg.VARIABLE_ALREADY_EXISTS="A variable named '%1' already exists.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="A variable named '%1' already exists for another type: '%2'.",e.Msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER="A variable named '%1' already exists as a parameter in the procedure '%2'.",e.Msg.WINDOWS="Windows",e.Msg.WORKSPACE_ARIA_LABEL="Blockly Workspace",e.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="Say something...",e.Msg.CONTROLS_FOREACH_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_FOR_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=e.Msg.CONTROLS_IF_MSG_ELSEIF,e.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=e.Msg.CONTROLS_IF_MSG_ELSE,e.Msg.CONTROLS_IF_IF_TITLE_IF=e.Msg.CONTROLS_IF_MSG_IF,e.Msg.CONTROLS_IF_MSG_THEN=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=e.Msg.CONTROLS_REPEAT_INPUT_DO,e.Msg.LISTS_CREATE_WITH_ITEM_TITLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.LISTS_GET_INDEX_HELPURL=e.Msg.LISTS_INDEX_OF_HELPURL,e.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=e.Msg.LISTS_INLIST,e.Msg.MATH_CHANGE_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.PROCEDURES_DEFRETURN_COMMENT=e.Msg.PROCEDURES_DEFNORETURN_COMMENT,e.Msg.PROCEDURES_DEFRETURN_DO=e.Msg.PROCEDURES_DEFNORETURN_DO,e.Msg.PROCEDURES_DEFRETURN_PROCEDURE=e.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,e.Msg.PROCEDURES_DEFRETURN_TITLE=e.Msg.PROCEDURES_DEFNORETURN_TITLE,e.Msg.TEXT_APPEND_VARIABLE=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=e.Msg.VARIABLES_DEFAULT_NAME,e.Msg.MATH_HUE="230",e.Msg.LOOPS_HUE="120",e.Msg.LISTS_HUE="260",e.Msg.LOGIC_HUE="210",e.Msg.VARIABLES_HUE="330",e.Msg.TEXTS_HUE="160",e.Msg.PROCEDURES_HUE="290",e.Msg.COLOUR_HUE="20",e.Msg.VARIABLES_DYNAMIC_HUE="310",e.Msg}var o=this;if("function"==typeof define&&define.amd)define([],s);else if("object"==typeof i)t.exports=s();else{var n,r=s();for(n in r)o.Blockly.Msg[n]=r[n]}},{}]},{},[165]);