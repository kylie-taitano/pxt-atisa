(c=>{var e;{var u=c.analytics||(c.analytics={});let s={},o={},i=!1,l;function n(t){Object.keys(t).forEach(e=>{"string"==typeof t[e]?s[e]=t[e]:o[e]=t[e]})}(e=l=u.ConsoleTickOptions||(u.ConsoleTickOptions={}))[e.Off=0]="Off",e[e.Short=1]="Short",e[e.Verbose=2]="Verbose",u.consoleTicks=l.Off,u.addDefaultProperties=n,u.enable=function(t){if(c.aiTrackException&&c.aiTrackEvent&&!i){i=!0,n({lang:t="string"==typeof t&&0!=t.length?t:"en"}),c.debug("setting up app insights");let a=c.tickEvent,r=(c.tickEvent=function(e,r,t){var i,n;if(r=c.Util.cleanData(r),u.consoleTicks!=l.Off&&(i=u.consoleTicks==l.Short?"":(new Date).toLocaleTimeString(void 0,{hour12:!1})+" - Tick - ",n=`${e} ${r?JSON.stringify(r):"<no data>"} `+(t?JSON.stringify(t):"<no opts>"),c.log(i+n)),a&&a(e,r,t),null!=t&&t.interactiveConsent&&c.setInteractiveConsent(!0),r){let t=Object.assign({},s),i=Object.assign({},o);Object.keys(r).forEach(e=>{"string"==typeof r[e]?t[e]=r[e]:"number"==typeof r[e]?i[e]=r[e]:t[e]=JSON.stringify(r[e]||"")}),c.aiTrackEvent(e,t,i)}else c.aiTrackEvent(e)},c.reportException),e=(c.reportException=function(e,t){t=c.Util.cleanData(t),r&&r(e,t);var i={target:c.appTarget.id,version:c.appTarget.versions.target};t&&c.Util.jsonMergeFrom(i,t),c.aiTrackException(e,"exception",i)},c.reportError);c.reportError=function(t,i,r){r=c.Util.cleanData(r),e&&e(t,i,r);try{throw i}catch(e){t={target:c.appTarget.id,version:c.appTarget.versions.target,category:t,message:i};r&&c.Util.jsonMergeFrom(t,r),c.aiTrackException(e,"error",t)}}}},u.trackPerformanceReport=function(){var e,t;c.perf.perfReportLogged||(e=c.perf.report())&&({durations:e,milestones:t}=e,c.tickEvent("performance.milestones",t),c.tickEvent("performance.durations",e))}}})(pxt=(pxt=pxt||{})||{}),(e=>{{e=e.AudioContextManager||(e.AudioContextManager={});let i=0,r,n,a,s=!1;function o(){return r=r||(()=>{if(window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext)try{return new window.AudioContext}catch(e){}})()}function t(){r&&(a.gain.setTargetAtTime(0,r.currentTime,.015),i=0)}e.mute=function(e){r&&(s=e,t(),e)&&n&&(n.disconnect(),a.disconnect(),n=void 0,a=void 0)},e.stop=t,e.frequency=function(){return i},e.tone=function(e){if(!s&&!(isNaN(e)||e<0)){i=e;var t=o();if(t)try{n||((n=t.createOscillator()).type="triangle",(a=t.createGain()).gain.value=0,a.connect(t.destination),n.connect(a),n.start(0)),n.frequency.linearRampToValueAtTime(e,r.currentTime),a.gain.setTargetAtTime(.2,r.currentTime,.015)}catch(e){n=void 0}}}}})(pxt=(pxt=pxt||{})||{}),(p=>{{var f=p.auth||(p.auth={});let l="auth",c="csrf-token",u="login-state",i="user-state",d="interactive-login-until",t=!1;f.DEFAULT_USER_PREFERENCES=()=>({language:p.appTarget.appTheme.defaultLocale,highContrast:!1,accessibleBlocks:!1,colorThemeIds:{},reader:"",skillmap:{mapProgress:{},completedTags:{}},email:!1});let e,s=(f.client=function(){if(!t)return e},0),o=0;async function m(e,t){return t?p.storage.shared.setAsync(l,e,t):p.storage.shared.delAsync(l,e)}async function a(e){try{return await p.storage.shared.getAsync(l,e)}catch(e){}}async function r(){var e=await a(c);return f.cachedHasAuthToken=!!e,e}async function n(){return!!await r()}async function g(){return f.cachedHasAuthToken=!1,m(c,void 0)}async function v(){let t;try{t=await p.storage.shared.getAsync(l,i)}catch(e){t={}}return f.cachedUserState=t}async function b(e){return f.cachedUserState=Object.assign({},e),p.storage.shared.setAsync(l,i,e)}async function y(){return f.cachedUserState=void 0,p.storage.shared.delAsync(l,i)}async function w(e){var t={};return(e=e||await r())&&(t.authorization="mkcd "+e),t["x-pxt-target"]=null==(e=p.appTarget)?void 0:e.id,t}f.cachedHasAuthToken=!1,f.getAuthTokenAsync=r,f.hasAuthTokenAsync=n,f.getUserStateAsync=v,f.getAuthHeadersAsync=w;class E{constructor(){this.initialUserPreferences_=void 0,this.initialAuthCheck_=void 0,this.patchQueue=[],e=this}async initAsync(){var e=await v();this.setUserProfileAsync(null==e?void 0:e.profile),this.setUserPreferencesAsync(null==e?void 0:e.preferences)}async loginAsync(e,t,i=void 0){if(k()&&(r=e,0<A().filter(e=>e.id===r).length)){i=null!=i?i:h,this.clearAuthStateAsync();var r,i={key:(Math.PI*Math.random()).toString(36).slice(2),callbackState:i,callbackPathname:window.location.pathname,idp:e,persistent:t},n=(parseInt(await a(d))||0)>Date.now(),t=p.Util.stringifyQueryString("/api/auth/login",{response_type:"token",provider:e,persistent:t,redirect_uri:""+window.location.origin+window.location.pathname+"?authcallback=1&state="+i.key,prompt:n?"select_account":"silent"}),n=await this.apiAsync(t);if(n.success)i.authCodeVerifier=n.resp.authCodeVerifier,await p.storage.shared.setAsync(l,u,i),p.tickEvent("auth.login.start",{provider:e}),window.location.href=n.resp.loginUrl;else try{await this.onSignInFailed()}catch(e){}}}async logoutAsync(e){if(k()){await E.staticLogoutAsync(e);try{await this.onStateCleared()}catch(e){}try{await this.onSignedOut()}catch(e){}}}static async staticLogoutAsync(t){if(k()){p.tickEvent("auth.logout"),await m(d,(Date.now()+6e4).toString()),t=t?t.startsWith("#")?t:"#"+t:"";t=""+window.location.origin+window.location.pathname+window.location.search+t;let e="";try{var i=p.Util.stringifyQueryString("/api/auth/logout",{redirect_uri:t,authcallback:"1"}),r=await E.staticApiAsync(i);r.success&&(e=r.resp.logoutUrl)}catch(e){}await g(),await y(),p.BrowserUtils.hasWindow()&&(e?window.location.href=e:(window.location.href=t,location.reload()))}}async deleteProfileAsync(){if(await this.loggedInAsync()){var e=await v(),e=null==(e=null==e?void 0:e.profile)?void 0:e.id,t=await this.apiAsync("/api/user",null,"DELETE");if(t.err)try{await this.onApiError(t.err)}catch(e){}else try{await this.clearAuthStateAsync();try{await this.onProfileDeleted(e)}catch(e){}}finally{p.tickEvent("auth.profile.deleted")}}}async initialUserPreferencesAsync(){if(await this.loggedInAsync())return this.initialUserPreferences_||(this.initialUserPreferences_=this.fetchUserPreferencesAsync()),this.initialUserPreferences_}async userProfileAsync(){var e;if(await this.loggedInAsync())return e=await v(),Object.assign({},e.profile)}async userPreferencesAsync(){var e=await v();return Object.assign({},e.preferences)}async authCheckAsync(){var e,t;if(k()&&await n())return null!=(e=null==(t=await v())?void 0:t.profile)&&e.id?this.initialAuthCheck_||(this.initialAuthCheck_=Promise.resolve(t.profile)):this.initialAuthCheck_||(this.initialAuthCheck_=this.fetchUserAsync()),this.initialAuthCheck_}async loggedInAsync(){return!!await this.authCheckAsync()&&this.hasUserIdAsync()}async updateUserProfileAsync(e){var t;return!!await this.loggedInAsync()&&(t=await v(),(t=await this.apiAsync("/api/user/profile",{id:t.profile.id,username:e.username,avatarUrl:e.avatarUrl})).success&&await this.setUserProfileAsync(t.resp),t.success)}async patchUserPreferencesAsync(e,t={}){let r=async()=>({success:!0,res:await this.userPreferencesAsync()});if(!(e=(e=Array.isArray(e)?e:[e]).filter(e=>!!e)).length)return r();let n=(e,t,i)=>{var r=p.U.deepCopy(e);ts.pxtc.jsonPatch.patchInPlace(r,t);let n=ts.pxtc.jsonPatch.diff(e,r);return n=n.length&&i?n.filter(i):n};var i=await this.userPreferencesAsync(),a=n(i,e,t.filter);if(!a.length)return r();if(ts.pxtc.jsonPatch.patchInPlace(i,a),await this.setUserPreferencesAsync(i),!await this.loggedInAsync())return r();this.patchQueue.push({ops:e,filter:t.filter}),clearTimeout(s);a=async()=>{if(o=0,!this.patchQueue.length)return r();var e=await this.apiAsync("/api/user/preferences");if(!e.success)return p.reportError("identity","failed to fetch preferences for patch",e),{success:!1,res:void 0};let t=p.U.deepCopy(e.resp)||f.DEFAULT_USER_PREFERENCES();var i=this.patchQueue,i=(this.patchQueue=[],i.forEach(e=>{e=n(t,e.ops,e.filter);ts.pxtc.jsonPatch.patchInPlace(t,e)}),pxtc.jsonPatch.diff(e.resp,t)),e=await this.apiAsync("/api/user/preferences",i,"PATCH");return e.success?this.setUserPreferencesAsync(e.resp):p.reportError("identity","failed to patch preferences",e),{success:e.success,res:e.resp}};return t.immediate||(o=o||p.U.now(),1e4<p.U.now()-o)?a():(s=setTimeout(a,1e3),{success:!1,res:void 0})}async hasUserIdAsync(){var e;return!!k()&&(await n()?!(null==(e=null==(e=await v())?void 0:e.profile)||!e.id):void 0)}async fetchUserAsync(){var e,t;if(k()&&await n())return null!=(e=null==(t=await v())?void 0:t.profile)&&e.id?t.profile:(e=await this.apiAsync("/api/user/profile")).success?(t=e.resp,await this.setUserProfileAsync(t),t):void 0}async setUserProfileAsync(e){var t=await this.hasUserIdAsync(),e=(await this.transformUserProfileAsync(e),await this.hasUserIdAsync());try{await this.onUserProfileChanged()}catch(e){}if(e&&!t)try{await this.onSignedIn()}catch(e){}else if(!e&&t)try{await this.onSignedOut()}catch(e){}}async setUserPreferencesAsync(e){var t=await v(),t=null!=(t=null==t?void 0:t.preferences)?t:f.DEFAULT_USER_PREFERENCES(),i=ts.pxtc.jsonPatch.diff(t,e),t=await this.transformUserPreferencesAsync(Object.assign(Object.assign({},t),e));try{await this.onUserPreferencesChanged(i)}catch(e){}return t}async fetchUserPreferencesAsync(){if(await this.loggedInAsync()){await v();var e=await this.apiAsync("/api/user/preferences");if(e.success)if(e.resp)return this.setUserPreferencesAsync(e.resp)}}async transformUserProfileAsync(e){var t=await v();return await b(t=Object.assign(Object.assign({},t),{profile:Object.assign({},e)})),t.profile}async transformUserPreferencesAsync(e){var t=await v();return await b(t=Object.assign(Object.assign({},t),{preferences:Object.assign({},e)})),t.preferences}async clearAuthStateAsync(){await g(),await y();try{await this.onStateCleared()}catch(e){}}async apiAsync(e,t,i,r){return E.staticApiAsync(e,t,i,r)}static async staticApiAsync(t,e,i,r){r=await w(r);return t=p.BrowserUtils.isLocalHostDev()?""+p.cloud.DEV_BACKEND+t:t,p.Util.requestAsync({url:t,headers:r,data:e,method:i||(e?"POST":"GET"),withCredentials:!0}).then(e=>({statusCode:e.statusCode,resp:e.json,success:2===Math.floor(e.statusCode/100),err:null})).catch(async e=>(/logout/.test(t)||401!=e.statusCode||await E.staticLogoutAsync(),{statusCode:e.statusCode,err:e,resp:null,success:!1}))}}f.AuthClient=E;let h={hash:"",params:{}};function A(){var e;return Object.keys((null==(e=null==(e=p.appTarget)?void 0:e.cloud)?void 0:e.cloudProviders)||{}).map(e=>p.appTarget.cloud.cloudProviders[e]).filter(e=>e.identity).sort((e,t)=>e.order-t.order)}function k(){return!t&&!p.BrowserUtils.isPxtElectron()&&0<A().length}function T(e,t){return e.id===t.id&&e.sourceURL===t.sourceURL}f.loginCallbackAsync=async function(e){let t,i=Object.assign({},h);do{if(!(t=await p.storage.shared.getAsync(l,u)))return void p.debug("Auth state not found in storge.");await p.storage.shared.delAsync(l,u);var r=e.state;if(!r||t.key!==r)return void p.debug("Failed to get auth state for key");i=Object.assign(Object.assign({},h),t.callbackState);r=e.error;if(r){var n=e.error_description;p.tickEvent("auth.login.error",{error:r,provider:t.idp}),p.log(`Auth failed: ${r}:`+n),i=Object.assign({},h);break}r=e.token;if(!r){p.debug("Missing authToken in auth callback.");break}t.authCodeVerifier&&(n=p.Util.stringifyQueryString("/api/otac/check",{persistent:t.persistent}),await E.staticApiAsync(n,null,null,t.authCodeVerifier)),r=r,f.cachedHasAuthToken=!!r,await m(c,r),await m(d,void 0),p.tickEvent("auth.login.success",{provider:t.idp})}while(0);var a=i.hash.startsWith("#")?i.hash:"#"+i.hash,s=p.Util.stringifyQueryString("",i.params),o=t.callbackPathname.startsWith("/")?t.callbackPathname:"/"+t.callbackPathname;window.location.href=""+o+s+a},f.identityProviders=A,f.identityProvider=function(t){return A().filter(e=>e.id===t).shift()},f.hasIdentity=k,f.enableAuth=function(e=!0){t=!e},f.userName=function(e){var t;return null!=(e=null!=(t=null==(t=null==e?void 0:e.idp)?void 0:t.displayName)?t:null==(t=null==e?void 0:e.idp)?void 0:t.username)?e:"??"},f.identityProviderId=function(e){return null==(e=null==e?void 0:e.idp)?void 0:e.provider},f.firstName=function(e){return(null==(e=p.auth.userName(e))?void 0:e.split(" ").shift())||e},f.userInitials=function(e){return e=p.auth.userName(e),ts.pxtc.Util.initials(e)},f.generateUserProfilePicDataUrl=function(e){if(null!=(t=null==(t=null==e?void 0:e.idp)?void 0:t.picture)&&t.encoded){var t=window.URL||window.webkitURL;try{var i=p.Util.stringToUint8Array(atob(e.idp.picture.encoded)),r=new Blob([i],{type:e.idp.picture.mimeType});e.idp.picture.dataUrl=t.createObjectURL(r)}catch(e){}}},f.badgeEquals=T,f.hasBadge=function(e,t){return e.badges.some(e=>T(e,t))}}})(pxt=pxt||{}),(pxt||(pxt={})).tickEvent=function(e){},(e=>{let t;var i;(i=t=e.LogLevel||(e.LogLevel={}))[i.Debug=0]="Debug",i[i.Info=1]="Info",i[i.Log=1]="Log",i[i.Warning=2]="Warning",i[i.Error=3]="Error";class r{constructor(){this.setLogLevel(t.Info)}setLogLevel(e){this.logLevel=e}getLogLevel(){return this.logLevel}info(...e){this.shouldLog(t.Info)&&null!=console&&console.info&&console.info.call(null,...e)}log(...e){this.shouldLog(t.Log)&&null!=console&&console.log&&console.log.call(null,...e)}debug(...e){this.shouldLog(t.Debug)&&null!=console&&console.debug&&console.debug.call(null,...e)}error(...e){this.shouldLog(t.Error)&&null!=console&&console.error&&console.error.call(null,...e)}warn(...e){this.shouldLog(t.Warning)&&null!=console&&console.warn&&console.warn.call(null,...e)}shouldLog(e){return e>=this.logLevel}}let n=new(e.ConsoleLogger=r);e.info=function(...e){n.info(...e)},e.log=function(...e){n.log(...e)},e.debug=function(...e){n.debug(...e)},e.error=function(...e){n.error(...e)},e.warn=function(...e){n.warn(...e)},e.setLogger=function(e){var t=null==n?void 0:n.getLogLevel();n=e,void 0!==t&&n.setLogLevel(t)},e.setLogLevel=function(e){n.setLogLevel(e)}})(pxt=pxt||{}),(e=>{(e.pxtc||(e.pxtc={})).__dummy=42})(ts=ts||{});var Measurements,pxt,ts,pxtmelody,pxtc=ts.pxtc;(a=>{a=a.pxtc||(a.pxtc={});{var l=a.Util||(a.Util={});function s(e){return e.replace(/[^\w .!?\-$]/g,e=>{e=e.charCodeAt(0).toString(16);return"\\u"+"0000".substr(0,4-e.length)+e})}l.assert=function(e,t="Assertion failed"){if(!e)throw new Error(t)},l.flatClone=function(t){if(null==t)return null;let i={};return Object.keys(t).forEach(e=>{i[e]=t[e]}),i},l.clone=function(e){return null==e?null:JSON.parse(JSON.stringify(e))},l.htmlEscape=function(e){return e&&e.replace(/([^\w .!?\-$])/g,e=>"&#"+e.charCodeAt(0)+";")},l.htmlUnescape=function(e){return e&&e.replace(/(&#\d+;)/g,e=>String.fromCharCode(Number(e.substr(2,e.length-3))))},l.jsStringQuote=s,l.jsStringLiteral=function(e){return'"'+s(e)+'"'};let t="en",i={},e={},r=!(l.initials=function(e){return(/^\w+@/.test(e)?e.match(/^\w\w/).shift():((e=e.match(/\b\w/g)||[]).shift()||"")+(e.pop()||"")).toUpperCase()});function o(){return t}function c(e){var t=/^(\w{2,3})-(\w{2,4}$)/i.exec(e);return t&&t[1]&&t[2]?[t[1].toLowerCase()+"-"+t[2].toUpperCase(),t[1].toLowerCase(),t[1].toLowerCase()+"-"+t[2].toLowerCase()]:[(e||"en").toLowerCase()]}function u(e,o){return 0==o.length?e:e.replace(/\{([0-9]+)(\:[^\}]+)?\}/g,function(e,i,t){i=o[parseInt(i)];let r="";var n=/^:f(\d*)\.(\d+)/.exec(t);if(n){var a=parseInt(n[2]);let e=parseInt(n[1])||0;var s=/^0/.test(n[1])?"0":" ";let t=i.toFixed(a);if(0<e&&0<a&&(e+=a+1),0<e)for(;t.length<e;)t=s+t;r=t}else r=":x"==t?"0x"+i.toString(16):void 0===i?"(undef)":null===i?"(null)":i.toString?i.toString():i+"";return":a"==t?/^\s*[euioah]/.test(r.toLowerCase())?r="an "+r:/^\s*[bcdfgjklmnpqrstvwxz]/.test(r.toLowerCase())&&(r="a "+r):":s"==t?r=1==i?"":"s":":q"==t?r=l.htmlEscape(r):":jq"==t?r=l.jsStringQuote(r):":uri"==t?r=encodeURIComponent(r).replace(/'/g,"%27").replace(/"/g,"%22"):":url"==t?r=encodeURI(r).replace(/'/g,"%27").replace(/"/g,"%22"):":%"==t&&(r=(100*i).toFixed(1).toString()+"%"),r})}l.enableLiveLocalizationUpdates=function(){r=!0},l.liveLocalizationEnabled=function(){return r},l.localeInfo=function(){return(r?"live-":"")+t},l.userLanguage=o,l.normalizeLanguageCode=c,l.setUserLanguage=function(e){t=c(e)[0]},l.isUserLanguageRtl=function(){return/^ar|dv|fa|ha|he|ks|ku|ps|ur|yi/i.test(t)},l.TRANSLATION_LOCALE="pxt",l.isTranslationMode=function(){return t==l.TRANSLATION_LOCALE},l._localize=function(e){return i[e]||e},l.getLocalizedStrings=function(){return i},l.setLocalizedStrings=function(e){i=e},l.translationsCache=function(){return e},l.fmt_va=u,l.fmt=function(e,...t){return u(e,t)};let n={};function d(e,t){if(!e)return e;n[e]=(n[e]||0)+1;let i=l._localize(e);return u(i=i.replace(/^\{(id|loc):[^\}]+\}/g,""),t)}l.dumpLocStats=function(){let t={};Object.keys(n).sort((e,t)=>n[t]-n[e]).forEach(e=>t[e]=e),pxt.log("prioritized list of strings:"),pxt.log(JSON.stringify(t,null,2))},l.lf_va=d,l.lf=function(e,...t){return d(e,t)},l.rlf=function(e,...t){return d(e,t)},l.lookup=function(e,t){return e.hasOwnProperty(t)?e[t]:null},l.isoTime=function(e){return e=new Date(1e3*e),l.fmt("{0}-{1:f02.0}-{2:f02.0} {3:f02.0}:{4:f02.0}:{5:f02.0}",e.getFullYear(),e.getMonth()+1,e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())},l.userError=function(e){throw(e=new Error(e)).isUserError=!0,e},l.deq=function t(i,r){if(i!==r){if(!i||!r)return"Null value";if("object"!=typeof i||"object"!=typeof r)return"Unable to compare "+i+", "+r;if(Array.isArray(i)){if(!Array.isArray(r))return"Expected array";if(i.length!=r.length)return"Expected array of length "+i.length+", got "+r.length;for(let e=0;e<i.length;e++)if(null!=t(i[e],r[e]))return"Expected array value "+i[e]+" got "+r[e]}else{var n=Object.keys(i),e=Object.keys(i);if(n.length!=e.length)return"Expected "+n.length+" keys, got "+e.length;for(let e=0;e<n.length;e++){if(!Object.prototype.hasOwnProperty.call(r,n[e]))return"Missing key "+n[e];if(null!=t(i[n[e]],r[n[e]]))return"Expected value of "+n[e]+" to be "+i[n[e]]+", got "+r[n[e]]}}}return null},l.deepEqual=function t(i,r){if(i===r)return!0;if(i&&r&&"object"==typeof i&&"object"==typeof r){var e,n=Array.isArray(i),a=Array.isArray(r);if(n&&a){if(i.length!==r.length)return!1;for(let e=0;e<i.length;++e)if(!t(i[e],r[e]))return!1}else{if(n!==a)return!1;if((n=Object.keys(i)).length!==Object.keys(r).length)return!1;for(e of n){if(!r.hasOwnProperty(e))return!1;if(!t(i[e],r[e]))return!1}}return!0}return i!=i&&r!=r}}})(ts=ts||{});let lf=ts.pxtc.Util.lf,getCellId=((e=>{(e=e.pxtc||(e.pxtc={})).decodeBase64=function(e){return atob(e)},e.encodeBase64=function(e){return btoa(e)}})(ts=ts||{}),(s=>{var e,u=s.pxtc||(s.pxtc={});{var f=u.Util||(u.Util={});function r(t,i){if(i)for(let e=0;e<i.length;++e)t.push(i[e])}function i(t){var i=[];for(let e=0;e<t.length;++e)r(i,t[e]);return i}function n(e){return e&&"object"==typeof e&&!Array.isArray(e)}function o(t,i,r,n,a){void 0===n&&(n=0),void 0===a&&(a=r.length-n);for(let e=0;e<a;++e)t[i+e]=r[n+e]}function a(e,t){return e==t?0:e<t?-1:1}f.CancellationToken=class{constructor(){this.pending=!1,this.cancelled=!1}startOperation(){this.pending=!0}isRunning(){return this.pending}onProgress(e){this.progressHandler=e}reportProgress(e,t){this.progressHandler&&this.progressHandler(e,t)}cancel(){this.cancelled=!0,this.pending=!1}cancelAsync(){return this.cancelled||!this.pending?(this.cancelled=!0,this.pending=!1,Promise.resolve()):(this.cancelled=!0,this.deferred=new Promise(e=>{this.resolve=e}),this.deferred)}isCancelled(){return this.cancelled}throwIfCancelled(){if(this.isCancelled())throw new Error}resolveCancel(){this.pending=!1,this.deferred&&(this.resolve(),this.deferred=void 0,this.resolve=void 0)}},f.codalHash16=function(e){let n=[251,175,119,215,81,14,79,191,103,49,181,143,186,157,0,232,31,32,55,60,152,58,17,237,174,70,160,144,220,90,57,223,59,3,18,140,111,166,203,196,134,243,124,95,222,179,197,65,180,48,36,15,107,46,233,130,165,30,123,161,209,23,97,16,40,91,219,61,100,10,210,109,250,127,22,138,29,108,244,67,207,9,178,204,74,98,126,249,167,116,34,77,193,200,121,5,20,113,71,35,128,13,182,94,25,226,227,199,75,27,41,245,230,224,43,225,177,26,155,150,212,142,218,115,241,73,88,105,39,114,62,255,192,201,145,214,168,158,221,148,154,122,12,84,82,163,44,139,228,236,205,242,217,11,187,146,159,64,86,239,195,42,106,198,118,112,184,172,87,2,173,117,176,229,247,253,137,185,99,164,102,147,45,66,231,52,141,211,194,206,246,238,56,110,78,248,63,240,189,93,92,51,53,183,19,171,72,50,33,104,101,69,8,252,83,120,76,135,85,54,202,125,188,213,96,235,136,208,162,129,190,132,156,38,47,1,7,254,24,4,216,131,89,21,28,133,37,153,149,80,170,68,6,169,234,151];if(e){var i=e;var r=2;var a,s=new Uint8Array(i.length);for(let e=0;e<i.length;++e){var o=i.charCodeAt(e);s[e]=255&o}let t=0;for(let e=0;e<r;++e)a=(t=>{let i=0;for(let e=0;e<t.length;e++){var r=t[e];i=n[i^r]}return i})(s),t|=a<<8*e,s[0]=(s[0]+1)%255;return t}return 0},f.bufferSerial=function(t,i="",r="?",n=255){for(let e=0;e<i.length;++e){var a=i[e];t[r]=(t[r]||"")+a,("\n"===a||t[r].length>n)&&(a=t[r],t[r]="",window.postMessage({type:"serial",id:r,data:a},"*"))}},f.blobReadAsDataURL=function(r){return r?new Promise((e,t)=>{let i=new FileReader;i.onload=()=>e(i.result),i.onerror=e=>t(e),i.readAsDataURL(r)}):Promise.resolve(void 0)},f.fileReadAsBufferAsync=function(r){return r?new Promise((t,e)=>{let i=new FileReader;i.onerror=e=>t(null),i.onload=e=>t(new Uint8Array(i.result)),i.readAsArrayBuffer(r)}):Promise.resolve(null)},f.fileReadAsTextAsync=function(r){return r?new Promise((t,e)=>{let i=new FileReader;i.onerror=e=>t(null),i.onload=e=>t(i.result),i.readAsText(r)}):Promise.resolve(null)},f.sanitizeFileName=function(e){return e.replace(/[()\\\/.,?*^:<>!;'#$%^&|"@+=«»°{}\[\]¾½¼³²¦¬¤¢£~­¯¸`±\x00-\x1F]/g,"").trim().replace(/\s+/g,"-")},f.repeatMap=function(t,i){t=t||0;var r=[];for(let e=0;e<t;++e)r.push(i(e));return r},f.listsEqual=function(t,i){if(!t||!i||t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==i[e])return!1;return!0},f.oops=function(e="OOPS"){throw new Error(e)},f.reversed=function(e){return(e=e.slice(0)).reverse(),e},f.arrayEquals=function(t,i,r=(e,t)=>e===t){if(t!=i){if(!t&&i||!i&&t||t.length!==i.length)return!1;for(let e=0;e<t.length;e++)if(!r(t[e],i[e]))return!1}return!0},f.iterMap=function(t,i){Object.keys(t).forEach(e=>i(e,t[e]))},f.mapMap=function(t,i){let r={};return Object.keys(t).forEach(e=>r[e]=i(e,t[e])),r},f.values=function(t){return Object.keys(t||{}).map(e=>t[e])},f.pushRange=r,f.concatArrayLike=i,f.concat=i,f.memcpy=o,f.uint8ArrayConcat=function(e){let t=0;for(var i of e)t+=i.length;var r,n=new Uint8Array(t);let a=0;for(r of e)o(n,a,r),a+=r.length;return n},f.jsonTryParse=function(e){try{return JSON.parse(e)}catch(e){}},f.jsonMergeFrom=function t(i,r){r&&Object.keys(r).forEach(e=>{n(i[e])&&n(r[e])?t(i[e],r[e]):i[e]=f.clone(r[e])})},f.jsonCopyFrom=function(e,t){var i,r=f.clone(t);for(i of Object.keys(t))e[i]=r[i]},f.jsonFlatten=function(e){let r={},n=(e,t)=>{if(null!==t&&"object"==typeof t){f.assert(!Array.isArray(t)),e&&(e+=".");for(var i of Object.keys(t))n(e+i,t[i])}else r[e]=t};return n("",e),r},f.jsonUnFlatten=function(i){var r,e={};for(r of Object.keys(i)){let t=e;var n=r.split(".");for(let e=0;e<n.length;++e){var a=n[e];e==n.length-1?t[a]=i[r]:("object"!=typeof t[a]&&(t[a]={}),t=t[a])}}return e},f.strcmp=a,f.stringMapEq=function(e,t){var i,r=Object.keys(e),n=Object.keys(t);if(r.length!=n.length)return!1;for(i of r){if(!t.hasOwnProperty(i))return!1;if(e[i]!==t[i])return!1}return!0},f.endsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(-t.length)!=t)},f.startsWith=function(e,t){return!(e.length<t.length||0!=t.length&&e.slice(0,t.length)!=t)},f.contains=function(e,t){return!(e.length<t.length)&&(0==t.length||-1<e.indexOf(t))},f.replaceAll=function(e,t,i){return t?e.split(t).join(i):e},f.snakify=function(i){let r=i.toUpperCase(),t=i.toLowerCase();if(i==r||i==t)return i;if(0<i.lastIndexOf("_"))return i;var n,a=e=>i[e]!=t[e];let s="",o=0;for(;o<i.length;){let e=a(o),t=o;for(;t<i.length;){if(e&&(n=t,i[n]!=r[n])){if(2<t-o){t--;break}e=!1}if(!e&&a(t))break;t++}s&&(s+="_"),s+=i.slice(o,t),o=t}return s.toUpperCase()===s?s:s.toLowerCase()},f.sortObjectFields=function(t){var e=Object.keys(t);e.sort(a);let i={};return e.forEach(e=>i[e]=t[e]),i},f.chopArray=function(t,i){var r=[];for(let e=0;e<t.length;e+=i)r.push(t.slice(e,e+i));return r},f.unique=function(e,i){let r=[],n={};return e.forEach(e=>{var t=i(e);n.hasOwnProperty(t)||(n[t]=null,r.push(e))}),r},f.groupBy=function(e,i){let r={};return e.forEach(e=>{var t=i(e);r.hasOwnProperty(t)||(r[t]=[]),r[t].push(e)}),r},f.toDictionary=function(e,t){let i={};return e.forEach(e=>{i[t(e)]=e}),i},f.toSet=function(e,t){let i={};return e.forEach(e=>{i[t(e)]=!0}),i},f.deepCopy=function e(t){if("object"!=typeof t||null===t)return t;var i,r=Array.isArray(t)?[]:{};for(i in t){var n=t[i];r[i]=e(n)}return r},f.toArray=function(t){if(Array.isArray(t))return t;var i=[];if(t)for(let e=0;e<t.length;++e)i.push(t[e]);return i},f.indexOfMatching=function(t,i){for(let e=0;e<t.length;++e)if(i(t[e]))return e;return-1};let t=Promise.resolve();async function l(t,i,r){let n=0;var a=[];let s=[];for(let e=0;e<t;e++){var o=(async()=>{for(;n<i.length;){var e=n++,t=i[e];s[e]=await r(t)}})();a.push(o)}try{await Promise.all(a)}catch(e){throw n=i.length,e}return s}function d(i,r){let n={};return e=>{var t=i(e);return n.hasOwnProperty(t)?n[t]:n[t]=r(e)}}function h(e){return e=e&&e.replace(/\\/g,"/")}function p(i){let r={url:""+encodeURI(i.url.replace(/[?#].*/,"...")),method:""+(i.method||"GET")};return pxt.perf.measureStart(Measurements.NetworkRequest),f.httpRequestCoreAsync(i).then(e=>{var t=e.statusCode;return(i.successCodes||[304,200,201,202]).indexOf(t)<0&&!i.allowHttpErrors?(t=f.lf("Bad HTTP status code: {0} at {1}; message: {2}",e.statusCode,i.url,(e.text||"").slice(0,500)),(t=new Error(t)).statusCode=e.statusCode,Promise.reject(t)):(e.text&&/application\/json/.test(e.headers["content-type"])&&(e.json=u.U.jsonTryParse(e.text)),e)}).then(e=>{var t=e.headers["content-length"];return t?r.sizeInBytes=""+t:e.text&&pxt.perf.isEnabled()&&(t=(new TextEncoder).encode(e.text),r.sizeInBytes=t.length+""),r.statusCode=""+e.statusCode,e}).finally(()=>{pxt.perf.measureEnd(Measurements.NetworkRequest,r)})}function m(i,r){let n="";if(i)for(let t=0;t<i.length;++t){let e=i.charCodeAt(t);var a;e<=127?n+=i.charAt(t):e<=2047?n+=String.fromCharCode(192|e>>6,128|63&e):(!r&&55296<=e&&e<=56319&&(a=i.charCodeAt(++t),isNaN(a)||(e=65536+(e-55296<<10)+(a-56320))),e<=65535?n+=String.fromCharCode(224|e>>12,128|e>>6&63,128|63&e):n+=String.fromCharCode(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e))}return n}function g(){return Date.now()}function v(){var e=new Uint8Array(4);return f.getRandomBuf(e),new Uint32Array(e.buffer)[0]}function b(n,a,s){function t(i){pxt.debug(`downloading translations for ${n} `+a);var e=pxt.BrowserUtils.isLocalHost()||pxt.webConfig.isStatic?"https://makecode.com/api/":"";let t=e+`translations?lang=${encodeURIComponent(n)}&filename=${encodeURIComponent(a)}&approved=true`;var r={};return s&&!pxt.Cloud.useCdnApi()&&(r["If-None-Match"]=s),(e?p:pxt.Cloud.apiRequestWithCdnAsync)({url:t,headers:r}).then(t=>304==t.statusCode||200==t.statusCode?(s=t.headers.etag||"",pxt.BrowserUtils.translationDbAsync().then(e=>e.setAsync(n,a,s,t.json||i)).then(()=>t.json||i)):t.json,e=>{pxt.log("failed to load translations from "+t)})}return pxt.BrowserUtils.translationDbAsync().then(e=>e.getAsync(n,a)).then(e=>e?(s=e.etag,300<(Date.now()-e.time)/1e3&&t(e.strings),e.strings):t())}function y(e){var[e,t]=f.normalizeLanguageCode(e),i=pxt.appTarget.appTheme;if(i&&i.availableLocales){if(-1<i.availableLocales.indexOf(e))return!0;if(t&&-1<i.availableLocales.indexOf(t))return!0}return!1}f.nextTick=function(e){t.then(e)},f.delay=async function(t,e){return e=await e,await new Promise(e=>setTimeout(()=>e(),t)),e},f.promiseMapAll=function(e,t){return Promise.all(e.map(e=>t(e)))},f.promiseMapAllSeries=function(e,t){return l(1,e,t)},f.promisePoolAsync=l,f.memoizeString=function(e){return d(e=>e,e)},f.promiseTimeout=async function(i,e,r){let n,a;var t=new Promise((e,t)=>{a=e,n=setTimeout(()=>{a=void 0,clearTimeout(n),t(r||`Promise timed out after ${i}ms`)},i)});return Promise.race([e,t]).then(e=>(a&&(clearTimeout(n),a()),e))},f.defer=function(){let r,i,n,e=!1;return{resolve:function(t){e?pxt.debug("Deferred promise already resolved"):(i?i(t):r=r||new Promise(function(e){e(t)}),e=!0)},reject:function(i){e?pxt.debug("Deferred promise already resolved"):(n?n(i):r=r||new Promise(function(e,t){t(i)}),e=!0)},promise:new Promise(function(e,t){r?e(r):(i=e,n=t)})}},f.memoize=d,f.debounce=function(r,n,a){let s;return function(){let e=this,t=arguments;var i=a&&!s;return clearTimeout(s),s=setTimeout(function(){s=null,a||r.apply(e,t)},n),i&&r.apply(e,t),s}},f.AdaptiveDebouncer=class{constructor(e,t=300,i=2e3,r=2){this.func=e,this.minDelay=t,this.maxDelay=i,this.slowdownFactor=r,this.lastPoke=0,this.recentGaps=[],this.wrapped=()=>{this.timeout=null,this.func()}}poke(){var e=Date.now();if(this.lastPoke){var t=e-this.lastPoke;if(t<10)return;for(t<4e3&&this.recentGaps.push(t);10<this.recentGaps.length;)this.recentGaps.shift()}this.lastPoke=e}trigger(){let e=this.maxDelay;var t;this.lastPoke&&((t=this.recentGaps.slice()).sort(),t=t[t.length>>1]||1,e=Math.min(Math.max(t*this.slowdownFactor|0,this.minDelay),this.maxDelay),t=Date.now()-this.lastPoke,(e-=t)<0&&(e=0),this.lastPoke=null),clearTimeout(this.timeout),this.timeout=setTimeout(this.wrapped,e)}},f.throttle=function(r,n,a){let s;return function(){let e=this,t=arguments;var i=a&&!s;s=s||setTimeout(function(){s=null,a||r.apply(e,t)},n),i&&r.apply(e,t)}},f.randomPermute=function(t){for(let e=0;e<t.length;++e){var i=v()%t.length,r=t[e];t[e]=t[i],t[i]=r}},f.randomPick=function(e){return 0==e.length?null:e[v()%e.length]},f.timeSince=function(e){let t=(Date.now()-(e*=1e3))/1e3;return isNaN(t)?"":t<-30?(t=-t)<60?f.lf("in a few seconds"):t<120?f.lf("in a minute"):t<3600?f.lf("in {0} minute{0:s}",Math.floor(t/60)):t<7200?f.lf("in an hour"):t<86400?f.lf("in {0} hour{0:s}",Math.floor(t/60/60)):t<2592e3?f.lf("in {0} day{0:s}",Math.floor(t/60/60/24)):t<31536e3?f.lf("in {0} month{0:s}",Math.floor(t/60/60/24/30)):f.lf("in {0} year{0:s}",Math.floor(t/60/60/24/365)):t<0?f.lf("now"):t<10?f.lf("a few seconds ago"):t<60?f.lf("{0} second{0:s} ago",Math.floor(t)):t<120?f.lf("a minute ago"):t<3600?f.lf("{0} minute{0:s} ago",Math.floor(t/60)):t<7200?f.lf("an hour ago"):t<86400?f.lf("{0} hour{0:s} ago",Math.floor(t/60/60)):t<2592e3?f.lf("{0} day{0:s} ago",Math.floor(t/60/60/24)):t<31536e3?f.lf("{0} month{0:s} ago",Math.floor(t/60/60/24/30)):f.lf("{0} year{0:s} ago",Math.floor(t/60/60/24/365))},f.unicodeToChar=function(e){return e.replace(/\\u([\d\w]{4})/gi,function(e,t){return String.fromCharCode(parseInt(t,16))})},f.escapeForRegex=function(e){return null==e?void 0:e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},f.stripUrlProtocol=function(e){return null==e?void 0:e.replace(/.*?:\/\//g,"")},f.normalizePath=h,f.pathJoin=function(e,t){if(h(e),h(t),e||t)return e?t?("/"!==e.charAt(e.length-1)&&(e+="/"),e+(t="/"==t.charAt(0)?t.substring(1):t)):e:t},f.isNodeJS="undefined"==typeof window,f.requestAsync=p,f.httpGetTextAsync=function(e){return p({url:e}).then(e=>e.text)},f.httpGetJsonAsync=function(e){return p({url:e}).then(e=>e.json)},f.httpPostJsonAsync=function(e,t){return p({url:e,data:t||{}}).then(e=>e.json)},f.stringToUint8Array=function(t){var i=t.length,r=new Uint8Array(i);for(let e=0;e<i;++e)r[e]=255&t.charCodeAt(e);return r},f.uint8ArrayToString=function(t){var i=t.length;let r="";for(let e=0;e<i;++e)r+=String.fromCharCode(t[e]);return r},f.fromUTF8=function(t){if(!t)return"";let i="";for(let e=0;e<t.length;++e){var r=255&t.charCodeAt(e);i+=37==r||127<r?"%"+r.toString(16):t.charAt(e)}return decodeURIComponent(i)},f.toUTF8=m,f.toHex=function(t){let i="";for(let e=0;e<t.length;++e)i+=("0"+t[e].toString(16)).slice(-2);return i},f.fromHex=function(t){var i=new Uint8Array(t.length>>1);for(let e=0;e<t.length;e+=2)i[e>>1]=parseInt(t.slice(e,e+2),16);return i},f.PromiseQueue=class{constructor(){this.promises={}}enqueue(r,n){return new Promise((e,t)=>{let i=this.promises[r];(i=i||(this.promises[r]=[])).push(()=>n().finally(()=>{i.shift(),0==i.length?delete this.promises[r]:i[0]()}).then(e,t)),1==i.length&&i[0]()})}},f.PromiseBuffer=class{constructor(){this.waiting=[],this.available=[]}drain(){for(var e of this.waiting)e(new Error("Promise Buffer Reset"));this.waiting=[],this.available=[]}pushError(e){this.push(e)}push(e){var t=this.waiting.shift();t?t(e):this.available.push(e)}shiftAsync(e=0){var t;return 0<this.available.length?(t=this.available.shift())instanceof Error?Promise.reject(t):Promise.resolve(t):new Promise((t,i)=>{let r=e=>{(e instanceof Error?i:t)(e)};this.waiting.push(r),0<e&&u.U.delay(e).then(()=>{var e=this.waiting.indexOf(r);0<=e&&(this.waiting.splice(e,1),i(new Error("Timeout")))})})}},f.now=g,f.nowSeconds=function(){return Math.round(g()/1e3)},f.timeout=function(t){return new Promise(e=>setTimeout(()=>e(),t))},f.runWithBackoffAsync=async function(e,t,i,r,n,a,s=1.5){let o=i;for(var l=Date.now();Date.now()-l<n;){var c=await e();if(t(c))return c;await pxt.Util.timeout(o),o=Math.min(o*s,r)}throw new Error(a)},f.cpuUs=()=>{let e="undefined"!=typeof performance?performance.now.bind(performance)||performance.moznow.bind(performance)||performance.msNow.bind(performance)||performance.webkitNow.bind(performance)||performance.oNow.bind(performance):Date.now;return f.cpuUs=()=>1e3*e(),f.cpuUs()},f.getMime=function(e){if(!(e=/\.([a-zA-Z0-9]+)$/.exec(e)))return"application/octet-stream";switch(e[1].toLowerCase()){case"txt":return"text/plain";case"html":case"htm":return"text/html";case"css":return"text/css";case"js":return"application/javascript";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"ico":return"image/x-icon";case"manifest":return"text/cache-manifest";case"webmanifest":return"application/manifest+json";case"json":return"application/json";case"svg":return"image/svg+xml";case"eot":return"application/vnd.ms-fontobject";case"ttf":return"font/ttf";case"woff":return"application/font-woff";case"woff2":return"application/font-woff2";case"md":return"text/markdown";case"xml":return"application/xml";case"m4a":return"audio/m4a";case"mp3":return"audio/mp3";case"wasm":return"application/wasm";default:return"application/octet-stream"}},f.randomUint32=v,f.guidGen=function(){function e(){return(65536|v()).toString(16).slice(-4)}return e()+e()+"-"+e()+"-4"+e().slice(-3)+"-"+e()+"-"+e()+e()+e()},f.downloadLiveTranslationsAsync=b,f.pxtLangCookieId="PXT_LANG",f.langCookieExpirationDays=30,f.allLanguages={af:{englishName:"Afrikaans",localizedName:"Afrikaans"},ar:{englishName:"Arabic",localizedName:"العربية"},az:{englishName:"Azerbaijani",localizedName:"آذربایجان دیلی"},bg:{englishName:"Bulgarian",localizedName:"български"},bi:{englishName:"Bislama",localizedName:"Bislama"},bn:{englishName:"Bengali",localizedName:"বাংলা"},ca:{englishName:"Catalan",localizedName:"Català"},cs:{englishName:"Czech",localizedName:"Čeština"},cy:{englishName:"Welsh",localizedName:"Cymraeg"},da:{englishName:"Danish",localizedName:"Dansk"},de:{englishName:"German",localizedName:"Deutsch"},el:{englishName:"Greek",localizedName:"Ελληνικά"},en:{englishName:"English",localizedName:"English"},"es-ES":{englishName:"Spanish (Spain)",localizedName:"Español (España)"},"es-MX":{englishName:"Spanish (Mexico)",localizedName:"Español (México)"},et:{englishName:"Estonian",localizedName:"Eesti"},eu:{englishName:"Basque",localizedName:"Euskara"},fa:{englishName:"Persian",localizedName:"فارسی"},fi:{englishName:"Finnish",localizedName:"Suomi"},fil:{englishName:"Filipino",localizedName:"Filipino"},fo:{englishName:"Faroese",localizedName:"føroyskt"},fr:{englishName:"French",localizedName:"Français"},"fr-CA":{englishName:"French (Canada)",localizedName:"Français (Canada)"},"ga-IE":{englishName:"Irish",localizedName:"Gaeilge"},gl:{englishName:"Galician",localizedName:"galego"},gn:{englishName:"Guarani",localizedName:"Avañe'ẽ"},"gu-IN":{englishName:"Gujarati",localizedName:"ગુજરાતી"},haw:{englishName:"Hawaiian",localizedName:"ʻŌlelo Hawaiʻi"},hi:{englishName:"Hindi",localizedName:"हिन्दी"},he:{englishName:"Hebrew",localizedName:"עברית"},hr:{englishName:"Croatian",localizedName:"Hrvatski"},hu:{englishName:"Hungarian",localizedName:"Magyar"},"hy-AM":{englishName:"Armenian (Armenia)",localizedName:"Հայերէն (Հայաստան)"},id:{englishName:"Indonesian",localizedName:"Bahasa Indonesia"},is:{englishName:"Icelandic",localizedName:"Íslenska"},it:{englishName:"Italian",localizedName:"Italiano"},ja:{englishName:"Japanese",localizedName:"日本語"},"ja-HIRA":{englishName:"Hiragana",localizedName:"にほんご"},ka:{englishName:"Georgian",localizedName:"ქართული"},kab:{englishName:"Kabyle",localizedName:"شئعم"},kk:{englishName:"Kazakh",localizedName:"қазақ тілі"},km:{englishName:"Khmer",localizedName:"ខ្មែរ"},kmr:{englishName:"Kurmanji (Kurdish)",localizedName:"کورمانجی‎"},kn:{englishName:"Kannada",localizedName:"ಕನ್ನಡ"},ko:{englishName:"Korean",localizedName:"한국어"},lt:{englishName:"Lithuanian",localizedName:"Lietuvių"},lv:{englishName:"Latvian",localizedName:"Latviešu"},"ml-IN":{englishName:"Malayalam",localizedName:"മലയാളം"},mr:{englishName:"Marathi",localizedName:"मराठी"},ms:{englishName:"Malay",localizedName:"Melayu"},nl:{englishName:"Dutch",localizedName:"Nederlands"},no:{englishName:"Norwegian",localizedName:"Norsk"},nb:{englishName:"Norwegian Bokmal",localizedName:"Norsk bokmål"},"nn-NO":{englishName:"Norwegian Nynorsk",localizedName:"Norsk nynorsk"},"pa-IN":{englishName:"Punjabi",localizedName:"ਪੰਜਾਬੀ"},pl:{englishName:"Polish",localizedName:"Polski"},ps:{englishName:"Pashto",localizedName:"پښتو"},"pt-BR":{englishName:"Portuguese (Brazil)",localizedName:"Português (Brasil)"},"pt-PT":{englishName:"Portuguese (Portugal)",localizedName:"Português (Portugal)"},ro:{englishName:"Romanian",localizedName:"Română"},ru:{englishName:"Russian",localizedName:"Русский"},sat:{englishName:"Santali",localizedName:"ᱥᱚᱸᱴᱚᱞᱤ"},"si-LK":{englishName:"Sinhala",localizedName:"සිංහල"},sk:{englishName:"Slovak",localizedName:"Slovenčina"},sl:{englishName:"Slovenian",localizedName:"Slovenski"},sq:{englishName:"Albanian",localizedName:"shqip"},sr:{englishName:"Serbian (Cyrillic)",localizedName:"Srpski"},su:{englishName:"Sundanese",localizedName:"ᮘᮞ ᮞᮥᮔ᮪ᮓ"},"sv-SE":{englishName:"Swedish",localizedName:"Svenska"},sw:{englishName:"Swahili",localizedName:"Kiswahili"},"sw-TZ":{englishName:"Swahili (Tanzania)",localizedName:"Kiswahili (Tanzania)"},ta:{englishName:"Tamil",localizedName:"தமிழ்"},te:{englishName:"Telugu",localizedName:"తెలుగు"},th:{englishName:"Thai",localizedName:"ภาษาไทย"},tl:{englishName:"Tagalog",localizedName:"ᜏᜒᜃᜅ᜔ ᜆᜄᜎᜓᜄ᜔"},tr:{englishName:"Turkish",localizedName:"Türkçe"},uk:{englishName:"Ukrainian",localizedName:"Українська"},"ur-IN":{englishName:"Urdu (India)",localizedName:"اردو (ہندوستان)"},"ur-PK":{englishName:"Urdu (Pakistan)",localizedName:"اردو (پاکستان)"},vi:{englishName:"Vietnamese",localizedName:"Tiếng việt"},"zh-CN":{englishName:"Chinese (Simplified)",localizedName:"中文(简体)"},"zh-TW":{englishName:"Chinese (Traditional)",localizedName:"中文(繁體)"}},f.isLocaleEnabled=y,f.updateLocalizationAsync=function(e){let{targetId:i,baseUrl:r,force:t}=e,n=e.code;if((n="en-US"===(n=f.normalizeLanguageCode(n)[0])?"en":n)===f.userLanguage()||!y(n)&&!t)return pxt.debug(`loc: ${n} (using built-in)`),Promise.resolve();pxt.debug("loc: "+n);let a=pxt.Util.liveLocalizationEnabled();return w(i,r,n,a,s.pxtc.Util.TranslationsKind.Editor).then(e=>{var t;return e&&(f.setUserLanguage(n),null!=(t=pxt.analytics)&&t.addDefaultProperties({lang:n}),f.setLocalizedStrings(e)),s.pxtc.Util.downloadTranslationsAsync(i,r,n,a,s.pxtc.Util.TranslationsKind.Apis).then(e=>{e&&(s.pxtc.apiLocalizationStrings=e)})})};let c;function w(e,i,r,t,n){if(n=n||c.Editor,"en-US"===(r=f.normalizeLanguageCode(r)[0])||"en"===r)return Promise.resolve(void 0);let a=r+`/${t}/`+n;if(f.translationsCache()[a])return Promise.resolve(f.translationsCache()[a]);let s;switch(n){case c.Editor:s=[{staticName:"strings.json",path:"strings.json"},{staticName:"target-strings.json",path:e+"/target-strings.json"}];break;case c.Sim:s=[{staticName:"sim-strings.json",path:e+"/sim-strings.json"}];break;case c.Apis:s=[{staticName:"bundled-strings.json",path:e+"/bundled-strings.json"}];break;case c.SkillMap:s=[{staticName:"skillmap-strings.json",path:"/skillmap-strings.json"}]}let o;function l(t){t&&(o=o||{},Object.keys(t).filter(e=>!!t[e]).forEach(e=>o[e]=t[e]))}if(t){let t=0;return u.U.promiseMapAllSeries(s,e=>b(r,e.path).then(l,e=>{pxt.log(e.message),++t})).then(()=>(t&&(f.translationsCache()[a]=o),t!==s.length&&o?Promise.resolve(o):(pxt.tickEvent("translations.livetranslationsfailed"),w(e,i,r,!1,n))))}return Promise.all(s.map(e=>f.httpGetJsonAsync(i+`locales/${r}/`+e.staticName).catch(e=>{}))).then(e=>{let t={};e.forEach(e=>pxt.Util.jsonMergeFrom(t,e)),Object.keys(t).length&&(o=t,f.translationsCache()[a]=o)},e=>{pxt.error("failed to load localizations")}).then(()=>o)}function A(e){var t,i={};for(t of Object.keys(e))i[t]=k(e[t]);return i}function k(e){var t;return{attributes:Object.assign({},e.attributes),parameters:null==(t=e.parameters)?void 0:t.map(T),extendsTypes:e.extendsTypes?[...e.extendsTypes]:void 0,pkgs:e.pkgs?[...e.pkgs]:void 0,combinedProperties:e.combinedProperties?[...e.combinedProperties]:void 0,name:e.name,namespace:e.namespace,fileName:e.fileName,kind:e.kind,retType:e.retType,isInstance:e.isInstance,isContextual:e.isContextual,qName:e.qName,pkg:e.pkg,snippet:e.snippet,snippetName:e.snippetName,snippetWithMarkers:e.snippetWithMarkers,pySnippet:e.pySnippet,pySnippetName:e.pySnippetName,pySnippetWithMarkers:e.pySnippetWithMarkers,blockFields:e.blockFields,isReadOnly:e.isReadOnly,pyName:e.pyName,pyQName:e.pyQName,snippetAddsDefinitions:e.snippetAddsDefinitions}}function T(e){var t;return{name:e.name,description:e.description,type:e.type,pyTypeString:e.pyTypeString,initializer:e.initializer,default:e.default,properties:null==(t=e.properties)?void 0:t.map(E),handlerParameters:null==(t=e.handlerParameters)?void 0:t.map(E),options:e.options?u.U.clone(e.options):void 0,isEnum:e.isEnum}}function E(e){return{name:e.name,type:e.type}}function x(e){if(e){var t;for(t of[{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"GitHub Token",regex:/(gh[psuro]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})/},{label:"Generic Secret",regex:/\b(token|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]{0,200}/i},{label:"CLI Credentials",regex:/((login|psexec|(certutil|psexec)\.exe).{1,50}(\s-u(ser(name)?)?\s+.{3,100})?\s-(admin|user|vm|root)?p(ass(word)?)?\s+["']?[^$\-\/\s]|(^|[\s\r\n\\])net(\.exe)?.{1,5}(user\s+|share\s+\/user:| user -? secrets ? set) \s + [^ $\s \/])/},{label:"JWT Token",regex:/\beyJ[A-Za-z0-9_\-]+?\.[A-Za-z0-9_\-]+?\.[A-Za-z0-9_\-]+?\b/},{label:"Email",regex:/\b[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,63}\b/i}])if(t.regex.test(e))return`<REDACTED: ${t.label}>`}return e}(e=c=f.TranslationsKind||(f.TranslationsKind={}))[e.Editor=0]="Editor",e[e.Sim=1]="Sim",e[e.Apis=2]="Apis",e[e.SkillMap=3]="SkillMap",f.downloadTranslationsAsync=w,f.capitalize=function(e){return e&&e[0].toLocaleUpperCase()+e.slice(1)},f.uncapitalize=function(e){return(e||"").split(/(?=[A-Z])/g).join(" ").toLowerCase()},f.camelCaseToLowercaseWithSpaces=function(e){return e.replace(/([A-Z])/gm," $1").toLocaleLowerCase().trim()},f.snakeCaseToLowercaseWithSpaces=function(e){return e.replace(/_/g," ").toLocaleLowerCase().trim()},f.range=function(t){var i=[];for(let e=0;e<t;++e)i.push(e);return i},f.multipartPostAsync=function(e,i={},t=null,r=null){let n="--------------------------0461489f461126c5",a="";Object.keys(i).forEach(e=>{var t;t=i[e=e],a=(a+=n+"\r\n")+'Content-Disposition: form-data; name="'+e+'"\r\n\r\n'+t+"\r\n"}),t&&(r=r,s=(t=t).split("/").reverse()[0],a=(a=a+n+'\r\nContent-Disposition: form-data; name="files['+t+']"; filename="'+s+'"\r\n')+"\r\n"+r+"\r\n"),a+=n+"--\r\n";var s,t={url:e,method:"POST",headers:{"Content-Type":"multipart/form-data; boundary="+n.slice(2)},data:a};return f.httpRequestCoreAsync(t)},f.toDataUri=function(e,t){return/^https?:/i.test(e)||/^data:/i.test(e)?e:(t||/^<svg/i.test(e)&&(t="image/svg+xml"),/xml|svg/.test(t)?`data:${t},`+encodeURIComponent(e):`data:${t||"image/png"};base64,`+u.encodeBase64(m(e)))},f.imageMagic=1496611453,f.imageHeaderSize=36,f.encodeBlobAsync=function(t,e){var i=f.imageHeaderSize+e.length,r=3*(t.width*t.height-1);let n=1;for(;n<4&&!(r*n>=8*i);)n++;var a=r*n>>3,s=i-a;let o=0;var l=t.width*t.height*4;if(0<s){var c=3*t.width,s=(o=Math.ceil(s/c),document.createElement("canvas"));s.width=t.width,s.height=t.height+o;let e=s.getContext("2d");e.drawImage(t,0,0),t=s}function u(t,i,r,n){let a=0,s=0,o=n[s++];var l=(1<<r)-1;let c=!0;for(;c;){let e=o>>a&l;var u=8-a;if(u<=r){if(s>=n.length){if(0==u)break;c=!1}o=n[s++],e|=o<<u&l,a=r-u}else a+=r;t[i]=255&(t[i]&~l|e),3==(3&++i)&&(t[i++]=255)}return i}c=pxt.HF2.encodeU32LE([f.imageMagic,e.length,o,0,0,0,0,0,0]),pxt.Util.assert(c.length==f.imageHeaderSize);let d=t.getContext("2d");var h=d.getImageData(0,0,t.width,t.height);u(h.data,0,1,[n]);let p=4;for(p=u(h.data,p,n,c),pxt.Util.assert(0==(3&p)),p=0==o?u(h.data,p,n,e):(s=a-c.length,p=u(h.data,p,n,e.slice(0,s)),u(h.data,l,8,e.slice(s))),p|=3;p<h.data.length;)h.data[p]=255,p+=4;return d.putImageData(h,0,0),t},f.decodeBlobAsync=function(e){return pxt.BrowserUtils.loadCanvasAsync(e).then(e=>{let o=e.getContext("2d").getImageData(0,0,e.width,e.height).data;var t,i,r,n=1&o[0]|(1&o[1])<<1|(1&o[2])<<2;return 5<n||0==n?Promise.reject(new Error(f.lf("Invalid encoded PNG format"))):(t=a(4,n,r=new Uint8Array(pxt.Util.imageHeaderSize)),(r=pxt.HF2.decodeU32LE(r))[0]!=pxt.Util.imageMagic?Promise.reject(new Error(f.lf("Invalid magic in encoded PNG"))):(i=new Uint8Array(r[1]),0<(r=r[2])?(r=(e.height-r)*e.width,a(t,n,e=new Uint8Array((3*(r-1)*n>>3)-pxt.Util.imageHeaderSize)),i.set(e),a(4*r,8,r=new Uint8Array(i.length-e.length)),i.set(r,e.length)):a(t,n,i),i));function a(e,t,i){let r=0,n=0,a=0;for(var s=(1<<t)-1;n<i.length;)a|=(o[e++]&s)<<r,3==(3&e)&&e++,8<=(r+=t)&&(i[n++]=255&a,a>>=8,r-=8);return e}})},f.parseQueryString=function(e){let r={};return e.replace(/\+/g," ").replace(/([^#?&=]+)=([^#?&=]*)/g,(e,t,i)=>(r[decodeURIComponent(t)]=decodeURIComponent(i),"")),r},f.stringifyQueryString=function(e,t){for(var i of Object.keys(t))0<=e.indexOf("?")?e+="&":e+="?",e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]);return e},f.cloneTargetBundle=function(e){var t=(e=Object.assign({},e)).apiInfo,i=(delete e.apiInfo,e.bundleddirs),r=(delete e.bundleddirs,e.bundledpkgs),n=(delete e.bundledpkgs,e.tutorialInfo),a=(delete e.tutorialInfo,f.clone(e));if(t){a.apiInfo={};for(var s of Object.keys(t)){var o=t[s].apis;a.apiInfo[s]={sha:t[s].sha,apis:{jres:Object.assign({},o.jres),byQName:A(o.byQName)}}}}if(i&&(a.bundleddirs=[...i]),r){a.bundledpkgs={};for(var l of Object.keys(r))a.bundledpkgs[l]=Object.assign({},r[l])}if(n){a.tutorialInfo={};for(var c of Object.keys(n)){var u=n[c];a.tutorialInfo[c]={hash:u.hash,usedBlocks:Object.assign({},u.usedBlocks),snippetBlocks:Object.assign({},u.snippetBlocks),highlightBlocks:Object.assign({},u.highlightBlocks),validateBlocks:Object.assign({},u.validateBlocks)}}}return a},f.cloneApis=A,f.cloneSymbolInfo=k,f.toUTF8Array=function(e){return(new TextEncoder).encode(e)},f.fromUTF8Array=function(e){return(new TextDecoder).decode(e)},f.getHomeUrl=function(){let e,t,i,r=null==(e=pxt.webConfig)?void 0:e.relprefix.substr(0,pxt.webConfig.relprefix.length-3);return pxt.appTarget.appTheme.homeUrl&&r?((null==(t=pxt.appTarget.appTheme.homeUrl)?void 0:t.lastIndexOf("/"))===(null==(i=pxt.appTarget.appTheme.homeUrl)?void 0:i.length)-1&&(r=r.substr(1)),pxt.appTarget.appTheme.homeUrl+r):pxt.appTarget.appTheme.homeUrl},f.isExperienceSupported=function(e){var t=null==(t=null==(t=null==(t=pxt.appTarget)?void 0:t.appTheme)?void 0:t.supportedExperiences)?void 0:t.map(e=>e.toLocaleLowerCase()),e=e.toLocaleLowerCase();return null!=(t=null==t?void 0:t.includes(e))&&t},f.ocvEnabled=function(){var e;return(null==(e=null==(e=pxt.webConfig)?void 0:e.ocv)?void 0:e.appId)&&(null==(e=null==(e=pxt.webConfig)?void 0:e.ocv)?void 0:e.iframeEndpoint)},f.bresenhamLine=function(r,n,a,s,o){var e=a-r,l=s-n;if(0==e){var t=0<=l?s:n;for(let e=0<=l?n:s;e<=t;e++)o(r,e)}else{var c=0<e?1:-1,u=0<l?1:-1,d=Math.abs(l/e);let t=0,i=n;for(let e=r;0<c?e<=a:e>=a;e+=c)for(o(e,i),t+=d;.5<=t;)(0<u?i<=s:i>=s)&&o(e,i),i+=u,--t}},f.isFeatureEnabled=function(e){var t=null==(t=null==(t=pxt.appTarget.appTheme)?void 0:t.enabledFeatures)?void 0:t[e];if(!t)return!1;let i=!0,r=pxt.Cloud.getRegion()?pxt.Cloud.getRegion().toUpperCase():void 0;return i=(i=t.includeRegions?r&&t.includeRegions.some(e=>e.toUpperCase()==r):i)&&t.excludeRegions?r&&!t.excludeRegions.some(e=>e.toUpperCase()==r):i},f.cleanData=function(e){if(!e)return e;let t;if("string"==typeof e)t=x(e);else if("object"==typeof e){t={};for(var[i,r]of Object.entries(e))t[i]="string"==typeof r?x(r):r}else t=e;return t}}})(ts=ts||{}),(e=>{var y=e.pxtc||(e.pxtc={});{e=y.BrowserImpl||(y.BrowserImpl={});y.Util.httpRequestCoreAsync=function(l){return new Promise((e,t)=>{let i,r=!1,n=y.Util.clone(l.headers)||{};i=new XMLHttpRequest,l.responseArrayBuffer&&(i.responseType="arraybuffer"),l.withCredentials&&(i.withCredentials=!0),i.onreadystatechange=()=>{if(!r&&4==i.readyState){r=!0;let t={statusCode:i.status,headers:{},buffer:i.responseBody||i.response,text:l.responseArrayBuffer?void 0:i.responseText};i.getAllResponseHeaders().split(/\r?\n/).forEach(e=>{e=/^\s*([^:]+): (.*)/.exec(e);e&&(t.headers[e[1].toLowerCase()]=e[2])}),e(t)}};var a=l.data,s=l.method||(null==a?"GET":"POST");let o;null==a?o=null:a instanceof Uint8Array?o=a:"object"==typeof a?(o=JSON.stringify(a),n["content-type"]="application/json; charset=utf8"):"string"==typeof a?o=a:y.Util.oops("bad data"),i.open(s,l.url),Object.keys(n).forEach(e=>{i.setRequestHeader(e,n[e])}),null==o?i.send():i.send(o)})},y.Util.sha256=i,y.Util.getRandomBuf=t=>{if(window.crypto)window.crypto.getRandomValues(t);else for(let e=0;e<t.length;++e)t[e]=Math.floor(255*Math.random())};let b=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function w(e,t){return e>>>t|e<<32-t}function t(e){let g=new Uint32Array(8),v=(g[0]=1779033703,g[1]=3144134277,g[2]=1013904242,g[3]=2773480762,g[4]=1359893119,g[5]=2600822924,g[6]=528734635,g[7]=1541459225,new Uint32Array(64));function t(i){var e=i.length-63;for(let t=0;t<e;t+=64){for(let e=0;e<16;e++){var r=(e<<2)+t;v[e]=i[r]<<24|i[r+1]<<16|i[r+2]<<8|i[r+3]}{c=void 0;u=void 0;d=void 0;h=void 0;p=void 0;f=void 0;m=void 0;var c=g;var u=v;y.Util.assert(8==c.length),y.Util.assert(64==u.length);for(let e=16;e<64;++e){var d=w(u[e-15],7)^w(u[e-15],18)^u[e-15]>>>3,h=w(u[e-2],17)^w(u[e-2],19)^u[e-2]>>>10;u[e]=u[e-16]+d+u[e-7]+h|0}let t=c[0],i=c[1],r=c[2],n=c[3],a=c[4],s=c[5],o=c[6],l=c[7];for(let e=0;e<64;++e){var p=w(a,6)^w(a,11)^w(a,25),f=a&s^~a&o,p=l+p+f+b[e]+u[e]|0,f=w(t,2)^w(t,13)^w(t,22),m=t&i^t&r^i&r;l=o,o=s,s=a,a=n+p|0,n=r,r=i,i=t,t=p+(f+m|0)|0}c[0]+=t,c[1]+=i,c[2]+=r,c[3]+=n,c[4]+=a,c[5]+=s,c[6]+=o,c[7]+=l}}}t(e);let i=64-(e.length+9)%64,r=(64==i&&(i=0),e.length-e.length%64);var n=new Uint8Array(e.length-r+1+i+8);let a=0;for(;r<e.length;)n[a++]=e[r++];for(n[a++]=128;0<i--;)n[a++]=0;let s=8*e.length;for(a=n.length;0<s;)n[--a]=255&s,s>>=8;t(n);let o="";for(let e=0;e<g.length;++e)o+=("000000000"+g[e].toString(16)).slice(-8);return o.toLowerCase()}function i(e){pxt.perf.measureStart(Measurements.Sha256Buffer);e=t(y.Util.toUTF8Array(e));return pxt.perf.measureEnd(Measurements.Sha256Buffer),e}e.sha256buffer=t,e.sha256string=i}})(ts=ts||{}),(e=>{var i=e.pxtc||(e.pxtc={});{e=i.jsonPatch||(i.jsonPatch={});let o={add:(e,t,i)=>{if("object"!=typeof e)throw new Error("jsonPatch: expected object type");if(t in e)throw new Error("jsonPatch: object already contains key "+t);e[t]=i},replace:(e,t,i)=>{if("object"!=typeof e)throw new Error("jsonPatch: expected object type");e[t]=i},remove:(e,t)=>{if("object"!=typeof e)throw new Error("jsonPatch: expected object type");delete e[t]}},l={add:(e,t,i)=>{if(!Array.isArray(e))throw new Error("jsonPatch: expected array type");if(t in e)throw new Error(`jsonPatch: key ${t} already exists in array`);"number"==typeof t&&t===Math.floor(t)?e.splice(t,0,i):e[t]=i},replace:(e,t,i)=>{if(!Array.isArray(e))throw new Error("jsonPatch: expected array type");"number"==typeof t&&t===Math.floor(t)?e.splice(t,1,i):e[t]=i},remove:(e,t)=>{if(!Array.isArray(e))throw new Error("jsonPatch: expected array type");"number"==typeof t&&t===Math.floor(t)?e.splice(t,1):delete e[t]}};e.diff=function(e,t){let l={add:[],remove:[],replace:[]};function c(e,t){return!Array.isArray(e)||(e=Number.parseFloat(t),Number.isNaN(e))?t:e}return function e(t,i,r){if(!Object.is(t,i)){i=i||{},t=t||{};for(var n of Object.keys(t))n in i||(n=c(t,n),l.remove.push({op:"remove",path:r.concat(n)}));for(var a of Object.keys(i)){var s=t[a],o=i[a];(a=c(i,a))in t?"object"!=typeof s&&"object"!=typeof o&&s!==o||typeof s!=typeof o||Array.isArray(s)!==Array.isArray(o)?l.replace.push({op:"replace",path:r.concat(a),value:o}):e(s,o,r.concat(a)):void 0!==i[a]&&(r.length&&l.add.push({op:"add",path:r,value:Array.isArray(i)?[]:{}}),l.add.push({op:"add",path:r.concat(a),value:o}))}}}(e,t,[]),[...l.remove.reverse(),...l.replace,...l.add.sort((e,t)=>e.path.length-t.path.length)]},e.patchInPlace=function(r,e){if(!r||"object"!=typeof r)throw new Error("jsonPatch: Must be an object or an array.");for(var n of e){var a=n.path.slice(),s=a.pop();if(null==s)throw new Error("jsonPatch: missing last key");let e=r,t=a.shift();for(;null!=t;){if(!(t in e))throw new Error("jsonPatch: missing parent element "+t);e=e[t],t=a.shift()}if(Array.isArray(e)&&"number"!=typeof s)throw new Error("jsonPatch: expected numeric index for array object");let i=Array.isArray(e)?l:o;"remove"===n.op?i.remove(e,s):"add"!==n.op||s in e?"replace"===n.op&&i.replace(e,s,n.value):i.add(e,s,n.value)}},e.opsAreEqual=function(e,t){return e.op===t.op&&i.U.arrayEquals(e.path,t.path)}}})(ts=ts||{}),(i=>{var r,e;r=i.pxtc||(i.pxtc={}),(e=(e=r.jsonPatch||(r.jsonPatch={})).tests||(e.tests={})).diffTests=function(){var e;for(e of[{comment:"test 1",obja:{a:4,b:5},objb:{a:3,b:5},expected:[{op:"replace",path:["a"],value:3}]},{comment:"test 2",obja:{a:3,b:5},objb:{a:4,c:5},expected:[{op:"remove",path:["b"]},{op:"replace",path:["a"],value:4},{op:"add",path:["c"],value:5}]},{comment:"test 3",obja:{a:4,b:[1,2,3]},objb:{a:3,b:[1,2,4]},expected:[{op:"replace",path:["a"],value:3},{op:"replace",path:["b",2],value:4}]},{comment:"test 4",obja:{a:3,b:[1,2,4]},objb:{a:3,b:[1,2,4,5]},expected:[{op:"add",path:["b"],value:[]},{op:"add",path:["b",3],value:5}]},{comment:"test 5",obja:{a:4,b:{c:3}},objb:{a:4,b:{c:4}},expected:[{op:"replace",path:["b","c"],value:4}]},{comment:"test 6",obja:{a:4,b:{c:4}},objb:{a:5,b:{d:4}},expected:[{op:"remove",path:["b","c"]},{op:"replace",path:["a"],value:5},{op:"add",path:["b"],value:{}},{op:"add",path:["b","d"],value:4}]},{comment:"test 7",obja:{a:4,b:[2,"foo"]},objb:{a:4,b:[2,"foo",["this","that"]]},expected:[{op:"add",path:["b"],value:[]},{op:"add",path:["b",2],value:["this","that"]}]}]){pxt.log(e.comment);var t=i.pxtc.jsonPatch.diff(e.obja,e.objb);r.U.deepEqual(t,e.expected)?pxt.log("succeeded"):(pxt.error("FAILED"),pxt.log("got",t),pxt.log("exp",e.expected))}},e.patchTests=function(){var e;for(e of[{comment:"test 1",obj:{a:"foo",b:[4,11]},patches:[{op:"remove",path:["b"]},{op:"replace",path:["a"],value:4},{op:"add",path:["c"],value:5}],expected:{a:4,c:5}},{comment:"test 2",obj:{a:4,b:[1,2,3]},patches:[{op:"replace",path:["a"],value:3},{op:"replace",path:["b",2],value:4},{op:"add",path:["b",3],value:9}],expected:{a:3,b:[1,2,4,9]}},{comment:"test 3",obj:{a:4,b:{c:3}},patches:[{op:"replace",path:["a"],value:5},{op:"remove",path:["b","c"]},{op:"add",path:["b","d"],value:4}],expected:{a:5,b:{d:4}}},{comment:"test 4",obj:{a:4},patches:[{op:"add",path:["b"],value:[]},{op:"add",path:["b",0],value:"foo"},{op:"add",path:["b",1],value:"bar"}],expected:{a:4,b:["foo","bar"]},validate:e=>e.b&&e.b.forEach}])pxt.log(e.comment),i.pxtc.jsonPatch.patchInPlace(e.obj,e.patches),!r.U.deepEqual(e.obj,e.expected)||!e.validate||e.validate(e.obj)?pxt.log("succeeded"):e.expected&&(pxt.error("FAILED"),pxt.log("got",e.obj),pxt.log("exp",e.expected))}})(ts=ts||{}),(e=>{e.perf||(e.perf={})})(pxt=pxt||{}),pxt.perf.isEnabled||(pxt.perf.isEnabled=()=>!1),pxt.perf.report||(pxt.perf.report=()=>{}),pxt.perf.recordMilestone||(pxt.perf.recordMilestone=()=>{}),pxt.perf.measureStart||(pxt.perf.measureStart=()=>{}),pxt.perf.measureEnd||(pxt.perf.measureEnd=()=>{}),(n=>{n.U=pxtc.Util,n.Util=pxtc.Util;let r,i={};n.setAppTarget=function(e){n.appTarget=e||{},c(),r=n.U.cloneTargetBundle(n.appTarget)};let o;function a(e,t){/^csv-/.test(e)?n.setAppTargetVariant(e.replace(/^csv-*/,"")):n.appTarget&&(i[e]=t,n.U.jsonCopyFrom(n.appTarget.compile.switches,i),n.U.jsonCopyFrom(r.compile.switches,i))}n.setBundledApiInfo=function(e){for(var t of Object.keys(e)){var i,r=e[t].apis.byQName;for(i of Object.keys(r)){var n=r[i],a=i.lastIndexOf("."),s=n.pyQName,a=r[i]={kind:Math.abs(n.kind||7),qName:i,namespace:i.slice(0,a<0?0:a),name:i.slice(a+1),pyQName:s,pyName:s?s.slice(s.lastIndexOf(".")+1):void 0,fileName:"",attributes:n.attributes||{},retType:n.retType||"void",parameters:n.parameters?n.parameters.map(e=>({name:e.name,description:e.description||"",type:e.type||"number",initializer:e.initializer,default:e.default,options:e.options||{},isEnum:!!e.isEnum,handlerParameters:e.handlerParameters})):null,extendsTypes:n.extendsTypes,snippet:n.kind&&n.kind<0?null:void 0,isInstance:!!n.isInstance,isReadOnly:!!n.isReadOnly},s=a.attributes;s.paramDefl||(s.paramDefl={}),s.callingConvention||(s.callingConvention=0),s.paramHelp||(s.paramHelp={}),s.jsDoc||(s.jsDoc=""),s._name=a.name.replace(/@.*/,"")}}o=e},n.getBundledApiInfo=function(){return o},n.savedAppTheme=function(){return r?r.appTheme:void 0},n.setCompileSwitch=a,n.setCompileSwitches=function(e){if(e)for(var t of e.split(/[\s,;:]+/))t&&("-"==t[0]?a(t.slice(1),!1):a(t,!0))};let s;function l(e,t,i){if(Array.isArray(e))return e.map(e=>l(e,t,i));if("object"!=typeof e)return"string"==typeof e&&t.test(e)?i(e):e;for(var r of Object.keys(e))e[r]=l(e[r],t,i);return e}function c(){let e=n.appTarget.compile;(e=e||(n.appTarget.compile={isNative:!1,hasHex:!1,switches:{}})).hasHex&&!e.nativeType&&(e.nativeType=pxtc.NATIVE_TYPE_THUMB),e.switches||(e.switches={}),e.nativeType==pxtc.NATIVE_TYPE_VM&&(e.sourceMap=!0),n.U.jsonCopyFrom(e.switches,i),e.jsRefCounting=!1,e.useUF2||e.useELF||null!=e.noSourceInFlash||(e.noSourceInFlash=!0),void 0===e.utf8&&(e.utf8=!0),n.appTarget.appTheme||(n.appTarget.appTheme={}),n.appTarget.appTheme.embedUrl||(n.appTarget.appTheme.embedUrl=n.appTarget.appTheme.homeUrl);var t=n.appTarget.compileService;if(t&&t.yottaTarget&&!t.yottaBinary&&(t.yottaBinary="pxt-microbit-app-combined.hex"),n.appTarget=l(n.appTarget,/^@cdnUrl@/i,e=>n.BrowserUtils.patchCdn(e)),n.appTarget.bundledpkgs&&Object.keys(n.appTarget.bundledpkgs).forEach(e=>{var e=n.appTarget.bundledpkgs[e],t=JSON.parse(e[n.CONFIG_NAME]);t.icon&&(t.icon=n.BrowserUtils.patchCdn(t.icon)),e[n.CONFIG_NAME]=n.Package.stringifyConfig(t)}),"undefined"!=typeof window){let t={"lockededitor=1":{appTheme:{lockedEditor:!0}},"hidemenu=1":{appTheme:{hideMenuBar:!0}}},i=(n.appTarget.queryVariants&&n.Util.jsonCopyFrom(t,n.appTarget.queryVariants),window.location.href);Object.keys(t).forEach(e=>{new RegExp(e,"i").exec(i)&&(e=t[e])&&n.U.jsonMergeFrom(n.appTarget,e)})}}function u(e=!1){n.perf.measureStart(Measurements.ReloadAppTargetVariant);var t,i=e?"":JSON.stringify(n.appTarget);n.appTarget=n.U.cloneTargetBundle(r),n.appTargetVariant&&((t=n.appTarget.variants&&n.appTarget.variants[n.appTargetVariant])?n.U.jsonMergeFrom(n.appTarget,t):n.U.userError(lf("Variant '{0}' not defined in pxtarget.json",n.appTargetVariant))),c(),!e&&n.onAppTargetChanged&&i!=JSON.stringify(n.appTarget)&&n.onAppTargetChanged(),n.perf.measureEnd(Measurements.ReloadAppTargetVariant)}function t(){return{relprefix:"/--",workerjs:"/worker.js",monacoworkerjs:"/monacoworker.js",gifworkerjs:"/gifjs/gif.worker.js",serviceworkerjs:"/serviceworker.js",typeScriptWorkerJs:"/tsworker.js",pxtVersion:"local",pxtRelId:"localRelId",pxtCdnUrl:"/cdn/",commitCdnUrl:"/cdn/",blobCdnUrl:"/blb/",cdnUrl:"/cdn/",targetUrl:"",targetVersion:"local",targetRelId:"",targetId:n.appTarget?n.appTarget.id:"",simUrl:"/sim/simulator.html",simserviceworkerUrl:"/simulatorserviceworker.js",simworkerconfigUrl:"/sim/workerConfig.js",partsUrl:"/sim/siminstructions.html"}}n.bundledSvg=function(t){if(t){var i=s&&s[t];if(i)return i;if(n.appTarget.simulator&&n.appTarget.simulator.dynamicBoardDefinition){s=s||{};i=n.appTarget.bundledpkgs[t];if(i){if(JSON.parse(i["pxt.json"]).core&&i["board.json"]){var r=JSON.parse(i["board.json"]);if(r&&r.visual&&r.visual.image){let e=r.visual.image;/^pkg:\/\//.test(e)&&(e=i[e.slice(6)]),s[t]="data:image/svg+xml;base64,"+ts.pxtc.encodeBase64(n.Util.toUTF8(e))}}return s[t]}}}},n.replaceStringsInJsonBlob=l,n.reloadAppTargetVariant=u,n.setAppTargetVariant=function(e,t={}){n.debug("app variant: "+e),(t.force||n.appTargetVariant!==e&&(n.appTargetVariant||e))&&(n.appTargetVariant=e,u(t.temporary))},n.setHwVariant=function(e,t){e=e.replace(/.*---/,""),/^[\w\-]+$/.test(e)?(n.hwVariant=e,n.hwName=t||e):(n.hwVariant=null,n.hwName=null),n.debug(`hwVariant: ${n.hwVariant} (${n.hwName})`)},n.hasHwVariants=function(){return!!n.appTarget.variants&&Object.keys(n.appTarget.bundledpkgs).some(e=>/^hw---/.test(e))},n.getHwVariants=function(){return n.appTarget.variants?Object.keys(n.appTarget.bundledpkgs).filter(e=>/^hw---/.test(e)).map(e=>JSON.parse(n.appTarget.bundledpkgs[e][n.CONFIG_NAME])).filter(e=>!!n.appTarget.appTheme.experimentalHw||!e.experimentalHw):[]},n.getActiveHwVariant=function(){return n.hwVariant},n.options={},n.reportException=function(e,t){if(n.error(e),t)try{n.error(t)}catch(e){}},n.reportError=function(e,t,i){if(n.error(e+": "+t),i)try{n.log(JSON.stringify(i,null,2))}catch(e){}},n.localWebConfig=t,n.getOnlineCdnUrl=function(){var e;return n.webConfig&&(e=/^(https:\/\/[^\/]+)/.exec(n.webConfig.commitCdnUrl))?e[1]:null},n.setupWebConfig=function(e){e?n.webConfig=e:n.webConfig||(n.webConfig=t())},n.getEmbeddedScript=function(e){return n.U.lookup(n.appTarget.bundledpkgs||{},e)};let e=void 0;function d(){return e=e||n.Cloud.downloadTargetConfigAsync().then(e=>e||{},e=>({}))}function h(e=null){return(e=e||n.appTarget.compile).nativeType==ts.pxtc.NATIVE_TYPE_VM?e.useESP?e.useUF2?ts.pxtc.BINARY_UF2:ts.pxtc.BINARY_ESP:ts.pxtc.BINARY_PXT64:e.useUF2&&!e.switches.rawELF?ts.pxtc.BINARY_UF2:e.useELF?ts.pxtc.BINARY_ELF:ts.pxtc.BINARY_HEX}n.targetConfigAsync=d,n.packagesConfigAsync=function(){return d().then(e=>e?e.packages:void 0)},n.CONFIG_NAME="pxt.json",n.SIMSTATE_JSON=".simstate.json",n.SERIAL_EDITOR_FILE="serial.txt",n.README_FILE="README.md",n.GITIGNORE_FILE=".gitignore",n.ASSETS_FILE="assets.json",n.CLOUD_ID="pxt/",n.BLOCKS_PROJECT_NAME="blocksprj",n.JAVASCRIPT_PROJECT_NAME="tsprj",n.PYTHON_PROJECT_NAME="pyprj",n.MAIN_BLOCKS="main.blocks",n.MAIN_TS="main.ts",n.MAIN_PY="main.py",n.DEFAULT_GROUP_NAME="other",n.TILEMAP_CODE="tilemap.g.ts",n.TILEMAP_JRES="tilemap.g.jres",n.IMAGES_CODE="images.g.ts",n.IMAGES_JRES="images.g.jres",n.TUTORIAL_CODE_START="_onCodeStart.ts",n.TUTORIAL_CODE_STOP="_onCodeStop.ts",n.TUTORIAL_INFO_FILE="tutorial-info-cache.json",n.TUTORIAL_CUSTOM_TS="tutorial.custom.ts",n.BREAKPOINT_TABLET=991,n.PALETTES_FILE="_palettes.json",n.HISTORY_FILE="_history",n.outputName=h,n.isOutputText=function(e=null){return h(e)==ts.pxtc.BINARY_HEX}})(pxt=pxt||{}),(s=>{{var b=s.blocks||(s.blocks={});let a="this";b.showBlockIdInTooltip=!1,b.requirePxtBlockly=()=>{},b.requireBlockly=()=>{},b.registerFieldEditor=()=>{},b.MATH_FUNCTIONS={unary:["sqrt","sin","cos","tan","asin","acos"],binary:["atan2"],infix:["idiv","imul"]},b.ROUNDING_FUNCTIONS=["round","ceil","floor","trunc"],b.builtinFunctionInfo={"Math.abs":{blockId:"math_op3",params:["x"]},"Math.min":{blockId:"math_op2",params:["x","y"]},"Math.max":{blockId:"math_op2",params:["x","y"]}},b.normalizeBlock=function(e,t=s.log){if(!e)return e;let i=e.replace(/(?:^|[^\\])([%$])\s+/g,"$1");return i!=e&&(t("block has extra spaces: "+e),e=i),(i=(e=i).replace(/([%$]\w+)\s*=\s*(\w+)/,"$1=$2"))!=e&&(t("block has space between %name and = : "+e),e=i),i=i.replace(/\s*\|\s*/g,"|")},b.compileInfo=function(o){let e,l={parameters:[],actualNameToParam:{},definitionNameToParam:{},handlerArgs:[]},t=!(1!=o.kind&&2!=o.kind||o.attributes.defaultInstance||o.isStatic),c=("boolean"!=typeof o.isInstance||null!=(e=o.attributes)&&e.defaultInstance||(t=o.isInstance),!!o.attributes._def),u=c?o.attributes._def.parameters.slice(0):void 0,d=c?u.length:o.parameters?o.parameters.length:0,h=b.builtinFunctionInfo[o.qName],p=(c&&o.attributes._expandedDef&&u.push(...o.attributes._expandedDef.parameters),{}),f=u?u.filter(e=>!e.ref||(p[e.name]=e,!1)):[];if(t&&c&&u.length){var i=p[a]||u[0],r=i.name,n=!i.shadowBlockId||"variables_get"===i.shadowBlockId;let e=o.attributes.paramDefl[r]||o.attributes.paramDefl.this;n&&(e=i.varName||e),l.thisParameter={actualName:a,definitionName:r,shadowBlockId:i.shadowBlockId,type:o.namespace,defaultValue:e,definitionIndex:u.indexOf(i),fieldEditor:m(r,a),fieldOptions:g(r,a),shadowOptions:v(r,a)}}if(o.parameters){let s=t&&!p[a]?1:0;o.parameters.forEach((t,i)=>{let r;if(p[t.name]?r=p[t.name]:s<f.length&&(r=f[s],++s),r||!c){let e=void 0;t.options&&t.options.min&&t.options.max&&(e={min:t.options.min.value,max:t.options.max.value});var n=r?r.name:h?h.params[s++]:t.name,a=r&&("variables_get"===r.shadowBlockId||"lists_create_with"==r.shadowBlockId);l.parameters.push({actualName:t.name,type:t.type,defaultValue:a&&r.varName||t.default,definitionName:n,definitionIndex:r?u.indexOf(r):i,shadowBlockId:r&&r.shadowBlockId,isOptional:!!u&&u.indexOf(r)>=d,fieldEditor:m(n,t.name),fieldOptions:g(n,t.name),shadowOptions:v(n,t.name),range:e})}t.handlerParameters&&t.handlerParameters.forEach(t=>{l.handlerArgs.push({name:t.name,type:t.type,inBlockDef:!!u&&u.some(e=>e.ref&&e.name===t.name),localizationKey:o.qName+"|handlerParam|"+t.name})})})}return l.parameters.forEach(e=>{l.actualNameToParam[e.actualName]=e,l.definitionNameToParam[e.definitionName]=e}),l;function m(e,t){return o.attributes.paramFieldEditor&&(o.attributes.paramFieldEditor[e]||o.attributes.paramFieldEditor[t])}function g(e,t){return o.attributes.paramFieldEditorOptions&&(o.attributes.paramFieldEditorOptions[e]||o.attributes.paramFieldEditorOptions[t])}function v(e,t){return o.attributes.paramShadowOptions&&(o.attributes.paramShadowOptions[e]||o.attributes.paramShadowOptions[t])}},b.hasHandler=function(e){return e.parameters&&e.parameters.some(e=>{var t;return"() => void"==e.type||"Action"==e.type||!(null==(t=e.properties)||!t.length)||!(null==(t=e.handlerParameters)||!t.length)})},b.getHelpUrl=function(e){if(e.attributes.help){var t=e.attributes.help.replace(/^\//,"");if(/^github:/.test(t))return t;if("none"!==t)return"/reference/"+t}else if(e.pkg&&!s.appTarget.bundledpkgs[e.pkg])return(t=e.qName.toLowerCase().split("."))[0]==e.pkg&&t.shift(),`/pkg/${e.pkg}#`+encodeURIComponent(t.join("-"))},b.reporterTypeForArgType=function(e){let t="boolean"!==e&&"number"!==e&&"string"!==e?"argument_reporter_custom":"argument_reporter_"+e;return t=/^(?:Array<(?:.+)>)|(?:(?:.+)\[\])$/.test(e)?"argument_reporter_array":t},b.defaultIconForArgType=function(e=""){switch(e){case"number":return"calculator";case"string":return"text width";case"boolean":return"random";case"Array":return"list";default:return"align justify"}},b.parseFields=function(e){return e.split("|").map((e,t)=>{var i=/([^%]*)\s*%([a-zA-Z0-9_]+)/.exec(e);if(!i)return{n:e,ni:t};let r=i[1];return{n:e,ni:t,pre:r=r&&r.trim(),p:i[2]}})};let n;function t(){if((n={device_while:{name:s.Util.lf("a loop that repeats while the condition is true"),tooltip:s.Util.lf("Run the same sequence of actions while the condition is met."),url:"/blocks/loops/while",category:"loops",block:{message0:s.Util.lf("while %1"),appendField:s.Util.lf("{id:while}do")}},pxt_controls_for:{name:s.Util.lf("a loop that repeats the number of times you say"),tooltip:s.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"/blocks/loops/for",category:"loops",block:{message0:s.Util.lf("for %1 from 0 to %2"),variable:s.Util.lf("{id:var}index"),appendField:s.Util.lf("{id:for}do")}},controls_simple_for:{name:s.Util.lf("a loop that repeats the number of times you say"),tooltip:s.Util.lf("Have the variable '{0}' take on the values from 0 to the end number, counting by 1, and do the specified blocks."),url:"/blocks/loops/for",category:"loops",block:{message0:s.Util.lf("for %1 from 0 to %2"),variable:s.Util.lf("{id:var}index"),appendField:s.Util.lf("{id:for}do")}},pxt_controls_for_of:{name:s.Util.lf("a loop that repeats for each value in an array"),tooltip:s.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"/blocks/loops/for-of",category:"loops",block:{message0:s.Util.lf("for element %1 of %2"),variable:s.Util.lf("{id:var}value"),appendField:s.Util.lf("{id:for_of}do")}},controls_for_of:{name:s.Util.lf("a loop that repeats for each value in an array"),tooltip:s.Util.lf("Have the variable '{0}' take the value of each item in the array one by one, and do the specified blocks."),url:"/blocks/loops/for-of",category:"loops",block:{message0:s.Util.lf("for element %1 of %2"),variable:s.Util.lf("{id:var}value"),appendField:s.Util.lf("{id:for_of}do")}},math_op2:{name:s.Util.lf("minimum or maximum of 2 numbers"),tooltip:{min:s.Util.lf("smaller value of 2 numbers"),max:s.Util.lf("larger value of 2 numbers")},url:"/blocks/math",operators:{op:["min","max"]},category:"math"},math_op3:{name:s.Util.lf("absolute number"),tooltip:s.Util.lf("absolute value of a number"),url:"/reference/math",category:"math",block:{message0:s.Util.lf("absolute of %1")}},math_number:{name:s.Util.lf("{id:block}number"),url:"/types/number",category:"math",tooltip:s.appTarget&&s.appTarget.compile?s.Util.lf("a decimal number"):s.Util.lf("an integer number")},math_integer:{name:s.Util.lf("{id:block}number"),url:"/types/number",category:"math",tooltip:s.Util.lf("an integer number")},math_whole_number:{name:s.Util.lf("{id:block}number"),url:"/types/number",category:"math",tooltip:s.Util.lf("a whole number")},math_number_minmax:{name:s.Util.lf("{id:block}number"),url:"/blocks/math",category:"math"},math_arithmetic:{name:s.Util.lf("arithmetic operation"),url:"/blocks/math",tooltip:{ADD:s.Util.lf("Return the sum of the two numbers."),MINUS:s.Util.lf("Return the difference of the two numbers."),MULTIPLY:s.Util.lf("Return the product of the two numbers."),DIVIDE:s.Util.lf("Return the quotient of the two numbers."),POWER:s.Util.lf("Return the first number raised to the power of the second number.")},operators:{OP:["ADD","MINUS","MULTIPLY","DIVIDE","POWER"]},category:"math",block:{MATH_ADDITION_SYMBOL:s.Util.lf("{id:op}+"),MATH_SUBTRACTION_SYMBOL:s.Util.lf("{id:op}-"),MATH_MULTIPLICATION_SYMBOL:s.Util.lf("{id:op}×"),MATH_DIVISION_SYMBOL:s.Util.lf("{id:op}/"),MATH_POWER_SYMBOL:s.Util.lf("{id:op}**")}},math_modulo:{name:s.Util.lf("division remainder"),tooltip:s.Util.lf("Return the remainder from dividing the two numbers."),url:"/blocks/math",category:"math",block:{MATH_MODULO_TITLE:s.Util.lf("remainder of %1 / %2")}},math_js_op:{name:s.Util.lf("math function"),tooltip:{sqrt:s.Util.lf("Returns the square root of the argument"),sin:s.Util.lf("Returns the sine of the argument"),cos:s.Util.lf("Returns the cosine of the argument"),acos:s.Util.lf("Returns the arccosine of the argument"),asine:s.Util.lf("Returns the arcsine of the argument"),tan:s.Util.lf("Returns the tangent of the argument"),atan2:s.Util.lf("Returns the arctangent of the quotient of the two arguments"),idiv:s.Util.lf("Returns the integer portion of the division operation on the two arguments"),imul:s.Util.lf("Returns the integer portion of the multiplication operation on the two arguments")},url:"/blocks/math",operators:{OP:["sqrt","sin","cos","tan","atan2","idiv","imul"]},category:"math",block:{sqrt:s.Util.lf("{id:op}square root"),sin:s.Util.lf("{id:op}sin"),cos:s.Util.lf("{id:op}cos"),asin:s.Util.lf("{id:op}asin"),acos:s.Util.lf("{id:op}acos"),tan:s.Util.lf("{id:op}tan"),atan2:s.Util.lf("{id:op}atan2"),idiv:s.Util.lf("{id:op}integer /"),imul:s.Util.lf("{id:op}integer ×")}},math_js_round:{name:s.Util.lf("rounding functions"),tooltip:{round:s.Util.lf("Increases the argument to the next higher whole number if its fractional part is more than one half"),ceil:s.Util.lf("Increases the argument to the next higher whole number"),floor:s.Util.lf("Decreases the argument to the next lower whole number"),trunc:s.Util.lf("Removes the fractional part of the argument")},url:"/blocks/math",operators:{OP:["round","ceil","floor","trunc"]},category:"math",block:{round:s.Util.lf("{id:op}round"),ceil:s.Util.lf("{id:op}ceiling"),floor:s.Util.lf("{id:op}floor"),trunc:s.Util.lf("{id:op}truncate")}},variables_change:{name:s.Util.lf("update the value of a number variable"),tooltip:s.Util.lf("Changes the value of the variable by this amount"),url:"/blocks/variables/change",category:"variables",block:{message0:s.Util.lf("change %1 by %2")}},controls_repeat_ext:{name:s.Util.lf("a loop that repeats and increments an index"),tooltip:s.Util.lf("Do some statements several times."),url:"/blocks/loops/repeat",category:"loops",block:{CONTROLS_REPEAT_TITLE:s.Util.lf("repeat %1 times"),CONTROLS_REPEAT_INPUT_DO:s.Util.lf("{id:repeat}do")}},variables_get:{name:s.Util.lf("get the value of a variable"),tooltip:s.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:s.Util.lf("Create 'set %1'")}},variables_get_reporter:{name:s.Util.lf("get the value of a variable"),tooltip:s.Util.lf("Returns the value of this variable."),url:"/blocks/variables",category:"variables",block:{VARIABLES_GET_CREATE_SET:s.Util.lf("Create 'set %1'")}},variables_set:{name:s.Util.lf("assign the value of a variable"),tooltip:s.Util.lf("Sets this variable to be equal to the input."),url:"/blocks/variables/assign",category:"variables",block:{VARIABLES_SET:s.Util.lf("set %1 to %2")}},controls_if:{name:s.Util.lf("a conditional statement"),tooltip:{CONTROLS_IF_TOOLTIP_1:s.Util.lf("If a value is true, then do some statements."),CONTROLS_IF_TOOLTIP_2:s.Util.lf("If a value is true, then do the first block of statements. Otherwise, do the second block of statements."),CONTROLS_IF_TOOLTIP_3:s.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements."),CONTROLS_IF_TOOLTIP_4:s.Util.lf("If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.")},tooltipSearch:"CONTROLS_IF_TOOLTIP_2",url:"/blocks/logic/if",category:"logic",block:{CONTROLS_IF_MSG_IF:s.Util.lf("{id:logic}if"),CONTROLS_IF_MSG_THEN:s.Util.lf("{id:logic}then"),CONTROLS_IF_MSG_ELSE:s.Util.lf("{id:logic}else"),CONTROLS_IF_MSG_ELSEIF:s.Util.lf("{id:logic}else if")}},lists_create_with:{name:s.Util.lf("create an array"),tooltip:s.Util.lf("Creates a new array."),url:"/reference/arrays/create",category:"arrays",blockTextSearch:"LISTS_CREATE_WITH_INPUT_WITH",block:{LISTS_CREATE_EMPTY_TITLE:s.Util.lf("empty array"),LISTS_CREATE_WITH_INPUT_WITH:s.Util.lf("array of"),LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:s.Util.lf("array"),LISTS_CREATE_WITH_ITEM_TITLE:s.Util.lf("value")}},lists_length:{name:s.Util.lf("array length"),tooltip:s.Util.lf("Returns the number of items in an array."),url:"/reference/arrays/length",category:"arrays",block:{LISTS_LENGTH_TITLE:s.Util.lf("length of array %1")}},lists_index_get:{name:s.Util.lf("get a value in an array"),tooltip:s.Util.lf("Returns the value at the given index in an array."),url:"/reference/arrays/get",category:"arrays",block:{message0:s.Util.lf("%1 get value at %2")}},lists_index_set:{name:s.Util.lf("set a value in an array"),tooltip:s.Util.lf("Sets the value at the given index in an array"),url:"/reference/arrays/set",category:"arrays",block:{message0:s.Util.lf("%1 set value at %2 to %3")}},logic_compare:{name:s.Util.lf("comparing two numbers"),tooltip:{LOGIC_COMPARE_TOOLTIP_EQ:s.Util.lf("Return true if both inputs equal each other."),LOGIC_COMPARE_TOOLTIP_NEQ:s.Util.lf("Return true if both inputs are not equal to each other."),LOGIC_COMPARE_TOOLTIP_LT:s.Util.lf("Return true if the first input is smaller than the second input."),LOGIC_COMPARE_TOOLTIP_LTE:s.Util.lf("Return true if the first input is smaller than or equal to the second input."),LOGIC_COMPARE_TOOLTIP_GT:s.Util.lf("Return true if the first input is greater than the second input."),LOGIC_COMPARE_TOOLTIP_GTE:s.Util.lf("Return true if the first input is greater than or equal to the second input.")},url:"/blocks/logic/boolean",category:"logic",block:{search:"= ≠ < ≤ > ≥"}},logic_operation:{name:s.Util.lf("boolean operation"),tooltip:{LOGIC_OPERATION_TOOLTIP_AND:s.Util.lf("Return true if both inputs are true."),LOGIC_OPERATION_TOOLTIP_OR:s.Util.lf("Return true if at least one of the inputs is true.")},url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_OPERATION_AND:s.Util.lf("{id:op}and"),LOGIC_OPERATION_OR:s.Util.lf("{id:op}or")}},logic_negate:{name:s.Util.lf("logical negation"),tooltip:s.Util.lf("Returns true if the input is false. Returns false if the input is true."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_NEGATE_TITLE:s.Util.lf("not %1")}},logic_boolean:{name:s.Util.lf("a `true` or `false` value"),tooltip:s.Util.lf("Returns either true or false."),url:"/blocks/logic/boolean",category:"logic",block:{LOGIC_BOOLEAN_TRUE:s.Util.lf("{id:boolean}true"),LOGIC_BOOLEAN_FALSE:s.Util.lf("{id:boolean}false")}},text:{name:s.Util.lf("a piece of text"),tooltip:s.Util.lf("A letter, word, or line of text."),url:"/types/string",category:"text",block:{search:s.Util.lf("a piece of text")}},text_length:{name:s.Util.lf("number of characters in the string"),tooltip:s.Util.lf("Returns the number of letters (including spaces) in the provided text."),url:"/reference/text/length",category:"text",block:{TEXT_LENGTH_TITLE:s.Util.lf("length of %1")}},text_join:{name:s.Util.lf("join items to create text"),tooltip:s.Util.lf("Create a piece of text by joining together any number of items."),url:"/reference/text/join",category:"text",block:{TEXT_JOIN_TITLE_CREATEWITH:s.Util.lf("join")}},procedures_defnoreturn:{name:s.Util.lf("define the function"),tooltip:s.Util.lf("Create a function."),url:"/types/function/define",category:"functions",block:{PROCEDURES_DEFNORETURN_TITLE:s.Util.lf("function"),PROCEDURE_ALREADY_EXISTS:s.Util.lf("A function named '%1' already exists.")}},procedures_callnoreturn:{name:s.Util.lf("call the function"),tooltip:s.Util.lf("Call the user-defined function."),url:"/types/function/call",category:"functions",block:{PROCEDURES_CALLNORETURN_TITLE:s.Util.lf("call function")}},function_return:{name:s.Util.lf("return a value from within a function"),tooltip:s.Util.lf("Return a value from within a user-defined function."),url:"/types/function/return",category:"functions",block:{message_with_value:s.Util.lf("return %1"),message_no_value:s.Util.lf("return")}},function_definition:{name:s.Util.lf("define the function"),tooltip:s.Util.lf("Create a function."),url:"/types/function/define",category:"functions",block:{FUNCTIONS_EDIT_OPTION:s.Util.lf("Edit Function")}},function_call:{name:s.Util.lf("call the function"),tooltip:s.Util.lf("Call the user-defined function."),url:"/types/function/call",category:"functions",block:{FUNCTIONS_CALL_TITLE:s.Util.lf("call"),FUNCTIONS_GO_TO_DEFINITION_OPTION:s.Util.lf("Go to Definition")}},function_call_output:{name:s.Util.lf("call the function with a return value"),tooltip:s.Util.lf("Call the user-defined function with a return value."),url:"/types/function/call",category:"functions",block:{}}})[pxtc.ON_START_TYPE]={name:s.Util.lf("on start event"),tooltip:s.Util.lf("Run code when the program starts"),url:"/blocks/on-start",category:"loops",block:{message0:s.Util.lf("on start %1 %2")}},n[pxtc.PAUSE_UNTIL_TYPE]={name:s.Util.lf("pause until"),tooltip:s.Util.lf("Pause execution of code until the given boolean expression is true"),url:"/blocks/pause-until",category:"loops",block:{message0:s.Util.lf("pause until %1")}},n[pxtc.TS_BREAK_TYPE]={name:s.Util.lf("break"),tooltip:s.Util.lf("Break out of the current loop or switch"),url:"/blocks/loops/break",category:"loops",block:{message0:s.Util.lf("break")}},n[pxtc.TS_CONTINUE_TYPE]={name:s.Util.lf("continue"),tooltip:s.Util.lf("Skip current iteration and continues with the next iteration in the loop"),url:"/blocks/loops/continue",category:"loops",block:{message0:s.Util.lf("continue")}},s.blocks.showBlockIdInTooltip)for(var e of Object.keys(n)){var t=n[e].tooltip;if("object"==typeof t&&null!==t)for(var i in t)t.hasOwnProperty(i)&&(n[e].tooltip[i]=`${t[i]} (id: ${e})`);else n[e].tooltip=`${n[e].tooltip} (id: ${e})`}}b.blockDefinitions=function(){return n||t(),n},b.getBlockDefinition=function(e){return n||t(),n[e]},b.initInContextTranslationAsync=async function(){n||t();let r={};return await Promise.all(s.Util.values(n).filter(e=>e.block).map(async i=>{var e=Object.keys(i.block);i.translationIds=s.Util.values(i.block),await Promise.all(e.map(async e=>{var t=await s.crowdin.inContextLoadAsync(i.block[e]);i.block[e]=t,/^[A-Z_]+$/.test(e)&&(r[e]=t)}))})),r}}})(pxt=pxt||{}),(u=>{{var o=u.BrowserUtils||(u.BrowserUtils={});function a(){return"undefined"!=typeof navigator}function e(){return a()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)}function l(){return a()&&/mobi/i.test(navigator.userAgent)}function c(){return a()&&/Mac/i.test(navigator.platform)}function d(){return!!navigator&&/Linux/i.test(navigator.platform)}function h(){return a()&&/arm/i.test(navigator.platform)}function p(){return a()&&/Edge/i.test(navigator.userAgent)}function f(){return a()&&/Trident/i.test(navigator.userAgent)}function m(){return!p()&&!f()&&!!navigator&&(/Chrome/i.test(navigator.userAgent)||/Chromium/i.test(navigator.userAgent))}function g(){return!m()&&!p()&&!!navigator&&/(Macintosh|Safari|iPod|iPhone|iPad)/i.test(navigator.userAgent)}function v(){return!g()&&!!navigator&&(/Firefox/i.test(navigator.userAgent)||/Seamonkey/i.test(navigator.userAgent))}function b(){return a()&&/Opera|OPR/i.test(navigator.userAgent)}function y(){return a()&&/Midori/i.test(navigator.userAgent)}function w(){return a()&&/Epiphany/i.test(navigator.userAgent)}function A(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function k(){return"undefined"!=typeof window&&!!window.pxtElectron}function T(){return"undefined"!=typeof window&&!!window.ipcRenderer}function E(){return k()||T()}function x(e){var t;try{return"undefined"!=typeof window&&/^https?:\/\/(?:localhost|127\.0\.0\.1|192\.168\.\d{1,3}\.\d{1,3}|[a-zA-Z0-9.-]+\.local):\d+\/?/.test(window.location.href)&&(e||!/nolocalhost=1/.test(window.location.href))&&!(null!=(t=null==u?void 0:u.webConfig)&&t.isStatic)}catch(e){return!1}}function C(){return"undefined"!=typeof window&&!!window.PointerEvent}function I(){return e()?"windows":c()?"mac":d()&&h()?"rpi":d()?"linux":"unknown"}function S(){return p()?"edge":w()?"epiphany":y()?"midori":b()?"opera":f()?"ie":m()?"chrome":g()?"safari":v()?"firefox":"unknown"}function U(){if(!a())return null;let e=[];return b()&&(e=/(Opera|OPR)\/([0-9\.]+)/i.exec(navigator.userAgent)),(e=w()?/Epiphany\/([0-9\.]+)/i.exec(navigator.userAgent):y()?/Midori\/([0-9\.]+)/i.exec(navigator.userAgent):g()?(e=/Version\/([0-9\.]+)/i.exec(navigator.userAgent))||/(Macintosh|iPod( touch)?|iPhone|iPad); (CPU|Intel).*?OS (X )?(\d+)/i.exec(navigator.userAgent):(m()?/(Chrome|Chromium)\/([0-9\.]+)/i:p()?/Edge\/([0-9\.]+)/i:f()?/(MSIE |rv:)([0-9\.]+)/i:/(Firefox|Seamonkey)\/([0-9\.]+)/i).exec(navigator.userAgent))&&0!=e.length?e[e.length-1]:null}o.isDocumentVisible=function(){return"undefined"!=typeof window&&"visible"===document.visibilityState},o.isIFrame=function(){try{return window&&window.self!==window.top}catch(e){return!0}},o.hasNavigator=a,o.hasWindow=function(){return"undefined"!=typeof window},o.isWindows=e,o.isWindows10=function(){return a()&&/(Win32|Win64|WOW64)/i.test(navigator.platform)&&/Windows NT 10/i.test(navigator.userAgent)},o.isMobile=l,o.isIOS=function(){return a()&&(/iPad|iPhone|iPod/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&1<navigator.maxTouchPoints)},o.isAndroid=function(){return a()&&/android/i.test(navigator.userAgent)},o.isMac=c,o.isLinux=d,o.isARM=h,o.isEdge=p,o.isChromiumEdge=function(){return a()&&/Edg\//i.test(navigator.userAgent)},o.isIE=f,o.isChrome=m,o.isSafari=g,o.isFirefox=v,o.isOpera=b,o.isMidori=y,o.isEpiphany=w,o.isTouchEnabled=A,o.isPxtElectron=k,o.isIpcRenderer=T,o.isElectron=E,o.isWinRT=()=>"undefined"!=typeof Windows,o.isLocalHost=x,o.isLocalHostDev=function(){return x()&&!E()},o.isSkillmapEditor=function(){try{return/skill(?:s?)map=1/i.test(window.location.href)}catch(e){return!1}},o.isTabletSize=function(){return(null==window?void 0:window.innerWidth)<=u.BREAKPOINT_TABLET},o.isComputerSize=function(){return(null==window?void 0:window.innerWidth)>u.BREAKPOINT_TABLET},o.isInGame=function(){return!!/inGame=1/i.exec(window.location.href)},o.hasFileAccess=function(){var e=u.appTarget.appTheme.disableFileAccessinMaciOs&&(u.BrowserUtils.isMac()||u.BrowserUtils.isIOS()),t=u.appTarget.appTheme.disableFileAccessinAndroid&&u.BrowserUtils.isAndroid();return!e&&!t},o.noSharedLocalStorage=function(){try{return/nosharedlocalstorage/i.test(window.location.href)}catch(e){return!1}},o.useOldTutorialLayout=function(){var e;if(null!=(e=null==(e=u.appTarget)?void 0:e.appTheme)&&e.legacyTutorial)return!0;try{return/tutorialview=old/.test(window.location.href)}catch(e){return!1}},o.hasPointerEvents=C,o.os=I,o.browser=S,o.browserVersion=U;let s=!1;function $(){return l()&&g()&&!/downloadWindowOpen=0/i.test(window.location.href)}function N(t,e,i){var r=$(),n=U(),a=parseInt(n||"0");if(r)i?i.location.href=t:window.open(t,"_self");else if(u.BrowserUtils.isSafari()&&(a<10||0==n.indexOf("10.0")||l())){let e=document.getElementById("downloader");e||(u.debug("injecting downloader iframe"),(e=document.createElement("iframe")).id="downloader",e.style.position="absolute",e.style.right="0",e.style.bottom="0",e.style.zIndex="-1",e.style.width="1px",e.style.height="1px",document.body.appendChild(e)),e.src=t}else/^data:/i.test(t)&&(u.BrowserUtils.isEdge()||u.BrowserUtils.isIE())?(r=atob(t.split(",")[1]),i=u.Util.stringToUint8Array(r),a=new Blob([i],{type:"img/png"}),window.navigator.msSaveOrOpenBlob(a,e)):"string"==typeof(n=window.document.createElement("a")).download?(n.href=t,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)):document.location.href=t}function H(e,t){let i="data";l()&&g()&&u.appTarget.appTheme.mobileSafariDownloadProtocol&&(i=u.appTarget.appTheme.mobileSafariDownloadProtocol);var r=/downloadProtocol=([a-z0-9:/?]+)/i.exec(window.location.href);return(i=r?r[1]:i)+":"+t+";base64,"+e}function O(e,t,i={}){u.debug("trigger download");var r,{contentType:i="application/octet-stream",userContextWindow:n,onError:a,maintainObjectURL:s}=i,o=null==(o=window.URL)?void 0:o.createObjectURL,l=u.appTarget.appTheme.disableBlobObjectDownload;let c;try{o&&!l?(N(r=o(new Blob([u.Util.stringToUint8Array(atob(e))],{type:i})),t,n),s?c=r:window.setTimeout(()=>window.URL.revokeObjectURL(c),0)):N(c=H(e,t),t,n)}catch(e){a&&a(e),u.debug("saving failed")}return c}function G(i){let r=document.createElement("img");return new Promise((e,t)=>{r.onload=()=>e(r),r.onerror=()=>e(void 0),r.crossOrigin="anonymous",r.src=i})}function _(e){return/^https?:\/\//i.test(e)?e:(window.MonacoPaths||{})[e]||(u.U.startsWith(e,u.webConfig.commitCdnUrl)?e:u.webConfig.commitCdnUrl+e)}o.isBrowserSupported=function(){var e,t,i,r,n,a;return!navigator||!!/bot|crawler|spider|crawling/i.test(navigator.userAgent)||(null==(e=(null==(e=u.appTarget)?void 0:e.unsupportedBrowsers)||(null==(e=window.pxtTargetBundle)?void 0:e.unsupportedBrowsers))||!e.some(e=>e.id==S()))&&(e=U(),r=parseInt(e||"0"),a=m()&&38<=r,n=v()&&31<=r,t=p(),i=g()&&9<=r,r=b()&&m()&&21<=r,a=a||n||t||i||r,n=y()||d()&&h()&&w(),a=(a=a&&!n)||/anybrowser=(true|1)/.test(window.location.href),s||(u.log(`Browser: ${S()} ${e} on `+I()),a||u.tickEvent("browser.unsupported",{useragent:navigator.userAgent}),s=!0),a)},o.devicePixelRatio=function(){var e,t;return"undefined"!=typeof window&&window.screen?(e=window.screen.systemXDPI,t=window.screen.logicalXDPI,void 0!==e&&void 0!==t&&t<e?e/t:window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1):1},o.browserDownloadBinText=function(e,t,i){return O(ts.pxtc.encodeBase64(e),t,i)},o.browserDownloadText=function(e,t,i){return O(ts.pxtc.encodeBase64(u.Util.toUTF8(e)),t,i)},o.isBrowserDownloadInSameWindow=$,o.isBrowserDownloadWithinUserContext=function(){var e=U(),e=parseInt(e||"0");return l()&&g()&&11<=e||/downloadUserContext=1/i.test(window.location.href)},o.browserDownloadDataUri=N,o.browserDownloadUInt8Array=function(e,t,i){return O(ts.pxtc.encodeBase64(u.Util.uint8ArrayToString(e)),t,i)},o.toDownloadDataUri=H,o.browserDownloadBase64=O,o.loadImageAsync=G,o.loadCanvasAsync=function(e){return G(e).then(e=>{var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t})},o.scaleImageData=function(e,t){var i=document.createElement("canvas"),r=document.createElement("canvas"),n=(i.width=e.width,i.height=e.height,r.width=e.width*t,r.height=e.height*t,i.getContext("2d")),r=r.getContext("2d");return n.putImageData(e,0,0),r.imageSmoothingEnabled=!1,r.scale(t,t),r.drawImage(i,0,0),r.getImageData(0,0,e.width*t,e.height*t)},o.imageDataToPNG=function(e,t=1){var i,r,n,a;if(e)return i=document.createElement("canvas"),r=document.createElement("canvas"),i.width=e.width,i.height=e.height,r.width=e.width*t,r.height=e.height*t,n=i.getContext("2d"),a=r.getContext("2d"),n.putImageData(e,0,0),a.imageSmoothingEnabled=!1,a.scale(t,t),a.drawImage(i,0,0),r.toDataURL("image/png")},o.encodeToPngAsync=function(i,e){let{width:a,height:s,pixelDensity:o=4,maxSize:l=1e7,text:c}=e||{};return new Promise((r,e)=>{let n=new Image;n.onload=function(){let t=document.createElement("canvas");var e=t.getContext("2d");t.width=(a||n.width)*o,t.height=(s||n.height)*o,c&&(e.fillStyle="#fff",e.fillRect(0,0,t.width,t.height)),e.drawImage(n,0,0,a,s,0,0,t.width,t.height);let i=t.toDataURL("image/png");for(;i.length>l;)t.width=t.width/2>>0,t.height=t.height/2>>0,u.debug(`screenshot size ${i.length}b, shrinking to ${t.width}x`+t.height),e.drawImage(n,0,0,a,s,0,0,t.width,t.height),i=t.toDataURL("image/png");c?u.lzmaCompressAsync(c).then(e=>{e=u.Util.encodeBlobAsync(t,e);r(e.toDataURL("image/png"))}):r(i)},n.onerror=e=>{u.reportError("png","png rendering failed"),r(void 0)};try{var t=new URL(i);"http:"!==t.protocol&&"https:"!==t.protocol||t.host===window.location.host||n.setAttribute("crossOrigin","anonymous")}catch(e){}n.src=i})},o.resolveCdnUrl=_,o.loadStyleAsync=function(e,t){let r="style-"+(e=t?"rtl"+e:e);if(document.getElementById(r))return Promise.resolve();let n=_(e);return(t=u.Util.toArray(document.head.getElementsByTagName("link")).filter(e=>e.getAttribute("href")==n)[0])?(t.id||(t.id=r),Promise.resolve()):new Promise((e,t)=>{var i=document.createElement("link");i.href=n,i.rel="stylesheet",i.type="text/css",i.id=r,i.addEventListener("load",()=>e()),i.addEventListener("error",e=>t(e)),document.head.appendChild(i)})};let n={};o.loadScriptAsync=function(e){let r=_(e),t=n[r];return t=t||(n[r]=new Promise((e,t)=>{u.debug("script: loading "+r);var i=document.createElement("script");i.type="text/javascript",i.addEventListener("load",()=>e()),i.addEventListener("error",e=>{delete n[r],t(e)}),i.src=r,i.async=!0,document.body.appendChild(i)}))},o.loadAjaxAsync=function(r){return new Promise((e,t)=>{let i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(200==i.status?e(i.responseText):t(i.status))},i.open("GET",r,!0),i.send()})};let t;function z(e,t){return e?t?(e.indexOf("/")==e.length-1?e.substring(0,e.length-1):e)+"/"+(0==t.indexOf("/")?t.substring(1):t):e:t}function q(){var e=a()&&window.navigator;return e&&e.storage&&e.storage.estimate?e.storage.estimate():Promise.resolve({})}o.loadBlocklyAsync=function(){if(!t){u.debug("blockly: delay load");let e=u.BrowserUtils.loadStyleAsync("blockly.css",ts.pxtc.Util.isUserLanguageRtl());e=e.then(()=>{u.debug("blockly: loaded")}),t=e}return t},o.patchCdn=function(e){var t;return e&&((t=u.getOnlineCdnUrl())?e.replace("@cdnUrl@",t):e.replace(/@cdnUrl@\/(blob|commit)\/[a-f0-9]{40}\//,"./"))},o.initTheme=function(){var e,t,i=u.appTarget.appTheme;i&&i.accentColor&&((e=document.createElement("style")).type="text/css",e.appendChild(document.createTextNode(`.ui.accent { color: ${i.accentColor}; }
                .ui.inverted.menu .accent.active.item, .ui.inverted.accent.menu  { background-color: ${i.accentColor}; }`)),document.getElementsByTagName("head")[0].appendChild(e)),u.Util.isUserLanguageRtl()&&(u.debug("rtl layout"),u.BrowserUtils.addClass(document.body,"rtl"),document.body.style.direction="rtl",(e=(i=u.Util.toArray(document.head.getElementsByTagName("link"))).filter(e=>u.Util.endsWith(e.getAttribute("href"),"semantic.css"))[0])&&(t=e.getAttribute("data-rtl"))&&(u.debug("swapping to "+t),e.setAttribute("href",t)),e=i.filter(e=>u.Util.endsWith(e.getAttribute("href"),"blockly.css"))[0])&&(t=e.getAttribute("data-rtl"))&&(u.debug("swapping to "+t),e.setAttribute("href",t),e.removeAttribute("data-rtl"))},o.changeHash=function(e,t){"#"!=e.charAt(0)&&(e="#"+e),t?window.location.hash=e:window.history.replaceState("","",e)},o.urlJoin=z,o.joinURLs=function(...t){let i;if(t)for(let e=0;e<t.length;e++)i=z(i,t[e]);return i},o.storageEstimateAsync=q,o.scheduleStorageCleanup=a()&&navigator.storage&&navigator.storage.estimate?ts.pxtc.Util.throttle(function(){q().then(e=>(u.debug(`storage estimate: ${e.usage/e.quota*100>>0}%, ${e.usage/1e6>>0}/${e.quota/1e6>>0}Mb`),e.quota&&e.usage&&1e6<e.quota&&.9<e.usage/e.quota?(u.log("quota usage exceeded, clearing translations"),u.tickEvent("storage.cleanup"),P()):Promise.resolve())).catch(e=>{u.reportException(e)})},1e4,!1):()=>{},o.stressTranslationsAsync=function t(){let i="...";for(let e=0;e<16;++e)i+=i+Math.random();return u.log(`adding entry ${2*i.length} bytes`),u.U.delay(1).then(()=>V()).then(e=>e.setAsync("foobar",Math.random().toString(),null,void 0,i)).then(()=>u.BrowserUtils.storageEstimateAsync()).then(e=>!e.quota||e.usage/e.quota<.8?t():Promise.resolve())};class M{constructor(){this.translations={}}key(e,t){return e+`|${t}|master`}get(e,t){return this.translations[this.key(e,t)]}getAsync(e,t){return Promise.resolve(this.get(e,t))}set(e,t,i,r,n,a){this.translations[this.key(e,t)]={etag:i,time:r,strings:n,md:a}}setAsync(e,t,i,r,n){return this.set(e,t,i,u.Util.now(),r),Promise.resolve()}clearAsync(){return this.translations={},Promise.resolve()}}class R{constructor(e,t,i,r,n=!1){this.name=e,this.version=t,this.upgradeHandler=i,this.quotaExceededHandler=r,this.skipErrorLog=n}throwIfNotOpened(){if(!this._db)throw new Error("Database not opened; call IDBWrapper.openAsync() first")}errorHandler(e,t,i){this.skipErrorLog?i(e):(u.error(new Error(this.name+` IDBWrapper error for ${t}: `+e.message)),i(e),"QuotaExceededError"==e.name&&(u.log("storage quota exceeded..."),u.tickEvent("storage.quotaexceedederror"),this.quotaExceededHandler)&&this.quotaExceededHandler())}getObjectStore(e,t="readonly"){return this.throwIfNotOpened(),this._db.transaction([e],t).objectStore(e)}static deleteDatabaseAsync(r){return new Promise((e,t)=>{let i=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).deleteDatabase(r);i.onsuccess=()=>e(),i.onerror=()=>t(i.error)})}openAsync(){return new Promise((e,t)=>{let i=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(this.name,this.version);i.onsuccess=()=>{this._db=i.result,e()},i.onerror=()=>this.errorHandler(i.error,"open",t),i.onupgradeneeded=e=>this.upgradeHandler(e,i)})}getAsync(r,n){return new Promise((e,t)=>{let i=this.getObjectStore(r).get(n);i.onsuccess=()=>e(i.result),i.onerror=()=>this.errorHandler(i.error,"get",t)})}getAllAsync(n){return new Promise((e,t)=>{let i=this.getObjectStore(n).openCursor(),r=[];i.onsuccess=()=>{i.result?(r.push(i.result.value),i.result.continue()):e(r)},i.onerror=()=>this.errorHandler(i.error,"getAll",t)})}setAsync(n,a){return new Promise((e,t)=>{var i=this.getObjectStore(n,"readwrite");let r;(r=null!=a.id?i.put(a):i.add(a)).onsuccess=()=>e(),r.onerror=()=>this.errorHandler(r.error,"set",t)})}deleteAsync(r,n){return new Promise((e,t)=>{let i=this.getObjectStore(r,"readwrite").delete(n);i.onsuccess=()=>e(),i.onerror=()=>this.errorHandler(i.error,"delete",t)})}deleteAllAsync(r){return new Promise((e,t)=>{let i=this.getObjectStore(r,"readwrite").clear();i.onsuccess=()=>e(),i.onerror=()=>this.errorHandler(i.error,"deleteAll",t)})}getObjectStoreWrapper(e){return new j(this,e)}}o.IDBWrapper=R;class j{constructor(e,t){this.db=e,this.storeName=t}getAsync(e){return this.db.getAsync(this.storeName,e)}getAllAsync(){return this.db.getAllAsync(this.storeName)}setAsync(e){return this.db.setAsync(this.storeName,e)}async deleteAsync(e){await this.db.deleteAsync(this.storeName,e)}async deleteAllAsync(){await this.db.deleteAllAsync(this.storeName)}}o.IDBObjectStoreWrapper=j;class F{constructor(e){this.db=e,this.mem=new M}static dbName(){return"__pxt_translations_"+(u.appTarget.id||"")}static createAsync(){function t(){let e=new R(F.dbName(),2,(e,t)=>{t.result.createObjectStore(F.TABLE,{keyPath:F.KEYPATH})},()=>{P().catch(e=>{})});return e.openAsync().then(()=>new F(e))}return t().catch(e=>(u.log("db: failed to open database, try delete entire store..."),R.deleteDatabaseAsync(F.dbName()).then(()=>t())))}getAsync(t,i){t=(t||"en-US").toLowerCase();var e=this.mem.key(t,i),r=this.mem.get(t,i);return r?Promise.resolve(r):this.db.getAsync(F.TABLE,e).then(e=>e?(this.mem.set(t,i,e.etag,e.time,e.strings),Promise.resolve(e)):Promise.resolve(void 0)).catch(e=>Promise.resolve(void 0))}setAsync(e,t,i,r,n){e=(e||"en-US").toLowerCase();var a=this.mem.key(e,t),s=u.Util.now(),e=(this.mem.set(e,t,i,s,r,n),r&&Object.keys(r).filter(e=>!r[e]).forEach(e=>delete r[e]),{id:a,etag:i,time:s,strings:r,md:n});return this.db.setAsync(F.TABLE,e).finally(()=>o.scheduleStorageCleanup()).catch(e=>(u.log(`db: set failed (${e.message}), recycling...`),this.clearAsync()))}clearAsync(){return this.db.deleteAllAsync(F.TABLE).then(()=>u.debug("db: all clean")).catch(e=>{u.error("db: failed to delete all")})}}F.TABLE="files",F.KEYPATH="id";let i;function V(){return u.Util.isNodeJS?Promise.resolve(new M):i=i||F.createAsync().catch(()=>new M)}function P(){function t(){let t=F.dbName();return R.deleteDatabaseAsync(t).then(()=>{i=void 0}).catch(e=>{u.log("db: failed to delete "+t),i=void 0})}return i?i.then(e=>e.clearAsync()).catch(e=>t().then()):t()}function L(e){e=JSON.stringify(e)+u.appTarget.versions.pxt+"_"+u.appTarget.versions.target;return pxtc.U.sha256(e)}function J(e,t){return e+"|"+(t||"master")}o.translationDbAsync=V,o.clearTranslationDbAsync=P,o.getTutorialCodeHash=L;class B{constructor(e){this.db=e}static dbName(){return"__pxt_tutorialinfo_"+(u.appTarget.id||"")}static createAsync(){function t(){let e=new u.BrowserUtils.IDBWrapper(B.dbName(),2,(e,t)=>{t.result.createObjectStore(B.TABLE,{keyPath:B.KEYPATH})},()=>{u.BrowserUtils.IDBWrapper.deleteDatabaseAsync(B.dbName())});return e.openAsync().then(()=>new B(e))}return t().catch(e=>(u.log("db: failed to open tutorial info database, try delete entire store..."),u.BrowserUtils.IDBWrapper.deleteDatabaseAsync(B.dbName()).then(()=>t())))}getAsync(e,t,i){let r=J(e,i),n=L(t);return this.db.getAsync(B.TABLE,r).then(e=>{if(e&&e.hash==n&&u.Util.now()-(e.time||0)<864e5)return e;this.db.deleteAsync(B.TABLE,r)})}setAsync(e,t,i,r,n,a){u.perf.measureStart(Measurements.TutorialInfoDbSetAsync);i=L(i);return this.setWithHashAsync(e,t,i,r,n)}setWithHashAsync(e,i,t,r,n,a){u.perf.measureStart(Measurements.TutorialInfoDbSetAsync);e=J(e,a);let s={};Object.keys(i).forEach(t=>{Object.keys(i[t]).forEach(e=>{s[e]=i[t][e]})});a={id:e,time:u.Util.now(),hash:t,snippets:i,blocks:s,highlightBlocks:r,validateBlocks:n};return this.db.setAsync(B.TABLE,a).then(()=>{u.perf.measureEnd(Measurements.TutorialInfoDbSetAsync)})}clearAsync(){return this.db.deleteAllAsync(B.TABLE).then(()=>u.debug("db: all clean")).catch(e=>{u.error("db: failed to delete all")})}}B.TABLE="info",B.KEYPATH="id";let r;function D(e){return e.split(/\s+/).filter(e=>!!e)}function W(){var e=new RegExp(u.Util.escapeForRegex(u.Util.pxtLangCookieId)+"=(.*?)(?:;|$)").exec(document.cookie);return e&&e[1]||null}o.tutorialInfoDbAsync=function(){return r=r||B.createAsync()},o.clearTutorialInfoDbAsync=function(){function t(){let t=B.dbName();return R.deleteDatabaseAsync(t).then(()=>{r=void 0}).catch(e=>{u.log("db: failed to delete "+t),r=void 0})}return r?r.then(e=>e.clearAsync()).catch(e=>t().then()):t()},o.pointerEvents=C()?{up:"pointerup",down:["pointerdown"],move:"pointermove",enter:"pointerenter",leave:"pointerleave"}:A()?{up:"mouseup",down:["mousedown","touchstart"],move:"touchmove",enter:"touchenter",leave:"touchend"}:{up:"mouseup",down:["mousedown"],move:"mousemove",enter:"mouseenter",leave:"mouseleave"},o.getPageX=function(e){return("pageX"in e?e:e.changedTouches[0]).pageX},o.getPageY=function(e){return("pageY"in e?e:e.changedTouches[0]).pageY},o.getClientX=function(e){return("clientX"in e?e:e.changedTouches[0]).clientX},o.getClientY=function(e){return("clientY"in e?e:e.changedTouches[0]).clientY},o.popupWindow=function(e,t,i,r){try{var n=window.screenLeft||window.screenX,a=window.screenTop||window.screenY,s=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o="width="+i+", height="+r+", top="+((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)/2-r/2+a)+", left="+(s/2-i/2+n),l=window.open(e,t,u.BrowserUtils.isIpcRenderer()?void 0:o);return l.focus&&l.focus(),l}catch(e){return u.tickEvent("pxt.popupError",{msg:e.message}),null}},o.containsClass=function(i,e){return D(e).every(e=>{return e=e,(t=i).classList?t.classList.contains(e):!((t.className+"").split(/\s+/).indexOf(e)<0);var t})},o.addClass=function(i,e){D(e).forEach(e=>{var t;e=e,(t=i).classList?t.classList.add(e):(t.className+"").split(/\s+/).indexOf(e)<0&&(t.className.baseVal+=" "+e)})},o.removeClass=function(i,e){D(e).forEach(e=>{var t;t=e,(e=i).classList?e.classList.remove(t):e.className.baseVal=(e.className+"").split(/\s+/).filter(e=>e!=t).join(" ")})},o.getCookieLang=W,o.setCookieLang=function(e,t=!1){u.Util.allLanguages[e]&&e!==W()&&(u.tickEvent("menu.lang.setcookielang",{lang:e,docs:""+t}),(t=new Date).setTime(t.getTime()+24*u.Util.langCookieExpirationDays*60*60*1e3),document.cookie=`${u.Util.pxtLangCookieId}=${e}; expires=${t.toUTCString()}; path=/`)},o.cacheBustingUrl=function(e){return e&&(/[?&]rnd=/.test(e)?e:`${e}${0<e.indexOf("?")?"&":"?"}rnd=`+Math.random())},o.appendUrlQueryParams=function(e,t){var i,r,n=[];for([i,r]of t.entries())n.push(encodeURIComponent(i)+"="+encodeURIComponent(r));return n.length&&(-1!==e.indexOf("?")?e+="&"+n.join("&"):e+="?"+n.join("&")),e},o.legacyCopyText=function(e){e.focus(),e.setSelectionRange(0,9999);try{var t=document.execCommand("copy");return u.debug("copy: "+t),!!t}catch(e){return!1}},o.setApplicationTheme=function(e){var t=document.body,i=t.classList;for(let e=0;e<i.length;e++)/^theme-/.test(i[e])&&t.classList.remove(i[e]);e&&t.classList.add("theme-"+e)},o.isElement=function(e){return e.nodeType===Node.ELEMENT_NODE}}})(pxt=pxt||{}),(t=>{{var i=t.cloud||(t.cloud={});let e="https://staging.pxt.io";i.DEV_BACKEND=e,i.DEV_REGION="US",i.devBackendType=function(){return"https://makecode.com"===i.DEV_BACKEND?"prod":i.DEV_BACKEND===e?"staging":"http://localhost:8080"===i.DEV_BACKEND?"localhost":"prod"},i.cloudStatus={none:{value:"none"},synced:{value:"synced",icon:"cloud-saved-b",tooltip:lf("Project saved to cloud"),shortStatus:lf("saved"),longStatus:lf("Saved to cloud"),indicator:""},justSynced:{value:"justSynced",icon:"cloud-saved-b",tooltip:lf("Project saved to cloud"),shortStatus:lf("saved!"),longStatus:lf("Saved to cloud!"),indicator:""},offline:{value:"offline",icon:"cloud-error-b",tooltip:lf("Unable to connect to cloud"),shortStatus:lf("offline"),longStatus:lf("Offline"),indicator:lf("offline")},syncing:{value:"syncing",icon:"cloud-saving-b",tooltip:lf("Saving project to cloud..."),shortStatus:lf("saving..."),longStatus:lf("Saving to cloud..."),indicator:lf("syncing...")},conflict:{value:"conflict",icon:"cloud-error-b",tooltip:lf("Project was edited in two places and the changes conflict"),shortStatus:lf("conflict!"),longStatus:lf("Project has a conflict!"),indicator:"!"},localEdits:{value:"localEdits",icon:"cloud-saving-b",tooltip:lf("Project has local changes and will save to cloud soon."),shortStatus:"",longStatus:"",indicator:"*"}}}})(pxt=pxt||{}),(e=>{var i;(e=(i=e.commands||(e.commands={})).WebUSBPairResult||(i.WebUSBPairResult={}))[e.Failed=0]="Failed",e[e.Success=1]="Success",e[e.UserRejected=2]="UserRejected",i.deployCoreAsync=void 0,i.deployFallbackAsync=void 0,i.hasDeployFn=()=>i.deployCoreAsync||i.deployFallbackAsync,i.deployAsync=(e,t)=>(i.deployCoreAsync||i.deployFallbackAsync)(e,t),i.patchCompileResultAsync=void 0,i.browserDownloadAsync=void 0,i.saveOnlyAsync=void 0,i.renderBrowserDownloadInstructions=void 0,i.renderUsbPairDialog=void 0,i.renderIncompatibleHardwareDialog=void 0,i.showUploadInstructionsAsync=void 0,i.saveProjectAsync=void 0,i.electronDeployAsync=void 0,i.electronFileDeployAsync=void 0,i.webUsbPairDialogAsync=void 0,i.onTutorialCompleted=void 0,i.perfMeasurementThresholdMs=void 0,i.onPerfMilestone=void 0,i.onPerfMeasurement=void 0,i.workspaceLoadedAsync=void 0,i.getDownloadMenuItems=void 0,i.notifyProjectCompiled=void 0,i.notifyProjectSaved=void 0,i.onDownloadButtonClick=void 0,i.getDefaultProjectName=void 0,i.onMarkdownActivityLoad=void 0})(pxt=pxt||{}),(u=>{function i(e){var e=u.toolbox.convertColor(e),t=parseInt(e.slice(1,3),16)/255,i=parseInt(e.slice(3,5),16)/255,e=parseInt(e.slice(5,7),16)/255;return.2126*(t<=.03928?t/12.92:Math.pow((.055+t)/1.055,2.4))+.7152*(i<=.03928?i/12.92:Math.pow((.055+i)/1.055,2.4))+.0722*(e<=.03928?e/12.92:Math.pow((.055+e)/1.055,2.4))}function n(e,t){return(i(e)+.05)/(i(t)+.05)}function o(e){return("0"+e.toString(16)).slice(-2)}u.getWhiteContrastingBackground=function(t){if(!(4.5<=n("#ffffff",t))){var i=(e=>{let t=u.toolbox.convertColor(e),i=parseInt(t.slice(1,3),16)/255,r=parseInt(t.slice(3,5),16)/255,n=parseInt(t.slice(5,7),16)/255,a=Math.max(Math.max(i,r),n),s=Math.min(Math.min(i,r),n),o=a-s,l;0==o?l=0:a===i?l=((r-n)/o%6+6)%6:a===r?l=(n-i)/o+2:a===n&&(l=(i-r)/o+4);var e=(s+a)/2,c=0==o?0:o/(1-Math.abs(2*e-1));return{h:60*l,s:c,l:e}})(t);let e=i.l-.05;for(;0<e;){var r=(e=>{let t=(1-Math.abs(2*e.l-1))*e.s,i=e.h/60,r=t*(1-Math.abs(i%2-1)),n;void 0===e.h?n=[0,0,0]:i<=1?n=[t,r,0]:i<=2?n=[r,t,0]:i<=3?n=[0,t,r]:i<=4?n=[0,r,t]:i<=5?n=[r,0,t]:i<=6&&(n=[t,0,r]),e=e.l-.5*t;var a=Math.round(255*(n[0]+e)),s=Math.round(255*(n[1]+e)),e=Math.round(255*(n[2]+e));return"#"+o(a)+o(s)+o(e)})({h:i.h,s:i.s,l:e});if(4.5<=n("#ffffff",r))return r;e-=.05}u.warn("Couldn't find a contrasting background for color "+t)}return t},u.contrastRatio=n})(pxt=pxt||{}),(e=>{e.TutorialInfoDbSetAsync="tutorial info db setAsync",e.ReloadAppTargetVariant="reloadAppTargetVariant",e.Sha256Buffer="sha256buffer",e.WebworkerRecvHandler="webworker recvHandler",e.NetworkRequest="network.request"})(Measurements=Measurements||{}),(n=>{function e(){let e;return e||(e=n.U.isNodeJS?Promise.resolve(require("lzma")):Promise.resolve(window.LZMA)).then(e=>(e||n.reportError("lzma","failed to load"),e)),e}n.lzmaDecompressAsync=function(r){return e().then(t=>new Promise((i,e)=>{try{t.decompress(r,(e,t)=>{t&&n.debug("lzma decompression failed"),i(t?void 0:e)})}catch(e){e&&n.debug("lzma decompression failed"),i(void 0)}}))},n.lzmaCompressAsync=function(r){return e().then(t=>new Promise((i,e)=>{try{t.compress(r,7,(e,t)=>{t&&n.reportException(t),i(t?void 0:new Uint8Array(e))})}catch(e){n.reportException(e),i(void 0)}}))}})(pxt=pxt||{}),(Ae=>{{var e=Ae.cpp||(Ae.cpp={}),ke=pxtc.Util;let be=ke.lf,ye={"pxt::mkAction":1,"pxt::dumpPerfCounters":1,"pxt::deepSleep":1,"pxt::getConfig":1,"pxtrt::mkMap":1,"pxtrt::mapSet":1,"pxtrt::stclo":1,"pxtrt::mklocRef":1,"pxtrt::stlocRef":1,"pxtrt::ldlocRef":1,"pxtrt::panic":1};function Te(i="namespace"){let r="",n="",e=(e,t="")=>{n!=e&&(n&&(r+="}\n"),e&&(r+=t||i+" "+e+" {\n"),n=e)},t="    ";return{setNs:e,clear:()=>{r="",n=""},write:e=>{e.trim()?(e=e.trim().replace(/^\s*/gm,t).replace(/^(\s*)\*/gm,(e,t)=>t+" *"),r+=e+"\n"):r+="\n"},incrIndent:()=>{t+="    "},decrIndent:()=>{t=t.slice(4)},finish:()=>(e(""),r)}}function Ee(e){if(!e)return null;e=e.trim();var t=/^\((.*)\)/.exec(e);return t&&(e=t[1]),/^-?(\d+|0[xX][0-9a-fA-F]+)$/.test(e)?parseInt(e):null}e.nsWriter=Te,e.parseCppInt=Ee;let we={};class xe extends Error{constructor(e){super(e),this.isUserError=!0,this.message=e}}function l(t){if(!t)return"";let i="";for(let e=0;e<t.length;++e){var r=255&t[e];i+=37==r||127<r?"%"+r.toString(16):String.fromCharCode(r)}return decodeURIComponent(i)}function c(e){let t="",i=0;for(;i<e.length;i+=2)t=e[i]+e[i+1]+t;return Ae.Util.assert(i==e.length),t}function a(i){var r=[65,20,14,47,184,47,162,187];e:for(let t=0;t<i.length;t+=16)if(i[t]==r[0]){for(let e=0;e<r.length;++e)if(i[t+e]!=r[e])continue e;var e,n=i[t+8]|i[t+9]<<8,a=i[t+10]|i[t+11]<<8|i[t+12]<<16|i[t+13]<<24,a=(t+=16)+n+a;if(!(i.length<a))return e=i.slice(t,t+n),n=i.slice(t+n,a),{meta:l(e),text:n}}return null}function s(e){if(e){let i=0,r=0,n=0,a,s=0;if(e.split(/\r?\n/).forEach(e=>{var t=/^:10....0[0E]41140E2FB82FA2BB(....)(....)(....)(....)(..)/.exec(e);if(t)i=parseInt(c(t[1]),16),r=parseInt(c(t[2]),16),n=i+r,a=new Uint8Array(n);else if(0<n&&(t=/^:10....0[0E](.*)(..)$/.exec(e))){let e=t[1];for(;0<n&&0<e.length;)a[s++]=parseInt(e[0]+e[1],16),e=e.slice(2),n--}}),a&&0==n&&s==a.length){var t=new Uint8Array(i),o=new Uint8Array(r);for(let e=0;e<i;++e)t[e]=a[e];for(let e=0;e<r;++e)o[e]=a[i+e];return{meta:l(t),text:o}}}}function t(e){function t(e){return Ae.debug(e),Promise.reject(new Error(e))}let i;var r;if(Ae.HF2.read32(e,0)==ts.pxtc.UF2.UF2_MAGIC_START0&&(r=ts.pxtc.UF2.toBin(e))&&(i=a(r.buf)),1179403647==Ae.HF2.read32(e,0)&&(i=a(e)),58==e[0]&&(r=l(e),i=s(r||"")),!i||!i.meta||!i.text)return t("This .hex file doesn't contain source.");let n=JSON.parse(i.meta);return n?"LZMA"==n.compression?Ae.lzmaDecompressAsync(i.text).then(e=>{var t;return e?(t=e.slice(0,n.headerSize||n.metaSize||0),e=e.slice(t.length),t&&Ae.Util.jsonCopyFrom(n,JSON.parse(t)),{meta:n,source:e}):null}):n.compression?t(`Compression type ${n.compression} not supported.`):Promise.resolve({source:l(i.text)}):t("This .hex file is not valid.")}e.PkgConflictError=xe,e.getExtensionInfo=function(M){var R={__appVariant:Ae.appTargetVariant||""},j="dal.d.ts";let i="/source/",e="";var t,F=[];for(t of M.sortedDeps(!0).sort((e,t)=>"this"==e.id?1:"this"==t.id?-1:ke.strcmp(e.id,t.id)))t.disablesVariant(Ae.appTargetVariant)||t.resolvedDependencies().some(e=>e.disablesVariant(Ae.appTargetVariant))?(e&&(e+=", "),e+=t.id,Ae.debug(`disable variant ${Ae.appTargetVariant} due to `+t.id)):(F.push(t),t.addSnapshot(R,[j,".h",".cpp"]));var B=JSON.stringify(R),r=we[B];if(r)return Ae.debug("Using cached extinfo"),(r=ke.flatClone(r)).disabledDeps=e,r;Ae.debug("Generating new extinfo");let m=pxtc.emptyExtInfo(),n=(m.disabledDeps=e,Ae.appTarget.compileService),a=(n=n||{gittag:"none",serviceId:"nocompile"},n=ke.clone(n),M.getTargetOptions()),$=(a=a||{isNative:!1,hasHex:!1,switches:{}},r=!!n.platformioIni,"codal"==n.buildEngine||"dockercodal"==n.buildEngine);var s,H,o,l,c="dockermake"==n.buildEngine||"dockercross"==n.buildEngine,u="dockerespidf"==n.buildEngine;let g=!(r||$||c||u),G=a.nativeType==pxtc.NATIVE_TYPE_VM,z=(r?i="/src/":$||c?i="/pxtapp/":u&&(i="/main/"),"// Configuration defines\n"),v="\nPXT_SHIMS_BEGIN\n",b="",q="",V=`#include "pxt.h"
`,J="",y=e=>J+=`   ${K}(${W}): ${e}
`,W=0,K="",w=Te("namespace"),A=Te("declare namespace"),k=Te("declare namespace"),Y="",X={},Q={},Z={true:"1",false:"0",null:"0",NULL:"0"};function T(e){return e.trim().replace(/[\_\*]$/,"")}for(s of F){0<=s.getFiles().indexOf(j)&&(H=s.host().readFile(s,j),Ae.Util.assert(!!H,j+" not found in "+s.id),H.split(/\r?\n/).forEach(e=>{e=/^\s*(\w+) = (.*),/.exec(e);e&&(Z[e[1]]=e[2])}));for(o of s.getFiles())(0<=["Makefile","sdkconfig.defaults","CMakeLists.txt"].indexOf(o)||ke.endsWith(o,".mk"))&&(m.generatedFiles["/"+o]=s.host().readFile(s,o))}let ee=["0","false","PXT_UTF8"],E={};function te(e){return e.replace(/\/\/.*/,"").replace(/\/\*/,"")}a.switches.boxDebug&&(E.PXT_BOX_DEBUG=1),a.utf8&&(E.PXT_UTF8=1),a.switches.profile&&(E.PXT_PROFILE=1),a.switches.gcDebug&&(E.PXT_GC_DEBUG=1),a.switches.numFloat&&(E.PXT_USE_FLOAT=1),a.nativeType==pxtc.NATIVE_TYPE_VM&&(E.PXT_VM=1);let x=0,C=!1,I="",S="",U="",ie=!1;function re(){A.setNs(""),A.write(""),A.write(""),(U||S)&&(A.write(S),A.write(U),U="",S="")}function ne(e,u){I="",S="",U="",ie=!1;let d,t=-1;function h(){var e=I.replace(/Methods$/,"");return e==I?null:e}function p(e){switch(e.replace(/\s+/g,"")){case"void":return"void";case"int32_t":case"int":return"int32";case"uint32_t":case"unsigned":return"uint32";case"TNumber":case"float":case"double":return"number";case"uint16_t":return"uint16";case"int16_t":case"short":return"int16";case"uint8_t":case"byte":return"uint8";case"int8_t":case"sbyte":return"int8";case"bool":return a.shortPointers&&y("use 'boolean' not 'bool' on 8 bit targets"),"boolean";case"StringData*":case"String":case"ImageLiteral_":case"ImageLiteral":return"string";case"Action":return"() => void";case"TValue":return"any";default:return T(e)}}function f(e){switch(e=e.replace(/\s+/g,"")){case"int32_t":case"uint32_t":case"unsigned":case"uint16_t":case"int16_t":case"short":case"uint8_t":case"byte":case"int8_t":case"sbyte":case"int":case"ramint_t":return"I";case"void":return"V";case"float":return"F";case"TNumber":return"N";case"TValue":return"T";case"bool":return"B";case"double":return"D";case"ImageLiteral_":return"T";case"String":return"S";default:return ke.lookup(X,e)?"I":"_"+e.replace(/[\*_]+$/,"")}}e=e.replace(/^(\s*#\s*if\s+(\w+)\s*$)([^]*?)(^\s*#\s*(elif|else|endif)\s*$)/gm,(e,t,i,r,n)=>0<=ee.indexOf(i)&&!E[i]?t+r.replace(/[^\n]/g,"")+n:e),W=0,C=!1,x=0,k.setNs(""),A.setNs(""),e.split(/\r?\n/).forEach(e=>{++W;var n=te(e),a=e,s=te(a);if(C&&0<=s.indexOf("}")&&(C=!1,k.write("}")),C){var i=/^\s*(\w+)\s*(=\s*(.*?))?,?\s*$/.exec(s);if(i){var r=i[1];let e=i[3],t="";e?(e=e.trim(),null!=(i=ke.lookup(Z,e))&&(t="  // "+e,e=i),null==(x=Ee(e))&&y("cannot determine value of "+s)):(x++,e=x+""),k.write(`    ${T(r)} = ${e},`+t)}else k.write(a)}i=/^\s*enum\s+(|class\s+|struct\s+)(\w+)\s*({|$)/.exec(n);if(i&&(s=i[2],r=i[3],C=!0,x=-1,k.write(""),k.write(""),(U||S)&&(k.write(S),k.write(U),U="",S=""),k.write(`declare const enum ${T(s)} `+r),X[s]=!0,u||(w.setNs(I),w.write(`enum ${i[2]} : int;`))),a=e,!C&&!(/^\s*\/\*\*/.test(a)?(ie=!0,S=a+"\n",/\*\//.test(a)&&(ie=!1),1):ie?(S+=a+"\n",/\*\//.test(a)&&(ie=!1),1):/^\s*\/\/%/.test(a)&&(U+=a+"\n",1)))if(/^typedef.*;\s*$/.test(e)&&(w.setNs(I),w.write(e)),n=/^\s*namespace\s+(\w+)/.exec(e))I=n[1],h()?(re(),s=h(),A.setNs(I,`declare interface ${s} {`)):(U||S)&&(re(),A.setNs(T(I)),k.setNs(T(I)));else if((n=/^PXT_ABI\((\w+)\)/.exec(e))&&!G&&(v+=`PXT_FNPTR(::${n[1]}),
`,q+=`extern "C" void ${n[1]}();
`,m.functions.push({name:n[1],argsFmt:[],value:0})),(n=/^\s*PXT_EXPORT\(([:\&\w]+)\)/.exec(e))&&(m.vmPointers||(m.vmPointers=[]),m.vmPointers.push(n[1])),(n=/^#define\s+PXT_COMM_BASE\s+([0-9a-fx]+)/.exec(e))&&(m.commBase=parseInt(n[1])),n=/^\s*(\w+)([\*\&]*\s+[\*\&]*)(\w+)\s*\(([^\(\)]*)\)\s*(;\s*$|\{|$)/.exec(e),U&&n){d=null;let t=pxtc.parseCommentString(U);I||y("missing namespace declaration");a=(n[1]+n[2]).replace(/\s+/g,"");let e=n[3];s=n[4];U=U.trim().replace(/ \w+\.defl=\w+/g,"");let i=[f(a)],r=[];var o=s.split(/,/).filter(e=>!!e).map(e=>{e=((e,t)=>{t=t.trim();let i=/(.*)=\s*(-?\w+)$/.exec(t),r="",n="";var a;return i&&(r=i[2],n="?",t=i[1].trim()),(i=/^(.*?)(\w+)$/.exec(t))?(a=i[2],e.paramDefl[a]&&(r=e.paramDefl[a],n="?"),e=r?ke.lookup(Z,r):null,(r=null!=e?e:r)&&(null==Ee(r)&&y("Invalid default value (non-integer): "+r),U+=` ${a}.defl=`+r),{name:a+n,type:i[1]}):(y("invalid argument: "+t),{name:"???",type:"int"})})(t,e);return i.push(f(e.type)),r.push(e.type.replace(/ /g,"")),e.name+": "+p(e.type)}),l={name:I+"::"+e,argsFmt:i,value:null};S&&(A.setNs(T(I)),A.write(""),A.write(S),/ImageLiteral/.test(n[4])&&!/imageLiteral=/.test(U)&&(U+=" imageLiteral=1"),U+=" shim="+l.name,A.write(U),e=T(e),h()?((c=(o[0]||"").replace(/^.*:\s*/,"").trim()).toLowerCase()!=h().toLowerCase()&&y(be("Invalid first argument; should be of type '{0}', but is '{1}'",h(),c)),o.shift(),0==o.length&&/\bproperty\b/.test(U)?A.write(`${e}: ${p(a)};`):A.write(`${e}(${o.join(", ")}): ${p(a)};`)):A.write(`function ${e}(${o.join(", ")}): ${p(a)};`)),S="",U="",u||(w.setNs(I),w.write(`${a} ${e}(${s});`)),m.functions.push(l),void(g?v+="(uint32_t)(void*)::"+l.name+",\n":G?(ke.startsWith(l.name,"pxt::op_")||ye[l.name]||t.expose||!ke.startsWith(l.name,"pxt::")&&!ke.startsWith(l.name,"pxtrt::"))&&(c=((a,s)=>{if("FiberContext*"==s[0])return"::"+a.name;var e="_wrp_"+a.name.replace(/:/g,"_");if(!Q[a.name]){Q[a.name]=!0,b+=`
void ${e}(FiberContext *ctx) {
`;var o=s.length,l=[];let r=!1,n="";for(let i=0;i<o;++i){var c=a.argsFmt[i+1],u=s[i];let e="I"==c?"toInt":"B"==c?"numops::toBool":"";c=i==o-1?"ctx->r0":`ctx->sp[${o-i-2}]`;let t="";switch(u){case"TValue":case"TNumber":break;case"Action":e="asRefAction";break;case"String":e="convertToString",t="ctx, ",r=!0;break;default:e=e||"as"+u.replace(/\*/g,"")}n+=`  ${u} a${i} = (${u}) ${e}(${t}${c});
`,l.push("a"+i)}r&&(b+="  auto prevSP = ctx->sp;\n"),b+=n,r&&(b+="  if (panicCode) { ctx->sp = prevSP; return; }\n");var t=`::${a.name}(${l.join(", ")})`;"V"==a.argsFmt[0]?b=b+`  ${t};
`+`  ctx->r0 = NULL;
`:"I"==a.argsFmt[0]?b+=`  ctx->r0 = fromInt(${t});
`:"B"==a.argsFmt[0]?b+=`  ctx->r0 = fromBool(${t});
`:b+=`  ctx->r0 = (TValue)${t};
`,r&&(b+="  ctx->sp = prevSP;\n"),1<o&&(b+=`  ctx->sp += ${o-1};
`),b+=`}
`}return e})(l,r),o=l.argsFmt.length-1,v+=`{ "${l.name}", (OpFun)(void*)${c}, ${o} },
`):v+="PXT_FNPTR(::"+l.name+"),\n")}else{n=/^\s*extern const (\w+) (\w+);/.exec(e);if(U&&n)a={name:I+"::"+n[2],argsFmt:[],value:null},m.functions.push(a),G||(v+="PXT_FNPTR(&::"+a.name+"),\n"),U="";else{if(n=/^\s*(\w+)\s+(\w+)\s*;/.exec(e),U&&n){var s=pxtc.parseCommentString(U),c=(s.indexedInstanceNS&&(d=s,A.setNs(s.indexedInstanceNS),t=0),n[1]),o=n[2];if(d)return U=U.trim(),U+=` fixedInstance shim=${d.indexedInstanceShim}(${t++})`,A.write(""),A.write(S),A.write(U),A.write(`const ${o}: ${p(c)};`),S="",void(U="")}U&&e.trim()&&(y("declaration not understood: "+e),U="",S="")}}})}let ae=ke.clone(n.yottaConfig||{}),d={},se={},oe={};if(g&&a.hasHex&&(L=n,ke.assert(!!L.yottaCorePackage),ke.assert(!!L.githubCorePackage),ke.assert(!!L.gittag),D=L.githubCorePackage+"#"+n.gittag,m.yotta.dependencies[L.yottaCorePackage]=D),M){let e=!1;for(var h of F){J="",he=fe=pe=O=_=de=ue=le=ce=N=f=p=void 0;var p=h,f=((f=p.config.platformio)&&f.dependencies&&ke.jsonCopyFrom(m.platformio.dependencies,f.dependencies),m.npmDependencies&&p.config.npmDependencies&&ke.jsonCopyFrom(m.npmDependencies,p.config.npmDependencies),p.config.codal);if($&&f)for(var le of f.libraries||[]){var N=Ae.github.parseRepoId(le),le=(N||ke.userError(be("codal library {0} doesn't look like github repo",le)),Ae.github.stringifyRepo(N)),ce=ke.lookup(oe,N.project);ce?Ae.github.stringifyRepo(ce)!=le&&ke.userError(be("conflict between codal libraries: {0} and {1}",Ae.github.stringifyRepo(ce),le)):oe[N.project]=N}if(f=p.config.yotta){if(f.dependencies&&ke.jsonCopyFrom(m.yotta.dependencies,f.dependencies),f.config){var O,ue=ke.jsonFlatten(f.config);for(O of Object.keys(ue)){var de=ke.lookup(se,O),_=ue[O];if(!de||de.config.yotta.configIsJustDefaults)se[O]=p,ae[O]=_;else if(ae[O]!==_)if(!p.parent.config.yotta||!p.parent.config.yotta.ignoreConflicts)throw(_=new xe(be("conflict on yotta setting {0} between extensions {1} and {2}",O,p.id,de.id))).pkg0=de,_.pkg1=p,_.settingName=O,_}}if(f.optionalConfig){var he,pe=ke.jsonFlatten(f.optionalConfig);for(he of Object.keys(pe)){var fe=pe[he];d[he]=fe}}}h==M?(e=!0,A.clear(),k.clear()):ke.assert(!e);let t=e=>ke.endsWith(e,".h");for(l of h.getFiles().filter(t).concat(h.getFiles().filter(e=>!t(e)))){var P=t(l);if(P||ke.endsWith(l,".cpp")){let e=h.config.name+"/"+l;("base"==h.config.name||/^core($|---)/.test(h.config.name))&&P&&(e=l),P&&(V+=`#include "${g?i.slice(1):""}${e}"
`);var me=h.readFile(l);null==me&&ke.userError(be("C++ file {0} is missing in extension {1}.",l,h.config.name)),K=e,ne(me,P),m.extensionFiles[i+e]=me,0==h.level&&(m.onlyPublic=!1),h.verProtocol()&&"pub"!=h.verProtocol()&&"embed"!=h.verProtocol()&&(m.onlyPublic=!1)}(ke.endsWith(l,".c")||ke.endsWith(l,".S")||ke.endsWith(l,".s"))&&(P=h.readFile(l),m.extensionFiles[i+h.config.name+"/"+l.replace(/\.S$/,".s")]=P)}J&&(Y+=be("Extension {0}:\n",h.id)+J)}e||(A.clear(),k.clear())}function ge(t){return Object.keys(m.extensionFiles).concat(Object.keys(m.generatedFiles)).filter(e=>ke.endsWith(e,t)).map(e=>e.slice(1))}Y&&ke.userError(Y),ke.jsonCopyFrom(d,ae),ke.iterMap(d,(e,t)=>{null===t&&delete d[e]}),Object.keys(d).filter(e=>/-/.test(e)).forEach(e=>{var t=d[e];delete d[e],d[e.replace(/-/g,"_")]=t}),!g&&n.yottaConfigCompatibility&&Object.keys(d).forEach(e=>d["YOTTA_CFG_"+e]=d[e]),d.PXT_TARGET=JSON.stringify(Ae.appTarget.id);var ve,L=ke.jsonUnFlatten(d);if(c){var D={name:"pxt-app",private:!0,dependencies:m.npmDependencies};m.generatedFiles["/package.json"]=JSON.stringify(D,null,4)+"\n"}else if(u){c=ke.concatArrayLike([ge(".c"),ge(".cpp"),ge(".s")]).map(e=>e.slice(i.length-1)).concat(["main.cpp"]);c.push("pointers.cpp"),m.generatedFiles[i+"CMakeLists.txt"]=`idf_component_register(
  SRCS
`+c.map(e=>`    "${e}"
`).join("")+`  INCLUDE_DIRS
    "."
)
`}else if($){D=n;let i=ke.clone(D.codalDefinitions)||{},e=D.codalTarget;"string"==typeof e&&(e+=".json");u={target:e,definitions:i,config:i,application:"pxtapp",output_folder:"build",pxt_gitrepo:D.githubCorePackage,pxt_gittag:D.gittag,libraries:ke.values(oe).map(e=>({name:e.project,url:"https://github.com/"+e.fullName,branch:e.tag||"master",type:"git"}))};0==u.libraries.length&&delete u.libraries,ke.iterMap(ke.jsonFlatten(L),(e,t)=>{e=e.replace(/^codal\./,"device.").toUpperCase().replace(/\./g,"_"),i[e]=t}),m.generatedFiles["/codal.json"]=JSON.stringify(u,null,4)+"\n",Ae.debug("codal.json: "+m.generatedFiles["/codal.json"]),m.codal=u}else if(r){let i=n.platformioIni.slice();i.push("lib_deps ="),ke.iterMap(m.platformio.dependencies,(e,t)=>{e=/[@#\/]/.test(t)?t:e+"@"+t;i.push("  "+e)}),m.generatedFiles["/platformio.ini"]=i.join("\n")+"\n"}else{m.yotta.config=L;let e="pxt-app";c={name:e=n.yottaBinary?n.yottaBinary.replace(/-combined/,"").replace(/\.hex$/,""):e,version:"0.0.0",description:"Auto-generated. Do not edit.",license:"n/a",dependencies:m.yotta.dependencies,targetDependencies:{},bin:"./source"};m.generatedFiles["/module.json"]=JSON.stringify(c,null,4)+"\n",Ae.debug("module.json: "+m.generatedFiles["/module.json"])}for(ve of Object.keys(E))z+=`#define ${ve} ${E[ve]}
`;if(a.uf2Family&&(z+=`#define PXT_UF2_FAMILY ${a.uf2Family}
`),m.generatedFiles[i+"pointers.cpp"]=V+w.finish()+q+b+v+"\nPXT_SHIMS_END\n",m.generatedFiles[i+"pxtconfig.h"]=z,Ae.debug("pxtconfig.h: "+m.generatedFiles[i+"pxtconfig.h"]),g&&(m.generatedFiles["/config.json"]=JSON.stringify(L,null,4)+"\n",Ae.debug("yotta config.json: "+m.generatedFiles["/config.json"])),m.generatedFiles[i+"main.cpp"]=`
#include "pxt.h"
#ifdef PXT_MAIN
PXT_MAIN
#else
int main() {
    uBit.init();
    pxt::start();
    release_fiber();
    return 0;   // your program will never reach this line.
}
#endif
`,m.generatedFiles["/Makefile"]){let i="";D=(e,t)=>{i+=`${e} = ${ge(t).join(" ")}\n`};D("PXT_C",".c"),D("PXT_CPP",".cpp"),D("PXT_S",".s"),D("PXT_HEADERS",".h"),i=i+"PXT_SOURCES := $(PXT_C) $(PXT_S) $(PXT_CPP)\n"+"PXT_OBJS := $(addprefix bld/, $(PXT_C:.c=.o) $(PXT_S:.s=.o) $(PXT_CPP:.cpp=.o))\n",m.generatedFiles["/Makefile.inc"]=i}return m.generatedFiles["/functions.json"]=JSON.stringify(m.functions,null,1),u=m.extensionFiles,ke.jsonCopyFrom(u,m.generatedFiles),r={config:n.serviceId,tag:n.gittag,replaceFiles:u,dependencies:g?m.yotta.dependencies:null},c=JSON.stringify(r),m.sha=ke.sha256(c),m.skipCloudBuild=!!n.skipCloudBuild,m.compileData=ts.pxtc.encodeBase64(ke.toUTF8(c)),m.shimsDTS=A.finish(),m.enumsDTS=k.finish(),(we=10<Object.keys(we).length?{}:we)[B]=m},e.unpackSourceFromHexFileAsync=function(e){if(e)return Ae.Util.fileReadAsBufferAsync(e).then(e=>t(new Uint8Array(e)))},e.unpackSourceFromHexAsync=t}})(pxt=pxt||{}),(u=>{{var r=u.hexloader||(u.hexloader={});let t={},i,a={};function s(e){return t.hasOwnProperty(e.sha)||(t[e.sha]=(t=>{let c="";return r.showLoading(u.U.lf("Compiling (this may take a minute)...")),u.tickEvent("cppcompile.start"),(e=>e.skipCloudBuild?Promise.resolve({hex:["SKIP"]}):u.webConfig&&u.webConfig.isStatic?u.Util.requestAsync({url:`${u.webConfig.cdnUrl}hexcache/${e.sha}.hex`}).then(e=>e.text?(e={enums:[],functions:[],hex:e.text.split(/\r?\n/)},Promise.resolve(e)):(u.log("Hex info not found in bundled hex cache"),Promise.resolve())).catch(e=>(u.log("Error fetching hex info from bundled hex cache"),Promise.resolve())):u.Cloud.localToken&&window&&u.BrowserUtils.isLocalHost()?((e,t)=>u.Cloud.localRequestAsync(e,t).then(e=>e.json))("compile/"+e.sha).then(e=>e&&!e.notInOfflineCache&&e.hex?(e.hex=e.hex.split(/\r?\n/),e):Promise.resolve(void 0)).catch(e=>Promise.resolve(void 0)):Promise.resolve(void 0))(t).then(e=>e?(u.tickEvent("cppcompile.cachehit"),e):(()=>{var e;return i||(e=u.getOnlineCdnUrl(),i=e?Promise.resolve(e):(e=u.webConfig&&u.webConfig.isStatic,u.Cloud.privateGetAsync("clientconfig",e).then(e=>e.primaryCdnUrl)))})().then(e=>(c=e+"/compile/"+t.sha,u.U.httpGetTextAsync(c+".hex"))).then(e=>e,e=>u.Cloud.privatePostAsync("compile/extension",{data:t.compileData},!0).then(l=>new Promise((i,e)=>{let r=0,n=8e3,a=3e5,s=u.U.now(),o=()=>{if(r++,u.U.now()-s>a)return u.log("abandoning C++ build"),u.tickEvent("cppcompile.cancel",{retry:r}),i(null),null;let t=l.hex.replace(/\.hex/,".json");return u.log(`polling C++ build ${t} (attempt #${r})`),u.tickEvent("cppcompile.poll",{retry:r}),u.Util.httpGetJsonAsync(t).then(e=>{u.log("build log "+t.replace(/\.json$/,".log")),u.tickEvent("cppcompile.done",{success:null!=e&&e.success?1:0,retry:r,duration:u.U.now()-s}),e.success?(u.log("fetching "+c+".hex"),i(u.U.httpGetTextAsync(c+".hex"))):(u.log("build failed"),e.mbedresponse&&e.mbedresponse.result&&e.mbedresponse.result.exception&&u.log(e.mbedresponse.result.exception),i(null))},e=>(u.log(`waiting ${n/1e3|0}s for C++ build...`),setTimeout(o,n),null))};o()}))).then(e=>(r.hideLoading(),{hex:e&&e.split(/\r?\n/)}))).finally(()=>{r.hideLoading()})})(e)),t[e.sha]}function o(i,r,n,e,a=10){return i.cacheStoreAsync(n,e).then(()=>i.cacheGetAsync(r)).then(e=>{let t;try{t=JSON.parse(e||"[]")}catch(e){u.error("invalid cache entry, clearing entry"),t=[]}(t=t.filter(e=>e!=n)).unshift(n);e=t.slice(a);return t=t.slice(0,a),u.U.promiseMapAll(e,e=>i.cacheStoreAsync(e,"[]")).then(()=>i.cacheStoreAsync(r,JSON.stringify(t)))})}function l(i,r,n){return i.cacheGetAsync(r).then(e=>{let t;try{t=JSON.parse(e||"[]")}catch(e){return u.error("invalid cache entry, clearing entry"),i.cacheStoreAsync(r,"[]")}return t[0]!=n?((t=t.filter(e=>e!=n)).unshift(n),i.cacheStoreAsync(r,JSON.stringify(t))):null})}r.showLoading=e=>{},r.hideLoading=()=>{},r.storeWithLimitAsync=o,r.recordGetAsync=l,r.getHexInfoAsync=function(r,i,e){if(!i.sha)return Promise.resolve(null);var t=a[i.sha];if(t)return Promise.resolve(t);u.debug("get hex info: "+i.sha);let n="hex-"+i.sha;return r.cacheGetAsync(n).then(e=>{let t;try{t=e?JSON.parse(e):null}catch(e){u.log("invalid cache entry, clearing entry"),t=null}return t&&t.hex?(u.debug("cache hit, size="+e.length),t.hex=(i=>{var a=[];for(let t=0;t<i.length;t++){var r=/^([@!])(....)$/.exec(i[t]);if(r){let e=parseInt(r[2],16);var s=i[++t];let n="";if("@"==r[1]){n="";let e=parseInt(s,16);for(;0<e--;)n+="\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}else n=ts.pxtc.decodeBase64(s);u.Util.assert(0<n.length),u.Util.assert(n.length%16==0);for(let r=0;r<n.length;){var o=[16,e>>8&255,255&e,0];e+=16;for(let e=0;e<16;++e)o.push(n.charCodeAt(r++));let t=0;for(let e=0;e<o.length;++e)t+=o[e];o.push(255&-t);let i=":";for(let e=0;e<o.length;++e){var l=255&o[e];l<=15&&(i+="0"),i+=l.toString(16)}a.push(i.toUpperCase())}}else a.push(i[t])}return a})(t.hex),l(r,"hex-keys",n).then(()=>t)):s(i).then(e=>{var t=e.hex,i=(e.hex=(n=>{let a=[],s=0;for(let r=0;r<n.length;r+=s){let e=-1,i="",t=(s=0,!1);for(;s<500;){var o=/^:10(....)00(.{32})(..)$/.exec(n[r+s]);if(!o)break;var l=o[2],c=/^0+$/.test(l),u=parseInt(o[1],16);if(-1==e)t=c,a.push((t?"@":"!")+o[1]),e=u-16;else{if(c!=t)break;if(e+16!=u)break}t||(i+=l),e=u,s++}if(0==s)a.push(n[r]),s=1;else if(t)a.push(s.toString(16));else{let t="";for(let e=0;e<i.length;e+=2)t+=String.fromCharCode(parseInt(i.slice(e,e+2),16));a.push(ts.pxtc.encodeBase64(t))}}return a})(e.hex),JSON.stringify(e));return e.hex=t,o(r,"hex-keys",n,i).then(()=>e)}).catch(e=>(u.reportException(e,{sha:i.sha}),Promise.resolve(null)))}).then(e=>(e&&((a=20<Object.keys(a).length?{}:a)[i.sha]=e),e))}}})(pxt=pxt||{}),(a=>{var e;(e=a.crowdin||(a.crowdin={})).KEY_VARIABLE="CROWDIN_KEY",e.testMode=!1,e.setTestMode=function(){a.crowdin.testMode=!0,a.log("CROWDIN TEST MODE - files will NOT be uploaded")},e.inContextLoadAsync=function(r){let n=document.createElement("input");n.type="text",n.setAttribute("class","hidden"),n.value=r;var e=new Promise((t,e)=>{let i=new MutationObserver(()=>{var e;r!=n.value&&(e=a.Util.rlf(n.value),n.remove(),i.disconnect(),t(e))});i.observe(n,{attributes:!0})});return document.body.appendChild(n),e}})(pxt=pxt||{}),(f=>{var e;{var t=f.diff||(f.diff={});function A(i,e){if(!i)return[];if(e){var r=[];let t=0;for(let e=0;e<i.length;e++)"\n"===i.charAt(e)&&(r.push(i.substring(t,e+1)),t=e+1);return r.push(i.substring(t)),r}return i.split(/\r?\n/)}t.toLines=A;let w;function m(e,t,n={}){n.ignoreWhitespace&&(e=e.replace(/[\r\n]+$/,""),t=t.replace(/[\r\n]+$/,""));var a=A(e,!0),s=A(t,!0);let o=Math.min(n.maxDiffSize||1024,a.length+s.length);if(0==o)return[];let l=65520<a.length?Uint32Array:Uint16Array,c={},u=0,d=i(a),h=i(s);function i(e){var t,i=new l(e.length);let r=0;for(t of e)n.ignoreWhitespace&&(t=t.replace(/\s+$/g,"").replace(/^\s+/g,"")),c.hasOwnProperty(t)?i[r]=c[t]:(++u,i[r]=u,c[t]=u),r++;return i}let r=new l(2*o+1),p=-1;for(let e=0;e<=o;e++)null!=y(e,r)&&(p=e);if(-1==p)return null;var f=[];let m=null;for(let t=0;t<=p;t++){let e=f.length?f[f.length-1].slice(0):new l(2*p+1);if(f.push(e),null!=(m=y(t,e)))break}var g=[];let v=m;for(let r=f.length-1;0<=r;r--){let t=f[r],i=0,e=0;var b=(i=v==-r||v!=r&&t[o+v-1]<t[o+v+1]?(e=v+1,t[o+e]):(e=v-1,t[o+e]+1))-v;for(let e=t[o+v]-i-1;0<=e;--e)g.push([w.Unchanged,s[b+e]]);e==v-1?g.push([w.Deleted,a[i-1]]):0<b&&g.push([w.Added,s[b-1]]),v=e}return g.reverse(),g;function y(r,n){for(let i=-r;i<=r;i+=2){let e=0,t=(e=i==-r||i!=r&&n[o+i-1]<n[o+i+1]?n[o+i+1]:n[o+i-1]+1)-i;for(;e<d.length&&t<h.length&&d[e]==h[t];)e++,t++;if((n[o+i]=e)>=d.length&&t>=h.length)return i}return null}}function g(e,t,i={}){var r=m(e,t,i);if(i.context==1/0||i.full)return r.map(h);let n=1,a=1,s=0;for(var o=[],l=i.context||3;s<r.length;){let e=s;for(;e<r.length&&r[e][0]===w.Unchanged;)e++;if(e==r.length)break;var c=e-l,u=c-s,u=(0<u&&(n+=u,a+=u,s=c),o.length),c=n,d=a;o.push("@@");let t=s,i=0;for(;t<r.length;){if(r[t][0]===w.Unchanged){if(++i>2*l+2){t-=l+2;break}}else i=0;t++}for(;s<t;){switch(o.push(h(r[s])),r[s][0]){case w.Deleted:n++;break;case w.Added:a++;break;case w.Unchanged:n++,a++}s++}o[u]=`@@ -${c},${n-c} +${d},${a-d} @@`}return o}function h([e,t]){let i;return(i=e===w.Added?"+ ":e===w.Deleted?"- ":"  ")+t.replace(/\r?\n/,"")}function a(e){return A(e).map(e=>e.replace(/;\s*$/,"")).join("\n")}function v(e){e=/^@@ -(\d+),(\d+) \+(\d+),(\d+)/.exec(e);return e&&{oldStart:parseInt(e[1])-1,oldLength:parseInt(e[2]),newStart:parseInt(e[3])-1,newLength:parseInt(e[4])}}(e=w=w||{})[e.Added=1]="Added",e[e.Deleted=-1]="Deleted",e[e.Unchanged=0]="Unchanged",t.compute=m,t.computeFormattedDiff=g,t.computePatch=function(e,t){var a=m(e,t,{full:!0,maxDiffSize:2048});if(a){var s=a;let e=[],t="",i="",r="",n=w.Unchanged;var o=()=>{e.push({start1:t.length,length1:r.length,diffs:[[w.Added,i]]}),t+=i,i="",r=""};for(let e=0;e<s.length;e++){var[l,c]=s[e];l==w.Unchanged?(n!==w.Unchanged&&o(),t+=c):l===w.Added?i+=c:l===w.Deleted&&(n===w.Added&&o(),r+=c),n=l}return n!==w.Unchanged&&o(),e}return[{start1:0,length1:e.length,diffs:[[w.Added,t]]}]},t.applyPatch=function(e,t){let i=e;for(var r of t){var n=r.diffs.filter(e=>e[0]!==w.Deleted).map(e=>e[1]).join("");i=i.substring(0,r.start1)+n+i.substring(r.start1+r.length1)}return i},t.diff3=function(e,t,i,o,l){var c=r(e),u=r(i);if(c&&u){var d=A(e),h=A(i);let n=0;var p=[];let a=0,s=0;for(let r=0;r<c.length-1;)if(c[r]==a&&u[r]==s)p.push(d[a]),a++,s++,r++;else{let e=!0,t=!0,i=r;for(;i<c.length&&(c[i]!=a+i-r&&(e=!1),u[i]!=s+i-r&&(t=!1),null==c[i]||null==u[i]);)i++;if(f.U.assert(i<c.length),e)for(;s<u[i];)p.push(h[s++]);else if(t)for(;a<c[i];)p.push(d[a++]);else if(d.slice(a,c[i]).join("\n")==h.slice(s,u[i]).join("\n"))for(;a<c[i];)p.push(d[a++]);else{for(n++,p.push("<<<<<<< "+o);a<c[i];)p.push(d[a++]);for(p.push("=======");s<u[i];)p.push(h[s++]);p.push(">>>>>>> "+l)}r=i,a=c[i],s=u[i]}return{merged:p.join("\n"),numConflicts:n};function r(i){i=m(t,i,{context:1/0});if(i){var r,n=[];let e=0,t=0;for(r of i)r[0]==w.Added?e++:r[0]==w.Deleted?(n[t]=null,t++):r[0]==w.Unchanged?(n[t]=e,e++,t++):f.U.oops();return n.push(e+1),n}}}},t.removeTrailingSemiColumns=a,t.split=function(e,t){var i=e.split(/-{10,}/,2);if(i.length<2)return{fileA:e,fileB:void 0};let r=i[0].replace(/\n$/,""),n=i[1].replace(/^\n/,"");return t&&t.removeTrailingSemiColumns&&(r=a(r),n=a(n)),{fileA:r,fileB:n}},t.parseDiffMarker=v,t.render=function(e,t,s={}){let o=g(e,t,s);if(!o)return f.dom.el("div",null,pxtc.Util.lf("Too many differences to render diff."));let l={"@":"diff-marker"," ":"diff-unchanged","+":"diff-added","-":"diff-removed"},c=0,u=0,d="",h=f.dom.el("tbody"),p=(e=f.dom.el("table",{class:"diffview "+(s.update?"update":"")},h),null);return o.forEach((e,t)=>{var i=v(e),i=(i?(c=i.oldStart,u=i.newStart):("+"!=e[0]&&c++,"-"!=e[0]&&u++),o[t+1]?o[t+1][0]:""),r=o[t+2]?o[t+2][0]:"",n=e.slice(2);let a=f.dom.el("code",null,n);p?(a=p,p=null):"-"!=e[0]||" "!=d&&"@"!=d||"+"!=i||" "!=r&&"@"!=r&&""!=r||(n=((e,t)=>{var i=g(e.split("").join("\n"),t.split("").join("\n"),{context:1/0});if(!i)return{a:f.dom.el("div",{class:"inline-diff"},f.dom.el("code",null,e)),b:f.dom.el("div",{class:"inline-diff"},f.dom.el("code",null,t))};var r=[],n=[];for(let t=0;t<i.length;){let e=t;for(var a=i[t][0];i[e]&&i[e][0]==a;)e++;var s=i.slice(t,e).map(e=>e.slice(2)).join("");" "==a?(r.push(f.dom.el("code",{class:"ch-common"},s)),n.push(f.dom.el("code",{class:"ch-common"},s))):"-"==a?r.push(f.dom.el("code",{class:"ch-removed"},s)):"+"==a?n.push(f.dom.el("code",{class:"ch-added"},s)):f.Util.oops(),t=e}return{a:f.dom.el("div",{class:"inline-diff"},r),b:f.dom.el("div",{class:"inline-diff"},n)}})(e.slice(2),o[t+1].slice(2)),a=n.a,p=n.b),d=e[0],s.hideMarkerLine&&"@"==d||s.hideRemoved&&"-"==d||(i="@"==d,r=""+l[d],h.appendChild(f.dom.el("tr",{class:r},[!s.hideLineNumbers&&f.dom.el("td",{class:"line-a","data-content":c}),!s.hideLineNumbers&&f.dom.el("td",{class:"line-b","data-content":u}),i&&f.dom.el("td",{colspan:2,class:"change"},f.dom.el("code",null,e)),!s.hideMarker&&!i&&f.dom.el("td",{class:"marker","data-content":d}),!i&&f.dom.el("td",{class:"change"},a)])))}),e},t.resolveMergeConflictMarker=function(e,t,i,r){var n=f.diff.toLines(e);let a=t;for(;a<n.length&&!/^<<<<<<<[^<]/.test(n[a]);)a++;let s=a+1;for(;s<n.length&&!/^=======$/.test(n[s]);)s++;let o=s+1;for(;o<n.length&&!/^>>>>>>>[^>]/.test(n[o]);)o++;if(o>=n.length)return f.debug(`diff marker mistmatch: ${n.length} -> ${a} ${s} `+o),e;if(n[a]=void 0,n[s]=void 0,n[o]=void 0,!i)for(let e=a;e<=s;++e)n[e]=void 0;if(!r)for(let e=s;e<=o;++e)n[e]=void 0;return n.filter(e=>void 0!==e).join("\n")},t.mergeDiff3Config=function(e,t,i){var r=f.Util.jsonTryParse(e);let n=f.Util.jsonTryParse(t);var a=f.Util.jsonTryParse(i);if(r&&!a)return e;if(!r)return i||t;if(!n&&a&&(n=a),r&&n&&a){delete r.installedVersion,delete n.installedVersion,delete a.installedVersion;var s,o,l={};for(s of f.U.unique(Object.keys(n).concat(Object.keys(r)).concat(Object.keys(a)),e=>e)){var c=r[s],u=n[s],d=a[s];if(JSON.stringify(c)==JSON.stringify(d))void 0!==c&&(l[s]=c);else switch(s){case"name":l[s]=(p=d,(o=c)==(h=u)||p!=h&&o==lf("Untitled")?p:o);break;case"version":l[s]=0<f.semver.strcmp(c,d)?c:d;break;case"languageRestriction":case"preferredEditor":case"targetVersion":l[s]=c;break;case"public":l[s]=c&&d;break;case"files":case"testFiles":var h=((e,t,i)=>{var r,n=[];for(r of f.U.unique(t.concat(e).concat(i),e=>e)){var a=-1<e.indexOf(r),s=-1<i.indexOf(r),o=-1<t.indexOf(r);a==s||s==o?a&&n.push(r):s&&n.push(r)}return n})(c||[],u||[],d||[]);if(!h)return;l[s]=h.length?h:void 0;break;case"dependencies":case"testDependencies":var p=((e,t,i)=>{var r,n={};for(r of f.U.unique(Object.keys(t).concat(Object.keys(e)).concat(Object.keys(i)),e=>e)){var a,s,o=e[r],l=i[r],c=t[r];o==l?o&&(n[r]=o):(a=f.github.parseRepoId(o),s=f.github.parseRepoId(l),a&&s&&f.semver.tryParse(a.tag)&&f.semver.tryParse(s.tag)&&a.owner&&a.project&&a.owner==s.owner&&a.project==s.project?(s=(0<f.semver.strcmp(a.tag,s.tag)?a:s).tag,n[r]=`github:${a.owner}/${a.project}#`+s):l==c?o&&(n[r]=o):l&&(n[r]=l))}return n})(c||{},u||{},d||{});if(Object.keys(p).length)return;l[s]=p;break;case"description":if(c&&!d)l[s]=c;else{if(c||!d)return;l[s]=d}break;default:return}}return f.Package.stringifyConfig(l)}},t.hasMergeConflictMarker=function(e){return e&&/^(<<<<<<<[^<]|>>>>>>>[^>])/m.test(e)},t.reconstructConfig=function(t,i,e,r){var n={};let a=e.tree.tree.map(e=>e.path).filter(e=>/\.(ts|blocks|md|jres|asm|json)$/.test(e)).filter(e=>e!=f.CONFIG_NAME);return(a=t.fileName?a.filter(e=>0===e.indexOf(t.fileName)).map(e=>e.slice(t.fileName.length+1)):a).find(e=>/\.ts$/.test(e))||(r.config.files.filter(e=>a.indexOf(e)<0).forEach(e=>{a.push(e),i[e]=r.files[e]}),f.Util.jsonCopyFrom(n,r.config.dependencies)),Object.keys(n).length||(n[f.appTarget.corepkg]="*"),{name:"",files:a,dependencies:n,preferredEditor:a.find(e=>/.blocks$/.test(e))?f.BLOCKS_PROJECT_NAME:f.JAVASCRIPT_PROJECT_NAME}}}})(pxt=pxt||{}),(r=>{var e;(e=r.discourse||(r.discourse={})).extractSharedIdFromPostUrl=function(e){return r.Util.httpGetJsonAsync(e+".json").then(e=>e.post_stream&&e.post_stream.posts&&e.post_stream.posts[0]&&e.post_stream.posts[0].link_counts.map(e=>r.Cloud.parseScriptId(e.url)).filter(e=>!!e)[0])},e.topicsByTag=function(i,e){return e=(i=i.replace(/\/$/,""))+`/tag/${e}.json`,r.Util.httpGetJsonAsync(e).then(e=>{let t=r.Util.toDictionary(e.users,e=>e.id.toString());return e.topic_list.topics.map(e=>({id:e.id,title:e.title,url:i+`/t/${e.slug}/`+e.id,imageUrl:e.image_url,author:t[e.posters[0].user_id].username,cardType:"forumUrl"}))})}})(pxt=pxt||{}),(p=>{{var x=p.docs||(p.docs={}),C=pxtc.Util;let y,A={},k={};var e="\x3c!-- @CMD@ @ARGS@ --\x3e";let T={parent:e,short:e,description:"\x3c!-- desc --\x3e",activities:"\x3c!-- activities --\x3e",explicitHints:"\x3c!-- hints --\x3e",flyoutOnly:"\x3c!-- flyout --\x3e",hideToolbox:"\x3c!-- hideToolbox --\x3e",hideIteration:"\x3c!-- iter --\x3e",codeStart:"\x3c!-- start --\x3e",codeStop:"\x3c!-- stop --\x3e",autoOpen:"\x3c!-- autoOpen --\x3e",autoexpandOff:"\x3c!-- autoexpandOff --\x3e",preferredEditor:"\x3c!-- preferredEditor --\x3e"};function t(e,t,i){return e.split(t).join(i)}function i(e){return e=t(e,"&","&amp;"),e=t(e,"<","&lt;"),e=t(e,">","&gt;"),e=t(e,'"',"&quot;"),e=t(e,"'","&#39;")}function I(e){return e&&i(e.replace(/\&([#a-z0-9A-Z]+);/g,(e,t)=>{switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:return"#"==t[0]?String.fromCharCode(parseInt(t.slice(1))):e}}))}x.htmlQuote=i,x.html2Quote=I;let w=[{rx:/^vimeo\.com\/(\d+)/i,cmd:"### @vimeo $1"},{rx:/^(www\.youtube\.com\/watch\?v=|youtu\.be\/)([\w\-]+(\#t=([0-9]+m[0-9]+s|[0-9]+m|[0-9]+s))?)/i,cmd:"### @youtube $2"}],E=(x.requireMarked=()=>"undefined"!=typeof marked?marked:"undefined"!=typeof require?require("marked"):void 0,x.requireDOMSanitizer=()=>"undefined"!=typeof DOMPurify?DOMPurify.sanitize:"undefined"!=typeof require?require("DOMPurify").sanitize:void 0,e=>`<div class='ui negative message'>${i(e)}</div>`);function S(n){let a=C.clone(A),s=C.clone(k),o=C.clone(T),l={},c={},i=n.params;var e=n.theme;n.boxes=a,n.macros=s,n.settings=o,n.html=n.html.replace(/<aside\s+([^<>]+)>([^]*?)<\/aside>/g,(e,t,i)=>{var t=(t=>{for(var i,r={};t.trim();){let e=/\s*([^=\s]+)=("([^"]*)"|'([^']*)'|(\S*))/.exec(t);e?(i=e[3]||e[4]||e[5]||"",r[e[1].toLowerCase()]=i):r[(e=/^\s*(\S+)/.exec(t))[1]]="true",t=t.slice(e[0].length)}return r})(t),r=t["data-name"]||t.id;return r?(/box/.test(t.class)?a[r]=i:/aside/.test(t.class)?a[r]=`<!-- BEGIN-ASIDE ${r} -->${i}<!-- END-ASIDE -->`:/setting/.test(t.class)?o[r]=i:/menu/.test(t.class)?l[r]=i:/toc/.test(t.class)?c[r]=i:s[r]=i,`<!-- macro ${r} -->`):E("id or data-name missing on macro")});let u=(e,t)=>{let i=l.item;var r={NAME:e.name};if(e.subitems)i=l["toc-dropdown"]||(0==t?l["top-dropdown"]:l["inner-dropdown"]),r.ITEMS=e.subitems.map(e=>u(e,t+1)).join("\n");else{if(/^-+$/.test(e.name)&&(i=l.divider),e.path&&!/^(https?:|\/)/.test(e.path))return E("Invalid link: "+e.path);r.LINK=e.path}return O(i,r,["ITEMS"])},d=[{name:lf("Docs"),href:"/docs"}];var r=n.TOC||e.TOC||[];let h=[],p=e=>{for(var t of e.subitems||[])if(p(t))return h.push(e),!0;return!(!n.filepath||!e.path||n.filepath!=e.path||(h.push(e),0))},f=(r.forEach(p),(e,t)=>{let i=c.item;var r={NAME:e.name};return e.path&&!/^(https?:|\/)/.test(e.path)?E("Invalid link: "+e.path):(/^\//.test(e.path)&&n.versionPath&&(e.path="/"+n.versionPath+e.path),r.LINK=e.path,0<=h.indexOf(e)?(r.ACTIVE="active",r.EXPANDED="true",d.push({name:e.name,href:e.path})):r.EXPANDED="false",e.subitems&&0<e.subitems.length?(i=c["toc-dropdown"]?""!==e.name?c["toc-dropdown"]:c["toc-dropdown-noLink"]:0==t?""!==e.name?c["top-dropdown"]:c["top-dropdown-noHeading"]:1==t?c["inner-dropdown"]:c["nested-dropdown"],r.ITEMS=e.subitems.map(e=>f(e,t+1)).join("\n")):/^-+$/.test(e.name)&&(i=c.divider),O(i,r,["ITEMS"]))}),t=(i.menu=(e.docMenu||[]).map(e=>u(e,0)).join("\n"),i.TOC=r.map(e=>f(e,0)).join("\n"),e.appStoreID&&(i.appstoremeta=`<meta name="apple-itunes-app" content="app-id=${C.htmlEscape(e.appStoreID)}"/>`),"");1<d.length&&(t=`
            <nav class="ui breadcrumb" aria-label="${lf("Breadcrumb")}">
                ${d.map((e,t)=>`<a class="${t==d.length-1?"active":""} section"
                        href="${I(e.href)}" aria-current="${t==d.length-1?"page":""}">${I(e.name)}</a>`).join('<i class="right chevron icon divider"></i>')}
            </nav>`),i.breadcrumb=t,e.boardName&&(i.boardname=I(e.boardName)),e.boardNickname&&(i.boardnickname=I(e.boardNickname)),e.driveDisplayName&&(i.drivename=I(e.driveDisplayName)),e.homeUrl&&(i.homeurl=I(e.homeUrl)),i.targetid=e.id||"???",i.targetname=e.name||"Microsoft MakeCode",i.docsheader=e.docsHeader||"Documentation",i.orgtitle="MakeCode";var r=e.docsLogo&&C.htmlEscape(e.docsLogo),m=(e.organizationWideLogo||e.organizationLogo)&&C.htmlEscape(e.organizationWideLogo||e.organizationLogo),g=e.organizationLogo&&C.htmlEscape(e.organizationLogo),r=(i.targetlogo=r?`<img aria-hidden="true" role="presentation" class="ui ${e.logoWide?"small":"mini"} image" src="${r}" />`:"",i.orglogo=m?`<img aria-hidden="true" role="presentation" class="ui image" src="${m}" />`:"",i.orglogomobile=g?`<img aria-hidden="true" role="presentation" class="ui image" src="${g}" />`:"",n.ghEditURLs||[]);if(r.length){let e=`<p style="margin-top:1em">
`,t=lf("Edit this page on GitHub");for(var v of r)e+=`<a href="${v}"><i class="write icon"></i>${t}</a><br>
`,t=lf("Edit template of this page on GitHub");e+=`</p>
`,i.github=e}else i.github="";var b,m=`
            <a href="#maincontent" class="ui item link" tabindex="0" role="menuitem">${lf("Skip to main content")}</a>
        `,g=(i.accMenu=m,lf("Print this page")),r=(i.printBtn=`
            <button id="printbtn" class="circular ui icon right floated button hideprint" title="${g}" aria-label="${g}">
                <i class="icon print"></i>
            </button>
        `,`
            <a id="togglesidebar" class="launch icon item" tabindex="0" title="Side menu" aria-label="${lf("Side menu")}" role="menuitem" aria-expanded="false">
                <i class="content icon"></i>
            </a>
        `),m=(i.sidebarToggle=r,["tocsearch1","tocsearch2"].map(e=>`
                <input type="search" name="q" placeholder="${lf("Search...")}" aria-label="${lf("Search Documentation")}">
                <i onclick="document.getElementById('${e}').submit();" tabindex="0" class="search link icon" aria-label="${lf("Search")}" role="button"></i>
            `));i.searchBar1=m[0],i.searchBar2=m[1];let y="";e.accentColor&&(y+=`
.ui.accent { color: ${e.accentColor}; }
.ui.inverted.accent { background: ${e.accentColor}; }
`),i.targetstyle=y,i.tocclass=e.lightToc?"lighttoc":"inverted";for(b of Object.keys(e)){var w=e[b];void 0===i[b]&&"string"==typeof w&&(i[b]=w)}n.finish=()=>O(n.html,i,["body","menu","accMenu","TOC","prev","next","printBtn","breadcrumb","targetlogo","orglogo","orglogomobile","github","JSON","appstoremeta","sidebarToggle","searchBar1","searchBar2"])}function U(e){e.image=function(r,t,i){if(r.startsWith("youtube:"))return'<div class="tutorial-video-embed"><iframe class="yt-embed" src="https://www.youtube.com/embed/'+r.split(":").pop()+'" title="'+i+'" frameborder="0" allowFullScreen allow="autoplay; picture-in-picture"></iframe></div>';if(r.startsWith("azuremedia:")){let e=r.split(":")[1];var n=e.split("?");let t,i;n[1]&&(e=n[0],n=n[1],t=null==(a=/start(?:time)?=(\d+)/i.exec(n))?void 0:a[1],i=null==(a=/end(?:time)?=(\d+)/i.exec(n))?void 0:a[1]);var n=new URL(`https://makecodeprodmediaeastus-usea.streaming.media.azure.net/${e}/manifest(format=mpd-time-csf).mpd`),a=(t&&(n.hash="t="+t,n.searchParams.append("startTime",t)),i&&n.searchParams.append("endTime",i),`<div class="tutorial-video-embed"><video class="ams-embed" controls src="${n.toString()}" /></div>`);return a}{let e='<img class="ui image" src="'+r+'" alt="'+i+'"';return t&&(e+=' title="'+t+'"'),e=(e+=' loading="lazy"')+(this.options.xhtml?"/>":">")}},e.listitem=function(e){var t=/^\s*\[( |x)\]/i.exec(e);return t?`<li class="${" "==t[1]?"unchecked":"checked"}">`+e.slice(t[0].length)+"</li>\n":"<li>"+e+"</li>\n"},e.heading=function(e,t,i){var r=/(.*)#([\w\-]+)\s*$/.exec(e);let n="";return r&&(e=r[1],n=r[2]),(e=e&&e.replace(/@(fullscreen|unplugged|showdialog|showhint)/gi,"")).match(/\{([\s\S]+)\}/)&&(e=e.match(/\{([\s\S]+)\}/)[1].trim()),""===n&&(n=e.toLowerCase().replace(/[^\w]+/g,"-")),`<h${t} id="${this.options.headerPrefix}${n}">${e}</h${t}>`}}function N(e,n){return e.replace(/<!--\s*@(ifn?def)\s+(\w+)\s*-->([^]*?)<!--\s*@endif\s*-->/g,(e,t,i,r)=>"ifdef"==t&&n[i]||"ifndef"==t&&!n[i]?`<!-- ${t} ${i} -->${r}<!-- endif -->`:`<!-- ${t} ${i} endif -->`)}function O(e,r,n=[]){return e?e.replace(/@(\w+)@/g,(e,t)=>{let i=C.lookup(r,t)||"";return i+="",i=n.indexOf(t)<0?I(i):i}):""}x.prepTemplate=S,x.setupRenderer=U,x.renderConditionalMacros=N,x.renderMarkdown=function(o){let e=!0,l=(o.pubinfo||(e=!1,o.pubinfo={}),o.pubinfo),t=(o.theme||(o.theme={}),delete o.pubinfo.private,l.time&&(d=parseInt(l.time),l.timems||(l.timems=1e3*d+""),l.humantime||(l.humantime=C.isoTime(d))),l.name&&(l.dirname=l.name.replace(/[^A-Za-z0-9_]/g,"-"),l.title=l.name),e&&(l.JSON=JSON.stringify(l,null,4).replace(/</g,"\\u003c")),o.template),c=(t=N(t=t.replace(/<!--\s*@include\s+(\S+)\s*-->/g,(e,t)=>"\x3c!-- include "+t+" --\x3e\n"+((o.theme.htmlDocIncludes||{})[t]||"")+"\n\x3c!-- end include --\x3e\n"),l),{html:t=o.locale?_(t,o.locale).text:t,theme:o.theme,filepath:o.filepath,versionPath:o.versionPath,ghEditURLs:o.ghEditURLs,params:l,TOC:o.TOC}),a=(S(c),new(y=y||x.requireMarked()).Renderer),s=(U(a),a.link);a.link=function(e,t,i){var r=new RegExp("^[/#]").test(e),n=r?"":"_blank";return r&&c.versionPath&&(e="/"+c.versionPath+e),s.call(a,e,t,i).replace(/^<a /,`<a ${n?`target="${n}"`:""} rel="nofollow noopener" `)};var i,r,n,u,d=x.requireDOMSanitizer();y.setOptions({renderer:a,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:d,smartLists:!0,smartypants:!0});let h=o.markdown,p=(o.repo&&(h+=`
\`\`\`package
${o.repo.name.replace(/^pxt-/,"")}=github:${o.repo.fullName}#${o.repo.tag||"master"}
\`\`\`
`),h=(h=h.replace(/^\s*https?:\/\/(\S+)\s*$/gm,(e,t)=>{for(var r of w){let i=r.rx.exec(t);if(i)return r.cmd.replace(/\$(\d+)/g,(e,t)=>i[parseInt(t)]||"")+"\n"}return e})).replace(/@([a-z]+)@/gi,(e,t)=>{var i=l[t];return!i&&o.throwOnError&&C.userError("unknown macro "+t),i||"unknown macro"}),y(h)),f=(p=(p=p.replace(/&lt;br\s*\/&gt;/gi,"<br/>")).replace(/(<img [^>]* src=")\/docs\/static\/([^">]+)"/g,(e,t,i)=>t+"/static/"+i+'"'),""),m=0;function g(e,t,i){let r=i;return e<=m&&(r=f+r,f="",m=0),r}p=p.replace(/<h(\d)[^>]+>\s*([~@])?\s*(.*?)<\/h\d>/g,(e,t,i,r)=>{var n,a=/^(\w+)\s+(.*)/.exec(r),r=a?a[1]:r,a=(a=a?a[2]:"",I(a)),r=I(r);if(t=parseInt(t),i){if("@"!=i)return r?(i=C.lookup(c.boxes,r))?(s=i.split("@BODY@"),n=g(t,f,s[0].replace("@ARGS@",a)),f=s[1],(s=i.match(/data-[^>\s]+/gi))&&0<=s.indexOf("data-inferred")&&(m=t),n):(o.throwOnError&&C.userError("Unknown box: ~ "+r),E("Unknown box: ~ "+r)):(i=f,f="",i);{let e=C.lookup(c.settings,r);if(null!=e)l[r]=a;else if(null==(e=C.lookup(c.macros,r)))return o.throwOnError&&C.userError("Unknown command: @"+r),E("Unknown command: @"+r);var s={ARGS:a,CMD:r};return g(t,f,O(e,s,["ARGS","CMD"]))}}return g(t,f,e)}),f&&(p+=f),l.title||(d=/<h1[^<>]*>([^<>]+)<\/h1>/.exec(p))&&(l.title=I(d[1])),l.description||(d=/<p>([^]+?)<\/p>/.exec(p))&&(l.description=I(d[1])),(d=/<div class="ui embed mdvid"[^<>]+?data-placeholder="([^"]+)"[^>]*\/?>/i.exec(p)||/<img class="ui [^"]*image" src="([^"]+)"[^>]*\/?>/i.exec(p))&&(l.cardLogo=I(d[1])),l.twitter=I(o.theme.twitter||"@msmakecode");let v={main:""};p=(p=p.replace(/<!-- BEGIN-ASIDE (\S+) -->([^]*?)<!-- END-ASIDE -->/g,(e,t,i)=>{var r=C.lookup(v,t);return v[t]=(r||"")+i,"\x3c!-- aside --\x3e"})).replace(/\n<\/code>/g,"</code>"),v.main=p,p="";for(i of Object.keys(v))p+=(r=i+"-container",n=v[i],O(c.boxes[r]||"@BODY@",{BODY:n},["BODY"]));l.body=p,l.name=l.title||"";for(u of Object.keys(o.theme)){var b=o.theme[u];"string"==typeof b&&(l["theme_"+u]=b)}return c.finish()},x.embedUrl=function(e,t,i,r){return`<div style="position:relative;height:0;padding-bottom:70%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${e+`#${t}:`+i}" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe></div>`},x.runUrl=function(e,t,i){return`<div style="position:relative;height:0;padding-bottom:${t};overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${e}?id=${encodeURIComponent(i)}" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div>`},x.codeEmbedUrl=function(e,t,i){return e=e+"---codeembed#pub:"+t,`<div style="position:relative;height:calc(${i=Math.ceil(i||300)}px + 5em);width:100%;overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="${e}" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-scripts allow-same-origin"></iframe></div>`};let o={b:1,strong:1,em:1};function _(e,r){let n={};function a(e){var t,e=/^(\s*)([^]*?)(\s*)$/.exec(e);let i=e[2].replace(/\s+/g," ");return""==i||/^((IE=edge,.*|width=device-width.*|(https?:\/\/|\/)[\w@\/\.]+|@[\-\w]+@|\{[^\{\}]+\}|[^a-zA-Z]*|(&nbsp;)+)\s*)+$/.test(i)?null:((t=C.lookup(r,i))?i=t:n[i]="",e[1]+i+e[3])}function s(e){return e.replace(/&llt;/g,"<").replace(/&ggt;/g,">")}return{text:e=(e=(e=(e="<start>"+(e=e.replace(/<([\/\w]+)([^<>]*)>/g,(e,t,i)=>{var r=t.replace(/^\//,"").toLowerCase();return 1===o[r]?"&llt;"+t+i+"&ggt;":e}))).replace(/(<([\/\w]+)([^<>]*)>)([^<>]+)/g,(e,t,i,r,n)=>"script"==i||"style"==i||null==(i=a(s(n)))?s(e):t+i)).replace(/(<[^<>]*)(content|placeholder|alt|title)="([^"]+)"/g,(e,t,i,r)=>null==a(r)?e:t+i+'="'+r.replace(/"/g,"''")+'"')).replace(/^<start>/g,""),missing:n}}function f(e,r){let t=0;var n,a=[{level:0,id:"",title:"",start:t,text:"",children:[]}],e=(e=e.replace(/\r/g,"")).split(/\n/);let s={};for(n of e){let e=/^\s*(#+)\s*(.*?)(#(\S+)\s*)?$/.exec(n),i=null;if(r&&e)if(e[4])if(s[e[4]])e=null;else{i=function e(t,i){if(t.id==i)return t;for(var r of t.children)if(r=e(r,i))return r;return null}(r,e[4]);let t=e=>{e.id&&(s[e.id]=!0),e.children.forEach(t)};i&&t(i)}else e=null;if(e){var o={level:r?1:e[1].length,title:e[2].trim(),id:e[4]||"",start:t,text:"",children:[]};if(i){n="";for(let e=0;e<i.level;++e)n+="#";n=(n=(n+=" ")+(o.title||i.title))+(" #"+o.id)}for(;a[a.length-1].level>=o.level;)a.pop();a[a.length-1].children.push(o),a.push(o)}a[a.length-1].text+=n+"\n",t++}return a[0]}x.translate=_,x.buildTOC=function(e){if(!e)return null;var t=p.docs.requireMarked(),i=x.requireDOMSanitizer(),i={renderer:new t.Renderer,gfm:!0,tables:!1,breaks:!1,pedantic:!1,sanitize:!0,sanitizer:i,smartLists:!1,smartypants:!1},r={name:"dummy",subitems:[]};let n=[],a=(n.push(r),t=t.lexer(e,i),!1);return t.forEach(e=>{switch(e.type){case"heading":e.depth;break;case"list_start":break;case"list_item_start":case"loose_item_start":a=!0;var t={name:"",path:"",subitems:[]};return void n.push(t);case"text":let r=n[n.length-1];0<=e.text.indexOf("[")?e.text.replace(/\[(.*?)\]\((.*?)\)/i,function(e,t,i){r.name=t,r.path=i.replace(".md","")}):a&&(r.name=e.text);break;case"list_item_end":case"loose_item_end":t=n.pop();n[n.length-1].subitems.push(t)}a=!1}),(e=r.subitems)&&0!=e.length?e:null};let h=!(x.visitTOC=function(e,t){e.forEach(function(e){t(e),e.subitems&&e.subitems.forEach(t)})});function m(e,t){function i(e,t,i){var r=m(e,t).trim();if(r!=(i=i.trim()))throw p.log(`*** Template:
${e}
*** Input:
${t}
*** Expected:
${i}
*** Output:
`+r),new Error("augment docs test fail")}if(h||(h=!0,i(n=`
# T0
## Examples #ex
### Example 1
TEx1
### Example 2 #ex2
TEx2
### Example 3
TEx3

## See also #also
TAlso
`,"",n),i(n," ",n),i(n,`
# @extends
# #ex2
My example
## See Also These! #also
My links
`,`
# T0
## Examples #ex
### Example 1
TEx1
### Example 2 #ex2
My example
### Example 3
TEx3

## See Also These! #also
My links
`),i(n,`
# @extends
### #ex
Foo
#### Example 1
Ex1
#### Example 2x #ex2
Ex2
## See Also These! #also
My links
`,`
# T0
## Examples #ex
Foo
#### Example 1
Ex1
#### Example 2x #ex2
Ex2
## See Also These! #also
My links
`)),!t)return e;var r,n=f(e,null),e=f(t,n);let a={},s={};for(r of e.children)C.assert(0==r.children.length),C.assert(!!r.id),a[r.id]=r.text;let o=e=>{e.id&&void 0!==a[e.id]&&(s[e.id]=!0,e.text=a[e.id],e.children=[]),e.children.forEach(o)},l=(o(n),""),c=e=>{l+=e.text,e.children.forEach(c)},u=(c(n),"");var d,t=e.text.replace(/^\s*#+\s*@extends.*/gm,"").replace(/^\s*\n/gm,"");t.trim()&&(u+=t.trim()+"\n");for(d of e.children)s[d.id]||(u+=d.text);return u&&(l+="## Couldn't apply replacement logic to:\n"+u),l}x.augmentDocs=m}})(pxt=pxt||{}),(e=>{(e.dom||(e.dom={})).el=function(e,t,i){let r=document.createElement(e);return t&&Object.keys(t).forEach(e=>r.setAttribute(e,t[e]+"")),function t(e){Array.isArray(e)?e.forEach(e=>t(e)):"string"==typeof e?r.appendChild(document.createTextNode(e)):e instanceof HTMLElement&&r.appendChild(e)}(i),r}})(pxt=pxt||{}),(c=>{var e;function u(e){e=/```package\s+((.|\s)+?)\s*```/i.exec(e);let t=void 0;return e&&(t={},e[1].split("\n").map(e=>e.replace(/\s*/g,"")).filter(e=>!!e).map(e=>e.split("=")).forEach(e=>t[e[0]]=e[1]||"*")),t}function d(e){e=/```config\s+((.|\s)+?)\s*```/i.exec(e);let t=[];return e&&e[1].split("\n").map(e=>e.replace(/\s*/g,"")).filter(e=>!!e).map(e=>e.split("=")).filter(e=>"feature"==e[0]&&!!e[1]).forEach(e=>t.push(e[1])),t.length?t:void 0}function h(e){var t,e=/```jres\s+((.|\s)+?)\s*```/i.exec(e);if(e)return e=e[1],t=JSON.parse(e),{jres:e,ts:c.emitTilemapsFromJRes(t)}}function p(e){e=/```assetjson\s+((.|\s)+?)\s*```/i.exec(e);return e?c.tutorial.parseAssetJson(e[1]):{}}function f(e){e=/```simtheme\s+([\s\S]*?)```/i.exec(e);return e?c.tutorial.parseSimThemeJson(e[1]):{}}function s(e){let t=c.Util.jsonTryParse(e);return null!=(t=t&&!Array.isArray(t)?[t]:t)&&t.length||null!=(t=e.split(/^---$/gm).filter(e=>!!e).map(e=>{let n={};return e.replace(/^\s*(?:-|\*)\s+(\w+)\s*:\s*(.*)$/gm,(e,t,i)=>{var r;return"flags"==t?n[t]=i.split(","):"otherAction"===t?(r=i.split(",").map(e=>null==e?void 0:e.trim()),(n.otherActions||(n.otherActions=[])).push({url:r[0],editor:r[1],cardType:r[2]})):n[t]=i,""}),!!Object.keys(n).length&&n}).filter(e=>!!e))&&t.length?t:void 0}function t(e){if(!e)return[];let i=[],r=!1,n=void 0,a="";return e.split(/\r?\n/).forEach(e=>{var t;/^## /.test(e)?n=e.substr(2).trim():/^(### ~ |```)codecard$/.test(e)?r=!0:/^(### ~|```)$/.test(e)?(r=!1,n&&a&&(null!=(t=s(a))&&t.length?i.push({name:n,cards:t}):c.log("invalid gallery format")),a="",n=void 0):r&&(a+=e+"\n")}),i.forEach(e=>e.cards.forEach(t=>{var e;!t.otherActions||t.otherActions.length||"tutorial"!=t.cardType&&"example"!=t.cardType||(e=["js"],c.appTarget.appTheme.python&&e.unshift("py"),t.otherActions=e.map(e=>({url:t.url,cardType:t.cardType,editor:e})))})),i}(e=c.gallery||(c.gallery={})).parsePackagesFromMarkdown=u,e.parseFeaturesFromMarkdown=d,e.parseJResFromMarkdown=h,e.parseTemplateProjectJSON=p,e.parseSimThemeJSON=f,e.parseExampleMarkdown=function(e,t){if(t){var i,r,n,a,s,o,l=/```(blocks?|typescript|python|spy|sim)\s+((.|\s)+?)\s*```/i.exec(t);if(l)return i=u(t),r=l[1],n=l[2],a=d(t),s=h(t),o=f(t),(e={name:e,filesOverride:{[c.MAIN_BLOCKS]:'<xml xmlns="http://www.w3.org/1999/xhtml"></xml>',["python"===l[1]?c.MAIN_PY:c.MAIN_TS]:n},dependencies:i,features:a,snippetType:r,source:n,simTheme:o}).filesOverride=Object.assign(Object.assign({},e.filesOverride),p(t)),s&&(e.filesOverride[c.TILEMAP_JRES]=s.jres,e.filesOverride[c.TILEMAP_CODE]=s.ts),e}},e.parseCodeCards=s,e.parseCodeCardsHtml=function(e){let t=[],i;return Array.from(e.children).forEach(e=>{"UL"===e.tagName||"OL"===e.tagName?(i=i||{},Array.from(e.querySelectorAll("li")).forEach(e=>{var t,e=e.innerText,e=/^\s*(\w+)\s*:\s*(.*)$/.exec(e);e&&(t=e[1],i[t]=e[2].trim(),"flags"===t)&&(i[t]=i[t].split(/,\s*/))})):"HR"==e.tagName&&(i&&t.push(i),i=void 0)}),i&&t.push(i),!(null==(t=0===t.length&&"CODE"===e.tagName?c.Util.jsonTryParse(e.textContent):t)||!t.length)&&t},e.parseGalleryMardown=t,e.loadGalleryAsync=function(e){return c.Cloud.markdownAsync(e).then(e=>t(e))},e.codeCardsToMarkdown=function(e){return`### ~ codecard

${(e||[]).map(t=>Object.keys(t).filter(e=>!!t[e]).map(e=>"otherActions"===e?t[e].map(e=>`* otherAction: ${e.url}, ${e.editor||""}, `+(e.cardType||"")).join("\n"):`* ${e}: `+t[e]).join("\n")).join(`

---

`)}

### ~
`}})(pxt=pxt||{}),(o=>{class e{constructor(e){this.io=e,this.q=new o.U.PromiseQueue,this.dataBuf="",this.numSent=0,this.pktSize=400,this.trace=!1,this.bmpMode=!0,this.targetInfo="",this.onEvent=e=>{},this.io.onData=e=>this.onData(e)}onData(e){for(this.dataBuf+=o.U.uint8ArrayToString(e);0<this.dataBuf.length;){var t=this.dataBuf[0];if("+"==t)this.dataBuf=this.dataBuf.slice(1);else if("$"==t||"%"==t){var i=this.decodeResp(this.dataBuf.slice(1));if(null==i)break;"$"==t?(this.io.sendPacketAsync(this.buildCmd("+")),this.onResponse?this.onResponse(i):0<this.numSent&&this.io.error("unexpected response: "+i)):this.onEvent(i)}else this.io.error("invalid character: "+t)}}buildCmd(t){if("+"==t)return o.U.stringToUint8Array(t);let i="";for(let e=0;e<t.length;++e){var r=t.charAt(e);"}"==r||"#"==r||"$"==r?i=(i+="}")+String.fromCharCode(32^r.charCodeAt(0)):i+=r}let n=0;t=i;for(let e=0;e<t.length;++e)n=n+t.charCodeAt(e)&255;return i="$"+t+"#"+("0"+n.toString(16)).slice(-2),o.U.stringToUint8Array(i)}decodeResp(i){let r="";for(let t=0;t<i.length;++t){var e=i[t];if("}"==e)++t,r+=String.fromCharCode(32^i.charCodeAt(t));else if("*"==e){++t;let e=i.charCodeAt(t)-29;for(var n=r.charAt(r.length-1);0<e--;)r+=n}else{if("#"==e)return 2==i.slice(t+1,t+3).length?(this.dataBuf=i.slice(t+3),r):null;r+=e}}return null}sendCmdOKAsync(e){return this.sendCmdAsync(e,e=>"OK"==e)}error(e){this.io.error(e),this.io.disconnectAsync()}sendCmdAsync(i,r){this.numSent++;let e=this.buildCmd(i);return this.q.enqueue("one",()=>null===r?this.io.sendPacketAsync(e).then(()=>null):new Promise(t=>{this.onResponse=e=>{this.onResponse=null,this.trace&&o.log(`GDB: '${i}' -> '${e}'`),void 0===r||r(e)||this.error(`Invalid GDB command response: '${i}' -> '${e}'`),t(e)},this.io.sendPacketAsync(e)}))}sendRCmdAsync(e){return this.sendMCmdAsync("qRcmd,"+o.U.toHex(o.U.stringToUint8Array(e)))}sendMCmdAsync(r){this.numSent++;let e=this.buildCmd(r),n="";return this.q.enqueue("one",()=>new Promise(i=>{this.onResponse=e=>{var t;"OK"!=e&&"O"==e[0]?n+=(t=e.slice(1),o.U.uint8ArrayToString(o.U.fromHex(t))):("OK"!=e&&(n+=" - "+e),this.onResponse=null,this.trace&&o.log(`Final GDB: '${r}' -> '${n}'`),i(n))},this.io.sendPacketAsync(e)}))}write32Async(e,t){var i=new Uint8Array(4);return o.HF2.write32(i,0,t),this.writeMemAsync(e,i)}writeMemAsync(e,t){var i=this.pktSize/2-10;return o.U.assert(t.length<i),this.sendCmdOKAsync("M"+e.toString(16)+","+t.length.toString(16)+":"+o.U.toHex(t)).then(e=>{o.log(e)})}readMemAsync(e,a){let s=this.pktSize/2-6;if(a>s){let r=new Uint8Array(a),n=t=>{let i=Math.min(a-t,s);return 0==i?Promise.resolve(r):this.readMemAsync(e+t,i).then(e=>(o.U.memcpy(r,t,e),n(t+i)))};return n(0)}return this.sendCmdAsync("m"+e.toString(16)+","+a.toString(16)).then(e=>o.U.fromHex(e))}initBMPAsync(){return Promise.resolve().then(()=>this.sendRCmdAsync("swdp_scan")).then(e=>(this.targetInfo=e,this.sendCmdAsync("vAttach;1",e=>"T"==e[0]))).then(()=>{})}initAsync(){return o.U.delay(1e3).then(()=>this.sendCmdAsync("!")).then(()=>this.sendCmdAsync("qSupported")).then(e=>{let r={};return e=(e=";"+e+";").replace(/;([^;]+)[=:]([^:;]+)/g,(e,t,i)=>(r[t]=i,";")),this.pktSize=parseInt(r.PacketSize)||1024,o.log("GDB-server caps: "+JSON.stringify(r)+" "+e.replace(/;+/g,";")),this.bmpMode?this.initBMPAsync():this.sendCmdAsync("c").then(()=>{})})}}o.GDBServer=e})(pxt=pxt||{}),(c=>{var e;{var o=c.github||(c.github={});function l(){var e;return!!o.forceProxy||!(c.U.isNodeJS||null!=(e=null==(e=null==c?void 0:c.appTarget)?void 0:e.cloud)&&e.noGithubProxy)}o.token=null,o.forceProxy=!1;let n={};function u(n){var e;return n.method=null!=(e=n.method)?e:"GET",function i(e){var t;let r=c.U.clone(n);o.token&&(r.headers||(r.headers={}),r.url==s?r.headers.Authorization="bearer "+o.token:(r.url=c.BrowserUtils.cacheBustingUrl(r.url),r.headers.Authorization="token "+o.token));r.allowHttpErrors=null!=(t=r.allowHttpErrors)&&t;return c.U.requestAsync(r).catch(t=>{if(c.tickEvent("github.error",{statusCode:t.statusCode}),o.handleGithubNetworkError){let e=o.handleGithubNetworkError(r,t);if(e)return i(!1)}throw t})}(o.token)}function d(e){return u({url:e,method:"GET"}).then(e=>e.json)}function h(e){return c.Cloud.apiRequestWithCdnAsync({url:"gh/"+e,forceLiveEndpoint:!0}).then(e=>e.json)}function p(e){c.log("github proxy error: "+e.message),c.debug(e)}o.isOrgAsync=function(e){return u({url:"https://api.github.com/orgs/"+e,method:"GET",allowHttpErrors:!0}).then(e=>200==e.statusCode)};class M{constructor(){this.latestVersions={},this.configs={},this.packages={}}proxyWithCdnLoadPackageAsync(e,t){let i=e+"/"+t;var r=this.packages[i];return r?(c.debug(`github cache ${e}/${t}/text`),Promise.resolve(r)):h(N((r=I(e)).slug,t,r.fileName,"text")).then(e=>this.packages[i]={files:e})}cacheConfig(e,t){t=c.Package.parseAndValidConfig(t);return this.configs[e]=t,c.U.clone(t)}async loadConfigAsync(e,t){t||(c.debug("dep: default to master branch"),t="master");var i=e+"/"+t,r=this.configs[i];if(r)return c.debug(`github cache ${e}/${t}/config`),c.U.clone(r);if(l())try{var n=await this.proxyWithCdnLoadPackageAsync(e,t);return this.cacheConfig(i,n.files[c.CONFIG_NAME])}catch(e){p(e)}r=await m(e,t,c.CONFIG_NAME);return this.cacheConfig(i,r)}async latestVersionAsync(e,t){let i=this.latestVersions[e];return i||(c.debug("dep: resolve latest version of "+e),this.latestVersions[e]=i=await c.github.latestVersionAsync(e,t,!0,!1)),i}async loadPackageAsync(e,t){if(t||(c.debug("load pkg: default to master branch"),t="master"),l())try{return await this.proxyWithCdnLoadPackageAsync(e,t).then(e=>c.U.clone(e))}catch(e){p(e)}return this.githubLoadPackageAsync(e,t)}githubLoadPackageAsync(n,i){return w(n,i).then(r=>{let t=n+"/"+r;var e=this.packages[t];return e?(c.debug(`github cache ${n}/${i}/text`),Promise.resolve(c.U.clone(e))):(c.log(`Downloading ${n}/${i} -> `+r),m(n,r,c.CONFIG_NAME).then(e=>{let i={files:{}};i.files[c.CONFIG_NAME]=e;e=JSON.parse(e);return c.U.promiseMapAll(c.allPkgFiles(e).slice(1),t=>m(n,r,t).then(e=>{i.files[t]=e})).then(()=>(this.packages[t]=i,c.U.clone(i)))}))})}async loadTutorialMarkdown(e,t){e=(await i(e=D(e),t)).resp,t=e.markdown;return c.Util.assert("object"==typeof t),await this.cacheReposAsync(e),t.repo}async cacheReposAsync(e){var t,i;"object"==typeof e.markdown&&(t=e.markdown,this.cacheRepo(t.repo));for(i of e.dependencies)this.cacheRepo(i)}cacheRepo(e){let t=e.repo;e.subPath&&(t+="/"+e.subPath);var i=t,r=(this.packages[i+="/"+e.sha]={files:e.files},e.latestVersion&&this.cacheLatestVersion(t,e.latestVersion),e.files["pxt.json"]);r&&(e=i+"/"+(e.version||"master"),this.cacheConfig(i,r),this.cacheConfig(e,r))}cacheLatestVersion(e,t){this.latestVersions[e]=t}}function f(t,e,i){return u({url:"https://api.github.com/repos/"+N(t.slug,"contents",t.fileName,i+"?ref="+e),method:"GET"}).then(e=>{e=e.json;return n[t.slug]=!0,e&&"base64"==e.encoding&&null!=e.content?c.Util.fromUTF8(atob(e.content)):c.U.httpGetTextAsync(e.download_url)})}function m(e,t,i){let r=I(e);return n[r.slug]?f(r,t,i):c.U.requestAsync({url:"https://raw.githubusercontent.com/"+N(r.slug,t,r.fileName,i),allowHttpErrors:!0}).then(e=>200==e.statusCode?e.text:f(r,t,i))}async function i(e,t,i,r){let n=c.Cloud.apiRequestWithCdnAsync;var a=new URLSearchParams;t&&a.set("ref",t),i&&(a.set("noCache","1"),n=c.Cloud.privateRequestAsync);t=c.BrowserUtils.appendUrlQueryParams("ghtutorial/"+e,a),i=await n({url:t,method:"GET",headers:r?{"If-None-Match":r}:void 0});let s;return{resp:s=304===i.statusCode?void 0:i.json,etag:i.headers.etag}}function g(e,t,i,r){return u({url:/^https:/.test(e)?e:"https://api.github.com/repos/"+e,headers:i,method:r||"POST",data:t,successCodes:[200,201,202,204]}).then(e=>e.json)}function v(e,t){let i=1;for(;e.refs[t+i];)i++;return t+i}async function b(e,t,i){return await g(e+"/git/refs",{ref:"refs/heads/"+t,sha:i}),t}function y(e,i="tags",t,r){e=I(e),t=t,t=!!o.forceProxy||!(o.token&&!t)&&l();let n=null;t=t?c.U.httpGetJsonAsync(c.BrowserUtils.cacheBustingUrl(`${c.Cloud.apiRoot}gh/${e.slug}/refs`+(r?"?nocache=1":""))).then(t=>{var e=Object.keys(t.refs).filter(e=>c.U.startsWith(e,"refs/"+i+"/")).map(e=>({ref:e,object:{sha:t.refs[e]}}));return n=t.refs.HEAD,e}):d(`https://api.github.com/repos/${e.slug}/git/refs/${i}/?per_page=100`);let a=e=>e.replace(/^refs\/[^\/]+\//,"");return t.then(e=>{e.sort((e,t)=>c.semver.strcmp(a(e.ref),a(t.ref)));var t,i={};for(t of e)i[a(t.ref)]=t.object.sha;return{refs:i,head:n}},e=>404==e.statusCode?{refs:{}}:Promise.reject(e))}function r(e){return"commit"==e.object.type?Promise.resolve(e.object.sha):"tag"==e.object.type?d(e.object.url).then(e=>"commit"==e.object.type?e.object.sha:Promise.reject(new Error("Bad type (2nd order) "+e.object.type))):Promise.reject(new Error("Bad type "+e.object.type))}function w(e,t){if(/^[a-f0-9]{40}$/.test(t))return Promise.resolve(t);let i=I(e);return d(`https://api.github.com/repos/${i.slug}/git/refs/tags/`+t).then(r,e=>d(`https://api.github.com/repos/${i.slug}/git/refs/heads/`+t).then(r))}async function A(e,t,i){return t=t||await o.db.latestVersionAsync(e,i),o.db.loadConfigAsync(e,t)}async function k(e,t){var i,r=I(e);if(r){if(!x(r,t))return r.tag||(r.tag=await o.db.latestVersionAsync(r.slug,t)),r=await o.db.loadPackageAsync(r.fullName,r.tag),(t=_(t,e))&&(i=c.Package.parseAndValidConfig(r.files[c.CONFIG_NAME]))&&(c.log(`auto-disable ${t.join(",")} due to targetconfig entry for `+e),i.disablesVariants=t,r.files[c.CONFIG_NAME]=c.Package.stringifyConfig(i)),r;c.tickEvent("github.download.banned"),c.log("Github repo is banned")}else c.log("Unknown GitHub syntax")}o.MemoryGithubDb=M,o.downloadTextAsync=m,o.downloadMarkdownTutorialInfoAsync=i,o.downloadTutorialMarkdownAsync=async function(e,t){return o.db.loadTutorialMarkdown(e,t)},o.db=new M,o.authenticatedUserAsync=function(){return o.token?d("https://api.github.com/user"):Promise.resolve(void 0)},o.getCommitsAsync=function(e,t){return d("https://api.github.com/repos/"+I(e).slug+"/commits?sha="+t).then(e=>e.map(e=>{var t=e.commit;return t.url=e.url,t.sha=e.sha,t}))},o.getCommitAsync=function(e,t){return d("https://api.github.com/repos/"+I(e).slug+"/git/commits/"+t).then(t=>d(t.tree.url+"?recursive=1").then(e=>(t.tree=e,t)))},o.createObjectAsync=function(e,t,i){return g(I(e).slug+"/git/"+t+"s",i).then(e=>e.sha)},o.postCommitComment=function(e,t,i,r,n){return g(I(e).slug+`/commits/${t}/comments`,{body:i,path:r,position:n}).then(e=>e.id)},o.fastForwardAsync=async function(e,t,i){return 200==(await u({url:`https://api.github.com/repos/${I(e).slug}/git/refs/heads/`+t,method:"PATCH",allowHttpErrors:!0,data:{sha:i,force:!1}})).statusCode},o.putFileAsync=async function(e,t,i){e=I(e),await u({url:"https://api.github.com/repos/"+c.github.join(e.slug,"contents",e.fileName,t),method:"PUT",allowHttpErrors:!0,data:{message:lf("Initialize empty repo"),content:btoa(c.U.toUTF8(i)),branch:"master"},successCodes:[201]})},o.createTagAsync=async function(e,t,i){await g(e+"/git/refs",{ref:"refs/tags/"+t,sha:i})},o.createReleaseAsync=async function(e,t,i){await g(e+"/releases",{tag_name:t,target_commitish:i,name:t,draft:!1,prerelease:!1})},o.createPRFromBranchAsync=async function(e,t,i,r,n){return null==(e=await g(e+"/pulls",{title:r,body:n||lf("Automatically created from MakeCode."),head:i,base:t,maintainer_can_modify:!0}))?void 0:e.html_url},o.mergeAsync=function(t,e,i,r){return u({url:`https://api.github.com/repos/${I(t).slug}/merges`,method:"POST",successCodes:[201,204,409],data:{base:e,head:i,commit_message:r}}).then(e=>{if(201==e.statusCode||204==e.statusCode)return e.json.sha;if(409==e.statusCode)return null;throw c.U.userError(lf("Cannot merge in github.com/{1}; code: {2}",t,e.statusCode))})},o.getRefAsync=function(e,t){return d("https://api.github.com/repos/"+e+"/git/refs/heads/"+(t=t||"master")).then(r).catch(e=>{404!=e.statusCode&&Promise.reject(e)})},o.getNewBranchNameAsync=async function(e,t="patch-"){return v(await y(e,"heads"),t)},o.createNewBranchAsync=b,o.forkRepoAsync=async function(e,t,i="pr-"){var r=T(await g((e=I(e)).slug+"/forks",{}),{fullName:e.fullName,fileName:e.fileName}),n=Date.now()+3e5;let a=null;for(;!a&&Date.now()<n;){await c.U.delay(1e3);try{a=await y(r.slug,"heads")}catch(e){}}if(a)return e=v(a,i),await b(r.slug,e,t),r.fullName+"#"+e;throw new Error(lf("Timeout waiting for fork"))},o.listRefsAsync=function(e,t="tags",i,r){return y(e,t,i,r).then(e=>Object.keys(e.refs))},o.listRefsExtAsync=y,o.pkgConfigAsync=A,o.downloadPackageAsync=k,o.downloadLatestPackageAsync=async function(e,t,i){var r=await c.packagesConfigAsync(),t=await c.github.latestVersionAsync(e.slug,r,t,i),i=e.fullName+"#"+t,e=(await c.github.downloadPackageAsync(i,r),await A(e.fullName,t,r));return{version:"github:"+i,config:e}},o.cacheProjectDependenciesAsync=async function(r){var e=null==(e=Object.keys(r.dependencies))?void 0:e.filter(e=>S(r.dependencies[e]));if(e.length){let i=await c.packagesConfigAsync();await Promise.all(e.map(async e=>{var t=r.dependencies[e];if(!await k(t,i))throw new Error(lf("Cannot load extension {0} from {1}",e,t))}))}};let a;function t(e){return c.Cloud.cdnApiUrl(`gh/${e.fullName}/icon`)}function T(e,t){var i;if(e)return(i={owner:e.owner.login.toLowerCase(),slug:e.full_name.toLowerCase(),fullName:((null==t?void 0:t.fullName)||e.full_name).toLowerCase(),fileName:null==(i=null==t?void 0:t.fileName)?void 0:i.toLocaleLowerCase(),name:e.name,description:e.description,defaultBranch:e.default_branch,tag:null==t?void 0:t.tag,updatedAt:Math.round(new Date(e.updated_at).getTime()/1e3),fork:e.fork,private:e.private}).status=E(i,null==t?void 0:t.config),i}function E(e,t){return e?x(e,t)?a.Banned:((e,t)=>{var i;return!(!((t,e)=>!(!t||!e||!(t.owner&&e.approvedOrgs&&e.approvedOrgs.some(e=>e.toLowerCase()==t.owner.toLowerCase()))))(e,t)&&(i=null==(i=null==e?void 0:e.fullName)?void 0:i.toLowerCase(),e=null==(e=null==e?void 0:e.slug)?void 0:e.toLowerCase(),null==t||!t.approvedRepoLib||!i&&!e||!t.approvedRepoLib[i]&&!t.approvedRepoLib[e]))})(e,t)?a.Approved:a.Unknown:a.Unknown}function x(e,r){var t,n;if(t=e,!(!(n=r)||t&&t.owner&&(!n.bannedOrgs||!n.bannedOrgs.some(e=>e.toLowerCase()==t.owner.toLowerCase()))))return 1;if(r){if(!e)return 1;let t=null==(n=e.fullName)?void 0:n.toLowerCase(),i=null==(n=e.slug)?void 0:n.toLowerCase();return!(!r.bannedRepos||!r.bannedRepos.some(e=>e&&(e.toLowerCase()==t||e.toLowerCase()==i)))}}async function C(e,t){e=I(e);if(e){var i,r,n=E(e,t);if(n!=a.Banned){if(l())try{return r=n,await h((i=e).slug).then(e=>{if(e)return{github:!0,owner:i.owner,fullName:i.fullName,fileName:i.fileName,slug:i.slug,name:i.fileName?e.name+"-"+i.fileName:e.name,description:e.description,defaultBranch:e.defaultBranch||"master",tag:i.tag,status:r}}).catch(e=>{c.reportException(e)})}catch(e){p(e)}return T(await d("https://api.github.com/repos/"+e.slug),{config:t,fullName:e.fullName,fileName:e.fileName,tag:e.tag})}}}function I(t){if(t){t=(t=t.trim()).replace(/\/$/,"");var i=/^https:\/\/([^./#]+)\.github\.io\/([^/#]+)\/?$/i.exec(t),i=(t=(t=(t=(t=i?`github:${i[1]}/`+i[2]:t).replace(/^github:/i,"")).replace(/^https:\/\/github\.com\//i,"")).replace(/\.git\b/i,""),/^([^#\/:]+)\/([^#\/:]+)(\/([^#]+))?(#([^\/:]*))?$/.exec(t));if(i){var t=i[1],r=i[2];let e=i[4];var i=i[6],n=e&&/^tree\/([^\/]+\/)/.exec(e);return n&&(e=e.slice(n[0].length)),{owner:t,project:r,slug:N(t,r),fullName:N(t,r,e),tag:i,fileName:e}}}}function S(e){return!!e&&"github:"==e.slice(0,7)}function U(e,t=!1){return e?"github:"+(t?e.fullName:e.fullName.toLowerCase())+(e.tag?"#"+e.tag:""):void 0}function N(...e){return e.filter(e=>!!e).join("/")}function O(e,t){return e&&(t=I(t))?(e.approvedRepoLib,e.approvedRepoLib&&(null==(e=c.U.lookup(e.approvedRepoLib,t.slug.toLowerCase()))?void 0:e.upgrades)):null}function _(e,t){e=O(e,t)||[];if(e)for(var i of e){var i=/^dv:(.*)/.exec(i);if(i)return(i=i[1].split(/,/)).some(e=>!/^\w+$/.test(e))?null:i}return null}function P(e,a,t,i){let s=I(e);return s?C(s.slug,a).then(n=>{if(n)return y(n.slug,"tags",t,i).then(e=>{var i=Object.keys(e.refs),i=c.semver.sortLatestTags(i),r=c.appTarget.versions&&c.semver.tryParse(c.appTarget.versions.target);if(r&&a.releases&&a.releases["v"+r.major]){let t=a.releases["v"+r.major].map(e=>c.github.parseRepoId(e)).filter(e=>e&&e.fullName.toLowerCase()==s.fullName.toLowerCase())[0];if(t){if(i.some(e=>e==t.tag))return c.debug(`approved release ${t.fullName}#${t.tag} for v`+r.major),Promise.resolve(t.tag);c.reportError("packages",`approved release ${t.fullName}#${t.tag} for v${r.major} not found anymore`,{repo:n.fullName})}}return i[0]?Promise.resolve(i[0]):e.head||w(n.slug,n.defaultBranch)})}):Promise.resolve(null)}(e=a=o.GitRepoStatus||(o.GitRepoStatus={}))[e.Unknown=0]="Unknown",e[e.Approved=1]="Approved",e[e.Banned=2]="Banned",o.isDefaultBranch=function(e,t){return t&&t.defaultBranch?e===t.defaultBranch:/^(main|master)$/.test(e)},o.listUserReposAsync=function(){return L(`{
  viewer {
    repositories(first: 100, affiliations: [OWNER, COLLABORATOR], orderBy: {field: PUSHED_AT, direction: DESC}) {
      nodes {
        name
        description
        full_name: nameWithOwner
        private: isPrivate
        fork: isFork
        updated_at: updatedAt
        owner {
          login
        }
        defaultBranchRef {
          name
        }
        pxtjson: object(expression: "HEAD:pxt.json") {
          ... on Blob {
            text
          }
        }
        readme: object(expression: "HEAD:README.md") {
          ... on Blob {
            text
          }
        }
      }
    }
  }
}`).then(e=>e.data.viewer.repositories.nodes.filter(e=>e.pxtjson).filter(e=>{e.default_branch=e.defaultBranchRef.name;var t=c.Package.parseAndValidConfig(e.pxtjson&&e.pxtjson.text),e=e.readme&&e.readme.text;return!!t&&(t.supportedTargets?-1<t.supportedTargets.indexOf(c.appTarget.id):e&&-1<e.indexOf("PXT/"+c.appTarget.id))}).map(e=>T(e,{fullName:e.full_name})))},o.createRepoAsync=function(e,t,i){return g("https://api.github.com/user/repos",{name:e,description:t,private:!!i,has_issues:!0,has_projects:!1,has_wiki:!1,allow_rebase_merge:!1,allow_merge_commit:!0,delete_branch_on_merge:!1}).then(e=>T(e))},o.enablePagesAsync=async function(e){var t=I(e);let i=void 0;try{var r=await d(`https://api.github.com/repos/${t.slug}/pages`);r&&(i=r.html_url)}catch(e){}if(!i)try{var n=await g(`https://api.github.com/repos/${t.slug}/pages`,{source:{branch:"master",path:"/"}},{Accept:"application/vnd.github.switcheroo-preview+json"});i=n.html_url}catch(e){c.tickEvent("github.pages.error"),c.reportException(e)}if(i){r=await d("https://api.github.com/repos/"+e);if(r&&!r.homepage)try{await g("https://api.github.com/repos/"+e,{homepage:i},void 0,"PATCH")}catch(e){c.tickEvent("github.homepage.error")}}},o.repoIconUrl=function(e){if(e.status==a.Approved)return t(e)},o.mkRepoIconUrl=t,o.repoStatus=E,o.isRepoHidden=function(e,t){var i;return!(e&&t&&(i=null==(i=e.fullName)?void 0:i.toLowerCase(),e=null==(e=e.slug)?void 0:e.toLowerCase(),!(i=t.approvedRepoLib[i]||t.approvedRepoLib[e])||!i.hidden))},o.repoAsync=C,o.searchAsync=function(e,t){var i;return t?0<(i=e.split("|").map(I).filter(e=>!!e)).length?Promise.all(i.map(e=>C(e.fullName,t))).then(e=>e.filter(e=>e&&e.status!=a.Banned)):c.U.httpGetJsonAsync(`${c.Cloud.apiRoot}ghsearch/${c.appTarget.id}/${c.appTarget.platformid||c.appTarget.id}?q=`+encodeURIComponent(e)).then(e=>e.items.map(e=>T(e,{config:t,fullName:e.full_name})).filter(e=>e.status==a.Approved||t.allowUnapproved&&e.status==a.Unknown).filter(e=>!c.appTarget.appTheme.githubUrl||"https://github.com/"+e.fullName!=c.appTarget.appTheme.githubUrl.toLowerCase())).catch(e=>[]):Promise.resolve([])},o.parseRepoId=I,o.toGithubDependencyPath=function(e,t){let i="github:"+e;return t&&(i+="#"+t),i},o.isGithubId=S,o.stringifyRepo=U,o.normalizeRepoId=function(e,t){if(e=I(e))return!e.tag&&t&&(e.tag=t),U(e)},o.join=N,o.upgradedPackageReferenceAsync=async function e(t,i){var r,n=O(t,i);if(!n)return null;for(r of n){var a=/^move:(.*)$/.exec(r);if(a){if(o=I(a[1]))return o.tag||(o.tag=await P(a[1],t)),l=I(i),!o.fileName&&l.fileName&&(o.fileName=l.fileName,o.fullName=N(o.owner,o.project,o.fileName)),l=U(o),c.debug(`upgrading ${i} to ${l}}`),await e(t,l)||l;c.log("cannot parse move target: "+a[1])}var s,o,l=(o=/^min:(.*)/.exec(r))&&c.semver.tryParse(o[1]);if(l)return a=I(i),(s=c.semver.tryParse(a.tag))&&c.semver.cmp(s,l)<0?(a.tag=o[1],c.debug(`upgrading ${i} to `+o[1]),U(a)):(s||c.log(`not upgrading ${i} - cannot parse version`),null);_(t,i)||c.log(`invalid upgrade rule: ${i} -> `+r)}return i},o.upgradedPackageId=function(e,t){return(e=_(e,t))?t+"?dv="+e.join(","):t},o.latestVersionAsync=P,o.resolveMonoRepoVersions=function(i){i=c.Util.clone(i);let r={};return Object.keys(i).map(e=>({id:e,ghid:o.parseRepoId(i[e])})).filter(e=>null==(e=e.ghid)?void 0:e.tag).forEach(e=>{var t=e.ghid;let i=r[t.slug];(i=i||(r[t.slug]={tag:t.tag,deps:[]})).deps.push(e),c.semver.strcmp(i.tag,t.tag)<0&&(c.debug("dep: resolve later monorepo tag to "+c.github.stringifyRepo(t)),i.tag=t.tag)}),c.U.values(r).forEach(t=>t.deps.forEach(e=>{e.ghid.tag!==t.tag&&(c.debug(`dep: ${c.github.stringifyRepo(e.ghid)} -> `+t.tag),e.ghid.tag=t.tag,i[e.id]=c.github.stringifyRepo(e.ghid))})),i},o.GIT_JSON=".git.json";let s="https://api.github.com/graphql";function L(e){e=JSON.stringify({query:e});return g(s,e)}function D(e){var t;return/^github\:/i.test(e)&&(e=e.slice(7)),e=/^https?\:/i.test(e)&&(e=new URL(e).pathname.slice(1),t=/^((?:[^\/]+\/){2})blob\/[^\/]+\/(.*)\.md$/.exec(e))?t[1]+t[2]:e}o.lookupFile=function(e,t,i){if(!t)return null;let r=N(e.fileName,i);return t.tree.tree.find(e=>e.path==r)},o.ghGraphQLQueryAsync=L,o.findPRNumberforBranchAsync=function(e,t){return e=I(e),L(`
{
    repository(owner: ${JSON.stringify(e.owner)}, name: ${JSON.stringify(e.project)}) {
        pullRequests(last: 1, states: [OPEN, MERGED], headRefName: ${JSON.stringify(t)}) {
            edges {
                node {
                    number
                    state
                    mergeable
                    baseRefName
                    url
                    isDraft
                }
            }
        }
    }
}
`).then(e=>{var e=e.data.repository.pullRequests.edges[0];return e&&e.node?{number:(e=e.node).number,mergeable:e.mergeable,state:e.state,title:e.title,url:e.url,base:e.baseRefName}:{number:-1}})},o.getPagesStatusAsync=function(e){return d(`https://api.github.com/repos/${e}/pages`).catch(e=>({status:null}))},o.normalizeTutorialPath=D}})(pxt=pxt||{}),(e=>{e.REFCNT_FLASH="0xfffe",e.VTABLE_MAGIC=249,e.ValTypeObject=4,(e=e.BuiltInType||(e.BuiltInType={}))[e.BoxedString=1]="BoxedString",e[e.BoxedNumber=2]="BoxedNumber",e[e.BoxedBuffer=3]="BoxedBuffer",e[e.RefAction=4]="RefAction",e[e.RefImage=5]="RefImage",e[e.RefCollection=6]="RefCollection",e[e.RefRefLocal=7]="RefRefLocal",e[e.RefMap=8]="RefMap",e[e.RefMImage=9]="RefMImage",e[e.MMap=10]="MMap",e[e.BoxedString_SkipList=11]="BoxedString_SkipList",e[e.BoxedString_ASCII=12]="BoxedString_ASCII",e[e.ZPin=13]="ZPin",e[e.User0=16]="User0"})(pxt=pxt||{}),(c=>{{var u=c.HF2||(c.HF2={});function o(e,t,i){e[t+0]=i>>0&255,e[t+1]=i>>8&255,e[t+2]=i>>16&255,e[t+3]=i>>24&255}function l(e,t,i){e[t+0]=i>>0&255,e[t+1]=i>>8&255}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function d(e,t){return e[t]|e[t+1]<<8}function i(t){var i=new Uint8Array(4*t.length);for(let e=0;e<t.length;++e)o(i,4*e,t[e]);return i}u.HF2_CMD_BININFO=1,u.HF2_MODE_BOOTLOADER=1,u.HF2_MODE_USERSPACE=2,u.HF2_CMD_INFO=2,u.HF2_CMD_RESET_INTO_APP=3,u.HF2_CMD_RESET_INTO_BOOTLOADER=4,u.HF2_CMD_START_FLASH=5,u.HF2_CMD_WRITE_FLASH_PAGE=6,u.HF2_CMD_CHKSUM_PAGES=7,u.HF2_CMD_READ_WORDS=8,u.HF2_CMD_WRITE_WORDS=9,u.HF2_CMD_DMESG=16,u.HF2_FLAG_SERIAL_OUT=128,u.HF2_FLAG_SERIAL_ERR=192,u.HF2_FLAG_CMDPKT_LAST=64,u.HF2_FLAG_CMDPKT_BODY=0,u.HF2_FLAG_MASK=192,u.HF2_SIZE_MASK=63,u.HF2_STATUS_OK=0,u.HF2_STATUS_INVALID_CMD=1,u.HF2_STATUS_EXEC_ERR=2,u.HF2_STATUS_EVENT=128,u.HF2_CMD_JDS_CONFIG=32,u.HF2_CMD_JDS_SEND=33,u.HF2_EV_JDS_PACKET=8388640,u.CUSTOM_EV_JACDAC="jacdac",u.HF2_EV_MASK=8388608,u.write32=o,u.write16=l,u.read32=a,u.read16=d,u.encodeU32LE=i;let t=!(u.decodeU32LE=function(t){var i=[];for(let e=0;e<t.length;e+=4)i.push(a(t,e));return i});function h(e){t?c.log("HF2: "+e):c.debug("HF2: "+e)}u.enableLog=function(){t=!0};class r{constructor(o){var e;this.io=o,this.initialized=!1,this.cmdSeq=c.U.randomUint32(),this.lock=new c.U.PromiseQueue,this.flashing=!1,this.rawMode=!1,this.maxMsgSize=63,this.bootloaderMode=!1,this.reconnectTries=0,this.autoReconnect=!1,this.icon=(null==(e=c.appTarget.appTheme.downloadDialogTheme)?void 0:e.deviceIcon)||"usb",this.msgs=new c.U.PromiseBuffer,this.eventHandlers={},this.jacdacAvailable=!1,this.onSerial=(e,t)=>{},this.onCustomEvent=(e,t)=>{},this.onConnectionChanged=()=>{};let l=[];o.onDeviceConnectionChanged=e=>this.disconnectAsync().then(()=>e&&this.reconnectAsync()),o.onSerial=(e,t)=>this.onSerial(e,t),o.onData=e=>{var i=e[0]&u.HF2_FLAG_MASK,t=63&e[0],r=new Uint8Array(t);if(c.U.memcpy(r,0,e,1,t),i&u.HF2_FLAG_SERIAL_OUT)this.onSerial(r,i==u.HF2_FLAG_SERIAL_ERR);else if(l.push(r),i!=u.HF2_FLAG_CMDPKT_BODY){c.U.assert(i==u.HF2_FLAG_CMDPKT_LAST);let e=0;for(var n of l)e+=n.length;var a,s=new Uint8Array(e);let t=0;for(a of l)c.U.memcpy(s,t,a),t+=a.length;l=[],s[2]&u.HF2_STATUS_EVENT?o.onEvent(s):this.msgs.push(s)}},o.onEvent=e=>{var t=a(e,0),i=c.U.lookup(this.eventHandlers,t+"");i?i(e.slice(4)):h("unhandled event: "+t.toString(16))},o.onError=e=>{h("recv error: "+e.message),this.autoReconnect&&(this.autoReconnect=!1,this.reconnectAsync().then(()=>{this.autoReconnect=!0},e=>{h("reconnect error: "+e.message)}))},this.onEvent(u.HF2_EV_JDS_PACKET,e=>{this.onCustomEvent(u.CUSTOM_EV_JACDAC,e)})}resetState(){this.initialized=!1,this.lock=new c.U.PromiseQueue,this.info=null,this.infoRaw=null,this.pageSize=null,this.flashSize=null,this.maxMsgSize=63,this.bootloaderMode=!1,this.msgs.drain()}onEvent(e,t){c.U.assert(!!(e&u.HF2_EV_MASK)),this.eventHandlers[e+""]=t}sendCustomEventAsync(e,t){return e==u.CUSTOM_EV_JACDAC?this.jacdacAvailable?this.talkAsync(u.HF2_CMD_JDS_SEND,t).then(()=>{}):Promise.resolve():Promise.reject(new Error("invalid custom event type"))}isConnected(){return this.io.isConnected()&&this.initialized}isConnecting(){return this.io.isConnecting()||this.io.isConnected()&&!this.initialized}reconnectAsync(){return this.resetState(),h("reconnect raw="+this.rawMode),this.io.reconnectAsync().then(()=>this.initAsync()).catch(e=>{if(this.reconnectTries<5)return this.reconnectTries++,h(`error ${e.message}; reconnecting attempt #`+this.reconnectTries),c.U.delay(500).then(()=>this.reconnectAsync());throw e})}disconnectAsync(){return h("disconnect"),this.io.disconnectAsync()}error(e){return this.io.error(e)}talkAsync(e,t){if(this.io.talksAsync)return this.io.talksAsync([{cmd:e,data:t}]).then(e=>e[0]);let i=8;t&&(i+=t.length);var r=new Uint8Array(i);let n=65535&++this.cmdSeq,a=(o(r,0,e),l(r,4,n),l(r,6,0),t&&c.U.memcpy(r,8,t,0,t.length),0),s=()=>this.msgs.shiftAsync(1e3).then(e=>{if(d(e,0)!=n){if(a<3)return a++,h(`message out of sync, (${n} vs ${d(e,0)}); will re-try`),s();this.error("out of sync")}let t="";switch(e[3]&&(t="; info="+e[3]),e[2]){case u.HF2_STATUS_OK:return e.slice(4);case u.HF2_STATUS_INVALID_CMD:this.error("invalid command"+t);break;case u.HF2_STATUS_EXEC_ERR:this.error("execution error"+t);break;default:this.error("error "+e[2]+t)}return null});return this.sendMsgAsync(r).then(s)}sendMsgAsync(e){return this.sendMsgCoreAsync(e)}sendSerialAsync(e,t=!1){return this.io.sendSerialAsync?this.io.sendSerialAsync(e,t):this.sendMsgCoreAsync(e,t?2:1)}sendMsgCoreAsync(r,e=0){let n=new Uint8Array(64),a=t=>{let i=r.length-t;if(i<=0)return Promise.resolve();63<i?(i=63,n[0]=u.HF2_FLAG_CMDPKT_BODY):n[0]=u.HF2_FLAG_CMDPKT_LAST,e&&(n[0]=1==e?u.HF2_FLAG_SERIAL_OUT:u.HF2_FLAG_SERIAL_ERR),n[0]|=i;for(let e=0;e<i;++e)n[e+1]=r[t+e];return this.io.sendPacketAsync(n).then(()=>a(t+i))};return this.lock.enqueue("out",()=>a(0))}switchToBootloaderAsync(){return this.bootloaderMode?Promise.resolve():(h("Switching into bootloader mode"),this.io.isSwitchingToBootloader&&this.io.isSwitchingToBootloader(),this.maybeReconnectAsync().then(()=>this.talkAsync(u.HF2_CMD_START_FLASH).then(()=>{},e=>this.talkAsync(u.HF2_CMD_RESET_INTO_BOOTLOADER).then(()=>{},e=>{}).then(()=>this.reconnectAsync().catch(e=>{throw"devicenotfound"===e.type&&(e.type="repairbootloader"),e})))).then(()=>this.initAsync()).then(()=>{this.bootloaderMode||this.error("cannot switch into bootloader mode")}))}isFlashing(){return!!this.flashing}reflashAsync(e){h("reflash"),c.U.assert(c.appTarget.compile.useUF2);e=e.outfiles[pxtc.BINARY_UF2];let t=pxtc.UF2.parseFile(c.Util.stringToUint8Array(atob(e)));return this.flashing=!0,this.io.reconnectAsync().then(()=>this.flashAsync(t)).then(()=>c.U.delay(100)).finally(()=>this.flashing=!1).then(()=>this.reconnectAsync())}writeWordsAsync(e,t){return c.U.assert(t.length<=64),this.talkAsync(u.HF2_CMD_WRITE_WORDS,i([e,t.length].concat(t))).then(()=>{})}readWordsAsync(e,t){var i=new Uint8Array(8);return o(i,0,e),o(i,4,t),c.U.assert(t<=64),this.talkAsync(u.HF2_CMD_READ_WORDS,i)}pingAsync(){return this.rawMode?Promise.resolve():this.talkAsync(u.HF2_CMD_BININFO).then(e=>{})}maybeReconnectAsync(){return this.pingAsync().catch(e=>this.reconnectAsync().then(()=>this.pingAsync()))}flashAsync(r){let i=Date.now(),n=0,a=e=>{var t,i;return e>=r.length?Promise.resolve():(t=r[e],o(i=new Uint8Array(4+t.payloadSize),0,t.targetAddr),c.U.memcpy(i,4,t.data,0,t.payloadSize),this.talkAsync(u.HF2_CMD_WRITE_FLASH_PAGE,i).then(()=>a(e+1)))};return this.switchToBootloaderAsync().then(()=>{var e=256*r.length;return h(`Starting flash (${Math.round(e/1024)}kB).`),n=Date.now(),16384<this.pageSize?r:s(r,(e,t)=>this.readWordsAsync(e,t))}).then(e=>{e.length!=r.length&&(e=256*(r=e).length,h(`Performing partial flash (${Math.round(e/1024)}kB).`))}).then(()=>a(0)).then(()=>{var e=Date.now(),t=e-i,e=e-n;h(`Flashing done at ${Math.round(256*r.length/e*1e3/1024)} kB/s in ${t}ms (reset ${t-e}ms). Resetting.`)}).then(()=>this.talkAsync(u.HF2_CMD_RESET_INTO_APP).catch(e=>{})).then(()=>{})}initAsync(){return this.rawMode?(this.initialized=!0,Promise.resolve()):Promise.resolve().then(()=>this.talkAsync(u.HF2_CMD_BININFO)).then(e=>(this.bootloaderMode=e[0]==u.HF2_MODE_BOOTLOADER,this.pageSize=a(e,4),this.flashSize=a(e,8)*this.pageSize,this.maxMsgSize=a(e,12),this.familyID=a(e,16),h(`Connected; msgSize ${this.maxMsgSize}B; flash ${this.flashSize/1024}kB; ${this.bootloaderMode?"bootloader":"application"} mode; family=0x`+this.familyID.toString(16)),this.talkAsync(u.HF2_CMD_INFO))).then(e=>{this.infoRaw=c.Util.fromUTF8Array(e),c.debug("Info: "+this.infoRaw);let r={};("Header: "+this.infoRaw).replace(/^([\w\-]+):\s*([^\n\r]*)/gm,(e,t,i)=>(r[t.replace(/-/g,"")]=i,"")),this.info=r;e=/v(\d\S+)(\s+(\S+))?/.exec(this.info.Header);this.info.Parsed=e?{Version:e[1],Features:e[3]||""}:{Version:"?",Features:""},h(`Board-ID: ${this.info.BoardID} v${this.info.Parsed.Version} f`+this.info.Parsed.Features)}).then(()=>this.talkAsync(u.HF2_CMD_JDS_CONFIG,new Uint8Array([1])).then(()=>{this.jacdacAvailable=!0},e=>{this.jacdacAvailable=!1})).then(()=>{this.reconnectTries=0,this.initialized=!0,this.io.onConnectionChanged()})}}function s(r,e){if(!c.appTarget.compile.flashChecksumAddr)return Promise.resolve(r);var i,t=pxtc.UF2.readBytes(r,c.appTarget.compile.flashChecksumAddr,48);let n=pxtc.parseChecksumBlock(t);return n?(i=e,(c.appTarget.compile.flashChecksumAddr?i(c.appTarget.compile.flashChecksumAddr,12).then(e=>{let t=pxtc.parseChecksumBlock(e);return t?i(t.endMarkerPos,1).then(e=>a(e,0)!=t.endMarker?(c.log("end-marker mismatch"),null):t):null}):Promise.resolve(null)).then(e=>{if(!e)return r;let i=e.regions.filter(t=>n.regions.some(e=>t.checksum==e.checksum&&t.length==e.length&&t.start==e.start));if(0==i.length)return r;h("skipping flash at: "+i.map(e=>`${pxtc.assembler.tohex(e.start)} (${e.length/1024}kB)`).join(", "));let t=t=>i.some(e=>e.start<=t&&t<e.start+e.length);return r.filter(e=>!(t(e.targetAddr)&&t(e.targetAddr+e.payloadSize-1)))})):Promise.resolve(r)}u.Wrapper=r,u.mkHF2PacketIOWrapper=function(e){return c.debug("packetio: wrapper hf2"),new r(e)},u.onlyChangedBlocksAsync=s}})(pxt=pxt||{}),(u=>{{var m=u.HWDBG||(u.HWDBG={}),g=u.Util,v=u.HF2;let e=1409050336,t=665147697,i=1888490768,r=v.read32,a=!1,h,n,s,o,p,f,l,c;function b(e){return 1&e?e>>1:0!=e?2&e?e==m.taggedNull?null:e!=m.taggedFalse&&(e==m.taggedTrue||{tagged:e>>2}):{ptr:e}:void 0}function d(e,t){var i;if(g.assert(!(3&e)),g.assert(0<=e),e<2097152)return i=new Uint8Array(t),e-=l.start,g.memcpy(i,0,l.buf,e,t),Promise.resolve(i);var r=c.maxMsgSize-32;if(r<t){for(var n=[];0<t;){var a=Math.min(r,t);n.push(d(e,a)),t-=a,e+=a}return Promise.all(n).then(g.uint8ArrayConcat)}return c.readWordsAsync(e,Math.ceil(t/4)).then(e=>e.length>t?e.slice(0,t):e)}function y(r){if("object"!=typeof r||!r)return Promise.resolve(r);if("number"!=typeof r.ptr)return Promise.resolve(r);{if(3&r.ptr)return Promise.resolve({unalignedPtr:r.ptr});let i=0;return d(r.ptr,56).then(t=>{i=v.read16(t,2);let e=t.length;return i==u.BuiltInType.BoxedString||i==u.BuiltInType.BoxedBuffer?e=v.read16(t,4)+6:i==u.BuiltInType.BoxedNumber&&(e=12),e>t.length?d(r.ptr+t.length,e-t.length).then(e=>g.uint8ArrayConcat([t,e])):e<t.length?t.slice(0,e):t}).then(e=>i==u.BuiltInType.BoxedString?g.uint8ArrayToString(e.slice(6)):i==u.BuiltInType.BoxedBuffer?{type:"buffer",data:e.slice(6)}:i==u.BuiltInType.BoxedNumber?new Float64Array(e.buffer.slice(4))[0]:{type:"unknown",tag:i,refcnt:v.read16(e,0),data:e.slice(4)})}}function w(i){var e=[];for(let t of Object.keys(i))e.push(y(i[t]).then(e=>{i[t]=e}));return Promise.all(e).then(()=>{})}function A(e){var t,i=h.breakpoints;let r=i[0],n=1/0;for(t of i){var a=e-t.binAddr;0<=a&&a<n&&(n=a,r=t)}return r}function k(t){if(a)return Promise.resolve();a=!0;let d;return C().then(r=>{var e=v.decodeU32LE(t)[0],n={};for(let i of h.procDebugInfo[0].locals){let e=r.globals;let t=(()=>{switch(i.type){case"uint32":return v.read32(e,i.index);case"int32":return 0|v.read32(e,i.index);case"uint16":return v.read16(e,i.index);case"int16":return v.read16(e,i.index)<<16>>16;case"uint8":return e[i.index];case"int8":return e[i.index]<<24>>24;default:return null}})();null===t&&(g.assert(0==(3&i.index)),t=b(v.read32(e,i.index))),n[i.name]=t}return p=A(e),d={type:"debugger",subtype:"breakpoint",breakpointId:p.id,globals:n,stackframes:[]},s(),c.talkAsync(i)}).then(e=>{{var n=v.decodeU32LE(e),a=d;let t=p.binAddr,i=0,r=h.procDebugInfo.filter(e=>e.codeStartLoc<=t&&t<=e.codeEndLoc)[0];for(;;){if(!r)break;if(r==h.procDebugInfo[0])break;var s,o=A(t),l=g.clone(o),c=(l.functionName=r.name,l.argumentNames=r.args&&r.args.map(e=>e.name),a.stackframes.push({locals:{},funcInfo:l,breakpointId:o.id}),a.stackframes[a.stackframes.length-1]);let e=0;for(s of r.locals)g.assert(s.index==e++),c.locals[s.name]=b(n[i++]);t=2147483646&n[i++];var u,l=f[t+""];for(u of r.args)c.locals[u.name]=b(n[i+(r.args.length-1-u.index)]);if(!l)break;r=l.from,i+=l.stack-r.localsMark}}e=[d.globals].concat(d.stackframes.map(e=>e.locals));return g.promiseMapAll(e,w)}).then(()=>m.postMessage(d))}function T(){a=!1,n=new Promise((e,t)=>{s=e})}function E(e=!1){return Promise.resolve().then(()=>c.talkAsync(t,v.encodeU32LE([e?1:3]))).then(T)}function x(){return n=n||Promise.resolve()}function C(){return(o?Promise.resolve(o):c.talkAsync(e).then(e=>o={numGlobals:r(e,0),globalsPtr:r(e,4)})).then(e=>c.readWordsAsync(e.globalsPtr,e.numGlobals)).then(e=>({staticState:o,globals:e}))}m.taggedUndefined=0,m.taggedNull=6,m.taggedFalse=10,m.taggedTrue=66,m.postMessage=e=>u.log(e),m.decodeValue=b,m.heapExpandAsync=y,m.heapExpandMapAsync=w,m.startDebugAsync=function(n,e){return(c=e).onEvent(915601917,k),a=!1,h=null,o=null,Promise.resolve().then(()=>{h=n,f={};var e,t,i=[];for(e of n.procDebugInfo)i[e.idx]=e;for(t of n.procDebugInfo)for(var r of t.calls)f[r.addr+""]={from:t,to:i[r.procIndex],stack:r.stack}}).then(()=>{var e=h.outfiles[pxtc.BINARY_UF2],e=g.stringToUint8Array(atob(e));return l=pxtc.UF2.toBin(e),c.reflashAsync(h).then(()=>c.reconnectAsync())}).then(()=>c.talkAsync(287358355).catch(e=>{})).then(()=>g.delay(200)).then(()=>c.reconnectAsync()).then(T).then(x)},m.handleMessage=function(t){if(u.log("HWDBGMSG",t),"debugger"==t.type){let e=!1;switch(t.subtype){case"stepinto":e=!0;case"stepover":E(e)}}},m.resumeAsync=E,m.waitForHaltAsync=x,m.getHwStateAsync=C}})(pxt=pxt||{}),(f=>{class e{logTime(){var e;this.start&&(e=Date.now()-this.start,f.debug("Icon creation: "+e+"ms"))}convert(e){this.start||(this.start=Date.now());let t=atob(e.slice(e.indexOf(",")+1)),i=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2);return 135===i&&(i=224|t.charCodeAt(1),r=t.charCodeAt(2)|t.charCodeAt(3)<<8,n=t.charCodeAt(4)|t.charCodeAt(5)<<8,t=t.slice(4)),225!=i&&228!=i?null:(this.palette||this.setPalette(f.appTarget.runtime.palette.map(function(e){return[(e=parseInt(e.replace(/#/,""),16))>>0&255,e>>8&255,e>>16&255,255]})),225==i?this.genMonochrome(t,r,n):(e=(f.BrowserUtils.isEdge()||f.BrowserUtils.isIE())&&r<100&&n<100?3:1,this.genColor(t,r,n,e)))}setPalette(t){t[0][3]=0,this.palette=new Uint8Array(4*t.length);for(let e=0;e<t.length;++e)this.palette[4*e+0]=t[e][0],this.palette[4*e+1]=t[e][1],this.palette[4*e+2]=t[e][2],this.palette[4*e+3]=t[e][3]}genMonochrome(t,i,r){var n=i+3&-4,a=54+this.palette.length,e=a+n*r,s=new Uint8Array(e);s[0]=66,s[1]=77,f.HF2.write32(s,2,e),f.HF2.write32(s,10,a),f.HF2.write32(s,14,40),f.HF2.write32(s,18,i),f.HF2.write32(s,22,-r),f.HF2.write16(s,26,1),f.HF2.write16(s,28,8),f.HF2.write32(s,38,2835),f.HF2.write32(s,42,2835),f.HF2.write32(s,46,this.palette.length>>2),s.set(this.palette,54);let o=4,l=a,c=1,u=t.charCodeAt(o++);for(let e=0;e<i;++e){l=a+e;for(let e=0;e<r;++e)s[l]=u&c?1:0,l+=n,256==(c<<=1)&&(c=1,u=t.charCodeAt(o++))}return"data:image/bmp;base64,"+btoa(f.U.uint8ArrayToString(s))}genColor(n,e,a,s){var t=e*(s=Math.max(1,0|s)),o=a*s,l=t<<2,e=138+l*o,c=new Uint8Array(e);c[0]=66,c[1]=77,f.HF2.write32(c,2,e),f.HF2.write32(c,10,138),f.HF2.write32(c,14,124),f.HF2.write32(c,18,t),f.HF2.write32(c,22,-o),f.HF2.write16(c,26,1),f.HF2.write16(c,28,32),f.HF2.write16(c,30,3),f.HF2.write32(c,38,2835),f.HF2.write32(c,42,2835),f.HF2.write32(c,54,16711680),f.HF2.write32(c,58,65280),f.HF2.write32(c,62,255),f.HF2.write32(c,66,4278190080),c[70]=66,c[71]=71,c[72]=82,c[73]=115;let u=4,d=138,h=!0;for(let e=0;e<t;e++){let t=!1;d=138+(e<<2);var p=u;let i=n.charCodeAt(u++),r=t?(i>>4&15)<<2:(15&i)<<2;for(let e=0;e<o;e++)i&&(h=!1),c[d]=this.palette[r],c[d+1]=this.palette[r+1],c[d+2]=this.palette[r+2],c[d+3]=this.palette[r+3],d+=l,e%s==s-1&&(t&&(i=n.charCodeAt(u++)),t=!t,r=t?(i>>4&15)<<2:(15&i)<<2);if(h&&(c[141]=1),e%s==s-1)for(a%2||--u;3&u;)u++;else u=p}return"data:image/bmp;base64,"+btoa(f.U.uint8ArrayToString(c))}}f.ImageConverter=e,f.convertUint8BufferToPngUri=function(t,e){var i=new f.ImageConverter,r=[];for(let e=0;e<16;e++)r.push([t[3*e+2],t[3*e+1],t[3*e+0],255]);return i.setPalette(r),e=String.fromCharCode.apply(null,e),e="data:image/x-mkcd-f4;base64,"+btoa(e),i.convert(e)}})(pxt=pxt||{}),(o=>{var e;function l(){let t={"tsconfig.json":e.TS_CONFIG,"test.ts":`// ${lf("tests go here; this will not be compiled when this package is used as an extension.")}
`,"_config.yml":`makecode:
  target: @TARGET@
  platform: @PLATFORM@
  home_url: @HOMEURL@
theme: jekyll-theme-slate
include:
  - assets
  - README.md
`,Makefile:`all: deploy

build:
	pxt build

deploy:
	pxt deploy

test:
	pxt test
`,Gemfile:`source 'https://rubygems.org'
gem 'github-pages', group: :jekyll_plugins`,"README.md":`
> ${lf("Open this page at {0}","[https://@REPOOWNER@.github.io/@REPONAME@/](https://@REPOOWNER@.github.io/@REPONAME@/)")}

## ${lf("Use as Extension")}

${lf("This repository can be added as an **extension** in MakeCode.")}

* ${lf("open [@HOMEURL@](@HOMEURL@)")}
* ${lf("click on **New Project**")}
* ${lf("click on **Extensions** under the gearwheel menu")}
* ${lf("search for **https://github.com/@REPO@** and import")}

## ${lf("Edit this project")}

${lf("To edit this repository in MakeCode.")}

* ${lf("open [@HOMEURL@](@HOMEURL@)")}
* ${lf("click on **Import** then click on **Import URL**")}
* ${lf("paste **https://github.com/@REPO@** and click import")}

#### ${lf("Metadata (used for search, rendering)")}

* for PXT/@TARGET@
<script src="https://makecode.com/gh-pages-embed.js"></script><script>makeCodeRender("{{ site.makecode.home_url }}", "{{ site.github.owner_name }}/{{ site.github.repository_name }}");</script>
`,".gitignore":`# MakeCode
built
node_modules
yotta_modules
yotta_targets
pxt_modules
.pxt
_site
*.db
*.tgz
.header.json
.simstate.json
`,".vscode/settings.json":`{
    "editor.formatOnType": true,
    "files.autoSave": "afterDelay",
    "files.watcherExclude": {
        "**/.git/objects/**": true,
        "**/built/**": true,
        "**/node_modules/**": true,
        "**/yotta_modules/**": true,
        "**/yotta_targets": true,
        "**/pxt_modules/**": true,
        "**/.pxt/**": true
    },
    "files.associations": {
        "*.blocks": "html",
        "*.jres": "json"
    },
    "search.exclude": {
        "**/built": true,
        "**/node_modules": true,
        "**/yotta_modules": true,
        "**/yotta_targets": true,
        "**/pxt_modules": true,
        "**/.pxt": true
    },
    "files.exclude": {
        "**/pxt_modules": true,
        "**/.pxt": true
    }
}`,".vscode/extensions.json":`{
    "recommendations": ["ms-edu.pxt-vscode-web"]
}`},i=r();return i&&Object.keys(i).forEach(e=>t[e]=i[e]),t}function r(){var e=o.appTarget.bundledpkgs[o.template.TEMPLATE_PRJ];if(e)return delete(e=o.Util.clone(e))[o.CONFIG_NAME],e}(e=o.template||(o.template={})).TS_CONFIG=`{
    "compilerOptions": {
        "target": "ES5",
        "noImplicitAny": true,
        "outDir": "built",
        "rootDir": "."
    },
    "exclude": ["pxt_modules/**/*test.ts"]
}
`,e.defaultFiles=l,e.targetTemplateFiles=r,e.TEMPLATE_PRJ="template",e.packageFiles=function(e){var t,i,r=o.appTarget.blocksprj||o.appTarget.tsprj,n=o.U.clone(r.config),a=(delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths,n.preferredEditor=n.files.find(e=>/\.blocks$/.test(e))?o.BLOCKS_PROJECT_NAME:o.JAVASCRIPT_PROJECT_NAME,n.name=e,n.public=!0,n.version||(n.version="0.0.0"),{}),s=l();for(t in s)a[t]=s[t];for(i in r.files)"README.md"!=i&&(a[i]=r.files[i]);return e=Object.keys(a).filter(e=>/\.(blocks|md|ts|asm|cpp|h|py)$/.test(e)),n.files=e.filter(e=>!/test/.test(e)),n.testFiles=e.filter(e=>/test/.test(e)),n.supportedTargets=[o.appTarget.id],a[o.CONFIG_NAME]=o.Package.stringifyConfig(n),a},e.packageFilesFixup=function(i,e){let r=JSON.parse(i[o.CONFIG_NAME]);e&&o.Util.jsonMergeFrom(r,e),o.webConfig&&(Object.keys(o.webConfig).forEach(e=>r[e.toLowerCase()]=o.webConfig[e]),r.platform=o.appTarget.platformid||o.appTarget.id,r.target=o.appTarget.id,r.docs=o.appTarget.appTheme.homeUrl||"./",r.homeurl=o.appTarget.appTheme.homeUrl||"???"),o.U.iterMap(i,(e,t)=>{t=t.replace(/@([A-Z]+)@/g,(e,t)=>r[t.toLowerCase()]||""),i[e]=t})}})(pxt=pxt||{}),(k=>{var e,i;{var r=k.blocks||(k.blocks={});let w;(e=w=r.NT||(r.NT={}))[e.Prefix=0]="Prefix",e[e.Postfix=1]="Postfix",e[e.Infix=2]="Infix",e[e.Block=3]="Block",e[e.NewLine=4]="NewLine";let A,t=((e=A=r.GlueMode||(r.GlueMode={}))[e.None=0]="None",e[e.WithSpace=1]="WithSpace",e[e.NoSpace=2]="NoSpace",["break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with"]);function n(e){return"`"+e.replace(/[\\`${}]/g,e=>"\\"+e)+"`"}function a(e){return 20<e.length&&/\n/.test(e)?n(e):JSON.stringify(e)}function s(e,t,i){return{type:e,op:t,children:i}}function l(){return s(w.NewLine,"",[])}function c(e,t){return s(w.Prefix,e,t)}function u(e,t,i){return s(w.Infix,t,null==e?[i]:[e,i])}function T(e){return c(e,[])}function d(e){return s(w.Block,"",e)}function E(e){return c("",e)}function h(e,t=!1){var i,r=[];for(i of e)t?(0<r.length&&r.push(T(",")),r.push(l())):0<r.length&&r.push(T(", ")),r.push(i);return t&&r.push(l()),E(r)}function p(e,t,i=!1,r=!1){return E(r?[u(t[0],".",T(e)),T("("),h(t.slice(1),i),T(")")]:[T(e),T("("),h(t,i),T(")")])}function f(e,t,i,r){return p(e+"."+t,i,r)}function m(e,t){return k.U.assert(2==t.length),u(t[0],e,t[1])}r.backtickLit=n,r.stringLit=a,r.mkNode=s,r.mkNewLine=l,r.mkPrefix=c,r.mkPostfix=function(e,t){return s(w.Postfix,t,e)},r.mkInfix=u,r.mkText=T,r.mkBlock=d,r.mkGroup=E,r.mkStmt=function(...e){var t=e[e.length-1];return t&&t.type==w.Block||e.push(l()),E(e)},r.mkCommaSep=h,(i=e=r.Helpers||(r.Helpers={})).mkArrayLiteral=function(e,t){return E([T("["),h(e,t),T("]")])},i.mkNumberLiteral=function(e){return T(e.toString())},i.mkBooleanLiteral=function(e){return T(e?"true":"false")},i.mkStringLiteral=function(e){return T(a(e))},i.mkPropertyAccess=function(e,t){return E([u(t,".",T(e))])},i.mkCall=p,i.stdCall=function(e,t,i){return p(e,t,i)},i.extensionCall=function(e,t,i){return p(e,t,i,!0)},i.namespaceCall=f,i.mathCall=function(e,t){return f("Math",e,t,!1)},i.mkGlobalRef=T,i.mkSimpleCall=m,i.mkWhile=function(e,t){return E([T("while ("),e,T(")"),d(t)])},i.mkComment=function(e){return T("// "+e)},i.mkMultiComment=function(e){let r=[T("/**"),l()];return e.split("\n").forEach((e,t,i)=>{e&&(r.push(T(" * "+e)),r.push(l()),t<i.length-1)&&(r.push(T(" * ")),r.push(l()))}),E(r.concat([T(" */"),l()]))},i.mkAssign=function(e,t){return m("=",[e,t])},i.mkParenthesizedExpression=function(e){return v(g([e]).output)?e:E([T("("),e,T(")")])},r.H=e;let o={"=":3,"+=":3,"-=":3,"?":4,":":4,"||":5,"&&":6,"|":7,"^":8,"&":9,"==":10,"!=":10,"===":10,"!==":10,"<":11,">":11,"<=":11,">=":11,">>":12,">>>":12,"<<":12,"+":13,"-":13,"*":14,"/":14,"%":14,"**":15,"!":16,"~":16,"P-":16,"P+":16,"++":16,"--":16,".":18};function g(e){let u=[],d={},h="",p="",f=[{}],m=0;function g(e){"string"==typeof e&&(m+=(e.match(/\n/g)||[]).length),h+=e}e=E(e);return function e(i,r){if(i.type!=w.Infix)for(var t of i.children)e(t,-1);else{let t=[];var n,a=k.U.lookup(o,i.op);function s(e){"P"==e[0]&&(e=e.slice(1)),t.push(T(e))}null==a&&k.U.oops("bad infix op: "+i.op),a<r&&s("("),1==i.children.length?(s(i.op),e(i.children[0],a),t.push(i.children[0])):(n=3!=a&&"**"!=i.op,e(i.children[0],n?a:a+.1),t.push(i.children[0]),"."==i.op?s("."):s(" "+i.op+" "),e(i.children[1],n?a+.1:a),t.push(i.children[1])),a<r&&s(")"),i.type=w.Prefix,i.op="",i.children=t}}(e,-1),v(e),h||g("\n"),{output:h,sourceMap:u};function v(e){e.glueToBlock&&(y(),e.glueToBlock==A.WithSpace)&&g(" ");var t=m,i=h.length;switch(e.type){case w.Infix:k.U.oops("no infix should be left");break;case w.NewLine:g("\n"+p);break;case w.Block:var r=e,n=r.noFinalNewline?"":"\n";if(0==r.children.length)b(" {\n\t\n}"+n);else{var a,s=k.U.clone(f[f.length-1]||{});f.push(s),p+="    "," "!=h[h.length-1]&&b(" "),b("{\n");for(a of r.children)v(a);p=p.slice(4),y(),b("\n}"+n),f.pop()}break;case w.Prefix:e.canIndentInside?g(e.op.replace(/\n/g,"\n"+p+"    ")):g(e.op),e.children.forEach(v);break;case w.Postfix:e.children.forEach(v),e.canIndentInside?g(e.op.replace(/\n/g,"\n"+p+"    ")):g(e.op)}var o,l=m,c=Math.max(h.length,1);e.id&&(d[e.id]?((o=d[e.id]).startLine=Math.min(o.startLine,t),o.endLine=Math.max(o.endLine,l),o.startPos=Math.min(o.startPos,i),o.endPos=Math.max(o.endPos,c)):(o={id:e.id,startLine:t,startPos:i,endLine:l,endPos:c},d[e.id]=o,u.push(o)))}function b(e){g(e.replace(/\n/g,"\n"+p))}function y(){h=h.replace(/\n *$/,function(){return m--,""})}}function v(i){if("("===i[0]&&")"===i[i.length-1]){let t=1;for(let e=1;e<i.length;e++){var r=i[e];if("("===r)t++;else if(")"===r&&0===--t)return e===i.length-1}}return!1}r.flattenNode=g,r.isReservedWord=function(e){return-1!==t.indexOf(e)},r.isParenthesized=v}})(pxt=pxt||{}),(c=>{var n;{var a=n=c.sprite||(c.sprite={});let s=[".","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];a.BLOCKLY_TILESET_TYPE="BLOCKLY_TILESET_TYPE",a.TILE_PREFIX="tile",a.TILE_NAMESPACE="myTiles",a.IMAGES_NAMESPACE="myImages",a.IMAGE_PREFIX="image",a.ANIMATION_NAMESPACE="myAnimations",a.ANIMATION_PREFIX="anim",a.SONG_NAMESPACE="mySongs",a.JSON_NAMESPACE="myFiles",a.SONG_PREFIX="song",a.JSON_PREFIX="file";class E{constructor(e,t,i=0,r=0,n){this.width=e,this.height=t,this.x0=i,this.y0=r,this.width||(this.width=16),this.height||(this.height=16),this.buf=n||new Uint8ClampedArray(this.dataLength())}static fromData(e){return new E(e.width,e.height,e.x0,e.y0,e.data)}set(e,t,i){e<this.width&&t<this.height&&0<=e&&0<=t&&(e=this.coordToIndex(e,t),this.setCore(e,i))}get(e,t){return e<this.width&&t<this.height&&0<=e&&0<=t?(e=this.coordToIndex(e,t),this.getCore(e)):0}copy(i=0,r=0,e=this.width,n=this.height){var a=new E(e,n);a.x0=i,a.y0=r;for(let t=0;t<e;t++)for(let e=0;e<n;e++)a.set(t,e,this.get(i+t,r+e));return a}apply(i,r=!1){var n;for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++)!(n=i.get(t,e))&&r||this.set(i.x0+t,i.y0+e,n)}equals(t){if(this.width!==t.width||this.height!==t.height||this.x0!==t.x0||this.y0!==t.y0||this.buf.length!==t.buf.length)return!1;for(let e=0;e<this.buf.length;e++)if(this.buf[e]!==t.buf[e])return!1;return!0}data(){return{width:this.width,height:this.height,x0:this.x0,y0:this.y0,data:this.buf}}resize(e,t){return u(this,e,t)}coordToIndex(e,t){return e+t*this.width}getCore(e){var t=Math.floor(e/2);return e%2==0?15&this.buf[t]:(240&this.buf[t])>>4}setCore(e,t){var i=Math.floor(e/2);this.buf[i]=e%2==0?240&this.buf[i]|15&t:15&this.buf[i]|(15&t)<<4}dataLength(){return Math.ceil(this.width*this.height/2)}}a.Bitmap=E;class x extends E{static fromData(e){return new x(e.width,e.height,e.x0,e.y0,e.data)}copy(i=0,r=0,e=this.width,n=this.height){var a=new x(e,n);a.x0=i,a.y0=r;for(let t=0;t<e;t++)for(let e=0;e<n;e++)a.set(t,e,this.get(i+t,r+e));return a}resize(e,t){return d(this,e,t)}getCore(e){return this.buf[e]}setCore(e,t){this.buf[e]=t}dataLength(){return this.width*this.height}}a.Tilemap=x;class C{constructor(e,t,i){this.tilemap=e,this.tileset=t,this.layers=i,this.nextId=0}cloneData(e=!1){var t=this.tilemap.copy(),i={tileWidth:this.tileset.tileWidth,tiles:this.tileset.tiles.map(e=>Object.assign(Object.assign({},e),{bitmap:E.fromData(e.bitmap).copy().data()}))},r=E.fromData(this.layers).copy().data(),t=new C(t,i,r);return e&&(t.nextId=this.nextId,t.projectReferences=null==(i=this.projectReferences)?void 0:i.slice(),t.tileOrder=null==(r=this.tileOrder)?void 0:r.slice(),t.editedTiles=null==(e=this.editedTiles)?void 0:e.slice(),t.deletedTiles=null==(i=this.deletedTiles)?void 0:i.slice()),t}equals(e){return this.tilemap.equals(e.tilemap)&&v(this.tileset,e.tileset)&&g(this.layers,e.layers)}}function i(e){return t(atob(e.slice(e.indexOf(",")+1)))}function t(n){let e=n.charCodeAt(0),a=n.charCodeAt(1),s=n.charCodeAt(2);135===e&&(e=224|n.charCodeAt(1),a=n.charCodeAt(2)|n.charCodeAt(3)<<8,s=n.charCodeAt(4)|n.charCodeAt(5)<<8,n=n.slice(4));var o=new c.sprite.Bitmap(a,s);let l=4;if(225===e){let i=1,r=n.charCodeAt(l++);for(let t=0;t<a;++t)for(let e=0;e<s;++e)o.set(t,e,r&i?1:0),256==(i<<=1)&&(i=1,r=n.charCodeAt(l++))}else for(let t=0;t<a;t++){for(let e=0;e<s;e+=2){var i=n.charCodeAt(l++);o.set(t,e,15&i),e!=s-1&&o.set(t,e+1,i>>4&15)}for(;3&l;)l++}return o}function o(e,t){!(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:hex)/g,"").trim()).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n"))&&t&&(e=t);var t=parseInt(e.substr(0,2),16)|parseInt(e.substr(2,2),16)<<8,i=parseInt(e.substr(4,2),16)|parseInt(e.substr(6,2),16)<<8,e=w(e.substring(8));return x.fromData({width:t,height:i,x0:0,y0:0,data:e})}function l(e){return""+r(e.width,2)+r(e.height,2)+A(e.data().data)}function r(e,t){let i=e.toString(16);var r=t<<1;for(1&i.length&&(i="0"+i);i.length<r;)i+="0";return i}function u(e,t,i){t=new E(t,i);return t.apply(e),t}function d(e,t,i){t=new x(t,i);return t.apply(e),t}function h(e,t="img"){var i=(e=(e=(e=(e=e.replace(/[ `]|(?:&#96;)|(?:&#9;)|(?:img)/g,"").trim()).replaceAll(t,"")).replace(/^["`\(\)]*/,"").replace(/["`\(\)]*$/,"")).replace(/&#10;/g,"\n")).split("\n"),r=[];let n=0;for(let e=0;e<i.length;e++){var a=i[e],s=[];for(let e=0;e<a.length;e++)switch(a[e]){case"0":case".":s.push(0);break;case"1":case"#":s.push(1);break;case"2":case"T":s.push(2);break;case"3":case"t":s.push(3);break;case"4":case"N":s.push(4);break;case"5":case"n":s.push(5);break;case"6":case"G":s.push(6);break;case"7":case"g":s.push(7);break;case"8":s.push(8);break;case"9":s.push(9);break;case"a":case"A":case"R":s.push(10);break;case"b":case"B":case"P":s.push(11);break;case"c":case"C":case"p":s.push(12);break;case"d":case"D":case"O":s.push(13);break;case"e":case"E":case"Y":s.push(14);break;case"f":case"F":case"W":s.push(15);break;default:if(!/\s/.test(a[e]))return}s.length&&(r.push(s),n=Math.max(n,s.length))}var o=r.length,l=new E(n,o);for(let t=0;t<o;t++){var c=r[t];for(let e=0;e<n;e++)e<c.length?l.set(e,t,c[e]):l.set(e,t,0)}return l}function p(e,t="img"){let i="";return i="python"===e?t+'("""':t+"`"}function f(e){let t="";return t+="python"===e?'""")':"`"}function m(i,e,t="img"){if(!i||0===i.height||0===i.width)return"";let r=p(e,t);if(i){var n=300<i.width*i.height?"":" ";for(let t=0;t<i.height;t++){r+="\n";for(let e=0;e<i.width;e++)r+=s[i.get(e,t)]+n}}return r=(r+="\n")+f(e)}function g(e,t){return e===t||!(!e&&t||!t&&e)&&c.sprite.Bitmap.fromData(e).equals(c.sprite.Bitmap.fromData(t))}function v(e,t){return e.tileWidth===t.tileWidth&&c.U.arrayEquals(e.tiles,t.tiles,c.assetEquals)}function b(e){switch(e){case 4:return"TileScale.Four";case 8:return"TileScale.Eight";case 16:return"TileScale.Sixteen";case 32:return"TileScale.ThirtyTwo";default:return Math.floor(Math.log2(e)).toString()}}function y(e){switch(e=e.replace(/\s/g,"")){case"TileScale.Four":return 4;case"TileScale.Eight":return 8;case"TileScale.Sixteen":return 16;case"TileScale.ThirtyTwo":return 32;default:return Math.pow(2,parseInt(e))}}function w(t){var i=new Uint8ClampedArray(t.length>>1);for(let e=0;e<t.length;e+=2)i[e>>1]=parseInt(t.slice(e,e+2),16);return i}function A(t){var i="0123456789abcdef";let r="";for(let e=0;e<t.length;++e)r=(r+=i[t[e]>>4])+i[15&t[e]];return r}function k(e,t,i){e[t]=255&i,e[t+1]=i>>8&255}function T(e){e=(e=>{if(e){if(6===e.length)return parseInt("0x"+e);if(7===e.length)return parseInt("0x"+e.substr(1))}return 0})(e);return[e>>16&255,e>>8&255,255&e]}a.TilemapData=C,a.Bitmask=class{constructor(e,t){this.width=e,this.height=t,this.mask=new Uint8Array(Math.ceil(e*t/8))}set(e,t){e+=this.width*t;this.mask[e>>3]|=1<<(7&e)}get(e,t){e+=this.width*t;return this.mask[e>>3]>>(7&e)&1}},a.encodeTilemap=function(e,t,i){return e?`tiles.createTilemap(${r=e.tilemap,r?`hex\`${l(r)}\``:"hex``"}, ${m(E.fromData(e.layers),t)}, [${e.tileset.tiles.map(e=>{var t=i;return t&&t[e.id]?t[e.id]:e.id})}], ${b(e.tileset.tileWidth)})`:"null";var r},a.decodeTilemap=function(e,t,i){var r,n,a,s;return(e=c.Util.htmlUnescape(e).trim()).trim()&&-1!==e.indexOf("(")?(a=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),r=(e=e.substr(a.length+1)).substr(0,e.indexOf(",")),n=(e=e.substr(r.length+1)).substr(0,e.lastIndexOf("]")+1),e=e=e.substr(n.length+1),new C(o(a),{tiles:(s=i,(a=(a=n).replace(/[\[\]]/g,""))?a.split(",").filter(e=>!!e.trim()).map(e=>{var t=e,i=s;if(0===(t=t.trim()).indexOf("img"))return e=h(t),i.createNewTile(e.data());switch(t){case"myTiles.tile0":case"myTiles.transparency16":return i.getTransparency(16);case"myTiles.transparency8":return i.getTransparency(8);case"myTiles.transparency4":return i.getTransparency(4);case"myTiles.transparency32":return i.getTransparency(32);default:return i.resolveTile(t)}}):[]),tileWidth:y(e)},h(r).data())):null},a.trimTilemapTileset=function(e){var i=e.tileset.tiles.slice(),r=e.tilemap;let n={};n[i[0].id]=!0;for(let t=0;t<r.width;t++)for(let e=0;e<r.height;e++)n[i[r.get(t,e)].id]=!0;let t=e.editedTiles||[];var a=i.filter(e=>n[e.id]||"*"===e.id.charAt(0)||-1!==t.indexOf(e.id));if(a.length!==i.length){var s=[];for(let e=0;e<i.length;e++)s.push(a.indexOf(i[e]));for(let t=0;t<r.width;t++)for(let e=0;e<r.height;e++)r.set(t,e,s[r.get(t,e)]);e.tileset.tiles=a}},a.isEmptyTilemap=function(e){var i=e.tileset.tiles,r=e.tilemap,n=i[0].id;for(let t=0;t<r.width;t++)for(let e=0;e<r.height;e++)if(i[r.get(t,e)].id!==n)return!1;return!0},a.computeAverageColor=function(i,e){var r=e.map(T),n=[0,0,0];let a=0;for(let t=0;t<i.width;t++)for(let e=0;e<i.height;e++){var s=i.get(t,e);s&&(++a,s=r[s],n[0]+=s[0],n[1]+=s[1],n[2]+=s[2])}return a?"#"+(t=>{let i="";for(let e=0;e<t.length;++e)i+=("0"+t[e].toString(16)).slice(-2);return i})(n.map(e=>Math.floor(e/a))):"#00000000"},a.getBitmap=function(e,t){return(e=e.apis.byQName[t])?i(e.attributes.jresURL):null},a.getBitmapFromJResURL=i,a.hexToBitmap=t,a.filterItems=function(e,t){let n=(t=t.filter(e=>!!e).map(e=>e.toLowerCase())).filter(e=>0!==e.indexOf("!")),a=t.filter(e=>0===e.indexOf("!")&&1<e.length).map(e=>e.substring(1));return e.filter(e=>{return r=e,n.every(t=>{let i="?"+t;return r.tags.some(e=>e===t||e===i)})&&(i=e,a.every(t=>!i.tags.some(e=>e===t)));var i,r})},a.getGalleryItems=function(e,t){r=e.apis,n=t;let i=c.Util.values(r.byQName).filter(e=>4===e.kind&&e.attributes.fixedInstance&&((e,t,i)=>t==i||!(!(e=e.byQName[t])||!e.extendsTypes)&&0<=e.extendsTypes.indexOf(i))(r,e.retType,n));var r,n;i=i.filter(e=>e.namespace!=a.TILE_NAMESPACE);{e=i;let t=new c.ImageConverter;e.forEach(e=>{e.attributes.jresURL&&!e.attributes.iconURL&&0==e.attributes.jresURL.indexOf("data:image/x-mkcd-f")&&(e.attributes.iconURL=t.convert(e.attributes.jresURL))})}return i.map(e=>{var t=(e.attributes.tags||"").split(" ").filter(e=>!!e).map(e=>c.Util.startsWith(e,"category-")?e:e.toLowerCase());return{qName:e.qName,src:e.attributes.iconURL,alt:e.qName,tags:t}})},a.base64EncodeBitmap=function(e){let i=E.fromData(e);return e=pxtc.f4EncodeImg(e.width,e.height,4,(e,t)=>i.get(e,t)),btoa(c.U.uint8ArrayToString(w(e)))},a.tilemapLiteralToTilemap=o,a.hexEncodeTilemap=l,a.formatByte=r,a.resizeBitmap=u,a.resizeTilemap=d,a.imageLiteralToBitmap=h,a.encodeAnimationString=function(e,t){var i=e.map(e=>e.data);let r=new Uint8ClampedArray(8+i[0].length*i.length),n=(k(r,0,t),k(r,2,e[0].width),k(r,4,e[0].height),k(r,6,e.length),8);return i.forEach(e=>{r.set(e,n),n+=e.length}),btoa(c.sprite.uint8ArrayToHex(r))},a.addMissingTilemapTilesAndReferences=function(e,i){var r=e.getProjectTiles(i.data.tileset.tileWidth,!0);i.data.projectReferences=[];for(let t of r.tiles)i.data.tileset.tiles.some(e=>e.id===t.id)||i.data.tileset.tiles.push(t),e.isAssetUsed(t,null,[i.id])&&i.data.projectReferences.push(t.id)},a.updateTilemapReferencesFromResult=function(i,e){var r=e.data;if(r.deletedTiles)for(var t of r.deletedTiles)i.deleteTile(t);if(r.editedTiles)for(let t of r.editedTiles){var n=r.tileset.tiles.findIndex(e=>e.id===t),a=r.tileset.tiles[n];a&&(r.tileset.tiles[n]=i.updateTile(a))}for(let e=0;e<r.tileset.tiles.length;e++){var s=r.tileset.tiles[e];s.jresData||(r.tileset.tiles[e]=i.resolveTile(s.id))}c.sprite.trimTilemapTileset(r)},a.isTilemapEmptyOrUnused=function(i,e,t){var r=n.Bitmap.fromData(i.data.layers);for(let t=0;t<i.data.tilemap.width;t++)for(let e=0;e<i.data.tilemap.height;e++)if(i.data.tilemap.get(t,e)||r.get(t,e))return!1;return!e.isAssetUsed(i,t)},a.imageLiteralFromDimensions=function(t,i,r,e){let n=p(e);var a=300<t*i?"":" ";for(let e=0;e<i;e++){n+="\n";for(let e=0;e<t;e++)n+=s[r]+a}return n=(n+="\n")+f(e)},a.bitmapToImageLiteral=m,a.bitmapEquals=g,a.tilesetEquals=v,a.tileWidthToTileScale=b,a.tileScaleToTileWidth=y,a.hexToUint8Array=w,a.uint8ArrayToHex=A,a.colorStringToRGB=T}})(pxt=pxt||{}),(s=>{var o=s.sprite||(s.sprite={});{var e=o.legacy||(o.legacy={});let a=new RegExp(`^\\s*${o.TILE_NAMESPACE}\\s*\\.\\s*${o.TILE_PREFIX}(\\d+)\\s*$`);class l{constructor(e,t,i){this.tilemap=e,this.tileset=t,this.layers=i,this.nextId=0}}e.LegacyTilemapData=l,e.decodeTilemap=function(e,t){var i,r,n;return null!=(e=null==(n=s.Util.htmlUnescape(e))?void 0:n.trim())&&e.trim()?(n=(e=(e=e.substr(e.indexOf("(")+1)).substr(0,e.lastIndexOf(")"))).substr(0,e.indexOf(",")),i=(e=e.substr(n.length+1)).substr(0,e.indexOf(",")),r=(e=e.substr(i.length+1)).substr(0,e.lastIndexOf("]")+1),e=e=e.substr(r.length+1),new l(o.tilemapLiteralToTilemap(n),{tiles:(n=(n=r).replace(/[\[\]]/g,""))?n.split(",").filter(e=>!!e.trim()).map(e=>{var t;return 0===(e=e.trim()).indexOf("img")?{data:o.imageLiteralToBitmap(e).data()}:(t=a.exec(e))?{data:null,projectId:Number(t[1])}:{data:null,qualifiedName:e}}):[],tileWidth:o.tileScaleToTileWidth(e)},o.imageLiteralToBitmap(i).data())):new l(new o.Tilemap(16,16),{tileWidth:16,tiles:[]},new o.Bitmap(16,16).data())},e.tileToBlocklyVariable=function(e){return`${e.projectId};${e.data.width};${e.data.height};`+pxtc.Util.toHex(e.data.data)},e.blocklyVariableToTile=function(e){return 4!==(e=e.split(";")).length?null:{projectId:parseInt(e[0]),data:{width:parseInt(e[1]),height:parseInt(e[2]),data:new Uint8ClampedArray(pxtc.Util.fromHex(e[3])),x0:0,y0:0}}}}})(pxt=pxt||{}),(a=>{{var e=a.storage||(a.storage={});class o{constructor(){this.items={}}removeItem(e){delete this.items[e]}getItem(e){return this.items[e]}setItem(e,t){this.items[e]=t}clear(){this.items={}}}class l{constructor(e){this.storageId=e,this.type="localstorage"}targetKey(e){return this.storageId+"/"+e}removeItem(e){window.localStorage.removeItem(this.targetKey(e))}getItem(e){return window.localStorage[this.targetKey(e)]}setItem(e,t){window.localStorage[this.targetKey(e)]=t}clear(){var t=this.targetKey(""),i=[];for(let e=0;e<window.localStorage.length;++e){var r=window.localStorage.key(e);0==r.indexOf(t)&&i.push(r)}i.forEach(e=>window.localStorage.removeItem(e))}}function s(){var e;return a.appTarget?a.appTarget.id:(e=window.pxtConfig)?e.targetId:(e=window.pxtTargetBundle)?e.id:""}e.storageId=s;let n;function i(){if(!n){var t=s();let e=!1;if(!a.shell.isSandboxMode())try{var i=a.Util.guidGen(),r=(window.localStorage[t]=i,window.localStorage[t]);e=r===i}catch(e){}e?(n=new l(t),a.debug("storage: local under "+t)):(n=new o,a.debug("storage: in memory"))}}e.setLocal=function(e,t){i(),n.setItem(e,t)},e.getLocal=function(e){return i(),n.getItem(e)},e.removeLocal=function(e){i(),n.removeItem(e)},e.clearLocal=function(){i(),n.clear()}}})(pxt=pxt||{}),(a=>{var t=a.storage||(a.storage={});{t=t.shared||(t.shared={});let e=!0,n="http://localhost:3232/api/store/";function s(){return e&&a.BrowserUtils.isLocalHostDev()&&!a.BrowserUtils.noSharedLocalStorage()}function o(){return a.BrowserUtils.isChromiumEdge()?"chromium-edge":a.BrowserUtils.browser()}t.getAsync=async function(e,t){if(s()){e+="-"+o();var i=await a.Util.requestAsync({url:n+encodeURIComponent(e)+"/"+encodeURIComponent(t),method:"GET",allowHttpErrors:!0});if(204===i.statusCode)throw new Error(`Missing ${t} not available in `+e);return i.json||i.text||void 0}return i=a.storage.getLocal(e+":"+t),a.Util.jsonTryParse(i)||i},t.setAsync=async function(t,i,r){if(void 0===r)await a.storage.shared.delAsync(t,i);else{let e="";e="object"==typeof r?JSON.stringify(r):r.toString(),s()?(t+="-"+o(),r={type:"object"==typeof r?"json":"text",val:e},r=JSON.stringify(r),await a.Util.requestAsync({url:n+encodeURIComponent(t)+"/"+encodeURIComponent(i),method:"POST",data:r})):a.storage.setLocal(t+":"+i,e)}},t.delAsync=async function(e,t){s()?(e+="-"+o(),await a.Util.requestAsync({url:n+encodeURIComponent(e)+"/"+encodeURIComponent(t),method:"DELETE",allowHttpErrors:!0})):a.storage.removeLocal(e+":"+t)}}})(pxt=pxt||{}),(pxt||(pxt={})).getSectionsFromMarkdownMetadata=function(e){var t,i,r,e=e.split(/\r?\n/);let n=[],a=null,s=null,o=null,l=[],c=0;for(t of e)if(t.trim()){if(t.startsWith("#")){var u=/^(#+)\s*(.+)$/.exec(t);if(u){d(),a={headerKind:1===u[1].length?"single":2===u[1].length?"double":"triple",header:u[2],attributes:{}},s=null,o=null,c=0;continue}}a&&(u=(t=>{let i=0;for(let e=0;e<t.length;e++)if(" "===t.charAt(e))i++;else{if("\t"!==t.charAt(e))return i;i+=4}return 0})(t),i=t.trim(),i=/^[*-]\s+(?:([^:]+):)?(.*)$/.exec(i))&&(1<Math.abs(u-c)&&s&&(u>c?(r={key:s,items:[]},l.length?l[l.length-1].items.push(r):(a.listAttributes||(a.listAttributes={}),a.listAttributes[s]=r),s=null,l.push(r)):(r=l.pop(),s&&o&&(null!=r&&r.items.push((s+":"+o).trim()),o=null)),c=u),i)&&(i[1]?(s&&o&&(l.length?l[l.length-1].items.push((s+":"+o).trim()):a.attributes[s]=o.trim()),s=i[1].trim().toLowerCase(),o=i[2]):s&&(o+=i[2]))}else o&&(o+="\n");return d(),n;function d(){a&&(s&&o&&(l.length?l[l.length-1].items.push((s+":"+o).trim()):a.attributes[s]=o.trim()),n.push(a)),l=[]}},(i=>{var r;{var n=i.multiplayer||(i.multiplayer={});let e,t=((r=e=e||{})[r.PROD=0]="PROD",r[r.STAGING=1]="STAGING",r[r.LOCAL=2]="LOCAL",e.STAGING);n.ABSOLUTE_LINKS={PROD_BETA:"https://arcade.makecode.com/beta--multiplayer",STAGING_BETA:"https://arcade.staging.pxt.io/beta--multiplayer",LOCAL:"http://localhost:3000"},n.RELATIVE_LINKS={PROD:"/--multiplayer",BETA:"/beta--multiplayer"},n.SHORT_LINKS={PROD:"https://aka.ms/a9",PROD_BETA:"https://aka.ms/a9b",STAGING:"https://aka.ms/a9s",STAGING_BETA:"https://aka.ms/a9sb"},n.RELATIVE_LINK=()=>{if(i.BrowserUtils.isLocalHostDev())switch(t){case e.PROD:return n.ABSOLUTE_LINKS.PROD_BETA;case e.STAGING:return n.ABSOLUTE_LINKS.STAGING_BETA;case e.LOCAL:return n.ABSOLUTE_LINKS.LOCAL}return window.location.pathname.startsWith("/beta")?n.RELATIVE_LINKS.BETA:n.RELATIVE_LINKS.PROD},n.SHORT_LINK=()=>{if(i.BrowserUtils.isLocalHostDev())switch(t){case e.PROD:return n.SHORT_LINKS.PROD_BETA;case e.STAGING:return n.SHORT_LINKS.STAGING_BETA;case e.LOCAL:return n.ABSOLUTE_LINKS.LOCAL}return window.location.host.endsWith(".staging.pxt.io")?window.location.pathname.startsWith("/beta")?n.SHORT_LINKS.STAGING_BETA:n.SHORT_LINKS.STAGING:window.location.pathname.startsWith("/beta")?n.SHORT_LINKS.PROD_BETA:n.SHORT_LINKS.PROD},n.makeHostLink=function(e,t){return`${t?n.SHORT_LINK():n.RELATIVE_LINK()}?host=`+encodeURIComponent(e)},n.makeJoinLink=function(e,t){return`${t?n.SHORT_LINK():n.RELATIVE_LINK()}?join=`+encodeURIComponent(e)}}})(pxt=pxt||{}),(t=>{var e;function p(e,t,i){var r=new Uint8Array(2);new Uint16Array(r.buffer)[0]=0|i,e[t]=r[0],e[t+1]=r[1]}function c(e,t){var i=new Uint8Array(2);return i[0]=e[t],i[1]=e[t+1],new Uint16Array(i.buffer)[0]}function f(t){var i=new Uint8Array(5+7*t.steps.length);i[0]=t.steps.length,p(i,1,t.startFrequency),p(i,3,t.startVolume);for(let e=0;e<t.steps.length;e++){var r=5+7*e;i[r]=t.steps[e].waveform,p(i,1+r,t.steps[e].frequency),p(i,3+r,t.steps[e].volume),p(i,5+r,t.steps[e].duration)}return i}function m(t,i,r){var n=new Uint8Array(5+t.notes.length);p(n,0,t.startTick),p(n,2,t.endTick),n[4]=t.notes.length;for(let e=0;e<t.notes.length;e++)n[5+e]=((e,t,i)=>{if(i)return e.note;let r=0;return"flat"===e.enharmonicSpelling?r=1:"sharp"===e.enharmonicSpelling&&(r=2),e.note-12*(t-2)|r<<6})(t.notes[e],i,r);return n}function s(t){if(t.drums){var i,r,n=t,a=n.drums.map(f),s=a.reduce((e,t)=>t.length+e,0),o=n.notes.map(e=>m(e,0,!0)),l=o.reduce((e,t)=>t.length+e,0),c=new Uint8Array(6+s+l);c[0]=n.id,c[1]=1,p(c,2,s);let e=4;for(i of a)c.set(i,e),e+=i.length;p(c,e,l),e+=2;for(r of o)c.set(r,e),e+=r.length;return c}{var u=t;var d,n=(e=>{var t,i=new Uint8Array(28);return i[0]=e.waveform,p(i,1,e.ampEnvelope.attack),p(i,3,e.ampEnvelope.decay),p(i,5,e.ampEnvelope.sustain),p(i,7,e.ampEnvelope.release),p(i,9,e.ampEnvelope.amplitude),p(i,11,(null==(t=e.pitchEnvelope)?void 0:t.attack)||0),p(i,13,(null==(t=e.pitchEnvelope)?void 0:t.decay)||0),p(i,15,(null==(t=e.pitchEnvelope)?void 0:t.sustain)||0),p(i,17,(null==(t=e.pitchEnvelope)?void 0:t.release)||0),p(i,19,(null==(t=e.pitchEnvelope)?void 0:t.amplitude)||0),i[21]=(null==(t=e.ampLFO)?void 0:t.frequency)||0,p(i,22,(null==(t=e.ampLFO)?void 0:t.amplitude)||0),i[24]=(null==(t=e.pitchLFO)?void 0:t.frequency)||0,p(i,25,(null==(t=e.pitchLFO)?void 0:t.amplitude)||0),i[27]=e.octave,i})(u.instrument),s=u.notes.map(e=>m(e,u.instrument.octave,!1)),a=s.reduce((e,t)=>t.length+e,0),h=new Uint8Array(6+n.length+a);h[0]=u.id,h[1]=0,p(h,2,n.length);let e=4;h.set(n,e),e+=n.length,p(h,e,a),e+=2;for(d of s)h.set(d,e),e+=d.length;return h;return}}function u(t,i,r,n){var a={startTick:c(t,i),endTick:c(t,i+2),notes:[]};for(let e=0;e<t[i+4];e++)a.notes.push(((e,t,i)=>{var r=e>>6,i={note:i?e:(63&e)+12*(t-2),enharmonicSpelling:"normal"};return 1==r?i.enharmonicSpelling="flat":2==r&&(i.enharmonicSpelling="sharp"),i})(t[i+5+e],r,n));return a}function i(e){return{ticksPerBeat:8,beatsPerMeasure:4,beatsPerMinute:120,measures:e,tracks:[{id:0,name:lf("Dog"),notes:[],iconURI:"music-editor/dog.png",instrument:{waveform:1,octave:4,ampEnvelope:{attack:10,decay:100,sustain:500,release:100,amplitude:1024},pitchLFO:{frequency:5,amplitude:0}}},{id:1,name:lf("Duck"),notes:[],iconURI:"music-editor/duck.png",instrument:{waveform:15,octave:4,ampEnvelope:{attack:5,decay:530,sustain:705,release:450,amplitude:1024},pitchEnvelope:{attack:5,decay:40,sustain:0,release:100,amplitude:40},ampLFO:{frequency:3,amplitude:20},pitchLFO:{frequency:6,amplitude:2}}},{id:2,name:lf("Cat"),notes:[],iconURI:"music-editor/cat.png",instrument:{waveform:12,octave:5,ampEnvelope:{attack:150,decay:100,sustain:365,release:400,amplitude:1024},pitchEnvelope:{attack:120,decay:300,sustain:0,release:100,amplitude:50},pitchLFO:{frequency:10,amplitude:6}}},{id:3,name:lf("Fish"),notes:[],iconURI:"music-editor/fish.png",instrument:{waveform:1,octave:3,ampEnvelope:{attack:220,decay:105,sustain:1024,release:350,amplitude:1024},ampLFO:{frequency:5,amplitude:100},pitchLFO:{frequency:1,amplitude:4}}},{id:4,name:lf("Car"),notes:[],iconURI:"music-editor/car.png",instrument:{waveform:16,octave:4,ampEnvelope:{attack:5,decay:100,sustain:1024,release:30,amplitude:1024},pitchLFO:{frequency:10,amplitude:4}}},{id:5,name:lf("Computer"),notes:[],iconURI:"music-editor/computer.png",instrument:{waveform:15,octave:2,ampEnvelope:{attack:10,decay:100,sustain:500,release:10,amplitude:1024}}},{id:6,name:lf("Burger"),notes:[],iconURI:"music-editor/burger.png",instrument:{waveform:1,octave:2,ampEnvelope:{attack:10,decay:100,sustain:500,release:100,amplitude:1024}}},{id:7,name:lf("Cherry"),notes:[],iconURI:"music-editor/cherry.png",instrument:{waveform:2,octave:3,ampEnvelope:{attack:10,decay:100,sustain:500,release:100,amplitude:1024}}},{id:8,name:lf("Lemon"),notes:[],iconURI:"music-editor/lemon.png",instrument:{waveform:14,octave:2,ampEnvelope:{attack:5,decay:70,sustain:870,release:50,amplitude:1024},pitchEnvelope:{attack:10,decay:45,sustain:0,release:100,amplitude:20},ampLFO:{frequency:1,amplitude:50},pitchLFO:{frequency:2,amplitude:1}}},{id:9,name:lf("Drums"),notes:[],iconURI:"music-editor/explosion.png",instrument:{waveform:11,octave:4,ampEnvelope:{attack:10,decay:100,sustain:500,release:100,amplitude:1024}},drums:[{startFrequency:100,startVolume:1024,steps:[{waveform:3,frequency:120,duration:10,volume:1024},{waveform:3,frequency:1,duration:100,volume:0}]},{startFrequency:200,startVolume:1024,steps:[{frequency:0,volume:0,duration:100,waveform:1}]},{startFrequency:100,startVolume:1024,steps:[{frequency:0,volume:0,duration:250,waveform:1}]},{startFrequency:175,startVolume:1024,steps:[{waveform:1,frequency:200,duration:10,volume:1024},{waveform:1,frequency:150,duration:20,volume:1024},{waveform:5,frequency:1,duration:20,volume:100},{waveform:5,frequency:1,duration:300,volume:0}]},{startFrequency:220,startVolume:1024,steps:[{waveform:1,frequency:250,duration:10,volume:1024},{waveform:1,frequency:200,duration:20,volume:1024},{waveform:5,frequency:2e3,duration:20,volume:100},{waveform:5,frequency:2e3,duration:200,volume:0}]},{startFrequency:400,startVolume:500,steps:[{frequency:450,volume:500,duration:10,waveform:5},{frequency:400,volume:20,duration:20,waveform:5}]},{startFrequency:400,startVolume:0,steps:[{frequency:450,volume:500,duration:5,waveform:5},{frequency:900,volume:5,duration:50,waveform:5},{frequency:900,volume:0,duration:250,waveform:5}]},{startFrequency:400,startVolume:0,steps:[{frequency:450,volume:500,duration:5,waveform:5},{frequency:900,volume:200,duration:50,waveform:5},{frequency:900,volume:5,duration:100,waveform:5},{frequency:900,volume:0,duration:400,waveform:5}]},{startFrequency:400,startVolume:0,steps:[{frequency:450,volume:500,duration:5,waveform:5},{frequency:900,volume:200,duration:100,waveform:5},{frequency:900,volume:5,duration:200,waveform:5},{frequency:900,volume:0,duration:500,waveform:5}]},{startFrequency:3500,startVolume:1024,steps:[{frequency:4e3,volume:0,duration:10,waveform:4},{frequency:3500,volume:800,duration:1,waveform:4},{frequency:4e3,volume:0,duration:40,waveform:4},{frequency:3500,volume:400,duration:1,waveform:4},{frequency:4e3,volume:0,duration:40,waveform:4}]},{startFrequency:2e3,startVolume:1024,steps:[{frequency:1800,volume:15,duration:100,waveform:4},{frequency:1800,volume:0,duration:200,waveform:4}]},{startFrequency:200,startVolume:200,steps:[{frequency:125,volume:200,duration:25,waveform:14},{frequency:100,volume:15,duration:50,waveform:14},{frequency:120,volume:0,duration:250,waveform:14}]},{startFrequency:300,startVolume:200,steps:[{frequency:225,volume:200,duration:25,waveform:14},{frequency:200,volume:15,duration:50,waveform:14},{frequency:220,volume:0,duration:250,waveform:14}]},{startFrequency:500,startVolume:200,steps:[{frequency:425,volume:200,duration:25,waveform:14},{frequency:400,volume:15,duration:50,waveform:14},{frequency:420,volume:0,duration:250,waveform:14}]},{startFrequency:200,startVolume:1024,steps:[{frequency:75,volume:0,duration:200,waveform:1}]},{startFrequency:300,startVolume:1024,steps:[{frequency:200,volume:0,duration:200,waveform:1}]},{startFrequency:400,startVolume:1024,steps:[{frequency:300,volume:0,duration:200,waveform:1}]},{startFrequency:200,startVolume:1024,steps:[{frequency:200,volume:15,duration:100,waveform:4},{frequency:150,volume:0,duration:200,waveform:4}]},{startFrequency:450,startVolume:1024,steps:[{frequency:350,volume:15,duration:100,waveform:4},{frequency:300,volume:0,duration:100,waveform:4}]},{startFrequency:2500,startVolume:1024,steps:[{frequency:2500,volume:100,duration:150,waveform:4},{frequency:2550,volume:0,duration:500,waveform:4}]},{startFrequency:3e3,startVolume:1024,steps:[{frequency:3e3,volume:100,duration:300,waveform:4},{frequency:3060,volume:0,duration:500,waveform:4}]},{startFrequency:800,startVolume:0,steps:[{frequency:800,volume:1024,duration:10,waveform:4},{frequency:800,volume:0,duration:490,waveform:4}]},{startFrequency:400,startVolume:0,steps:[{frequency:400,volume:1024,duration:10,waveform:4},{frequency:400,volume:0,duration:400,waveform:4}]},{startFrequency:2e3,startVolume:1024,steps:[{frequency:2e3,volume:100,duration:150,waveform:16},{frequency:2e3,volume:0,duration:200,waveform:16}]}]}]}}(e=(e=t.assets||(t.assets={})).music||(e.music={})).encodeSongToHex=function(e){return e=(e=>{var t,i=e.tracks.filter(e=>0<e.notes.length).map(s),r=i.reduce((e,t)=>t.length+e,0),n=new Uint8Array(7+r);n[0]=0,p(n,1,e.beatsPerMinute),n[3]=e.beatsPerMeasure,n[4]=e.ticksPerBeat,n[5]=e.measures,n[6]=i.length;let a=7;for(t of i)n.set(t,a),a+=t.length;return n})(e),t.U.toHex(e)},e.decodeSongFromHex=function(i){i=t.U.fromHex(i);{var r=i;let e={beatsPerMinute:c(r,1),beatsPerMeasure:r[3],ticksPerBeat:r[4],measures:r[5],tracks:[]},t=7;for(;t<r.length;){var[n,a]=((n,a)=>{if(n[a+1]){var r=n,s=a;let e={id:r[s],instrument:{ampEnvelope:{attack:0,decay:0,sustain:0,release:0,amplitude:0},waveform:0},notes:[],drums:[]},t=c(r,s+2),i=s+4;for(;i<s+4+t;)e.drums.push(((t,i)=>{var r={startFrequency:c(t,i+1),startVolume:c(t,i+3),steps:[]};for(let e=0;e<t[i];e++){var n=i+5+7*e;r.steps.push({waveform:t[n],frequency:c(t,n+1),volume:c(t,n+3),duration:c(t,n+5)})}return r})(r,i)),i+=5+7*e.drums[e.drums.length-1].steps.length;var o=c(r,i);for(i+=2;i<s+4+t+o;)e.notes.push(u(r,i,0,!0)),i+=5+e.notes[e.notes.length-1].notes.length;return[e,i]}{var l=n,n=a;let e={id:l[n],instrument:((e,t)=>({waveform:e[t],ampEnvelope:{attack:c(e,t+1),decay:c(e,t+3),sustain:c(e,t+5),release:c(e,t+7),amplitude:c(e,t+9)},pitchEnvelope:{attack:c(e,t+11),decay:c(e,t+13),sustain:c(e,t+15),release:c(e,t+17),amplitude:c(e,t+19)},ampLFO:{frequency:e[t+21],amplitude:c(e,22)},pitchLFO:{frequency:e[t+24],amplitude:c(e,25)},octave:e[t+27]}))(l,n+4),notes:[]},t=n+4+c(l,n+2),i=c(l,t),r=t+2;for(;r<t+2+i;)e.notes.push(u(l,r,e.instrument.octave,!1)),r+=5+e.notes[e.notes.length-1].notes.length;return[e,r]}})(r,t);t=a,e.tracks.push(n)}return e}},e.cloneSong=function(e){return Object.assign(Object.assign({},e),{tracks:e.tracks.map(e=>Object.assign(Object.assign({},e),{instrument:e.instrument&&Object.assign(Object.assign({},e.instrument),{ampEnvelope:Object.assign({},e.instrument.ampEnvelope),pitchEnvelope:e.instrument.pitchEnvelope&&Object.assign({},e.instrument.pitchEnvelope),ampLFO:e.instrument.ampLFO&&Object.assign({},e.instrument.ampLFO),pitchLFO:e.instrument.pitchLFO&&Object.assign({},e.instrument.pitchLFO)}),drums:e.drums&&e.drums.map(e=>Object.assign(Object.assign({},e),{steps:e.steps.map(e=>Object.assign({},e))})),notes:e.notes.map(e=>Object.assign(Object.assign({},e),{notes:e.notes.slice()}))}))})},e.songEquals=function(e,t){return function t(i,r){{if(typeof i!=typeof r)return!1;if("object"!=typeof i)return i===r;if(Array.isArray(i)){if(i.length!==r.length)return!1;for(let e=0;e<i.length;e++)if(!t(i[e],r[e]))return!1;return!0}}let e=Object.keys(i);let n=Object.keys(r);if(e.length!==n.length)return!1;for(var a of e){if(-1===n.indexOf(a))return!1;if(!t(i[a],r[a]))return!1}return!0}(e,t)},e.inflateSong=function(r){var e=i(1);r.tracks=e.tracks.map((e,t)=>{var i=r.tracks.find(e=>e.id===t);return i&&(e.notes=i.notes),e})},e.getSongInfo=function(e){return{ticksPerBeat:e.ticksPerBeat,beatsPerMeasure:e.beatsPerMeasure,beatsPerMinute:e.beatsPerMinute,measures:e.measures}},e.getEmptySong=i})(pxt=pxt||{}),(m=>{let a=["name","version","description","license","dependencies","files","testFiles","testDependencies","fileDependencies","public","targetVersions","supportedTargets","preferredEditor","languageRestriction","additionalFilePath","additionalFilePaths"];class p{constructor(e,t,i,r,n){this.id=e,this._verspec=t,this.parent=i,this.depName=n,this.level=-1,this.isLoaded=!1,this.ignoreTests=!1,this.cppOnly=!1,r&&(this.level=r.level+1),this.addedBy=[r]}static stringifyConfig(e){var t,i,r=e,n={};for(t of a)r.hasOwnProperty(t)&&(n[t]=r[t]);for(i of Object.keys(r))n.hasOwnProperty(i)||(n[i]=r[i]);return JSON.stringify(n,null,4)+"\n"}static parseAndValidConfig(e){let t=m.Util.jsonTryParse(e);return t&&void 0!==t.name&&"string"==typeof t.name&&t.files&&Array.isArray(t.files)&&t.files.every(e=>"string"==typeof e)&&t.dependencies&&Object.keys(t.dependencies).every(e=>"string"==typeof t.dependencies[e])&&t}static async getConfigAsync(e,t,i){var r,n;if(m.github.isGithubId(i))return r=m.github.parseRepoId(i),n=await m.packagesConfigAsync(),await m.github.repoAsync(r.fullName,n)?await m.github.pkgConfigAsync(r.fullName,r.tag,n):null;if(i.startsWith("workspace:"))return i.slice("workspace:".length),null;if(!i.startsWith("pub:"))return r=m.patching.upgradePackageReference(e,t,i),n=m.appTarget.bundledpkgs[r],JSON.parse(n[m.CONFIG_NAME]);{let e=i.slice("pub:".length);try{var a=await m.Cloud.downloadScriptFilesAsync(e);return JSON.parse(a[m.CONFIG_NAME])}catch(e){return m.log(`Unable to fetch files for published script '${i}'`),null}}}static corePackages(){let t=m.appTarget.bundledpkgs;return Object.keys(t).map(e=>JSON.parse(t[e][m.CONFIG_NAME])).filter(e=>!!e)}disablesVariant(e){return this.config&&this.config.disablesVariants&&0<=this.config.disablesVariants.indexOf(e)}invalid(){return/^invalid:/.test(this.version())}version(){return this.resolvedVersion||this._verspec}verProtocol(){var e=this.version().split(":");return 1<e.length?e[0]:""}verArgument(){var e=this.verProtocol();return e?this.version().slice(e.length+1):this.version()}targetVersion(){return this.parent&&this.parent!=this?this.parent.targetVersion():this.config.targetVersions?this.config.targetVersions.target:void 0}async commonDownloadAsync(){var e,t=this.verProtocol();let i;return"pub"==t?i=await m.Cloud.downloadScriptFilesAsync(this.verArgument()):"github"==t?(e=await m.packagesConfigAsync(),e=await m.github.downloadPackageAsync(this.verArgument(),e),i=e.files):"embed"==t?i=m.getEmbeddedScript(this.verArgument()):"pkg"==t&&(e=(this.parent||this).readFile(this.verArgument()),(t=m.U.jsonTryParse(e))||m.log("unable to find "+this.verArgument()),i=t),i}writeAssetPackFiles(){var e,t=JSON.parse(JSON.stringify(this.config));t.files=t.files.filter(e=>e.endsWith(".jres")),t.files.push("gallery.ts"),t.dependencies={},t.assetPack=!0,this.config=t,this.saveConfig();let i="";for(e of t.files){var r,n=this.readFile(e),n=m.U.jsonTryParse(n);n&&([n,r]=m.emitGalleryDeclarations(n,this.getNamespaceName()),this.writeFile(e,JSON.stringify(n,null,4)),i+=r)}this.writeFile("gallery.ts",i)}getNamespaceName(){let e=this,t=e.addedBy[0];for(var i=[];t&&t!==e;)e.depName&&i.push(e.depName),t=(e=t).addedBy[0];return i.reverse().map(e=>ts.pxtc.escapeIdentifier(e)).join(".")}host(){return this.parent._host}readFile(e){return this.host().readFile(this,e)}writeFile(e,t){this.host().writeFile(this,e,t,!0)}readGitJson(){var e=this.readFile(m.github.GIT_JSON);return m.Util.jsonTryParse(e)}resolveDep(e){return this.parent.deps.hasOwnProperty(e)?this.parent.deps[e]:null}saveConfig(){var e=m.U.clone(this.config),e=(delete e.additionalFilePaths,m.Package.stringifyConfig(e));this.host().writeFile(this,m.CONFIG_NAME,e)}setPreferredEditor(e){this.config.preferredEditor!=e&&(this.config.preferredEditor=e,this.saveConfig())}getPreferredEditor(){var e,t=this.config.preferredEditor;return t||(!(0<=this.getFiles().indexOf(m.MAIN_BLOCKS))||(t=this.readFile(m.MAIN_BLOCKS),e=this.readFile(m.MAIN_TS),!t&&e)?m.JAVASCRIPT_PROJECT_NAME:m.BLOCKS_PROJECT_NAME)}parseJRes(e={}){for(var t of this.getFiles())m.U.endsWith(t,".jres")&&i(JSON.parse(this.readFile(t)),e);return e}isAssetPack(){var e;return 0<this.level&&!(null==(e=this.config)||!e.assetPack)}resolveVersionAsync(){let e,i=this._verspec;if(m.getEmbeddedScript(this.id))this.resolvedVersion=i="embed:"+this.id;else if(i&&"*"!=i){if("github"==this.verProtocol()){let t=m.github.parseRepoId(this._verspec);var r;t&&!t.tag&&this.parent&&(m.debug("dep: unbound github extensions, trying to resolve tag"),r=m.semver.sortLatestTags(m.Util.values((null==(e=this.parent)?void 0:e.deps)||{}).map(e=>m.github.parseRepoId(e.version())).filter(e=>(null==e?void 0:e.slug)===t.slug).map(e=>e.tag))[0])&&(t.tag=r,this.resolvedVersion=i=m.github.stringifyRepo(t),m.debug(`dep: github patched ${this._verspec} to `+i))}}else this.configureAsInvalidPackage(lf("version not specified for {0}",this.id)),i=this._verspec;return Promise.resolve(i)}downloadAsync(){return this.resolveVersionAsync().then(e=>{if(this.invalid())m.debug("skip download of invalid package "+this.id);else if(/^embed:/.test(e)||this.installedVersion!=e)return m.debug("downloading "+e),this.host().downloadPackageAsync(this).then(()=>{this.loadConfig(),this.isAssetPack()&&this.writeAssetPackFiles(),m.debug(`installed ${this.id} /`+e)})})}loadConfig(){var e;0!=this.level&&this.invalid()||((e=this.readFile(m.CONFIG_NAME))||m.U.userError(`extension ${this.id} is missing `+m.CONFIG_NAME),this.parseConfig(e),0!=this.level&&(this.installedVersion=this.version()),this.saveConfig())}validateConfig(){this.config.dependencies||m.U.userError("Missing dependencies in config of: "+this.id),Array.isArray(this.config.files)||m.U.userError("Missing files in config of: "+this.id),"string"==typeof this.config.name&&this.config.name||(this.config.name=lf("Untitled")),this.config.targetVersions&&this.config.targetVersions.target&&this.config.targetVersions.targetId===m.appTarget.id&&m.appTarget.versions&&0<m.semver.majorCmp(this.config.targetVersions.target,m.appTarget.versions.target)&&m.U.userError(lf("{0} requires target version {1} (you are running {2})",this.config.name,this.config.targetVersions.target,m.appTarget.versions.target))}isPackageInUse(i,e=this.readFile(m.MAIN_TS)){let r=null;var t=m.patching.computePatches(this.targetVersion(),"missingPackage");return t&&t.forEach(t=>{Object.keys(t.map).forEach(e=>{t.map[e]===i&&(r=new RegExp(e,"g"))})}),(r=r||new RegExp(i+"\\.","g")).test(e)}upgradePackagesAsync(){return this.config||this.loadConfig(),m.packagesConfigAsync().then(async r=>{let n=0,a={},e=[];return m.U.iterMap(this.config.dependencies,(t,i)=>{e.push((async()=>{var e;m.github.isGithubId(i)&&(e=await m.github.upgradedPackageReferenceAsync(r,i))&&e!=i&&(m.log(`upgrading dep ${t}: ${i} -> `+e),a[i]=e,this.config.dependencies[t]=e,n++)})())}),await Promise.all(e),n&&this.saveConfig(),n&&a})}getMissingPackages(n,a){var e=m.patching.computePatches(this.targetVersion(),"missingPackage");let s={};return a&&e&&e.forEach(r=>{Object.keys(r.map).forEach(e=>{var t=new RegExp(e,"g");let i=r.map[e];a.replace(t,e=>(n.dependencies[i]||(s[i]="*"),""))})}),s}findConflictsAsync(e,u){let d=[],h;return Promise.resolve().then(()=>"string"==typeof e?p.getConfigAsync(this.targetVersion(),e,u):Promise.resolve(e)).then(e=>{if(h=e){let c=h.yotta?m.U.jsonFlatten(h.yotta.config):null;this.parent.sortedDeps().forEach(t=>{var i,r;if(h.core&&t.config.core&&h.name!=t.config.name)(r=new m.cpp.PkgConflictError(lf("conflict between core extensions {0} and {1}",h.name,t.id))).pkg0=t,d.push(r);else{let e=!1;if(c){var n=t.config||JSON.parse(t.readFile(m.CONFIG_NAME));if(!!n&&!!n.yotta&&!!t.config.yotta.config){var a,s=m.U.jsonFlatten(n.yotta.config);for(a of Object.keys(c)){var o=s[a],l=h.yotta.configIsJustDefaults||n.yotta.configIsJustDefaults;!s.hasOwnProperty(a)||o===c[a]||l||t.parent.config.yotta&&t.parent.config.yotta.ignoreConflicts||((o=new m.cpp.PkgConflictError(lf("conflict on yotta setting {0} between extensions {1} and {2}",a,h.name,t.id))).pkg0=t,o.settingName=a,d.push(o),e=!0)}}}e||h.name!==t.id||t._verspec===u||/^file:/.test(t._verspec)||/^file:/.test(u)||(r=/^github:/.test(t._verspec)&&m.github.parseRepoId(t._verspec),i=/^github:/.test(u)&&m.github.parseRepoId(u),r&&i&&r.fullName===i.fullName&&!(i.tag&&m.semver.strcmp(r.tag,i.tag)<0))||((r=new m.cpp.PkgConflictError(lf("version mismatch for extension {0} (added: {1}, adding: {2})",t.id,t._verspec,u))).pkg0=t,r.isVersionConflict=!0,d.push(r))}})}return Object.keys(null!=(e=null==h?void 0:h.dependencies)?e:{}).reduce((e,t)=>e.then(()=>this.findConflictsAsync(t,h.dependencies[t])).then(e=>d.push.apply(d,e)),Promise.resolve())}).then(()=>{let r=e=>{let t=[];return e.addedBy.forEach(e=>{e.id!==this.id&&(t.push.apply(r(e)),t.push(e))}),t},e=[];return d.forEach(i=>{e.push.apply(e,r(i.pkg0).map(e=>{var t=new m.cpp.PkgConflictError(i.isVersionConflict?lf("a dependency of {0} has a version mismatch with extension {1} (added: {1}, adding: {2})",e.id,h.name,i.pkg0._verspec,u):lf("conflict on yotta setting {0} between extensions {1} and {2}",i.settingName,h.name,i.pkg0.id));return t.pkg0=e,t}))}),d.push.apply(d,e),d=d.filter((t,i)=>{for(let e=0;e<i;++e)if(t.pkg0.id===d[e].pkg0.id)return!1;return!0})})}configureAsInvalidPackage(e){m.log(`invalid package ${this.id}: `+e),this._verspec="invalid:"+this.id,this.config={name:this.id,description:e,dependencies:{},files:[]}}parseConfig(e,t){try{var i=JSON.parse(e);this.config=i}catch(e){this.configureAsInvalidPackage(lf("Syntax error in pxt.json")),m.tickEvent("package.invalidConfigEncountered")}var r,e=JSON.stringify(this.config);for(r in this.config.dependencies){var n=m.patching.upgradePackageReference(this.targetVersion(),r,this.config.dependencies[r]);n!=r&&(delete this.config.dependencies[r],n)&&(this.config.dependencies[n]="*")}t&&(this.config.targetVersions={target:t}),JSON.stringify(this.config)!=e&&this.saveConfig(),this.validateConfig()}patchCorePackage(){m.Util.assert(m.appTarget.simulator&&m.appTarget.simulator.dynamicBoardDefinition),m.Util.assert(0==this.level);var e,t=Object.keys(this.config.dependencies).filter(e=>!!e&&(e==m.BLOCKS_PROJECT_NAME||e==m.JAVASCRIPT_PROJECT_NAME||JSON.parse((m.appTarget.bundledpkgs[e]||{})[m.CONFIG_NAME]||"{}").core));0==t.length?(e=m.Package.corePackages()).length&&this.config.dependencies[e[0].name]:1<t.length&&(t.pop(),t.forEach(e=>{m.log("removing core package "+e),delete this.config.dependencies[e]}))}resolvedDependencies(){return Object.keys(this.dependencies()).map(e=>this.resolveDep(e))}dependencies(e=!1){if(!this.config)return{};let i=m.Util.clone(this.config.dependencies||{});return 0==this.level&&this.config.testDependencies&&m.Util.iterMap(this.config.testDependencies,(e,t)=>{"*"==t&&!m.appTarget.bundledpkgs[e]||(i[e]=t)}),e&&this.config.cppDependencies&&m.Util.jsonMergeFrom(i,this.config.cppDependencies),i}async loadAsync(c=!1,e){if(!this.isLoaded){0!=this.level||m.appTarget.multiVariants||m.setAppTargetVariant(null),this.isLoaded=!0;var i,r=this.readFile(m.CONFIG_NAME);if(null==r?c||m.U.userError("Package not installed: "+this.id+", did you forget to run `pxt install`?"):this.parseConfig(r),c||await this.upgradePackagesAsync(),c&&(await this.downloadAsync(),0!==this.level)&&!this.isAssetPack())for(var n of this.addedBy)if(null!=(n=n.config.assetPacks)&&n[this.id]){this.writeAssetPackFiles();break}c&&(r=await this.upgradePackagesAsync())&&(Object.keys(r).forEach(e=>m.tickEvent("package.doubleload",{extension:e})),m.log("upgraded, downloading again"),m.debug(r),await this.downloadAsync()),m.appTarget.simulator&&m.appTarget.simulator.dynamicBoardDefinition&&(0==this.level&&this.patchCorePackage(),this.config.compileServiceVariant&&m.setAppTargetVariant(this.config.compileServiceVariant),0<=this.config.files.indexOf("board.json"))&&((r=m.appTarget.simulator.boardDefinition=JSON.parse(this.readFile("board.json"))).id=this.config.name,m.appTarget.appTheme.boardName=r.boardName||lf("board"),m.appTarget.appTheme.driveDisplayName=r.driveDisplayName||lf("DRIVE"),r=e=>{var t,i=/^pkg:\/\/(.*)/.exec(e);return i?(i=i[1],t=this.readFile(i),m.U.toDataUri(t,m.U.getMime(i))):e},"object"==typeof(i=m.appTarget.simulator.boardDefinition).visual)&&((i=i.visual).image=r(i.image),i.outlineImage=r(i.outlineImage));let l=(e,t)=>{if(m.debug(`version spec mismatch: ${e._verspec} != `+t),/^github:/.test(e._verspec)&&/^github:/.test(t)){var i=m.github.parseRepoId(e._verspec),r=m.github.parseRepoId(t);if(null!=i&&i.slug&&(null==i?void 0:i.slug)===(null==r?void 0:r.slug)){var i=(null==i?void 0:i.tag)||(null==(i=e.config)?void 0:i.version),n=r.tag;if(i&&!n)return void m.debug(`unversioned ${t}, using `+i);n=m.semver.strcmp(i,r.tag);if(0==n)return void m.debug("resolved version are "+i);if(0<n)return void m.debug(`auto-upgraded ${t} to `+i)}}/^file:/.test(e._verspec)||/^file:/.test(t)?m.debug("ignore file: mismatch issues"):e.configureAsInvalidPackage(lf("version mismatch"))},t=async(r,n,a=!1)=>{r=r||n.dependencies(a),m.debug(`deps: ${n.id}->`+Object.keys(r).join(", ")),r=m.github.resolveMonoRepoVersions(r),m.debug(`deps: resolved ${n.id}->`+Object.keys(r).join(", "));for(var s of Object.keys(r)){let e=r[s]||"*",t=(m.debug(`dep: load ${n.id}.${s}${a?"++":""}: `+e),"hw"==s&&m.hwVariant&&(s="hw---"+m.hwVariant),m.github.parseRepoId(e));var o;null!=t&&t.slug&&(o=Object.values(n.parent.deps).map(e=>m.github.parseRepoId(e._verspec)).filter(e=>(null==e?void 0:e.slug)===t.slug).map(e=>e.tag).reduce((e,t)=>0<m.semver.strcmp(e,t)?e:t,"0.0.0"),m.debug(`dep: common repo ${t.slug} version found `+o),0<m.semver.strcmp(o,"0.0.0"))&&(!t.tag||0<m.semver.strcmp(o,t.tag))&&(m.debug(`dep: upgrade from ${t.tag} to `+o),t.tag=o,e=m.github.stringifyRepo(t,!0));let i=n.resolveDep(s);i?(i.invalid()||i._verspec===e||l(i,e),!i.invalid()&&a||(i.level=Math.min(i.level,n.level+1),i.addedBy.push(n))):(i=new p(s,e,n.parent,n,s),a&&(i.cppOnly=!0),n.parent.deps[s]=i,await(n.parent.deps[s.replace(/---.*/,"")]=i).loadAsync(c))}};if(await t(null,this),this.patchAppTargetPalette(),this.config.screenSize&&m.appTarget.runtime&&(m.appTarget.runtime.screenSize=m.U.clone(this.config.screenSize)),0===this.level){r=this.readFile(m.MAIN_TS);if(r){var a,s=this.getMissingPackages(this.config,r);let e=!1;for(a of Object.keys(s)){var o,u=await this.findConflictsAsync(a,s[a]);u.length?(o=u.map(e=>e.pkg0.id).join(", "),u=u.map(e=>e.settingName).filter(e=>!!e).join(", "),m.log(`skipping missing package ${a} because it conflicts with the following packages: ${o} (conflicting settings: ${u})`)):(m.log("adding missing package "+a),e=!0,this.config.dependencies[a]="*",(o={})[a]=s[a],await t(o,this))}e&&(this.saveConfig(),this.validateConfig())}await Promise.all(m.U.values(this.parent.deps).map(e=>t(null,e,!0)))}m.debug("  installed "+this.id)}}getFiles(){let e,t=(e=0!=this.level||this.ignoreTests?this.config.files.slice(0):this.config.files.concat(this.config.testFiles||[]),this.config.fileDependencies);return e=this.config.fileDependencies?e.filter(i=>{let r=e=>{var t;return"!"==(e=e.trim())[0]?!r(e.slice(1)):/^[\w-]+$/.test(e)?!(!(t=this.parent.resolveDep(e))||t.cppOnly):(t=/^target:(\w+)$/.exec(e))?t[1]==m.appTarget.id||t[1]==m.appTarget.platformid:(p.depWarnings[e]||(p.depWarnings[e]=!0,m.log(`invalid dependency expression: ${e} in ${this.id}/`+i)),!1)};var e=m.U.lookup(t,i);return!e||!e.trim()||e.split("||").some(e=>e.split("&&").every(r))}):e}addSnapshot(e,i=[""]){for(let t of this.getFiles())i.some(e=>m.U.endsWith(t,e))&&(e[this.id+"/"+t]=this.readFile(t));e[this.id+"/"+m.CONFIG_NAME]=this.readFile(m.CONFIG_NAME)}packageLocalizationStringsAsync(i){let r=m.appTarget.id;var e=[this.config.name+"-jsdoc",this.config.name];let n={};m.appTarget.appTheme;return this.config.skipLocalization?Promise.resolve(n):m.Util.liveLocalizationEnabled()&&"this"!=this.id&&m.appTarget.bundledpkgs[this.id]?(m.debug("loading live translations for "+this.id),Promise.all(e.map(t=>m.Util.downloadLiveTranslationsAsync(i,r+`/${t}-strings.json`).then(e=>{e&&Object.keys(e).length?m.Util.jsonMergeFrom(n,e):(m.tickEvent("translations.livetranslationsfailed",{filename:t}),m.Util.jsonMergeFrom(n,this.bundledStringsForFile(i,t)))}).catch(e=>{m.tickEvent("translations.livetranslationsfailed",{filename:t}),m.log(`error while downloading ${r}/${t}-strings.json`),m.Util.jsonMergeFrom(n,this.bundledStringsForFile(i,t))}))).then(()=>n)):(e.map(e=>this.bundledStringsForFile(i,e)).filter(e=>!!e).forEach(e=>m.Util.jsonMergeFrom(n,e)),Promise.resolve(n))}bundledStringsForFile(t,e){let i={};var[r,n,a]=m.Util.normalizeLanguageCode(t),s=this.config.files;let o=`_locales/${r}/${e}-strings.json`;if(a&&-1===s.indexOf(o)&&(o=`_locales/${a}/${e}-strings.json`),n&&-1===s.indexOf(o)&&(o=`_locales/${n}/${e}-strings.json`),-1<s.indexOf(o))try{i=JSON.parse(this.readFile(o))}catch(e){m.reportError("extension","Extension localization JSON failed to parse",{fileName:o,lang:t,extension:this.verArgument()}),"github"===this.verProtocol()&&m.tickEvent("loc.errors.json",{repo:this.verArgument(),file:o})}return i}patchAppTargetPalette(){this.config.palette&&m.appTarget.runtime&&(m.appTarget.runtime.palette=m.U.clone(this.config.palette),this.config.paletteNames)&&(m.appTarget.runtime.paletteNames=this.config.paletteNames)}}p.depWarnings={},m.Package=p;class e extends p{constructor(e){super("this","file:.",null,null,null),this._host=e,this.deps={},(this.parent=this).addedBy=[this],this.level=0,this.deps[this.id]=this}installAllAsync(e){return this.loadAsync(!0,e)}sortedDeps(i=!1){let r={},n=[],a=e=>e.config?Object.keys(e.config.cppDependencies||{}).length:0,s=e=>{var t;e&&!m.U.lookup(r,e.id)&&(r[e.id]=!0,(t=Object.keys(e.dependencies(i)).map(e=>this.resolveDep(e))).sort((e,t)=>a(t)-a(e)||m.U.strcmp(e.id,t.id)),t.forEach(s),n.push(e.id))};return s(this),n.map(e=>this.resolveDep(e))}localizationStringsAsync(t){let i={};return Promise.all(m.Util.values(this.deps).map(e=>e.packageLocalizationStringsAsync(t).then(t=>{t&&Object.keys(t).forEach(e=>{i[e]||(i[e]=t[e])})}))).then(()=>{let t=m.U.getLocalizedStrings();return Object.keys(i).forEach(e=>{!m.U.startsWith(e,"{id:subcategory}")&&!m.U.startsWith(e,"{id:group}")||t[e]||(t[e]=i[e])}),m.U.setLocalizedStrings(t),Promise.resolve(i)})}getTargetOptions(){let t=m.U.clone(m.appTarget.compile);return m.U.assert(!!t),t.utf8||this.sortedDeps(!0).forEach(e=>{e.config&&e.config.utf8&&(m.debug("forcing utf8 mode: pkg="+e.id),t.utf8=!0)}),t}getJRes(){if(!this._jres){this._jres={};for(var e of this.sortedDeps())e.parseJRes(this._jres);var t=(m.appTarget.runtime&&m.appTarget.runtime.palette?m.appTarget.runtime.palette:["#000000","#ffffff"]).map(e=>("000000"+parseInt(e.replace(/#/,""),16).toString(16)).slice(-6)).join("");this._jres.__palette={id:"__palette",data:t,dataEncoding:"hex",mimeType:"application/x-palette"}}return this._jres}updateJRes(){this._jres&&this.parseJRes(this._jres)}resolveBannedCategories(){if(void 0===this._resolvedBannedCategories){let t=[];m.appTarget&&m.appTarget.runtime&&m.appTarget.runtime.bannedCategories&&m.appTarget.runtime.bannedCategories.length&&(t=m.appTarget.runtime.bannedCategories.slice(),Object.keys(this.deps).map(e=>this.deps[e]).filter(e=>!!e).map(e=>m.Util.jsonTryParse(e.readFile(m.CONFIG_NAME))).filter(e=>e&&e.requiredCategories).forEach(e=>e.requiredCategories.forEach(e=>{e=t.indexOf(e);-1<e&&t.splice(e,1)})),this._resolvedBannedCategories=t),this._resolvedBannedCategories=t,this._resolvedBannedCategories.length||(this._resolvedBannedCategories=null)}return this._resolvedBannedCategories}async getCompileOptionsAsync(n=this.getTargetOptions()){let e,r={sourceFiles:[],fileSystem:{},target:n,name:this.config?this.config.name:""},a=(e,t)=>{this.config.files.indexOf(e)<0&&m.U.userError(lf("please add '{0}' to \"files\" in {1}",e,m.CONFIG_NAME)),t="// Auto-generated. Do not edit.\n"+t+"\n// Auto-generated. Do not edit. Really.\n",this.host().readFile(this,e,!0)!==t&&(m.debug(`updating ${e} (size=${t.length})...`),this.host().writeFile(this,e,t,!0))},s=m.appTarget.disabledVariants,o=!1,l=async e=>{var t={extinfo:null,target:null},i=m.appTargetVariant;e&&m.setAppTargetVariant(e,{temporary:!0});let r;try{t.target=m.appTarget.compile,r=m.cpp.getExtensionInfo(this),o||!r.shimsDTS&&!r.enumsDTS||(o=!0,r.shimsDTS&&a("shims.d.ts",r.shimsDTS),r.enumsDTS&&a("enums.d.ts",r.enumsDTS))}finally{e&&m.setAppTargetVariant(i,{temporary:!0})}r.appVariant=e;i=n.isNative?await this.host().getHexInfoAsync(r):null;return r=m.U.flatClone(r),n.keepCppFiles||(delete r.compileData,delete r.generatedFiles,delete r.extensionFiles),r.hexinfo=i,t.extinfo=r,t};await this.loadAsync(),r.bannedCategories=this.resolveBannedCategories(),m.debug("building: "+this.sortedDeps().map(e=>null==(e=e.config)?void 0:e.name).join(", "));let c,u=(m.appTarget.multiVariants?(c=m.appTargetVariant?[m.appTargetVariant]:m.appTarget.alwaysMultiVariant||m.appTarget.compile.switches.multiVariant?m.appTarget.multiVariants:[m.appTarget.multiVariants[0]],!m.appTarget.alwaysMultiVariant&&s&&(c=c.filter(e=>!s.includes(e)))):c=[null],null);var t,i,d;await Promise.all(c.map(async e=>{u&&m.debug("building for "+e);var t=await l(e),i=t.extinfo;i.appVariant=e,i.outputPrefix=1!=c.length&&e?e+"-":"",-1<(null==s?void 0:s.indexOf(e))&&(i.disabledDeps=i.disabledDeps||"user-disabled"),u?r.otherMultiVariants.push(t):(t.target.isNative=r.target.isNative,r.target=t.target,u=i,r.otherMultiVariants=[])})),r.extinfo=u,r.target.preferredEditor=this.getPreferredEditor(),!(m.appTarget.compile.shortPointers||"vm"==m.appTarget.compile.nativeType||this.config.binaryonly||!r.target.isNative)&&(t=await this.filesToBePublishedAsync(!0),f=JSON.stringify({name:this.config.name,comment:this.config.description,status:"unpublished",scriptId:this.installedVersion,cloudId:m.CLOUD_ID+m.appTarget.id,editor:this.getPreferredEditor(),targetVersions:m.appTarget.versions}),t=JSON.stringify(t),i=await m.lzmaCompressAsync(f+t))&&(r.embedMeta=JSON.stringify({compression:"LZMA",headerSize:f.length,textSize:t.length,name:this.config.name,eURL:m.appTarget.appTheme.embedUrl,eVER:m.appTarget.versions?m.appTarget.versions.target:"",pxtTarget:m.appTarget.id}),r.embedBlob=ts.pxtc.encodeBase64(m.U.uint8ArrayToString(i)));for(d of this.sortedDeps())for(var h of d.getFiles())if(/\.(ts|asm|py)$/.test(h)){let e=h;0<d.level&&(e="pxt_modules/"+d.id+"/"+h),r.sourceFiles.push(e),r.fileSystem[e]=d.readFile(h)}r.jres=this.getJRes();var p,f=m.appTarget.runtime&&m.appTarget.runtime.functionsOptions;r.allowedArgumentTypes=f&&f.extraFunctionEditorTypes&&f.extraFunctionEditorTypes.map(e=>e.typeName).concat("number","boolean","string"),r.unfetteredInitializers=null==(e=m.appTarget.compile)?void 0:e.unfetteredInitializers;for(p of this.sortedDeps())p.patchAppTargetPalette();return this.patchAppTargetPalette(),r}prepareConfigToBePublished(){let n=m.U.clone(this.config);return delete n.installedVersion,delete n.additionalFilePath,delete n.additionalFilePaths,n.targetVersions||(n.targetVersions=m.Util.clone(m.appTarget.versions)),m.U.iterMap(n.dependencies,(e,t)=>{if(!t||/^(file|workspace):/.test(t)){t="*";try{var i,r=this.resolveDep(e).readGitJson();r&&r.repo&&((i=m.github.parseRepoId(r.repo)).tag=r.commit.tag||r.commit.sha,t=m.github.stringifyRepo(i))}catch(e){}n.dependencies[e]=t}}),n.files=n.files.filter(e=>e!==m.HISTORY_FILE),n}filesToBePublishedAsync(r=!1){let n={};return this.loadAsync().then(()=>{r||this.config.public||m.U.userError('Only packages with "public":true can be published');var e,t,i=this.prepareConfigToBePublished();n[m.CONFIG_NAME]=m.Package.stringifyConfig(i);for(e of this.getFiles())e!==m.CONFIG_NAME&&e!==m.HISTORY_FILE&&(null==(t=this.readFile(e))&&m.U.userError("referenced file missing: "+e),n[e]=t);return m.U.sortObjectFields(n)})}saveToJsonAsync(){return this.filesToBePublishedAsync(!0).then(e=>({meta:{cloudId:m.CLOUD_ID+m.appTarget.id,targetVersions:m.appTarget.versions,editor:this.getPreferredEditor(),name:this.config.name},source:JSON.stringify(e,null,2)}))}compressToFileAsync(){return this.saveToJsonAsync().then(e=>m.lzmaCompressAsync(JSON.stringify(e,null,2)))}computePartDefinitions(r){if(!r||!r.length)return{};let n={};return this.sortedDeps().forEach(i=>{var t=i.readFile("pxtparts.json");if(t)try{let e=JSON.parse(t);Object.keys(e).forEach(t=>{if(0<=r.indexOf(t)){t=n[t]=e[t];if("string"==typeof t.visual.image&&/\.svg$/i.test(t.visual.image)){let e=i.readFile(t.visual.image);e||m.reportError("parts","invalid part definition",{error:"missing visual "+t.visual.image}),/^data:image\/svg\+xml/.test(e)||(e="data:image/svg+xml,"+encodeURIComponent(e)),t.visual.image=e}}})}catch(e){m.reportError("parts","invalid pxtparts.json file")}}),n}}function i(r,n={}){var a,s=r["*"]||{};for(a of Object.keys(r))if("*"!=a){let e=r[a],t=(e="string"==typeof e?{data:e}:e).namespace||s.namespace||"";t&&!t.endsWith(".")&&(t+=".");var o=e.id||t+a;let i=e.icon;var l=e.mimeType||s.mimeType,c=e.dataEncoding||s.dataEncoding||"base64";i||"base64"!=c||"image/png"!=l&&"image/jpeg"!=l||(i="data:"+l+";base64,"+e.data),n[o]={id:o,data:e.data,dataEncoding:c,icon:i,namespace:t,mimeType:l,tilemapTile:e.tilemapTile,displayName:e.displayName,tileset:e.tileset,tags:e.tags}}return n}m.MainPackage=e,m.inflateJRes=i,m.allPkgFiles=function(e){return[m.CONFIG_NAME].concat(e.files||[]).concat(e.testFiles||[])},m.isPkgBeta=function(e){return e&&/\bbeta\b/.test(e.description)}})(pxt=pxt||{}),(l=>{{var c=l.packetio||(l.packetio={});let r,i,n=()=>{},a,s;c.isActive=function(){return!!r},c.isConnected=function(){return!(null==r||!r.isConnected())},c.isConnecting=function(){return!(null==r||!r.isConnecting())},c.icon=function(){var e;return!!r&&(r.icon||(null==(e=l.appTarget.appTheme.downloadDialogTheme)?void 0:e.deviceIcon)||"usb")},c.unsupportedParts=function(){return null!=r&&r.unsupportedParts?r.unsupportedParts():[]},c.deviceVariant=function(){return null==r?void 0:r.devVariant};let o;function u(){if(o)return o;let t=Promise.resolve();if(r){l.debug("packetio: disconnect");let e=r;t=t.then(()=>e.disconnectAsync()).then(()=>e.io.disposeAsync()).catch(e=>{l.reportException(e)}).finally(()=>{i=void 0,r=void 0,o=void 0}),n&&(t=t.then(()=>n())),o=t}return t}c.disconnectAsync=u,c.configureEvents=function(e,t,i){n=e,a=t,s=i,r&&(r.io.onConnectionChanged=n,r.onSerial=a,r.onCustomEvent=i)},c.sendCustomEventAsync=function(e,t){return r?r.sendCustomEventAsync(e,t):Promise.resolve()},c.initAsync=function(t=!1){if(l.debug("packetio: init "+(t?"(force)":"")),!i){let e=Promise.resolve();t&&(e=e.then(()=>u())),i=e.then(()=>r?Promise.resolve(r):c.mkPacketIOAsync?(l.debug("packetio: new wrapper"),c.mkPacketIOAsync().then(e=>(e.onConnectionChanged=n,r=c.mkPacketIOWrapper(e),a&&(r.onSerial=a),s&&(r.onCustomEvent=s),n&&n(),r))):(l.debug("packetio: not defined, skipping"),Promise.resolve(void 0))).finally(()=>{i=void 0})}return i}}})(pxt=pxt||{}),(a=>{var e;function r(e,t,i){let r=a.semver.tryParse(e||"0.0.0")||a.semver.tryParse("0.0.0"),n=[];return Object.keys(t).filter(e=>a.semver.inRange(e,r)).forEach(e=>n=n.concat(t[e])),(n=i?n.filter(e=>e.type==i):n).length?n:void 0}function i(e,t,i){let r=t;return i&&(i.filter(e=>"api"===e.type).forEach(i=>{Object.keys(i.map).forEach(e=>{var t=new RegExp(e,"g");r=r.replace(t,i.map[e])})}),i.filter(e=>"userenum"===e.type).forEach(i=>{Object.keys(i.map).forEach(e=>{var t=new RegExp("enum\\s+"+e+"\\s*{","gm"),t=(r=r.replace(t,`enum ${i.map[e]} {`),new RegExp(`(^|[^_a-zA-Z0-9])${e}(\\s*\\.)`,"g"));r=r.replace(t,`$1${i.map[e]}$2`)})})),r}(e=a.patching||(a.patching={})).computePatches=function(e,t){var i=a.appTarget.compile?a.appTarget.compile.patches:void 0;if(i)return r(e,i,t)},e.computePyPatches=function(e,t){var i=a.appTarget.compile?a.appTarget.compile.pyPatches:void 0;if(i)return r(e,i,t)},e.upgradePackageReference=function(e,t,i){if("*"!=i)return t;i=a.patching.computePatches(e,"package");let r=t;return i&&i.forEach(t=>{Object.keys(t.map).forEach(e=>{r==e&&(r=t.map[e])})}),r},e.patchJavaScript=function(e,t){return i(0,t,a.patching.computePatches(e))},e.patchPython=function(e,t){return i(0,t,a.patching.computePyPatches(e))}})(pxt=pxt||{}),(e=>{e.react||(e.react={})})(pxt=pxt||{}),(s=>{var t;function a(i,r){if(i){if(r){let t=i.major-r.major||i.minor-r.minor||i.patch-r.patch;if(t)return t;if(0==i.pre.length&&0<r.pre.length)return 1;if(0<i.pre.length&&0==r.pre.length)return-1;for(let e=0;e<i.pre.length+1;++e){var n=i.pre[e],a=r.pre[e];if(!n)return a?-1:0;if(!a)return 1;if(/^\d+$/.test(n)){if(!/^\d+$/.test(a))return-1;if(t=parseInt(n)-parseInt(a))return t}else{if(/^\d+$/.test(a))return 1;if(t=s.U.strcmp(n,a))return t}}return 0}return-1}return r?1:0}function o(e,t){t=l(e)||l(t);return t||s.U.userError(s.U.lf("'{0}' doesn't look like a semantic version number",e)),t}function l(e){if(!e)return null;if("*"===e)return{major:Number.MAX_SAFE_INTEGER,minor:Number.MAX_SAFE_INTEGER,patch:Number.MAX_SAFE_INTEGER,pre:[],build:[]};/^v\d/i.test(e)&&(e=e.slice(1));e=/^(\d+)\.(\d+)\.(\d+)(-([0-9a-zA-Z\-\.]+))?(\+([0-9a-zA-Z\-\.]+))?$/.exec(e);return e?{major:parseInt(e[1]),minor:parseInt(e[2]),patch:parseInt(e[3]),pre:e[5]?e[5].split("."):[],build:e[7]?e[7].split("."):[]}:null}function c(e){let t=e.major+"."+e.minor+"."+e.patch;return e.pre.length&&(t+="-"+e.pre.join(".")),e.build.length&&(t+="+"+e.build.join(".")),t}function i(e,t){var i=l(e),r=l(t);return i||r?a(i,r):s.U.strcmp(e,t)}function u(e,t){var i,e=e.split(" - ");return 2==e.length&&(i=l(e[0]),e=l(e[1]),!(!i||!e))&&(!t||(i=a(i,t),t=a(t,e),i<=0&&t<0))}(t=s.semver||(s.semver={})).cmp=a,t.parse=o,t.tryParse=l,t.normalize=function(e){return c(o(e))},t.stringify=c,t.majorCmp=function(e,t){return e=l(e),t=l(t),e.major-t.major},t.strcmp=i,t.inRange=u,t.sortLatestTags=function(e){return(e=e.filter(e=>!!t.tryParse(e))).sort(i),e.reverse(),e},t.bump=function(e,t){let i=o(c(e));switch(t){case"major":i.major++,i.minor=0,i.patch=0;break;case"minor":i.minor++,i.patch=0;break;case"patch":i.patch++;break;default:i=s.semver.parse(t)}return i},t.test=function(){s.log("Test semver");var i=["0.9.0","1.0.0-0.3.7","1.0.0-alpha","1.0.0-alpha.1","1.0.0-alpha.beta","1.0.0-beta","1.0.0-beta.2","1.0.0-beta.11","1.0.0-rc.1","1.0.0-x.7.z.92","1.0.0","1.0.1","1.9.0","1.10.0","1.11.0"];for(let t=0;t<i.length;++t){var r=o(i[t]);s.log(i[t],r),s.U.assert(c(r)==i[t]);for(let e=0;e<i.length;++e){var n=a(r,o(i[e]));s.log(i[t],i[e],n),t<e?s.U.assert(n<0):t>e?s.U.assert(0<n):s.U.assert(0==n)}}var e=l("1.2.3");s.U.assert(u("0.1.2 - 2.2.3",e)),s.U.assert(u("1.2.3 - 2.2.3",e)),s.U.assert(!u("0.0.0 - 1.2.3",e)),s.U.assert(!u("1.2.4 - 4.2.3",e)),s.U.assert(!u("0.0.0 - 0.0.1",e))}})(pxt=pxt||{}),(e=>{var u;{var T=e.pxtc||(e.pxtc={});function t(e){return T.Util.values(e.byQName).filter(e=>e.attributes.block&&/^{[^:]+:[^}]+}/.test(e.attributes.block)).forEach(e=>{e.attributes.block=e.attributes.block.replace(/^{[^:]+:[^}]+}/,"")}),e}T.assert=T.Util.assert,T.oops=T.Util.oops,T.U=T.Util,T.ON_START_TYPE="pxt-on-start",T.ON_START_COMMENT="on start",T.HANDLER_COMMENT="code goes here",T.TS_STATEMENT_TYPE="typescript_statement",T.TS_DEBUGGER_TYPE="debugger_keyword",T.TS_BREAK_TYPE="break_keyword",T.TS_CONTINUE_TYPE="continue_keyword",T.TS_OUTPUT_TYPE="typescript_expression",T.TS_RETURN_STATEMENT_TYPE="function_return",T.PAUSE_UNTIL_TYPE="pxt_pause_until",T.COLLAPSED_BLOCK="pxt_collapsed_block",T.FUNCTION_DEFINITION_TYPE="function_definition",T.BINARY_JS="binary.js",T.BINARY_ASM="binary.asm",T.BINARY_HEX="binary.hex",T.BINARY_UF2="binary.uf2",T.BINARY_ELF="binary.elf",T.BINARY_PXT64="binary.pxt64",T.BINARY_ESP="binary.bin",T.BINARY_SRCMAP="binary.srcmap",T.NATIVE_TYPE_THUMB="thumb",T.NATIVE_TYPE_VM="vm",T.BLOCK_TRANSLATION_CACHE_KEY="_blocks",T.BuildSourceMapHelpers=function(n,t,i){let a={ts:(u=e=>{let t=e.split("\n").map(e=>e.length),i=t.reduce(({lens:e,sum:t},i)=>({lens:[...e,t+i+1],sum:t+i+1}),{lens:[],sum:0}).lens;return{posToLineCol:r=>{var e=i.reduce((e,t,i)=>r<t?e:i+1,0);return[e,t[e]-(i[e]-r)+1]},lineColToPos:(e,t)=>(i[e-1]||0)+t}})(t),py:u(i)},s=e=>e.endPos-e.startPos,r=(e,t)=>{let{startPos:i,endPos:r}=e;return n.filter(e=>e[t].startPos<=i&&r<=e[t].endPos)},o=(e,i)=>{e=r(e,i);return e.reduce((e,t)=>s(t[i])<s(e[i])?t:e,e[0])};const e={allOverlaps:e=>r(e,"ts"),smallestOverlap:e=>o(e,"ts")},l={allOverlaps:e=>r(e,"py"),smallestOverlap:e=>o(e,"py")};var c=(u=(r,n)=>e=>{e=e;var t,[e,i]=[a[r].lineColToPos(e.line,e.column),e.length],i=e+i,e=o({startPos:e,endPos:i},r);if(e)return[i,t]=a[n].posToLineCol(e[n].startPos),{fileName:"main."+n,start:e[n].startPos,length:s(e[n]),line:i,column:t}})("ts","py"),u=u("py","ts");return{ts:Object.assign(Object.assign(Object.assign({},a.ts),e),{locToLoc:c,getText:e=>t.substring(e.startPos,e.endPos)}),py:Object.assign(Object.assign(Object.assign({},a.py),l),{locToLoc:u,getText:e=>i.substring(e.startPos,e.endPos)})}},T.computeUsedParts=function(t,e,i=!1){if(!t.usedSymbols||!pxt.appTarget.simulator||!i&&!pxt.appTarget.simulator.parts)return[];let r=(e,t)=>{e&&(e=e.split(/[ ,]+/g),t.push(...e.filter(e=>!!e&&t.indexOf(e)<0)))},n=[],a=[];if(Object.keys(t.usedSymbols).forEach(e=>{e=t.usedSymbols[e];r(null==e?void 0:e.attributes.parts,n),r(null==e?void 0:e.attributes.hiddenParts,a)}),e){let t=pxt.appTarget.simulator.boardDefinition.onboardComponents;t&&("ignorebuiltin"===e?n=n.filter(e=>-1===t.indexOf(e)):"onlybuiltin"===e&&(n=n.filter(e=>0<=t.indexOf(e))))}return(n=n.filter(e=>a.indexOf(e)<0)).sort(),n=n.reverse()},T.buildSimJsInfo=function(e){return{js:e.outfiles[T.BINARY_JS],targetVersion:pxt.appTarget.versions.target,fnArgs:e.usedArguments,parts:T.computeUsedParts(e,"ignorebuiltin"),usedBuiltinParts:T.computeUsedParts(e,"onlybuiltin"),allParts:T.computeUsedParts(e,void 0,!0),breakpoints:null==(e=e.breakpoints)?void 0:e.map(e=>e.id)}},T.blocksCategory=function(e){return(e=e?e.attributes.blockNamespace||e.namespace:void 0)?T.Util.capitalize(e.split(".")[0]):void 0},T.getBlocksInfo=function(e,t){let i,r,p=[],f={},m={},g={};var n,a,s,o,l={},c={};function u(i,r){var n="get"==i,a="set"==i,s="number"==r.retType,o=n?m:a?f:g,l=r.namespace+"."+r.retType;let c=T.U.lookup(o,l);if(!c){var u=`@${i}@`;let e,t;r.attributes.blockCombineShadow&&(d=(h=r.attributes.blockCombineShadow).match(/^([^,.]*),?([^,.]*)$/))&&3==d.length&&(e=d[1].trim(),0!=(t=d[2].trim()).length||T.Util.endsWith(h,",")||(t=e,e=""));var d=(r.attributes.blockSetVariable||r.namespace.toLocaleLowerCase())+"="+(e||""),h="value="+(t||"");(c=o[l]={attributes:{blockId:`${s?r.namespace:l}_blockCombine_`+i,callingConvention:0,group:r.attributes.group,paramDefl:{},jsDoc:n?T.U.lf("Read value of a property on an object"):T.U.lf("Update value of property on an object")},name:u,namespace:r.namespace,fileName:r.fileName,qName:l+"."+u,pkg:r.pkg,kind:2,parameters:[{name:"property",description:n?T.U.lf("the name of the property to read"):T.U.lf("the name of the property to change"),isEnum:!0,type:"@combined@"},{name:"value",description:a?T.U.lf("the new value of the property"):T.U.lf("the amount by which to change the property"),type:r.retType}].slice(0,n?1:2),retType:n?r.retType:"void",combinedProperties:[]}).attributes.block=n?`%${d} %property`:a?T.U.lf("set %{0} %property to %{1}",d,h):T.U.lf("change %{0} %property by %{1}",d,h),x(c.attributes),pxt.Util.isTranslationMode()&&(c.attributes.translationId=c.attributes.block,c.attributes.block=n?`%${d} %property`:a?`set %${d} %property to %`+h:`change %${d} %property by %`+h,x(c.attributes),pxt.crowdin.inContextLoadAsync(c.attributes.translationId).then(e=>{c.attributes.block=e,x(c.attributes)})),p.push(c)}c.combinedProperties.push(r.qName)}for(n of T.Util.values(e.byQName)){if("ENUM_GET"===n.attributes.shim&&n.attributes.enumName&&n.attributes.blockId){let e=!1;if(l[n.attributes.enumName]&&(pxt.warn(`Enum block ${n.attributes.blockId} trying to overwrite enum `+n.attributes.enumName),e=!0),n.attributes.enumMemberName||(pxt.warn(`Enum block ${n.attributes.blockId} should specify enumMemberName`),e=!0),n.attributes.enumPromptHint||(pxt.warn(`Enum block ${n.attributes.blockId} should specify enumPromptHint`),e=!0),n.attributes.enumInitialMembers&&n.attributes.enumInitialMembers.length||(pxt.warn(`Enum block ${n.attributes.blockId} should specify enumInitialMembers`),e=!0),e)continue;var d=parseInt(n.attributes.enumStartValue);l[n.attributes.enumName]={blockId:n.attributes.blockId,name:n.attributes.enumName,memberName:n.attributes.enumMemberName,firstValue:isNaN(d)?void 0:d,isBitMask:n.attributes.enumIsBitMask,isHash:n.attributes.enumIsHash,initialMembers:n.attributes.enumInitialMembers,promptHint:n.attributes.enumPromptHint}}if("KIND_GET"===n.attributes.shim&&n.attributes.blockId){var h=n.attributes.kindNamespace||n.attributes.blockNamespace||n.namespace;if(c[h]){pxt.warn("More than one block defined for kind "+h);continue}var v=[];if(e.byQName[h])for(var b of T.Util.values(e.byQName))b.namespace===h&&b.attributes.isKind&&v.push(b.name);c[h]={blockId:n.attributes.blockId,name:h,memberName:n.attributes.kindMemberName||h,initialMembers:v,promptHint:n.attributes.enumPromptHint||T.Util.lf("Create a new kind..."),createFunctionName:n.attributes.kindCreateFunction||"create"}}if(n.attributes.blockCombine)/@set/.test(n.name)||u("get",n),n.isReadOnly||("number"==n.retType&&u("change",n),u("set",n));else if(n.attributes.block&&!n.attributes.fixedInstance&&7!=n.kind&&5!=n.kind&&9!=n.kind&&8!=n.kind&&!n.attributes.blockIdentity){if(n.attributes.blockId||(n.attributes.blockId=n.qName.replace(/\./g,"_")),"true"==n.attributes.block){let e=T.U.uncapitalize(n.name);1!=n.kind&&2!=n.kind||(e+=" %"+n.namespace.toLowerCase());for(a of null!=(r=null==(i=n.parameters)?void 0:i.filter(e=>!E(e)))?r:[])e+=" %"+a.name;n.attributes.block=e,x(n.attributes)}p.push(n)}}for(s of p){var y=T.U.lookup(e.byQName,s.namespace);if(y){var w,A=y.attributes,k=s.attributes;for(w of["blockNamespace","color","blockGap"])void 0===k[w]&&A[w]&&(k[w]=A[w])}}return{apis:e,blocks:p=t&&(o=t).length?p.filter(e=>{e=(e.attributes.blockNamespace||e.namespace).split(".")[0];return-1===o.indexOf(e)}):p,blocksById:pxt.Util.toDictionary(p,e=>e.attributes.blockId),enumsByName:l,kindsByName:c}},T.tsSnippetToPySnippet=function(e,t){var i={true:"True",false:"False",null:"None"}[e];return i||(t&&6==t.kind||!t&&e.includes(".")?(i=e.lastIndexOf("."),t=e.substr(0,i),i=e.substr(i+1),i=T.U.snakify(i).toUpperCase(),t?t+"."+i:i):e)},T.apiLocalizationStrings={},T.localizeApisAsync=async function(u,e){let d=T.Util.userLanguage();if("en"==d)return Promise.resolve(t(u));let h=d.toLowerCase(),p=h+"|jsdoc",f=h+"|block",m=await e.localizationStringsAsync(d);return T.apiLocalizationStrings&&T.Util.jsonMergeFrom(m,T.apiLocalizationStrings),e=T.Util.values(u.byQName).filter(e=>e.attributes._translatedLanguageCode!==d),await T.Util.promiseMapAll(e,async r=>{var e=r.attributes.useLoc||r.attributes.blockAliasFor;let n=e&&u.byQName[e],i=(r.attributes._untranslatedJsDoc&&(r.attributes.jsDoc=r.attributes._untranslatedJsDoc),r.attributes._untranslatedBlock&&(r.attributes.jsDoc=r.attributes._untranslatedBlock),(e,t)=>{var i;return m[r.qName+e]||(null==(i=r.attributes.locs)?void 0:i[t])||n&&(m[n.qName+e]||(null==(i=n.attributes.locs)?void 0:i[t]))});var e=i("",p),e=(e&&(r.attributes._untranslatedJsDoc||(r.attributes._untranslatedJsDoc=r.attributes.jsDoc),r.attributes.jsDoc=e),null!=(e=r.parameters)&&e.forEach(e=>{var t="|param|"+e.name,t=i(t,h+t);t&&(e.description=t)}),m["{id:category}"+T.Util.capitalize(r.qName)]);let t=m[r.qName+"|block"]||(null==(l=r.attributes.locs)?void 0:l[f]);if(r.attributes.block){var a,s,o,l=pxt.blocks.compileInfo(r);if(l.handlerArgs)for(var c of l.handlerArgs)m[c.localizationKey]?(o=s=a=void 0,a=c.localizationKey,s=m[c.localizationKey],(o=pxt.Util.translationsCache())[T.BLOCK_TRANSLATION_CACHE_KEY]||(o[T.BLOCK_TRANSLATION_CACHE_KEY]={}),o[T.BLOCK_TRANSLATION_CACHE_KEY][a]=s):(o=c.localizationKey,a=void 0,(a=pxt.Util.translationsCache())[T.BLOCK_TRANSLATION_CACHE_KEY]&&delete a[T.BLOCK_TRANSLATION_CACHE_KEY][o])}(t=!t&&n&&(l=m[n.qName+"|block"]||(null==(l=n.attributes.locs)?void 0:l[f]),r.attributes.block===(n.attributes._untranslatedBlock||n.attributes.block))&&l?l:t)&&pxt.Util.isTranslationMode()&&(r.attributes.translationId=t,t=await pxt.crowdin.inContextLoadAsync(t)),e?(r.attributes.block?r.attributes.block=t||r.attributes.block:r.attributes.block=e,x(r.attributes)):r.attributes.block&&t?(l=pxt.blocks.compileInfo(r),e=r.attributes.block,r.attributes.block=pxt.blocks.normalizeBlock(t,e=>{pxt.tickEvent("loc.normalized",{block:r.attributes.block,lang:d,error:e})}),r.attributes._untranslatedBlock||(r.attributes._untranslatedBlock=e),e!=r.attributes.block&&(x(r.attributes),((e,t)=>{if(e.parameters.length==t.parameters.length){for(var i of e.parameters){var r=t.actualNameToParam[i.actualName];if(!r||i.type!=r.type||i.shadowBlockId!=r.shadowBlockId||i.definitionName!=r.definitionName)return void pxt.debug(`Parameter ${i.actualName} type, shadow block, or definition name does not match after localization`)}return 1}pxt.debug("Localized block has extra or missing parameters")})(l,pxt.blocks.compileInfo(r))||(pxt.reportError("loc.errors","block has non matching arguments",{block:r.attributes.blockId,lang:d,originalDefinition:e,translatedBlock:r.attributes.block}),pxt.tickEvent("loc.errors",{block:r.attributes.blockId,lang:d}),r.attributes.block=e,x(r.attributes)))):x(r.attributes),r.attributes._translatedLanguageCode=d}),t(u)},T.getBlockTranslationsCacheKey=function(e){var t=pxt.Util.translationsCache();if(t[T.BLOCK_TRANSLATION_CACHE_KEY])return t[T.BLOCK_TRANSLATION_CACHE_KEY][e]},T.emptyExtInfo=function(){let e=pxt.appTarget.compileService;var t=!!(e=e||{}).platformioIni,i="dockermake"==e.buildEngine||"dockercross"==e.buildEngine||"dockerespidf"==e.buildEngine,r={functions:[],generatedFiles:{},extensionFiles:{},sha:"",compileData:"",shimsDTS:"",enumsDTS:"",onlyPublic:!0};return t?r.platformio={dependencies:{}}:i?r.npmDependencies={}:r.yotta={config:{},dependencies:{}},r};let r=["weight","imageLiteral","gridLiteral","topblockWeight","inlineInputModeLimit"],n=["advanced","handlerStatement","forceStatement","afterOnStart","optionalVariableArgs","blockHidden","constantShim","blockCombine","enumIsBitMask","enumIsHash","decompileIndirectFixedInstances","topblock","callInDebugger","duplicateShadowOnDrag","argsNullable","compileHiddenArguments","expandArgumentsInToolbox"];function E(e){return"Action"===e.type||/^\([^\)]*\)\s*=>/.test(e.type)}function x(i){var e;function t(e){return i._shadowOverrides&&e.parameters.forEach(e=>{var t=i._shadowOverrides[e.name];"unset"===t?delete e.shadowBlockId:null!=t&&(e.shadowBlockId=t)}),e}i.block&&(e=i.block.split("||"),i._def=t(a(e[0])),i._def||pxt.debug("Unable to parse block def for id: "+i.blockId),e[1]&&(i._expandedDef=t(a(e[1]))),e[1])&&!i._expandedDef&&pxt.debug("Unable to parse expanded block def for id: "+i.blockId)}function a(r){var n=[];let e,a=0;for(;a<r.length;a++){let t=r[a];var s=a;let i;switch(t){case"*":case"_":var o=v(e=>e==t),l="_"===t?2:0;1===o.length?i={kind:1<<l,content:o}:2===o.length?i={kind:2<<l,content:o}:3===o.length?i={kind:3<<l,content:o}:a=s;break;case"`":l=b("`");void 0===l?a=s:i={kind:256,content:l};break;case"|":i={kind:32};break;case"\\":a<r.length-1&&(i={kind:16,content:r[1+a++]});break;case"[":o=b("]");if(void 0!==o&&"("===r[1+a++]){var c=b(")");if(void 0!==c){i={kind:512,content:o,type:c};break}}a=s;break;case"$":case"%":var u,c=v(e=>/[a-zA-Z0-9_=]/.test(e),!0).split("=");if(2<c.length)a=s;else{let e;"("!==r[a+1]||(u=a,++a,e=b(")"))||(a=u),i={kind:"$"===t?1024:64,content:c[0],type:c[1],name:e}}}i?(e&&n.push({kind:128,content:e}),e=void 0,n.push(i)):e?e+=t:e=t}e&&n.push({kind:128,content:e});let i=[];var t=[];let d=[],h=0,p="",f=[];for(let e=0;e<n.length;e++){var m=n[e].kind,g=d[d.length-1];15&m?(A(n[e].content),m&h?g&m?(d.pop(),(g=g&(h^=m)|m&h)&&d.push(g)):y():(h|=m,d.push(m))):144&m?p+=n[e].content:1120&m&&w(),64==m?(g={kind:"param",name:n[e].content,shadowBlockId:n[e].type,ref:!1},n[e].name&&(g.varName=n[e].name),i.push(g),t.push(g)):1024==m?(g={kind:"param",name:n[e].content,shadowBlockId:n[e].type,ref:!0},n[e].name&&(g.varName=n[e].name),i.push(g),t.push(g)):256==m?(A(),f.push({kind:"image",uri:n[e].content})):512==m?(A(),f.push({kind:"label",text:n[e].content,cssClass:n[e].type})):32==m&&i.push({kind:"break"})}return w(),{parts:i,parameters:t};function v(e,t=!1){let i="";for(t&&a++;a<r.length&&e(r[a]);)i+=r[a],++a;return i&&a--,i}function b(t){var e=v(e=>e!==t,!0);if(r[a+1]===t)return++a,e}function y(){let e="";var t,i=[];for(t of f)t.kind?(i.push({content:e,styles:0}),i.push(t),e=""):(e+=t.content,t.endingToken&&(e+=t.endingToken));f=i,e&&f.push({content:e,styles:0}),d=[],h=0}function w(){for(A(),h&&y();f.length;){var e,t=f.shift();t.kind?i.push(t):t.content&&(e=[],10&t.styles&&e.push("bold"),5&t.styles&&e.push("italics"),i.push({kind:"label",text:t.content,style:e}))}}function A(e){f.push({content:p,styles:h,endingToken:e}),p=""}}function p(t){var i=e=>t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24)>>>0;if(!t||512!=t.length||i(0)!=u.UF2_MAGIC_START0||i(4)!=u.UF2_MAGIC_START1||i(t.length-4)!=u.UF2_MAGIC_END)return null;var e=i(8);let r=i(16),n=(476<r&&(r=256),null),a=0,s=0;if(e&u.UF2_FLAG_FILE){let e=t.slice(32+r);var o=e.indexOf(0);0<=o&&(e=e.slice(0,o)),n=T.U.fromUTF8Array(e),s=i(28)}return e&u.UF2_FLAG_FAMILY_ID_PRESENT&&(a=i(28)),{flags:e,targetAddr:i(12),payloadSize:r,blockNo:i(20),numBlocks:i(24),fileSize:s,familyId:a,data:t.slice(32,32+r),filename:n}}function s(e,t){return!!e&&e.targetAddr<=t&&t<e.targetAddr+e.payloadSize}function d(e,t,i){e[t]=255&i,e[t+1]=i>>8&255,e[t+2]=i>>16&255,e[t+3]=i>>24&255}function o(e){return{currBlock:null,currPtr:-1,blocks:[],ptrs:[],filesize:0,familyId:(e="string"==typeof e?parseInt(e):e)||0}}function l(t){for(let e=0;e<t.blocks.length;++e)d(t.blocks[e],20,e),d(t.blocks[e],24,t.blocks.length),t.filename&&d(t.blocks[e],28,t.filesize)}function h(t,e,i,r=0){let n=t.currBlock;var a=e>>8;let s=256-(255&e);if(i.length>s){var o=new Uint8Array(i);for(h(t,e,o.slice(0,s));s<i.length;){var l=Math.min(s+256,i.length);h(t,e+s,o.slice(s,l)),s=l}}else{if(a!=t.currPtr){n=null;for(let e=0;e<t.ptrs.length;++e)if(t.ptrs[e]==a){n=t.blocks[e];break}if(!n){n=new Uint8Array(512),t.filename?r|=u.UF2_FLAG_FILE:t.familyId&&(r|=u.UF2_FLAG_FAMILY_ID_PRESENT),d(n,0,u.UF2_MAGIC_START0),d(n,4,u.UF2_MAGIC_START1),d(n,8,r),d(n,12,a<<8),d(n,16,256),d(n,20,t.blocks.length),d(n,28,t.familyId),d(n,508,u.UF2_MAGIC_END);for(let e=32;e<288;++e)n[e]=255;t.filename&&T.U.memcpy(n,288,T.U.toUTF8Array(t.filename)),t.blocks.push(n),t.ptrs.push(a)}t.currPtr=a,t.currBlock=n}var c=32+(255&e);for(let e=0;e<i.length;++e)n[c+e]=i[e];t.filesize=Math.max(t.filesize,i.length+e)}}T.parseCommentString=function(e){let l={paramDefl:{},callingConvention:0,_source:e},c=!0;for(;c;)c=!1,e=e.replace(/\/\/%[ \t]*([\w\.-]+)(=(("[^"\n]*")|'([^'\n]*)'|([^\s]*)))?/,(e,t,i,r,n,a,s)=>{let o=n?JSON.parse(n):i?n||a||s:"true";return o=o||"",T.U.startsWith(t,"block.loc.")?(l.locs||(l.locs={}),l.locs[t.slice("block.loc.".length).toLowerCase()+"|block"]=o):T.U.startsWith(t,"jsdoc.loc.")?(l.locs||(l.locs={}),l.locs[t.slice("jsdoc.loc.".length).toLowerCase()+"|jsdoc"]=o):T.U.contains(t,".loc.")?(l.locs||(l.locs={}),i=t.slice(0,t.indexOf(".loc.")),n=t.slice(t.indexOf(".loc.")+".loc.".length),l.locs[n+"|param|"+i]=o):T.U.endsWith(t,".defl")?(-1<o.indexOf(" ")?l.paramDefl[t.slice(0,t.length-5)]=`"${o}"`:l.paramDefl[t.slice(0,t.length-5)]=o,l.explicitDefaults||(l.explicitDefaults=[]),l.explicitDefaults.push(t.slice(0,t.length-5))):T.U.endsWith(t,".shadow")?(l._shadowOverrides||(l._shadowOverrides={}),l._shadowOverrides[t.slice(0,t.length-7)]=o):T.U.endsWith(t,".snippet")?(l.paramSnippets||(l.paramSnippets={}),a=t.slice(0,t.length-8),l.paramSnippets[a]||(l.paramSnippets[a]={}),l.paramSnippets[a].ts=o):T.U.endsWith(t,".pySnippet")?(l.paramSnippets||(l.paramSnippets={}),s=t.slice(0,t.length-10),l.paramSnippets[s]||(l.paramSnippets[s]={}),l.paramSnippets[s].python=o):T.U.endsWith(t,".fieldEditor")?(l.paramFieldEditor||(l.paramFieldEditor={}),l.paramFieldEditor[t.slice(0,t.length-12)]=o):T.U.contains(t,".fieldOptions.")?(l.paramFieldEditorOptions||(l.paramFieldEditorOptions={}),n=t.slice(0,t.indexOf(".fieldOptions.")),i=t.slice(t.indexOf(".fieldOptions.")+14,t.length),l.paramFieldEditorOptions[n]||(l.paramFieldEditorOptions[n]={}),l.paramFieldEditorOptions[n][i]=o):T.U.contains(t,".shadowOptions.")?(l.paramShadowOptions||(l.paramShadowOptions={}),a=t.slice(0,t.indexOf(".shadowOptions.")),s=t.slice(t.indexOf(".shadowOptions.")+15,t.length),l.paramShadowOptions[a]||(l.paramShadowOptions[a]={}),l.paramShadowOptions[a][s]=o):T.U.endsWith(t,".min")?(l.paramMin||(l.paramMin={}),l.paramMin[t.slice(0,t.length-4)]=o):T.U.endsWith(t,".max")?(l.paramMax||(l.paramMax={}),l.paramMax[t.slice(0,t.length-4)]=o):l[t]=o,c=!0,"//% "});for(var t of r)"string"==typeof l[t]&&(l[t]=parseInt(l[t]));for(var i of n)"string"==typeof l[i]&&(l[i]="true"==l[i]||"1"==l[i]);if(l.trackArgs&&(l.trackArgs=l.trackArgs.split(/[ ,]+/).map(e=>parseInt(e)||0)),l.enumInitialMembers&&(l.enumInitialMembers=l.enumInitialMembers.split(/[ ,]+/)),l.blockExternalInputs&&!l.inlineInputMode&&(l.inlineInputMode="external"),l.paramHelp={},l.jsDoc="",e=e.replace(/\/\*\*([^]*?)\*\//g,(e,t)=>(t=(t=t.replace(/\n\s*(\*\s*)?/g,"\n")).replace(/^\s*@param\s+(\w+)\s+(.*)$/gm,(e,t,i)=>{if(l.paramHelp[t]=i,!l.paramDefl[t]){i=/\beg\.?:\s*(.+)/.exec(i);if(i&&i[1]){i=/(?:"([^"]*)")|(?:'([^']*)')|(?:([^\s,]+))/g.exec(i[1]);if(i){let e=i[1]||i[2]||i[3];-1<(e=e||"").indexOf(" ")?l.paramDefl[t]=`"${e}"`:l.paramDefl[t]=e}}}return""}),l.jsDoc+=t,"")),l.jsDoc=l.jsDoc.trim(),l.async&&(l.callingConvention=1),l.promise&&(l.callingConvention=2),l.jres&&(l.whenUsed=!0),l.subcategories)try{l.subcategories=JSON.parse(l.subcategories)}catch(e){l.subcategories=void 0}if(l.groups)try{l.groups=JSON.parse(l.groups)}catch(e){l.groups=void 0}if(l.groupIcons)try{l.groupIcons=JSON.parse(l.groupIcons)}catch(e){l.groupIcons=void 0}if(l.groupHelp)try{l.groupHelp=JSON.parse(l.groupHelp)}catch(e){l.groupHelp=void 0}return x(l),l},T.parameterTypeIsArrowFunction=E,T.updateBlockDef=x,T.parseBlockDefinition=a,T.parseChecksumBlock=function(t,i=0){var e=pxt.HF2.read32(t,i);if(133083260!=(2147483647&e))return pxt.log("no checksum block magic"),null;var r=pxt.HF2.read32(t,i+4),n=pxt.HF2.read32(t,i+8);if(3&r)return pxt.log("invalid end marker position"),null;var a=1<<(255&n);if(a!=pxt.appTarget.compile.flashCodeAlign)return pxt.log("invalid page size: "+a),null;var s={magic:e,endMarkerPos:r,endMarker:n,regions:[]};for(let e=i+12;e<t.length-7;e+=8){var o={start:a*pxt.HF2.read16(t,e),length:a*pxt.HF2.read16(t,e+2),checksum:pxt.HF2.read32(t,e+4)};if(!o.length||!o.checksum)break;s.regions.push(o)}return s},(u=T.UF2||(T.UF2={})).UF2_MAGIC_START0=171066965,u.UF2_MAGIC_START1=2656915799,u.UF2_MAGIC_END=179400496,u.UF2_FLAG_NONE=0,u.UF2_FLAG_NOFLASH=1,u.UF2_FLAG_FILE=4096,u.UF2_FLAG_FAMILY_ID_PRESENT=8192,u.parseBlock=p,u.parseFile=function(t){var i=[];for(let e=0;e<t.length;e+=512){var r=p(t.slice(e,e+512));r&&i.push(r)}return i},u.toBin=function(t,i=void 0){if(t.length<512)return null;let r=-1,n=-1;var e,a=[];for(let e=0;e<t.length;++e){var s=512*e,o=p(t.slice(s,512+s));if(o){if(i&&o.targetAddr+256>i)break;-1==r&&(r=o.targetAddr,n=r);var l=o.targetAddr-r;l<0||l%4||1048576<l||(0<l&&a.push(new Uint8Array(l)),a.push(t.slice(32+s,32+s+o.payloadSize)),r=o.targetAddr+o.payloadSize)}}let c=0;for(e of a)c+=e.length;if(0==c)return null;var u,d=new Uint8Array(c);let h=0;for(u of a)for(let e=0;e<u.length;++e)d[h++]=u[e];return{buf:d,start:n}},u.readBytes=function(t,i,r){var n=new Uint8Array(r);let a;for(let e=0;e<r;++e,++i)(a=s(a,i)?a:t.filter(e=>s(e,i))[0])&&(n[e]=a.data[i-a.targetAddr]);return n},u.newBlockFile=o,u.finalizeFile=l,u.concatFiles=function(e){for(var t of e)l(t),t.filename=null;var i,r=o();r.blocks=T.U.concat(e.map(e=>e.blocks));for(i of e)i.blocks=[];return r},u.serializeFile=function(e){l(e);let t="";for(var i of e.blocks)t+=T.Util.uint8ArrayToString(i);return t},u.readBytesFromFile=function e(t,i,r){var n,a,s=i>>8;let o;if(s==t.currPtr)o=t.currBlock;else{for(let e=0;e<t.ptrs.length;++e)if(t.ptrs[e]==s){o=t.blocks[e];break}o&&(t.currPtr=s,t.currBlock=o)}return o?(n=new Uint8Array(r),a=Math.min(r,256-(255&i)),T.U.memcpy(n,0,o,32+(255&i),a),0<(r-=a)&&(i=e(t,i+a,r),T.U.memcpy(n,a,i)),n):null},u.writeBytes=h,u.writeHex=function(t,i){let r="0000";for(let e=0;e<i.length;++e){var n=/:02000004(....)/.exec(i[e]);if(n&&(r=n[1]),n=/^:..(....)00(.*)[0-9A-F][0-9A-F]$/.exec(i[e])){var a=parseInt(r+n[1],16),s=n[2],o=[];for(let e=0;e<s.length;e+=2)o.push(parseInt(s[e]+s[e+1],16));h(t,a,o)}}}}})(ts=ts||{}),(e=>{(e=(e=(e=e.pxtc||(e.pxtc={})).service||(e.service={})).ExtensionType||(e.ExtensionType={}))[e.Bundled=1]="Bundled",e[e.Github=2]="Github",e[e.ShareScript=3]="ShareScript"})(ts=ts||{}),(h=>{var e;{var t=h.shell||(h.shell={});let s;(e=s=t.EditorLayoutType||(t.EditorLayoutType={}))[e.IDE=0]="IDE",e[e.Sandbox=1]="Sandbox",e[e.Widget=2]="Widget",e[e.Controller=3]="Controller";let o;(e=o=t.ControllerMode||(t.ControllerMode={}))[e.None=0]="None",e[e.Basic=1]="Basic",e[e.App=2]="App";let l,c=o.None,u=!1,d=!1;function i(){if(void 0===l){if(h.BrowserUtils.hasWindow()){var e=/sandbox=1|#sandbox|#sandboxproject/i.test(window.location.href)||h.BrowserUtils.isIFrame(),t=/nosandbox=1/i.test(window.location.href),i=/controller=(0|1|2)/i.exec(window.location.href),i=(c=i&&h.BrowserUtils.isIFrame()?parseInt(i[1]):c)!==o.None,r=/readonly=1/i.test(window.location.href),n=/editorlayout=(widget|sandbox|ide)/i.exec(window.location.href),a=/noproject=1/i.test(window.location.href);if(l=s.IDE,t?l=s.Widget:i?l=s.Controller:e&&(l=s.Sandbox),i&&r&&(u=!0),i&&a&&(d=!0),n)switch(n[1].toLowerCase()){case"widget":l=s.Widget;break;case"sandbox":l=s.Sandbox;break;case"ide":l=s.IDE}}else l=s.Sandbox;h.debug(`shell: layout type ${s[l]}, readonly `+p())}}function r(){return i(),l==s.Sandbox}function n(){return/[?&]timeMachine=1/i.test(window.location.href)}function p(){return!h.BrowserUtils.hasWindow()||n()||r()&&!/[?&]edit=1/i.test(window.location.href)||a()&&u}function a(){return i(),l==s.Controller}t.layoutTypeClass=function(){return i(),h.shell.EditorLayoutType[l].toLowerCase()},t.isSandboxMode=r,t.isTimeMachineEmbed=n,t.isReadOnly=p,t.isNoProject=function(){return d},t.isControllerMode=a,t.getControllerMode=function(){return i(),c},t.isPyLangPref=function(){return"py"==h.storage.getLocal("editorlangpref")},t.getEditorLanguagePref=function(){return h.storage.getLocal("editorlangpref")},t.setEditorLanguagePref=function(e){e.match(/prj$/)&&(e=e.replace(/prj$/,"")),h.storage.setLocal("editorlangpref",e)},t.getToolboxAnimation=function(){return h.storage.getLocal("toolboxanimation")},t.setToolboxAnimation=function(){h.storage.setLocal("toolboxanimation","1")},t.hasHomeScreen=function(){return!h.shell.isControllerMode()&&!h.appTarget.appTheme.lockedEditor}}})(pxt=pxt||{}),(e=>{{var t=e.skillmap||(e.skillmap={});t.USER_VERSION="0.0.1";class i{constructor(){this.db=new e.BrowserUtils.IDBWrapper(i.databaseName,i.version,(e,t)=>{t=t.result;e.oldVersion<1&&(t.createObjectStore(i.projectTable,{keyPath:i.projectKey}),t.createObjectStore(i.userTable,{keyPath:i.userKey}))})}initAsync(){return this.db.openAsync()}getAllProjectsAsync(){return this.db.getAllAsync(i.projectTable).then(e=>e.map(e=>e.project).filter(e=>!e.deleted))}deleteProjectAsync(e){return this.getProjectAsync(e).then(e=>{e.deleted=!0,this.saveProjectAsync(e)})}getProjectAsync(e){return this.db.getAsync(i.projectTable,e).then(e=>null==e?void 0:e.project)}saveProjectAsync(e){return this.db.setAsync(i.projectTable,{id:e.header.id,project:e})}getUserStateAsync(){return this.db.getAsync(i.userTable,"local-user").then(e=>null==e?void 0:e.user)}saveUserStateAsync(e){return this.db.setAsync(i.userTable,{id:"local-user",user:e})}}i.version=6,i.databaseName="local-skill-map",i.projectTable="projects",i.projectKey="id",i.userTable="users",i.userKey="id",t.IndexedDBWorkspace=i}})(pxt=pxt||{}),(e=>{{var v=e.assets||(e.assets={});v.MAX_FREQUENCY=5e3,v.MAX_VOLUME=255,v.renderSoundPath=function(e,t,i){let{startFrequency:r,endFrequency:n,startVolume:a,endVolume:s,wave:o,interpolation:l}=e,c=(r=Math.max(Math.min(r,v.MAX_FREQUENCY),1),n=Math.max(Math.min(n,v.MAX_FREQUENCY),1),a=Math.max(Math.min(a,v.MAX_VOLUME),0),s=Math.max(Math.min(s,v.MAX_VOLUME),0),new y(r+n+1)),u;switch(l){case"linear":u=e=>r+e*(n-r)/t;break;case"curve":u=e=>r+(n-r)*Math.sin(e/t*(Math.PI/2));break;case"logarithmic":u=e=>r+Math.log10(1+e/t*9)*(n-r)}"noise"===o&&(u=()=>c.randomRange(500,5e3));var d=e=>Math.max(Math.min((s-a)/t*e+a,v.MAX_VOLUME),0);let h=t/2;var p=e=>e/v.MAX_VOLUME*(i-2)/2,f=e=>(1-e/v.MAX_FREQUENCY)*(h-10)+10,m=["M 2 "+i/2];let g=0;for(;g<t;)m.push(b(p(d(g)),f(u(g))/2,o,!1,c)),g+=f(u(g))/2,m.push(b(p(d(g)),f(u(g))/2,o,!0,c)),g+=f(u(g))/2;return m.join(" ")},v.renderWaveSnapshot=function(e,t,i,r,n,a){var s=new y(e),o=("noise"===i&&(e=s.randomRange(500,5e3)),e=Math.max(Math.min(e,v.MAX_FREQUENCY),1),t/v.MAX_VOLUME*(n-2)/2),l=r/(e*a/1e3)/2;let c=Math.ceil(r/(2*l));c%2==1&&c++;var u=[`M ${r/2-c*l} `+n/2];let d=0;for(let e=0;e<c;e++)u.push(b(o,l,i,!1,s)),d+=l,u.push(b(o,l,i,!0,s)),d+=l;return u.join(" ")};class y{constructor(e){this.seed=e,this.lfsr=e}next(){return(this.lfsr=this.lfsr>>1^46080&-(1&this.lfsr))/65535}randomRange(e,t){return e+(t-e)*this.next()}}function b(r,n,e,a,s){switch(e){case"triangle":return`l ${n/2} ${a?r:-r} l ${n/2} `+(a?-r:r);case"square":return`v ${a?r:-r} h ${n} v `+(a?-r:r);case"sawtooth":return a?`l ${n} ${r} v `+-r:`v ${-r} l ${n} `+r;case"sine":return`q ${n/2} ${1.9*(a?r:-r)} ${n} 0`;case"noise":var o,l=[],c=[],u=Math.min(4,n/4);let t=a;for(let e=0;e<n;e+=u)c.push(s.randomRange(0,r)*(t?1:-1)),t=!t;c[0]=a?r:-r;let e=c[c.length-1]=0,i=0;for(o of c){var d=Math.min(u,n-i);if(l.push(`v ${o-e} h `+d),e=o,(i+=d)>=n)break}return l.join(" ")}}function m(e,t,i){var r=new Uint8Array(2);new Uint16Array(r.buffer)[0]=0|i,e[t]=r[0],e[t+1]=r[1]}v.soundToInstructionBuffer=function(i,r,n){let{startFrequency:a,endFrequency:s,startVolume:o,endVolume:l,interpolation:e,duration:c}=i;var u=[];if("linear"===i.interpolation&&"none"===i.effect)u.push({frequency:a,volume:o/v.MAX_VOLUME*1024}),u.push({frequency:s,volume:l/v.MAX_VOLUME*1024});else{r=Math.min(r,Math.floor(c/5));let t;switch(e){case"linear":t=e=>a+e*(s-a)/c;break;case"curve":t=e=>a+(s-a)*Math.sin(e/c*(Math.PI/2));break;case"logarithmic":t=e=>a+Math.log10(1+e/c*9)*(s-a)}var d=c/r;for(let e=0;e<r;e++){var h={frequency:Math.max(t(e*d),1),volume:(h=e*d,(o+h*(l-o)/c)/v.MAX_VOLUME*1024)};"tremolo"===i.effect?e%2==0?h.volume=Math.max(h.volume-500*n,0):h.volume=Math.min(h.volume+500*n,1023):"vibrato"===i.effect?e%2==0?h.frequency=Math.max(h.frequency-100*n,1):h.frequency=h.frequency+100*n:"warble"===i.effect&&(e%2==0?h.frequency=Math.max(h.frequency-1e3*n,1):h.frequency=h.frequency+1e3*n),u.push(h)}}var t=new Uint8Array(12*(u.length-1)),p=Math.floor(c/(u.length-1));for(let e=0;e<u.length-1;e++){var f=12*e;t[f]=(e=>{switch(e){case"square":return 15;case"sine":return 3;case"triangle":return 1;case"noise":return 18;case"sawtooth":return 2}})(i.wave),m(t,2+f,u[e].frequency),m(t,4+f,p),m(t,6+f,u[e].volume),m(t,8+f,u[e+1].volume),m(t,10+f,u[e+1].frequency)}return t}}})(pxt=pxt||{}),(i=>{var e;(e=i.streams||(i.streams={})).createStreamAsync=function(e,t){return i.Cloud.privatePostAsync("streams",{target:e,name:t||"data"}).then(e=>e)},e.postPayloadAsync=function(e,t){return i.Util.assert(!!e.privatekey),i.Cloud.privatePostAsync(e.id+"/data?privatekey="+e.privatekey,t)}})(pxt=pxt||{}),(i=>{var e;{var n=i.svgUtil||(i.svgUtil={});let t;(e=t=n.PatternUnits||(n.PatternUnits={}))[e.userSpaceOnUse=0]="userSpaceOnUse",e[e.objectBoundingBox=1]="objectBoundingBox";let r;(e=r=n.LengthUnit||(n.LengthUnit={}))[e.em=0]="em",e[e.ex=1]="ex",e[e.px=2]="px",e[e.in=3]="in",e[e.cm=4]="cm",e[e.mm=5]="mm",e[e.pt=6]="pt",e[e.pc=7]="pc",e[e.percent=8]="percent";class o{constructor(e){this.el=a(e)}attr(t){return Object.keys(t).forEach(e=>{this.setAttribute(e,t[e])}),this}setAttribute(e,t){return this.el.setAttribute(e,t.toString()),this}setAttributeNS(e,t,i){return this.el.setAttributeNS(e,t,i.toString()),this}id(e){return this.setAttribute("id",e)}setClass(...e){return this.setAttribute("class",e.join(" "))}appendClass(e){return i.BrowserUtils.addClass(this.el,e),this}removeClass(e){i.BrowserUtils.removeClass(this.el,e)}title(e){this.titleElement||(this.titleElement=a("title"),this.el.firstChild?this.el.insertBefore(this.titleElement,this.el.firstChild):this.el.appendChild(this.titleElement)),this.titleElement.textContent=e}setVisible(e){return this.setAttribute("visibility",e?"visible":"hidden")}}n.BaseElement=o;class l extends o{draw(e){e=(e=>{switch(e){case"text":return new m;case"circle":return new v;case"rect":return new g;case"line":return new b;case"polygon":return new A;case"polyline":return new w;case"path":return new k;default:return new f(e)}})(e);return this.el.appendChild(e.el),e}element(e,t){return t(this.draw(e)),this}group(){var e=new u;return this.el.appendChild(e.el),e}appendChild(e){this.el.appendChild(e.el)}onDown(e){return n.events.down(this.el,e),this}onUp(e){return n.events.up(this.el,e),this}onMove(e){return n.events.move(this.el,e),this}onEnter(e){return n.events.enter(this.el,e),this}onLeave(e){return n.events.leave(this.el,e),this}onClick(e){return n.events.click(this.el,e),this}}n.DrawContext=l;class c extends l{constructor(e){super("svg"),e&&e.appendChild(this.el)}define(e){return this.defs||(this.defs=new h(this.el)),e(this.defs),this}}n.SVG=c;class u extends l{constructor(e){super("g"),e&&e.appendChild(this.el)}translate(e,t){return this.left=e,this.top=t,this.updateTransform()}scale(e){return this.scaleFactor=e,this.updateTransform()}def(){return new h(this.el)}style(){return new p(this.el)}updateTransform(){let e="";return null!=this.left&&(e+=`translate(${this.left} ${this.top})`),null!=this.scaleFactor&&(e+=` scale(${this.scaleFactor})`),this.setAttribute("transform",e),this}}n.Group=u;class d extends l{constructor(){super("pattern")}units(e){return this.setAttribute("patternUnits",e===t.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}contentUnits(e){return this.setAttribute("patternContentUnits",e===t.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}size(e,t){return this.setAttribute("width",e),this.setAttribute("height",t),this}}n.Pattern=d;class h extends o{constructor(e){super("defs"),e.appendChild(this.el)}create(e,t){let i;switch(e){case"path":i=new k;break;case"pattern":i=new d;break;case"radialGradient":i=new C;break;case"linearGradient":i=new x;break;case"clipPath":i=new I;break;default:i=new o(e)}return i.id(t),this.el.appendChild(i.el),i}}n.DefsElement=h;class p extends o{constructor(e){super("style"),e.appendChild(this.el)}content(e){this.el.textContent=e}}n.StyleElement=p;class f extends l{at(e,t){return this.setAttribute("x",e),this.setAttribute("y",t),this}moveTo(e,t){return this.at(e,t)}fill(e,t){return this.setAttribute("fill",e),null!=t&&this.opacity(t),this}opacity(e){return this.setAttribute("fill-opacity",e)}stroke(e,t){return this.setAttribute("stroke",e),null!=t&&this.strokeWidth(t),this}strokeWidth(e){return this.setAttribute("stroke-width",e)}strokeOpacity(e){return this.setAttribute("stroke-opacity",e)}clipPath(e){return this.setAttribute("clip-path",e)}}n.Drawable=f;class m extends f{constructor(e){super("text"),null!=e&&this.text(e)}text(e){return this.el.textContent=e,this}fontFamily(e){return this.setAttribute("font-family",e)}fontSize(e,t){return this.setAttribute("font-size",s(e,t))}offset(e,t,i){return 0!==e&&this.setAttribute("dx",s(e,i)),0!==t&&this.setAttribute("dy",s(t,i)),this}anchor(e){return this.setAttribute("text-anchor",e)}}n.Text=m;class g extends f{constructor(){super("rect")}width(e,t=r.px){return this.setAttribute("width",s(e,t))}height(e,t=r.px){return this.setAttribute("height",s(e,t))}corner(e){return this.corners(e,e)}corners(e,t){return this.setAttribute("rx",e),this.setAttribute("ry",t),this}size(e,t,i=r.px){return this.width(e,i),this.height(t,i),this}}n.Rect=g;class v extends f{constructor(){super("circle")}at(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this}radius(e){return this.setAttribute("r",e)}}n.Circle=v,class extends f{};class b extends f{constructor(){super("line")}at(e,t,i,r){return this.from(e,t),null!=i&&null!=r&&this.to(i,r),this}from(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this}to(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this}}n.Line=b;class y extends f{points(e){return this.setAttribute("points",e)}with(e){return this.points(e.map(({x:e,y:t})=>e+" "+t).join(","))}}n.PolyElement=y;class w extends y{constructor(){super("polyline")}}n.Polyline=w;class A extends y{constructor(){super("polygon")}}n.Polygon=A;class k extends f{constructor(){super("path"),this.d=new S}update(){return this.setAttribute("d",this.d.toAttribute())}path(e){return e(this.d),this.update()}setD(e){return this.setAttribute("d",e),this}}n.Path=k;class T extends f{constructor(){super("image")}src(e){return this.setAttributeNS("http://www.w3.org/1999/xlink","href",e)}width(e,t=r.px){return this.setAttribute("width",s(e,t))}height(e,t=r.px){return this.setAttribute("height",s(e,t))}size(e,t,i=r.px){return this.width(e,i),this.height(t,i),this}}n.Image=T;class E extends o{units(e){return this.setAttribute("gradientUnits",e===t.objectBoundingBox?"objectBoundingBox":"userSpaceOnUse")}stop(e,t,i){var r=a("stop");return r.setAttribute("offset",e+"%"),null!=t&&r.setAttribute("stop-color",t),null!=i&&r.setAttribute("stop-opacity",i),this.el.appendChild(r),this}}n.Gradient=E;class x extends E{constructor(){super("linearGradient")}start(e,t){return this.setAttribute("x1",e),this.setAttribute("y1",t),this}end(e,t){return this.setAttribute("x2",e),this.setAttribute("y2",t),this}}n.LinearGradient=x;class C extends E{constructor(){super("radialGradient")}center(e,t){return this.setAttribute("cx",e),this.setAttribute("cy",t),this}focus(e,t,i){return this.setAttribute("fx",e),this.setAttribute("fy",t),this.setAttribute("fr",i),this}radius(e){return this.setAttribute("r",e)}}n.RadialGradient=C;class I extends l{constructor(){super("clipPath")}clipPathUnits(e){return e?this.setAttribute("clipPathUnits","objectBoundingBox"):this.setAttribute("clipPathUnits","userSpaceOnUse")}}function a(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}n.ClipPath=I;class S{constructor(){this.ops=[]}clear(){this.ops=[]}moveTo(e,t){return this.op("M",e,t)}moveBy(e,t){return this.op("m",e,t)}lineTo(e,t){return this.op("L",e,t)}lineBy(e,t){return this.op("l",e,t)}cCurveTo(e,t,i,r,n,a){return this.op("C",e,t,i,r,n,a)}cCurveBy(e,t,i,r,n,a){return this.op("c",e,t,i,r,n,a)}qCurveTo(e,t,i,r){return this.op("Q",e,t,i,r)}qCurveBy(e,t,i,r){return this.op("q",e,t,i,r)}sCurveTo(e,t,i,r){return this.op("S",e,t,i,r)}sCurveBy(e,t,i,r){return this.op("s",e,t,i,r)}tCurveTo(e,t){return this.op("T",e,t)}tCurveBy(e,t){return this.op("t",e,t)}arcTo(e,t,i,r,n,a,s){return this.op("A",e,t,i,r?1:0,n?1:0,a,s)}arcBy(e,t,i,r,n,a,s){return this.op("a",e,t,i,r?1:0,n?1:0,a,s)}close(){return this.op("z")}toAttribute(){return this.ops.map(e=>e.op+" "+e.args.join(" ")).join(" ")}op(e,...t){return this.ops.push({op:e,args:t}),this}}function s(e,t){switch(t){case r.em:return e+"em";case r.ex:return e+"ex";case r.px:return e+"px";case r.in:return e+"in";case r.cm:return e+"cm";case r.mm:return e+"mm";case r.pt:return e+"pt";case r.pc:return e+"pc";case r.percent:return e+"%";default:return e.toString()}}n.PathContext=S}})(pxt=pxt||{}),(e=>{function i(){return"undefined"!=typeof window&&("ontouchstart"in window||navigator&&0<navigator.maxTouchPoints)}function r(){return"undefined"!=typeof window&&!!window.PointerEvent}(e=(e=e.svgUtil||(e.svgUtil={})).events||(e.events={})).isTouchEnabled=i,e.hasPointerEvents=r,e.down=function(e,t){r()?e.addEventListener("pointerdown",t):i()?(e.addEventListener("mousedown",t),e.addEventListener("touchstart",t)):e.addEventListener("mousedown",t)},e.up=function(e,t){r()?e.addEventListener("pointerup",t):(i(),e.addEventListener("mouseup",t))},e.enter=function(e,t){r()?e.addEventListener("pointerover",e=>{t(!!(1&e.buttons))}):i()?e.addEventListener("touchstart",e=>{t(!0)}):e.addEventListener("mouseover",e=>{t(!!(1&e.buttons))})},e.leave=function(e,t){r()?e.addEventListener("pointerleave",t):i()?e.addEventListener("touchend",t):e.addEventListener("mouseleave",t)},e.move=function(e,t){r()?e.addEventListener("pointermove",t):i()?e.addEventListener("touchmove",t):e.addEventListener("mousemove",t)},e.click=function(e,t){e.addEventListener("click",t)}})(pxt=pxt||{}),(e=>{e=e.svgUtil||(e.svgUtil={});{var t=e.helpers||(e.helpers={});class i extends e.Text{at(e,t){return this.cx=e,this.cy=t,this.rePosition(),this}text(e,t=12){return super.text(e),this.fontSizePixels=t,this.setAttribute("font-size",t+"px"),this.rePosition(),this}rePosition(){null!=this.cx&&null!=this.cy&&null!=this.fontSizePixels&&(this.setAttribute("x",this.cx),this.setAttribute("y",this.cy),this.setAttribute("text-anchor","middle"),this.setAttribute("alignment-baseline","middle"))}}t.CenteredText=i}})(pxt=pxt||{}),(e=>{(e=e.editor||(e.editor={})).initExtensionsAsync=e=>Promise.resolve({}),e.initFieldExtensionsAsync=e=>Promise.resolve({})})(pxt=pxt||{}),(b=>{b.IMAGE_MIME_TYPE="image/x-mkcd-f4",b.TILEMAP_MIME_TYPE="application/mkcd-tilemap",b.ANIMATION_MIME_TYPE="application/mkcd-animation",b.SONG_MIME_TYPE="application/mkcd-song",b.JSON_MIME_TYPE="application/json";class r{constructor(e){this.type=e,this.assets=[],this.takenNames={},this.listeners=[]}add(e){return this.takenNames[e.id]?this.update(e.id,e):(e=s(e),this.takenNames[e.id]=!0,this.takenNames[h(e)]=!0,e.meta.displayName&&e.meta.displayName!==e.id&&(this.takenNames[e.meta.displayName]&&(e.meta.displayName=this.generateNewDisplayName(e.meta.displayName)),this.takenNames[e.meta.displayName]=!0),this.assets.push(e),s(e))}getSnapshot(t){return t?this.assets.filter(e=>t(e)).map(e=>s(e)):this.assets.map(e=>s(e))}update(e,t){let i;if(this.takenNames[e]){var r=this.lookupByID(e);if(l(r,t))i=t;else{if(!p(t)&&p(r))return b.warn("Refusing to overwrite asset with invalid version"),b.tickEvent("assets.invalidAssetOverwrite",{assetType:t.type}),r;this.removeByID(e),i=this.add(t),this.notifyListener(t.internalID)}}else i=this.add(t);return i}removeByID(t){var e=this.lookupByID(t);this.assets=this.assets.filter(e=>e.id!==t),delete this.takenNames[t],e&&delete this.takenNames[h(e)],null!=e&&e.meta.displayName&&delete this.takenNames[null==e?void 0:e.meta.displayName]}getByID(e){e=this.lookupByID(e);return e&&s(e)}getByDisplayName(e){if(this.takenNames[e])for(var t of this.assets)if(t.meta.displayName===e||h(t)===e)return s(t)}getByValue(e){for(var t of this.assets)if(l(e,t,!0))return t}isIDTaken(e){return!!this.takenNames[e]}clone(){var e=new r(this.type);return e.assets=this.getSnapshot(),e.takenNames=Object.assign({},this.takenNames),e}serializeToJRes(e={},t){for(var i of this.assets)if(!t||t(i)){c=l=o=s=a=n=r=void 0;var r=i,n=e,a=r.id.substr(r.id.lastIndexOf(".")+1),s=r.meta.tags;switch(r.type){case"image":n[a]=r.jresData,(r.meta.displayName||null!=s&&s.length)&&(o={data:r.jresData,mimeType:b.IMAGE_MIME_TYPE},r.meta.displayName&&(o.displayName=r.meta.displayName),null!=s&&s.length&&(o.tags=s),n[a]=o);break;case"tile":var o={data:r.jresData,mimeType:b.IMAGE_MIME_TYPE,tilemapTile:!0,displayName:r.meta.displayName};null!=s&&s.length&&(o.tags=s),n[a]=o;break;case"tilemap":var l=((e,t,i)=>{var r=e.tilemap.data(),n=new Uint8ClampedArray(5+r.data.length+e.layers.data.length);return n[0]=e.tileset.tileWidth,n[1]=255&r.width,n[2]=r.width>>8&255,n[3]=255&r.height,n[4]=r.height>>8&255,n.set(r.data,5),n.set(e.layers.data,5+r.data.length),{id:t,mimeType:b.TILEMAP_MIME_TYPE,data:btoa(b.sprite.uint8ArrayToHex(n)),tileset:e.tileset.tiles.map(e=>e.id),displayName:i}})(r.data,r.id,r.meta.displayName);n[l.id]=l;break;case"animation":n[a]=(e=>{var t,i={namespace:e.id.substr(0,e.id.lastIndexOf(".")),id:e.id.substr(e.id.lastIndexOf(".")+1),mimeType:b.ANIMATION_MIME_TYPE,data:b.sprite.encodeAnimationString(e.frames,e.interval),displayName:e.meta.displayName};return null!=(t=e.meta.tags)&&t.length&&(i.tags=e.meta.tags),i})(r);break;case"song":l={data:b.assets.music.encodeSongToHex(r.song),mimeType:b.SONG_MIME_TYPE,displayName:r.meta.displayName,namespace:b.sprite.SONG_NAMESPACE+"."};null!=s&&s.length&&(l.tags=s),n[a]=l;break;case"json":var c={data:JSON.stringify({data:r.data,fileName:r.fileName}),mimeType:b.JSON_MIME_TYPE,displayName:r.meta.displayName,namespace:b.sprite.JSON_NAMESPACE+"."};null!=s&&s.length&&(c.tags=s),n[a]=c}}return e}addListener(e,t){this.listeners.push({internalID:e,callback:t})}removeListener(t){this.listeners=this.listeners.filter(e=>e.callback!==t)}diff(e){var t,i,r={before:[],after:[]};let n={};for(t of e.assets){n[t.internalID]=!0;var a=this.lookupByInternalID(t.internalID);a&&l(t,a)||(r.before.push(t),r.after.push(a))}for(i of this.assets.filter(e=>!n[e.internalID]))r.before.push(null),r.after.push(i);return r}applyDiff(e,t=!1){var i,r=t?e.after:e.before,n=t?e.before:e.after;b.Util.assert(r.length===n.length);for(let e=0;e<r.length;e++)r[e]?(this.removeByInternalID(r[e].internalID),n[e]&&this.assets.push(n[e]),this.notifyListener(r[e].internalID)):(this.assets.push(n[e]),this.notifyListener(n[e].internalID));this.takenNames={};for(i of this.assets)b.Util.assert(!this.takenNames[i.id]),this.takenNames[i.id]=!0,this.takenNames[h(i)]=!0,i.meta.displayName&&(i.meta.displayName!==i.id&&b.Util.assert(!this.takenNames[i.meta.displayName]),this.takenNames[i.meta.displayName]=!0)}lookupByID(e){for(var t of this.assets)if(t.id===e)return t;return null}lookupByInternalID(e){for(var t of this.assets)if(t.internalID===e)return t;return null}removeByInternalID(t){this.assets=this.assets.filter(e=>e.internalID!==t)}notifyListener(e){for(var t of this.listeners)t.internalID===e&&t.callback()}generateNewDisplayName(e){e=e.replace(/\d+$/,"");let t=0;for(;this.takenNames[e+t];)++t;return e+t}}class i{constructor(){this.needsRebuild=!0,this.nextID=0,this.nextInternalID=0,this.committedState={revision:0,assets:{image:new r("image"),tile:new r("tile"),tilemap:new r("tilemap"),animation:new r("animation"),song:new r("song"),json:new r("json")}},this.state={revision:this.nextID++,assets:{image:new r("image"),tile:new r("tile"),tilemap:new r("tilemap"),animation:new r("animation"),song:new r("song"),json:new r("json")}},this.gallery={revision:0,assets:{image:new r("image"),tile:new r("tile"),tilemap:new r("tilemap"),animation:new r("animation"),song:new r("song"),json:new r("json")}},this.undoStack=[],this.redoStack=[]}getNewInternalId(){return this.nextInternalID++}createNewImage(e=16,t=16){this.onChange();var i=this.generateNewID("image"),e=new b.sprite.Bitmap(e,t).data(),t={internalID:this.getNewInternalId(),id:i,type:"image",bitmap:e,meta:{},jresData:b.sprite.base64EncodeBitmap(e)};return this.getAssetCollection("image").add(t)}createNewAnimation(e=16,t=16){this.onChange();var i=this.generateNewID("animation"),e=new b.sprite.Bitmap(e,t).data(),t={internalID:this.getNewInternalId(),id:i,type:"animation",frames:[e],interval:500,meta:{}};return this.getAssetCollection("animation").add(t)}createNewAnimationFromData(e,t=500,i){this.onChange();var r=this.generateNewID("animation"),r={internalID:this.getNewInternalId(),id:r,type:"animation",frames:e,interval:t,meta:{displayName:i}};return this.getAssetCollection("animation").add(r)}getGalleryTiles(t){return this.extensionTileSets?this.extensionTileSets.map(e=>e.tileSets.find(e=>e.tileWidth===t)).filter(e=>null==e?void 0:e.tiles.length):null}getProjectImages(){return this.getAssetCollection("image").getSnapshot()}getProjectTiles(t,e){var i=this.getAssetCollection("tile").getSnapshot(e=>e.bitmap.width===t);return 0===i.length?e?(this.createNewTile(new b.sprite.Bitmap(t,t).data()),this.getProjectTiles(t,!1)):null:{tileWidth:t,tiles:i}}createNewTile(e,t,i){this.onChange(),t&&!this.isNameTaken("tile",t)||(t=this.generateNewID("tile"));t={internalID:this.getNewInternalId(),id:t,type:"tile",jresData:b.sprite.base64EncodeBitmap(e),bitmap:e,meta:{displayName:i},isProjectTile:!0};return this.getAssetCollection("tile").add(t)}createNewProjectImage(e,t){this.onChange();t={internalID:this.getNewInternalId(),id:this.generateNewID("image"),type:"image",jresData:b.sprite.base64EncodeBitmap(e),meta:{displayName:t},bitmap:e};return this.getAssetCollection("image").add(t)}createNewSong(e,t){this.onChange();e={internalID:this.getNewInternalId(),id:this.generateNewID("song"),type:"song",song:b.assets.music.cloneSong(e),meta:{displayName:t}};return this.getAssetCollection("song").add(e)}createNewJsonAsset(e,t,i){this.onChange();e={internalID:this.getNewInternalId(),id:this.generateNewID("json"),type:"json",data:e,fileName:t,meta:{displayName:i}};return this.getAssetCollection("json").add(e)}updateTile(t){this.onChange();var e=this.resolveProjectTileByInternalID(t.internalID);if(e){if(this.getAssetCollection("tile").update(e.id,t),e.id!==t.id||!b.sprite.bitmapEquals(e.bitmap,t.bitmap))for(var i of this.getAssets("tilemap"))i.data.tileset.tiles.some(e=>e.internalID===t.internalID)&&(i.data.tileset.tiles=i.data.tileset.tiles.map(e=>e.internalID===t.internalID?t:e),this.updateTilemap(i.id,i.data));return t}return null}deleteTile(e){this.onChange(),this.getAssetCollection("tile").removeByID(e)}getProjectTilesetJRes(t){var e={};return this.getAssetCollection("tile").serializeToJRes(e),this.getAssetCollection("tilemap").serializeToJRes(e,e=>!t||!b.sprite.isTilemapEmptyOrUnused(e,this,t)),e["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:b.sprite.TILE_NAMESPACE},e}getProjectAssetsJRes(){var e,t={};for(e of Object.keys(this.state.assets))"tilemap"!==e&&"tile"!==e&&this.state.assets[e].serializeToJRes(t);return t["*"]={mimeType:"image/x-mkcd-f4",dataEncoding:"base64",namespace:b.sprite.IMAGES_NAMESPACE},t}getTilemap(e){return this.getAssetCollection("tilemap").getByID(e)}updateTilemap(e,t){var i=this.getAssetCollection("tilemap").getByID(e);return i?(this.onChange(),i=Object.assign(Object.assign({},i),{data:t}),this.getAssetCollection("tilemap").update(e,i),i):null}createNewTilemap(e,t,i=16,r=16){return this.createNewTilemapFromData(this.blankTilemap(t,i,r),e)}blankTilemap(e,t=16,i=16){var r=new b.sprite.Tilemap(t,i),t=new b.sprite.Bitmap(t,i),i={tileWidth:e,tiles:[this.getTransparency(e)]};return new b.sprite.TilemapData(r,i,t.data())}resolveTile(e){return this.lookupAsset("tile",e)}resolveProjectTileByInternalID(t){return this.getAssetCollection("tile").getSnapshot(e=>e.internalID===t)[0]}resolveTileByBitmap(e){let t=b.sprite.base64EncodeBitmap(e);return this.getAssetCollection("tile").getSnapshot(e=>e.jresData===t)[0]}getTransparency(e){var t=b.sprite.TILE_NAMESPACE+".transparency"+e;let i=this.getAssetCollection("tile").getByID(t);return i||(e=new b.sprite.Bitmap(e,e).data(),i={internalID:this.getNewInternalId(),id:t,type:"tile",bitmap:e,jresData:b.sprite.base64EncodeBitmap(e),meta:{},isProjectTile:!0},this.getAssetCollection("tile").add(i))}createNewTilemapFromData(e,t){this.onChange();var i=this.generateNewIDInternal("tilemap",t||lf("level"));return this.getAssetCollection("tilemap").add({internalID:this.getNewInternalId(),id:i,type:"tilemap",meta:{displayName:t||i},data:e}),[i,e]}cloneState(){var e,t={revision:this.state.revision,assets:{}};for(e of Object.keys(this.state.assets))t.assets[e]=this.state.assets[e].clone();return t}undo(){if(this.state.revision!==this.committedState.revision&&this.pushUndo(),this.undoStack.length){var e,t=this.undoStack.pop();for(e of Object.keys(t.assetDiffs))this.getAssetCollection(e).applyDiff(t.assetDiffs[e],!0);this.state.revision=t.beforeRevision,this.redoStack.push(t),this.committedState=this.cloneState(),this.needsRebuild=!0}}redo(){if(this.redoStack.length){var e,t=this.redoStack.pop();for(e of Object.keys(t.assetDiffs))this.getAssetCollection(e).applyDiff(t.assetDiffs[e]);this.state.revision=t.afterRevision,this.undoStack.push(t),this.committedState=this.cloneState(),this.needsRebuild=!0}}pushUndo(){if(!this.undoStack.length||this.committedState.revision!==this.state.revision){this.redoStack=[],this.undoStack.push({beforeRevision:this.committedState.revision,afterRevision:this.state.revision,assetDiffs:{}});var e,t=this.undoStack[this.undoStack.length-1];for(e of Object.keys(this.state.assets))t.assetDiffs[e]=this.state.assets[e].diff(this.committedState.assets[e]);this.committedState=this.cloneState(),this.cleanupTemporaryAssets()}}revision(){return this.state.revision}encodeTilemap(e,t){var i=e.tilemap.data(),r=new Uint8ClampedArray(5+i.data.length+e.layers.data.length);return r[0]=e.tileset.tileWidth,r[1]=255&i.width,r[2]=i.width>>8&255,r[3]=255&i.height,r[4]=i.height>>8&255,r.set(i.data,5),r.set(e.layers.data,5+i.data.length),{id:t,mimeType:b.TILEMAP_MIME_TYPE,data:btoa(b.sprite.uint8ArrayToHex(r)),tileset:e.tileset.tiles.map(e=>e.id)}}forceUpdate(){this.onChange()}isNameTaken(t,e){var i=e=>this.getAssetCollection(t).isIDTaken(e)||this.getAssetCollection(t,!0).isIDTaken(e),r=m(t,e),n=r&&r!==e;return i(e)||n&&i(r)}isAssetUsed(i,r,n){var a;if(0<((null==(a=null==(a=i.meta)?void 0:a.blockIDs)?void 0:a.filter(e=>!n||(null==n?void 0:n.indexOf(e))<0))||[]).length)return!0;if("tile"==i.type)for(var e of this.getAssets("tilemap"))if(!(0<=(null==n?void 0:n.indexOf(e.id)))&&e.data.tileset.tiles.some(e=>e.id===i.id))return!0;if(r){var s=b.Util.escapeForRegex(h(i)),o=b.Util.escapeForRegex(null==(a=i.meta)?void 0:a.displayName)||"";let e;switch(i.type){case"tile":e=`myTiles.${s}|assets.tile\`${s}\``,o&&(e+=`|assets.tile\`${o}\``);break;case"tilemap":e=`tilemap\`${s}\``;break;case"animation":e=`assets.animation\`${s}\``,o&&(e+=`|assets.animation\`${o}\``);break;case"song":e=`assets.song\`${s}\``,o&&(e+=`|assets.song\`${o}\``);break;case"json":e=`assets.json\`${s}\``,o&&(e+=`|assets.json\`${o}\``);break;default:e=`assets.image\`${s}\``,o&&(e+=`|assets.image\`${o}\``)}var l=new RegExp(e,"gm");let t;switch(i.type){case"tile":t=`myTiles.${s}|assets.tile("""${s}""")`,o&&(t+=`|assets.tile("""${o}""")`);break;case"tilemap":t=`assets.tilemap("""${s}""")`;break;case"animation":t=`assets.animation("""${s}""")`,o&&(t+=`|assets.animation("""${o}""")`);break;case"song":t=`assets.song("""${s}""")`,o&&(t+=`|assets.song("""${o}""")`);break;case"json":t=`assets.json("""${s}""")`,o&&(t+=`|assets.json("""${o}""")`);break;default:t=`assets.image("""${s}""")`,o&&(t+=`|assets.image("""${o}""")`)}var c,u=new RegExp(t,"gm");for(c of Object.keys(r))if(!(0<=(null==n?void 0:n.indexOf(c)))){var d=r[c];if(c.match(/((?!\.g).{2}|^.{0,1})\.ts$/i)){if(d.content.match(l))return!0}else if(c.endsWith(".py")&&d.content.match(u))return!0}}return!1}lookupAsset(e,t){return this.getAssetCollection(e).getByID(t)||this.getAssetCollection(e,!0).getByID(t)}lookupAssetByName(e,t){return this.getAssetCollection(e).getByDisplayName(t)}lookupAssetByValue(e,t){return this.getAssetCollection(e).getByValue(t)}getAssets(e){return this.getAssetCollection(e).getSnapshot()}getGalleryAssets(e){return this.getAssetCollection(e).getSnapshot()}lookupBlockAsset(e,t){return this.getAssetCollection(e).getSnapshot(e=>-1!==(null==(e=null==(e=e.meta)?void 0:e.blockIDs)?void 0:e.indexOf(t)))[0]}updateAsset(e){return this.onChange(),"tile"!==e.type?this.getAssetCollection(e.type).update(e.id,e):this.updateTile(e)}duplicateAsset(e,t){this.onChange();var i=s(e),r=t||(null==(t=i.meta)?void 0:t.displayName);let n;switch(e.type){case"image":n=this.createNewProjectImage(i.bitmap,r);break;case"tile":n=this.createNewTile(i.bitmap,null,r);break;case"tilemap":var[a,,]=this.createNewTilemapFromData(i.data,r);n=this.getTilemap(a);break;case"animation":n=this.createNewAnimationFromData(i.frames,i.interval,r);break;case"song":n=this.createNewSong(i.song,r);break;case"json":n=this.createNewJsonAsset(i.data,e.fileName,r)}return n}removeAsset(e){this.onChange(),this.getAssetCollection(e.type).removeByID(e.id)}addChangeListener(e,t){this.getAssetCollection(e.type).addListener(e.internalID,t)}removeChangeListener(e,t){this.getAssetCollection(e).removeListener(t)}loadPackage(e){var t,i,r=e.sortedDeps();this.extensionTileSets=[];for(t of r){var n,a,s="this"===t.id;for(n of this.readImages(t.parseJRes(),s))n.meta.package=t.id,("tile"===n.type?this.getAssetCollection("tile",!s):"image"===n.type?this.getAssetCollection("image",!s):"animation"===n.type?this.getAssetCollection("animation",!s):"json"===n.type?this.getAssetCollection("json",!s):s?(a=b.sprite.IMAGES_NAMESPACE+".",n.id.startsWith(a)&&(n.id=n.id.replace(a,b.sprite.SONG_NAMESPACE+".")),this.getAssetCollection("song")):this.getAssetCollection("song",!0)).add(n)}for(i of r){var o,l="this"===i.id;for(o of c(i.parseJRes()))l?this.getAssetCollection("tilemap").add({internalID:this.getNewInternalId(),type:"tilemap",id:o.id,meta:{displayName:o.displayName||o.id,package:e.id},data:y(o,e=>this.resolveTile(e))}):this.getAssetCollection("tilemap",!0).add({internalID:this.getNewInternalId(),type:"tilemap",id:o.id,meta:{displayName:o.displayName||o.id,package:e.id},data:y(o,e=>this.getAssetCollection("tile",!0).getByID(e))})}this.committedState=this.cloneState(),this.undoStack=[],this.redoStack=[]}loadTilemapJRes(e,t=!1,i=!1){e=b.inflateJRes(e);var r,n=this.readImages(e,!i).filter(e=>"tile"===e.type);let a={};if(i)for(var s of n)this.getAssetCollection("tile",!0).add(s);else for(var o of n){if(t){var l=this.resolveTileByBitmap(o.bitmap);if(l){a[o.id]=l.id;continue}}l=this.createNewTile(o.bitmap,o.id,o.meta.displayName);l.id!==o.id&&(a[o.id]=l.id)}for(r of c(e))this.getAssetCollection("tilemap",i).add({internalID:this.getNewInternalId(),type:"tilemap",id:r.id,meta:{displayName:r.displayName||r.id},data:y(r,e=>(a[e]&&(e=a[e]),this.resolveTile(e)))})}loadAssetsJRes(e,t=!1){e=b.inflateJRes(e);var i,r,n=[];for(i of Object.keys(e)){var a,s,o=e[i];o.tilemapTile?this.getAssetCollection("tile",t).add(this.generateImage(o,"tile")):o.mimeType===b.IMAGE_MIME_TYPE?this.getAssetCollection("image",t).add(this.generateImage(o,"image")):o.mimeType===b.ANIMATION_MIME_TYPE?([a,s]=this.generateAnimation(o),s?n.push(a):this.getAssetCollection("animation",t).add(a)):o.mimeType===b.SONG_MIME_TYPE?this.getAssetCollection("song",t).add(this.generateSong(o)):o.mimeType===b.JSON_MIME_TYPE&&this.getAssetCollection("json",t).add(this.generateJsonAsset(o))}for(r of n)this.getAssetCollection("animation",t).add(this.inflateAnimation(r,this.getAssetCollection("image",t).getSnapshot()))}removeInactiveBlockAssets(t){for(var e of Object.keys(this.state.assets)){r=i=s=a=n=void 0;var i,r,n=this.state.assets[e],a=n.getSnapshot(e=>!e.meta.displayName&&(null==(e=e.meta.blockIDs)?void 0:e.some(e=>-1===t.indexOf(e)))),s=[];for(i of a)(1===i.meta.blockIDs.length||(i.meta.blockIDs=i.meta.blockIDs.filter(e=>-1!==t.indexOf(e)),0===i.meta.blockIDs.length))&&s.push(i);for(r of s)n.removeByID(r.id)}}clone(){var e,t=new i;return t.committedState=a(this.committedState),t.state=a(this.state),t.gallery=a(this.gallery),t.extensionTileSets=null==(e=this.extensionTileSets)?void 0:e.map(e=>Object.assign(Object.assign({},e),{tileSets:e.tileSets.map(e=>Object.assign(Object.assign({},e),{tiles:e.tiles.map(e=>s(e))}))})),t.needsRebuild=this.needsRebuild,t.nextID=this.nextID,t.nextInternalID=this.nextInternalID,t.undoStack=this.undoStack.map(e=>o(e)),t.redoStack=this.undoStack.map(e=>o(e)),t}saveGallerySnapshot(){return this.gallery}loadGallerySnapshot(e){this.gallery=e}generateImage(e,t){return{internalID:this.getNewInternalId(),type:t,id:e.id,meta:{displayName:e.displayName,tags:e.tags},jresData:e.data,bitmap:b.sprite.getBitmapFromJResURL(`data:${b.IMAGE_MIME_TYPE};base64,`+e.data).data()}}generateSong(e){return{internalID:this.getNewInternalId(),type:"song",id:e.id,meta:{displayName:e.displayName,tags:e.tags},song:b.assets.music.decodeSongFromHex(e.data)}}generateJsonAsset(e){var t=JSON.parse(e.data);return{internalID:this.getNewInternalId(),type:"json",id:e.id,meta:{displayName:e.displayName,tags:e.tags},data:t.data,fileName:t.fileName}}generateAnimation(t){if("json"!==t.dataEncoding)return[Object.assign(Object.assign({},w(t)),{internalID:this.getNewInternalId()}),!1];{let e;try{e=JSON.parse(t.data)}catch(e){b.warn("could not parse json data of '"+t.id+"'")}return[{internalID:this.getNewInternalId(),type:"animation",meta:{displayName:t.displayName,tags:t.tags},id:t.id,frames:[],frameIds:e.frames,interval:100,flippedHorizontal:e.flippedHorizontal},!0]}}inflateAnimation(e,i){return e.frames=e.frameIds.map(t=>i.find(e=>e.id===t).bitmap),e.flippedHorizontal&&(e.frames=e.frames.map(e=>{var i=b.sprite.Bitmap.fromData(e),r=new b.sprite.Bitmap(e.width,e.height);for(let t=0;t<r.width;t++)for(let e=0;e<r.height;e++)r.set(t,e,i.get(i.width-t-1,e));return r.data()})),e}generateNewID(e){switch(e){case"animation":return this.generateNewIDInternal("animation",b.sprite.ANIMATION_PREFIX,b.sprite.ANIMATION_NAMESPACE);case"image":return this.generateNewIDInternal("image",b.sprite.IMAGE_PREFIX,b.sprite.IMAGES_NAMESPACE);case"tile":return this.generateNewIDInternal("tile",b.sprite.TILE_PREFIX,b.sprite.TILE_NAMESPACE);case"tilemap":return this.generateNewIDInternal("tilemap",lf("level"));case"song":return this.generateNewIDInternal("song",b.sprite.SONG_PREFIX,b.sprite.SONG_NAMESPACE);case"json":return this.generateNewIDInternal("json",b.sprite.JSON_PREFIX,b.sprite.JSON_NAMESPACE)}}generateNewIDInternal(e,t,i){t=t.replace(/\d+$/,"");var r=i?i+"."+t:t;let n=1;for(;this.isNameTaken(e,r+n);)++n;return r+n}onChange(){this.needsRebuild=!0,this.state.revision=this.nextID++}readImages(e,t=!1){var i,r,n=[],a=[];for(i of Object.keys(e)){var s,o,l=e[i];l.tilemapTile?((s=this.generateImage(l,"tile")).isProjectTile=t,n.push(s)):l.mimeType===b.IMAGE_MIME_TYPE?n.push(this.generateImage(l,"image")):l.mimeType===b.ANIMATION_MIME_TYPE?([s,o]=this.generateAnimation(l),(o?a:n).push(s)):l.mimeType===b.SONG_MIME_TYPE?n.push(this.generateSong(l)):l.mimeType===b.JSON_MIME_TYPE&&n.push(this.generateJsonAsset(l))}for(r of a)n.push(this.inflateAnimation(r,n));return n}cleanupTemporaryAssets(){var e,t=this.getAssetCollection("image");for(e of t.getSnapshot(e=>!(e.meta.displayName||null!=(e=e.meta.blockIDs)&&e.length)))t.removeByID(e.id)}getAssetCollection(e,t=!1){return v(t?this.gallery:this.state,e,!0)}}function c(e){var t,i=[];for(t of Object.keys(e)){var r=e[t];r.mimeType===b.TILEMAP_MIME_TYPE&&i.push(r)}return i}function u(e,t){return"\n"+`    helpers._registerFactory("${e}", function(name: string) {
`+`        switch(helpers.stringTrim(name)) {
`+t.map(e=>e.keys.filter(e=>!!e).map(e=>`            case "${e}":`).join("\n")+`return ${e.expression};`).join("\n")+"\n"+`        }
`+`        return null;
`+`    })
`}function n(e){return b.sprite.Bitmap.fromData(e).copy().data()}function y(e,t){var i=atob(e.data),i=b.U.fromHex(i),r=i[1]|i[2]<<8,n=i[3]|i[4]<<8,e=e.tileset.map(e=>t&&t(e)||{id:e});let a=i[0];var s={tileWidth:a=(a=a||e.length&&(null==(s=e.find(e=>null==(e=e.bitmap)?void 0:e.width))?void 0:s.bitmap.width))||16,tiles:e},e=i.slice(5,5+r*n),o=new b.sprite.Tilemap(r,n,0,0,new Uint8ClampedArray(e)),i=i.slice(5+e.length),e=new b.sprite.Bitmap(r,n,0,0,new Uint8ClampedArray(i)).data();return new b.sprite.TilemapData(o,s,e)}function s(e,t=!1){switch(e.meta=Object.assign({},e.meta),e.meta.temporaryInfo&&(e.meta.temporaryInfo=Object.assign({},e.meta.temporaryInfo)),e.type){case"tile":case"image":return Object.assign(Object.assign({},e),{bitmap:n(e.bitmap)});case"animation":return Object.assign(Object.assign({},e),{frames:e.frames.map(e=>n(e))});case"tilemap":return Object.assign(Object.assign({},e),{data:e.data.cloneData(t)});case"song":return Object.assign(Object.assign({},e),{song:b.assets.music.cloneSong(e.song)});case"json":return Object.assign(Object.assign({},e),{data:b.U.clone(e.data)})}}function a(e){var t,i={revision:e.revision,assets:{}};for(t of Object.keys(e.assets)){var r=e.assets[t];i.assets[t]=r.clone()}return i}function o(e){var t,i=Object.assign(Object.assign({},e),{assetDiffs:{}});for(t of Object.keys(e.assetDiffs)){var r=e.assetDiffs[t];i.assetDiffs[t]=(r=r,Object.assign(Object.assign({},r),{before:r.before.map(e=>s(e)),after:r.after.map(e=>s(e))}))}return i}function l(e,t,i=!1){if(e==t)return!0;if(!e&&t||!t&&e||e.type!==t.type)return!1;if(!(i||e.id===t.id&&b.U.arrayEquals(e.meta.tags,t.meta.tags)&&b.U.arrayEquals(e.meta.blockIDs,t.meta.blockIDs)&&e.meta.displayName===t.meta.displayName))return!1;switch(e.type){case"image":case"tile":return b.sprite.bitmapEquals(e.bitmap,t.bitmap);case"animation":return e.interval===t.interval&&b.U.arrayEquals(e.frames,t.frames,b.sprite.bitmapEquals);case"tilemap":return e.data.equals(t.data);case"song":return b.assets.music.songEquals(e.song,t.song);case"json":return e.fileName===t.fileName&&b.U.deepEqual(e.data,t.data)}}function d(e){e=/^\s*(?:(?:assets\s*\.\s*(image|tile|animation|tilemap|song))|(tilemap))\s*(?:`|\(""")([^`"]+)(?:`|"""\))\s*$/m.exec(e);if(e)return{type:e[1]||e[2],name:e[3].trim()}}function h(e){return m(e.type,e.id)}function p(e){if(!e)return!1;switch(e.type){case"image":case"tile":return!!(r=e).bitmap&&f(b.sprite.Bitmap.fromData(r.bitmap));case"tilemap":return!!((r=e).data&&r.data.tilemap&&r.data.tileset&&r.data.tileset.tileWidth&&null!=(i=r.data.tileset.tiles)&&i.length&&r.data.layers)&&f(b.sprite.Bitmap.fromData(r.data.layers))&&f(r.data.tilemap);case"animation":i=e;return!(null==(t=i.frames)||!t.length||i.interval<=0||i.frames.some(e=>!f(b.sprite.Bitmap.fromData(e))));case"song":return(t=e).song&&0<t.song.ticksPerBeat&&0<t.song.beatsPerMeasure&&0<t.song.measures&&0<t.song.beatsPerMinute&&!!t.song.tracks;case"json":return!!e.data}var t,i,r}function f(e){return 0<e.width&&0<e.height&&!Number.isNaN(e.x0)&&!Number.isNaN(e.y0)&&e.data().data.length===e.dataLength()}function m(e,t,i=!1){let r;switch(e){case"image":r=b.sprite.IMAGES_NAMESPACE+".";break;case"tile":r=b.sprite.TILE_NAMESPACE+".";break;case"tilemap":r="";break;case"animation":r=b.sprite.ANIMATION_NAMESPACE+".";break;case"song":r=b.sprite.SONG_NAMESPACE+".";break;case"json":r=b.sprite.JSON_NAMESPACE+"."}if(r)if(t.startsWith(r)){e=t.substr(r.length);if(-1===e.indexOf("."))return e}else if(!i)return null;return t}function w(e){var t=atob(e.data),i=new Uint8ClampedArray(b.U.fromHex(t)),t=g(i,0),r=g(i,2),n=g(i,4),a=g(i,6),s=Math.ceil(r*n/2);let o=8;var l=[];for(let e=0;e<a;e++){var c=i.slice(o,o+s);l.push({x0:0,y0:0,width:r,height:n,data:c}),o+=s}let u=e.id;return{type:"animation",internalID:0,id:u=u.startsWith(e.namespace)?u:(u=e.namespace+"."+u).replace(/\.\./g,"."),interval:t,frames:l,meta:{displayName:e.displayName,tags:e.tags}}}function g(e,t){return e[t]|e[t+1]<<8}function v(e,t,i=!1){if(!e.assets[t]){if(!i)return;e.assets[t]=new r(t)}return e.assets[t]}b.TilemapProject=i,b.emitGalleryDeclarations=function(r,n){var e=Object.keys(r);let a="";var i={};let s={};var o,l,c={},u=e=>{let t=r[e].namespace||r["*"].namespace;e=r[e].id||e;return t&&(t.endsWith(".")&&(t=t.slice(0,t.length-1)),!e.startsWith(t+"."))?t+"."+e:e};r["*"]&&(c["*"]=Object.assign(Object.assign({},r["*"]),{namespace:n}));for(o of e)if("*"!==o){var d=r[o],h=u(o);let t=ts.pxtc.escapeIdentifier(d.displayName||h.split(".").pop());if(i[t]){var p=t;let e=2;for(;i[t];)t=p+e,e++}i[t]=!0,s[h]=n+"."+t}for(l of e)if("*"!==l){var f=r[l],m=f.mimeType||(null==(m=r["*"])?void 0:m.mimeType);let e,t;var g,v=s[u(l)].split(".").pop();let i=f.tags;i||(i=[],-1!==v.toLowerCase().indexOf("background")&&i.push("background"),-1!==v.toLowerCase().indexOf("dialog")&&i.push("dialog"),f.tilemapTile&&i.push("tile")),m===b.IMAGE_MIME_TYPE?(t="image.ofBuffer(hex``)",e=f.tilemapTile?"images._tile":"images._image"):m===b.ANIMATION_MIME_TYPE?(g=w(f),t=`[${g.frames.map(e=>b.sprite.bitmapToImageLiteral(b.sprite.Bitmap.fromData(e),"typescript")).join(",")}]`):m===b.TILEMAP_MIME_TYPE?(g=y(f),t=b.sprite.encodeTilemap(g,"typescript",s)):m===b.SONG_MIME_TYPE?t=`hex\`${f.data}\``:m===b.JSON_MIME_TYPE&&(t=f.data),a+=`    //% fixedInstance jres whenUsed
`,e&&(a+=`    //% blockIdentity=${e}
`),i.length&&(a+=`    //% tags="${i.join(" ")}"
`),a+=`    export const ${v} = ${t};
`,"string"==typeof f?c[v]=f:(c[v]=Object.assign(Object.assign({},f),{id:s[u(l)],tags:i}),f.namespace&&(c[v].namespace=n,f.namespace.endsWith("."))&&(c[v].namespace+="."),c[v].tileset&&(c[v].tileset=f.tileset.map(e=>s[e]||e)))}return e=lf("Auto-generated code. Do not edit."),[c,`// ${e}
namespace ${n} {
${a}
}
// ${e}
`]},b.emitTilemapsFromJRes=function(e){let t="";var i,r=[],n=[];for(i of Object.keys(e))if("*"!==i){var a,s=e[i];if(s.tilemapTile){let e=i;-1!==e.indexOf(".")&&(e=e.split(".").slice(-1)[0]),t=(t+=`    //% fixedInstance jres blockIdentity=images._tile
`)+`    export const ${e} = image.ofBuffer(hex\`\`);
`,n.push({keys:[s.displayName,m("tile",i,!0)],expression:i})}s.mimeType===b.TILEMAP_MIME_TYPE&&(a=y(s),r.push({keys:[s.displayName,m("tilemap",s.id)],expression:b.sprite.encodeTilemap(a,"typescript")}))}r.length&&(t+=u("tilemap",r)),n.length&&(t+=u("tile",n));var o=lf("Auto-generated code. Do not edit.");return`// ${o}
namespace ${b.sprite.TILE_NAMESPACE} {
${t}
}
// ${o}
`},b.emitProjectImages=function(e){var t,i="",r=[],n=[],a=[],s=[];for(t of Object.keys(e))if("*"!==t){var o=e[t];if("string"==typeof o||o.mimeType===b.IMAGE_MIME_TYPE){let e;var l=[m("image",t,!0)];"string"==typeof o?e=b.sprite.bitmapToImageLiteral(b.sprite.getBitmapFromJResURL(o),"typescript"):(e=b.sprite.bitmapToImageLiteral(b.sprite.getBitmapFromJResURL(o.data),"typescript"),l.push(o.displayName)),r.push({keys:l,expression:e})}else o.mimeType===b.ANIMATION_MIME_TYPE?(l=w(o),n.push({keys:[o.displayName,m("animation",t,!0)],expression:`[${l.frames.map(e=>b.sprite.bitmapToImageLiteral(b.sprite.Bitmap.fromData(e),"typescript")).join(", ")}]`})):o.mimeType===b.SONG_MIME_TYPE?a.push({keys:[m("song",t,!0),o.displayName],expression:`hex\`${o.data}\``}):o.mimeType===b.JSON_MIME_TYPE&&s.push({keys:[m("json",t,!0),o.displayName],expression:o.data})}var c=lf("Auto-generated code. Do not edit."),i=(i=(i=(i+=u("image",r))+u("animation",n))+u("song",a))+u("json",s);return`// ${c}
namespace ${b.sprite.IMAGES_NAMESPACE} {
${i}
}
// ${c}
`},b.cloneAsset=s,b.assetEquals=l,b.validateAssetName=function(e){return!!e&&!/[\u0000-\u001f\u0021-\u002c\u002e\u002f\u003a-\u0040\u005b-\u005e\u0060\u007b-\u007f]/.test(e)},b.getTSReferenceForAsset=function(e,t=!1){let i,r;if(!(r=null!=(i=e.meta)&&i.displayName?e.meta.displayName:h(e)))return"image"===e.type||"tile"===e.type?e.id:void 0;var n=t?'("""':"`",a=t?'""")':"`";switch(e.type){case"tile":return"assets.tile"+n+r+a;case"image":return"assets.image"+n+r+a;case"animation":return"assets.animation"+n+r+a;case"tilemap":return"tilemap"+n+r+a;case"song":return"assets.song"+n+r+a;case"json":return"assets.json"+n+r+a}},b.parseAssetTSReference=d,b.lookupProjectAssetByTSReference=function(e,t){if(e=d(e)){var{type:e,name:i}=e;switch(e){case"tile":return t.lookupAssetByName("tile",i);case"image":return t.lookupAssetByName("image",i);case"tilemap":return t.lookupAssetByName("tilemap",i)||t.lookupAsset("tilemap",i);case"animation":return t.lookupAssetByName("animation",i);case"song":return t.lookupAssetByName("song",i);case"json":return t.lookupAssetByName("json",i)}}},b.getDefaultAssetDisplayName=function(e){switch(e){case"image":return lf("myImage");case"tile":return lf("myTile");case"tilemap":return lf("level");case"animation":return lf("myAnim");case"song":return lf("mySong");case"json":return lf("myFile");default:return lf("asset")}},b.getShortIDForAsset=h,b.validateAsset=p,b.patchTemporaryAsset=function(e,t,i){var r;return e&&!l(e,t)&&(t=s(t,!0),e=-1===e.internalID,r=-1===t.internalID,e&&!r)&&(t.id=i.generateNewID(t.type),t.internalID=i.getNewInternalId()),t}})(pxt=pxt||{}),(n=>{{var e=n.toolbox||(n.toolbox={});let i={},r=(e.blockColors={loops:"#107c10",logic:"#006970",math:"#712672",variables:"#A80000",functions:"#005a9e",text:"#996600",arrays:"#A94400",advanced:"#3c3c3c",addpackage:"#717171",search:"#000",debug:"#e03030",default:"#dddddd",topblocks:"#aa8f00",recipes:"#717171"},e.blockIcons={loops:"",logic:"",math:"",variables:"",functions:"",text:"",arrays:"",advancedcollapsed:"",advancedexpanded:"",more:"",addpackage:"",search:"",debug:"",default:"",topblocks:"",recipes:""},"");function a(e){e=((e,t,i)=>{let r=0,n=0,a=0;if(0==t)r=i,n=i,a=i;else{var s=Math.floor(e/60),e=e/60-s,o=i*(1-t),l=i*(1-t*e),c=i*(1-t*(1-e));switch(s){case 1:r=l,n=i,a=o;break;case 2:r=o,n=i,a=c;break;case 3:r=o,n=l,a=i;break;case 4:r=c,n=o,a=i;break;case 5:r=i,n=o,a=l;break;case 6:case 0:r=i,n=c,a=o}}return[Math.floor(r),Math.floor(n),Math.floor(a)]})(e,.45,165.75);return"#"+t(e[0])+t(e[1])+t(e[2])}function t(e){e=e.toString(16);return 1==e.length?"0"+e:e}function s(e){var t;return null!=(t=null==(t=n.appTarget)?void 0:t.appTheme)&&t.adjustBlockContrast?(i[e]||(i[e]=n.getWhiteContrastingBackground(e)),i[e]):e}e.appendToolboxIconCss=function(e,t){var i;-1<r.indexOf(e)||(1===t.length?(i=n.Util.unicodeToChar(t),r+=`
                .blocklyTreeIcon.${e}::before {
                    content: "${i}";
                }
            `):r+=`
                .blocklyTreeIcon.${e} {
                    background-image: url("${n.Util.pathJoin(n.webConfig.commitCdnUrl,encodeURI(t))}")!important;
                    width: 30px;
                    height: 100%;
                    background-size: 20px !important;
                    background-repeat: no-repeat !important;
                    background-position: 50% 50% !important;
                }
            `)},e.getNamespaceColor=function(e){e=e.toLowerCase();let t;return n.appTarget.appTheme.blockColors&&n.appTarget.appTheme.blockColors[e]?t=n.appTarget.appTheme.blockColors[e]:n.toolbox.blockColors[e]&&(t=n.toolbox.blockColors[e]),t?s(t):""},e.getNamespaceIcon=function(e){return e=e.toLowerCase(),n.appTarget.appTheme.blockIcons&&n.appTarget.appTheme.blockIcons[e]?n.appTarget.appTheme.blockIcons[e]:n.toolbox.blockIcons[e]||""},e.advancedTitle=function(){return n.Util.lf("{id:category}Advanced")},e.addPackageTitle=function(){return n.Util.lf("{id:category}Extensions")},e.recipesTitle=function(){return n.Util.lf("{id:category}Tutorials")},e.convertColor=function(e){e=(t=e)?"0x"==t.substring(0,2)?"#"+t.substring(2):t:"#000000";var t=parseInt(e);return isNaN(t)?e:a(t)},e.hueToRgb=a,e.fadeColor=function(t,i,r){(t=t.replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);let n="#";for(let e=0;e<3;e++){var a=parseInt(t.substr(2*e,2),16),a=(a=Math.round(Math.min(Math.max(0,r?a+a*i:a-a*i),255))).toString(16);n+=("00"+a).substr(a.length)}return n},e.getAccessibleBackground=s}})(pxt=pxt||{}),(y=>{{var e=y.tutorial||(y.tutorial={});let v=/^##[^#](.*)$([\s\S]*?)(?=^##[^#]|$(?![\r\n]))/gim,b=/^###[^#](.*)$([\s\S]*?)(?=^###[^#]|$(?![\r\n]))/gim;function w(){return/``` *(sim|block|blocks|filterblocks|spy|ghost|typescript|ts|js|javascript|template|python|jres|assetjson|customts|simtheme|python-template|ts-template|typescript-template|js-template|javascript-template)\s*\n([\s\S]*?)\n```/gim}function A(e,t,o){t=t||v;let l=[];if(e.replace(t,function(e,t,i){var{header:r,hint:n}=((e,t)=>{let i=e=E(e),r;return t?(t=/#+ ~ tutorialhint([\s\S]*)/i,i=e.replace(t,function(e,t){return r=t,""})):(t=e.match(/(^[\s\S]*?\S)\s*((```|\[?\!\[[\s\S]+?\]\(\S+?\)\]?)[\s\S]*)/im))&&2<t.length&&(i=t[1].trim(),r=t[2].trim()),{header:i,hint:r}})(i=i.trim(),o&&o.explicitHints),a=k("local",i),s=T("local",i),i={title:t.match(/^\{.*\}$/)?void 0:t.replace(/@(fullscreen|unplugged|showdialog|showhint|tutorialCompleted|resetDiff)/gi,"").trim(),contentMd:i,headerContentMd:r,localBlockConfig:a,localValidationConfig:s};return/@(fullscreen|unplugged|showdialog|showhint)/i.test(t)&&(i.showHint=!0),/@(unplugged|showdialog)/i.test(t)&&(i.showDialog=!0),/@tutorialCompleted/.test(t)&&(i.tutorialCompleted=!0),/@resetDiff/.test(t)&&(i.resetDiff=!0),n&&(i.hintContentMd=n),l.push(i),""}),0!=e.indexOf("# Not found"))return l;y.debug("tutorial not found")}function k(e,t){let i={md:"",blocks:[]};e=new RegExp(`\`\`\`\\s*blockconfig\\.${e}\\s*\\n([\\s\\S]*?)\\n\`\`\``,"gmi");return t.replace(e,(e,t)=>(i.md+=t+`
`,"")),i}function T(e,t){let i;e=new RegExp(`\`\`\`\\s*validation\\.${e}\\s*\\n([\\s\\S]*?)\\n\`\`\``,"gmi");return t.replace(e,(e,t)=>(i=t,"")),i&&""!=i?{validatorsMetadata:y.getSectionsFromMarkdownMetadata(i).map(e=>({validatorType:e.header,properties:e.attributes}))}:null}function E(e){return e&&e.replace(/```(filterblocks|package|ghost|config|template|jres|assetjson|simtheme|customts|blockconfig\.local|blockconfig\.global|validation\.local|validation\.global)\s*\n([\s\S]*?)\n```/gim,"").trim()}function x(e){if(e)return e=JSON.parse(e),{[y.TILEMAP_JRES]:e[y.TILEMAP_JRES],[y.TILEMAP_CODE]:e[y.TILEMAP_CODE],[y.IMAGES_JRES]:e[y.IMAGES_JRES],[y.IMAGES_CODE]:e[y.IMAGES_CODE]}}function C(e){var t,e=y.Util.jsonTryParse(e);if(e)return t={},e.theme&&(t.theme=e.theme),e.palette&&(t.palette=e.palette),t}e.parseTutorial=function(e){var{metadata:t,body:i}=(e=>{let r={},t=e.replace(/### @(\S+) ([ \S]+)/gi,function(e,t,i){try{r[t]=JSON.parse(i)}catch(e){r[t]=i}return""}),i=r;return void 0!==i.explicitHints&&y.appTarget.appTheme&&y.appTarget.appTheme.tutorialExplicitHints&&(i.explicitHints=!0),{metadata:i,body:t}})(e),{steps:r,activities:n}=((t,i)=>{if(i&&i.activities){var o=i;let a=[],s=[];return t.replace(v,function(e,t,i){let r=s.length,n=(s.push({name:t||lf("Activity {0}",r),step:a.length}),A(i,b,o));return n=n.map(e=>(e.activity=r,e)),a=a.concat(n),""}),{steps:a,activities:s}}{let e=A(t,null,i);return{steps:e=!e||e.length<1?A(t,b,i):e,activities:null}}})(i,t),a=(e=>(e=e.match(/^#[^#](.*)$/im))&&1<e.length?e[1].trim():null)(i);if(r){var{code:i,templateCode:s,templateLanguage:o,editor:l,language:c,jres:u,assetJson:d,customTs:h,simThemeJson:p}=(e=>{let t=void 0,i=w(),r,n=[],a,s,o,l=0,c,u,d;return e.replace(/((?!.)\s)+/g,"\n").replace(i,function(e,t,i){switch(t){case"block":case"blocks":case"blockconfig.local":case"blockconfig.global":case"filterblocks":if(h(y.BLOCKS_PROJECT_NAME))break;return;case"spy":case"python":if(!h(y.PYTHON_PROJECT_NAME))return;"python"==t&&(o=t);break;case"typescript":case"ts":case"javascript":case"js":if(h(y.JAVASCRIPT_PROJECT_NAME))break;return;case"template":a=i;break;case"python-template":if(!h(y.PYTHON_PROJECT_NAME))return;a=i,s="python",o="python";break;case"ts-template":case"typescript-template":case"js-template":case"javascript-template":if(!h(y.JAVASCRIPT_PROJECT_NAME))return;a=i,s="typescript";break;case"jres":r=i;break;case"assetjson":c=i;break;case"simtheme":d=i;break;case"customts":u=i,i=""}return n.push("python"===o?`
${i}
`:`{
${i}
}`),l++,""}),t=t||y.BLOCKS_PROJECT_NAME,{code:n,templateCode:a,templateLanguage:s,editor:t,language:o,jres:r,assetJson:c,customTs:u,simThemeJson:d};function h(e){if(!t||t==e)return t=e,1;y.debug("tutorial ambiguous: contains snippets of different types")}})(i);if(y.BrowserUtils.useOldTutorialLayout()&&"python"===c&&t.flyoutOnly&&(t.flyoutOnly=!1,t.hideToolbox=!0),!0===t.diffs||!1!==t.diffs&&!0!==t.noDiffs&&(l==y.BLOCKS_PROJECT_NAME&&y.appTarget.appTheme.tutorialBlocksDiff||l!=y.BLOCKS_PROJECT_NAME&&y.appTarget.appTheme.tutorialTextDiff)){var f=r;var m=n;let l=void 0;function g(e){let s={typescript:"diff",spy:"diffspy",blocks:"diffblocks",python:"diff"},o=/\s*(\/\/|#)\s*@highlight/gm;return e&&e.replace(/```(typescript|spy|python|blocks|ghost|template)((?:.|[\r\n])+)```/,function(e,t,i){var r=l,n=/^(template|ghost)$/.test(t),a=o.test(i);return i=i.replace(/^\n+/,"").replace(/\n+$/,""),a&&(i=i.replace(o,"")),l=i,!r||a||n?e:`\`\`\`${s[t]}
${r}
----------
${i}
\`\`\``})}f.forEach((e,t)=>{if((e.resetDiff||m&&m.find(e=>e.step==t))&&(l=void 0),e.hintContentMd){var i=g(e.hintContentMd);if(i&&i!=e.hintContentMd)return void(e.hintContentMd=i)}e.headerContentMd&&(i=g(e.headerContentMd))&&i!=e.headerContentMd&&(e.headerContentMd=i)})}f=x(d),d=C(p),p=k("global",e),e=T("global",e);return r.forEach(e=>{e.contentMd=E(e.contentMd),e.headerContentMd=E(e.headerContentMd),e.hintContentMd=E(e.hintContentMd)}),{editor:l,title:a,steps:r,activities:n,code:i,templateCode:s,templateLanguage:o,metadata:t,language:c,jres:u,assetFiles:f,customTs:h,globalBlockConfig:p,globalValidationConfig:e,simTheme:d}}},e.getMetadataRegex=w,e.highlight=function(i){let e=i.textContent;if(e=(e=e.replace(/img\s*\(\s*"{3}[\s\da-f.#tngrpoyw]*"{3}\s*\)/g,'img(""" """)')).replace(/img\s*`[\s\da-f.#tngrpoyw]*`\s*/g,"img` `"),/@highlight/.test(e)){i.textContent="";var r,n=e.split("\n");for(let t=0;t<n.length;++t){0<t&&t<n.length&&i.appendChild(document.createTextNode("\n"));let e=n[t];/@highlight/.test(e)?void 0!==(e=n[++t])&&((r=document.createElement("span")).className="highlight-line",r.textContent=e,i.appendChild(r)):i.appendChild(document.createTextNode(e))}}else i.textContent=e},e.getTutorialOptions=function(e,t,i,r,n){var a=y.tutorial.parseTutorial(e);if(a)return{options:{tutorial:t,tutorialName:a.title||i,tutorialReportId:r,tutorialStep:0,tutorialReady:!0,tutorialHintCounter:0,tutorialStepInfo:a.steps,tutorialActivityInfo:a.activities,tutorialMd:e,tutorialCode:a.code,tutorialRecipe:!!n,templateCode:a.templateCode,templateLanguage:a.templateLanguage,autoexpandStep:null==(t=a.metadata)||!t.autoexpandOff,metadata:a.metadata,language:a.language,jres:a.jres,assetFiles:a.assetFiles,customTs:a.customTs,globalBlockConfig:a.globalBlockConfig,globalValidationConfig:a.globalValidationConfig,simTheme:a.simTheme},editor:a.editor};throw new Error(lf("Invalid tutorial format"))},e.parseCachedTutorialInfo=function(e,n){let a=y.Util.jsonTryParse(e);return a?y.BrowserUtils.tutorialInfoDbAsync().then(e=>{if(n&&a[n]){var t=a[n];t.usedBlocks&&t.hash&&e.setWithHashAsync(n,t.snippetBlocks,t.hash,t.highlightBlocks,t.validateBlocks)}else for(var i of Object.keys(a)){var r=a[i];r.usedBlocks&&r.hash&&e.setWithHashAsync(i,r.snippetBlocks,r.hash,r.highlightBlocks,r.validateBlocks)}}).catch(e=>{}):Promise.resolve()},e.resolveLocalizedMarkdown=function(e,t,i){let r=i||e.fileName||"README",n=(r.endsWith(".md")||(r+=".md"),void 0);var[i,e,a]=y.Util.normalizeLanguageCode(y.Util.userLanguage());return n=(n=i&&e&&a?t[`_locales/${i}/`+r]||t[`_locales/${a}/`+r]||t[`_locales/${e}/`+r]:t[`_locales/${i}/`+r])||t[r]},e.parseAssetJson=x,e.parseSimThemeJson=C,e.getTutorialHighlightedBlocks=async function(e){return null==(e=await(await y.BrowserUtils.tutorialInfoDbAsync()).getAsync(e.tutorial,e.tutorialCode))?void 0:e.highlightBlocks},e.getTutorialValidateBlocks=async function(e){return null==(e=await(await y.BrowserUtils.tutorialInfoDbAsync()).getAsync(e.tutorial,e.tutorialCode))?void 0:e.validateBlocks},e.getRequiredBlockCounts=function(e){if(e){let t={};e=e["validate-exists"];return e&&e.forEach(e=>{t[e]=(t[e]||0)+1}),t}},e.getTutorialStepHash=function(e){var{tutorialStepInfo:e,tutorialStep:t}=e,e=(e=>{let r=[];return null==e||e.replace(/((?!.)\s)+/g,"\n").replace(/``` *(block|blocks)\s*\n([\s\S]*?)\n```/gim,function(e,t,i){return r.push(`{
${i}
}`),""}),r})(e[t].hintContentMd);return y.BrowserUtils.getTutorialCodeHash(e)},e.shouldFilterProject=function(e){return!(!e||!e.hideFromProjects&&!e.hideIteration)}}})(pxt=pxt||{}),(o=>{var e;{var l=o.pxtc||(o.pxtc={});l.flattenDiagnosticMessageText=function(r,n){if("string"==typeof r)return r;{let e=r,t="",i=0;for(;e;){if(i){t+=n;for(let e=0;e<i;e++)t+="  "}t+=e.messageText,i++,e=e.next}return t}};let i,r=((e=i=l.ScriptTarget||(l.ScriptTarget={}))[e.ES3=0]="ES3",e[e.ES5=1]="ES5",e[e.ES6=2]="ES6",e[e.ES2015=2]="ES2015",e[e.Latest=2]="Latest",l.isIdentifierStart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||36===e||95===e||127<e&&c(e,t)},l.isIdentifierPart=function(e,t){return 65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||36===e||95===e||127<e&&(e=e,t>=i.ES5?u(e,n):u(e,s))},l.reservedWords=["abstract","any","as","break","case","catch","class","continue","const","constructor","debugger","declare","default","delete","do","else","enum","export","extends","false","finally","for","from","function","get","if","implements","import","in","instanceof","interface","is","let","module","namespace","new","null","package","private","protected","public","require","global","return","set","static","super","switch","symbol","this","throw","true","try","type","typeof","var","void","while","with","yield","async","await","of","Math"],l.keywordTypes=["boolean","number","string"],l.escapeIdentifier=function(e){if(!e)return"_";let t=e.replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_$]/g,e=>o.pxtc.isIdentifierPart(e.charCodeAt(0),o.pxtc.ScriptTarget.ES5)?e:"");return t=t&&o.pxtc.isIdentifierStart(t.charCodeAt(0),o.pxtc.ScriptTarget.ES5)&&-1===l.reservedWords.indexOf(t)?t:"_"+t},[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,880,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1162,1319,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1568,1610,1646,1647,1649,1747,1749,1749,1765,1766,1774,1775,1786,1788,1791,1791,1808,1808,1810,1839,1869,1957,1969,1969,1994,2026,2036,2037,2042,2042,2048,2069,2074,2074,2084,2084,2088,2088,2112,2136,2208,2208,2210,2220,2308,2361,2365,2365,2384,2384,2392,2401,2417,2423,2425,2431,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2493,2493,2510,2510,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2785,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2877,2877,2908,2909,2911,2913,2929,2929,2947,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3024,3024,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3133,3160,3161,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3261,3261,3294,3294,3296,3297,3313,3314,3333,3340,3342,3344,3346,3386,3389,3389,3406,3406,3424,3425,3450,3455,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3807,3840,3840,3904,3911,3913,3948,3976,3980,4096,4138,4159,4159,4176,4181,4186,4189,4193,4193,4197,4198,4206,4208,4213,4225,4238,4238,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5905,5920,5937,5952,5969,5984,5996,5998,6e3,6016,6067,6103,6103,6108,6108,6176,6263,6272,6312,6314,6314,6320,6389,6400,6428,6480,6509,6512,6516,6528,6571,6593,6599,6656,6678,6688,6740,6823,6823,6917,6963,6981,6987,7043,7072,7086,7087,7098,7141,7168,7203,7245,7247,7258,7293,7401,7404,7406,7409,7413,7414,7424,7615,7680,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8305,8305,8319,8319,8336,8348,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11502,11506,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11648,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11823,11823,12293,12295,12321,12329,12337,12341,12344,12348,12353,12438,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42527,42538,42539,42560,42606,42623,42647,42656,42735,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43009,43011,43013,43015,43018,43020,43042,43072,43123,43138,43187,43250,43255,43259,43259,43274,43301,43312,43334,43360,43388,43396,43442,43471,43471,43520,43560,43584,43586,43588,43595,43616,43638,43642,43642,43648,43695,43697,43697,43701,43702,43705,43709,43712,43712,43714,43714,43739,43741,43744,43754,43762,43764,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44002,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500]),n=[170,170,181,181,186,186,192,214,216,246,248,705,710,721,736,740,748,748,750,750,768,884,886,887,890,893,902,902,904,906,908,908,910,929,931,1013,1015,1153,1155,1159,1162,1319,1329,1366,1369,1369,1377,1415,1425,1469,1471,1471,1473,1474,1476,1477,1479,1479,1488,1514,1520,1522,1552,1562,1568,1641,1646,1747,1749,1756,1759,1768,1770,1788,1791,1791,1808,1866,1869,1969,1984,2037,2042,2042,2048,2093,2112,2139,2208,2208,2210,2220,2276,2302,2304,2403,2406,2415,2417,2423,2425,2431,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2500,2503,2504,2507,2510,2519,2519,2524,2525,2527,2531,2534,2545,2561,2563,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2641,2641,2649,2652,2654,2654,2662,2677,2689,2691,2693,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2787,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2869,2873,2876,2884,2887,2888,2891,2893,2902,2903,2908,2909,2911,2915,2918,2927,2929,2929,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,3001,3006,3010,3014,3016,3018,3021,3024,3024,3031,3031,3046,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3133,3140,3142,3144,3146,3149,3157,3158,3160,3161,3168,3171,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3260,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3299,3302,3311,3313,3314,3330,3331,3333,3340,3342,3344,3346,3386,3389,3396,3398,3400,3402,3406,3415,3415,3424,3427,3430,3439,3450,3455,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3807,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3948,3953,3972,3974,3991,3993,4028,4038,4038,4096,4169,4176,4253,4256,4293,4295,4295,4301,4301,4304,4346,4348,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4744,4746,4749,4752,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4822,4824,4880,4882,4885,4888,4954,4957,4959,4992,5007,5024,5108,5121,5740,5743,5759,5761,5786,5792,5866,5870,5872,5888,5900,5902,5908,5920,5940,5952,5971,5984,5996,5998,6e3,6002,6003,6016,6099,6103,6103,6108,6109,6112,6121,6155,6157,6160,6169,6176,6263,6272,6314,6320,6389,6400,6428,6432,6443,6448,6459,6470,6509,6512,6516,6528,6571,6576,6601,6608,6617,6656,6683,6688,6750,6752,6780,6783,6793,6800,6809,6823,6823,6912,6987,6992,7001,7019,7027,7040,7155,7168,7223,7232,7241,7245,7293,7376,7378,7380,7414,7424,7654,7676,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8204,8205,8255,8256,8276,8276,8305,8305,8319,8319,8336,8348,8400,8412,8417,8417,8421,8432,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8505,8508,8511,8517,8521,8526,8526,8544,8584,11264,11310,11312,11358,11360,11492,11499,11507,11520,11557,11559,11559,11565,11565,11568,11623,11631,11631,11647,11670,11680,11686,11688,11694,11696,11702,11704,11710,11712,11718,11720,11726,11728,11734,11736,11742,11744,11775,11823,11823,12293,12295,12321,12335,12337,12341,12344,12348,12353,12438,12441,12442,12445,12447,12449,12538,12540,12543,12549,12589,12593,12686,12704,12730,12784,12799,13312,19893,19968,40908,40960,42124,42192,42237,42240,42508,42512,42539,42560,42607,42612,42621,42623,42647,42655,42737,42775,42783,42786,42888,42891,42894,42896,42899,42912,42922,43e3,43047,43072,43123,43136,43204,43216,43225,43232,43255,43259,43259,43264,43309,43312,43347,43360,43388,43392,43456,43471,43481,43520,43574,43584,43597,43600,43609,43616,43638,43642,43643,43648,43714,43739,43741,43744,43759,43762,43766,43777,43782,43785,43790,43793,43798,43808,43814,43816,43822,43968,44010,44012,44013,44016,44025,44032,55203,55216,55238,55243,55291,63744,64109,64112,64217,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65024,65039,65056,65062,65075,65076,65101,65103,65136,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],a=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1488,1514,1520,1522,1569,1594,1600,1610,1649,1747,1749,1749,1765,1766,1786,1788,1808,1808,1810,1836,1920,1957,2309,2361,2365,2365,2384,2384,2392,2401,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2524,2525,2527,2529,2544,2545,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2649,2652,2654,2654,2674,2676,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2749,2749,2768,2768,2784,2784,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2877,2877,2908,2909,2911,2913,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3168,3169,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3294,3294,3296,3297,3333,3340,3342,3344,3346,3368,3370,3385,3424,3425,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3585,3632,3634,3635,3648,3654,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3760,3762,3763,3773,3773,3776,3780,3782,3782,3804,3805,3840,3840,3904,3911,3913,3946,3976,3979,4096,4129,4131,4135,4137,4138,4176,4181,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6067,6176,6263,6272,6312,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8319,8319,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12329,12337,12341,12344,12346,12353,12436,12445,12446,12449,12538,12540,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64285,64287,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65136,65138,65140,65140,65142,65276,65313,65338,65345,65370,65382,65470,65474,65479,65482,65487,65490,65495,65498,65500],s=[170,170,181,181,186,186,192,214,216,246,248,543,546,563,592,685,688,696,699,705,720,721,736,740,750,750,768,846,864,866,890,890,902,902,904,906,908,908,910,929,931,974,976,983,986,1011,1024,1153,1155,1158,1164,1220,1223,1224,1227,1228,1232,1269,1272,1273,1329,1366,1369,1369,1377,1415,1425,1441,1443,1465,1467,1469,1471,1471,1473,1474,1476,1476,1488,1514,1520,1522,1569,1594,1600,1621,1632,1641,1648,1747,1749,1756,1759,1768,1770,1773,1776,1788,1808,1836,1840,1866,1920,1968,2305,2307,2309,2361,2364,2381,2384,2388,2392,2403,2406,2415,2433,2435,2437,2444,2447,2448,2451,2472,2474,2480,2482,2482,2486,2489,2492,2492,2494,2500,2503,2504,2507,2509,2519,2519,2524,2525,2527,2531,2534,2545,2562,2562,2565,2570,2575,2576,2579,2600,2602,2608,2610,2611,2613,2614,2616,2617,2620,2620,2622,2626,2631,2632,2635,2637,2649,2652,2654,2654,2662,2676,2689,2691,2693,2699,2701,2701,2703,2705,2707,2728,2730,2736,2738,2739,2741,2745,2748,2757,2759,2761,2763,2765,2768,2768,2784,2784,2790,2799,2817,2819,2821,2828,2831,2832,2835,2856,2858,2864,2866,2867,2870,2873,2876,2883,2887,2888,2891,2893,2902,2903,2908,2909,2911,2913,2918,2927,2946,2947,2949,2954,2958,2960,2962,2965,2969,2970,2972,2972,2974,2975,2979,2980,2984,2986,2990,2997,2999,3001,3006,3010,3014,3016,3018,3021,3031,3031,3047,3055,3073,3075,3077,3084,3086,3088,3090,3112,3114,3123,3125,3129,3134,3140,3142,3144,3146,3149,3157,3158,3168,3169,3174,3183,3202,3203,3205,3212,3214,3216,3218,3240,3242,3251,3253,3257,3262,3268,3270,3272,3274,3277,3285,3286,3294,3294,3296,3297,3302,3311,3330,3331,3333,3340,3342,3344,3346,3368,3370,3385,3390,3395,3398,3400,3402,3405,3415,3415,3424,3425,3430,3439,3458,3459,3461,3478,3482,3505,3507,3515,3517,3517,3520,3526,3530,3530,3535,3540,3542,3542,3544,3551,3570,3571,3585,3642,3648,3662,3664,3673,3713,3714,3716,3716,3719,3720,3722,3722,3725,3725,3732,3735,3737,3743,3745,3747,3749,3749,3751,3751,3754,3755,3757,3769,3771,3773,3776,3780,3782,3782,3784,3789,3792,3801,3804,3805,3840,3840,3864,3865,3872,3881,3893,3893,3895,3895,3897,3897,3902,3911,3913,3946,3953,3972,3974,3979,3984,3991,3993,4028,4038,4038,4096,4129,4131,4135,4137,4138,4140,4146,4150,4153,4160,4169,4176,4185,4256,4293,4304,4342,4352,4441,4447,4514,4520,4601,4608,4614,4616,4678,4680,4680,4682,4685,4688,4694,4696,4696,4698,4701,4704,4742,4744,4744,4746,4749,4752,4782,4784,4784,4786,4789,4792,4798,4800,4800,4802,4805,4808,4814,4816,4822,4824,4846,4848,4878,4880,4880,4882,4885,4888,4894,4896,4934,4936,4954,4969,4977,5024,5108,5121,5740,5743,5750,5761,5786,5792,5866,6016,6099,6112,6121,6160,6169,6176,6263,6272,6313,7680,7835,7840,7929,7936,7957,7960,7965,7968,8005,8008,8013,8016,8023,8025,8025,8027,8027,8029,8029,8031,8061,8064,8116,8118,8124,8126,8126,8130,8132,8134,8140,8144,8147,8150,8155,8160,8172,8178,8180,8182,8188,8255,8256,8319,8319,8400,8412,8417,8417,8450,8450,8455,8455,8458,8467,8469,8469,8473,8477,8484,8484,8486,8486,8488,8488,8490,8493,8495,8497,8499,8505,8544,8579,12293,12295,12321,12335,12337,12341,12344,12346,12353,12436,12441,12442,12445,12446,12449,12542,12549,12588,12593,12686,12704,12727,13312,19893,19968,40869,40960,42124,44032,55203,63744,64045,64256,64262,64275,64279,64285,64296,64298,64310,64312,64316,64318,64318,64320,64321,64323,64324,64326,64433,64467,64829,64848,64911,64914,64967,65008,65019,65056,65059,65075,65076,65101,65103,65136,65138,65140,65140,65142,65276,65296,65305,65313,65338,65343,65343,65345,65370,65381,65470,65474,65479,65482,65487,65490,65495,65498,65500];function c(e,t){return t>=i.ES5?u(e,r):u(e,a)}function u(i,r){if(!(i<r[0])){let e=0,t=r.length;for(var n;e+1<t;){if(n=e+(t-e)/2,r[n-=n%2]<=i&&i<=r[1+n])return!0;i<r[n]?t=n:e=2+n}}return!1}l.isUnicodeIdentifierStart=c,(e=l.DiagnosticCategory||(l.DiagnosticCategory={}))[e.Warning=0]="Warning",e[e.Error=1]="Error",e[e.Message=2]="Message"}})(ts=ts||{}),(s=>{var e;{var r=s.webBluetooth||(s.webBluetooth={});function t(){return!!navigator&&!!navigator.bluetooth&&"TextDecoder"in window&&s.appTarget.appTheme.bluetoothUartConsole&&s.appTarget.appTheme.bluetoothUartFilters&&0<s.appTarget.appTheme.bluetoothUartFilters.length}function i(){return!!navigator&&!!navigator.bluetooth&&!!s.appTarget.appTheme.bluetoothPartialFlashing}r.isAvailable=function(){return t()||i()},r.hasConsole=t,r.hasPartialFlash=i,r.isValidUUID=function(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/.test(e)};class o{constructor(e,t){this.connectionTimeout=2e4,this.connectPromise=void 0,this.id=e,this.aliveToken=t}debug(e){s.debug(this.id+": "+e)}alivePromise(e){return new Promise((t,i)=>{this.aliveToken.isCancelled()&&i(new Error),e.then(e=>t(e),e=>i(e))})}cancelConnect(){this.connectPromise=void 0}createConnectPromise(){return Promise.resolve()}connectAsync(){return this.connectPromise||(this.connectPromise=this.alivePromise(this.createConnectPromise())),s.Util.promiseTimeout(this.connectionTimeout,this.connectPromise,"connection timeout").then(()=>this.aliveToken.throwIfCancelled()).catch(e=>{throw this.connectPromise=void 0,e})}disconnect(){this.cancelConnect()}kill(){this.disconnect(),this.aliveToken.cancel()}}r.BLERemote=o;class l extends o{constructor(e,t,i){super(e,t.aliveToken),this.device=t,this.autoReconnect=i,this.autoReconnectDelay=1e3,this.disconnectOnAutoReconnect=!1,this.reconnectPromise=void 0,this.failedConnectionServicesVersion=-1,this.handleDisconnected=this.handleDisconnected.bind(this),this.device.device.addEventListener("gattserverdisconnected",this.handleDisconnected)}handleDisconnected(e){this.aliveToken.isCancelled()||(this.disconnect(),this.autoReconnect&&!this.reconnectPromise&&(this.reconnectPromise=s.U.delay(this.autoReconnectDelay).then(()=>this.exponentialBackoffConnectAsync(8,500)).finally(()=>this.reconnectPromise=void 0)))}exponentialBackoffConnectAsync(t,i){return this.debug("retry connect"),this.aliveToken.throwIfCancelled(),this.connectAsync().then(()=>{this.aliveToken.throwIfCancelled(),this.debug("reconnect success"),this.reconnectPromise=void 0}).catch(e=>{if(this.debug("reconnect error "+e.message),this.aliveToken.throwIfCancelled(),this.device.isPaired)if(this.autoReconnect)if(0==t)this.debug("give up, max tries");else{if(this.failedConnectionServicesVersion!=this.device.servicesVersion)return this.debug(`retry connect ${i}ms... (${t} tries left)`),this.device.connected&&(this.failedConnectionServicesVersion=this.device.servicesVersion),this.disconnectOnAutoReconnect&&this.device.disconnect(),s.U.delay(i).then(()=>this.exponentialBackoffConnectAsync(--t,1.8*i));this.debug("services haven't changed, giving up")}else this.debug("autoreconnect disabled");else this.debug("give up, device unpaired");this.reconnectPromise=void 0})}}r.BLEService=l;class c extends l{constructor(e,t,i,r){super(e,t,!0),this.device=t,this.serviceUUID=i,this.txCharacteristicUUID=r,this.handleValueChanged=this.handleValueChanged.bind(this)}createConnectPromise(){return this.debug("connecting"),this.device.connectAsync().then(()=>this.alivePromise(this.device.gatt.getPrimaryService(this.serviceUUID))).then(e=>(this.debug("service connected"),this.service=e,this.alivePromise(this.service.getCharacteristic(this.txCharacteristicUUID)))).then(e=>(this.debug("tx characteristic connected"),this.txCharacteristic=e,this.txCharacteristic.addEventListener("characteristicvaluechanged",this.handleValueChanged),this.txCharacteristic.startNotifications())).then(()=>{s.tickEvent("webble.connected",{id:this.id})})}handlePacket(e){}handleValueChanged(e){e=e.target.value;this.handlePacket(e)}disconnect(){if(super.disconnect(),this.txCharacteristic&&this.device&&this.device.connected)try{this.txCharacteristic.stopNotifications(),this.txCharacteristic.removeEventListener("characteristicvaluechanged",this.handleValueChanged)}catch(e){s.log(this.id+": error "+e.message)}this.service=void 0,this.txCharacteristic=void 0}}r.BLETXService=c;class u extends c{constructor(e){super("hf2",e,u.SERVICE_UUID,u.CHARACTERISTIC_TX_UUID),this.device=e}handlePacket(i){var e=i.getUint8(0);switch(192&e){case u.BLEHF2_FLAG_SERIAL_OUT:case u.BLEHF2_FLAG_SERIAL_ERR:var r=Math.min(i.byteLength-1,-193&e);let t="";for(let e=0;e<r;++e)t+=String.fromCharCode(i.getUint8(e+1));t&&window.postMessage({type:"serial",id:this.device.name||"hf2",data:t},"*")}}}u.SERVICE_UUID="b112f5e6-2679-30da-a26e-0273b6043849",u.CHARACTERISTIC_TX_UUID="b112f5e6-2679-30da-a26e-0273b604384a",u.BLEHF2_FLAG_SERIAL_OUT=128,u.BLEHF2_FLAG_SERIAL_ERR=192,r.HF2Service=u;class d extends c{constructor(e){super("uart",e,d.SERVICE_UUID,d.CHARACTERISTIC_TX_UUID),this.device=e}handlePacket(e){e=(new window.TextDecoder).decode(e);e&&window.postMessage({type:"serial",id:this.device.name||"uart",data:e},"*")}}d.SERVICE_UUID="6e400001-b5a3-f393-e0a9-e50e24dcca9e",d.CHARACTERISTIC_TX_UUID="6e400002-b5a3-f393-e0a9-e50e24dcca9e",r.UARTService=d;let a;(e=a=a||{})[e.Idle=1]="Idle",e[e.StatusRequested=2]="StatusRequested",e[e.PairingModeRequested=4]="PairingModeRequested",e[e.RegionDALRequested=8]="RegionDALRequested",e[e.RegionMakeCodeRequested=16]="RegionMakeCodeRequested",e[e.Flash=32]="Flash",e[e.EndOfTransmision=64]="EndOfTransmision",e[e.USBFlashRequired=128]="USBFlashRequired";class h extends l{constructor(e){super("partial flashing",e,!1),this.device=e,this.state=a.Idle,this.disconnectOnAutoReconnect=!0,this.handleCharacteristic=this.handleCharacteristic.bind(this)}clearFlashData(){this.version=0,this.mode=0,this.regions=[],this.chunkDelay=h.CHUNK_MIN_DELAY,this.hex=void 0,this.bin=void 0,this.magicOffset=void 0,this.dalHash=void 0,this.makeCodeHash=void 0,this.flashReject=void 0,this.flashResolve=void 0,this.flashOffset=void 0}createConnectPromise(){return this.debug("connecting to partial flash service"),this.device.connectAsync().then(()=>this.alivePromise(this.device.gatt.getPrimaryService(h.SERVICE_UUID))).then(e=>(this.debug("connecting to characteristic"),this.alivePromise(e.getCharacteristic(h.CHARACTERISTIC_UUID)))).then(e=>(this.debug("starting notifications"),this.pfCharacteristic=e,this.pfCharacteristic.startNotifications(),this.pfCharacteristic.addEventListener("characteristicvaluechanged",this.handleCharacteristic),this.state==a.PairingModeRequested?(this.debug("checking pairing mode"),this.autoReconnect=!1,this.pfCharacteristic.writeValue(new Uint8Array([h.STATUS]))):Promise.resolve()))}disconnect(){if(super.disconnect(),this.flashPacketToken&&this.flashPacketToken.cancel(),this.pfCharacteristic&&this.device.connected)try{this.pfCharacteristic.stopNotifications(),this.pfCharacteristic.removeEventListener("characteristicvaluechanged",this.handleCharacteristic)}catch(e){s.log("ble: partial flash disconnect error "+e.message)}this.pfCharacteristic=void 0}findMarker(i,r){if(this.bin)for(;i+r.length<this.bin.length;i+=16){let t=!0;for(let e=0;e<r.length;++e)if(r[e]!=this.bin[i+e]){t=!1;break}if(t)return i}return-1}flashAsync(e){return this.hex?(this.debug("flashing already in progress"),Promise.resolve()):(this.device.pauseLog(),this.createFlashPromise(e).finally(()=>this.device.resumeLogOnDisconnection()))}createFlashPromise(e){if(this.hex)return this.debug("flashing already in progress"),Promise.resolve();this.clearFlashData(),this.hex=e;var e=ts.pxtc.UF2.newBlockFile(),t=(ts.pxtc.UF2.writeHex(e,this.hex.split(/\r?\n/)),s.appTarget.compile.flashUsableEnd),e=(this.bin=ts.pxtc.UF2.toBin(s.U.stringToUint8Array(ts.pxtc.UF2.serializeFile(e)),t).buf,this.debug("bin bytes "+this.bin.length),this.magicOffset=this.findMarker(0,h.MAGIC_MARKER),this.debug("magic block "+this.magicOffset.toString(16)),this.magicOffset<0&&(this.debug("magic block not found, not a valid HEX file"),s.U.userError(lf("Invalid file"))),this.debug("bytes to flash "+(this.bin.length-this.magicOffset)),this.magicOffset+h.MAGIC_MARKER.length);return this.dalHash=s.Util.toHex(this.bin.slice(e,e+8)),this.makeCodeHash=s.Util.toHex(this.bin.slice(e+8,e+16)),this.debug("DAL hash "+this.dalHash),this.debug("MakeCode hash "+this.makeCodeHash),this.connectAsync().then(()=>new Promise((e,t)=>(this.flashResolve=e,this.flashReject=t,this.debug("check service version"),this.state=a.StatusRequested,this.pfCharacteristic.writeValue(new Uint8Array([h.STATUS]))))).then(()=>{},e=>{s.log("pf: error "+e.message),this.clearFlashData()})}checkStateTransition(e,t){return!!(this.state&t)||(this.debug(`flash cmd ${e} in state ${this.state.toString(16)} `),this.flashReject(new Error),this.clearFlashData(),!1)}handleCharacteristic(e){this.aliveToken.isCancelled()&&(this.flashReject(new Error),this.clearFlashData());var t=event.target.value,i=new Uint8Array(t.buffer),r=i[0];if(this.state!=a.Idle)switch(r){case h.STATUS:this.checkStateTransition(r,a.StatusRequested|a.PairingModeRequested)&&(this.version=i[1],this.mode=i[2],this.debug(`flash service version ${this.version} mode `+this.mode),this.debug("reading DAL region"),this.state=a.RegionDALRequested,this.pfCharacteristic.writeValue(new Uint8Array([h.REGION_INFO,h.REGION_DAL])).then(()=>{}));break;case h.REGION_INFO:if(this.checkStateTransition(r,a.RegionDALRequested|a.RegionMakeCodeRequested)){var n=this.regions[i[1]]={start:i[2]<<24|i[3]<<16|i[4]<<8|i[5],end:i[6]<<24|i[7]<<16|i[8]<<8|i[9],hash:s.Util.toHex(i.slice(10))};if(this.debug(`read region ${i[1]} start ${n.start.toString(16)} end ${n.end.toString(16)} hash `+n.hash),i[1]==h.REGION_DAL){if(n.hash!=this.dalHash)return s.tickEvent("webble.flash.DALrequired"),this.debug("DAL hash does not match, partial flashing not possible"),this.state=a.USBFlashRequired,this.flashReject(new Error("USB flashing required")),void this.clearFlashData();this.debug("DAL hash match, reading makecode region"),this.state=a.RegionMakeCodeRequested,this.pfCharacteristic.writeValue(new Uint8Array([h.REGION_INFO,h.REGION_MAKECODE])).then(()=>{})}else if(i[1]==h.REGION_MAKECODE)if(n.start!=this.magicOffset&&(this.debug("magic offset and MakeCode region.start not matching"),s.U.userError(lf("Invalid file"))),n.hash==this.makeCodeHash)s.tickEvent("webble.flash.noop"),this.debug("MakeCode hash matches, same code!"),this.debug("restart application mode"),this.pfCharacteristic.writeValue(new Uint8Array([h.RESET,h.MODE_APPLICATION])).then(()=>{this.state=a.Idle,this.flashResolve(),this.clearFlashData()});else{if(this.mode!=h.MODE_PAIRING)return this.debug("application mode, reset into pairing mode"),this.state=a.PairingModeRequested,this.autoReconnect=!0,void this.pfCharacteristic.writeValue(new Uint8Array([h.RESET,h.MODE_PAIRING])).then(()=>{});this.flashOffset=n.start,this.flashPacketNumber=0,this.debug("starting to flash from address "+this.flashOffset.toString(16)),this.flashNextPacket()}}break;case h.FLASH_DATA:if(this.checkStateTransition(r,a.Flash))switch(i[1]){case h.PACKET_OUT_OF_ORDER:this.debug("packet out of order"),this.flashPacketToken.cancel(),this.flashPacketNumber+=4,this.chunkDelay=Math.min(this.chunkDelay+10,h.CHUNK_MAX_DELAY),this.flashNextPacket();break;case h.PACKET_WRITTEN:this.chunkDelay=Math.max(this.chunkDelay-1,h.CHUNK_MIN_DELAY),this.flashOffset+=64,this.flashPacketNumber+=4,this.flashOffset>=this.bin.length?(this.debug("end transmission"),this.state=a.EndOfTransmision,this.pfCharacteristic.writeValue(new Uint8Array([h.END_OF_TRANSMISSION])).finally(()=>{this.flashResolve&&this.flashResolve(),this.clearFlashData()})):this.flashNextPacket()}break;default:this.debug("unknown message "+s.Util.toHex(i)),this.disconnect()}}flashNextPacket(){this.state=a.Flash,this.flashPacketToken=new s.Util.CancellationToken,this.flashPacketToken.startOperation();let t=this.bin.slice(this.flashOffset,this.flashOffset+64),i=(this.debug(`flashing ${this.flashOffset.toString(16)} / ${this.bin.length.toString(16)} ${(this.flashOffset-this.magicOffset)/(this.bin.length-this.magicOffset)*100>>0}%`),new Uint8Array(20));s.U.delay(this.chunkDelay).then(()=>{this.flashPacketToken.throwIfCancelled(),i[0]=h.FLASH_DATA,i[1]=this.flashOffset>>8&255,i[2]=this.flashOffset>>0&255,i[3]=this.flashPacketNumber;for(let e=0;e<16;e++)i[4+e]=t[e];return this.pfCharacteristic.writeValue(i)}).then(()=>s.U.delay(this.chunkDelay)).then(()=>{this.flashPacketToken.throwIfCancelled(),i[0]=h.FLASH_DATA,i[1]=this.flashOffset>>24&255,i[2]=this.flashOffset>>16&255,i[3]=this.flashPacketNumber+1;for(let e=0;e<16;e++)i[4+e]=t[16+e]||0;return this.pfCharacteristic.writeValue(i)}).then(()=>s.U.delay(this.chunkDelay)).then(()=>{this.flashPacketToken.throwIfCancelled(),i[0]=h.FLASH_DATA,i[1]=0,i[2]=0,i[3]=this.flashPacketNumber+2;for(let e=0;e<16;e++)i[4+e]=t[32+e]||0;return this.pfCharacteristic.writeValue(i)}).then(()=>s.U.delay(this.chunkDelay)).then(()=>{this.flashPacketToken.throwIfCancelled(),i[0]=h.FLASH_DATA,i[1]=0,i[2]=0,i[3]=this.flashPacketNumber+3;for(let e=0;e<16;e++)i[4+e]=t[48+e]||0;return this.pfCharacteristic.writeValue(i)}).then(()=>{let e=this.flashOffset,t=()=>s.U.delay(500).then(()=>{if(e!=this.flashOffset||this.flashPacketToken.isCancelled()||this.aliveToken.isCancelled()||this.state!=a.Flash)return Promise.resolve();this.debug("packet transfer deadlock, force restart"),i[0]=h.FLASH_DATA,i[1]=0,i[2]=0,i[3]=-1;for(let e=0;e<16;e++)i[4+e]=0;return this.pfCharacteristic.writeValue(i).then(()=>t())});t().catch(e=>{this.flashReject&&(this.flashReject(new Error("failed packet transfer")),this.clearFlashData())})}).catch(()=>{this.flashPacketToken.resolveCancel()})}}h.SERVICE_UUID="e97dd91d-251d-470a-a062-fa1922dfa9a8",h.CHARACTERISTIC_UUID="e97d3b10-251d-470a-a062-fa1922dfa9a8",h.REGION_INFO=0,h.FLASH_DATA=1,h.PACKET_OUT_OF_ORDER=170,h.PACKET_WRITTEN=255,h.END_OF_TRANSMISSION=2,h.STATUS=238,h.RESET=255,h.MODE_PAIRING=0,h.MODE_APPLICATION=1,h.REGION_SOFTDEVICE=0,h.REGION_DAL=1,h.REGION_MAKECODE=2,h.MAGIC_MARKER=s.Util.fromHex("708E3B92C615A841C49866C975EE5197"),h.CHUNK_MIN_DELAY=0,h.CHUNK_MAX_DELAY=75,r.PartialFlashingService=h;class p extends o{constructor(e){super("ble",new s.Util.CancellationToken),this.device=void 0,this.services=[],this.pendingResumeLogOnDisconnection=!1,this.servicesVersion=0,this.device=e,this.handleDisconnected=this.handleDisconnected.bind(this),this.handleServiceAdded=this.handleServiceAdded.bind(this),this.handleServiceChanged=this.handleServiceChanged.bind(this),this.handleServiceRemoved=this.handleServiceRemoved.bind(this),this.device.addEventListener("gattserverdisconnected",this.handleDisconnected),this.device.addEventListener("serviceadded",this.handleServiceAdded),this.device.addEventListener("servicechanged",this.handleServiceChanged),this.device.addEventListener("serviceremoved",this.handleServiceRemoved),t()&&(this.services.push(this.uartService=new d(this)),this.services.push(this.hf2Service=new u(this))),i()&&this.services.push(this.partialFlashingService=new h(this)),this.aliveToken.startOperation()}startServices(){this.services.filter(e=>e.autoReconnect).forEach(e=>e.connectAsync().catch(()=>{}))}pauseLog(){this.uartService&&(this.uartService.autoReconnect=!1,this.uartService.disconnect()),this.hf2Service&&(this.hf2Service.autoReconnect=!1,this.hf2Service.disconnect())}resumeLogOnDisconnection(){this.pendingResumeLogOnDisconnection=!0}resumeLog(){this.uartService&&(this.uartService.autoReconnect=!0,this.uartService.connectAsync().catch(()=>{})),this.hf2Service&&(this.hf2Service.autoReconnect=!0,this.hf2Service.connectAsync().catch(()=>{}))}get isPaired(){return this===r.bleDevice}get name(){return this.device.name||"?"}get connected(){return this.device&&this.device.gatt&&this.device.gatt.connected}get gatt(){return this.device.gatt}createConnectPromise(){return this.debug("connecting gatt server"),this.alivePromise(this.device.gatt.connect().then(()=>this.debug("gatt server connected")))}handleServiceAdded(e){this.debug("service added"),this.servicesVersion++}handleServiceRemoved(e){this.debug("service removed"),this.servicesVersion++}handleServiceChanged(e){this.debug("service changed"),this.servicesVersion++}handleDisconnected(e){this.debug("disconnected"),this.disconnect(),this.pendingResumeLogOnDisconnection&&(this.pendingResumeLogOnDisconnection=!1,s.U.delay(500).then(()=>this.resumeLog()))}disconnect(){if(super.disconnect(),this.services.forEach(e=>e.disconnect()),this.connected){this.debug("disconnect");try{this.device.gatt&&this.device.gatt.connected&&this.device.gatt.disconnect()}catch(e){this.debug("gatt disconnect error "+e.message)}}}}function n(){if(r.bleDevice)return Promise.resolve();s.log("ble: requesting device");var e=[];return t()&&(e.push(d.SERVICE_UUID),e.push(u.SERVICE_UUID)),i()&&e.push(h.SERVICE_UUID),navigator.bluetooth.requestDevice({filters:s.appTarget.appTheme.bluetoothUartFilters,optionalServices:e}).then(e=>(s.log("ble: received device "+e.name),r.bleDevice=new p(e),r.bleDevice.startServices(),r.bleDevice.connectAsync()))}r.BLEDevice=p,r.bleDevice=void 0,r.isPaired=function(){return!!r.bleDevice},r.pairAsync=function(){return r.bleDevice&&(r.bleDevice.kill(),r.bleDevice=void 0),n().catch(e=>{r.bleDevice&&r.bleDevice.aliveToken&&r.bleDevice.aliveToken.resolveCancel(),s.log("ble: error "+e.message)})},r.flashAsync=function(e,t){s.tickEvent("webble.flash");let i=e.outfiles[ts.pxtc.BINARY_HEX];return n().then(()=>r.bleDevice.partialFlashingService.flashAsync(i)).then(()=>s.tickEvent("webble.flash.success")).catch(e=>{throw s.tickEvent("webble.fail.fail",{message:e.message}),e})}}})(pxt=pxt||{}),(a=>{{var n=a.usb||(a.usb={});class c extends Error{constructor(e){super(e),this.message=e}}n.USBError=c,n.filters=[{classCode:255,subclassCode:42}];let r=!0;n.setFilters=function(e){r=!1,n.filters=e};class u{constructor(){this.ready=!1,this.connecting=!1,this.readLoopStarted=!1,this.onDeviceConnectionChanged=e=>{},this.onConnectionChanged=()=>{},this.onData=e=>{},this.onError=e=>{},this.onEvent=e=>{},this.enabled=!1,this.handleUSBConnected=this.handleUSBConnected.bind(this),this.handleUSBDisconnected=this.handleUSBDisconnected.bind(this)}enable(){var e;this.enabled||(this.enabled=!0,this.log("registering webusb events"),null!=(e=navigator.usb)&&e.addEventListener("disconnect",this.handleUSBDisconnected,!1),null!=(e=navigator.usb)&&e.addEventListener("connect",this.handleUSBConnected,!1))}disable(){var e;this.enabled&&(this.enabled=!1,this.log("unregistering webusb events"),null!=(e=navigator.usb)&&e.removeEventListener("disconnect",this.handleUSBDisconnected),null!=(e=navigator.usb))&&e.removeEventListener("connect",this.handleUSBConnected)}async disposeAsync(){this.disable()}handleUSBDisconnected(e){this.log("device disconnected"),e.device==this.dev&&(this.log("clear device"),this.clearDev(),null!=(e=this.onDeviceConnectionChanged))&&e.call(this,!1)}handleUSBConnected(e){var e=e.device;this.log("device connected "+e.serialNumber),this.dev||this.connecting||(this.log("attach device"),null!=(e=this.onDeviceConnectionChanged)&&e.call(this,!0))}clearDev(){var e;this.dev&&(this.dev=null,this.epIn=null,(this.epOut=null)!=(e=this.onConnectionChanged))&&e.call(this)}error(e){throw new c(a.U.lf("USB error on device {0} ({1})",this.dev.productName,e))}log(e){a.debug("webusb: "+e)}async disconnectAsync(){if(this.ready=!1,this.dev){this.log("close device");try{await this.dev.close()}catch(e){}this.clearDev(),await a.U.delay(500)}}async forgetAsync(){var e;if(null==(e=this.dev)||!e.forget)return!1;try{var t=this.dev;return await this.disconnectAsync(),await t.forget(),!0}catch(e){return!1}}async reconnectAsync(){this.log("reconnect"),this.setConnecting(!0);try{await this.disconnectAsync();var e=await i();await this.connectAsync(e)}finally{this.setConnecting(!1)}}setConnecting(e){e!=this.connecting&&(this.connecting=e,null!=(e=this.onConnectionChanged))&&e.call(this)}isConnecting(){return this.connecting}isConnected(){return!!this.dev&&this.ready}async connectAsync(t){var e,i;if(this.log(`trying to connect (${t.length} devices)`),0==t.length)throw(e=new Error("Device not found.")).type="devicenotfound",e;this.setConnecting(!0);try{this.lastKnownDeviceSerialNumber&&((i=t.find(e=>e.serialNumber===this.lastKnownDeviceSerialNumber))?(this.log("last known device spotted"),t.splice(t.indexOf(i),1),t.unshift(i)):(this.log("delay for last known device"),await a.U.delay(2e3)));for(let e=0;e<t.length;++e){var r=t[e];this.dev=r,this.log(`connect device: ${r.manufacturerName} `+r.productName),this.log(`serial number: ${r.serialNumber} ${this.lastKnownDeviceSerialNumber===r.serialNumber?"(last known device)":""} `);try{return void await this.initAsync()}catch(e){this.dev=void 0,this.log("connection failed, "+e.message)}}var n=new Error(a.U.lf("Device in use or not found."));throw n.type="devicelocked",n}finally{this.setConnecting(!1)}}async sendPacketAsync(e){if(!this.dev)throw new Error("Disconnected");a.Util.assert(e.length<=64),this.epOut?"ok"!=(await this.dev.transferOut(this.epOut.endpointNumber,e)).status&&this.error("USB OUT transfer failed"):"ok"!=(await this.dev.controlTransferOut({requestType:"class",recipient:"interface",request:9,value:512,index:this.iface.interfaceNumber},e)).status&&this.error("USB CTRL OUT transfer failed")}async readLoop(){if(!this.readLoopStarted)for(this.readLoopStarted=!0,this.log("start read loop");;)if(this.ready)try{var e=await this.recvPacketAsync();e[0]?this.onData(e):await a.U.delay(500)}catch(e){this.dev&&this.onError(e),await a.U.delay(300)}else await a.U.delay(300)}async recvPacketAsync(e){for(var t=Date.now();!e||Date.now()<t+e;){if(!this.dev)throw new Error("Disconnected");var i=await(this.epIn?this.dev.transferIn(this.epIn.endpointNumber,64):this.dev.controlTransferIn({requestType:"class",recipient:"interface",request:1,value:256,index:this.iface.interfaceNumber},64)),i=("ok"!=i.status&&this.error("USB IN transfer failed"),new Uint8Array(i.data.buffer));if(0!=i.length)return i}this.error("USB IN timed out")}async initAsync(){if(!this.dev)throw new Error("Disconnected");var e=this.dev,t=(this.log("open device"),await e.open(),this.log("select configuration"),await e.selectConfiguration(1),this.log("got "+e.configurations[0].interfaces.length+" interfaces"),e.configurations[0].interfaces.filter(e=>{var t,i=e.alternates[0];for(t of n.filters)if((null==t.classCode||i.interfaceClass===t.classCode)&&!(null!=t.subclassCode&&i.interfaceSubclass!==t.subclassCode||null!=t.protocolCode&&i.interfaceProtocol!==t.protocolCode)){if(0==i.endpoints.length)return!0;if(2==i.endpoints.length&&i.endpoints.every(e=>64==e.packetSize))return!0}return!1})),i=t[t.length-1];this.log(t.length+" matching interfaces; picking "+(i?"#"+i.interfaceNumber:"n/a")),i||this.error("cannot find supported USB interface"),this.altIface=i.alternates[0],this.iface=i,this.altIface.endpoints.length?(this.log("using dedicated endpoints"),this.epIn=this.altIface.endpoints.filter(e=>"in"==e.direction)[0],this.epOut=this.altIface.endpoints.filter(e=>"out"==e.direction)[0],a.Util.assert(64==this.epIn.packetSize),a.Util.assert(64==this.epOut.packetSize)):this.log("using ctrl pipe"),this.log("claim interface"),await e.claimInterface(i.interfaceNumber),this.log("device ready"),this.lastKnownDeviceSerialNumber=this.dev.serialNumber,this.ready=!0,r&&this.readLoop(),null!=(t=this.onConnectionChanged)&&t.call(this)}}async function i(){var e;a.log("webusb: get devices");try{return await(null==(e=navigator.usb)?void 0:e.getDevices())||[]}catch(e){return a.reportException(e),[]}}n.pairAsync=async function(){var e;try{return!!await(null==(e=navigator.usb)?void 0:e.requestDevice({filters:n.filters}))}catch(e){if("NotFoundError"!=e.name)throw e}},n.tryGetDevicesAsync=i;let e,t=(n.mkWebUSBHIDPacketIOAsync=function(){return a.debug("packetio: mk webusb io"),(e=e||new u).enable(),Promise.resolve(e)},n.forgetDeviceAsync=async function(){return a.debug("packetio: forget webusb io"),!!e&&e.forgetAsync()},n.isEnabled=!1,n.setEnabled=function(e){l()||(e=!1),n.isEnabled=e},void 0);async function s(){if(void 0===t)if(a.debug("webusb: checking availability"),null!=(e=null==(e=a.appTarget)?void 0:e.compile)&&e.webUSB){var e=await o();if(e)switch(t=!1,a.tickEvent("webusb.off",{reason:e}),e){case"electron":a.debug("webusb: off, electron");break;case"notimpl":a.debug("webusb: off, not implemented by browser");break;case"oldwindows":a.debug("webusb: off, older windows version");break;case"security":a.debug("webusb: off, security exception")}else t=!0}else t=!1}async function o(){if(a.BrowserUtils.isElectron())return"electron";var e=navigator.usb;if(!e)return"notimpl";var t=/Windows NT (\d+\.\d+)/.exec(navigator.userAgent);if(t&&parseFloat(t[1])<6.3)return"oldwindows";try{await e.getDevices()}catch(e){return"security"}}function l(){return void 0===t&&(a.error("checkAvailableAsync not called"),s()),!!t}n.checkAvailableAsync=s,n.getReasonUnavailable=o,n.isAvailable=l}})(pxt=pxt||{}),(a=>{{var e=a.worker||(a.worker={}),r=a.Util;let i={};function s(a){let s={},o=0,e=new r.PromiseQueue,t=new Promise((e,t)=>{s.ready=e});e.enqueue("main",()=>t);return{opAsync:function(r,n){return e.enqueue("main",()=>new Promise((t,i)=>{var e=""+o++;s[e]=e=>{e?e.errorMessage?i(new Error(e.errorMessage)):t(e):i(new Error("no response"))},a({id:e,op:r,arg:n})}))},recvHandler:e=>{var t;s.hasOwnProperty(e.id)&&(t=s[e.id],delete s[e.id],t(e.result))}}}function n(e){let t=new Worker(e),i=s(e=>t.postMessage(e));return t.onmessage=e=>{a.perf.measureStart(Measurements.WebworkerRecvHandler),i.recvHandler(e.data),a.perf.measureEnd(Measurements.WebworkerRecvHandler)},i}e.getWorker=function(e){let t=i[e];return t=t||(i[e]=n(e))},e.wrap=s,e.makeWebWorker=n,e.makeWebSocket=function(e,t=null){let i=new WebSocket(e),r=[],n=s(e=>{e=JSON.stringify(e);r?r.push(e):i.send(e)});return i.onmessage=e=>{e=JSON.parse(e.data);t&&null==e.id?t(e):n.recvHandler(e)},i.onopen=e=>{a.debug("socket opened");for(var t of r)i.send(t);r=null},i.onclose=e=>{a.debug("socket closed")},i.onerror=e=>{a.debug("socket errored")},n}}})(pxt=pxt||{}),(a=>{var s;function o(){s.apiKey||a.U.userError("YouTube API key missing")}(s=a.youtube||(a.youtube={})).apiKey=void 0,s.playlistItemToCodeCard=function(e){return{name:e.snippet.title.replace(/[^-]*-/,"").trim(),description:e.snippet.description.split(/\n\s+/,1)[0].trim(),youTubeId:e.snippet.resourceId.videoId,youTubePlaylistId:e.snippet.playlistId,imageUrl:(e=e.snippet.thumbnails)&&(null==(e=e.medium||e.high||e.standard||e.default)?void 0:e.url)||""}},s.playlistInfoAsync=function(e){return o(),e=`https://www.googleapis.com/youtube/v3/playlists?part=snippet&id=${e}&key=`+s.apiKey,a.Util.httpGetJsonAsync(e).then(e=>e.items[0])},s.listPlaylistVideosAsync=async function(t){o();let i=[],r=void 0;do{let e=`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${t}&key=`+s.apiKey;r&&(e+="&pageToken="+r);var n=await a.Util.httpGetJsonAsync(e);i=i.concat(n.items),r=n.nextPageToken}while(r);return a.options.debug&&a.debug(JSON.stringify(i,null,2)),i},s.watchUrl=function(e,t){let i=void 0;return e?(i="https://www.youtube.com/watch?v="+e,t&&(i+="&list="+t)):t&&(i="https://www.youtube.com/playlist?list="+t),i}})(pxt=pxt||{}),(e=>{var f=e.pxtc||(e.pxtc={});{var m=f.assembler||(f.assembler={});function g(e,...i){return e.replace(/{(\d+)}/g,(e,t)=>i[+t])}m.debug=!1,m.lf=g;let e=v("opcode name doesn't match","<name>");class s{constructor(e,t,i,r,n){this.opcode=i,this.mask=r,this.is32bit=n,this.canBeShared=!1,f.assert((i&r)==i),this.ei=e,this.code=t.replace(/\s+/g," "),this.friendlyFmt=t.replace(/\$\w+/g,e=>this.ei.encoders[e]?this.ei.encoders[e].pretty:e);n=o(t);this.name=n[0],this.args=n.slice(1)}emit(i){var r=i.words;if(r[0]!=this.name)return e;let n=this.opcode,a=1,s=0;var o=[];let l=null,c=null,u=null;for(let e=0;e<this.args.length;++e){var d=this.args[e];let t=r[a++];if("$"==d[0]){var h=this.ei.encoders[d];let e=null;if(h.isRegister){if(null==(e=this.ei.registerNo(t)))return v("expecting register name",t);this.ei.isPush(this.opcode)?s++:this.ei.isPop(this.opcode)&&s--}else if(h.isImmediate){if(t=t.replace(/^#/,""),null==(e=i.bin.parseOneInt(t)))return v("expecting number",t);this.ei.isAddSP(this.opcode)?s=-(e/this.ei.wordSize()):this.ei.isSubSP(this.opcode)&&(s=e/this.ei.wordSize())}else if(h.isRegList){if("{"!=t)return v("expecting {",t);for(e=0;"}"!=r[a];){if(!(t=r[a++]))return v("expecting }",r[a-2]);var p=this.ei.registerNo(t);if(null==p)return v("expecting register name",t);if(e&1<<p)return v("duplicate register name",t);e|=1<<p,this.ei.isPush(this.opcode)?s++:this.ei.isPop(this.opcode)&&s--,","==r[a]&&a++}t=r[a++]}else if(h.isLabel){if(t=t.replace(/^#/,""),/^[+-]?\d+$/.test(t))e=parseInt(t,10),l="rel"+e;else if(/^0x[0-9a-fA-F]+$/.test(t))e=parseInt(t,16),l="abs"+e;else if(l=t,null==(e=this.ei.getAddressFromLabel(i.bin,this,t,h.isWordAligned))){if(i.bin.finalEmit)return v("unknown label",t);e=8}if(this.ei.is32bit(this)){c=e,u=t;continue}}else f.oops();if(null==e)return v("didn't understand it",t);if(o.push(e),null==(e=h.encode(e)))return v("argument out of range or mis-aligned",t);f.assert(0==(n&e)),n|=e}else if(d!=t)return v("expecting "+d,t)}return r[a]?v("trailing tokens",r[a]):this.ei.is32bit(this)?this.ei.emit32(n,c,i.bin.normalizeExternalLabel(u)):{stack:s,opcode:n,numArgs:o,labelName:i.bin.normalizeExternalLabel(l)}}toString(){return this.friendlyFmt}}m.Instruction=s;class l{constructor(e,t){this.bin=e,this.text=t}getOpExt(){return this.instruction?this.instruction.code:""}getOp(){return this.instruction?this.instruction.name:""}update(e){this.bin.peepOps++,(e=e.replace(/^\s*/,""))||this.bin.peepDel++,e&&(e+="      "),this.text=(e="    "+e)+"; WAS: "+this.text.trim(),this.instruction=null,this.numArgs=null,this.words=o(e)||[],0==this.words.length?this.type="empty":"@"==this.words[0][0]&&(this.type="directive")}}m.Line=l;class c{constructor(e,t){this.id=e,this.description=t,this.sizeAdj=0,this.users=[]}get size(){return this.endLocation-this.startLocation-this.sizeAdj}}class u{constructor(e){this.baseOffset=0,this.checkStack=!0,this.inlineMode=!1,this.normalizeExternalLabel=e=>e,this.currLineNo=0,this.scope="",this.scopeId=0,this.errors=[],this.labels={},this.equs={},this.stackpointers={},this.stack=0,this.commPtr=0,this.peepOps=0,this.peepDel=0,this.peepCounts={},this.stats="",this.throwOnError=!1,this.disablePeepHole=!1,this.stackAtLabel={},this.codeSizeStats=!1,this.labelToObject={},this.idToObject={},this.objSuspendStart=0,this.labelsToObjectDone=!1,this.currLine=new l(this,"<start>"),this.currLine.lineNo=0,this.ei=e,this.ei.file=this}emitShort(e){f.assert(0<=e&&e<=65535),this.buf.push(e)}emitOpCode(e){this.emitShort(e)}location(){return 2*this.buf.length}pc(){return this.location()+this.baseOffset}useLabel(e){this.currObject&&"."!=e[0]&&!this.objSuspendStart&&(e=f.U.lookup(this.labelToObject,e))&&e!=this.currObject&&e.users.length<5&&e.users.indexOf(this.currObject)<0&&e.users.push(this.currObject)}parseOneInt(e){if(!e)return null;if(/^\d+$/.test(e))return parseInt(e,10);var t=e.indexOf("-");if(0<t)return this.parseOneInt(e.slice(0,t))-this.parseOneInt(e.slice(t+1));let i=1;if(0<=e.indexOf("*"))for(var r;null!=(r=/^([^\*]*)\*(.*)$/.exec(e));){var n=this.parseOneInt(r[1]);if(null==n)return null;i*=n,e=r[2]}if("-"==e[0]?(i*=-1,e=e.slice(1)):"+"==e[0]&&(e=e.slice(1)),/^\d+$/.test(e))return i*parseInt(e,10);if(f.U.endsWith(e,"|1"))return 1|this.parseOneInt(e.slice(0,e.length-2));if(f.U.endsWith(e,"-1"))return this.parseOneInt(e.slice(0,e.length-2))-1;if(f.U.endsWith(e,"+1"))return this.parseOneInt(e.slice(0,e.length-2))+1;var a,t=/(.*)>>(\d+)$/.exec(e);if(t)return a=this.parseOneInt(t[1]),(a&=~(-16777216&this.baseOffset))>>parseInt(t[2]);let s=null;return"0"==e[0]&&("x"==e[1]||"X"==e[1]?(a=/^0x([a-f0-9]+)$/i.exec(e))&&(s=parseInt(a[1],16)):"b"!=e[1]&&"B"!=e[1]||(t=/^0b([01]+)$/i.exec(e))&&(s=parseInt(t[1],2))),0<=e.indexOf("@")&&((a=/^(\w+)@(-?\d+)$/.exec(e))&&(1!=i&&this.directiveError(g("multiplication not supported with saved stacks")),this.stackpointers.hasOwnProperty(a[1])?s=this.ei.wordSize()*this.ei.computeStackOffset(a[1],this.stack-this.stackpointers[a[1]]+parseInt(a[2])):this.directiveError(g("saved stack not found"))),a=/^(.*)@(hi|lo|fn)$/.exec(e))&&this.looksLikeLabel(a[1])&&null!=(s=this.lookupLabel(a[1],!0))&&("fn"==a[2]?s=this.ei.toFnPtr(s,this.baseOffset,a[1]):0<=(s>>=1)&&s<=65535?"hi"==a[2]?s=s>>8&255:"lo"==a[2]?s&=255:f.oops():(this.directiveError(g("@hi/lo out of range")),s=null)),null==s&&this.looksLikeLabel(e)&&null!=(s=this.lookupLabel(e,!0))&&1==this.ei.postProcessRelAddress(this,1)&&(s+=this.baseOffset),null==s||isNaN(s)?null:s*i}looksLikeLabel(e){return!/^(r\d|pc|sp|lr)$/i.test(e)&&/^[\.a-zA-Z_][\.:\w+]*$/.test(e)}scopedName(e){return"."==e[0]&&this.scope?this.scope+"$"+e:e}lookupLabel(e,t=!1){this.useLabel(e);let i=null;var r=this.scopedName(e);return this.labels.hasOwnProperty(r)?(i=this.labels[r],i=this.ei.postProcessRelAddress(this,i)):this.lookupExternalLabel&&null!=(i=this.lookupExternalLabel(e))&&(i=this.ei.postProcessAbsAddress(this,i)),null==(i=null==i&&this.equs.hasOwnProperty(r)?this.equs[r]:i)&&t&&(this.finalEmit?this.directiveError(g("unknown label: {0}",e)):i=11111),i}align(e){for(f.assert(2==e||4==e||8==e||16==e);this.location()%e!=0;)this.emitOpCode(0)}pushError(e,t=""){e={scope:this.scope,message:g("  -> Line {2} ('{1}'), error: {0}\n{3}",e,this.currLine.text,this.currLine.lineNo,t),lineNo:this.currLine.lineNo,line:this.currLine.text,coremsg:e,hints:t};if(this.errors.push(e),this.throwOnError)throw new Error(e.message)}directiveError(e){this.pushError(e)}emitString(e,t=!1){function i(e,t){return 255&(e.charCodeAt(t)||0)}e=/^\s*([\w\.]+\s*:\s*)?.\w+\s+(".*")\s*$/.exec(e);let r;if(e&&null!=(r=a(e[2])))if(this.align(2),t)for(let e=0;e<r.length;e++)this.emitShort(r.charCodeAt(e));else for(let e=0;e<r.length+1;e+=2)this.emitShort(i(r,e+1)<<8|i(r,e));else this.directiveError(g("expecting string"))}parseNumber(e){e=this.parseOneInt(e.shift());return null==e?null:e}parseNumbers(e){e=e.slice(1);for(var t=[];;){var i=this.parseNumber(e);if(null==i){this.directiveError(g("cannot parse number at '{0}'",e[0]));break}if(t.push(i),","!=e[0]){if(null==e[0])break;this.directiveError(g("expecting number, got '{0}'",e[0]));break}if(e.shift(),null==e[0])break}return t}emitSpace(e){var t=this.parseNumbers(e);if(1==t.length&&t.push(0),2!=t.length)this.directiveError(g("expecting one or two numbers"));else if(t[0]%2!=0)this.directiveError(g("only even space supported"));else{var i=255&t[1];i|=i<<8;for(let e=0;e<t[0];e+=2)this.emitShort(i)}}emitBytes(e){var t=this.parseNumbers(e);t.length%2!=0&&(this.directiveError(".bytes needs an even number of arguments"),t.push(0));for(let e=0;e<t.length;e+=2){var i=t[e],r=t[e+1];0<=i&&r<=255&&0<=r&&i<=255?this.emitShort(255&i|(255&r)<<8):this.directiveError(g("expecting uint8"))}}emitHex(e){e.slice(1).forEach(t=>{if(","!=t)if(t.length%4!=0)this.directiveError(".hex needs an even number of bytes");else if(/^[a-f0-9]+$/i.test(t))for(let e=0;e<t.length;e+=4){var i=parseInt(t.slice(e,e+4),16);this.emitShort((255&i)<<8|i>>8&255)}else this.directiveError(".hex needs a hex number")})}handleDirective(t){let i=t.words;var e=()=>{2!=i.length&&this.directiveError(g("expecting one argument"))};let r;switch(i[0]){case".object":if(this.codeSizeStats)if("PUSH"==i[1])this.objSuspendStart=this.location();else if("POP"==i[1])this.objSuspendStart&&(this.currObject.sizeAdj+=this.location()-this.objSuspendStart),this.objSuspendStart=0;else{if(this.currObject&&(this.currObject.endLocation=this.location()),this.currObject=f.U.lookup(this.idToObject,i[1]),!this.currObject){var n=t.text.replace(/^[^"]*/,"");let e=i[1];2<i.length&&null==(e=a(n.trim()))&&this.directiveError(g("expecting string in .object")),this.currObject=new c(i[1],e),this.idToObject[i[1]]=this.currObject}this.currObject.sizeAdj=0,this.currObject.startLocation=this.location()}break;case".ascii":case".asciz":case".string":this.emitString(t.text);break;case".utf16":this.emitString(t.text,!0);break;case".align":if(e(),null!=(r=this.parseOneInt(i[1]))){if(0==r)return;r<=4?this.align(1<<r):this.directiveError(g("expecting 1, 2, 3 or 4 (for 2, 4, 8, or 16 byte alignment)"))}else this.directiveError(g("expecting number"));break;case".balign":if(e(),null!=(r=this.parseOneInt(i[1]))){if(1==r)return;2==r||4==r||8==r||16==r?this.align(r):this.directiveError(g("expecting 2, 4, 8, or 16"))}else this.directiveError(g("expecting number"));break;case".p2align":e(),null!=(r=this.parseOneInt(i[1]))?this.align(1<<r):this.directiveError(g("expecting number"));break;case".byte":this.emitBytes(i);break;case".hex":this.emitHex(i);break;case".hword":case".short":case".2bytes":this.parseNumbers(i).forEach(e=>{-32768<=e&&e<=65535?this.emitShort(65535&e):this.directiveError(g("expecting int16"))});break;case".word":case".4bytes":case".long":this.parseNumbers(i).forEach(e=>{-2147483648<=e&&e<=4294967295?(this.emitShort(65535&e),this.emitShort(e>>16&65535)):this.directiveError(g("expecting int32"))});break;case".skip":case".space":this.emitSpace(i);break;case".set":case".equ":/^\w+$/.test(i[1])||this.directiveError(g("expecting name"));n=this.parseNumbers(i.slice(","==i[2]||"="==i[2]?2:1));1!=n.length&&this.directiveError(g("expecting one value")),void 0!==this.equs[i[1]]&&this.equs[i[1]]!=n[0]&&this.directiveError(g("redefinition of {0}",i[1])),this.equs[i[1]]=n[0];break;case".startaddr":this.location()&&this.directiveError(g(".startaddr can be only be specified at the beginning of the file")),e(),this.baseOffset=this.parseOneInt(i[1]);break;case"@stackmark":e(),this.stackpointers[i[1]]=this.stack;break;case"@stackempty":this.checkStack&&(null==this.stackpointers[i[1]]?this.directiveError(g("no such saved stack")):this.stackpointers[i[1]]!=this.stack&&this.directiveError(g("stack mismatch")));break;case"@scope":this.scope=i[1]||"",this.currLineNo=this.scope?0:this.realCurrLineNo;break;case".syntax":case"@nostackcheck":this.checkStack=!1;break;case"@dummystack":e(),this.stack+=this.parseOneInt(i[1]);break;case".section":case".global":this.stackpointers={},this.stack=0,this.scope="$S"+this.scopeId++;break;case".comm":{(i=i.filter(e=>","!=e)).shift();n=this.parseOneInt(i[1]);let e=0;if(e=i[2]?this.parseOneInt(i[2]):4,null==this.lookupLabel(i[0])){for(this.commPtr||(this.commPtr=this.lookupExternalLabel("_pxt_comm_base")||0,this.commPtr)||this.directiveError(g("PXT_COMM_BASE not defined"));this.commPtr&e-1;)this.commPtr++;this.labels[this.scopedName(i[0])]=this.commPtr-this.baseOffset,this.commPtr+=n}break}case".file":case".text":case".cpu":case".fpu":case".eabi_attribute":case".code":case".thumb_func":case".type":case".fnstart":case".save":case".size":case".fnend":case".pad":case".globl":case".local":case"@":break;default:/^\.cfi_/.test(i[0])||this.directiveError(g("unknown directive"))}}handleOneInstruction(e,t){this.codeSizeStats&&e.ldlitLabel&&this.useLabel(e.ldlitLabel);var i=t.emit(e);return!i.error&&(this.stack+=i.stack,this.checkStack&&this.stack<0&&this.pushError(g("stack underflow")),e.location=this.location(),e.opcode=i.opcode,e.stack=i.stack,this.emitOpCode(i.opcode),null!=i.opcode2&&this.emitOpCode(i.opcode2),null!=i.opcode3&&this.emitOpCode(i.opcode3),e.instruction=t,e.numArgs=i.numArgs,!0)}handleInstruction(r){if(!r.instruction||!this.handleOneInstruction(r,r.instruction)){var e=e=>this.ei.instructions.hasOwnProperty(e)?this.ei.instructions[e]:[];if(!r.instruction){var t=e(r.words[0]);for(let e=0;e<t.length;++e)if(this.handleOneInstruction(r,t[e]))return}var n=r.words[0].toLowerCase().replace(/s$/,"").replace(/[^a-z]/g,"");let i="";e=e(n).concat(e(n+"s"));0<e.length&&e.forEach(e=>{var t=e.emit(r);i+=g("   Maybe: {0} ({1} at '{2}')\n",e.toString(),t.error,t.errorAt)}),this.pushError(g("assembly error"),i)}}buildLine(e,t){var i=e=>{e=new l(this,e);return e.scope=this.scope,e.lineNo=this.currLineNo,t.push(e),e};let r=i(e);var n=o(r.text)||[];let a=(r.words=n)[0]||"";if(":"==a.charAt(a.length-1)){var s=/^([\.\w]+):$/.exec(n[0]);if(s){if(r.type="label",r.text=s[1]+":",r.words=[s[1]],!(1<n.length))return;n.shift(),(r=i(e.replace(/^[^:]*:/,""))).words=n,a=n[0]||""}}s=a.charAt(0);"."==s||"@"==s?(r.type="directive","@scope"==r.words[0]&&this.handleDirective(r)):0==r.words.length?r.type="empty":r.type="instruction"}prepLines(e){this.currLineNo=0,this.realCurrLineNo=0,this.lines=[],e.split(/\r?\n/).forEach(e=>{10<this.errors.length||(this.currLineNo++,this.realCurrLineNo++,this.buildLine(e,this.lines))})}iterLines(){this.stack=0,this.buf=[],this.scopeId=0,this.lines.forEach(e=>{var t,i;10<this.errors.length||0!=(this.currLine=e).words.length&&("label"==e.type?(this.currObject&&!this.labelsToObjectDone&&"."!=e.words[0][0]&&(this.labelToObject[e.words[0]]=this.currObject),t=this.scopedName(e.words[0]),this.prevLabel=t,this.finalEmit?(null!=this.equs[t]&&this.directiveError(g(".equ redefined as label")),null==(i=this.labels[t])&&f.oops(),0==this.errors.length&&i!=this.location()&&f.oops(`invalid location: ${this.location()} != ${i} at `+t),f.assert(0<this.errors.length||i==this.location()),this.reallyFinalEmit&&(this.stackAtLabel[t]=this.stack)):this.labels.hasOwnProperty(t)?this.directiveError(g("label redefinition")):this.inlineMode&&/^_/.test(t)?this.directiveError(g("labels starting with '_' are reserved for the compiler")):this.labels[t]=this.location(),e.location=this.location()):"directive"==e.type?this.handleDirective(e):"instruction"==e.type?this.handleInstruction(e):"empty"!=e.type&&f.oops())}),this.labelsToObjectDone=!0,this.currObject=null}getSourceMap(){let e={},r="",n=0,a=0,s=0;function o(){r&&a&&(e[r]||(e[r]=[]),e[r].push(n,a,s-a)),a=0,s=0}return this.lines.forEach((e,t)=>{var i=/^; ([\w\/\.-]+)\(([\d]+),\d+\):/.exec(e.text);i&&(o(),r=i[1],n=parseInt(i[2])),"instruction"==e.type&&(a=a||e.location,s=e.location)}),o(),e}getCodeSizeStats(){if(!this.codeSizeStats)return"";var e,t=f.U.values(this.idToObject);t.sort((e,t)=>t.size-e.size);let i=";\n; Code size:\n;\n";for(e of t)if(i+=`; ${("         "+e.size).slice(-6)} ${e.description} [${e.id}]
`,5<=e.users.length)i+=`;        by many, including ${e.users[0].description}
`;else for(var r of e.users)i+=`;        by ${r.description} [${r.id}]
`;return i}getSource(r,e=1,t=0){let i=0;var n=e=>{var e=this.labels[e]||i,t=e-i;return i=e,t},a=this.buf?this.location():0,s=n("_code_end"),o=n("_helpers_end"),l=n("_vtables_end"),n=n("_literals_end"),c=i,u=a+this.baseOffset&16777215;if(t&&t<u)throw(d=new Error(g("program too big by {0} bytes!",u-t))).ksErrorCode=9283,d;var d=g("; total bytes: {0} ({1}% of {2}k flash with {3} free)",u,(100*u/(t=t||131072)).toFixed(1),(t/1024).toFixed(1),t-u);let h=g("; generated code sizes (bytes): {0} (incl. {1} user, {2} helpers, {3} vtables, {4} lits); src size {5}\n",c,s,o,l,n,a-c)+g("; assembly: {0} lines; density: {1} bytes/stmt; ({2} stmts)\n",this.lines.length,Math.round(100*s/e)/100,e)+d+"\n"+this.stats+this.getCodeSizeStats()+"\n\n",p=!1;return this.lines.forEach((t,i)=>{if("_stored_program"==t.words[0])h+='_stored_program: .string "..."\n',p=!0;else if(p)p=!1;else{let e=t.text;if(r){if("@stackempty"==t.words[0]&&this.lines[i-1].text==t.text)return;if(!(e=e.replace(/; WAS: .*/,"")).trim())return}!m.debug||"label"!=t.type&&"instruction"!=t.type||(e+=` 	; 0x`+(t.location+this.baseOffset).toString(16)),h+=e+"\n"}}),h}peepHole(){var t=this.lines.filter(e=>"empty"!=e.type);for(let e=0;e<t.length;++e){var i,r,n=t[e];/^user/.test(n.scope)||(i=t[e+1])&&(r=t[e+2],"instruction"==n.type)&&this.ei.peephole(n,i,r)}}clearLabels(){this.labels={},this.commPtr=0}peepPass(e){this.disablePeepHole||(this.peepOps=0,this.peepDel=0,this.peepCounts={},this.peepHole(),this.throwOnError=!0,this.finalEmit=!1,this.clearLabels(),this.iterLines(),f.assert(!this.checkStack||0==this.stack),this.finalEmit=!0,this.reallyFinalEmit=e||0==this.peepOps,this.iterLines(),this.stats+=g("; peep hole pass: {0} instructions removed and {1} updated\n",this.peepDel,this.peepOps-this.peepDel))}getLabels(){return this.userLabelsCache||(this.userLabelsCache=f.U.mapMap(this.labels,(e,t)=>t+this.baseOffset)),this.userLabelsCache}emit(e){if(f.assert(null==this.buf),this.prepLines(e),!(0<this.errors.length||(this.clearLabels(),this.iterLines(),this.checkStack&&0!=this.stack&&this.directiveError(g("stack misaligned at the end of the file")),0<this.errors.length)||(this.ei.expandLdlit(this),this.clearLabels(),this.iterLines(),this.finalEmit=!0,this.reallyFinalEmit=this.disablePeepHole,this.iterLines(),0<this.errors.length))){for(let e=0;e<5&&(pxt.debug("Peephole OPT, pass "+e),this.peepPass(5==e),0!=this.peepOps);++e);pxt.debug("emit done")}}}m.File=u;class t extends u{constructor(e){super(e)}}function o(t){var i=[];let r="";e:for(let e=0;e<t.length;++e)switch(t[e]){case"[":case"]":case"!":case"{":case"}":case",":r&&(i.push(r),r=""),i.push(t[e]);break;case" ":case"\t":case"\r":case"\n":r&&(i.push(r),r="");break;case";":break e;default:r+=t[e]}return r&&(i.push(r),r=""),i[0]?i:null}function a(e){e=e.replace(/\\\\/g,"\\B").replace(/\\(['\?])/g,(e,t)=>t).replace(/\\[z0]/g,"\0").replace(/\\x([0-9a-f][0-9a-f])/gi,(e,t)=>"\\u00"+t).replace(/\\B/g,"\\\\");try{return JSON.parse(e)}catch(e){return null}}function v(e,t){return{stack:null,opcode:null,error:e,errorAt:t}}function n(e){return(e<0||65535<e?"0x"+e.toString(16):"0x"+("000"+e.toString(16)).slice(-4)).toLowerCase()}m.VMFile=t,m.AbstractProcessor=class{constructor(){this.file=null,this.addEnc=(e,t,i)=>{t={name:e,pretty:t,encode:i,isRegister:/^\$r\d/.test(e),isImmediate:/^\$i\d/.test(e),isRegList:/^\$rl\d/.test(e),isLabel:/^\$l[a-z]/.test(e)};return this.encoders[e]=t},this.inrange=(e,t,i)=>Math.floor(t)!=t||t<0||e<t?null:i,this.inminmax=(e,t,i,r)=>Math.floor(i)!=i||i<e||t<i?null:r,this.inseq=(e,t)=>{e=e.indexOf(t);return e<0?null:e},this.inrangeSigned=(e,t,i)=>Math.floor(t)!=t||t<-(e+1)||e<t?null:i&(e<<1|1),this.addInst=(e,t,i,r)=>{e=new s(this,e,t,i,r);return this.instructions.hasOwnProperty(e.name)||(this.instructions[e.name]=[]),this.instructions[e.name].push(e),e},this.encoders={},this.instructions={}}toFnPtr(e,t,i){return e}wordSize(){return-1}computeStackOffset(e,t){return t}is32bit(e){return!1}emit32(e,t,i){return null}postProcessRelAddress(e,t){return t}postProcessAbsAddress(e,t){return t}peephole(e,t,i){}registerNo(e){return null}getAddressFromLabel(e,t,i,r=0){return null}isPop(e){return!1}isPush(e){return!1}isAddSP(e){return!1}isSubSP(e){return!1}testAssembler(){f.assert(!1)}expandLdlit(e){}},m.emitErr=v,m.expectError=function(e,t){(e=new u(e)).emit(t),0==e.errors.length&&f.oops("ASMTEST: expecting error for: "+t)},m.tohex=n,m.expect=function(e,t){let i=[];var t=t.replace(/^([0-9a-fA-F]{4,8})\s/gm,(e,t)=>(i.push(parseInt(t.slice(0,4),16)),8==t.length&&i.push(parseInt(t.slice(4,8),16)),"")),r=new u(e);r.throwOnError=!0,r.disablePeepHole=!0,r.emit(t),0<r.errors.length&&(pxt.debug(r.errors[0].message),f.oops("ASMTEST: not expecting errors")),r.buf.length!=i.length&&f.oops("ASMTEST: wrong buf len");for(let e=0;e<i.length;++e)r.buf[e]!=i[e]&&f.oops("ASMTEST: wrong buf content at "+e+" , exp:"+n(i[e])+", got: "+n(r.buf[e]))}}})(ts=ts||{}),(f=>{{var n=f.Cloud||(f.Cloud={}),a=pxtc.Util;n.apiRoot=f.BrowserUtils.isLocalHost()||a.isNodeJS?"https://www.makecode.com/api/":"/api/",n.accessToken="";let i=!(n.localToken=""),r=(n.onOffline=()=>{},void 0);function s(e){let t=new Error(a.lf("Cannot access {0} while offline",e));return t.isOffline=!0,f.U.delay(1e3).then(()=>Promise.reject(t))}function m(e,t){return f.U.requestAsync({url:"/api/"+e,headers:{Authorization:n.localToken},method:t?"POST":"GET",data:t||void 0,allowHttpErrors:!0})}function g(){return f.webConfig&&!f.webConfig.isStatic&&!f.BrowserUtils.isLocalHost()&&!!f.webConfig.cdnUrl&&("undefined"==typeof window||!/nocdn=1/i.test(window.location.href))}function e(e){var t;return e=e.replace(/^\//,""),g()?(t=(t=new Date).getUTCFullYear()+("0"+(t.getUTCMonth()+1)).slice(-2)+("0"+t.getUTCDate()).slice(-2),e.indexOf("?")<0?e+="?":e+="&",f.webConfig.cdnUrl+"/api/"+(e+="cdn="+t)):n.apiRoot+e}function v(t){return g()?(t.url=e(t.url),a.requestAsync(t).catch(e=>o(t,e))):b(t)}function o(e,t){return 0==t.statusCode?(i&&(i=!1,n.onOffline()),s(e.url)):Promise.reject(t)}function b(t){var e;return t.url=null!=(e=f.webConfig)&&e.isStatic&&!t.forceLiveEndpoint?f.webConfig.relprefix+t.url:n.apiRoot+t.url,t.allowGzipPost=!0,n.isOnline()||f.BrowserUtils.isPxtElectron()?(t.headers||(t.headers={}),f.BrowserUtils.isLocalHost()?n.localToken&&(t.headers.Authorization=n.localToken):n.accessToken&&(t.headers["x-td-access-token"]=n.accessToken),a.requestAsync(t).catch(e=>o(t,e))):s(t.url)}function t(){return navigator&&navigator.onLine}n.hasAccessToken=function(){return!!n.accessToken},n.localRequestAsync=m,n.useCdnApi=g,n.cdnApiUrl=e,n.apiRequestWithCdnAsync=v,n.privateRequestAsync=b,n.privateGetTextAsync=function(e,t){return b({url:e,headers:t}).then(e=>e.text)},n.privateGetAsync=function(e,t=!1){return b({url:e,forceLiveEndpoint:t}).then(e=>e.json)},n.downloadTargetConfigAsync=function(){var e;return n.isOnline()?(e=f.appTarget.versions&&f.appTarget.versions.target,e=f.webConfig&&f.webConfig.isStatic?"targetconfig.json":`config/${f.appTarget.id}/targetconfig`+(e?"/v"+e:""),f.BrowserUtils.isLocalHost()?m(e).then(e=>e?e.json:void 0):v({url:e}).then(e=>e.json)):Promise.resolve(void 0)},n.downloadScriptFilesAsync=function(e){return b({url:e+"/text"+(e.startsWith("S")?"?time="+Date.now():""),forceLiveEndpoint:!0}).then(e=>JSON.parse(e.text))},n.downloadScriptMetaAsync=function(e){return b({url:e+(e.startsWith("S")?"?time="+Date.now():""),forceLiveEndpoint:!0}).then(e=>JSON.parse(e.text).meta)},n.downloadBuiltSimJsInfoAsync=async function(e){var t=f.appTarget.versions&&f.appTarget.versions.target||"";return(await b({url:f.U.stringifyQueryString(e+"/js",{v:"v"+t})+(e.startsWith("S")?"&time="+Date.now():""),forceLiveEndpoint:!0})).json},n.markdownAsync=async function(t,i,r,n){var e=24*(c=f.BrowserUtils.isLocalHostDev()?0:36e5)*7;i=i||f.Util.userLanguage();let a=await f.BrowserUtils.translationDbAsync(),s=await a.getAsync(i,t);var o=async()=>{try{var e=await(async(e,t,i,r)=>{let n,a=null==(n=f.webConfig)?void 0:n.isStatic,s=f.appTarget.versions&&f.appTarget.versions.target||"?",o,l=new URLSearchParams;var c,u;if(a?(o=e,u=/\/?docs\//.test(o),c=/\.\w+$/.test(o),u||(u="/"===o[0],o="docs"+(u?"":"/")+o),c||(o+=".md")):(o=`md/${f.appTarget.id}/`+e.replace(/^\//,""),l.set("targetVersion",s)),"en"!=t&&l.set("lang",t),o=f.BrowserUtils.appendUrlQueryParams(o,l),f.BrowserUtils.isLocalHost()&&!f.Util.liveLocalizationEnabled())return m(o).then(e=>404==e.statusCode?b({url:o,method:"GET"}).then(e=>({md:e.text,etag:e.headers.etag})):{md:e.text,etag:void 0});let d=i&&!g()?{"If-None-Match":i}:void 0,h,p;return{md:p=!a&&r?(o=o.replace(/^md\//,"ghtutorial/docs/"),u=(h=await v({url:o,method:"GET",headers:d})).json,await f.github.db.cacheReposAsync(u),u.markdown):(h=await v({url:o,method:"GET",headers:d})).text,etag:h.headers.etag}})(t,i,null==s?void 0:s.etag,n);return!s||e.md&&s.md!==e.md?(await a.setAsync(i,t,e.etag,void 0,e.md),e.md):s.md}catch(e){if(r)throw e;return""}};if(s){var l=Date.now()-s.time,c=c<l;if(e<l)f.tickEvent("markdown.update.wait");else if(c&&(f.tickEvent("markdown.update.background"),o()),s.md)return s.md}return o()},n.privateDeleteAsync=function(e){return b({url:e,method:"DELETE"}).then(e=>e.json)},n.privatePostAsync=function(e,t,i=!1){return b({url:e,data:t||{},forceLiveEndpoint:i}).then(e=>e.json)},n.isLoggedIn=function(){return!!n.accessToken},n.isNavigatorOnline=t,n.isOnline=function(){return i="undefined"!=typeof navigator&&t()?!0:i},n.getServiceUrl=function(){return n.apiRoot.replace(/\/api\/$/,"")},n.getUserId=function(){var e=/^0(\w+)\./.exec(n.accessToken);return e?e[1]:null},n.parseScriptId=function(t){var i=f.appTarget;if(t&&i.appTheme&&null!=(r=i.cloud)&&r.sharing){let e=["makecode.com"];i.appTheme.embedUrl&&e.push(i.appTheme.embedUrl),i.appTheme.shareUrl&&e.push(i.appTheme.shareUrl);var r=`(?:(?:https://)?(?:${(e=a.unique(e,e=>e).map(e=>a.escapeForRegex(a.stripUrlProtocol(e).replace(/\/$/,"")).toLowerCase())).join("|")})/)`,i=new RegExp(`^${r}?(?:v[0-9]+/)?(?:(?:api/oembed\\?url=.*%2F([^&#]*)&.*)|(?:/?([a-z0-9\\-_]+)(?:[#?&].*)?))$`,"i").exec(t.trim()),r=(null==i?void 0:i[1])||(null==i?void 0:i[2]);return/^(_.{12}|S?[0-9\-]{23})$/.test(r)?r:void 0}},n.initRegionAsync=async function(){var e;if(void 0===r)if(f.BrowserUtils.isLocalHost())r=f.cloud.DEV_REGION;else if(null!=(e=f.webConfig)&&e.cdnUrl)try{var t={url:new URL("geo",f.webConfig.cdnUrl).toString()},i=await a.requestAsync(t);200!==i.statusCode&&f.error("Failed to get region: "+i.statusCode),r=i.text.trim()}catch(e){f.error("Unable to determine region",e),r="unknown"}else r="unknown"},n.getRegion=function(){return r||f.error("Accessing region before it is initialized. Call initRegionAsync first."),r}}})(pxt=pxt||{}),(e=>{(e.pxtc||(e.pxtc={})).f4EncodeImg=function(e,i,r,n){let t=[135,r,255&e,e>>8,255&i,i>>8,0,0].map(c).join(""),a=4,s=0,o=0;var l=e=>{s|=e<<o,o==8-r?(t+=c(s),a++,s=0,o=0):o+=r};for(let t=0;t<e;++t){for(let e=0;e<i;++e)l(n(t,e));for(;0!=o;)l(0);if(1<r)for(;3&a;)l(0)}return t;function c(e){return("0"+e.toString(16)).slice(-2)}}})(ts=ts||{}),(e=>{function a(e){let t="";switch(e){case 0:t="C5";break;case 1:t="B";break;case 2:t="A";break;case 3:t="G";break;case 4:t="F";break;case 5:t="E";break;case 6:t="D";break;case 7:t="C"}return t}function r(e){let t=-1;switch(e){case"C5":t=0;break;case"B":t=1;break;case"A":t=2;break;case"G":t=3;break;case"F":t=4;break;case"E":t=5;break;case"D":t=6;break;case"C":t=7}return t}e.MelodyArray=class{constructor(e){this.numCols=8,this.numRows=8,this.polyphonic=!1,e&&(this.tempo=e),this.resetMelody()}setTempo(e){this.tempo=e}getArray(){return this.melody}setArray(e){this.melody=e}getColor(e){return 0}getValue(e,t){return this.melody[e][t]}getWidth(){return this.numCols}getHeight(){return this.numRows}updateMelody(e,t){var i=!this.melody[e][t];if(i&&!this.polyphonic)for(let e=0;e<this.numRows;e++)this.melody[e][t]=!1;this.melody[e][t]=i}getStringRepresentation(){let t="";var r=new Array(this.numCols);let n=0;for(let i=0;i<this.numRows;i++){let t=0;r[i]=[];for(let e=0;e<this.numCols;e++)this.melody[e][i]&&(r[i].push(a(e)),t++);t>n&&(n=t)}if(0==n)return"- - - - - - - - ";for(let e=0;e<n;e++)for(let e=0;e<this.numCols;e++)r[e]&&0<r[e].length?t+=r[e].shift()+" ":t+="- ";return t}parseNotes(e){var i=(e=e.trim()).split(" ");for(let t=0;t<i.length;t++){for(let e=0;e<this.numRows;e++)this.melody[e][t]=!1;"-"!=i[t]&&(this.melody[r(i[t])][t]=!0)}}setPolyphonic(e){this.polyphonic=e}isPolyphonic(){return this.polyphonic}resetMelody(){this.melody=new Array(this.numCols);for(let e=0;e<this.numCols;e++)this.melody[e]=new Array(this.numRows).fill(!1)}},e.rowToNote=a,e.noteToRow=r,e.getColorClass=function(e){let t="melody-default";switch(e){case 0:t="melody-red";break;case 1:t="melody-orange";break;case 2:t="melody-yellow";break;case 3:t="melody-green";break;case 4:t="melody-teal";break;case 5:t="melody-blue";break;case 6:t="melody-purple";break;case 7:t="melody-violet"}return t}})(pxtmelody=pxtmelody||{}),(a=>{function c(e,t,i){var r=document.createElement(e),n=t,e=i;if(n)for(var a of Object.keys(n))"className"===a?r.setAttribute("class",n[a]+""):r.setAttribute(a,n[a]+"");return e&&r.addEventListener("click",e),r}a.MelodyGallery=class{constructor(){this.value=null,this.visible=!1,this.timeouts=[],this.numSamples=a.SampleMelodies.length,this.containerDiv=document.createElement("div"),this.containerDiv.setAttribute("id","melody-editor-gallery-outer"),this.contentDiv=document.createElement("div"),this.contentDiv.setAttribute("id","melody-editor-gallery"),this.contentDiv.setAttribute("role","menu"),this.contentDiv.setAttribute("tabindex","0"),this.keyDownHandler=this.keyDownListener.bind(this),this.contentDiv.addEventListener("keydown",this.keyDownHandler),this.focusHandler=this.focusListener.bind(this),this.contentDiv.addEventListener("focus",this.focusHandler),this.blurHandler=this.blurListener.bind(this),this.contentDiv.addEventListener("blur",this.blurHandler),this.itemBackgroundColor="#DCDCDC",this.itemBorderColor="white",this.initStyles(),this.containerDiv.appendChild(this.contentDiv),this.containerDiv.style.display="none",this.contentDiv.addEventListener("animationend",()=>{this.visible||(this.containerDiv.style.display="none")}),this.contentDiv.addEventListener("wheel",e=>{e.stopPropagation()},!0)}keyDownListener(e){if(this.selectedColRow){var[t,i]=this.selectedColRow,r=pxt.Util.isUserLanguageRtl()?"ArrowRight":"ArrowLeft",n=pxt.Util.isUserLanguageRtl()?"ArrowLeft":"ArrowRight";switch(e.code){case"ArrowUp":this.selectedColRow=[t,Math.max(0,i-1)];break;case"ArrowDown":this.selectedColRow=[t,Math.min(this.selectionButtons.length-1,i+1)];break;case r:this.selectedColRow=[Math.max(0,t-1),i];break;case n:this.selectedColRow=[Math.min(1,t+1),i];break;case"Enter":case"Space":return this.selectedElement.click(),e.stopPropagation(),void e.preventDefault();default:return}this.selectedElement.classList.remove("selected");var[r,n]=this.selectedColRow,r=(this.selectedElement=(0===r?this.selectionButtons:this.previewButtons)[n],this.selectedElement.classList.add("selected"),this.contentDiv.setAttribute("aria-activedescendant",getCellId(r,n)),this.contentDiv.getBoundingClientRect()),n=this.selectedElement.getBoundingClientRect();n.bottom>r.bottom?this.selectedElement.scrollIntoView({block:"end"}):n.top<r.top&&this.selectedElement.scrollIntoView({block:"start"}),e.stopPropagation(),e.preventDefault()}}focusListener(e){this.selectedElement||(this.selectedColRow=[0,0],this.selectedElement=this.selectionButtons[0]),this.selectedElement.classList.add("selected");var[t,i]=this.selectedColRow;this.contentDiv.setAttribute("aria-activedescendant",getCellId(t,i))}blurListener(e){var t;this.contentDiv.removeAttribute("aria-activedescendant"),null!=(t=this.selectedElement)&&t.classList.remove("selected")}getElement(){return this.containerDiv}getValue(){return this.value}show(e){this.pending=e,this.containerDiv.style.display="block",this.buildDom(),this.visible=!0,pxt.BrowserUtils.removeClass(this.contentDiv,"hidden-above"),pxt.BrowserUtils.addClass(this.contentDiv,"shown")}hide(){var e;this.visible=!1,pxt.BrowserUtils.removeClass(this.contentDiv,"shown"),pxt.BrowserUtils.addClass(this.contentDiv,"hidden-above"),this.value=null,this.stopMelody(),this.contentDiv.removeAttribute("aria-activedescendant"),null!=(e=this.selectedElement)&&e.classList.remove("selected"),this.selectedElement=void 0,this.selectedColRow=void 0}clearDomReferences(){this.contentDiv.removeEventListener("keydown",this.keyDownHandler),this.contentDiv.removeEventListener("focus",this.focusHandler),this.contentDiv.removeEventListener("blur",this.blurHandler),this.contentDiv=null,this.containerDiv=null}layout(e,t,i){this.containerDiv.style.left=e+"px",this.containerDiv.style.top=t+"px",this.containerDiv.style.height=i+"px"}getLastFocusableElement(){return this.contentDiv}buildDom(){for(;this.contentDiv.firstChild;)this.contentDiv.removeChild(this.contentDiv.firstChild);var t=a.SampleMelodies;this.playIcons=[],this.selectionButtons=[],this.previewButtons=[];for(let e=0;e<t.length;e++)this.mkButton(t[e],e,"255px","45px")}initStyles(){var e=document.createElement("style");e.textContent=`
            #melody-editor-gallery {
                margin-top: -100%;
            }

            #melody-editor-gallery.hidden-above {
                margin-top: -100%;
                animation: slide-up 0.2s 0s ease;
            }

            #melody-editor-gallery.shown {
                margin-top: 0px;
                animation: slide-down 0.2s 0s ease;
            }

            @keyframes slide-down {
                0% {
                    margin-top: -100%;
                }
                100% {
                    margin-top: 0px;
                }
            }

            @keyframes slide-up {
                0% {
                    margin-top: 0px;
                }
                100% {
                    margin-top: -100%;
                }
            }
            `,this.containerDiv.appendChild(e)}mkButton(e,t,i,r){var n=c("div",{className:"melody-gallery-button melody-editor-card",id:":"+t}),a=c("i",{className:"music icon melody-icon"}),s=c("div",{className:"melody-editor-text"}),o=(s.innerText=e.name,this.createColorBlock(e)),l=c("div",{className:"melody-editor-button left-button",role:"menuitem",title:e.name,tabIndex:-1,id:getCellId(t,0)},()=>this.handleSelection(e)),a=(l.appendChild(a),l.appendChild(s),l.appendChild(o),n.appendChild(l),this.selectionButtons[t]=l,c("div",{className:"melody-editor-button right-button",role:"menuitem",title:lf("Preview {0}",e.name),tabIndex:-1,id:getCellId(t,1)},()=>this.togglePlay(e,t))),s=c("i",{className:"play icon"});this.playIcons[t]=s,a.appendChild(s),n.appendChild(a),this.previewButtons[t]=a,this.contentDiv.appendChild(n)}handleSelection(e){var t;this.pending&&(t=this.pending,this.pending=void 0,t(e.notes))}playNote(e,t,i){let r=0;switch(e){case"C5":r=523;break;case"B":r=494;break;case"A":r=440;break;case"G":r=392;break;case"F":r=349;break;case"E":r=330;break;case"D":r=294;break;case"C":r=262}this.timeouts.push(setTimeout(()=>{pxt.AudioContextManager.tone(r)},t*this.getDuration(i))),this.timeouts.push(setTimeout(()=>{pxt.AudioContextManager.stop()},(t+1)*this.getDuration(i)))}getDuration(e){return 6e4/e}previewMelody(t){this.stopMelody();var i=t.notes.split(" ");for(let e=0;e<i.length;e++)this.playNote(i[e],e,t.tempo)}togglePlay(e,t){let i=this.playIcons[t];pxt.BrowserUtils.containsClass(i,"play icon")?(this.resetPlayIcons(),pxt.BrowserUtils.removeClass(i,"play icon"),pxt.BrowserUtils.addClass(i,"stop icon"),this.previewMelody(e),this.timeouts.push(setTimeout(()=>{pxt.BrowserUtils.removeClass(i,"stop icon"),pxt.BrowserUtils.addClass(i,"play icon")},e.notes.split(" ").length*this.getDuration(e.tempo)))):(pxt.BrowserUtils.removeClass(i,"stop icon"),pxt.BrowserUtils.addClass(i,"play icon"),this.stopMelody())}stopMelody(){for(;this.timeouts.length;)clearTimeout(this.timeouts.shift());pxt.AudioContextManager.stop()}resetPlayIcons(){for(let e=0;e<this.numSamples;e++){var t=this.playIcons[e];if(pxt.BrowserUtils.containsClass(t,"stop icon")){pxt.BrowserUtils.removeClass(t,"stop icon"),pxt.BrowserUtils.addClass(t,"play icon");break}}}createColorBlock(e){var t=document.createElement("div"),i=(pxt.BrowserUtils.addClass(t,"melody-color-block"),e.notes.split(" "));for(let e=0;e<i.length;e++){var r=a.getColorClass(a.noteToRow(i[e])),n=document.createElement("div");0==e?pxt.BrowserUtils.addClass(n,"left-edge sliver "+r):e==i.length-1?pxt.BrowserUtils.addClass(n,"right-edge sliver "+r):pxt.BrowserUtils.addClass(n,"sliver "+r),t.appendChild(n)}return t}}})(pxtmelody=pxtmelody||{}),(e,t)=>`:${e}-`+(0===t?"selection":"preview"));(e=>{class t{constructor(e,t,i){this.name=e,this.notes=t,this.tempo=i}}e.MelodyInfo=t,e.SampleMelodies=[new t(lf("Scale"),"C5 B A G F E D C",120),new t(lf("Reverse"),"C D E F G A B C5",120),new t(lf("Mystery"),"E B C5 A B G A F",120),new t(lf("Gilroy"),"A F E F D G E F",120),new t(lf("Falling"),"C5 A B G A F G E",120),new t(lf("Hopeful"),"G B A G C5 B A B",120),new t(lf("Tokyo"),"B A G A G F A C5",120),new t(lf("Paris"),"G F G A - F E D",120),new t(lf("Rising"),"E D G F B A C5 B",120),new t(lf("Sitka"),"C5 G B A F A C5 B",120)]})(pxtmelody=pxtmelody||{});