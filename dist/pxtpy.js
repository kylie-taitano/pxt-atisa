var pxt;(e=>{var t;e=e.py||(e.py={}),(t=e.VarModifier||(e.VarModifier={}))[t.NonLocal=0]="NonLocal",t[t.Global=1]="Global",e.isIndex=function(e){return"Index"===e.kind},e.isSubscript=function(e){return"Subscript"===e.kind}})(pxt=pxt||{}),(D=>{{var O=D.py||(D.py={}),R=D.blocks;let U,P,b,x=0,t=0,I=0,i="???",n=!1,a=void 0,A,w,_,K,L=void 0,F;function de(e){return null==e}function ye(e){return null!=e}function g(e){return D.tickEvent("python.todo.statement",{kind:e.kind}),R.mkStmt(R.mkText("TODO: "+e.kind))}function v(e){return D.tickEvent("python.todo.expression",{kind:e.kind}),R.mkText(" {TODO: "+e.kind+"} ")}let N=$({primType:"string"}),l=$({primType:"number"}),r=$({primType:"boolean"}),y=$({primType:"void"}),E=$({primType:"any"}),s=void 0,o={str:N,string:N,number:l,bool:r,void:y,any:E};function ke(e){e=D.U.flatClone(e);return delete e.pyAST,delete e.pyInstanceType,delete e.pyRetType,delete e.pySymbolType,delete e.moduleTypeMarker,delete e.declared,e.parameters&&(e.parameters=e.parameters.map(e=>(delete(e=D.U.flatClone(e)).pyType,e))),e}function h(e){if("("==e[0]&&D.U.endsWith(e,")"))return h(e.slice(1,-1));var t=e.indexOf(" => ");if(0<t){var n=e.slice(t+4);if(-1==n.indexOf(")[]"))return Te(h(n),((n=e.slice(1,t-1))?n.split(/, /):[]).map(e=>h(e.replace(/\w+\??: /,""))))}if(D.U.endsWith(e,"[]"))return G(h(e.slice(0,-2)));if("_py.Array"===e)return G(E);t=D.U.lookup(o,e);if(t)return t;if(!!e&&!isNaN(e))return l;if("T"==e||"U"==e)return $({primType:"'"+e});if(0<=e.indexOf("|"))return $({primType:"@union",typeArgs:e.split("|").map(e=>e.trim()).map(h)});n=q(e+"@type")||q(e);if(n){if(7==n.kind)return l;if(8==n.kind||9==n.kind)return n.pyInstanceType||$({classType:n});if(6==n.kind)return l;V(null,9502,D.U.lf("'{0}' is not a type near '{1}'",e,i||"???"))}else V(null,9501,D.U.lf("unknown type '{0}' near '{1}'",e,i||"???"));return $({primType:e})}function S(e){if(!e.pySymbolType){if(i=e.pyQName,e.parameters){pxtc.service.isTaggedTemplate(e)&&(e.parameters=[{name:"literal",description:"",type:"string",options:{}}]);for(var t of e.parameters)t.pyType||(t.pyType=h(t.type))}var n=e.pyRetType;if(De(e)?e.pyRetType=$({moduleType:e}):e.retType?null!=(r=e.qName)&&r.endsWith(".__constructor")&&"void"===e.retType?(r=M(e.qName.substring(0,e.qName.lastIndexOf("."))),e.pyRetType=r?$({classType:r}):h(e.retType)):e.pyRetType=h(e.retType):e.pyRetType||(D.U.oops("no type for: "+e.pyQName),e.pyRetType=$({})),n&&X(e.pyAST,n,e.pyRetType),3==e.kind||1==e.kind){var r=e.parameters.map(e=>e.pyType);if(r.some(de))return V(null,9526,D.U.lf("function symbol is missing parameter types near '{1}'",i||"???")),$({});e.pySymbolType=Te(e.pyRetType,r.filter(ye))}else e.pySymbolType=e.pyRetType;8!=e.kind&&9!=e.kind||(e.pyInstanceType=$({classType:e})),i=void 0}return e.pySymbolType}function q(e){return D.U.lookup(P,e)||D.U.lookup(U,e)}function M(e){var t;if(e){var n=q(e);if(n)S(n);else if(e.indexOf(".")&&!e.endsWith(".__constructor")){var r=e.substring(0,e.lastIndexOf(".")),i=M(r);if(8===(null==i?void 0:i.kind)&&null!=(t=i.extendsTypes)&&t.length)return M(i.extendsTypes[0]+e.substring(r.length))}return n}}function xe(e,t){P={},U={};var n,r=D.U.toDictionary(t,e=>e);for(n of D.U.values(e.byQName))if(!r.hasOwnProperty(n.fileName)){let t=n;t.extendsTypes&&(t.extendsTypes=t.extendsTypes.filter(e=>e!=t.qName)),t.pyQName&&t.qName||V(null,9526,D.U.lf("Symbol '{0}' is missing qName for '{1}'",t.name,t.pyQName?"ts":"py")),U[t.pyQName]=t,U[t.qName]=t}s=h("Buffer")}function $(e={}){e=D.U.flatClone(e);return e.tid=++t,e}function G(e){return $({primType:"@array",typeArgs:[e]})}function Te(e,t){return $({primType:"@fn"+t.length,typeArgs:[e].concat(t)})}function ge(e){return D.U.startsWith(e.primType||"","@fn")}function ve(e){return e.primType&&!D.U.startsWith(e.primType,"@")}function he(e){return D.U.startsWith(e.primType||"","@union")}function B(){return b.currFun||b.currClass||b.currModule}function Se(){let e=B();for(;e&&e.parent;)e=e.parent;return e}function be(){return"main"==b.currModule.name&&!b.currFun&&!b.currClass}function Q(t,e,n,r){let i=(r=r||B()).vars[t],a=null==i?void 0:i.symbol;if(!a){let e=W(r);e&&(e+=".");var s=e+t;a="ClassDef"===r.kind?Z(2,s):!Ae(r)||n!==O.VarModifier.Global&&n!==O.VarModifier.NonLocal?Ae(r)?Y(4,t):Z(4,s):Z(4,t),i={symbol:a,modifier:n},r.vars[t]=i}for(var o of Object.keys(e))a[o]=e[o];return i}function z(e){return e.unifyWith?(e.unifyWith=z(e.unifyWith),e.unifyWith):e}function W(e){let t="";return e.parent&&"FunctionDef"!==e.parent.kind&&"AsyncFunctionDef"!==e.parent.kind&&((t=W(e.parent))?t+=".":t=""),"Module"==e.kind&&"main"==e.name?"":e.name?t+e.name:t+"?"+e.kind}function Ne(e){var t,n=D.U.lookup(f,e);if(n)return n;for(t of D.U.values(b.currModule.vars)){var r=t.symbol;if(r.isImport){if(r.expandsTo==e)return r.pyName||V(null,9553,lf("missing pyName")),r.pyName;if(r.isImport&&D.U.startsWith(e,(r.expandsTo||"")+"."))return r.pyName+e.slice(r.expandsTo.length)}}return e}function j(e){var t=e=>n?e:"";return(e=z(e)).primType?e.typeArgs&&"@array"==e.primType?j(e.typeArgs[0])+"[]":ge(e)&&e.typeArgs?"("+e.typeArgs.slice(1).map(e=>"_: "+j(e)).join(", ")+") => "+j(e.typeArgs[0]):he(e)&&e.typeArgs?e.typeArgs.map(j).join(" | "):e.primType+t("/P"):e.classType&&e.classType.pyQName?Ne(e.classType.pyQName)+t("/C"):e.moduleType&&e.moduleType.pyQName?Ne(e.moduleType.pyQName)+t("/M"):"any"}function V(e,t,n){var r;w.push((e=e,r=pxtc.DiagnosticCategory.Error,t=t,n=n,(e=e||a)&&b&&b.currModule?{fileName:A,start:e.startPos,length:e.endPos-e.startPos,line:void 0,column:void 0,code:t,category:r,messageText:n}:{fileName:A,start:0,length:0,line:void 0,column:void 0,code:t,category:r,messageText:n}))}function H(e){return e.primType||e.classType||(e.moduleType?(e.moduleType.moduleTypeMarker||(e.moduleType.moduleTypeMarker={}),e.moduleType.moduleTypeMarker):null)}function Ee(e){return!H(z(e))}function Ce(e,t,n){(t=z(t)).classType!=n&&(Ee(t)?t.classType=n:X(e,t,(S(e=n),e.pyInstanceType||V(null,9527,D.U.lf("Instance type symbol '{0}' is missing pyInstanceType",e)),e.pyInstanceType)))}function J(e,t){X(e,re(e),t)}function X(t,n,r){if(n!==r&&(n=z(n))!==(r=z(r))&&!Ie(n)&&!Ie(r))if("any"===n.primType)n.unifyWith=r;else{var e,i,a=H(n),s=H(r);if(a&&s)if(a===s){if(n.unifyWith=r,n.typeArgs&&r.typeArgs)for(let e=0;e<Math.min(n.typeArgs.length,r.typeArgs.length);++e)X(t,n.typeArgs[e],r.typeArgs[e]);n.unifyWith=r}else e=n,i=r,V(t,9500,D.U.lf("types not compatible: {0} and {1}",j(e),j(i)));else a&&!s?X(t,r,n):(I++,n.unifyWith=r)}}function Ue(e,t){var n=z(re(e)),t=z(t);!function e(t,n){var r=z(t),t=z(n);if(r===t)return 1;n=H(r);let i=H(t);if(n===i)return 1;if(n&&i){if(Pe(n)&&Pe(i)&&n.extendsTypes&&n.extendsTypes.length&&n.extendsTypes.some(e=>e===i.qName))return 1;if(he(t))for(var a of t.typeArgs||[])if(e(r,a))return 1}}(n,t)&&(ge(n)||ge(t)||ve(n)||ve(t))&&X(e,n,t)}function Pe(e){return!(null==e||!e.name)}function Ie(e){return null!=(e=null==e?void 0:e.primType)&&e.startsWith("'")}function Y(e,t){var n=/(.*)\.(.*)/.exec(t),r=n?n[2]:t;return{kind:e,name:r,pyName:r,qName:t,pyQName:t,namespace:n?n[1]:"",attributes:{},pyRetType:$()}}function Z(e,t){let n=P[t];return n?n.kind=e:((n=Y(e,t)).pyQName||V(null,9527,D.U.lf("Symbol '{0}' is missing pyQName",t)),P[n.pyQName]=n),n}function Ae(e){let t=e;for(;t;){if("FunctionDef"==t.kind)return 1;t=t.parent}}function we(t,n,r){if(!n.symInfo){let e=W(n);D.U.endsWith(e,".__init__")&&(e=e.slice(0,-9)+".__constructor"),Ae(r=r||B())?n.symInfo=Y(t,e):n.symInfo=Z(t,e);t=n.symInfo;t.pyAST=n,t.pyName||V(null,9528,D.U.lf("Symbol '{0}' is missing pyName",t.qName||t.name)),r.vars[t.pyName]={symbol:t}}return n.symInfo}function _e(e){let t=e.symInfo.qName;return D.U.values(P).filter(e=>e.namespace==t&&2==e.kind)}function ee(e,t,n,r=!1,i=!1){let a;var s=M(a="__init__"===t?e.pyQName+".__constructor":t.startsWith(e.pyQName+".")?t:e.pyQName+"."+t);if(s)return s;if(!i)for(var o of e.extendsTypes||[]){o=M(o);if(o){o==e&&D.U.userError("field lookup loop on: "+o.qName+" / "+t);o=ee(o,t,n,!0);if(o)return o}}return!r&&e.pyAST&&"ClassDef"==e.pyAST.kind?((s=Z(2,a)).isInstance=!n,s):null}function Ke(e,t,n=!1){var r,i=re(e),a=[(a=z(a=i)).classType,...Le(a.primType),a.moduleType].filter(ye);for(r of a){var s=!!i.moduleType,o=ee(r,t,s,n);if(o)return s?o.isInstance&&V(null,9505,D.U.lf("the field '{0}' of '{1}' is not static",t,r.pyQName)):(je(e)||"Name"==(s=e).kind&&"self"==s.id&&(b.currClass||V(null,9529,D.U.lf("no class context found for {0}",o.pyQName)),o.namespace!=b.currClass.symInfo.qName))&&(o.isProtected=!0),o}return null}function Le(e){let t=[];return"@array"==e?t=[q("_py.Array"),q("Array")]:"string"==e&&(t=[q("_py.String"),q("String")]),t.filter(e=>!!e)}function Fe(e){let t=B();var n=D.U.lookup(t.vars,e);if(n)return n;for(;t;){var r=D.U.lookup(t.vars,e);if(r)return r;for(;(t=t.parent)&&"ClassDef"==t.kind;);}return null}function te(e){if(!e)return null;var t=e.indexOf(".");if(0<t){var n=Fe(e.slice(0,t)),n=null==n?void 0:n.symbol;n&&n.pyQName!=n.pyName&&(e=n.pyQName+e.slice(t))}else{n=Fe(e);if(n)return n}t=M(e);return t?{symbol:t}:void 0}function ne(e){return null==(e=te(e))?void 0:e.symbol}function re(e){return e.tsType?z(e.tsType):(e.tsType=$(),e.tsType)}function De(e){if(e)switch(e.kind){case 5:case 9:case 8:case 6:return 1;default:return}}function Oe(e){var t=D.U.flatClone(b);let n;try{n=e()}finally{b=t}return n}function ie(e,t){return 0==t.length?R.mkText(""):R.mkGroup([R.mkText("/* TODO: "+e+" "),R.mkGroup(t),R.mkText(" */"),R.mkNewLine()])}function Re(e){var t=me(e.value);return e.arg?R.mkInfix(R.mkText(e.arg),"=",t):R.mkGroup([R.mkText("**"),t])}function qe(e){if(!e)return $();var t=oe(e);if(t){var n=q(t+"@type")||q(t);if(n){if(S(n),6==n.kind)return l;if(n.pyInstanceType)return n.pyInstanceType}else if(o[t])return o[t];V(e,9506,D.U.lf("cannot find type '{0}'",t))}else if(O.isSubscript(e)){n="List"===oe(e.value);if(n)if(O.isIndex(e.slice))return G(qe(e.slice.value))}return V(e,9507,D.U.lf("invalid type syntax")),$({})}function Me(e){return e.pyName&&"_"==e.pyName[0]?e.isProtected?R.mkText("protected "):R.mkText("private "):R.mkText("")}let u={Sub:1,Div:1,Pow:1,LShift:1,RShift:1,BitOr:1,BitXor:1,BitAnd:1,FloorDiv:1,Mult:1},p={Eq:1,NotEq:1,Lt:1,LtE:1,Gt:1,GtE:1},c={Add:"+",Sub:"-",Mult:"*",MatMult:"Math.matrixMult",Div:"/",Mod:"%",Pow:"**",LShift:"<<",RShift:">>",BitOr:"|",BitXor:"^",BitAnd:"&",FloorDiv:"Math.idiv",And:"&&",Or:"||",Eq:"==",NotEq:"!=",Lt:"<",LtE:"<=",Gt:">",GtE:">=",Is:"===",IsNot:"!==",In:"py.In",NotIn:"py.NotIn"},m={Invert:"~",Not:"!",UAdd:"P+",USub:"P-"},f={"adafruit_bus_device.i2c_device.I2CDevice":"pins.I2CDevice"};function ae(e){b.blockDepth++;e=R.mkBlock(e.map(fe));return b.blockDepth--,e}function $e(e){e.vars||(e.vars={},e.parent=B(),e.blockDepth=b.blockDepth)}function Ge(e,t=!1){return"any"===j(e)?t?R.mkText(": any"):R.mkText(""):R.mkText(": "+j(e))}function e(t,e){try{return Oe(e)}catch(e){return D.log(e),R.mkStmt(ie("conversion failed for "+(t.name||t.kind),[]))}}function Be(e){return e&&e.pyAST&&"FunctionDef"==e.pyAST.kind&&(e=e.pyAST).callers&&1==e.callers.length?!e.callers[0].inCalledPosition:void 0}function Qe(f,d=!1){return e(f,()=>{var e=!!b.currClass&&!b.currFun,t=be(),n=!!b.currFun,r=($e(f),ne(W(f))),i=we(e?1:3,f);if(!d&&(r&&r.declared===x&&V(f,9520,lf("Duplicate function declaration")),i.declared=x,Be(i)))return R.mkText("");e&&(i.isInstance=!0),b.currFun=f;let a="",s=f.name;var o,r=[ie("decorators",f.decorator_list.filter(e=>"property"==oe(e)?!(a="get"):"Attribute"!=e.kind||"setter"!=e.attr||"Name"!=e.value.kind||(s=e.value.id,!(a="set"))).map(me))],l=(1<=f.body.length&&"Raise"==f.body[0].kind&&(f.alwaysThrows=!0),e?(b.currClass||V(f,9531,lf("method '{0}' is missing current class context",i.pyQName)),i.pyRetType||V(f,9532,lf("method '{0}' is missing a return type",i.pyQName)),"__init__"==f.name?(r.push(R.mkText("constructor")),Ce(f,i.pyRetType,b.currClass.symInfo)):("__get__"!=s&&"__set__"!=s||(l=null==(l=f.vars.value)?void 0:l.symbol,"__set__"==s&&l&&(c=ee(b.currClass.symInfo,"__get__",!1))&&c.pyAST&&"FunctionDef"==c.pyAST.kind&&X(f,l.pyRetType,c.pyRetType),s=s.replace(/_/g,"")),a||(a="_"==s[0]?i.isProtected?"protected":"private":"public",f.symInfo.isStatic&&(a+=" static")),r.push(R.mkText(a+" "),ue(s)))):(D.U.assert(!a),"_"==f.name[0]||t||d||n?r.push(R.mkText("function "),ue(s)):r.push(R.mkText("export function "),ue(s))),"__init__"==f.name?void 0:f.returns?qe(f.returns):i.pyRetType),u=(r.push(((i,e)=>{let t,a=i.args;a.kwonlyargs.length&&V(i,9517,D.U.lf("keyword-only arguments not supported yet"));var n=a.args.slice();if(e?"self"!==(null==(t=n[0])?void 0:t.arg)?i.symInfo.isStatic=!0:n.shift():n.some(e=>"self"==e.arg)&&V(i,9519,D.U.lf("non-methods cannot have an argument called 'self'")),!i.symInfo.parameters){let r=a.defaults.length-n.length;i.symInfo.parameters=n.map(e=>{e.annotation||V(i,9519,D.U.lf("Arg '{0}' missing annotation",e.arg));var t=qe(e.annotation);let n="";return 0<=r&&(n=R.flattenNode([me(a.defaults[r])]).output,X(e,t,re(a.defaults[r]))),r++,{name:e.arg,description:"",type:"",initializer:n,default:n,pyType:t}})}return e=i.symInfo.parameters.map(e=>{var t=Q(e.name,{isParam:!0}),t=null==t?void 0:t.symbol,t=(e.pyType||V(i,9530,D.U.lf("parameter '{0}' missing pyType",e.name)),X(i,S(t),e.pyType),[ue(e.name),Ge(e.pyType,!0)]);return e.default&&t.push(R.mkText(" = "+e.default)),R.mkGroup(t)}),a.vararg&&e.push(R.mkText("TODO *"+a.vararg.arg)),a.kwarg&&e.push(R.mkText("TODO **"+a.kwarg.arg)),R.H.mkParenthesizedExpression(R.mkCommaSep(e))})(f,e),l&&z(l)!=y?Ge(l):R.mkText("")),S(i),f.body.map(fe));if("__init__"==f.name){b.currClass||V(f,9533,lf("__init__ method '{0}' is missing current class context",i.pyQName)),null!=(c=b.currClass)&&c.baseClass&&(t=f.body[0],n=b.currClass.baseClass.pyQName+".__constructor",(null==(i=null==(l=null==(e=t.value)?void 0:e.func)?void 0:l.symbolInfo)?void 0:i.pyQName)!==n)&&V(f,9575,lf("Sub classes must call 'super().__init__' as the first statement inside an __init__ method"));for(o of _e(b.currClass)){var p=o.pyAST;p&&p.value&&u.push(R.mkStmt(R.mkText(`this.${se(o.pyName)} = `),me(p.value)))}}var c=rt(f);r.push(R.mkBlock(c.concat(u)));let m=R.mkGroup(r);return d?r[r.length-1].noFinalNewline=!0:m=R.mkStmt(m),m})}let d={FunctionDef:e=>Qe(e),ClassDef:s=>e(s,()=>{$e(s);var e=we(8,s),t=(D.U.assert(!b.currClass),be());(b.currClass=s).isNamespace=s.decorator_list.some(e=>"Name"==e.kind&&"namespace"==e.id);let n=s.isNamespace?[R.mkText("namespace "),ue(s.name)]:[ie("keywords",s.keywords.map(Re)),ie("decorators",s.decorator_list.map(me)),R.mkText(t?"class ":"export class "),ue(s.name)],r=(!s.isNamespace&&0<s.bases.length&&("Enum"==oe(s.bases[0])?s.isEnum=!0:(n.push(R.mkText(" extends ")),n.push(R.mkCommaSep(s.bases.map(me))),(t=(t=ne(le(t=s.bases[0])))&&t.pyAST&&"ClassDef"==t.pyAST.kind?t.pyAST:null)?(s.baseClass=t.symInfo,e.extendsTypes=[t.symInfo.pyQName]):(t=oe(s.bases[0]))&&(i=ne(t),t=M(t),s.baseClass=i||t,s.baseClass)&&(e.extendsTypes=[s.baseClass.pyQName]))),s.body.filter(e=>s.isNamespace||"FunctionDef"===e.kind));var i=s.isNamespace?[]:s.body.filter(e=>-1===r.indexOf(e)&&"Pass"!==e.kind),t=ae(r);n.push(t);let a=!1;return i.length&&(a=!0,e=ae(i),i=R.mkStmt(R.mkGroup([R.mkText(`public static __init${s.name}() `),e])),t.children.unshift(i)),s.isNamespace||(i=(e=_e(s).map(e=>(e.pyName&&e.pyRetType||V(s,9535,lf("field definition missing py name or return type",e.qName)),e))).filter(e=>!e.isInstance),e=e.filter(e=>e.isInstance).map(e=>R.mkStmt(Me(e),ue(e.pyName),Ge(e.pyRetType))),i=i.map(e=>{return R.mkGroup([R.mkStmt(Me(e),R.mkText("static "),ue(e.pyName),Ge(e.pyRetType)),(t=se(s.name),n=se(e.pyName),e=j(e.pyRetType),r=`___${n}_is_set`,i="___"+n,R.mkStmt(R.mkStmt(R.mkText(`private ${r}: boolean`)),R.mkStmt(R.mkText(`private ${i}: `+e)),R.mkStmt(R.mkText(`get ${n}(): `+e),R.mkBlock([R.mkText(`return this.${r} ? this.${i} : ${t}.`+n)])),R.mkStmt(R.mkText(`set ${n}(value: ${e})`),R.mkBlock([R.mkStmt(R.mkText(`this.${r} = true`)),R.mkStmt(R.mkText(`this.${i} = value`))]))))]);var t,n,r,i}),t.children=i.concat(e).concat(t.children)),a&&(n=[R.mkStmt(R.mkGroup(n)),R.mkStmt(R.mkText(s.name+`.__init${s.name}()`))]),R.mkStmt(R.mkGroup(n))}),Return:e=>{var t;return e.value?((t=b.currFun)&&(t.symInfo.pyRetType||V(e,9536,lf("function '{0}' missing return type",t.symInfo.pyQName)),J(e.value,t.symInfo.pyRetType)),R.mkStmt(R.mkText("return "),me(e.value))):R.mkStmt(R.mkText("return"))},AugAssign:e=>{var t=c[e.op];return 3<t.length?R.mkStmt(R.mkInfix(me(e.target),"=",R.H.mkCall(t,[me(e.target),me(e.value)]))):R.mkStmt(me(e.target),R.mkText(" "+t+"= "),me(e.value))},Assign:e=>ze(e),AnnAssign:e=>ze(e),For:t=>{if(D.U.assert(0==t.orelse.length),t.target.forTargetEndPos=t.endPos,pe(t.iter,"range")){var n,r=t.iter,i=me(t.target),a=ue(le(t.target)),s=(J(t.target,l),1==r.args.length?R.mkText("0"):me(r.args[0])),o=me(r.args[1==r.args.length?0:1]);if(r.args.length<=2)return R.mkStmt(R.mkText("for ("),R.mkInfix(i,"=",s),R.mkText("; "),R.mkInfix(a,"<",o),R.mkText("; "),R.mkPostfix([a],"++"),R.mkText(")"),ae(t.body));let e="Num"===r.args[2].kind?r.args[2].n:void 0;if(null==e&&"UnaryOp"===r.args[2].kind&&"Num"===(n=r.args[2]).operand.kind&&("UAdd"===n.op?e=n.operand.n:"USub"===n.op&&(e=-n.operand.n)),void 0!==e)return n=0<e?"<":">",R.mkStmt(R.mkText("for ("),R.mkInfix(i,"=",s),R.mkText("; "),R.mkInfix(a,n,o),R.mkText("; "),R.mkInfix(a,"+=",me(r.args[2])),R.mkText(")"),ae(t.body))}return 1<x&&(i=re(t.target),J(t.iter,re(t.iter)==N?i:G(i))),R.mkStmt(R.mkText("for ("),me(t.target),R.mkText(" of "),me(t.iter),R.mkText(")"),ae(t.body))},While:e=>(D.U.assert(0==e.orelse.length),R.mkStmt(R.mkText("while ("),me(e.test),R.mkText(")"),ae(e.body))),If:e=>{let n=e=>{var t=[R.mkText("if ("),me(e.test),R.mkText(")"),ae(e.body)];return e.orelse.length&&(t[t.length-1].noFinalNewline=!0,1==e.orelse.length&&"If"==e.orelse[0].kind?(t.push(R.mkText(" else ")),D.U.pushRange(t,n(e.orelse[0]))):t.push(R.mkText(" else"),ae(e.orelse))),t};return R.mkStmt(R.mkGroup(n(e)))},With:t=>{if(1==t.items.length&&(i=t.items[0].context_expr,a="pins.I2CDevice",(i=re(i)).classType&&i.classType.pyQName==a||j(i)==a)){var n,r,i=t.items[0],a=[];let e=me(i.context_expr);return i.optional_vars&&(r=oe(i.optional_vars))&&(n=null==(n=Q(r,{isLocal:!0}))?void 0:n.symbol,r=se(r),a.push(R.mkStmt(R.mkText("const "+r+" = "),e)),n.pyRetType||V(t,9537,lf("function '{0}' missing return type",n.pyQName)),J(i.context_expr,n.pyRetType),e=R.mkText(r)),a.push(R.mkStmt(R.mkInfix(e,".",R.mkText("begin()")))),D.U.pushRange(a,t.body.map(fe)),a.push(R.mkStmt(R.mkInfix(e,".",R.mkText("end()")))),R.mkGroup(a)}var a;let s=[];var i=t.items.map((e,t)=>{let n="with"+t;return e.optional_vars&&(Q(t=le(e.optional_vars),{isLocal:!0}),n=se(t)),s.push(R.mkStmt(R.mkText(n+".end()"))),R.mkStmt(R.mkText("const "+n+" = "),R.mkInfix(me(e.context_expr),".",R.mkText("begin()")))});return D.U.pushRange(i,t.body.map(fe)),D.U.pushRange(i,s),R.mkBlock(i)},Raise:e=>{e=e.exc||e.cause;if(!e)return R.mkStmt(R.mkText("throw"));let t=void 0;return t=(t=e&&"Call"==e.kind&&1==e.args.length?me(e.args[0]):t)||R.mkGroup([R.mkText("`"),me(e),R.mkText("`")]),R.mkStmt(R.H.mkCall("control.fail",[t]))},Assert:e=>(e.msg||V(e,9537,lf("assert missing message")),R.mkStmt(R.H.mkCall("control.assert",[e.test,e.msg].filter(e=>!!e).map(me)))),Import:e=>{for(var t of e.names)t.asname&&Q(t.asname,{expandsTo:t.name}),n=e,t=t.name,M(t)||V(n,9503,D.U.lf("No module named '{0}'",t));var n;return R.mkText("")},ImportFrom:e=>{var t,n,r,i,a=[];for(t of e.names)"*"==t.name?(e.module||V(e,9538,lf("import missing module name")),Q(e.module,{isImportStar:!0})):(r=M(n=e.module+"."+t.name),i=t.asname||t.name,De(r)?(Q(i,{isImport:r,expandsTo:n}),a.push(R.mkStmt(R.mkText(`import ${se(i)} = `+n)))):Q(i,{expandsTo:n}));return R.mkGroup(a)},ExprStmt:e=>{return"Str"==e.value.kind?((t=e.value.s).trim().split(/\n/).length<=1?t=t.trim():t+="\n",R.mkStmt(R.mkText("/** "+t+" */"))):R.mkStmt(me(e.value));var t},Pass:e=>R.mkStmt(R.mkText("")),Break:e=>R.mkStmt(R.mkText("break")),Continue:e=>R.mkStmt(R.mkText("continue")),Delete:e=>(V(e,9550,D.U.lf("delete statements are unsupported")),g(e)),Try:e=>{var t,n=[R.mkText("try"),ae(e.body.concat(e.orelse))];for(t of e.handlers)n.push(R.mkText("catch ("),t.name?ue(t.name):R.mkText("_")),t.type&&n.push(R.mkText("/* instanceof "),me(t.type),R.mkText(" */")),n.push(R.mkText(")"),ae(t.body));return e.finalbody.length&&n.push(R.mkText("finally"),ae(e.finalbody)),R.mkStmt(R.mkGroup(n))},AsyncFunctionDef:e=>(V(e,9551,D.U.lf("async function definitions are unsupported")),g(e)),AsyncFor:e=>(V(e,9552,D.U.lf("async for statements are unsupported")),g(e)),AsyncWith:e=>(V(e,9553,D.U.lf("async with statements are unsupported")),g(e)),Global:e=>{var t,n=Se();B();for(t of e.names){D.U.lookup(n.vars,t)||V(e,9521,D.U.lf("No binding found for global variable"));var r=Q(t,{},O.VarModifier.Global);r.firstRefPos<e.startPos&&V(e,9522,D.U.lf("Variable referenced before global declaration"))}return R.mkStmt(R.mkText(""))},Nonlocal:e=>{var t,n=Se(),r=B();for(t of e.names){var i=nt(t,r),i=(i&&i!==n&&i.vars[t].modifier!==O.VarModifier.Global||V(e,9523,D.U.lf("No binding found for nonlocal variable")),Q(t,{},O.VarModifier.NonLocal));i.firstRefPos<e.startPos&&V(e,9524,D.U.lf("Variable referenced before nonlocal declaration"))}return R.mkStmt(R.mkText(""))}};function ze(e){let t,n,r,i;if("Assign"===e.kind){if(1!=e.targets.length)return V(e,9553,D.U.lf("multi-target assignment statements are unsupported")),g(e);i=e.targets[0],r=e.value,t=null,n=null}else{if("AnnAssign"!==e.kind)return e;i=e.target,r=e.value||null,t=e.annotation,n=qe(t),J(i,n)}let a="",s=!!r&&pe(r,"const");var o=oe(i)||"";if(be()||b.currClass||b.currFun||"_"==o[0]||(a="export "),o&&b.currClass&&!b.currFun){s=!(!r||!b.currClass.isNamespace);var l=ee(b.currClass.symInfo,o,!0);if(l||V(e,9544,lf("cannot get class field")),0==x)return R.mkText("/* skip for now */");l.pyRetType||V(e,9539,lf("function '{0}' missing return type",l.pyQName)),J(i,l.pyRetType),l.isInstance=!1,b.currClass.isNamespace&&(a=`export ${s?"const":"let"} `)}if(!r)return V(e,9555,D.U.lf("unable to determine value of assignment")),g(e);if(J(i,re(r)),s)return Q(le(i),{}),/^static /.test(a)||/const/.test(a)||(a+="const "),R.mkStmt(R.mkText(a),R.mkInfix(me(i),"=",me(r)));if(!a&&"Tuple"==i.kind){var l=e,u=i,e=r,p=u.elts.filter(e=>"Name"!==e.kind);if(p.length)return V(l,9556,D.U.lf("non-trivial tuple assignment unsupported")),g(l);var c=(p=u.elts.map(oe)).map(e=>e?B().vars[e]:void 0);if(c.some(e=>void 0!==(null==e?void 0:e.modifier))){var m=(()=>{var e=B();return void 0===e.nextHelperVariableId&&(e.nextHelperVariableId=0),"___tempvar"+e.nextHelperVariableId++})(),f=[R.mkStmt(R.mkInfix(R.mkGroup([R.mkText("let "),R.mkText(m)]),"=",me(e)))];for(let e=0;e<c.length;e++){var d=y(u.elts[e]);f.push(R.mkStmt(R.mkInfix(d,"=",R.mkGroup([R.mkText(m),R.mkText(`[${e}]`)]))))}return R.mkGroup(f)}return l=[R.mkText("let "),R.mkText("[")],p=u.elts.map(e=>e).map(e=>y(e,!0)),l.push(R.mkCommaSep(p)),l.push(R.mkText("]")),R.mkStmt(R.mkInfix(R.mkGroup(l),"=",me(e)));function y(e,t=!1){He(e,"identifierCompletion"),re(e);Xe(e);return We(e,t)}}"Name"===i.kind&&(e=null==(p=B().vars[o])?void 0:p.symbol)&&4===e.kind&&void 0===p.modifier&&(void 0===p.firstAssignPos||p.firstAssignPos>i.startPos)&&(p.firstAssignPos=i.startPos,p.firstAssignDepth=b.blockDepth);let k=void 0;return t&&n&&("NameConstant"===r.kind&&null===r.value||"List"===r.kind&&0===r.elts.length)&&(o=j(n),k=R.mkInfix(me(i),":",R.mkText(o))),k=k||me(i),R.mkStmt(R.mkText(a),R.mkInfix(k,"=",me(r)))}function We(e,t=!1){var n=e.id;let r=te(n),i=null==r?void 0:r.symbol;var a=B().vars[n],a=null==a?void 0:a.symbol;return void 0===e.isdef&&(!i||4===i.kind&&i!==a?(r=b.currClass&&!b.currFun?(e.isdef=!1,Q(n,{})):Q(n,{isLocal:e.isdef=!0}),i=r.symbol):e.isdef=!1,e.symbolInfo=i,e.tsType||V(e,9540,lf("definition missing ts type")),i.pyRetType||V(e,9568,lf("missing py return type")),X(e,e.tsType,i.pyRetType)),e.isdef&&it(r,B())&&(e.isdef=!1),Ye(r,e),e.isdef&&!t?R.mkGroup([R.mkText("let "),ue(n)]):null==i||!i.namespace||null==i||!i.qName||null!=(a=b.currClass)&&a.isNamespace&&(null==(e=b.currClass)?void 0:e.name)===(null==i?void 0:i.namespace)?ue(n):ue(i.qName)}function se(e){return R.isReservedWord(e)?e+"_":e}function oe(e){if("Name"==e.kind){var t=e.id,n=Fe(t),r=null==n?void 0:n.symbol;if(r){if(r.expandsTo)return r.expandsTo;if(b.currClass&&!b.currFun&&(null==n||!n.modifier)&&r.qName)return r.qName}return t}if("Attribute"==e.kind){n=oe(e.value);if(n)return n+"."+e.attr}if(je(e)&&null!=(r=b.currClass)&&r.baseClass)return b.currClass.baseClass.qName}function le(e){var t=oe(e);return t||V(null,9542,lf("Cannot get name of unknown expression kind '{0}'",e.kind)),t}function ue(e){return"self"==e?R.mkText("this"):R.mkText(se(e))}function pe(e,t){return"Call"==e.kind&&oe(e.func)===t}function ce(e,t,n){t=c[t];return D.U.assert(!!t),3<t.length?R.H.mkCall(t,[e,n]):R.mkInfix(e,t,n)}let k={memoryview:{n:"",t:s},const:{n:"",t:l},"micropython.const":{n:"",t:l}},C=(()=>{let n={};return Object.keys(pxtc.ts2PyFunNameMap).forEach(e=>{var t=pxtc.ts2PyFunNameMap[e];t&&t.n&&(e={n:e,t:(e=>{switch(e){case ts.SyntaxKind.StringKeyword:return N;case ts.SyntaxKind.NumberKeyword:return l;case ts.SyntaxKind.BooleanKeyword:return r;case ts.SyntaxKind.VoidKeyword:return y;case ts.SyntaxKind.AnyKeyword:return E;default:return s}})(t.t),scale:t.scale},n[t.n]=e)}),Object.keys(k).forEach(e=>{n[e]=k[e]}),n})();function je(e){return pe(e,"super")&&0==e.args.length}function Ve(e){return K&&e.startPos<=K.position&&K.position<=e.endPos}function He(e,t){100<x&&K&&null==L&&(K.type==t||"symbol"==K.type)&&Ve(e)&&(L=e,F=B())}function Je(e,t){t&&t.pyAST&&"FunctionDef"==t.pyAST.kind&&((t=t.pyAST).callers||(t.callers=[]),t.callers.indexOf(e)<0)&&t.callers.push(e)}let T={BoolOp:t=>{let n=me(t.values[0]);for(let e=1;e<t.values.length;++e)n=ce(n,t.op,me(t.values[e]));return n},BinOp:e=>{var t=(e=>{if("Mod"!=e.op||"Str"!=e.left.kind||"Tuple"!=e.right.kind&&"List"!=e.right.kind)return null;{var t=e.left.s;let i=e.right.elts,a=(i=i.slice(),[R.mkText("`")]);return t.replace(/([^%]+)|(%[\d\.]*([a-zA-Z%]))/g,(e,t,n,r)=>(t?a.push(R.mkText(t.replace(/[`\\$]/g,e=>"\\"+e))):(t=(t=i.shift())?me(t):R.mkText("???"),a.push(R.mkText("${"),t,R.mkText("}"))),"")),a.push(R.mkText("`")),R.mkGroup(a)}})(e);if(!t){var n=me(e.left),r=me(e.right);if(ot(e.left)&&ot(e.right)&&"Add"===e.op)return R.H.extensionCall("concat",[n,r],!1);t=ce(n,e.op,r),u[e.op]&&(J(e.left,l),J(e.right,l),e.tsType||V(e,9570,lf("binary op missing ts type")),X(e,e.tsType,l))}return t},UnaryOp:e=>{var t=m[e.op];return"Not"!==e.op?(J(e,l),J(e.operand,l)):J(e,r),D.U.assert(!!t),R.mkInfix(null,t,me(e.operand))},Lambda:e=>(V(e,9574,D.U.lf("lambda expressions are not supported yet")),v(e)),IfExp:e=>R.mkInfix(R.mkInfix(me(e.test),"?",me(e.body)),":",me(e.orelse)),Dict:n=>{b.blockDepth++;var e=n.keys.map((e,t)=>{t=n.values[t];return void 0===e?v(n):R.mkStmt(R.mkInfix(me(e),":",me(t)),R.mkText(","))}),e=R.mkBlock(e);return b.blockDepth--,e},Set:e=>v(e),ListComp:e=>v(e),SetComp:e=>v(e),DictComp:e=>v(e),GeneratorExp:n=>{if(1==n.generators.length&&"Comprehension"==n.generators[0].kind){let t=n.generators[0];if(0==t.ifs.length)return Oe(()=>{var e=le(t.target);return Q(e,{isParam:!0}),R.mkInfix(me(t.iter),".",R.H.mkCall("map",[R.mkGroup([ue(e),R.mkText(" => "),me(n.elt)])]))})}return v(n)},Await:e=>v(e),Yield:e=>v(e),YieldFrom:e=>v(e),Compare:t=>{var e;if(1==t.ops.length&&("In"==t.ops[0]||"NotIn"==t.ops[0]))return z(re(t.comparators[0]))==N&&J(t.left,N),e=R.mkInfix(me(t.comparators[0]),".",R.H.mkCall("indexOf",[me(t.left)])),R.mkInfix(e,"In"==t.ops[0]?">=":"<",R.mkText("0"));let r=me(t.left),i=me(t.comparators[0]);var n=(e,t,n)=>{p[e]&&lt(t)&&lt(n)&&R.flattenNode([r])!==R.flattenNode([i])&&(r=R.H.mkParenthesizedExpression(R.mkGroup([r,R.mkText(" as any")])),i=R.H.mkParenthesizedExpression(R.mkGroup([i,R.mkText(" as any")])))};n(t.ops[0],t.left,t.comparators[0]);let a=ce(r,t.ops[0],i);for(let e=1;e<t.ops.length;++e)r=me(t.comparators[e-1]),i=me(t.comparators[e]),n(t.ops[e],t.comparators[e-1],t.comparators[e]),a=ce(a,"And",ce(r,t.ops[e],i));return a},Call:n=>{n.func.inCalledPosition=!0;let t=oe(n.func);var e=ne(t),r=e&&8==e.kind;let i=e,a=void 0,s=void 0,o="",l=(r?i=(i=ne(e.pyQName+".__constructor"))||we(3,ut(null==e?void 0:e.pyAST)):"Attribute"==n.func.kind&&(u=n.func,s=u.value,(a=re(s)).classType||a.primType)&&(o=u.attr,i=Ke(s,o,!0))&&(o=i.name),n.args.slice());if("super"==t&&0==l.length)return b.currClass&&b.currClass.baseClass&&(n.tsType||V(n,9543,lf("call expr missing ts type")),Ce(n,n.tsType,b.currClass.baseClass)),R.mkText("super");if(pe(n,"int")&&1===l.length&&l[0]){var u=l[0],p=me(u),u=re(u);if("string"===u.primType)return R.mkGroup([R.mkText("parseInt"),R.mkText("("),p,R.mkText(")")]);if("number"===u.primType)return R.mkGroup([R.mkInfix(R.mkText("Math"),".",R.mkText("trunc")),R.mkText("("),p,R.mkText(")")])}if(!i){let e=D.U.lookup(C,t);if((o=e?"":o)&&(t=j(a)+"."+o,(e=D.U.lookup(C,t))||"@array"!=H(z(a))||(t="Array."+o,e=D.U.lookup(C,t))),o="",e)if("."==e.n[0]&&l.length){if(s=l.shift(),a=re(s),o=e.n.slice(1),(i=Ke(s,o))&&2==i.kind)return R.mkInfix(me(s),".",R.mkText(o))}else i=M(e.n)}if(pe(n,"str"))return X(n,n.tsType,N),R.mkInfix(R.mkText('""'),"+",me(n.args[0]));var u="Attribute"===n.func.kind&&je(n.func.value),p=(!i&&u&&(i=M(t)),"__init__"===(null==(p=b.currFun)?void 0:p.name)&&"__constructor"===(null==i?void 0:i.name)&&(null==(p=null==(p=b.currClass)?void 0:p.baseClass)?void 0:p.pyQName)===(null==i?void 0:i.namespace)&&u),c=((i=p?ne((null==(u=null==(u=b.currClass)?void 0:u.baseClass)?void 0:u.pyQName)+".__constructor"):i)||V(n,9508,D.U.lf("can't find called function '{0}'",t)),i?i.parameters:null);let m=[];if(c){for(l.length>c.length&&V(n,9510,D.U.lf("too many arguments in call to '{0}'",i.pyQName));l.length<c.length;)l.push(null);l=l.slice(0,c.length);for(let t of n.keywords){var f=c.findIndex(e=>e.name==t.arg);f<0?V(t,9511,D.U.lf("'{0}' doesn't have argument named '{1}'",i.pyQName,t.arg)):null!=l[f]?V(t,9512,D.U.lf("argument '{0} already specified in call to '{1}'",t.arg,i.pyQName)):l[f]=t.value}for(let e=l.length-1;0<=e&&(c[e].initializer&&null==l[e]);e--)l.pop();for(let e=0;e<l.length;++e){var d,y=l[e];null!=y||c[e].initializer?y?(c[e].pyType||V(n,9545,lf("formal arg missing py type")),"any"!==(d=c[e].pyType).primType&&Ue(y,d),"Name"==y.kind&&Be(y.symbolInfo)?m.push(Qe(y.symbolInfo.pyAST,!0)):m.push(me(y))):(c[e].initializer||V(n,9547,lf("formal arg missing initializer")),m.push(R.mkText(c[e].initializer))):(V(n,9513,D.U.lf("missing argument '{0}' in call to '{1}'",c[e].name,i.pyQName)),m.push(R.mkText("null")))}}else i&&V(n,9509,D.U.lf("calling non-function")),m=l.map(me);if(!L&&K&&"signature"==K.type&&Ve(n)){L=n,F=B();for(let e=K.auxResult=0;e<l.length;++e){K.auxResult=e;var k=l[e];if(!k)break;if(k.startPos<=K.position&&K.position<=k.endPos)break}}if(i){if(i.pyRetType||V(n,9549,lf("function missing pyRetType")),s&&ot(s)&&a){var x,T=n,g=i,v=a;switch(g.qName){case"Array.pop":case"Array.removeAt":case"Array.shift":case"Array.find":case"Array.get":case"Array._pickRandom":J(T,v.typeArgs[0]);break;case"Array.concat":case"Array.slice":case"Array.filter":case"Array.fill":J(T,v);break;case"Array.reduce":"Call"===T.kind&&1<T.args.length&&(x=re(T.args[1]))&&J(T,x);break;case"Array.map":J(T,G(E));break;default:J(T,g.pyRetType)}}else J(n,i.pyRetType);if((n.symbolInfo=i).attributes.py2tsOverride){u=(e=>{let t=new RegExp(/([^\$]*\()?([^\$\(]*)\$(\d)(?:(?:(?:=(\d+|'[a-zA-Z0-9_]*'|false|true|null|undefined))|(\?)|))/,"y"),n=[],r,i=0;for(;i=t.lastIndex,(r=t.exec(e))&&(r[1]&&n.push({kind:"text",text:r[1]}),n.push({kind:"arg",prefix:r[2],index:parseInt(r[3]),default:r[4],isOptional:!!r[5]})),r;);return null!=i?n.push({kind:"text",text:e.substr(i)}):n.push({kind:"text",text:e}),{parts:n}})(i.attributes.py2tsOverride);if(u)return o&&!s&&V(n,9550,lf("missing recv")),(u=((e,t,n)=>{var r,i=[];for(r of e.parts)if("text"===r.kind)i.push(R.mkText(r.text));else if(t[r.index]||r.default)r.prefix&&i.push(R.mkText(r.prefix)),t[r.index]?i.push(t[r.index]):i.push(R.mkText(r.default));else if(!r.isOptional)return;return n?R.mkInfix(n,".",R.mkGroup(i)):R.mkGroup(i)})(u,m,o?me(s):void 0))||V(n,9555,lf("buildOverride failed unexpectedly")),u}else if(i.attributes.pyHelper)return R.mkGroup([R.mkInfix(R.mkText("_py"),".",R.mkText(i.attributes.pyHelper)),R.mkText("("),R.mkCommaSep(s?[me(s)].concat(m):m),R.mkText(")")])}let h,S=(p?h=R.mkText("super"):o?(h=R.mkInfix(me(s),".",R.mkText(o)),He(n.func,"memberCompletion")):h=me(n.func),[h,R.mkText("("),R.mkCommaSep(m),R.mkText(")")]);return i&&1==m.length&&pxtc.service.isTaggedTemplate(i)&&(S=[h,(u=m[0]).type==R.NT.Prefix&&'"'==u.op[0]?R.mkText(R.backtickLit(JSON.parse(u.op))):u]),r&&(e&&e.pyQName||V(n,9551,lf("missing namedSymbol or pyQName")),S[0]=R.mkText(Ne(e.pyQName)),S.unshift(R.mkText("new "))),R.mkGroup(S)},Num:e=>(e.tsType||V(e,9556,lf("tsType missing")),X(e,e.tsType,l),R.mkText(e.ns)),Str:e=>(e.tsType||V(e,9557,lf("tsType missing")),X(e,e.tsType,N),R.mkText(R.stringLit(e.s))),FormattedValue:e=>v(e),JoinedStr:e=>v(e),Bytes:e=>R.mkText(`hex\`${D.U.toHex(new Uint8Array(e.s))}\``),NameConstant:e=>(null!==e.value&&(e.tsType||V(e,9558,lf("tsType missing")),X(e,e.tsType,r)),R.mkText(JSON.stringify(e.value))),Ellipsis:e=>v(e),Constant:e=>v(e),Attribute:e=>{var t=me(e.value),n=re(e.value),r=Ke(e.value,e.attr);let i=e.attr;return He(e,"memberCompletion"),r?(e.symbolInfo=r,Je(e,r),e.tsType&&r.pyRetType||V(e,9559,lf("tsType or pyRetType missing")),X(e,e.tsType,r.pyRetType),i=r.name):n.moduleType?(r=M(n.moduleType.pyQName+"."+e.attr))?(e.symbolInfo=r,Je(e,r),J(e,S(r)),i=r.name):V(e,9514,D.U.lf("module '{0}' has no attribute '{1}'",n.moduleType.pyQName,e.attr)):2<x&&V(e,9515,D.U.lf("unknown object type; cannot lookup attribute '{0}'",e.attr)),R.mkInfix(t,".",R.mkText(se(i)))},Subscript:e=>{var t,n;return"Index"==e.slice.kind?(n=z(re(e.value)),ot(e.value)?J(e,n.typeArgs[0]):"string"===n.primType?J(e,n):2<x&&Ee(re(e))&&J(e,E),n=e.slice.value,2<x&&Ee(re(n))&&J(n,l),R.mkGroup([me(e.value),R.mkText("["),me(n),R.mkText("]")])):"Slice"==e.slice.kind?(J(e,n=re(e.value)),(t=e.slice).step?(n="string"===(null==n?void 0:n.primType),R.H.mkCall(n?"_py.stringSlice":"_py.slice",[me(e.value),t.lower?me(t.lower):R.mkText("null"),t.upper?me(t.upper):R.mkText("null"),me(t.step)])):R.mkInfix(me(e.value),".",R.H.mkCall("slice",[t.lower?me(t.lower):R.mkText("0"),t.upper?me(t.upper):null].filter(ye)))):v(e)},Starred:e=>R.mkGroup([R.mkText("... "),me(e.value)]),Name:e=>{var t,n;return He(e,"identifierCompletion"),"self"==e.id&&b.currClass?(e.tsType||V(e,9560,lf("missing tsType")),Ce(e,e.tsType,b.currClass.symInfo),R.mkText("this")):(n=null==(t=Xe(e))?void 0:t.symbol)&&n.isImport?ue(n.name):(Ye(t,e),0<=e.ctx.indexOf("Load")?n?null!=n&&n.qName?ue(n.qName.replace("@type","")):(V(e,9561,lf("missing qName")),ue("unknown")):ue(le(e)):We(e))},List:Ze,Tuple:Ze};function Xe(e){let t=te(e.id);var n,r=null==t?void 0:t.symbol;if(t||(n=D.U.lookup(C,e.id))&&(t=te(n.n)),t&&r){if(e.symbolInfo=r,e.tsType||V(e,9562,lf("missing tsType")),X(e,e.tsType,S(r)),r.isImport)return t;Je(e,r),e.forTargetEndPos&&t.forVariableEndPos!==e.forTargetEndPos&&(t.forVariableEndPos?t.lastRefPos=t.forVariableEndPos+1:t.forVariableEndPos=e.forTargetEndPos)}else 0<x&&V(e,9516,D.U.lf("name '{0}' is not defined",e.id));return t}function Ye(e,t){var n;e&&(e.modifier===O.VarModifier.Global?(n=Se())&&n.vars[e.symbol.name]&&(e=n.vars[e.symbol.name]):e.modifier===O.VarModifier.NonLocal&&(n=nt(e.symbol.name,B()))&&(e=n.vars[e.symbol.name]),(void 0===e.firstRefPos||e.firstRefPos>t.startPos)&&(e.firstRefPos=t.startPos),void 0===e.lastRefPos||e.lastRefPos<t.startPos)&&(e.lastRefPos=t.startPos)}function Ze(e){return e.tsType||V(e,9563,lf("missing tsType")),X(e,e.tsType,G(e.elts[0]?re(e.elts[0]):$())),R.mkGroup([R.mkText("["),R.mkCommaSep(e.elts.map(me)),R.mkText("]")])}function et(e){return e.startPos+":"+e.endPos}function me(e){a=e;var t=T[e.kind],t=(t||D.U.oops(e.kind+" - unknown expr"),re(e),t(e));return t.id=et(e),t}function fe(e){a=e;var t=d[e.kind],n=(t||D.U.oops(e.kind+" - unknown stmt"),(e._comments||[]).map(e=>e.value));let r=t(e);return(r=n.length?R.mkGroup(n.map(e=>R.mkStmt(R.H.mkComment(e))).concat(r)):r).id=et(e),r}function tt(e){return!e||(e.type==R.NT.Prefix&&""==e.op?e.children.every(tt):e.type==R.NT.NewLine)}function nt(e,t){var n;if(t)return(n=t.vars&&t.vars[e])&&n.modifier!=O.VarModifier.NonLocal?t:nt(e,t.parent)}function rt(e){var t,n,r,i=[];for(t of Object.keys(e.vars))it(n=e.vars[t],e)&&i.push((n=null==n?void 0:n.symbol,r=void 0,r=ue(n.name),n=j(S(n)),R.mkStmt(R.mkGroup([R.mkText("let "),r,R.mkText(": "+n+";")]))));return i}function it(e,t){return 4===e.symbol.kind&&!e.symbol.isParam&&void 0===e.modifier&&(e.lastRefPos>e.forVariableEndPos||e.firstRefPos<e.firstAssignPos||e.firstAssignDepth>t.blockDepth)&&!("Module"===(t=t).kind&&"main"===t.name&&0===e.firstAssignDepth)}function at(e){if(D.U.assert("Module"==e.kind),!e.tsBody){t=e,b={currClass:void 0,currFun:void 0,currModule:t,blockDepth:0},A=t.tsFilename.replace(/\.ts$/,".py"),e.vars||(e.vars={});var t=rt(e).concat(e.body.map(fe));if(!t.every(tt))return"main"==e.name?t:[R.mkText("namespace "+e.name+" "),R.mkBlock(t)]}}function st(e){x=e,w=[],I=0,a=void 0}function ot(e){e=z(re(e));return e&&"@array"===e.primType}function lt(e){switch(e.kind){case"Num":case"Str":return 1;case"NameConstant":return null!==e.value}}function ut(e,t=e.symInfo){var n=q(t.pyQName+".__constructor");if(!n&&null!=(r=t.extendsTypes)&&r.length){var r=ne(t.extendsTypes[0])||M(t.extendsTypes[0]);if(r)return ut(e,r)}t={kind:"FunctionDef",name:"__init__",startPos:e.startPos,endPos:e.endPos,parent:e,body:[],args:{kind:"Arguments",startPos:0,endPos:0,args:[{startPos:0,endPos:0,kind:"Arg",arg:"self"}],kw_defaults:[],kwonlyargs:[],defaults:[]},decorator_list:[],vars:{},symInfo:Y(3,e.symInfo.qName+".__constructor")};return t.symInfo.parameters=[],t.symInfo.pyRetType=$({classType:e.symInfo}),n&&(t.args.args.push(...n.parameters.map(e=>({startPos:0,endPos:0,kind:"Arg",arg:e.name}))),t.symInfo.parameters.push(...n.parameters.map(e=>e.pyType?e:Object.assign(Object.assign({},e),{pyType:h(e.type)})))),t}O.py2ts=function(t){var n=[],e={},r=(w=[],D.U.assert(!!t.sourceFiles,"missing sourceFiles! Cannot convert py to ts"),t.sourceFiles.filter(e=>D.U.endsWith(e,".py")));if(0==r.length)return{outfiles:e,diagnostics:w,success:0===w.length,sourceMap:[]};let i=(e,t)=>e.substr(0,e.length-t.length),a=D.U.toDictionary(r,e=>i(e,".py"));var s,o=t.sourceFiles.filter(e=>D.U.endsWith(e,".ts")).filter(e=>i(e,".ts")in a);D.U.assert(!!t.apisInfo,"missing apisInfo! Cannot convert py to ts"),A=r[0],xe(t.apisInfo,o),_=t,K=void 0,t.generatedFiles||(t.generatedFiles=[]);for(s of r){var l=s,u=s.replace(/\.py$/,"").replace(/.*\//,""),p=t.fileSystem[s];try{A=s;var c=D.py.lex(p),m=D.py.parse(p,l,c);D.U.pushRange(w,m.diagnostics),n.push({kind:"Module",body:m.stmts,blockDepth:0,name:u,source:p,tsFilename:l.replace(/\.py$/,".ts")})}catch(e){D.log("Parse error",e)}}var f,o=w;for(let e=0;e<5;++e){st(e);for(var d of n)try{at(d)}catch(e){D.log("Conv pass error",e)}if(0==I)break}st(1e3),L=void 0,K=t.syntaxInfo||{position:0,type:"symbol"};let y=[];for(f of n)try{var k,x,T=at(f);function g(e){var t=e.id.split(":");if(2==t.length)return{py:{startPos:(t=t.map(e=>parseInt(e)))[0],endPos:t[1]},ts:{startPos:e.startPos,endPos:e.endPos}}}T&&(k=R.flattenNode(T),t.sourceFiles.push(f.tsFilename),t.generatedFiles.push(f.tsFilename),t.fileSystem[f.tsFilename]=k.output,e[f.tsFilename]=k.output,x=k.sourceMap,y=x.map(g).filter(e=>!!e))}catch(e){D.log("Conv error",e)}w=o.concat(w);let v={},h=(r=D.U.values(U).concat(D.U.values(P)),[]);var S=e=>{(e=>{switch(e.kind){case 6:case 7:case 4:case 3:case 5:return!0;case 2:case 1:return!e.isInstance;default:return!1}})(e)&&h.indexOf(e)<0&&(e=ke(e),v[e.qName||e.name]=e)};for(let e=F;e;e=e.parent)e&&e.vars&&D.U.values(e.vars).map(e=>e.symbol).forEach(S);if(r.forEach(S),K&&L){if(L=L,K.beginPos=L.startPos,K.endPos=L.endPos,K.symbols||(K.symbols=[]),h=K.symbols.slice(),"memberCompletion"==K.type&&"Attribute"==L.kind){var b=re(L.value);if(b.moduleType)for(var N of r)N.isInstance||N.namespace!=b.moduleType.qName||K.symbols.push(N);else if(b.classType||b.primType){o=b.classType||Le(b.primType).reduce((e,t)=>e||t,null);if(o){o.extendsTypes&&o.qName||V(null,9567,lf("missing extendsTypes or qName"));var E,C=o.extendsTypes.concat(o.qName);for(E of r)E.isInstance&&0<=C.indexOf(E.namespace)&&K.symbols.push(E)}}}else"identifierCompletion"==K.type?K.symbols=D.U.values(v):(o=L.symbolInfo)&&K.symbols.push(o);K.symbols=K.symbols.map(ke)}return r=(()=>{for(var e of w)O.patchPosition(e,t.fileSystem[e.fileName]);return w})(),{outfiles:e,success:0===r.length,diagnostics:r,syntaxInfo:K,globalNames:v,sourceMap:y}}}})(pxt=pxt||{}),(L=>{var e;{var F=L.py||(L.py={});let S,b=((e=S=F.TokenType||(F.TokenType={}))[e.Id=0]="Id",e[e.Op=1]="Op",e[e.Keyword=2]="Keyword",e[e.Number=3]="Number",e[e.String=4]="String",e[e.NewLine=5]="NewLine",e[e.Comment=6]="Comment",e[e.Indent=7]="Indent",e[e.Dedent=8]="Dedent",e[e.EOF=9]="EOF",e[e.Error=10]="Error",F.keywords={False:!0,None:!0,True:!0,and:!0,as:!0,assert:!0,async:!0,await:!0,break:!0,class:!0,continue:!0,def:!0,del:!0,elif:!0,else:!0,except:!0,finally:!0,for:!0,from:!0,global:!0,if:!0,import:!0,in:!0,is:!0,lambda:!0,nonlocal:!0,not:!0,or:!0,pass:!0,raise:!0,return:!0,try:!0,while:!0,with:!0,yield:!0},[]),N,E,C={"%":"Mod","&":"BitAnd","*":"Mult","**":"Pow","+":"Add","-":"Sub","/":"Div","//":"FloorDiv","<<":"LShift",">>":"RShift","@":"MatMult","^":"BitXor","|":"BitOr"},U={"!":"Bang","!=":"NotEq","(":"LParen",")":"RParen",",":"Comma","->":"Arrow",".":"Dot",":":"Colon",";":"Semicolon","<":"Lt","<=":"LtE","=":"Assign","==":"Eq",">":"Gt",">=":"GtE","[":"LSquare","]":"RSquare","{":"LBracket","}":"RBracket","~":"Invert"},P={b:/^[_0-1]$/,B:/^[_0-1]$/,o:/^[_0-7]$/,O:/^[_0-7]$/,x:/^[_0-9a-fA-F]$/,X:/^[_0-9a-fA-F]$/},I={b:2,B:2,o:8,O:8,x:16,X:16},A,w,_=0,K=0;function r(t,n){let r=0,i=0;for(let e=0;e<t;++e)10==n.charCodeAt(e)&&(r++,i=e);return{line:r,column:t-i-1}}function a(e){switch(e.type){case S.Id:return`id(${e.value})`;case S.Op:return"'"+E[e.value]+"'";case S.Keyword:return e.value;case S.Number:return`num(${e.value})`;case S.String:return e.stringPrefix+JSON.stringify(e.value);case S.NewLine:return"<nl>";case S.Comment:return`/* ${e.value} */`;case S.Indent:return"indent"+e.value;case S.Dedent:return"dedent";case S.Error:return`[ERR: ${e.value}]`;case S.EOF:return"End of file";default:return"???"}}F.position=r,F.patchPosition=function(e,t){var n;e.start||e.length?(n=r(e.start,t),e.line=n.line,e.column=n.column,0<e.length&&(n=r(e.start+e.length-1,t),e.endLine=n.line,e.endColumn=n.column+2)):(e.start=0,e.length=0,e.line=0,e.column=0)},F.tokenToString=a,F.friendlyTokenToString=function(e,t){var n=e.endPos-e.startPos;let r="";return r=(r=0==n?a(e):20<n?"`"+t.slice(e.startPos,e.startPos+20)+"`...":"`"+t.slice(e.startPos,e.endPos)+"`").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/\t/g,"\\t")},F.tokensToString=function(e){let t="",n=0;for(var r of e){var i=a(r);70<n+i.length&&(n=0,t+="\n"),0!=n&&(t+=" "),t+=i,n+=i.length,r.type!=S.NewLine&&r.type!=S.Comment||(n=0,t+="\n")}return t},F.lex=function(e){if(0==b.length){var t,n,r={'"':f,"'":f,"#":x,"\\":k,".":g};N=L.U.clone(U);for(t of Object.keys(C))N[t]=C[t],N[t+"="]=C[t]+"Assign";E={};for(n of Object.keys(N))E[N[n]]=n;for(let t=0;t<128;++t)if(F.rx.isIdentifierStart(t))b[t]=o;else{var i=String.fromCharCode(t);if(r.hasOwnProperty(i))b[t]=r[i];else if(N.hasOwnProperty(i)){let e=!1,r=N[i];for(var a of Object.keys(N))a!=i&&a.startsWith(i)&&(e=!0);e?b[t]=()=>{var e,t=r,n=w.slice(K,_+1);2==n.length&&N.hasOwnProperty(n)&&(e=w.slice(K,_+2),t=3==e.length&&N.hasOwnProperty(e)?(_+=2,N[e]):(_++,N[n])),l(t)}:b[t]=()=>l(r)}else F.rx.isSpace(t)?b[t]=()=>{}:13==t?b[t]=()=>{10==w.charCodeAt(_)&&_++,d()}:F.rx.isNewline(t)?b[t]=d:v(t)?b[t]=T:b[t]=h}}for(w=e,A=[],_=0,K=0,y();_<w.length;){K=_;var s=w.charCodeAt(_++);s<128?b[s]():F.rx.isIdentifierStart(s)?o():F.rx.isSpace(s)||(F.rx.isNewline(s)?d:h)()}return K=_,d(),p(S.EOF,""),A;function p(e,t,n){e={type:e,value:t,startPos:K,endPos:_,auxValue:n};return A.push(e),e}function c(e){p(S.Error,e)}function o(){for(;F.rx.isIdentifierChar(w.charCodeAt(_));)_++;var e=w.slice(K,_),t=w.charCodeAt(_);F.keywords.hasOwnProperty(e)?p(S.Keyword,e):34==t||39==t?u(e):p(S.Id,e)}function l(e){p(S.Op,e)}function m(e){switch(e){case 97:return 7;case 98:return 8;case 102:return 12;case 110:return 10;case 114:return 13;case 116:return 9;case 118:return 11;default:return 0}}function u(e){var t=w.charCodeAt(_++);let n=!1;w.charCodeAt(_)==t&&w.charCodeAt(_+1)==t&&(_+=2,n=!0);var r=0<=(e=e.toLowerCase()).indexOf("r");let i="",a="";for(;;){var s,o,l=w.charCodeAt(_++);if(l==t){if(!n)break;if(w.charCodeAt(_)==t&&w.charCodeAt(_+1)==t){_+=2;break}a+="\\"+String.fromCharCode(t),i+=String.fromCharCode(t)}else if(92==l){let e=w.charCodeAt(_++);13==e&&10==w.charCodeAt(_)&&(e=10,_++),34==e||39==e||92==e?(r&&(a+="\\",i+="\\"),a+="\\"+String.fromCharCode(e),i+=String.fromCharCode(e)):!r&&m(e)?(a+="\\"+String.fromCharCode(e),i+=String.fromCharCode(m(e))):F.rx.isNewline(e)?r&&(i+="\\"+String.fromCharCode(e),a+="\\\\",10==e?a+="\\n":a+="\\u"+("0000"+e.toString(16)).slice(-4)):r||48!=e?r||117!=e&&120!=e?(a+="\\\\"+String.fromCharCode(e),i+="\\"+String.fromCharCode(e)):(o=117==e?4:2,s=w.slice(_,_+o),_+=o,o=parseInt(s,16),isNaN(o)&&c(L.U.lf("invalid unicode or hex escape")),a+="\\"+String.fromCharCode(e)+s,i+=String.fromCharCode(o)):(a+="\\\\x00",i+="\0")}else{if(isNaN(l)){c(L.U.lf("end of file in a string"));break}if(F.rx.isNewline(l)&&!n){c(L.U.lf("new line in a string"));break}i+=String.fromCharCode(l),a+=String.fromCharCode(l)}}var u=p(S.String,i);u.quoted=a,u.stringPrefix=e}function f(){_--,u("")}function d(){p(S.NewLine,""),y()}function y(){let e=0;for(;;){var t=w.charCodeAt(_);if(9==t)e=e+8&-8;else{if(32!=t)break;e++}_++}p(S.Indent,""+e)}function k(){var e=w.charCodeAt(_);F.rx.isNewline(e)?(_++,13==e&&10==w.charCodeAt(_)&&_++):c(L.U.lf("unexpected character after line continuation character"))}function x(){for(p(S.NewLine,"");_<w.length&&!F.rx.isNewline(w.charCodeAt(_));)_++;p(S.Comment,w.slice(K+1,_)),13==w.charCodeAt(_)&&10==w.charCodeAt(_+1)&&_++,_++,y()}function T(){var e=w[K];let t="";if("0"==e){var n,r=w[_],i=P[r];if(i){for(_++;;){var a=w[_];if(!i.test(a))break;t+=a,_++}return void(t?(n=parseInt(t,I[r]),isNaN(n)&&c(L.U.lf("invalid number")),p(S.Number,e+r+t,n)):c(L.U.lf("expecting numbers to follow 0b, 0o, 0x")))}}let s=!1,o=!1,l=!1;for(_=K;;){var u=w.charCodeAt(_);if((!l||43!=u&&45!=u)&&(l=!1,95!=u)&&!v(u))if(o||s||46!=u){if(o||69!=u&&101!=u)break;o=!0,l=!0}else s=!0;t+=String.fromCharCode(u),_++}!s&&!o&&"0"==e&&1<t.length&&!/^0+/.test(t)&&c(L.U.lf("unexpected leading zero"));r=parseFloat(t);isNaN(r)&&c(L.U.lf("invalid number")),p(S.Number,t,r)}function g(){v(w.charCodeAt(_))?T():p(S.Op,"Dot")}function v(e){return 48<=e&&e<=57}function h(){c(L.U.lf("invalid token"))}}}})(pxt=pxt||{}),(h=>{{var S=h.py||(h.py={});let p,i,a,s,o,c,l,m,f,d=!1,y="";function b(){return i[o]}function u(){for(;i[o];o++){var t=i[o];if(t.type==S.TokenType.Comment)c.push(t);else{if(0<=p&&t.type==S.TokenType.Op)switch(t.value){case"LParen":case"LSquare":case"LBracket":p++;break;case"RParen":case"RSquare":case"RBracket":p--}if(t.type!=S.TokenType.Error){if(0<p){if(t.type==S.TokenType.NewLine||t.type==S.TokenType.Indent)continue}else if(t.type==S.TokenType.Indent){if(i[o+1].type==S.TokenType.NewLine){o++;continue}var n=parseInt(t.value),e=l[l.length-1];if(n==e)continue;if(e<n)return void l.push(n);{t.type=S.TokenType.Dedent;let e=0;for(;l.length;){var r=l[l.length-1];if(!(n<r)){for(r!=n&&E(9552,h.U.lf("inconsitent indentation"));1<e;)i.splice(o,0,t),e--;return}l.pop(),e++}}}return}E(9551,t.value)}}}function N(){(m=b()).type!=S.TokenType.EOF&&(o++,u())}function E(e,t){t=t||h.U.lf("invalid syntax"),e=e||9550;var n=b(),t={code:e,category:pxtc.DiagnosticCategory.Error,messageText:h.U.lf("{0} near {1}",t,S.friendlyTokenToString(n,a)),fileName:s,start:n.startPos,length:n.endPos?n.endPos-n.startPos:0,line:0,column:0};S.patchPosition(t,a),d&&h.log(y+`TS${e} ${t.messageText} at ${t.line+1},`+(t.column+1)),f.push(t),9572!=e&&100<f.length&&h.U.userError(h.U.lf("too many parse errors"))}function r(e,t){var n=b();(n.type==e&&n.value==t||(E(9553,h.U.lf("expecting {0}",S.tokenToString({type:e,value:t,startPos:0,endPos:0}))),n.type!=S.TokenType.NewLine))&&N()}function C(){r(S.TokenType.NewLine,"")}function U(e){r(S.TokenType.Keyword,e)}function P(e){r(S.TokenType.Op,e)}function I(){var e=b();return e.type==S.TokenType.Keyword?e.value:""}function A(){var e=b();return e.type==S.TokenType.Op?e.value:""}let k={if:function e(){let t=_("If");N();t.test=Q();t.body=w();"elif"==I()?t.orelse=[e()]:t.orelse=L();return K(t)},while:function(){var e=_("While");return U("while"),e.test=Q(),e.body=w(),e.orelse=L(),K(e)},for:function(){var e=_("For");return U("for"),e.target=ae(),G(e.target),U("in"),e.iter=$(),e.body=w(),e.orelse=L(),K(e)},try:function(){let e=_("Try"),t=(U("try"),e.body=w(),e.handlers=[],!1);for(;"except"==I();){var n=_("ExceptHandler");e.handlers.push(n),N(),"Colon"!=A()?(t&&E(),n.type=Q(),"as"==I()?(N(),n.name=Z()):n.name=void 0):(t=!0,n.type=void 0,n.name=void 0),n.body=w()}e.orelse=L(),0==e.handlers.length&&e.orelse.length&&E();"finally"==I()?(N(),e.finalbody=w()):e.finalbody=[];return K(e)},with:function(){var e=_("With");return U("with"),e.items=Ne(h.U.lf("with item"),te),e.body=w(),K(e)},def:function(){var e=_("FunctionDef");U("def"),e.name=Z(),P("LParen"),e.args=le(!0),P("RParen"),e.returns=void 0,"Arrow"==A()&&(N(),e.returns=Q());return e.body=w(),K(e)},class:function(){var e=_("ClassDef");{var t;U("class"),e.name=Z(),"LParen"==A()?(t=Ce(),e.bases=t.args,e.keywords=t.keywords):(e.bases=[],e.keywords=[])}return e.body=w(),K(e)}},t={del:function(){var e=_("Delete");return U("del"),e.targets=X(h.U.lf("expression"),j),K(e)},pass:function(){var e=_("Pass");return U("pass"),K(e)},break:function(){var e=_("Break");return N(),K(e)},continue:function(){var e=_("Continue");return N(),K(e)},return:function(){var e=_("Return");N(),D()?e.value=void 0:e.value=$();return K(e)},raise:function(){var e=_("Raise");U("raise"),e.exc=void 0,e.cause=void 0,D()||(e.exc=Q(),"from"==I()&&(N(),e.cause=Q()));return K(e)},global:O,nonlocal:function(){var e=O();return e.kind="Nonlocal",e},import:function(){var e=_("Import");return N(),e.names=Ne(h.U.lf("import name"),ne),K(e)},from:function(){var e=_("ImportFrom");N(),e.level=(()=>{let e=0;for(;;){if("Dot"==A())e+=1;else{if("Ellipsis"!=A())return e;e+=3}N()}})(),b().type==S.TokenType.Id?e.module=R():e.module=void 0;e.level||e.module||E();{var t;U("import"),"Mult"==A()?(N(),(t=_("Alias")).name="*",e.names=[t]):"LParen"==A()?(N(),e.names=X(h.U.lf("import name"),q),P("RParen")):e.names=X(h.U.lf("import name"),q)}return K(e)},assert:function(){var e=_("Assert");N(),e.test=Q(),"Comma"==A()?(N(),e.msg=Q()):e.msg=void 0;return K(e)},yield:function(){b();if(N(),"from"==I())return(e=_("YieldFrom")).value=Q(),F(K(e));var e=_("Yield");D()||(e.value=$());return F(K(e))}};function w(){if(P("Colon"),b().type!=S.TokenType.NewLine)return oe();{var t=y;d&&(h.log(y+"{"),y+="  "),N();let e;if(b().type!=S.TokenType.Indent)E(9554,h.U.lf("expected an indented block")),e=B();else{var n=parseInt(b().value);for(N(),e=B();;){if(b().type==S.TokenType.Dedent){var r=isNaN(n)||parseInt(b().value)<n;if(N(),r)break}if(h.U.pushRange(e,B()),b().type==S.TokenType.EOF)break}}return d&&(y=t,h.log(y+"}")),e}}function _(e,t){t=t||b();return{startPos:t.startPos,endPos:t.endPos,kind:e}}function K(e){return e.endPos=m.endPos,e}function L(){return"else"==I()?(N(),w()):[]}function te(){var e=_("WithItem");return e.context_expr=Q(),e.optional_vars=void 0,"as"==I()&&(N(),e.optional_vars=j()),K(e)}function F(e){var t=_("ExprStmt");return t.startPos=e.startPos,t.endPos=e.endPos,t.value=e,t}function D(){var e=b();return e.type==S.TokenType.NewLine||e.type==S.TokenType.Op&&"Semicolon"==e.value}function O(){var e=_("Global");for(N(),e.names=[];e.names.push(Z()),"Comma"==A();)N();return K(e)}function R(){let e="";for(;;){if(e+=Z(),"Dot"!=A())return e;e+=".",N()}}function ne(){var e=_("Alias");return e.name=R(),"as"==I()?(N(),e.asname=Z()):e.asname=void 0,K(e)}function q(){var e=_("Alias");return e.name=Z(),"as"==I()?(N(),e.asname=Z()):e.asname=void 0,K(e)}function re(e,t){e=_("Tuple",e);return e.elts=t,K(e)}function M(e){var t=b(),e=X(h.U.lf("expression"),e),n=e[0];return 1!=e.length?re(t,e):n}function ie(){return M(V)}function $(){return M(Q)}function ae(){return M(j)}function G(e){"Tuple"==e.kind?e.elts.forEach(G):e.ctx="Store"}function se(){var e=h.U.lookup(t,I());return(e||(()=>{var e,t=b();let n=ie(),r=A();if("Assign"!=r)return"Colon"==r?((e=_("AnnAssign")).target=n,N(),e.annotation=Q(),"Assign"==A()&&(N(),e.value=Q()),e.simple=t.type==S.TokenType.Id&&"Name"==n.kind?1:0,G(e.target),K(e)):h.U.endsWith(r,"Assign")?((t=_("AugAssign")).target=n,t.op=r.replace("Assign",""),N(),t.value=$(),G(t.target),K(t)):"Semicolon"==r||b().type==S.TokenType.NewLine?((e=_("ExprStmt")).value=n,K(e)):(E(9555,h.U.lf("unexpected token")),N(),null);var i=_("Assign");for(i.targets=[n];;){if(N(),n=ie(),"Assign"!=(r=A())){i.value=n;break}i.targets.push(n)}return i.targets.forEach(G),K(i)}))()}function oe(){for(var e=[se()];"Semicolon"==A()&&(N(),b().type!=S.TokenType.NewLine);)e.push(se());return C(),e.filter(e=>!!e)}function B(){for(var e=f.length,t=b().type==S.TokenType.Indent,n=(t&&(N(),E(9573,h.U.lf("unexpected indent"))),[]);"MatMult"==A();)N(),n.push(Ue()),C();var r=I(),i=h.U.lookup(k,I());let a=[];var s,o=c,l=(c=[],"class"==r||"def"==r?((r=i()).decorator_list=n,a=[r]):n.length?E(9556,h.U.lf("decorators not allowed here")):a=i?[i()]:oe(),o.length&&a.length&&(a[0]._comments=o),[]);if(f.length>e){for(p=-1;m.type!=S.TokenType.Dedent&&m.type!=S.TokenType.NewLine&&(N(),d&&l.push(S.tokenToString(b())),b().type!=S.TokenType.EOF););t&&b().type===S.TokenType.Dedent&&N(),p=0,d&&h.log(y+"skip: "+l.join(", "))}if(d)for(var u of a)s="stmt",u=u,d&&h.log(y+s+": "+u.kind);return a}function le(t){var n=_("Arguments");for(n.args=[],n.defaults=[],n.kwonlyargs=[],n.kw_defaults=[],n.vararg=void 0;;){var r=A();if("Colon"==r||"RParen"==r)break;if("Mult"==r)n.vararg&&E(9557,h.U.lf("multiple *arg")),N(),b().type==S.TokenType.Id?n.vararg=i():n.vararg=void 0;else if("Pow"==r)n.kwarg&&E(9558,h.U.lf("multiple **arg")),N(),n.kwarg=i();else{n.kwarg&&E(9559,h.U.lf("arguments after **"));r=i();let e=void 0;"Assign"==A()&&(N(),e=Q()),void 0!==n.vararg&&e?(n.kwonlyargs.push(r),n.kw_defaults.push(e)):(n.args.push(r),e?n.defaults.push(e):n.defaults.length&&E(9560,h.U.lf("non-default argument follows default argument")))}if("Comma"!=A())break;N()}return n.kwarg||(n.kwarg=void 0),n.vararg||(n.vararg=void 0),K(n);function i(){var e=_("Arg");return e.arg=Z(),e.annotation=void 0,t&&"Colon"==A()&&(N(),e.annotation=Q()),e}}function ue(e){var t=_("Lambda");return N(),t.args=le(!1),P("Colon"),t.body=(e?ve:Q)(),K(t)}function Q(){var e,t;return"lambda"==I()?ue():(t=b(),e=z(),"if"==I()?((t=_("IfExp",t)).body=e,U("if"),t.test=z(),U("else"),t.orelse=Q(),K(t)):e)}function pe(e,t){var n=b(),r=t();if(I()!=e)return r;var i=_("BoolOp",n);for(i.op="or"==e?"Or":"And",i.values=[r];I()==e;)U(e),i.values.push(t());return K(i)}function ce(){return pe("and",me)}function z(){return pe("or",ce)}function me(){if("not"==I())return e=_("UnaryOp"),N(),e.op="Not",e.operand=me(),K(e);var e=b(),t=j();if(!fe())return t;var n=_("Compare",e);for(n.left=t,n.comparators=[],n.ops=[];;){let e=fe();if(!e)break;N(),"NotIn"==e?U("in"):"Is"==e&&"not"==I()&&(N(),e="IsNot"),n.ops.push(e),n.comparators.push(j())}return K(n)}let e={Lt:"Lt",Gt:"Gt",Eq:"Eq",GtE:"GtE",LtE:"LtE",NotEq:"NotEq",in:"In",not:"NotIn",is:"Is"};function fe(){return e[A()]||e[I()]||null}let n={Invert:"Invert",Sub:"USub",Add:"UAdd"};function W(e,t){var n=b();let r=e();for(;;){var i=A();if(!(i&&0<=t.indexOf(","+i+",")))return r;var a=_("BinOp",n);a.left=r,a.op=i,N(),a.right=e(),r=a}}function de(){return W(ee,",Mult,MatMult,Div,Mod,FloorDiv,")}function ye(){return W(de,",Add,Sub,")}function ke(){return W(ye,",LShift,RShift,")}function xe(){return W(ke,",BitAnd,")}function Te(){return W(xe,",BitXor,")}function j(){return W(Te,",BitOr,")}function ge(){var e,t=b();let n=void 0;return"Colon"!=A()&&(n=Q()),"Colon"==A()?((t=_("Slice",t)).lower=n,N(),e=A(),t.upper="Colon"!=e&&"Comma"!=e&&"RSquare"!=e?Q():void 0,t.step=void 0,"Colon"==A()&&(N(),"Comma"!=(e=A()))&&"RSquare"!=e&&(t.step=Q()),K(t)):(n||E(9570,h.U.lf("unable to parse lower subscript")),(e=_("Index")).value=n,K(e))}function V(){var e;return"Mult"==A()?((e=_("Starred")).value=j(),K(e)):Q()}function ve(){return"lambda"==I()?ue(!0):z()}function H(){for(var e=[];;){var t=_("Comprehension");for(t.is_async=0,e.push(t),U("for"),t.target=ae(),G(t.target),U("in"),t.iter=z(),t.ifs=[];"if"==I();)N(),t.ifs.push(ve());if("for"!=I())return e}}function he(){var e,t,n=b();return"Mult"==A()?(e=_("Starred"),N(),e.value=Q(),K(e)):"Pow"==A()?(e=_("Keyword"),N(),e.arg=void 0,e.value=Q(),K(e)):(e=Q(),"Assign"==A()?("Name"!=e.kind&&E(9561,h.U.lf("invalid keyword argument; did you mean ==?")),N(),(t=_("Keyword",n)).arg=e.id||"???",t.value=Q(),K(t)):"for"==I()?((t=_("GeneratorExp",n)).elt=e,t.generators=H(),K(t)):e)}function Se(){let a=b();var e,t,n;return N(),"Pow"==A()?(N(),r(void 0,j())):"RBracket"==A()?(e=_("Dict",a),N(),e.keys=[],e.values=[],K(e)):"Starred"!=(e=V()).kind&&"Colon"==A()?(N(),r(e,Q())):(e=e,"for"==I()?("Starred"==e.kind&&E(9562,h.U.lf("iterable unpacking cannot be used in comprehension")),(t=_("SetComp",a)).elt=e,t.generators=H()):((t=_("Set",a)).elts=[e],"Comma"==A()?(n=Y("RBracket",h.U.lf("set element"),V),t.elts=[e].concat(n)):P("RBracket")),K(t));function s(){var e;return"Pow"==A()?(N(),[null,j()]):(e=Q(),P("Colon"),[e,Q()])}function r(e,t){var n;if("for"==I())return e||E(9563,h.U.lf("dict unpacking cannot be used in dict comprehension")),(n=_("DictComp",a)).key=e,n.value=t,n.generators=H(),K(n);var r,i=_("Dict",a);if(i.keys=[e],i.values=[t],"Comma"==A())for(r of Y("RBracket",h.U.lf("dict element"),s))2<=r.length&&r[0]&&r[1]&&(i.keys.push(r[0]),i.values.push(r[1]));else P("RBracket");return K(i)}}function J(){var e=_("NameConstant");return e.value=null,N(),K(e)}function be(){var e=A();return"RParen"==e||"RSquare"==e||"RBracket"==e||"Colon"==e||"Semicolon"==e||h.U.endsWith(e,"Assign")||"in"==I()||b().type==S.TokenType.NewLine}function X(e,t){var n=[];if(be())return n;for(;;){n.push(t());var r="Comma"==A();if(r&&N(),be())return n;if(!r)return E(9567,h.U.lf("expecting {0}",e)),n}}function Ne(e,t){for(var n=[];n.push(t()),"Comma"==A();)N();return n}function Y(e,t,n){N();var r=[];if(A()!=e)for(;;){r.push(n());var i="Comma"==A();if(i&&N(),A()==e)break;if(!i){E(9568,h.U.lf("expecting {0}",t));break}}return P(e),r}function Ee(e,t,n){var r,i=b();return N(),A()==e?(N(),(r=_(t,i)).elts=[],K(r)):(r=V(),"for"==I()?((n=_(n,i)).elt=r,n.generators=H(),P(e),K(n)):"Comma"==A()?(n=_(t,i),N(),n.elts=X(h.U.lf("expression"),V),n.elts.unshift(r),P(e),K(n)):(P(e),"List"==t?((n=_(t,i)).elts=[r],K(n)):r))}function Z(){var e=b();return e.type!=S.TokenType.Id&&E(9569,h.U.lf("expecting identifier")),N(),e.value}function Ce(){var e,t=[],n=[];for(e of Y("RParen",h.U.lf("argument"),he))("Keyword"==e.kind?n:(n.length&&E(9570,h.U.lf("positional argument follows keyword argument")),t)).push(e);return{args:t,keywords:n}}function Ue(){var e,t,n,r,i,a,s=b();let o=(()=>{var t,n=b();if(n.type==S.TokenType.Id)return t=_("Name"),N(),t.id=n.value,t.ctx="Load",K(t);if(n.type==S.TokenType.Number)return t=_("Num"),N(),t.ns=n.value,t.n=n.auxValue,K(t);if(n.type!=S.TokenType.String)return n.type==S.TokenType.Keyword?"None"==n.value||"True"==n.value||"False"==n.value?(t=_("NameConstant"),N(),t.value="True"==n.value||"False"!=n.value&&null,K(t)):(E(9564,h.U.lf("expecting atom")),J()):n.type==S.TokenType.Op?"LParen"==(t=n.value)?Ee("RParen","Tuple","GeneratorExp"):"LSquare"==t?Ee("RSquare","List","ListComp"):("LBracket"==t?Se:(E(9565,h.U.lf("unexpected operator")),J))():(E(9566,h.U.lf("unexpected token")),J());{N();let e=n.value;for(;b().type==S.TokenType.String;)e+=b().value,N();return"b"==n.stringPrefix?((t=_("Bytes",n)).s=h.U.toArray(h.U.stringToUint8Array(e)),K(t)):((t=_("Str",n)).s=e,K(t))}})();for(;;){e=s,t=o,a=i=r=l=n=void 0;var l="LParen"==(a=A())?((n=_("Call",e)).func=t,i=Ce(),n.args=i.args,n.keywords=i.keywords,K(n)):"LSquare"==a?(i=b(),(n=_("Subscript",e)).value=t,0==(l=Y("RSquare",h.U.lf("subscript"),ge)).length?E(9571,h.U.lf("need non-empty index list")):1==l.length?n.slice=l[0]:l.every(e=>"Index"==e.kind)?((r=l[0]).value=re(i,l.map(e=>e.value)),n.slice=r):((r=_("ExtSlice",i)).dims=l,n.slice=K(r)),K(n)):"Dot"==a?((i=_("Attribute",e)).value=t,N(),i.attr=Z(),K(i)):t;if(l===o)return o;o=l}}function ee(){var e,t;return n[A()]?((t=_("UnaryOp")).op=n[A()],N(),t.operand=ee(),K(t)):(b(),t=Ue(),"Pow"==A()?(e=_("BinOp"),N(),e.left=t,e.op="Pow",e.right=ee(),K(e)):t)}let x={kind:1,id:2,n:3,s:4,func:5,key:6,elt:7,elts:8,keys:9,left:10,ops:11,comparators:12,names:13,items:14,test:15,targets:16,dims:17,context_expr:18,name:19,bases:20,type:21,inClass:22,target:23,annotation:24,simple:25,op:26,operand:27,right:28,values:29,iter:30,ifs:31,is_async:32,value:33,slice:34,attr:35,generators:36,args:37,keywords:38,body:39,handlers:40,orelse:41,finalbody:42,decorator_list:43,kwonlyargs:44,kw_defaults:45,defaults:46,arg:47},T={lineno:1,col_offset:1,startPos:1,endPos:1,kind:1},g={body:1,orelse:1,finalbody:1},v={_comments:1,ctx:1,ns:1};S.dump=function(e,u=!1){let p=(n,r)=>{if(Array.isArray(r)){let t="";for(let e=0;e<r.length;++e)0<e&&(t+=", "),t+=p(n,r[e]);return"["+t+"]"}if(!r||!r.kind)return JSON.stringify(r);let e="";var t,i=Object.keys(r);i.sort((e,t)=>(x[e]||100)-(x[t]||100)||h.U.strcmp(e,t));for(t of i)if(!(h.U.lookup(T,t)||u&&h.U.lookup(v,t)))if(e&&(e+=", "),e+=t+"=",Array.isArray(r[t])&&r[t].length&&h.U.lookup(g,t)){e+="[\n";var a,s=n+"  ";for(a of r[t])e+=s+p(s,a)+"\n";e+=n+"]"}else if("_comments"==t){e+="[\n";var o,l=n+"  ";for(o of r[t])e+=l+JSON.stringify(o.value)+"\n";e+=n+"]"}else e+=p(n,r[t]);return r.kind+"("+e+")"},t="";for(var n of e)t+=p("",n)+"\n";return t},S.parse=function(e,t,n){a=e,s=t,i=n,p=0,o=0,c=[],l=[0],f=[];let r=[];try{if(m=i[0],u(),b().type!=S.TokenType.EOF)for(r=B();b().type!=S.TokenType.EOF;)h.U.pushRange(r,B())}catch(e){E(9572,h.U.lf("exception: {0}",e.message))}return{stmts:r,diagnostics:f}}}})(pxt=pxt||{}),(Q=>{{var z=Q.py||(Q.py={});function W(e,t,n){e={fileName:e.getSourceFile().fileName,start:e.getStart(),length:e.getEnd()-e.getStart(),line:void 0,column:void 0,code:t,category:pxtc.DiagnosticCategory.Error,messageText:n},t=new Error(n);throw t.pyDiagnostic=e,t}let G=!(z.decompileToPython=function(e,t){var n={blocksInfo:void 0,outfiles:{},diagnostics:[],success:!0,times:{}};try{var r=((e,n)=>{let c=e.getTypeChecker(),r=(new ts.pxtc.LSHost(e),e.getSourceFile(n)),i=pxtc.decompiler.buildCommentMap(r),t=Q.U.toSet((()=>["ArithmeticError","AssertionError","AttributeError","BaseException","BlockingIOError","BrokenPipeError","BufferError","BytesWarning","ChildProcessError","ConnectionAbortedError","ConnectionError","ConnectionRefusedError","ConnectionResetError","DeprecationWarning","EOFError","Ellipsis","EnvironmentError","Exception","False","FileExistsError","FileNotFoundError","FloatingPointError","FutureWarning","GeneratorExit","IOError","ImportError","ImportWarning","IndentationError","IndexError","InterruptedError","IsADirectoryError","KeyError","KeyboardInterrupt","LookupError","MemoryError","NameError","None","NotADirectoryError","NotImplemented","NotImplementedError","OSError","OverflowError","PendingDeprecationWarning","PermissionError","ProcessLookupError","RecursionError","ReferenceError","ResourceWarning","RuntimeError","RuntimeWarning","StopAsyncIteration","StopIteration","SyntaxError","SyntaxWarning","SystemError","SystemExit","TabError","TimeoutError","True","TypeError","UnboundLocalError","UnicodeDecodeError","UnicodeEncodeError","UnicodeError","UnicodeTranslateError","UnicodeWarning","UserWarning","ValueError","Warning","ZeroDivisionError","_","__build_class__","__debug__","__doc__","__import__","__loader__","__name__","__package__","__spec__","abs","all","any","ascii","bin","bool","bytearray","bytes","callable","chr","classmethod","compile","complex","copyright","credits","delattr","dict","dir","divmod","enumerate","eval","exec","exit","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","license","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","print","property","quit","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip",...Object.keys(Q.py.keywords)])(),e=>e),[k,s]=ts.pxtc.decompiler.buildRenameMap(e,r,{takenNames:t,declarations:"all"}),x=pxtc.getApiInfo(e),o=Q.U.mapMap(x.byQName,(e,t)=>t.fileName==n?void 0:t),l=z.computeScopeVariableLookup(r);{let t=(e=r).getChildren().map(g).reduce((e,t)=>e.concat(t),[]).reduce((e,t)=>t||e[e.length-1]?[...e,t]:e,[]);return i.filter(e=>!e.owner).forEach(e=>t.push(...u(e))),t.join("\n")}function h(e){if(!e.getSourceFile())return null;let t=e.getText();var n=c.getSymbolAtLocation(e),n=(n&&(t=c.getFullyQualifiedName(n)),o[t]);if(n&&n.attributes.alias)return n.attributes.alias;if(n&&n.pyQName){if(n.isInstance){if(ts.isPropertyAccessExpression(e))return null;e=new RegExp(`(?:^|.)${n.namespace}.(.+)`).exec(n.pyQName);if(e)return e[1]}return n.pyQName}return t in pxtc.ts2PyFunNameMap?pxtc.ts2PyFunNameMap[t].n:null}function S(e){var t=h(e);if(t)return t;if(!ts.isIdentifier(e))return Q.tickEvent("depython.todo.advancedname"),W(e,3001,"Unsupported advanced name format: "+e.getText());let n=e.text;var t=e.getSourceFile();return n=t&&(t=k.getRenameForPosition(e.getStart()))?t.name:n}function m(e,t){return 0!=(e.flags&t)}function a(e,t){return m(c.getTypeAtLocation(e),t)}function b(e){return a(e,ts.TypeFlags.StringLike)}function T(e){return a(e,ts.TypeFlags.NumberLike)}function g(e){switch(e.kind){case ts.SyntaxKind.SyntaxList:return e._children.map(g).reduce((e,t)=>e.concat(t),[]);case ts.SyntaxKind.EndOfFileToken:case ts.SyntaxKind.OpenBraceToken:case ts.SyntaxKind.CloseBraceToken:return[];default:return n=v(t=e),(t=pxtc.decompiler.getCommentsForStatement(t,i).map(u).reduce((e,t)=>e.concat(t),[])).concat(n)}var t,n}function u(e){var t=[];if(e.kind===pxtc.decompiler.CommentKind.SingleLine)t.push("# "+e.text);else{t.push('"""');for(var n of e.lines)t.push(n);t.push('"""')}return t}function v(a){var e,t,n,r,i,s;if(ts.isVariableStatement(a))return a.declarationList.declarations.map(P).reduce((e,t)=>e.concat(t),[]);if(ts.isClassDeclaration(a)){var o=a;if(!B)return Q.tickEvent("depython.todo.classes"),W(o,3016,"Unsupported: classes are not supported in Python right now.");let e=[];return o.name?(c=o.members.every(R),l=S(o.name),c?e.push(`class ${l}(Enum):`):e.push(`class ${l}:`),c=o.members.map(q).reduce((e,t)=>e.concat(t),[]).filter(e=>e),e=c.length?e.concat(c.map(z.indent1)):e):(Q.tickEvent("depython.todo.anonymousclass"),W(o,3011,"Unsupported: anonymous class"))}if(ts.isEnumDeclaration(a)){var l=a;var u,p=[],c=(p.push(`class ${S(l.name)}(Enum):`),l.members.every(e=>!!e.initializer)),o=!l.members.every(e=>!!e.initializer);if(!c&&!o)return Q.tickEvent("depython.todo.enummix"),W(l,3005,"Unsupported enum decleration: has mixture of explicit and implicit initialization");if(c)return Q.tickEvent("depython.todo.enuminit"),W(l,3006,"Unsupported: explicit enum initialization");let e=0;for(u of l.members)p.push(z.indent1(S(u.name)+" = "+e++));return p}if(ts.isExpressionStatement(a))return(t=E((e=a).expression))||([t,e]=O(e.expression),e.length?["",...e,...t,""]:[...e,...t]);if(ts.isFunctionDeclaration(a))return U(a);if(ts.isIfStatement(a))return{supportStmts:e,ifStmt:t,rest:m}=function i(a){let s=[];let[e,t]=O(a.expression);s=s.concat(t);let n=`if ${A(e)}:`;let o=[];let r=N(a.thenStatement);o=o.concat(r);if(a.elseStatement)if(ts.isIfStatement(a.elseStatement)){let{supportStmts:e,ifStmt:t,rest:n}=i(a.elseStatement),r="el"+t;s=s.concat(e),o.push(r),o=o.concat(n)}else{o.push("else:");let e=N(a.elseStatement);o=o.concat(e)}return{supportStmts:s,ifStmt:n,rest:o}}(e=a),e.concat([t]).concat(m);if(ts.isForStatement(a)){var m=a;var f,d,y,k=(e=>{if(!e.initializer)return null;if(e.initializer.kind!==ts.SyntaxKind.VariableDeclarationList)return null;if(1!==(n=e.initializer).declarations.length)return null;var t=S((n=n.declarations[0]).name);if(!n.initializer||!(e=>function t(e,n){let r=e=>t(e,n);{if(ts.isBinaryExpression(e))return r(e.left)&&r(e.right);if(ts.isPropertyAccessExpression(e))return r(e.expression);if(ts.isPrefixUnaryExpression(e)||ts.isPostfixUnaryExpression(e))return e.operator!==ts.SyntaxKind.PlusPlusToken&&e.operator!==ts.SyntaxKind.MinusMinusToken&&r(e.operand);if(ts.isParenthesizedExpression(e))return r(e.expression);if(ts.isArrayLiteralExpression(e))return e.elements.map(r).reduce((e,t)=>e&&t,!0);if(ts.isElementAccessExpression(e))return r(e.expression)&&(!e.argumentExpression||r(e.argumentExpression))}return n(e)}(e,e=>{switch(e.kind){case ts.SyntaxKind.PropertyAccessExpression:case ts.SyntaxKind.BinaryExpression:case ts.SyntaxKind.ParenthesizedExpression:case ts.SyntaxKind.ArrayLiteralExpression:case ts.SyntaxKind.ElementAccessExpression:case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:case ts.SyntaxKind.NumericLiteral:case ts.SyntaxKind.StringLiteral:case ts.SyntaxKind.NoSubstitutionTemplateLiteral:return!0;case ts.SyntaxKind.CallExpression:case ts.SyntaxKind.NewExpression:case ts.SyntaxKind.FunctionExpression:case ts.SyntaxKind.ArrowFunction:case ts.SyntaxKind.Identifier:case ts.SyntaxKind.ThisKeyword:return!1;case ts.SyntaxKind.PrefixUnaryExpression:case ts.SyntaxKind.PostfixUnaryExpression:return e.operator!==ts.SyntaxKind.PlusPlusToken&&e.operator!==ts.SyntaxKind.MinusMinusToken}return!1}))(n.initializer)||!T(n.initializer))return null;var[n,r]=O(n.initializer);if(r.length)return null;if(r=A(n),!e.condition)return null;if(!ts.isBinaryExpression(e.condition))return null;if(!ts.isIdentifier(e.condition.left))return null;if(S(e.condition.left)!=t)return null;if(!T(e.condition.right))return null;var[n,i]=O(e.condition.right);if(i.length)return null;let a=A(n),s=a;if(e.condition.operatorToken.kind===ts.SyntaxKind.LessThanEqualsToken&&(e=>{var t=Math.floor(Number(e));return t!==1/0&&String(t)===e})(a))s=""+(Number(a)+1);else if(e.condition.operatorToken.kind!==ts.SyntaxKind.LessThanToken)return null;return e.incrementor&&(ts.isPostfixUnaryExpression(e.incrementor)||ts.isPrefixUnaryExpression(e.incrementor))&&e.incrementor.operator===ts.SyntaxKind.PlusPlusToken&&r<s?i={name:t,fromIncl:r,toExcl:s}:null})(m);if(k)return{name:k,fromIncl:d,toExcl:f}=k,k="0"===d?`for ${k} in range(${f}):`:`for ${k} in range(${d}, ${f}):`,d=N(m.statement),[k].concat(d);let e=[];m.initializer&&(e=ts.isVariableDeclarationList(m.initializer)?(f=m.initializer.declarations.map(P).reduce((e,t)=>e.concat(t),[]),e.concat(f)):([k,d]=O(m.initializer),e.concat(d).concat(k)));let t,n=`while ${t=m.condition?([k,y]=O(m.condition),e=e.concat(y),A(k)):"True"}:`,r=(e.push(n),v(m.statement).map(z.indent1));return 0!==r.length||m.incrementor||(r=[z.indent1("pass")]),e=e.concat(r),m.incrementor&&(y=E(m.incrementor),e=y?e.concat(y.map(z.indent1)):([k,m]=O(m.incrementor),e.concat(m).concat(k.map(z.indent1)))),e}if(ts.isForOfStatement(a)){k=a;if(!ts.isVariableDeclarationList(k.initializer))return Q.tickEvent("depython.todo.forof.complexexp"),W(k,3003,"Unsupported expression in for..of initializer: "+k.initializer.getText());var x=k.initializer.declarations.map(e=>S(e.name));if(1!==x.length)return Q.tickEvent("depython.todo.forof.multidecl"),W(k,3004,"Unsupported multiple declerations in for..of: "+k.initializer.getText());let e=x[0],[t,n]=O(k.expression),r=n,i=(r=r.concat(w(`for ${e} in `,t,":")),N(k.statement));return r=r.concat(i)}return ts.isWhileStatement(a)?([r,n]=O((x=a).expression),x=N(x.statement),r=w("while ",r,":"),n.concat(r).concat(x)):ts.isReturnStatement(a)?(n=a).expression?([n,r]=O(n.expression),n=w("return ",n),r.concat(n)):["return"]:ts.isBlock(a)?C(a):ts.isTypeAliasDeclaration(a)?(i=a,s=pxtc.emitPyTypeFromTypeNode(i.type),[(i=S(i.name))+" = "+s]):ts.isEmptyStatement(a)?[]:ts.isModuleDeclaration(a)?(s=S((i=a).name),i=i.body&&i.body.getChildren().map(g).reduce((e,t)=>e.concat(t),[]).map(e=>z.indent1(e)),["@namespace",`class ${s}:`].concat(i||[])):ts.isBreakStatement(a)?["break"]:ts.isContinueStatement(a)?["continue"]:(Q.tickEvent("depython.todo.statement",{statement:a.kind}),W(a,3002,`Not supported in MakeCode Python: ${ts.SyntaxKind[a.kind]} (${a.kind})`))}function N(e){let t=v(e).map(z.indent1);return t=t.length<1?[z.indent1("pass")]:t}function R(e){if(e.kind!==ts.SyntaxKind.PropertyDeclaration)return!1;var t;if(!e.modifiers||1!==e.modifiers.length)return!1;for(t of e.modifiers)if(t.kind!==ts.SyntaxKind.StaticKeyword)return!1;return!!e.initializer&&e.initializer.kind===ts.SyntaxKind.NumericLiteral}function q(n){if(ts.isPropertyDeclaration(n))return p(n);if(ts.isMethodDeclaration(n))return U(n);if(ts.isConstructorDeclaration(n)){var r=n;let t=[],e=r.parameters.filter(ts.isParameterPropertyDeclaration);return e.forEach(e=>{t=[...t,...p(e)]}),t=[...t,...U(r,"__init__")],e.length&&t.slice(-1)[0].endsWith("pass")&&t.pop(),e.forEach(e=>{e=S(e.name);t.push(z.indent1(`self.${e} = `+e))}),t}return["# unknown ClassElement "+n.kind]}function p(e){var t,n=S(e.name);if(e.initializer)return[t,r]=O(e.initializer),[...r,n+" = "+A(t)];if(ts.isParameterPropertyDeclaration(e)&&e.type){var r=c.getTypeFromTypeNode(e.type),i=m(t=r,ts.TypeFlags.NumberLike)?"0":m(t,ts.TypeFlags.StringLike)?'""':m(t,ts.TypeFlags.BooleanLike)?"False":void 0;if(i)return[n+" = "+i]}return Q.tickEvent("depython.todo.classwithoutinit"),W(e,3006,"Unsupported: class properties without initializers")}function E(e){var t,n;return t=e,!ts.isPrefixUnaryExpression(t)&&!ts.isPostfixUnaryExpression(t)||t.operator!==ts.SyntaxKind.MinusMinusToken&&t.operator!==ts.SyntaxKind.PlusPlusToken?null:([t,n]=O(e.operand),e=e.operator===ts.SyntaxKind.MinusMinusToken?" -= 1":" += 1",(n=n).push(A(t)+e),n)}function C(e){return e.getChildren().map(g).reduce((e,t)=>e.concat(t),[])}function U(e,t,n,r){let i=[];e.kind!==ts.SyntaxKind.MethodDeclaration&&e.kind!==ts.SyntaxKind.Constructor||i.push("self");var n=(n?y(e.parameters,n):e.parameters).map(e=>f(e,!r)),n=(i=i.concat(n)).join(", ");let a=[],s;if(t)s=t;else{if(!e.name)return Q.tickEvent("depython.todo.anonymousfunc"),W(e,3012,"Unsupported: anonymous function decleration");s=S(e.name)}if(a.push(`def ${s}(${n}):`),!e.body)return Q.tickEvent("depython.todo.funcwithoutbody"),W(e,3013,"Unsupported: function decleration without body");let o=[];return ts.isBlock(e.body)?o=C(e.body):([t,n]=O(e.body),(o=o.concat(n)).concat(t)),o.length?((n=l.getExplicitGlobals(e).map(e=>S(e)))&&n.length&&o.unshift("global "+n.join(", ")),(t=l.getExplicitNonlocals(e).map(e=>S(e)))&&t.length&&o.unshift("nonlocal "+t.join(", ")),a=a.concat(o.map(z.indent1))):a.push(z.indent1("pass")),a}function f(e,t=!0){var n=e.altName||S(e.name);let r="",i=(e.type&&t&&(t=pxtc.emitPyTypeFromTypeNode(e.type))&&-1===t.indexOf("(TODO")&&(r=": "+t),"");if(e.initializer){var[t,a]=O(e.initializer);if(a.length)return Q.tickEvent("depython.todo.complexinit"),W(e,3007,"Unsupported: complex expression in parameter default value not supported. Expression: "+e.initializer.getText());i=" = "+A(t)}return""+n+r+i}function P(t){let n=[];var r=S(t.name);if(t.initializer){var[i,a]=O(t.initializer);n=n.concat(a);let e;e=t.type?r+`: ${pxtc.emitPyTypeFromTypeNode(t.type)} = `+A(i):r+" = "+A(i),n.push(e)}return n}function I(e,t){return[[e],t||[]]}function A(e,t="\n"){return e.join(t)}function w(e="",t,n=""){return t[0]=e+t[0],t[t.length-1]=t[t.length-1]+n,t}function _(e,t){switch(e){case ts.SyntaxKind.BarBarToken:return"or";case ts.SyntaxKind.AmpersandAmpersandToken:return"and";case ts.SyntaxKind.ExclamationToken:return"not";case ts.SyntaxKind.LessThanToken:return"<";case ts.SyntaxKind.LessThanEqualsToken:return"<=";case ts.SyntaxKind.GreaterThanToken:return">";case ts.SyntaxKind.GreaterThanEqualsToken:return">=";case ts.SyntaxKind.EqualsEqualsEqualsToken:case ts.SyntaxKind.EqualsEqualsToken:return"==";case ts.SyntaxKind.ExclamationEqualsEqualsToken:case ts.SyntaxKind.ExclamationEqualsToken:return"!=";case ts.SyntaxKind.EqualsToken:return"=";case ts.SyntaxKind.PlusToken:return"+";case ts.SyntaxKind.MinusToken:return"-";case ts.SyntaxKind.AsteriskToken:return"*";case ts.SyntaxKind.PlusEqualsToken:return"+=";case ts.SyntaxKind.MinusEqualsToken:return"-=";case ts.SyntaxKind.PercentToken:return"%";case ts.SyntaxKind.SlashToken:return"/";case ts.SyntaxKind.PlusPlusToken:case ts.SyntaxKind.MinusMinusToken:return Q.tickEvent("depython.todo.unsupportedop",{op:e}),W(t,3008,"Unsupported ++ and -- in an expression (not a statement or for loop)");case ts.SyntaxKind.AmpersandToken:return"&";case ts.SyntaxKind.CaretToken:return"^";case ts.SyntaxKind.LessThanLessThanToken:return"<<";case ts.SyntaxKind.GreaterThanGreaterThanToken:return">>";case ts.SyntaxKind.GreaterThanGreaterThanGreaterThanToken:return Q.tickEvent("depython.todo.unsupportedop",{op:e}),W(t,3009,"Unsupported operator: >>>");case ts.SyntaxKind.AsteriskAsteriskToken:return"**";case ts.SyntaxKind.AsteriskAsteriskEqualsToken:return"**=";case ts.SyntaxKind.PercentEqualsToken:return"%=";case ts.SyntaxKind.AsteriskEqualsToken:return"*=";case ts.SyntaxKind.SlashEqualsToken:return"/=";default:return Q.tickEvent("depython.todo.unsupportedop",{op:e}),W(t,3008,`Unsupported Python operator (code: ${e})`)}}function d(e){var t;return ts.isPropertyAccessExpression(e)?(t=(t=S(e.name)).substr(t.lastIndexOf(".")+1),ts.isIdentifier(e.expression)?[t]:d(e.expression).concat([t])):ts.isIdentifier(e)?[S(e)]:[]}function M(e,t,n,r){let i="",a=(t&&(i=d(t).map(Q.U.snakify).join("_")),[]);if(n&&1<n.length&&r&&1<r.length)for(let e=0;e<n.length&&e<r.length;e++){var s=r[e];m(c.getTypeAtLocation(s),ts.TypeFlags.EnumLike)&&(s=d(s).map(Q.U.snakify),a=a.concat(s))}t=a.join("_");let o="",l=(i||t||!e||(o=S(e.name)),([i,t,o].filter(e=>e).map(Q.U.snakify).map(e=>e.toLowerCase()).join("_")||"my_callback").split("_"));4<l.length&&(l=(e=>{var t,n={},r=[];for(t of e)t in n||(n[t]=!0,r.push(t));return r})(l));for(var u=Q.U.toDictionary(["any","on","event"],e=>e);2<l.length;){var p=((e,t)=>{let n=[],r=!1;for(var i of e)i in t&&!r?r=!0:n.push(i);return n})(l,u);if(p.length==l.length)break;l=p}return(l=["on",...l]).join("_")}function K(i){var e=i.join(", ");return 60<e.length&&1<i.length?i.map((e,t)=>{var n,r=","==e.charAt(e.length-1)?"":",";return 0==t?(e=1<(n=e.split("\n")).length?n.shift()+"\n"+z.indent1(n.join("\n")):e)+r:t==i.length-1?z.indent1(e):z.indent1(e+r)}):[e]}function L(a){var t=c.getTypeAtLocation(a.expression),t=c.typeToTypeNode(t);let s=ts.createNodeArray([]);if(ts.isFunctionTypeNode(t)&&(s=t.parameters,a.arguments)&&s.length<a.arguments.length)return Q.tickEvent("depython.todo.argparammismatch",{kind:a.kind}),W(a,3010,"TODO: Unsupported call site where caller the arguments outnumber the callee parameters: "+a.getText());t=(t=a.expression).getSourceFile()&&(t=t.getText(),o[t])||null;if(a.arguments&&t&&"TD_ID"==t.attributes.shim)return O(a.arguments[0]);if(ts.isPropertyAccessExpression(a.expression)&&"toString"===a.expression.name.getText())return[t,n]=O(a.expression.expression),[w("str(",t,")"),n];var[t,n]=O(a.expression);let r=A(t);t=(a.arguments||ts.createNodeArray()).map((e,t,n)=>{return e=e,t=s[t],r=a.expression,i=s,n=n,(ts.isFunctionExpression(e)||ts.isArrowFunction(e))&&t&&t.type&&ts.isFunctionTypeNode(t.type)?F(e,M(t,r,i,n),void 0,!0):O(e);var r,i}),n=t.map(([,e])=>e).reduce((e,t)=>e.concat(t),n);if(0===r.indexOf("_py.py_")){if(t.length<=0)return Q.tickEvent("depython.todo._pynoargs"),W(a,3014,"Unsupported: call expression has no arguments for _py.py_ fn");r=r.substr(7).split("_").filter((e,t)=>0!==t).join("_");var i=t.shift()[0];let e=K(t.map(([e])=>e).reduce((e,t)=>e.concat(t),[]));return[w(`${i}.${r}(`,e,")"),n]}let e=K(t.map(([e])=>e).reduce((e,t)=>e.concat(t),[]));return[w(r+"(",e,")"),n]}function y(n,r){var i,a=[],s={};for(let t=0;t<Math.max(n.length,r.length);t++){let e;n[t]?s[S((e=n[t]).name)]=!0:s[i=S((e=r[t]).name)]&&(i=pxtc.decompiler.getNewName(i,s),e=Object.assign({altName:i},r[t])),a.push(e)}return ts.createNodeArray(a,!1)}function F(e,t,n,r){if(G&&!ts.isBlock(e.body)){var[i,a]=O(e.body);if(0===a.length)return I((a=(n?y(e.parameters,n):e.parameters).map(e=>f(e,!1)).join(", ")).length?`lambda ${a}: `+A(i):"lambda: "+A(i))}i=e.name?S(e.name):("string"!=typeof(a=t||"my_function")&&(a=S(a)),s[a]?pxtc.decompiler.getNewName(a,s):(s[a]=!0,a));return I(i,U(e,i,n,r))}function D(e){switch(e){case ts.SyntaxKind.ExclamationToken:return" ";case ts.SyntaxKind.PlusToken:case ts.SyntaxKind.MinusToken:return"";default:return" "}}function $(e){if("any"===e.type.getText().trim()&&(ts.isNumericLiteral(e.expression)||ts.isStringLiteral(e.expression)||e.expression.kind===ts.SyntaxKind.TrueKeyword||e.expression.kind===ts.SyntaxKind.FalseKeyword)){e=function e(t){if(t.parent)return t.parent.kind===ts.SyntaxKind.ParenthesizedExpression?e(t.parent):t.parent}(e);if((null==e?void 0:e.kind)===ts.SyntaxKind.BinaryExpression)switch(e.operatorToken.kind){case ts.SyntaxKind.EqualsEqualsToken:case ts.SyntaxKind.EqualsEqualsEqualsToken:case ts.SyntaxKind.ExclamationEqualsToken:case ts.SyntaxKind.ExclamationEqualsEqualsToken:case ts.SyntaxKind.LessThanToken:case ts.SyntaxKind.LessThanEqualsToken:case ts.SyntaxKind.GreaterThanToken:case ts.SyntaxKind.GreaterThanEqualsToken:return 1}}}function O(i){if(ts.isBinaryExpression(i)){var a=i,s=b(a.left),o=b(a.right),l=a.operatorToken.kind===ts.SyntaxKind.PlusToken&&(s||o);let[e,t]=O(a.left),[n,r]=(l&&!s&&(e=w("str(",e,")")),s=_(a.operatorToken.kind,a),O(a.right));return l&&!o&&(n=w("str(",n,")")),a=t.concat(r),[w(A(e)+" "+s+" ",n),a]}if(ts.isPropertyAccessExpression(i))return(o=h(l=i))?I(o):([o,s]=O(l.expression),I("length"===(l=S(l.name))?`len(${A(o)})`:A(o)+"."+l,s));var e,t,n,r,u,p,c,m,f,d,y,k,x,T,g,v;if(ts.isCallExpression(i))return L(i);if(ts.isNewExpression(i))return L(i);if(ts.isFunctionExpression(i)||ts.isArrowFunction(i))return F(i);if(ts.isPrefixUnaryExpression(i))return m=_((a=i).operator,a),[p,c]=O(a.operand),I(""+m+D(a.operator)+A(p),c);if(ts.isPostfixUnaryExpression(i))return p=_((m=i).operator,m),[c,f]=O(m.operand),m=D(m.operator),I(""+A(c)+m+p,f);if(ts.isParenthesizedExpression(i))return[f,d]=O((f=i).expression),I(`(${A(f)})`,d);if(ts.isArrayLiteralExpression(i))return e=(d=(d=i).elements.map(O)).map(([,e])=>e).reduce((e,t)=>e.concat(t),[]),[w("[",K(d.map(([e])=>e).reduce((e,t)=>e.concat(t),[])),"]"),e];if(ts.isElementAccessExpression(i))return(e=i).argumentExpression?([n,r]=O(e.expression),[u,t]=O(e.argumentExpression),r=r.concat(t),I(`${A(n)}[${A(u)}]`,r)):(Q.tickEvent("depython.todo.accesswithoutexp"),W(e,3015,"Unsupported: element access expression without an argument expression"));if(ts.isNoSubstitutionTemplateLiteral(i)||ts.isTaggedTemplateExpression(i))return t=i,ts.isNoSubstitutionTemplateLiteral(t)?I(`"""
${t.text.trim().split("\n").map(e=>""+z.INDENT+e.trim()).join("\n")}
${z.INDENT}"""`):([n,u]=O(t.tag),[t,r]=O(t.template),u=u.concat(r),I(`${A(n)}(${A(t)})`,u));switch(i.kind){case ts.SyntaxKind.TrueKeyword:return I("True");case ts.SyntaxKind.FalseKeyword:return I("False");case ts.SyntaxKind.ThisKeyword:return I("self");case ts.SyntaxKind.NullKeyword:case ts.SyntaxKind.UndefinedKeyword:return I("None")}return ts.isIdentifier(i)?"undefined"==(T=i).text?I("None"):I(S(T)):ts.isNumericLiteral(i)||ts.isStringLiteral(i)?I(i.getText()):ts.isConditionalExpression(i)?([y,v]=O((T=i).condition),[k,x]=O(T.whenTrue),[T,g]=O(T.whenFalse),v=v.concat(x).concat(g),I(`${k} if ${A(y)} else `+A(T),v)):ts.isAsExpression(i)&&$(i)?O(i.expression):(Q.tickEvent("depython.todo.expression",{kind:i.kind}),W(i,3017,"Unsupported expression kind: "+i.kind))}})(e,t),i=t.replace(/(\.py)?\.\w*$/i,"")+".py";n.outfiles[i]=r}catch(e){e.pyDiagnostic?n.diagnostics=[e.pyDiagnostic]:Q.reportException(e),n.success=!1}return n}),B=!1;function e(t){return e=>(e||"").split("\n").map(e=>""+z.INDENT.repeat(t)+e).join("\n")}z.INDENT="    ",z.indent=e,z.indent1=e(1)}})(pxt=pxt||{}),(e=>{e=e.py||(e.py={});{e=e.rx||(e.rx={});let t=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/;e.isIdentifierStart=function(e){return ts.pxtc.isIdentifierStart(e,ts.pxtc.ScriptTarget.ES5)},e.isIdentifierChar=function(e){return ts.pxtc.isIdentifierPart(e,ts.pxtc.ScriptTarget.ES5)},e.isSpace=function(e){return!!(32===e||9===e||11===e||12===e||160===e||5760<=e&&t.test(String.fromCharCode(e)))},e.isNewline=function(e){return 10===e||13===e||8232===e||8233===e}}})(pxt=pxt||{}),(e=>{var s;function t(t){var e=[ts.SyntaxKind.EqualsToken,ts.SyntaxKind.PlusEqualsToken,ts.SyntaxKind.MinusEqualsToken,ts.SyntaxKind.AsteriskEqualsToken,ts.SyntaxKind.AsteriskAsteriskEqualsToken,ts.SyntaxKind.SlashEqualsToken,ts.SyntaxKind.PercentEqualsToken,ts.SyntaxKind.LessThanLessThanEqualsToken,ts.SyntaxKind.GreaterThanGreaterThanEqualsToken,ts.SyntaxKind.GreaterThanGreaterThanGreaterThanEqualsToken,ts.SyntaxKind.AmpersandEqualsToken,ts.SyntaxKind.BarEqualsToken,ts.SyntaxKind.CaretEqualsToken];return ts.isBinaryExpression(t)&&e.some(e=>t.operatorToken.kind===e)}function n(e){let l={refs:[],children:[],owner:void 0};return function a(s){var o;if(!s)return l;if(ts.isPropertyAccessOrQualifiedName(s))return l;if(ts.isIdentifier(s))return{refs:[{kind:"read",node:s,varName:s.text}],children:[],owner:void 0};if(ts.isVariableDeclaration(s)||ts.isParameter(s)){let e=a(s.initializer);return{refs:[...e.refs,{kind:"decl",node:s,varName:s.name.getText()}],children:e.children,owner:void 0}}if(ts.isPrefixUnaryExpression(s)||ts.isPostfixUnaryExpression(s)){let e=a(s.operand),t=s.operand.getText(),n={refs:[{kind:"assign",node:s,varName:t}],children:[],owner:void 0};return u(e,n)}if(t(s)){let e=a(s.right),t,n=(s.operatorToken.kind!==ts.SyntaxKind.EqualsToken&&(t=a(s.left)),s.left.getText()),r={refs:[{kind:"assign",node:s,varName:n}],children:[],owner:void 0};return u(t,u(e,r))}if(ts.isFunctionExpression(s)||ts.isArrowFunction(s)||ts.isFunctionDeclaration(s)||ts.isMethodDeclaration(s)){let e=null==(o=s.name)?void 0:o.getText(),t=void 0,n=(e&&(t={kind:"decl",node:s,varName:e}),s.parameters.map(e=>a(e)).reduce(u,l)),r=a(s.body),i=u(n,r);return i.owner=s,{refs:t?[t]:[],children:[i],owner:void 0}}return s.getChildren().map(a).reduce(u,l)}(e);function u(e,t){return e&&t?{refs:[...e.refs,...t.refs],children:[...e.children,...t.children],owner:e.owner||t.owner}:e||t||l}}function o(e){return[...e.globalUsage,...e.environmentUsage].filter(e=>"assign"===e.kind).map(e=>e)}function l(e){return e.nonlocalUsage.filter(e=>"assign"===e.kind).map(e=>e)}function c(e,t,n=[]){var r,i=[],a=[],s=[],o=[],l={};for(r of e.refs)"read"===r.kind||"assign"===r.kind?(l[r.varName]?s:(t=>n.map(e=>e[t.varName]).reduce((e,t)=>t||e,void 0))(r)?a:t&&t[r.varName]?i:o).push(r):l[r.varName]=r;let u=t||l,p=t?[...n,l]:[];return{globalUsage:i,nonlocalUsage:a,localUsage:s,environmentUsage:o,children:e.children.map(e=>c(e,u,p)),owner:e.owner}}function u(e){return e.kind+":"+e.varName}function r(e){return function e(t){return[t.refs.map(u).join(", "),...t.children.map(e).map(e=>e.map(s.indent1)).map(e=>["{",...e,"}"]).reduce((e,t)=>[...e,...t],[])]}(e).join("\n")}function i(e){return function e(t){var n=t.globalUsage.map(u).join(", "),r=t.nonlocalUsage.map(u).join(", "),i=t.localUsage.map(u).join(", "),a=t.environmentUsage.map(u).join(", ");return[n?"global "+n:"",r?"nonlocal "+r:"",i?"local "+i:"",a?"env "+a:"",...t.children.map(e).map(e=>e.map(s.indent1)).map(e=>["{",...e,"}"]).reduce((e,t)=>[...e,...t],[])].filter(e=>!!e)}(e).join("\n")}(s=e.py||(e.py={})).computeScopeVariableLookup=function(e){e=c(n(e));let i=new Map,a=new Map;return function e(t){let n=s(o(t));i.set(t.owner,n);let r=s(l(t));a.set(t.owner,r);t.children.forEach(e)}(e),{getExplicitGlobals:e=>i.get(e)||[],getExplicitNonlocals:e=>a.get(e)||[]};function t(e){e=e.node.operand||e.node.left;return ts.isIdentifier(e)?e:void 0}function s(e){return e.map(t).filter(e=>!!e).map(e=>e).reduce((e,t)=>e.find(e=>e.text===t.text)?e:[...e,t],[])}},s.toStringVariableScopes=function(e){var t=c(e=n(e));return r(e)+"\n\n\n"+i(t)}})(pxt=pxt||{});